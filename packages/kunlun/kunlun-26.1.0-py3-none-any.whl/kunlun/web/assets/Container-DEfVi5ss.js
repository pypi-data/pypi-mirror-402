import{Q as B}from"./QPage-Bsl3POGX.js";import{s as x,a as Q,b as T,Q as N}from"./notify-l1rcF7nX.js";import{b as f,a as V,T as q}from"./QCardActions-CCNxgX-L.js";import{Y as w,O as b,Q as _,R as e,_ as m,B as s,T as t,W as l,ab as i,Z as y,V as r,U as h,ac as D,aa as A,X as v,a2 as E,a3 as U}from"./index-CsBGwL4Q.js";import{_ as P,i as I,j as L,g as u,Q as d,k as F}from"./_plugin-vue_export-helper-InhTkpCe.js";import{Q as p,d as M}from"./QSelect-D2sTgnVn.js";import{Q as R}from"./QPopupProxy-C3ZvZ6cv.js";import{Q as W}from"./use-checkbox-CvDoxYT1.js";import{A as G}from"./AskQuestion-CjA_xxF0.js";const J={name:"ContainerPanel",props:["container","mode"],components:{AskQuestion:G},setup(){return{notify:x()}},data:()=>({username:"autotest",dialog:!1,hours:0,minutes:0,seconds:0}),computed:{containerAction(){return this.container.status==="idle"?"Start Test":this.container.status==="run"?"Stop Test":this.container.status==="stop"||this.container.status==="fail"||this.container.status==="pass"?"Deposit Test":"Start Test"},containerIcon(){return this.container.status==="idle"?"play_arrow":this.container.status==="run"?"highlight_off":this.container.status==="stop"||this.container.status==="fail"||this.container.status==="pass"?"delete_forever":"play_arrow"},containerColor(){return this.container.status==="run"?"bg-yellow-4":this.container.status==="idle"?"":this.container.status==="fail"||this.container.status==="stop"?"bg-red-4":this.container.status==="pass"?"bg-green-4":""},modeIcon(){return this.container.mode==="PRODUCT"?"stars":this.container.mode==="DEVELOP"?"bug_report":"stars"},testTime(){return this.container.test_time?(this.calcTimer(),!0):!1}},watch:{},mounted(){},unmounted(){},methods:{calcTimer(){const n=parseInt(this.container.test_time);this.seconds=this.timerFormat(n%60),this.minutes=this.timerFormat(parseInt(n/60,10)%60),this.hours=this.timerFormat(parseInt(n/3600,10))},timerFormat(n){return n?n>9?n:"0"+n:"00"},containerActionClick(){let n="deposit-test";if(this.container.status==="idle"&&(n="start-test"),this.container.status==="run"){if(this.dialog==!1)return this.dialog=!0,!1;this.dialog=!1,n="stop-test",this.$emit("closeQuestion",this.container.name)}this.$api.post(n,{container:this.container.name,mode:this.mode,username:this.username}).then(o=>{this.notify(o.data.message)}).catch(o=>{console.log(o)})}}},j={class:"row"},X={class:"col-12"},Y=["href"],Z={class:"text-h5 text-weight-light text-black"},H=["href"],K={class:"text-h5 text-weight-light text-black"},$={class:"text-h5 text-weight-light"};function tt(n,o,a,C,O,c){const k=w("AskQuestion");return _(),b(T,{class:A("shadow-4 q-ma-xs "+c.containerColor)},{default:e(()=>[m("div",j,[m("div",X,[s(t(I,{class:"q-mt-xs",style:{"padding-bottom":"-5px"}},{default:e(()=>[m("a",{href:"#/autotest/"+a.container.name.replace(":","/").toLowerCase()},[m("span",Z,l(a.container.name),1)],8,Y),s(m("span",{class:"text-body1 text-weight-light q-ml-md q-mt-xs"},l(n.hours+":"+n.minutes+":"+n.seconds),513),[[i,c.testTime]]),t(Q),s(t(y,{flat:"",round:"",onClick:c.containerActionClick,size:"1.1em",icon:c.containerIcon},{default:e(()=>[t(f,null,{default:e(()=>[r(l(c.containerAction),1)]),_:1})]),_:1},8,["onClick","icon"]),[[i,a.container.starticon||a.container.status!=="idle"]])]),_:1},512),[[i,a.container.dense===1]]),s(t(I,{class:"q-mt-xs",style:{"padding-bottom":"-5px"}},{default:e(()=>[m("a",{href:"#/autotest/"+a.container.name.replace(":","/").toLowerCase()},[m("span",K,l(a.container.name),1)],8,H),t(Q),s(t(h,{size:"1.6em",name:c.modeIcon},{default:e(()=>[t(f,null,{default:e(()=>[r(l(a.container.mode)+", by "+l(a.container.starter),1)]),_:1})]),_:1},8,["name"]),[[i,a.container.status!=="idle"]]),s(t(h,{size:"1.6em",name:"sentiment_very_dissatisfied"},{default:e(()=>[t(f,null,{default:e(()=>o[2]||(o[2]=[r("FAIL")])),_:1})]),_:1},512),[[i,a.container.status==="fail"]]),s(t(h,{size:"1.6em",name:"mood_bad"},{default:e(()=>[t(f,null,{default:e(()=>[r("Stopped by "+l(a.container.stopper),1)]),_:1})]),_:1},512),[[i,a.container.status==="stop"]]),s(t(h,{size:"1.6em",name:"phonelink_lock"},{default:e(()=>[t(f,null,{default:e(()=>o[3]||(o[3]=[r("Wait Queue")])),_:1})]),_:1},512),[[i,a.container.queue==="WAIT"]]),s(t(h,{size:"1.6em",name:"screen_lock_portrait"},{default:e(()=>[t(f,null,{default:e(()=>o[4]||(o[4]=[r("In Queue")])),_:1})]),_:1},512),[[i,a.container.queue==="GOT"]]),s(t(h,{size:"1.6em",name:"sync"},{default:e(()=>[t(f,null,{default:e(()=>o[5]||(o[5]=[r("In Sync Up")])),_:1})]),_:1},512),[[i,a.container.sync]]),s(t(h,{size:"1.6em",name:"sync"},{default:e(()=>[t(f,null,{default:e(()=>o[6]||(o[6]=[r("Recycle")])),_:1})]),_:1},512),[[i,a.container.recycle]]),s(t(y,{flat:"",round:"",onClick:c.containerActionClick,size:"1.1em",icon:c.containerIcon},{default:e(()=>[t(f,null,{default:e(()=>[r(l(c.containerAction),1)]),_:1})]),_:1},8,["onClick","icon"]),[[i,a.container.starticon]])]),_:1},512),[[i,a.container.dense>=2]]),s(t(L,{separator:"",dense:"",style:{"margin-top":"-12px"},class:"text-body1 text-weight-light"},{default:e(()=>[t(u,null,{default:e(()=>[s(t(d,null,{default:e(()=>[r(l(n.hours+":"+n.minutes+":"+n.seconds),1)]),_:1},512),[[i,c.testTime]])]),_:1}),s(t(u,null,{default:e(()=>[t(d,null,{default:e(()=>[r(l(a.container.display1),1)]),_:1})]),_:1},512),[[i,a.container.dense>=2]]),s(t(u,null,{default:e(()=>[t(d,null,{default:e(()=>[t(p,null,{default:e(()=>[r(l(a.container.display2),1)]),_:1})]),_:1})]),_:1},512),[[i,a.container.dense>=3]]),s(t(u,null,{default:e(()=>[t(d,null,{default:e(()=>[t(p,null,{default:e(()=>[r(l(a.container.display0||a.container.display3),1)]),_:1})]),_:1})]),_:1},512),[[i,a.container.dense>=4]])]),_:1},512),[[i,a.container.dense>=2]]),t(R,{"context-menu":"",class:"bg-indigo-1"},{default:e(()=>[t(L,{dense:"",bordered:"",separator:""},{default:e(()=>[s((_(),b(u,null,{default:e(()=>[t(d,null,{default:e(()=>[r(l(a.container.name),1)]),_:1})]),_:1})),[[D]]),t(F,{class:"bg-grey"}),s(t(u,null,{default:e(()=>[t(d,null,{default:e(()=>[r(l(a.container.display1),1)]),_:1})]),_:1},512),[[i,a.container.display1]]),s(t(u,null,{default:e(()=>[t(d,null,{default:e(()=>[r(l(a.container.display2),1)]),_:1})]),_:1},512),[[i,a.container.display2]]),s(t(u,null,{default:e(()=>[t(d,null,{default:e(()=>[r(l(a.container.display3),1)]),_:1})]),_:1},512),[[i,a.container.display3]]),s(t(u,null,{default:e(()=>[t(d,null,{default:e(()=>[r(l(a.container.display4),1)]),_:1})]),_:1},512),[[i,a.container.display4]]),s(t(u,null,{default:e(()=>[t(d,null,{default:e(()=>[r(l(a.container.display5),1)]),_:1})]),_:1},512),[[i,a.container.display5]]),s(t(u,null,{default:e(()=>[t(d,null,{default:e(()=>[r(l(a.container.display6),1)]),_:1})]),_:1},512),[[i,a.container.display6]]),s(t(u,null,{default:e(()=>[t(d,null,{default:e(()=>[r(l(a.container.display0),1)]),_:1})]),_:1},512),[[i,a.container.display0]])]),_:1})]),_:1})])]),s(t(W,{value:60,color:"primary",size:"xs"},null,512),[[i,a.container.progress]]),t(M,{modelValue:n.dialog,"onUpdate:modelValue":o[1]||(o[1]=g=>n.dialog=g),persistent:""},{default:e(()=>[t(T,{style:{width:"500px","max-width":"80vw"}},{default:e(()=>[t(N,null,{default:e(()=>[m("span",$,l(a.container.name)+": "+l(n.$t("dialog.stop")),1)]),_:1}),t(V,null,{default:e(()=>[t(y,{color:"accent",onClick:c.containerActionClick,label:n.$t("dialog.confirm")},null,8,["onClick","label"]),t(Q),t(y,{color:"primary",onClick:o[0]||(o[0]=g=>n.dialog=!1),label:n.$t("dialog.cancel")},null,8,["label"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(k,{container:a.container},null,8,["container"])]),_:1},8,["class"])}const et=P(J,[["render",tt],["__scopeId","data-v-ecbd039e"]]),nt={name:"ContainernPage",components:{Panel:et,ToolBar:q},setup(){return{notify:x()}},data:()=>({url:"",ws:null,timeOuter:null,containerList:[],station:"",containerName:"",version:"",host:"",mode:"PRODUCT"}),computed:{},mounted(){this.url=window.location.hash.substring(1),this.station=this.url.split("/")[2].toUpperCase(),this.getPlatformInfo(),this.getContainerList(),this.initSocket()},unmounted(){this.ws.close(),this.timeOuter&&clearTimeout(this.timeOuter)},methods:{async initSocket(){const n=this.$hostname.replace("http","ws")+"/ws"+this.url.toUpperCase();this.ws=new WebSocket(n),this.ws.onmessage=this.onMessageSocket,this.ws.onerror=this.onErrorSocket,this.ws.onclose=this.onCloseSocket,this.timeOuter&&clearTimeout(this.timeOuter)},onErrorSocket(){this.notify("WS Connection Lost"),this.timeOuter=setTimeout(()=>{this.initSocket()},3e3)},onSendSocket(n){this.ws.send(JSON.stringify(n))},onCloseSocket(){return!1},onMessageSocket(n){const o=JSON.parse(n.data);o.type==="container"&&this.containerList.forEach((a,C)=>{a.name===o.name&&this.containerList.splice(C,1,o.data)})},async getContainerList(){this.$api.post("get-container-list",{station:this.station}).then(n=>{this.containerList=n.data.data,this.notify(n.data.message)}).catch(n=>{console.log(n),this.notify("Get Container List meets Errors")})},closeQuestion(n){n===this.containerName&&(this.containerName="")},async getPlatformInfo(){this.$api.post("get-platform-info").then(n=>{this.version=n.data.version,this.host=n.data.host,document.title=this.host+" | "+this.version}).catch(n=>{console.log(n)})},setMode(n){this.mode=n}}},at={class:"row"},st={class:"col-12"};function it(n,o,a,C,O,c){const k=w("ToolBar"),g=w("Panel");return _(),b(B,null,{default:e(()=>[m("div",at,[m("div",st,[t(k,{onSetMode:c.setMode},null,8,["onSetMode"])]),(_(!0),v(E,null,U(n.containerList,(S,z)=>(_(),v("div",{class:A("col-"+S.col),key:z},[t(g,{container:S,mode:n.mode,onCloseQuestion:c.closeQuestion},null,8,["container","mode","onCloseQuestion"])],2))),128))])]),_:1})}const _t=P(nt,[["render",it]]);export{_t as default};
