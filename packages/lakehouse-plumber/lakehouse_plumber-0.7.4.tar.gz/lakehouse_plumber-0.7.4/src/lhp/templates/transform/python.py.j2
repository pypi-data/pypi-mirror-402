@dp.temporary_view()
def {{ target_view }}():
    """{{ description }}"""
    {% if source_views %}
    # Load source view(s)
    {% for source in source_views %}
    {% if readMode == "stream" %}
    {{ source }}_df = spark.readStream.table("{{ source }}")
    {% else %}
    {{ source }}_df = spark.read.table("{{ source }}")
    {% endif %}
    {% endfor %}
    
    # Apply Python transformation
    parameters = {{ parameters | tojson }}
    {% if source_views|length == 1 %}
    df = {{ function_name }}({{ source_views[0] }}_df, spark, parameters)
    {% else %}
    dataframes = [{{ source_views|join('_df, ') }}_df]
    df = {{ function_name }}(dataframes, spark, parameters)
    {% endif %}
    {% else %}
    # No source views - function generates data
    parameters = {{ parameters | tojson }}
    df = {{ function_name }}(spark, parameters)
    {% endif %}
    
    {% if add_operational_metadata %}
    # Add operational metadata columns
    {% for col_name, expression in metadata_columns.items()|sort %}
    df = df.withColumn('{{ col_name }}', {{ expression }})
    {% endfor %}
    {% endif %}
    
    return df 