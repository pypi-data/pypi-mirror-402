"""Redis configuration generator"""
from pathlib import Path
from core.decorators import Generator
from core.utils import FileOperations
from core.config_reader import ConfigReader


@Generator(
    category="config",
    priority=45,
    enabled_when=lambda c: c.has_redis(),
    description="Generate Redis configuration"
)
class RedisConfigGenerator:
    """Redis configuration generator"""
    
    def __init__(self, project_path: Path, config_reader: ConfigReader):
        """Initialize Redis config generator
        
        Args:
            project_path: Project root directory path
            config_reader: Configuration reader instance
        """
        self.project_path = Path(project_path)
        self.config_reader = config_reader
        self.file_ops = FileOperations(base_path=project_path)
    
    def generate(self) -> None:
        """Generate Redis configuration"""
        if not self.config_reader.has_redis():
            return
        
        # Generate Redis configuration module
        self._generate_redis_config()
        
        # Note: Redis connection manager is now generated by RedisAppGenerator
    
    def _generate_redis_config(self) -> None:
        """Generate Redis configuration settings"""
        content = '''"""Redis configuration module"""

from app.core.config.base import EnvBaseSettings
from pydantic import Field


class RedisSettings(EnvBaseSettings):
    """Redis configuration"""
    
    REDIS_CONNECTION_URL: str = Field(
        default="redis://localhost:6379",
        description="Redis connection URL. Supports password: redis://:password@host:port or redis://username:password@host:port",
    )
    
    REDIS_POOL_SIZE: int = Field(
        default=5,
        description="Maximum number of connections in the Redis connection pool (Conservative strategy: suitable for 2-core 2GB server)",
    )
    
    REDIS_SOCKET_TIMEOUT: int = Field(
        default=10, 
        description="Redis socket timeout in seconds"
    )
    
    REDIS_DEFAULT_TTL: int = Field(
        default=3600, 
        description="Default cache time-to-live in seconds"
    )
'''
        
        self.file_ops.create_python_file(
            file_path="app/core/config/modules/redis.py",
            content=content,
            overwrite=True
        )