# Release Notes: okresult v0.3.0

**Release Date:** January 19, 2026

## Overview

okresult v0.3.0 introduces powerful new features for composing Result operations, making it easier to write clean, readable error-handling code. This release adds generator-based composition (do-notation) for both synchronous and asynchronous operations, plus a utility for flattening nested Results.

## ğŸ‰ New Features

### Generator-Based Composition (Do-Notation)

Chaining multiple Result operations no longer requires deeply nested callbacks. The new `gen()` and `gen_async()` methods enable linear, readable code composition.

#### Synchronous Composition with `Result.gen()`

The `gen()` method allows you to compose multiple Result operations sequentially using Python generators. Values are automatically unwrapped on success, and errors short-circuit immediately.

**Before (nested callbacks):**
```python
result = parse_number("10").and_then(
    lambda a: parse_number("2").and_then(
        lambda b: divide(a, b).and_then(
            lambda c: Result.ok(c * 2)
        )
    )
)
```

**After (generator composition):**
```python
def compute() -> Do[float, str]:
    a: int = yield parse_number("10")
    b: int = yield parse_number("2")
    c: float = yield divide(a, b)
    d: float = yield Result.ok(c * 2)
    return Result.ok(d)

result = Result.gen(compute)
```

**Key Features:**
- Automatic unwrapping of `Ok` values
- Short-circuiting on first `Err`
- Error types from all yields are collected into a union type
- Supports context binding for method-like usage

#### Async Composition with `Result.gen_async()`

For asynchronous operations, use `gen_async()` with async generators:

```python
async def load_user_data() -> DoAsync[dict[str, object], str]:
    user_id = 123
    user = yield await fetch_user(user_id)
    posts = yield await fetch_posts(user["id"])
    yield Result.ok({"user": user, "posts": posts})

result = await Result.gen_async(load_user_data)
```

**Note:** Async generators must yield the final Result as the last value (non-empty `return` statements are a SyntaxError per PEP 525).

### Result Flattening with `Result.flatten()`

The `flatten()` method simplifies working with nested Results:

```python
# Flatten nested Result
Result.flatten(Result.ok(Result.ok(42)))  # Ok(42)

# Identity for non-nested Results
Result.flatten(Result.ok(42))  # Ok(42)

# Preserves errors
Result.flatten(Result.err("error"))  # Err("error")
```

This is particularly useful when dealing with functions that return `Result[Result[T, E], E]` and you want a flat `Result[T, E]`.

## ğŸ“š Documentation

All new methods include comprehensive docstrings with:
- Type signatures and type variable documentation
- Detailed parameter descriptions
- Usage examples
- Error handling behavior

## ğŸ”§ Technical Details

### Type Safety

- `gen()` and `gen_async()` properly infer and union error types from all yielded Results
- `flatten()` uses overloads to handle both nested and non-nested Results
- Full type checking support with strict mode Pyright

### Error Handling

- Generator cleanup is handled automatically (finally blocks run correctly)
- Defects in generator bodies raise `Panic` (not domain errors)
- Short-circuiting closes generators immediately when an `Err` is encountered

### Compatibility

- Requires Python 3.13+ (same as previous versions)
- No breaking changes to existing API
- All existing code continues to work

## ğŸ§ª Testing

All new features are thoroughly tested with:
- Unit tests for success and error cases
- Type checking validation
- Edge cases (nested Results, generator cleanup, async behavior)

## ğŸ“¦ Installation

```bash
pip install okresult==0.3.0
```

## ğŸ”„ Migration Guide

No migration required! All existing code works as before. The new features are additive and can be adopted incrementally.

To start using generator composition:
1. Replace deeply nested `and_then()` chains with generator functions
2. Use `Result.gen()` or `Result.gen_async()` to execute them
3. Enjoy cleaner, more readable code

## ğŸ¯ What's Next

We're continuously improving okresult based on community feedback. If you have suggestions or encounter issues, please [open an issue](https://github.com/pedrodrocha/okresult/issues) on GitHub.

## ğŸ™ Acknowledgments

Thank you to all contributors and users of okresult for making this release possible!

---

**Full Changelog:** See [CHANGELOG.md](../CHANGELOG.md) for complete change history.
