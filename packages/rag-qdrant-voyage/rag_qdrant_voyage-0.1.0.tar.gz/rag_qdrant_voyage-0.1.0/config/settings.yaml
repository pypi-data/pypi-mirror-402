qdrant:
  url: ${QDRANT_URL}
  api_key: ${QDRANT_API_KEY}
  collection: ${QDRANT_COLLECTION}

voyage:
  api_key: ${VOYAGE_API_KEY}

  # Dense models
  docs_model: "voyage-context-3"
  code_model: "voyage-code-3"
  output_dimension: 2048
  output_dtype: "float"

  # Reranker
  rerank_model: "rerank-2.5"

vectors:
  dense_docs: "dense_docs"
  dense_code: "dense_code"
  sparse_lexical: "sparse_lexical"

retrieval_defaults:
  # New unified config
  fusion_method: "dbsf"  # "dbsf" (Distribution-Based Score Fusion) or "rrf" (Reciprocal Rank Fusion)
  score_threshold: 0.0   # Filter results below this score (0 = disabled)
  top_k: 12             # Final number of results
  first_stage_k: 80     # Candidates per prefetch lane
  rerank_candidates: 60 # Candidates to send to reranker
  group_by: "path"      # Field to group by for deduplication (one best chunk per file)
  group_size: 1         # Max results per group

  # Context expansion settings (enabled by default for better contextual depth)
  context_expansion:
    enabled: true           # Fetch adjacent chunks around top results
    expand_top_k: 5         # Number of top results to expand
    window_size: 1          # Â±1 = fetch N-1 and N+1 (3 total per parent)
    score_decay_factor: 0.85  # Score multiplier for adjacent chunks
    max_expanded_chunks: 20 # Safety cap on total expanded

  # Legacy fields for backwards compatibility
  fusion: "dbsf"
  prefetch_limit_dense: 60
  prefetch_limit_sparse: 80
  final_limit: 30
  rerank_top_k: 12

# Ingestion configuration per SPEC-00 corpus embedding targets
ingestion:
  batch_size: 50  # Points per Qdrant upsert batch
  
  corpora:
    adk_docs:
      root: "corpora/adk-docs"
      corpus: "adk_docs"
      repo: "google/adk-docs"
      kind: "doc"
      ref: "main"
      include_globs:
        - "docs/**/*.md"
        - "docs/**/*.mdx"
        - "examples/python/**/*.py"
        - "examples/python/**/*.md"
        - "README.md"
        - "CONTRIBUTING.md"
      exclude_globs:
        - "**/site/**"
        - "**/.git/**"
        - "**/node_modules/**"
        - "**/__pycache__/**"
        # Non-Python API reference
        - "docs/api-reference/java/**"
        - "docs/api-reference/go/**"
        - "docs/api-reference/rest/**"
        - "docs/api-reference/typescript/**"
        # Non-Python example code
        - "examples/go/**"
        - "examples/java/**"
        - "examples/typescript/**"
        # Non-Python language docs (only include Python docs)
        - "docs/get-started/go.md"
        - "docs/get-started/java.md"
        - "docs/get-started/typescript.md"
        - "**/*-go.md"
        - "**/*-java.md"
        - "**/*-typescript.md"
        - "**/quickstart-streaming-java.md"
        # Theme/tooling
        - "overrides/**"
        - "tools/**"
        - "docs/stylesheets/**"
        - "llms-full.txt"
      allowed_exts: [".md", ".mdx", ".py", ".txt"]
      max_file_bytes: 500000

    adk_python:
      root: "corpora/adk-python"
      corpus: "adk_python"
      repo: "google/adk-python"
      kind: "code"
      ref: "main"
      include_globs:
        - "src/**/*.py"
        - "tests/**/*.py"
        - "README.md"
        - "AGENTS.md"
        - "pyproject.toml"
      exclude_globs:
        - "**/.git/**"
        - "**/__pycache__/**"
        - "**/.venv/**"
        - "**/*.pyc"
        - "**/contributing/**"
        - ".github/**"
        - "scripts/**"
        - "assets/**"
        - "llms-full.txt"
      allowed_exts: [".py", ".md", ".toml"]
      max_file_bytes: 500000

    # OpenAI Agents SDK - Documentation
    openai_agents_docs:
      root: "corpora/openai-agents-python"
      corpus: "openai_agents_docs"
      repo: "openai/openai-agents-python"
      kind: "doc"  # Uses voyage-context-3
      ref: "main"
      include_globs:
        - "docs/**/*.md"
        - "README.md"
        - "AGENTS.md"
        - "CLAUDE.md"
      exclude_globs:
        - "**/.git/**"
        - "docs/ja/**"                # Skip Japanese translations
        - "docs/ko/**"                # Skip Korean translations
        - "docs/zh/**"                # Skip Chinese translations
        - "docs/ref/**"               # Skip auto-generated API reference
        - "docs/stylesheets/**"
        - "docs/scripts/**"
        - "docs/assets/**"
        - "llms-full.txt"
        - "llms.txt"
      allowed_exts: [".md"]
      max_file_bytes: 500000

    # OpenAI Agents SDK - Python Source Code
    openai_agents_python:
      root: "corpora/openai-agents-python"
      corpus: "openai_agents_python"
      repo: "openai/openai-agents-python"
      kind: "code"  # Uses voyage-code-3
      ref: "main"
      include_globs:
        - "src/**/*.py"
        - "examples/**/*.py"
        - "tests/**/*.py"
        - "pyproject.toml"
      exclude_globs:
        - "**/.git/**"
        - "**/__pycache__/**"
        - "**/.venv/**"
        - "**/*.pyc"
      allowed_exts: [".py", ".toml"]
      max_file_bytes: 500000

    # =========================================================================
    # LangChain Ecosystem
    # =========================================================================

    # LangGraph - Python source code (graph-based agent orchestration)
    langgraph_python:
      root: "corpora/langgraph"
      corpus: "langgraph_python"
      repo: "langchain-ai/langgraph"
      kind: "code"  # Uses voyage-code-3
      ref: "main"
      include_globs:
        - "libs/langgraph/**/*.py"
        - "libs/prebuilt/**/*.py"
        - "libs/checkpoint/**/*.py"
        - "libs/checkpoint-postgres/**/*.py"
        - "libs/checkpoint-sqlite/**/*.py"
        - "libs/sdk-py/**/*.py"
        - "README.md"
        - "AGENTS.md"
        - "CLAUDE.md"
      exclude_globs:
        - "**/.git/**"
        - "**/__pycache__/**"
        - "**/tests/**"
        - "**/bench/**"
        - "libs/sdk-js/**"
        - "libs/cli/**"
        - "**/uv.lock"
      allowed_exts: [".py", ".md"]
      max_file_bytes: 500000

    # LangChain - Python source code (core + key partners)
    langchain_python:
      root: "corpora/langchain"
      corpus: "langchain_python"
      repo: "langchain-ai/langchain"
      kind: "code"  # Uses voyage-code-3
      ref: "main"
      include_globs:
        - "libs/core/**/*.py"
        - "libs/langchain/**/*.py"
        - "libs/text-splitters/**/*.py"
        - "libs/partners/anthropic/**/*.py"
        - "libs/partners/openai/**/*.py"
        - "libs/partners/qdrant/**/*.py"
        - "README.md"
        - "AGENTS.md"
        - "CLAUDE.md"
      exclude_globs:
        - "**/.git/**"
        - "**/__pycache__/**"
        - "**/tests/**"
        - "**/scripts/**"
        - "**/uv.lock"
      allowed_exts: [".py", ".md"]
      max_file_bytes: 500000

    # DeepAgents - Documentation (skills, READMEs, guides)
    deepagents_docs:
      root: "corpora/deepagents"
      corpus: "deepagents_docs"
      repo: "langchain-ai/deepagents"
      kind: "doc"  # Uses voyage-context-3
      ref: "main"
      include_globs:
        - "README.md"
        - "libs/*/README.md"
        - "examples/**/*.md"
        - "libs/deepagents-cli/deepagents_cli/default_agent_prompt.md"
      exclude_globs:
        - "**/.git/**"
      allowed_exts: [".md"]
      max_file_bytes: 500000

    # DeepAgents - Python source code
    deepagents_python:
      root: "corpora/deepagents"
      corpus: "deepagents_python"
      repo: "langchain-ai/deepagents"
      kind: "code"  # Uses voyage-code-3
      ref: "main"
      include_globs:
        - "libs/deepagents/**/*.py"
        - "libs/deepagents-cli/**/*.py"
        - "libs/harbor/**/*.py"
        - "libs/acp/**/*.py"
        - "examples/**/*.py"
      exclude_globs:
        - "**/.git/**"
        - "**/__pycache__/**"
        - "**/tests/**"
      allowed_exts: [".py"]
      max_file_bytes: 500000

    # =========================================================================
    # Anthropic Claude Agent SDK
    # =========================================================================

    # Claude Agent SDK - Documentation
    claude_sdk_docs:
      root: "corpora/claude-agent-sdk-python"
      corpus: "claude_sdk_docs"
      repo: "anthropic/claude-agent-sdk-python"
      kind: "doc"
      ref: "main"
      include_globs:
        - "README.md"
        - "CLAUDE.md"
        - "CHANGELOG.md"
      exclude_globs:
        - "**/.git/**"
        - "**/.claude/**"
      allowed_exts: [".md"]
      max_file_bytes: 500000

    # Claude Agent SDK - Python Source Code
    claude_sdk_python:
      root: "corpora/claude-agent-sdk-python"
      corpus: "claude_sdk_python"
      repo: "anthropic/claude-agent-sdk-python"
      kind: "code"
      ref: "main"
      include_globs:
        - "src/**/*.py"
        - "examples/**/*.py"
        - "pyproject.toml"
      exclude_globs:
        - "**/.git/**"
        - "**/__pycache__/**"
        - "**/tests/**"
        - "**/e2e-tests/**"
        - "**/scripts/**"
        - "**/.claude/**"
      allowed_exts: [".py", ".toml"]
      max_file_bytes: 500000

    # =========================================================================
    # CrewAI Framework
    # =========================================================================

    # CrewAI - Documentation
    crewai_docs:
      root: "corpora/crewAI"
      corpus: "crewai_docs"
      repo: "crewAIInc/crewAI"
      kind: "doc"
      ref: "main"
      include_globs:
        - "README.md"
        - "docs/**/*.md"
        - "docs/**/*.mdx"
        - "lib/crewai/README.md"
        - "lib/crewai-tools/README.md"
      exclude_globs:
        - "**/.git/**"
        - "docs/ko/**"
        - "docs/pt-BR/**"
        - "docs/images/**"
      allowed_exts: [".md", ".mdx"]
      max_file_bytes: 500000

    # CrewAI - Python Source Code
    crewai_python:
      root: "corpora/crewAI"
      corpus: "crewai_python"
      repo: "crewAIInc/crewAI"
      kind: "code"
      ref: "main"
      include_globs:
        - "lib/crewai/src/**/*.py"
        - "lib/crewai-tools/src/**/*.py"
        - "lib/devtools/src/**/*.py"
        - "lib/crewai/pyproject.toml"
        - "lib/crewai-tools/pyproject.toml"
      exclude_globs:
        - "**/.git/**"
        - "**/__pycache__/**"
        - "**/tests/**"
        - "**/uv.lock"
        - "conftest.py"
      allowed_exts: [".py", ".toml"]
      max_file_bytes: 500000

