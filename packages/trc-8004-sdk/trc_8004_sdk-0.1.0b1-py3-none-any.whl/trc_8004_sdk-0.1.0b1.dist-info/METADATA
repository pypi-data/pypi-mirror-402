Metadata-Version: 2.4
Name: trc-8004-sdk
Version: 0.1.0b1
Summary: TRC-8004 Agent SDK for TRON - Agent identity, reputation, and validation
Author-email: sun-protocol <dev@sun.io>
License: MIT
Project-URL: Homepage, https://github.com/sun-protocol/trc-8004-sdk
Project-URL: Documentation, https://github.com/sun-protocol/trc-8004-sdk#readme
Project-URL: Repository, https://github.com/sun-protocol/trc-8004-sdk
Project-URL: Issues, https://github.com/sun-protocol/trc-8004-sdk/issues
Keywords: tron,blockchain,agent,erc-8004,trc-8004,sdk
Classifier: Development Status :: 4 - Beta
Classifier: Intended Audience :: Developers
Classifier: License :: OSI Approved :: MIT License
Classifier: Programming Language :: Python :: 3
Classifier: Programming Language :: Python :: 3.11
Classifier: Programming Language :: Python :: 3.12
Classifier: Topic :: Software Development :: Libraries :: Python Modules
Requires-Python: >=3.11
Description-Content-Type: text/markdown
Requires-Dist: tronpy>=0.6.2
Requires-Dist: httpx>=0.27.0
Provides-Extra: dev
Requires-Dist: pytest>=8.2.0; extra == "dev"
Requires-Dist: pytest-cov>=4.0.0; extra == "dev"
Requires-Dist: ruff>=0.1.0; extra == "dev"
Requires-Dist: build>=1.0.0; extra == "dev"
Requires-Dist: twine>=5.0.0; extra == "dev"

# TRC-8004 Agent SDK

å»ä¸­å¿ƒåŒ– Agent åä½œçš„ Python SDKï¼Œå®ç° ERC-8004 (Trustless Agent Protocol) è§„èŒƒã€‚

## ç‰¹æ€§

- ğŸ”— **å¤šé“¾æ”¯æŒ**ï¼šæŠ½è±¡çš„ Adapter æ¶æ„ï¼Œå½“å‰æ”¯æŒ TRONï¼Œå¯æ‰©å±• EVM é“¾
- ğŸ”„ **è‡ªåŠ¨é‡è¯•**ï¼šå¯é…ç½®çš„æŒ‡æ•°é€€é¿é‡è¯•ç­–ç•¥
- ğŸ›¡ï¸ **ç±»å‹å®‰å…¨**ï¼šå®Œæ•´çš„ç±»å‹æ³¨è§£å’Œ Pydantic æ ¡éªŒ
- ğŸ“ **è¯¦ç»†æ—¥å¿—**ï¼šç»“æ„åŒ–æ—¥å¿—ä¾¿äºè°ƒè¯•
- âš¡ **å¼‚æ­¥æ”¯æŒ**ï¼šåŒæ—¶æä¾›åŒæ­¥å’Œå¼‚æ­¥ API

## å®‰è£…

```bash
# ä½¿ç”¨ uv
uv add trc-8004-sdk

# ä½¿ç”¨ pip
pip install trc-8004-sdk
```

## CLI å·¥å…·

å®‰è£…åå¯ä½¿ç”¨ `trc8004` å‘½ä»¤è¡Œå·¥å…·ï¼š

```bash
# åˆ›å»ºæ–° Agent é¡¹ç›®
trc8004 init MyAgent
trc8004 init MyAgent --port 8200 --tags "swap,defi"

# æµ‹è¯• Agent è¿é€šæ€§
trc8004 test --url http://localhost:8100

# æ³¨å†Œ Agent åˆ°é“¾ä¸Š
trc8004 register --token-uri https://example.com/agent.json --name MyAgent
```

### åˆ›å»º Agent é¡¹ç›®ç¤ºä¾‹

```bash
$ trc8004 init MySwapAgent --port 8200 --tags "swap,defi"

âœ… Agent é¡¹ç›®åˆ›å»ºæˆåŠŸ!

ğŸ“ myswapagent/
   â”œâ”€â”€ app.py           # Agent ä¸»ç¨‹åº
   â”œâ”€â”€ pyproject.toml   # é¡¹ç›®é…ç½®
   â”œâ”€â”€ .env.example     # ç¯å¢ƒå˜é‡æ¨¡æ¿
   â”œâ”€â”€ README.md        # æ–‡æ¡£
   â””â”€â”€ tests/           # æµ‹è¯•

ğŸš€ ä¸‹ä¸€æ­¥:
   cd myswapagent
   uv sync
   python app.py
```

## å¿«é€Ÿå¼€å§‹

```python
from sdk import AgentSDK

# åˆå§‹åŒ– SDK
sdk = AgentSDK(
    private_key="your_hex_private_key",
    rpc_url="https://nile.trongrid.io",
    network="tron:nile",
    identity_registry="TIdentityRegistryAddress",
    validation_registry="TValidationRegistryAddress",
    reputation_registry="TReputationRegistryAddress",
)

# æ³¨å†Œ Agent
tx_id = sdk.register_agent(
    token_uri="https://example.com/agent.json",
    metadata=[{"key": "name", "value": "MyAgent"}],
)
print(f"Agent registered: {tx_id}")

# æ„å»ºè®¢å•æ‰¿è¯º
commitment = sdk.build_commitment({
    "asset": "TRX/USDT",
    "amount": 100.0,
    "slippage": 0.01,
})
```

## æ ¸å¿ƒåŠŸèƒ½

### 1. èº«ä»½æ³¨å†Œ (IdentityRegistry)

```python
# æ–¹å¼ 1: ä½¿ç”¨ token_uri æ³¨å†Œ
tx_id = sdk.register_agent(
    token_uri="https://example.com/agent.json",
    metadata=[
        {"key": "name", "value": "MyAgent"},
        {"key": "version", "value": "1.0.0"},
    ],
)

# æ–¹å¼ 2: ä» agent-card.json è‡ªåŠ¨æå– metadata
import json
with open(".well-known/agent-card.json") as f:
    card = json.load(f)

metadata = AgentSDK.extract_metadata_from_card(card)
# metadata åŒ…å«: name, description, version, url, skills, tags, endpoints
tx_id = sdk.register_agent(metadata=metadata)

# æ›´æ–°å…ƒæ•°æ®
tx_id = sdk.update_metadata(
    agent_id=1,
    key="description",
    value="Updated description",
)
```

### 2. éªŒè¯è¯·æ±‚ (ValidationRegistry)

```python
# å‘èµ·éªŒè¯è¯·æ±‚
tx_id = sdk.validation_request(
    validator_addr="TValidatorAddress",
    agent_id=1,
    request_uri="ipfs://QmXxx...",
    request_hash="0x" + "aa" * 32,
)

# æäº¤éªŒè¯å“åº”ï¼ˆéªŒè¯è€…è°ƒç”¨ï¼‰
tx_id = sdk.validation_response(
    request_hash="0x" + "aa" * 32,
    response=95,  # 0-100 è¯„åˆ†
    response_uri="ipfs://QmYyy...",
)
```

### 3. ä¿¡èª‰åé¦ˆ (ReputationRegistry)

```python
# æäº¤ä¿¡èª‰åé¦ˆ
tx_id = sdk.submit_reputation(
    agent_id=1,
    score=95,
    tag1="0x" + "11" * 32,  # å¯é€‰æ ‡ç­¾
    feedback_auth="0x...",   # Agent æä¾›çš„æˆæƒç­¾å
)
```

### 4. ç­¾åæ„å»º

```python
# æ„å»º A2A è¯·æ±‚ç­¾å
signature = sdk.build_a2a_signature(
    action_commitment="0x...",
    timestamp=int(time.time()),
    caller_address="TCallerAddress",
)

# æ„å»ºåé¦ˆæˆæƒ
feedback_auth = sdk.build_feedback_auth(
    agent_id=1,
    client_addr="TClientAddress",
    index_limit=10,
    expiry=int(time.time()) + 3600,
    chain_id=None,  # è‡ªåŠ¨è§£æ
    identity_registry="TIdentityRegistry",
)
```

### 5. è¯·æ±‚æ„å»ºè¾…åŠ©

```python
# å¸‚ä»·å•æŠ¥ä»·è¯·æ±‚
quote_req = sdk.build_market_order_quote_request(
    asset="TRX/USDT",
    amount=100.0,
    slippage=0.01,
)

# X402 æ‰§è¡Œè¯·æ±‚
execute_req = sdk.build_x402_execute_request(
    action_commitment="0x...",
    order_params={"asset": "TRX/USDT", "amount": 100.0},
    payment_tx_hash="0x...",
    timestamp=int(time.time()),
    caller_address="TCallerAddress",
)
```

## é‡è¯•é…ç½®

SDK æä¾›å¯é…ç½®çš„é‡è¯•ç­–ç•¥ï¼š

```python
from sdk import AgentSDK, RetryConfig, AGGRESSIVE_RETRY_CONFIG

# ä½¿ç”¨é¢„å®šä¹‰é…ç½®
sdk = AgentSDK(
    private_key="...",
    retry_config=AGGRESSIVE_RETRY_CONFIG,  # 5 æ¬¡é‡è¯•
)

# è‡ªå®šä¹‰é…ç½®
custom_config = RetryConfig(
    max_attempts=3,
    base_delay=1.0,
    max_delay=30.0,
    exponential_base=2.0,
    jitter=True,
)
sdk = AgentSDK(private_key="...", retry_config=custom_config)
```

é¢„å®šä¹‰é…ç½®ï¼š
- `DEFAULT_RETRY_CONFIG`: 3 æ¬¡é‡è¯•ï¼Œ1s åŸºç¡€å»¶è¿Ÿ
- `AGGRESSIVE_RETRY_CONFIG`: 5 æ¬¡é‡è¯•ï¼Œ0.5s åŸºç¡€å»¶è¿Ÿ
- `CONSERVATIVE_RETRY_CONFIG`: 2 æ¬¡é‡è¯•ï¼Œ2s åŸºç¡€å»¶è¿Ÿ
- `NO_RETRY_CONFIG`: ä¸é‡è¯•

## å¼‚å¸¸å¤„ç†

SDK æä¾›ç»†ç²’åº¦çš„å¼‚å¸¸ç±»å‹ï¼š

```python
from sdk import (
    SDKError,
    ContractCallError,
    TransactionFailedError,
    RetryExhaustedError,
    InsufficientEnergyError,
)

try:
    tx_id = sdk.register_agent(token_uri="...")
except InsufficientEnergyError:
    print("è´¦æˆ·èƒ½é‡ä¸è¶³ï¼Œè¯·å……å€¼")
except RetryExhaustedError as e:
    print(f"é‡è¯•è€—å°½: {e.last_error}")
except ContractCallError as e:
    print(f"åˆçº¦è°ƒç”¨å¤±è´¥: {e.code} - {e.details}")
except SDKError as e:
    print(f"SDK é”™è¯¯: {e}")
```

å¼‚å¸¸å±‚çº§ï¼š
```
SDKError
â”œâ”€â”€ ConfigurationError
â”‚   â”œâ”€â”€ MissingContractAddressError
â”‚   â”œâ”€â”€ InvalidPrivateKeyError
â”‚   â””â”€â”€ ChainIdResolutionError
â”œâ”€â”€ NetworkError
â”‚   â”œâ”€â”€ RPCError
â”‚   â”œâ”€â”€ TimeoutError
â”‚   â””â”€â”€ RetryExhaustedError
â”œâ”€â”€ ContractError
â”‚   â”œâ”€â”€ ContractCallError
â”‚   â”œâ”€â”€ ContractFunctionNotFoundError
â”‚   â”œâ”€â”€ TransactionFailedError
â”‚   â””â”€â”€ InsufficientEnergyError
â”œâ”€â”€ SignatureError
â”‚   â”œâ”€â”€ InvalidSignatureError
â”‚   â””â”€â”€ SignerNotAvailableError
â”œâ”€â”€ DataError
â”‚   â”œâ”€â”€ InvalidAddressError
â”‚   â”œâ”€â”€ InvalidHashError
â”‚   â”œâ”€â”€ SerializationError
â”‚   â””â”€â”€ DataLoadError
â””â”€â”€ ValidationError
    â”œâ”€â”€ RequestHashMismatchError
    â”œâ”€â”€ FeedbackAuthExpiredError
    â””â”€â”€ FeedbackAuthInvalidError
```

## HTTP å®¢æˆ·ç«¯

### AgentClient

æ™ºèƒ½ HTTP å®¢æˆ·ç«¯ï¼Œè‡ªåŠ¨è§£æ Agent å…ƒæ•°æ®ä¸­çš„ç«¯ç‚¹ï¼š

```python
from sdk import AgentClient

client = AgentClient(
    metadata=agent_metadata,  # ä» Central Service è·å–
    base_url="https://agent.example.com",
)

# è‡ªåŠ¨è§£æç«¯ç‚¹å¹¶å‘é€è¯·æ±‚
response = client.post("quote", {"asset": "TRX/USDT", "amount": 100})
```

### AgentProtocolClient

Agent Protocol æ ‡å‡†å®¢æˆ·ç«¯ï¼š

```python
from sdk import AgentProtocolClient

client = AgentProtocolClient(base_url="https://agent.example.com")

# åˆ›å»ºä»»åŠ¡å¹¶æ‰§è¡Œ
result = client.run({
    "skill": "market_order",
    "params": {"asset": "TRX/USDT", "amount": 100},
})
```

## é“¾å·¥å…·

```python
from sdk import load_request_data, fetch_event_logs

# åŠ è½½è¯·æ±‚æ•°æ®ï¼ˆæ”¯æŒ file://, ipfs://, http://ï¼‰
data = load_request_data("ipfs://QmXxx...")

# è·å–é“¾ä¸Šäº‹ä»¶
events = fetch_event_logs(
    client=tron_client,
    contract_address="TValidationRegistry",
    event_name="ValidationRequest",
    from_block=1000000,
    to_block=1001000,
)
```

## æ‰©å±•å¤šé“¾æ”¯æŒ

SDK ä½¿ç”¨ Adapter æ¨¡å¼ï¼Œå¯è½»æ¾æ‰©å±•å…¶ä»–é“¾ï¼š

```python
from sdk import ContractAdapter, Signer

class EVMContractAdapter(ContractAdapter):
    def __init__(self, rpc_url: str, ...):
        from web3 import Web3
        self.w3 = Web3(Web3.HTTPProvider(rpc_url))
    
    def send(self, contract: str, method: str, params: list, signer: Signer) -> str:
        # EVM äº¤æ˜“é€»è¾‘
        ...

class EVMSigner(Signer):
    def __init__(self, private_key: str):
        from eth_account import Account
        self.account = Account.from_key(private_key)
    
    def sign_message(self, payload: bytes) -> str:
        # EIP-191 ç­¾å
        ...
```

## ç¯å¢ƒå˜é‡

| å˜é‡ | è¯´æ˜ | é»˜è®¤å€¼ |
|------|------|--------|
| `TRON_RPC_URL` | TRON RPC èŠ‚ç‚¹ | `https://nile.trongrid.io` |
| `TRON_NETWORK` | ç½‘ç»œæ ‡è¯† | `tron:nile` |
| `IDENTITY_REGISTRY` | IdentityRegistry åœ°å€ | - |
| `VALIDATION_REGISTRY` | ValidationRegistry åœ°å€ | - |
| `REPUTATION_REGISTRY` | ReputationRegistry åœ°å€ | - |
| `TRON_FEE_LIMIT` | äº¤æ˜“è´¹ç”¨ä¸Šé™ (sun) | `10000000` |
| `IPFS_GATEWAY_URL` | IPFS ç½‘å…³ | `https://ipfs.io/ipfs` |

## å¼€å‘

```bash
# å®‰è£…ä¾èµ–
uv sync

# è¿è¡Œæµ‹è¯•
uv run pytest

# ç±»å‹æ£€æŸ¥
uv run mypy src/sdk
```

## License

MIT
