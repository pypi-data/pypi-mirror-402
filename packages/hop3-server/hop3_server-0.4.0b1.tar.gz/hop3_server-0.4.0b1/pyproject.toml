[project]
name = "hop3-server"
version = "0.4.0.beta1"
description = "Simple PaaS - Deploy and manage web applications on a single server"
authors = [
    { name = "Stefane Fermigier", email = "sf@abilian.com" },
]
readme = "README.md"

dependencies = [
    # Web / app server
    "litestar[standard]>=2.18.0",
    "attrs >= 24.2",
    "jinja2",
    "itsdangerous>=2.0.0",
    # Plugins and DI
    "pluggy ~= 1.4",
    "dishka >= 1.3.0",
    # Database
    "sqlalchemy ~= 2.0",
    "advanced-alchemy >= 0.21",
    "alembic ~= 1.13",
    # Misc
    "termcolor >= 2.5.0",
    "markdown>=3.5",
    # SBOM
    "cyclonedx-bom >= 5.1.1",
    "toml >= 0.10.2",
    # Utils
    "devtools",
    # Security
    "pyjwt>=2.8.0",
    "bcrypt>=4.0.0",
    "cryptography>=42.0.0",
    # ASGI server
    "granian[reload]>=2.2.0",
    # PostgreSQL
    "psycopg2-binary>=2.9.10",
    # MySQL
    "mysql-connector-python>=9.0.0",
    # Config
    "pyyaml>=6.0.3",
    "python-multipart>=0.0.20",
    # Transitive dependencies
    "anyio",
    # Needed for some reason
    "sniffio",
    "uwsgi>=2.0.31",
]

[dependency-groups]
dev = [
    "typing-extensions>=4.12.2",
    "httpx>=0.27.0",
    "pytest-asyncio>=0.23.0",
    "hop3-testing",
    "types-pyyaml>=6.0.12.20250915",
    "types-markdown>=3.10.0.20251106",
]

[project.scripts]
hop3-server = "hop3.server.cli:main"

# ----------------------------------------

[build-system]
requires = ["uv-build>=0.8.4,<0.9.0"]
build-backend = "uv_build"

[tool.uv.build-backend]
module-name = "hop3"
module-root = "src"

#[tool.uv.sources]
#hop3-testing = { path = "../hop3-testing", editable = true }

# ----------------------------------------

[tool.pyright]
exclude = [
    "src/hop3/util/templating.py",
]

# -----------------------------------------------------------------------------

# X imported but missing from the dependency definitions
[tool.deptry.per_rule_ignores]
DEP001 = [
    "tomli",
]

# X defined as a dependency but not used in the codebase
DEP002 = [
    "cyclonedx-bom",
    "jinja2",
    "itsdangerous",
    "python-multipart",
    "sniffio",
]

#DEP003 = [
#    "snoop",
#]
