[project]
name = "valid8r"
dynamic = ["version"]
description = "Clean, flexible input validation for Python applications"
authors = [
    {name = "Mike Lane", email = "mikelane@gmail.com"}
]
license = {text = "MIT"}
readme = "README.md"
requires-python = ">=3.11"
keywords = ["validation", "input", "cli", "maybe-monad", "parsing", "functional-programming"]
classifiers = [
    "Development Status :: 5 - Production/Stable",
    "Intended Audience :: Developers",
    "License :: OSI Approved :: MIT License",
    "Operating System :: OS Independent",
    "Programming Language :: Python :: 3",
    "Programming Language :: Python :: 3.11",
    "Programming Language :: Python :: 3.12",
    "Programming Language :: Python :: 3.13",
    "Programming Language :: Python :: 3.14",
    "Topic :: Software Development :: Libraries :: Python Modules",
    "Topic :: Software Development :: Quality Assurance",
    "Typing :: Typed",
]

dependencies = [
    "email-validator>=2.3.0",
    "pydantic>=2.0",
    "pydantic-core>=2.27.0",
    "uuid-utils>=0.11.0",
]

[project.urls]
Homepage = "https://valid8r.readthedocs.io/"
Repository = "https://github.com/mikelane/valid8r"
Documentation = "https://valid8r.readthedocs.io/"
Issues = "https://github.com/mikelane/valid8r/issues"

[project.scripts]
docs-build = "scripts.docs:build"
docs-serve = "scripts.docs:serve"

[project.optional-dependencies]
click = ["click>=8.0.0"]
typer = ["typer>=0.20.0"]

[dependency-groups]
dev = [
    "fastapi>=0.119.0",
    "httpx>=0.28.1",
    "livereload>=2.7.1",
    "pre-commit>=4.3.0",
    "python-semantic-release>=10.4.1",
    "regexploit>=1.0.0",
    "typer>=0.20.0",
    "uvicorn>=0.37.0",
]

lint = [
    "isort>=6.0.1",
    "mypy>=1.17.1",
    "ruff>=0.12.8",
]

docs = [
    "linkify-it-py>=2.0.0",
    "myst-parser>=4.0.1",
    "sphinx>=8.2.3",
    "sphinx-autoapi>=3.6.0",
    "sphinx-autodoc-typehints>=3.2.0",
    "sphinx-copybutton>=0.5.2",
    "sphinx-rtd-theme>=3.0.2",
]

test = [
    "behave>=1.3.0",
    "cerberus>=1.3.8",
    "click>=8.0.0",
    "coverage>=7.10.2",
    "marshmallow>=4.1.0",
    "pytest>=8.4.1",
    "pytest-asyncio>=0.25.2",
    "pytest-benchmark>=5.2.3",
    "pytest-cov>=6.2.1",
    "pytest-mock>=3.14.1",
    "pytest-sugar>=1.0.0",
    "tox>=4.28.4",
    "typer>=0.20.0",
]

[build-system]
requires = ["hatchling", "hatch-vcs"]
build-backend = "hatchling.build"

[tool.hatch.version]
source = "vcs"
raw-options = { version_scheme = "no-guess-dev" }

[tool.hatch.build.hooks.vcs]
version-file = "valid8r/_version.py"

[tool.hatch.build.targets.wheel]
packages = ["valid8r"]

[tool.hatch.build.targets.wheel.force-include]
"valid8r/py.typed" = "valid8r/py.typed"

[tool.pytest.ini_options]
testpaths = ["tests"]
python_files = ["it_*.py", "test_*.py"]
python_functions = ["it_*"]
python_classes = ["Describe[A-Z]*"]
addopts = ["-s", "-ra", "-q", "-vv"]
asyncio_mode = "auto"
asyncio_default_fixture_loop_scope = "function"

[tool.isort]
line_length = 120
profile = "black"
multi_line_output = 3
force_grid_wrap = 2
include_trailing_comma = true
use_parentheses = true
ensure_newline_before_comments = true
known_first_party = ["valid8r"]
skip_gitignore = true
extend_skip_glob = ["benchmarks/*", "tests/benchmarks/*"]

[tool.ruff]
line-length = 120
src = ["valid8r", "tests"]
include = ["*.py"]
exclude = [".git", ".venv", "__pycache__", "build", "dist"]
target-version = "py311"
respect-gitignore = true

[tool.ruff.format]
quote-style = "single"
indent-style = "space"
skip-magic-trailing-comma = false
line-ending = "auto"

[tool.ruff.lint]
select = ["ALL"]
ignore = [
    "COM812", # Ignore missing trailing commas (conflicts with ruff format)
    "D203", # Don't require 1 blank line before class docstring
    "D213", # Don't require multiline docstring to start at the second line
    "EM101", # Allow raw strings as error messages
    "I001", # Defer to isort for import sorting (isort has superior formatting)
    "ISC001", # Ignore implicitly concatenated strings (conflicts with ruff format)
    "PLR0911", # I don't agree that there could be too many return statements.
    "T201", # This module needs to print, so don't prevent it
    "TRY003", # Don't be so strict about the length of exception messages or whatever this is
]
dummy-variable-rgx = "^(_+|(_+[a-zA-Z0-9_]*[a-zA-Z0-9]+?))$"

[tool.ruff.lint.per-file-ignores]
"test_*.py" = [
    "D100", # Don't require module docstrings
    "D101", # Don't require class docstrings
    "D102", # Don't require method docstrings
    "D401", # Don't require imperative mood in test docstrings
    "FBT001", # Allow tests to use boolean arguments
    "FBT003", # Allow tests to use boolean literals
    "PLR2004", # Don't prevent magic values in tests
    "S101", # Don't prevent asserts
    "S603", # Allow subprocess calls in tests (expected for CLI testing)
    "UP007", # Allow Union syntax in tests (testing backward compat)
    "UP045", # Allow Optional syntax in tests (testing backward compat)
]
"tests/*" = [
    "D100", # Don't require module docstrings in tests
    "D101", # Don't require class docstrings in tests
    "D102", # Don't require method docstrings in tests
    "D103", # Don't require function docstrings in tests
    "D104", # Don't require init docstrings in tests
    "D401", # Don't require imperative mood in test docstrings
    "E501", # Allow long lines in tests
    "ERA001", # Allow commented-out code (test labels)
    "FBT001", # Allow tests to use boolean arguments
    "FBT003", # Allow tests to use boolean literals
    "PGH003", # Allow tests to casually ignore mypy complaints about incorrect types
    "PLC0415", # Allow imports inside test functions
    "PLR0912", # Allow many branches in test helpers
    "PLR0913", # Allow tests to have as many arguments as we want
    "PLR2004", # Allow magic values in tests
    "S101", # Allow asserts in tests
    "S603", # Allow subprocess calls in tests (expected for CLI testing)
    "UP007", # Allow Union syntax in tests (testing backward compat)
    "UP045", # Allow Optional syntax in tests (testing backward compat)
]
"tests/bdd/steps/*" = [
    "ANN401", # Allow Any type in BDD steps (flexible validator signatures)
    "ARG001", # Allow unused arguments (BDD steps receive context they may not use)
    "B011", # Allow assert False for marking unimplemented steps
    "BLE001", # Allow broad exception catching (test robustness)
    "C901", # Allow complex functions in test helpers
    "F841", # Allow unused variables (assigned for documentation/clarity)
    "N806", # Allow uppercase variable names (extracting from context)
    "PT015", # Allow assert False for expected failures
    "S101", # Allow asserts in behave tests
    "TRY004", # Allow AssertionError for type checks in tests
]
"tests/benchmarks/*" = [
    "ANN001", # Allow missing type annotations for pytest benchmark fixtures
    "ANN201", # Allow missing return annotations for pytest fixtures
]
"benchmarks/*" = [
    "PLC0415", # Allow imports inside functions (cerberus regex)
    "TRY300", # Allow return in try block (benchmark code)
]
"tests/_utils/check_coverage.py" = ["T201"] # allow print function in the scripts
"scripts/*" = [
    "T201", # Allow print function in scripts
    "S603", # Allow subprocess calls (security scanning tool)
    "S607", # Allow partial executable paths (uv, regexploit-py)
    "PLC0415", # Allow local imports in functions
    "BLE001", # Allow broad exception catching (tool robustness)
    "TRY300", # Allow return in try blocks
    "PLR2004", # Allow magic values in output formatting
    "ERA001", # Allow commented code (format documentation)
    "RUF001", # Allow unicode symbols in output (⭐×)
    "D401", # Allow non-imperative docstrings in main()
]
"examples/*" = [
    "D401", # Allow non-imperative docstrings in examples
    "FAST002", # Allow FastAPI deps without Annotated (examples prioritize clarity)
    "FBT001", # Allow boolean-typed positional arguments (simpler example code)
    "FBT002", # Allow boolean default positional arguments (simpler example code)
    "INP001", # Allow implicit namespace packages in examples
    "PLC0415", # Allow local imports in examples (for clarity)
    "SIM108", # Allow if-else blocks instead of ternary (clearer for learning)
    "SLF001", # Allow private member access in examples (demonstrating internals)
    "T201", # Allow print function in examples
]
"scripts/check_regex_safety.py" = ["PERF401"] # List comprehension less clear here
"smoke_test.py" = ["S101"] # allow asserts in smoke test
"tests/security/*" = [
    "S607", # Allow partial executable paths (testing uv commands)
    "F841", # Allow unused result variables (testing performance, not output)
    "ANN001", # Allow missing type annotations in parametrized tests
    "PT006", # Allow string in parametrize (clearer than tuple for single param)
    "D401", # Allow non-imperative docstrings (test names are descriptive)
    "PT018", # Allow combined assertions (clearer intent in tests)
]
"conftest.py" = ["D100"] # Don't require module docstrings in conftest
"__init__.py" = ["F401"] # allow unused imports in __init__.py
"valid8r/core/parsers.py" = [
    "C901", # Allow complex functions in parsers
    "D413", # Allow missing blank line after last docstring section
    "FBT001", # Allow boolean positional arguments
    "FBT002", # Allow boolean default arguments
    "PLR2004", # Allow magic values for network constants
]

[tool.ruff.lint.isort]
required-imports = ["from __future__ import annotations"]
known-first-party = ["valid8r"]

[tool.ruff.lint.flake8-quotes]
inline-quotes = "single"
multiline-quotes = "double"
docstring-quotes = "double"

[tool.mypy]
python_version = "3.11"
warn_return_any = true
warn_unused_configs = true
disallow_untyped_defs = true
disallow_incomplete_defs = true

[[tool.mypy.overrides]]
module = [
  "pytest",
  "pytest.*",
  "pytest_mock",
  "pytest_mock.*",
  "behave",
  "behave.*",
  "sphinx",
  "sphinx.*",
  "click",
  "click.*",
  "aiohttp",
  "aiohttp.*",
  "aiodns",
  "aiodns.*",
  "uuid_utils",
  "uuid_utils.*",
  "email_validator",
  "email_validator.*",
  "typer",
  "typer.*",
]
ignore_missing_imports = true

[[tool.mypy.overrides]]
module = [
  "tests.*",
  "docs.*",
]
ignore_errors = true

[tool.semantic_release]
version_variables = ["valid8r/__init__.py:__version__"]
version_source = "commit"
branch = "main"
build_command = ""  # Building handled by workflow, not semantic-release
dist_path = "dist/"
upload_to_release = true
upload_to_pypi = false  # Handled by uv publish in workflow
remove_dist = false
major_on_zero = true  # For pre-1.0 projects
tag_format = "v{version}"
commit_parser = "angular"
logging_use_named_masks = false

[tool.semantic_release.branches.main]
match = "main"
prerelease = false

[tool.semantic_release.changelog]
changelog_file = "CHANGELOG.md"
exclude_commit_patterns = [
    "^chore(?:\\([^)]+\\))?:",
    "^ci(?:\\([^)]+\\))?:",
    "^docs(?:\\([^)]+\\))?:",
    "^style(?:\\([^)]+\\))?:",
    "^test(?:\\([^)]+\\))?:",
    "^build(?:\\([^)]+\\))?:",
]
mode = "update"

[tool.semantic_release.commit_parser_options]
allowed_tags = ["feat", "fix", "perf", "refactor", "docs", "ci", "chore", "test", "build"]
minor_tags = ["feat"]
patch_tags = ["fix", "perf", "refactor"]
default_bump_level = 0

[tool.semantic_release.remote]
name = "origin"
type = "github"
ignore_token_for_push = false

[tool.semantic_release.publish]
dist_glob_patterns = ["dist/*"]
upload_to_vcs_release = true
