# HTTP vs Web æ¶æ„å¯¹æ¯”åˆ†æ

> **ç‰ˆæœ¬**: v3.43.0
> **æœ€åæ›´æ–°**: 2026-01-08
> **çŠ¶æ€**: âœ… å·²çº æ­£é”™è¯¯å»ºè®®

---

## ç›®å½•

- [æ¶æ„å¯¹æ¯”](#æ¶æ„å¯¹æ¯”)
- [å¸¸è§è¯¯è§£æ¾„æ¸…](#å¸¸è§è¯¯è§£æ¾„æ¸…)
- [çœŸå®å·®å¼‚åˆ†æ](#çœŸå®å·®å¼‚åˆ†æ)
- [æ¶æ„è®¾è®¡åŸåˆ™](#æ¶æ„è®¾è®¡åŸåˆ™)
- [æ€»ç»“](#æ€»ç»“)

---

## æ¶æ„å¯¹æ¯”

### HTTP å®¢æˆ·ç«¯æ¶æ„

```
capabilities/clients/http/
â”œâ”€â”€ core/                    # æ ¸å¿ƒæŠ½è±¡ï¼ˆRequest, Responseï¼‰
â”œâ”€â”€ middleware/              # ä¸­é—´ä»¶ï¼ˆæ´‹è‘±æ¨¡å‹ï¼‰
â””â”€â”€ rest/                    # REST åè®®å±‚
    â”œâ”€â”€ protocols.py         # RestClientProtocol æ¥å£
    â”œâ”€â”€ factory.py           # RestClientFactory å·¥å‚
    â””â”€â”€ httpx/               # httpx å®ç°å±‚
        â”œâ”€â”€ client.py        # HttpClientï¼ˆæ¡†æ¶å†…å®ç°ï¼‰
        â””â”€â”€ async_client.py  # AsyncHttpClient
```

**ç‰¹ç‚¹**:
- âœ… æœ‰å·¥å‚æ¨¡å¼ï¼š`RestClientFactory`
- âœ… æ¡†æ¶å†…å®ç°ï¼š`HttpClient` ç›´æ¥åœ¨æ¡†æ¶å†…
- âœ… é…ç½®é©±åŠ¨ï¼š`HTTPConfig` + Provider å•ä¾‹
- ğŸ“ åè®®å±‚ï¼š`rest/graphql/grpc` è¡¨ç¤º**é€šä¿¡åè®®ç±»å‹**
- ğŸ“ ç›®å½•æ·±åº¦ï¼š`clients/http/rest/httpx/` å››å±‚ç»“æ„

**ä¸ºä»€ä¹ˆéœ€è¦åè®®å±‚ï¼Ÿ**

HTTP é€šä¿¡æ”¯æŒå¤šç§åè®®æ ‡å‡†ï¼š
```
clients/http/
â”œâ”€â”€ rest/         # REST API åè®®ï¼ˆå½“å‰ï¼‰
â”‚   â””â”€â”€ httpx/    # httpx å®ç°
â”œâ”€â”€ graphql/      # GraphQL åè®®ï¼ˆå·²å­˜åœ¨ï¼‰
â”‚   â””â”€â”€ gql/      # gql å®ç°
â””â”€â”€ grpc/         # gRPC åè®®ï¼ˆå·²å­˜åœ¨ï¼‰
    â””â”€â”€ grpcio/   # grpcio å®ç°
```

æ¯ç§åè®®æœ‰ä¸åŒçš„ï¼š
- é€šä¿¡æ–¹å¼ï¼ˆè¯·æ±‚/å“åº”æ ¼å¼ï¼‰
- æ•°æ®åºåˆ—åŒ–ï¼ˆJSON / Protobuf / GraphQLï¼‰
- ä¼ è¾“æœºåˆ¶ï¼ˆHTTP/1.1 / HTTP/2 / HTTP/3ï¼‰

---

### Web é©±åŠ¨æ¶æ„

```
capabilities/drivers/web/
â”œâ”€â”€ protocols.py             # WebDriverProtocol æ¥å£
â”œâ”€â”€ factory.py               # WebDriverFactory å·¥å‚
â”œâ”€â”€ playwright/              # Playwright å®ç°å±‚
â”‚   â”œâ”€â”€ browser.py           # BrowserManagerï¼ˆæ¡†æ¶å†…å®ç°ï¼‰
â”‚   â”œâ”€â”€ page.py              # BasePage
â”‚   â””â”€â”€ component.py         # BaseComponent
â””â”€â”€ selenium/                # Selenium å®ç°å±‚ï¼ˆé¢„ç•™ï¼‰
    â””â”€â”€ driver.py
```

**ç‰¹ç‚¹**:
- âœ… æœ‰å·¥å‚æ¨¡å¼ï¼š`WebDriverFactory`
- âœ… æ¡†æ¶å†…å®ç°ï¼š`BrowserManager` ç›´æ¥åœ¨æ¡†æ¶å†…
- âœ… é…ç½®é©±åŠ¨ï¼š`WebConfig` + Provider å•ä¾‹
- ğŸ“ ç›®å½•æ·±åº¦ï¼š`drivers/web/playwright/` ä¸‰å±‚ç»“æ„
- âš ï¸ **æ— åè®®å±‚**ï¼š`web` ç›´æ¥æ˜¯è‡ªåŠ¨åŒ–ç±»å‹ï¼Œä¸æ˜¯åè®®

**ä¸ºä»€ä¹ˆä¸éœ€è¦åè®®å±‚ï¼Ÿ**

`drivers/` çš„ç»„ç»‡é€»è¾‘æ˜¯**UI è‡ªåŠ¨åŒ–ç±»å‹**ï¼š
```
drivers/
â”œâ”€â”€ web/          # æµè§ˆå™¨è‡ªåŠ¨åŒ–ï¼ˆç±»å‹ï¼‰
â”‚   â”œâ”€â”€ playwright/   # å®ç°æ–¹å¼1
â”‚   â””â”€â”€ selenium/     # å®ç°æ–¹å¼2
â”œâ”€â”€ mobile/       # ç§»åŠ¨åº”ç”¨è‡ªåŠ¨åŒ–ï¼ˆç±»å‹ï¼‰- é¢„ç•™
â”‚   â””â”€â”€ appium/       # å®ç°æ–¹å¼
â””â”€â”€ desktop/      # æ¡Œé¢åº”ç”¨è‡ªåŠ¨åŒ–ï¼ˆç±»å‹ï¼‰- é¢„ç•™
    â””â”€â”€ pywinauto/    # å®ç°æ–¹å¼
```

å…³é”®åŒºåˆ«ï¼š
- `web` / `mobile` / `desktop` æ˜¯**è‡ªåŠ¨åŒ–ç›®æ ‡ç±»å‹**ï¼Œä¸æ˜¯é€šä¿¡åè®®
- `playwright` / `selenium` æ˜¯**å®ç°å·¥å…·**ï¼Œä¸æ˜¯åè®®æ ‡å‡†

---

## å¸¸è§è¯¯è§£æ¾„æ¸…

### âŒ è¯¯è§£ 1: HTTP å®¢æˆ·ç«¯å°è£…åœ¨æ¡†æ¶å†…ï¼ŒWeb é©±åŠ¨ä¸æ˜¯

**çœŸç›¸**: ä¸¤è€…éƒ½åœ¨æ¡†æ¶å†…å®ç° âœ…

| ç»„ä»¶ | ä½ç½® | è¯´æ˜ |
|------|------|------|
| HttpClient | `http/rest/httpx/client.py` | æ¡†æ¶å†…å°è£… httpx |
| BrowserManager | `web/playwright/browser.py` | æ¡†æ¶å†…å°è£… playwright |

**ç»“è®º**: å°è£…æ–¹å¼**å®Œå…¨ä¸€è‡´**ï¼Œéƒ½æ˜¯æ¡†æ¶å†…å®ç°çš„é€‚é…å™¨ç±»ã€‚

---

### âŒ è¯¯è§£ 2: Web ä½¿ç”¨äº† Factoryï¼ŒHTTP ä¸æ˜¯

**çœŸç›¸**: ä¸¤è€…éƒ½æœ‰å·¥å‚æ¨¡å¼ âœ…

| å·¥å‚ç±» | ä½ç½® | è¯´æ˜ |
|--------|------|------|
| RestClientFactory | `http/rest/factory.py` | HTTP å·¥å‚ |
| WebDriverFactory | `web/factory.py` | Web å·¥å‚ |

**å·¥å‚å®ç°å¯¹æ¯”**:

```python
# RestClientFactory
RestClientFactory.create(client_type="httpx", config=HTTPConfig())
RestClientFactory.create_httpx(config)
RestClientFactory.create_requests(config)  # é¢„ç•™

# WebDriverFactory
WebDriverFactory.create(driver_type="playwright", browser="chromium")
WebDriverFactory.create_playwright(browser="firefox")
WebDriverFactory.create_selenium(browser="chrome")  # é¢„ç•™
```

**ç»“è®º**: å·¥å‚æ¨¡å¼**å®Œå…¨ä¸€è‡´**ï¼Œéƒ½æ”¯æŒå¤šç§å®ç°åˆ‡æ¢ã€‚

---

## çœŸå®å·®å¼‚åˆ†æ

### å”¯ä¸€çœŸå®å·®å¼‚: ç›®å½•å±‚çº§æ·±åº¦

| ç»´åº¦ | HTTP Clients | Web Drivers |
|------|--------------|-------------|
| **ç»„ç»‡é€»è¾‘** | é€šä¿¡åè®®ç±»å‹ | UI è‡ªåŠ¨åŒ–ç±»å‹ |
| **åè®®å±‚** | `rest/` `graphql/` `grpc/` | âŒ æ— åè®®å±‚ |
| **å®ç°å±‚** | `httpx/` `requests/` | `playwright/` `selenium/` |
| **ç›®å½•æ·±åº¦** | 4å±‚ (`clients/http/rest/httpx/`) | 3å±‚ (`drivers/web/playwright/`) |

### ä¸ºä»€ä¹ˆæ·±åº¦ä¸åŒï¼Ÿ

#### HTTP Clients: å››å±‚æ¶æ„

```
Layer 1: clients/         â† èƒ½åŠ›å¤§ç±»ï¼ˆå®¢æˆ·ç«¯ï¼‰
Layer 2: http/            â† ä¼ è¾“åè®®ï¼ˆHTTP é€šä¿¡ï¼‰
Layer 3: rest/            â† åº”ç”¨åè®®ï¼ˆREST/GraphQL/gRPCï¼‰
Layer 4: httpx/           â† å®ç°å·¥å…·ï¼ˆhttpx/requestsï¼‰
```

**åŸå› **: HTTP é€šä¿¡æœ‰å¤šå±‚åè®®æ ˆï¼š
- ä¼ è¾“å±‚åè®®ï¼šHTTP/1.1ã€HTTP/2ã€HTTP/3
- åº”ç”¨å±‚åè®®ï¼šRESTã€GraphQLã€gRPCã€SOAP
- å®ç°å·¥å…·ï¼šhttpxã€requestsã€aiohttp

#### Web Drivers: ä¸‰å±‚æ¶æ„

```
Layer 1: drivers/         â† èƒ½åŠ›å¤§ç±»ï¼ˆé©±åŠ¨ï¼‰
Layer 2: web/             â† è‡ªåŠ¨åŒ–ç±»å‹ï¼ˆæµè§ˆå™¨/ç§»åŠ¨/æ¡Œé¢ï¼‰
Layer 3: playwright/      â† å®ç°å·¥å…·ï¼ˆplaywright/seleniumï¼‰
```

**åŸå› **: UI è‡ªåŠ¨åŒ–æ²¡æœ‰åè®®å±‚æ¦‚å¿µï¼š
- `web` / `mobile` / `desktop` æ˜¯ç›®æ ‡ç±»å‹ï¼Œä¸æ˜¯åè®®
- `playwright` / `selenium` ç›´æ¥æ˜¯å®ç°å·¥å…·
- æ²¡æœ‰ä¸­é—´çš„"åè®®æ ‡å‡†å±‚"

---

## æ¶æ„è®¾è®¡åŸåˆ™

### åŸåˆ™ 1: æŒ‰ä¸šåŠ¡é€»è¾‘åˆ†å±‚ï¼Œè€Œéå¼ºè¡Œå¯¹é½

**é”™è¯¯åšæ³•** âŒï¼šä¸ºäº†å¯¹é½ç›®å½•æ·±åº¦ï¼Œå¼ºè¡Œå¼•å…¥ `web/browser/` å±‚

```
drivers/web/
â””â”€â”€ browser/          # âŒ ä¸å¿…è¦çš„å±‚çº§
    â”œâ”€â”€ playwright/
    â””â”€â”€ selenium/
```

**é—®é¢˜**:
- `browser` å±‚æ²¡æœ‰å®é™…æ„ä¹‰ï¼ˆ`web` å·²ç»è¡¨ç¤ºæµè§ˆå™¨ï¼‰
- ä¸ `mobile`ã€`desktop` å¹³çº§å…³ç³»è¢«æ‰“ç ´
- è¿å YAGNI åŸåˆ™ï¼ˆYou Aren't Gonna Need Itï¼‰

**æ­£ç¡®åšæ³•** âœ…ï¼šä¿æŒå½“å‰æ¶æ„

```
drivers/
â”œâ”€â”€ web/          # æµè§ˆå™¨è‡ªåŠ¨åŒ–ï¼ˆç±»å‹ï¼‰
â”‚   â”œâ”€â”€ playwright/
â”‚   â””â”€â”€ selenium/
â”œâ”€â”€ mobile/       # ç§»åŠ¨ç«¯è‡ªåŠ¨åŒ–ï¼ˆç±»å‹ï¼‰
â””â”€â”€ desktop/      # æ¡Œé¢åº”ç”¨è‡ªåŠ¨åŒ–ï¼ˆç±»å‹ï¼‰
```

---

### åŸåˆ™ 2: æ¶æ„ä¸€è‡´æ€§ â‰  ç›®å½•æ·±åº¦ä¸€è‡´

**ä¸€è‡´æ€§çš„çœŸæ­£å«ä¹‰**:
- âœ… è®¾è®¡æ¨¡å¼ä¸€è‡´ï¼ˆéƒ½æœ‰ Factoryã€Protocolã€é…ç½®é©±åŠ¨ï¼‰
- âœ… èŒè´£åˆ’åˆ†ä¸€è‡´ï¼ˆéƒ½æ˜¯èƒ½åŠ›å±‚å®ç°ï¼‰
- âœ… ä½¿ç”¨æ–¹å¼ä¸€è‡´ï¼ˆéƒ½é€šè¿‡ RuntimeContext è·å–ï¼‰
- âŒ ç›®å½•æ·±åº¦ä¸€è‡´ï¼ˆä¸åŒä¸šåŠ¡é€»è¾‘ï¼Œæ·±åº¦è‡ªç„¶ä¸åŒï¼‰

**ç±»æ¯”**:
```
food/
â”œâ”€â”€ fruit/          # 2å±‚ï¼ˆæ°´æœæ²¡æœ‰å­åˆ†ç±»ï¼‰
â”‚   â”œâ”€â”€ apple/
â”‚   â””â”€â”€ banana/
â””â”€â”€ meat/           # 3å±‚ï¼ˆè‚‰ç±»æœ‰ç•œè‚‰/ç¦½è‚‰åˆ†ç±»ï¼‰
    â”œâ”€â”€ pork/       # ç•œè‚‰
    â”‚   â””â”€â”€ bacon/
    â””â”€â”€ chicken/    # ç¦½è‚‰
        â””â”€â”€ wing/
```

`fruit` å’Œ `meat` æ·±åº¦ä¸åŒï¼Œä½†è¿™æ˜¯**ä¸šåŠ¡é€»è¾‘å†³å®šçš„**ï¼Œä¸æ˜¯æ¶æ„é—®é¢˜ã€‚

---

### åŸåˆ™ 3: é¢„ç•™æ‰©å±•ç©ºé—´ï¼Œè€Œéè¿‡åº¦è®¾è®¡

**å½“å‰æ¶æ„å·²é¢„ç•™æ‰©å±•**:

```
drivers/
â”œâ”€â”€ web/          # âœ… å·²å®ç°
â”‚   â”œâ”€â”€ playwright/   # âœ… å·²å®ç°
â”‚   â””â”€â”€ selenium/     # ğŸ“‹ é¢„ç•™
â”œâ”€â”€ mobile/       # ğŸ“‹ é¢„ç•™
â”‚   â””â”€â”€ appium/
â””â”€â”€ desktop/      # ğŸ“‹ é¢„ç•™
    â””â”€â”€ pywinauto/
```

**æœªæ¥æ‰©å±•åœºæ™¯**:
- æ–°å¢ `drivers/api/` ç”¨äº API æµ‹è¯•å·¥å…·ï¼ˆPostmanã€Insomniaï¼‰ï¼Ÿ
  - âŒ ä¸åˆé€‚ï¼ŒAPI æµ‹è¯•å±äº `clients/`ï¼Œä¸æ˜¯ `drivers/`
- æ–°å¢ `web/puppeteer/` æ–°å®ç°ï¼Ÿ
  - âœ… åˆé€‚ï¼Œä¸ `playwright/` å¹³çº§
- æ–°å¢ `mobile/xcuitest/` iOS æµ‹è¯•ï¼Ÿ
  - âœ… åˆé€‚ï¼Œä¸ `appium/` å¹³çº§

---

## ~~ä¹‹å‰çš„é”™è¯¯å»ºè®®~~ï¼ˆå·²åºŸå¼ƒï¼‰

### ~~æ–¹æ¡ˆ Aï¼šWeb å¼•å…¥åè®®å±‚~~ï¼ˆâŒ é”™è¯¯ï¼‰

~~**è°ƒæ•´åçš„ç›®å½•ç»“æ„**~~ï¼š

```
drivers/web/
â””â”€â”€ browser/          # âŒ ä¸å¿…è¦çš„åè®®å±‚
    â”œâ”€â”€ playwright/
    â””â”€â”€ selenium/
```

**ä¸ºä»€ä¹ˆé”™è¯¯ï¼Ÿ**
1. âŒ `web` å’Œ `mobile`ã€`desktop` åº”è¯¥å¹³çº§ï¼Œä¸åº”è¯¥æœ‰ä¸­é—´å±‚
2. âŒ `browser` å±‚æ²¡æœ‰å®é™…æ„ä¹‰ï¼ˆ`web` å·²ç»è¡¨ç¤ºæµè§ˆå™¨è‡ªåŠ¨åŒ–ï¼‰
3. âŒ è¿å YAGNI åŸåˆ™ï¼ˆæ²¡æœ‰å®é™…éœ€æ±‚ï¼‰
4. âŒ ç ´åæ€§å˜æ›´ï¼šæ‰€æœ‰å¯¼å…¥è·¯å¾„éƒ½éœ€è¦ä¿®æ”¹

**æ­£ç¡®ç†è§£**:
- `clients/http/rest/` çš„ `rest` æ˜¯**é€šä¿¡åè®®**ï¼ˆREST API æ ‡å‡†ï¼‰
- `drivers/web/` çš„ `web` æ˜¯**è‡ªåŠ¨åŒ–ç±»å‹**ï¼ˆæµè§ˆå™¨ UIï¼‰
- ä¸¤è€…ä¸æ˜¯åŒä¸€å±‚æ¬¡çš„æ¦‚å¿µï¼Œä¸éœ€è¦å¼ºè¡Œå¯¹é½

---

## äº‹ä»¶ç³»ç»Ÿæ¶æ„å¯¹æ¯”ï¼ˆv3.44.0ï¼‰

### ç»Ÿä¸€çš„äº‹ä»¶é©±åŠ¨æ¶æ„

HTTP å’Œ Web UI ä½¿ç”¨**å®Œå…¨ä¸€è‡´**çš„äº‹ä»¶é©±åŠ¨æ¶æ„ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     test_runtime fixture                         â”‚
â”‚  1. åˆ›å»ºæµ‹è¯•ä¸“ç”¨ EventBus                                        â”‚
â”‚  2. æ³¨å…¥åˆ° RuntimeContext.event_bus                              â”‚
â”‚  3. set_test_event_bus(test_event_bus) - å‘åå…¼å®¹               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                     allure fixture (autouse)                     â”‚
â”‚  1. è·å– test_event_bus (é€šè¿‡ get_event_bus())                  â”‚
â”‚  2. è®¢é˜…æ‰€æœ‰äº‹ä»¶ï¼ˆHTTP + Web UI + Database + ...ï¼‰              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  HTTP                           â”‚  Web UI                        â”‚
â”‚  HttpEventPublisherMiddleware   â”‚  BrowserManager                â”‚
â”‚  â†“ runtime.event_bus           â”‚  â†“ runtime.event_bus           â”‚
â”‚  â†“ å‘å¸ƒ HttpRequestStartEvent  â”‚  â†“ æ³¨å†Œ page.on() ç›‘å¬å™¨       â”‚
â”‚  â†“ å‘å¸ƒ HttpRequestEndEvent    â”‚  â†“ å‘å¸ƒ WebBrowserEvent        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                     AllureObserver                               â”‚
â”‚  handle_http_request_*_event() â”‚  handle_web_browser_event()    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### äº‹ä»¶ç³»ç»Ÿå¯¹æ¯”

| ç»´åº¦ | HTTP | Web UI | ä¸€è‡´æ€§ |
|------|------|--------|--------|
| **EventBus æ¥æº** | `runtime.event_bus` | `runtime.event_bus` | âœ… å®Œå…¨ä¸€è‡´ |
| **RuntimeContext** | ä½¿ç”¨ test_runtime | ä½¿ç”¨ test_runtime | âœ… å®Œå…¨ä¸€è‡´ |
| **äº‹ä»¶å‘å¸ƒä½ç½®** | HttpEventPublisherMiddleware | BrowserManager._setup_event_listeners() | âœ… ç†å¿µä¸€è‡´ |
| **æµ‹è¯•éš”ç¦»** | æ¯ä¸ªæµ‹è¯•ç‹¬ç«‹ EventBus | æ¯ä¸ªæµ‹è¯•ç‹¬ç«‹ EventBus | âœ… å®Œå…¨ä¸€è‡´ |
| **Allure è®¢é˜…** | allure fixture è‡ªåŠ¨è®¢é˜… | allure fixture è‡ªåŠ¨è®¢é˜… | âœ… å®Œå…¨ä¸€è‡´ |
| **äº‹ä»¶ç±»å‹** | HttpRequestStartEvent/EndEvent | WebBrowserEvent | âœ… å„è‡ªé¢†åŸŸäº‹ä»¶ |

### å…³é”®è®¾è®¡å†³ç­–

1. **EventBus é›†æˆåˆ° RuntimeContext**
   - `RuntimeContext.event_bus` å­—æ®µå­˜å‚¨ EventBus
   - `test_runtime` fixtureï¼ˆfunction çº§åˆ«ï¼‰åˆ›å»ºæµ‹è¯•ä¸“ç”¨ EventBus
   - `runtime` fixtureï¼ˆsession çº§åˆ«ï¼‰ä¸åŒ…å« EventBus
   - æ˜¾å¼ä¾èµ–æ³¨å…¥ï¼Œæ¶æ„æ¸…æ™°

2. **äº‹ä»¶æ³¨å†Œä½ç½®**
   - HTTP: åœ¨ HttpEventPublisherMiddleware ä¸­ï¼ˆä¸­é—´ä»¶é“¾æœ€å†…å±‚ï¼‰
   - Web: åœ¨ BrowserManager._setup_event_listeners() ä¸­ï¼ˆç”± page fixture è°ƒç”¨ï¼‰

3. **é…ç½®åº”ç”¨ä½ç½®**
   - HTTP: HttpClient æ„é€ å‡½æ•°
   - Web: context fixtureï¼ˆåº”ç”¨ viewport/timeout/è§†é¢‘å½•åˆ¶ï¼‰

4. **å‘åå…¼å®¹**
   - ä¿ç•™ `get_event_bus()` å…¨å±€å‡½æ•°
   - ä¿ç•™ `set_test_event_bus()` å…¨å±€å‡½æ•°
   - BrowserManager ä¼˜å…ˆä½¿ç”¨ `runtime.event_bus`ï¼Œå›é€€åˆ° `get_event_bus()`

### äº‹ä»¶ç±»å‹

**HTTP äº‹ä»¶**:
- `HttpRequestStartEvent` - è¯·æ±‚å¼€å§‹
- `HttpRequestEndEvent` - è¯·æ±‚ç»“æŸ
- `HttpRequestErrorEvent` - è¯·æ±‚é”™è¯¯

**Web UI äº‹ä»¶**:
- `WebBrowserEvent` - æµè§ˆå™¨äº‹ä»¶ï¼ˆpage.load, network.request, console ç­‰ï¼‰
- `UIErrorEvent` - UI é”™è¯¯äº‹ä»¶ï¼ˆpageerror, crashï¼‰

---

## æ€»ç»“

### é—®é¢˜æ¾„æ¸…

| é—®é¢˜ | çŠ¶æ€ | ç»“è®º |
|------|------|------|
| å°è£…æ–¹å¼ä¸ä¸€è‡´ | âŒ è¯¯è§£ | ä¸¤è€…éƒ½åœ¨æ¡†æ¶å†…å®ç° |
| å·¥å‚æ¨¡å¼ä¸ä¸€è‡´ | âŒ è¯¯è§£ | ä¸¤è€…éƒ½æœ‰å·¥å‚æ¨¡å¼ |
| ç›®å½•å±‚çº§ä¸ä¸€è‡´ | âœ… æ­£å¸¸å·®å¼‚ | ä¸šåŠ¡é€»è¾‘ä¸åŒï¼Œæ·±åº¦è‡ªç„¶ä¸åŒ |

### å½“å‰æ¶æ„è¯„ä¼°

| ç»´åº¦ | HTTP Clients | Web Drivers | è¯„ä»· |
|------|--------------|-------------|------|
| **è®¾è®¡æ¨¡å¼** | Factory + Protocol + Provider | Factory + Protocol + Provider | âœ… ä¸€è‡´ |
| **é…ç½®é©±åŠ¨** | HTTPConfig + RuntimeContext | WebConfig + RuntimeContext | âœ… ä¸€è‡´ |
| **å°è£…æ–¹å¼** | æ¡†æ¶å†…å°è£… httpx | æ¡†æ¶å†…å°è£… playwright | âœ… ä¸€è‡´ |
| **ç›®å½•æ·±åº¦** | 4å±‚ | 3å±‚ | âœ… ç¬¦åˆä¸šåŠ¡é€»è¾‘ |
| **æ‰©å±•æ€§** | æ”¯æŒå¤šåè®®ï¼ˆREST/GraphQL/gRPCï¼‰ | æ”¯æŒå¤šå®ç°ï¼ˆPlaywright/Seleniumï¼‰ | âœ… éƒ½é¢„ç•™æ‰©å±• |
| **äº‹ä»¶ç³»ç»Ÿ** | runtime.event_bus + Middleware | runtime.event_bus + BrowserManager | âœ… ä¸€è‡´ |

### æ ¸å¿ƒç»“è®º

**æ¶æ„è®¾è®¡æ­£ç¡®æ€§** âœ…ï¼š
1. âœ… HTTP éœ€è¦åè®®å±‚ï¼ˆREST/GraphQL/gRPC æ˜¯ä¸åŒé€šä¿¡åè®®ï¼‰
2. âœ… Web ä¸éœ€è¦åè®®å±‚ï¼ˆweb/mobile/desktop æ˜¯è‡ªåŠ¨åŒ–ç±»å‹ï¼Œä¸æ˜¯åè®®ï¼‰
3. âœ… ç›®å½•æ·±åº¦å·®å¼‚æ˜¯**ä¸šåŠ¡é€»è¾‘å†³å®šçš„**ï¼Œä¸æ˜¯æ¶æ„é—®é¢˜
4. âœ… çœŸæ­£çš„ä¸€è‡´æ€§ä½“ç°åœ¨**è®¾è®¡æ¨¡å¼ã€é…ç½®é©±åŠ¨ã€ä½¿ç”¨æ–¹å¼**ï¼Œè€Œéç›®å½•æ·±åº¦

**æ¶æ„æ¼”è¿›å»ºè®®**:
- âœ… ä¿æŒå½“å‰æ¶æ„ä¸å˜
- âœ… æ–‡æ¡£ä¸­æ˜ç¡®è¯´æ˜ HTTP vs Web çš„ç»„ç»‡é€»è¾‘å·®å¼‚
- âœ… æœªæ¥æ‰©å±•æ—¶éµå¾ªç›¸åŒåŸåˆ™ï¼š
  - `clients/` æŒ‰é€šä¿¡åè®®åˆ†å±‚
  - `drivers/` æŒ‰è‡ªåŠ¨åŒ–ç±»å‹åˆ†å±‚

---

## é™„å½•ï¼šå®Œæ•´ç›®å½•ç»“æ„å¯¹æ¯”

### HTTP Clientsï¼ˆæŒ‰åè®®åˆ†å±‚ï¼‰

```
capabilities/clients/
â””â”€â”€ http/                    # HTTP é€šä¿¡
    â”œâ”€â”€ core/                # æ ¸å¿ƒæŠ½è±¡
    â”œâ”€â”€ middleware/          # ä¸­é—´ä»¶
    â”œâ”€â”€ rest/                # REST åè®® â† åè®®å±‚
    â”‚   â”œâ”€â”€ protocols.py
    â”‚   â”œâ”€â”€ factory.py
    â”‚   â”œâ”€â”€ httpx/           # httpx å®ç° â† å®ç°å±‚
    â”‚   â”‚   â””â”€â”€ client.py
    â”‚   â””â”€â”€ requests/        # requests å®ç°ï¼ˆé¢„ç•™ï¼‰
    â”œâ”€â”€ graphql/             # GraphQL åè®® â† åè®®å±‚
    â”‚   â””â”€â”€ gql/             # gql å®ç° â† å®ç°å±‚
    â””â”€â”€ grpc/                # gRPC åè®® â† åè®®å±‚
        â””â”€â”€ grpcio/          # grpcio å®ç° â† å®ç°å±‚
```

### Web Driversï¼ˆæŒ‰ç±»å‹åˆ†å±‚ï¼‰

```
capabilities/drivers/
â”œâ”€â”€ web/                     # æµè§ˆå™¨è‡ªåŠ¨åŒ– â† ç±»å‹å±‚
â”‚   â”œâ”€â”€ protocols.py
â”‚   â”œâ”€â”€ factory.py
â”‚   â”œâ”€â”€ playwright/          # Playwright å®ç° â† å®ç°å±‚
â”‚   â”‚   â”œâ”€â”€ browser.py
â”‚   â”‚   â”œâ”€â”€ page.py
â”‚   â”‚   â””â”€â”€ component.py
â”‚   â””â”€â”€ selenium/            # Selenium å®ç°ï¼ˆé¢„ç•™ï¼‰
â”œâ”€â”€ mobile/                  # ç§»åŠ¨ç«¯è‡ªåŠ¨åŒ– â† ç±»å‹å±‚ï¼ˆé¢„ç•™ï¼‰
â”‚   â””â”€â”€ appium/              # Appium å®ç° â† å®ç°å±‚
â””â”€â”€ desktop/                 # æ¡Œé¢åº”ç”¨è‡ªåŠ¨åŒ– â† ç±»å‹å±‚ï¼ˆé¢„ç•™ï¼‰
    â””â”€â”€ pywinauto/           # PyWinAuto å®ç° â† å®ç°å±‚
```

### å…³é”®å·®å¼‚æ€»ç»“

| ç»´åº¦ | HTTP Clients | Web Drivers |
|------|--------------|-------------|
| **ä¸­é—´å±‚å«ä¹‰** | é€šä¿¡åè®®ï¼ˆREST/GraphQL/gRPCï¼‰ | è‡ªåŠ¨åŒ–ç±»å‹ï¼ˆweb/mobile/desktopï¼‰ |
| **ä¸­é—´å±‚å¿…è¦æ€§** | âœ… å¿…è¦ï¼ˆåè®®æ ‡å‡†ä¸åŒï¼‰ | âœ… å¿…è¦ï¼ˆç›®æ ‡å¹³å°ä¸åŒï¼‰ |
| **å¶å­å±‚å«ä¹‰** | å®ç°å·¥å…·ï¼ˆhttpx/requestsï¼‰ | å®ç°å·¥å…·ï¼ˆplaywright/seleniumï¼‰ |
| **ç›®å½•æ·±åº¦** | 4å±‚ | 3å±‚ |
| **æ·±åº¦å·®å¼‚åŸå› ** | å¤šäº†ä¸€å±‚åè®®æ ‡å‡† | ç±»å‹å±‚ç›´æ¥å¯¹åº”ç›®æ ‡å¹³å° |

---

**æ–‡æ¡£ç»´æŠ¤è€…**: DF Test Framework Team
**æœ€åæ›´æ–°**: 2026-01-12
**ç‰ˆæœ¬**: v3.44.0
