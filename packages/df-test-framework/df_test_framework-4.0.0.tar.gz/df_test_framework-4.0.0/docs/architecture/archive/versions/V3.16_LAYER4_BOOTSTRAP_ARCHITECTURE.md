# DF Test Framework v3.16.0 æ¶æ„é‡æ„è®¾è®¡

> **çŠ¶æ€**: ğŸ“ è®¾è®¡æ–¹æ¡ˆ â†’ å®æ–½ä¸­
> **ä½œè€…**: Claude Code
> **æ—¥æœŸ**: 2025-12-05
> **ç›®æ ‡ç‰ˆæœ¬**: v3.16.0

---

## 1. è®¾è®¡èƒŒæ™¯

### 1.1 é—®é¢˜åˆ†æ

v3.14.0 æ¶æ„å­˜åœ¨ä»¥ä¸‹æ ¸å¿ƒé—®é¢˜ï¼š

| é—®é¢˜ç±»å‹ | å…·ä½“è¡¨ç° | ä¸¥é‡ç¨‹åº¦ |
|---------|---------|---------|
| **ä¾èµ–è¿è§„** | `infrastructure/` â†’ `capabilities/`ï¼ˆLayer 1 ä¾èµ– Layer 2ï¼‰| ğŸ”´ ä¸¥é‡ |
| **ä¾èµ–è¿è§„** | `capabilities/` â†’ `testing/`ï¼ˆLayer 2 ä¾èµ– Layer 3ï¼‰| ğŸ”´ ä¸¥é‡ |
| **èŒè´£æ··ä¹±** | `bootstrap/`ã€`providers/`ã€`runtime/` éœ€è¦ç»„è£…æ‰€æœ‰å±‚ï¼Œä½†è¢«æ”¾åœ¨ Layer 1 | ğŸŸ  ä¸­ç­‰ |
| **åºŸå¼ƒæ¨¡å—** | `common/`ã€`extensions/` ä»å­˜åœ¨ï¼Œä¸æ–°æ¨¡å—é‡å¤ | ğŸŸ¡ è½»å¾® |
| **å½’å±ä¸æ˜** | `models/`ã€`utils/` ä¸åœ¨è®¾è®¡æ–‡æ¡£çš„å±‚çº§ä¸­ | ğŸŸ¡ è½»å¾® |

### 1.2 é—®é¢˜æ ¹æº

```
å½“å‰è®¾è®¡è§„åˆ™ï¼š
Layer 1 (infrastructure)   â”€â”€â–º åªèƒ½ä¾èµ– Layer 0

ä½† bootstrap/ å’Œ providers/ çš„å®é™…èŒè´£æ˜¯ï¼š
- åˆ›å»º HttpClient, Database, RedisClient å®ä¾‹ï¼ˆLayer 2ï¼‰
- ç»„è£…æ•´ä¸ªæ¡†æ¶çš„è¿è¡Œæ—¶ç¯å¢ƒï¼ˆéœ€è¦æ‰€æœ‰å±‚ï¼‰

è¿™æ˜¯æœ¬è´¨çŸ›ç›¾ï¼
```

### 1.3 æˆç†Ÿæ¡†æ¶çš„åšæ³•

| æ¡†æ¶ | ç»„è£…å±‚ä½ç½® | æ ¸å¿ƒç‰¹ç‚¹ |
|-----|-----------|---------|
| **Clean Architecture** | æœ€å¤–å±‚ï¼ˆFrameworks & Driversï¼‰| ç»„è£…å±‚å¯ä¾èµ–æ‰€æœ‰å±‚ |
| **Spring Boot** | Application Layer (Main) | `@SpringBootApplication` æ˜¯æœ€å¤–å±‚ |
| **NestJS** | AppModule | æ ¹æ¨¡å—ç»„è£…æ‰€æœ‰æ¨¡å— |
| **pytest** | conftest.py + fixtures | é€šè¿‡æ’ä»¶æœºåˆ¶åŠ è½½ |

**å…³é”®æ´å¯Ÿ**ï¼šåœ¨æ‰€æœ‰æˆç†Ÿæ¶æ„ä¸­ï¼Œ"ç»„è£…å±‚" æ€»æ˜¯å¤„äºæœ€å¤–å±‚ï¼Œå¯ä»¥ä¾èµ–æ‰€æœ‰å…¶ä»–å±‚ã€‚

### 1.4 æµ‹è¯•æ¡†æ¶çš„ç‰¹æ®Šæ€§

| ç±»å‹ | å…¥å£ | ç»„è£…æ–¹å¼ |
|-----|-----|---------|
| **Web åº”ç”¨** | `app.py` / `main.py` | å¯åŠ¨ä¸€ä¸ªé•¿è¿è¡ŒæœåŠ¡ |
| **æµ‹è¯•æ¡†æ¶** | `pytest` å‘½ä»¤ | pytest æ’ä»¶æœºåˆ¶è‡ªåŠ¨åŠ è½½ |

**æµ‹è¯•æ¡†æ¶æ²¡æœ‰ `app.py`**ï¼ç”¨æˆ·é€šè¿‡ `pytest` è¿è¡Œæµ‹è¯•ï¼Œæ¡†æ¶é€šè¿‡ `conftest.py` å’Œ fixtures è¢«åŠ è½½ã€‚

---

## 2. æ–°æ¶æ„è®¾è®¡

### 2.1 äº”å±‚æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Layer 4: Bootstrap (å¼•å¯¼å±‚)                             â”‚
â”‚                           bootstrap/                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚    bootstrap.py   â”‚  â”‚    providers.py   â”‚  â”‚      runtime.py       â”‚   â”‚
â”‚  â”‚   æ¡†æ¶åˆå§‹åŒ–å…¥å£    â”‚  â”‚   æœåŠ¡å·¥å‚æ³¨å†Œ     â”‚  â”‚    è¿è¡Œæ—¶ä¸Šä¸‹æ–‡ç®¡ç†    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                         å¯ä¾èµ– Layer 0-3 å…¨éƒ¨                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                       â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       Layer 3: Facades (é—¨é¢å±‚)                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚           testing/              â”‚  â”‚             cli/                â”‚  â”‚
â”‚  â”‚   fixtures, data, mocking,      â”‚  â”‚    è„šæ‰‹æ¶, ä»£ç ç”Ÿæˆ, å‘½ä»¤è¡Œå·¥å…·   â”‚  â”‚
â”‚  â”‚   assertions, reporting         â”‚  â”‚                                 â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                         å¯ä¾èµ– Layer 0-2                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                       â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       Layer 2: Capabilities (èƒ½åŠ›å±‚)                         â”‚
â”‚                          capabilities/                                      â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚    â”‚ clients â”‚ â”‚databases â”‚ â”‚messengersâ”‚ â”‚ storages â”‚ â”‚ drivers â”‚          â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                         å¯ä¾èµ– Layer 0-1                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                       â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Layer 1: Infrastructure (åŸºç¡€è®¾æ–½)                      â”‚
â”‚                         infrastructure/                                     â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚    â”‚ config â”‚ â”‚logging â”‚ â”‚telemetry â”‚ â”‚ events â”‚ â”‚ plugins â”‚               â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                         åªèƒ½ä¾èµ– Layer 0                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                       â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       Layer 0: Core (æ ¸å¿ƒæŠ½è±¡)                               â”‚
â”‚                              core/                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚middlewareâ”‚ â”‚ context â”‚ â”‚ events  â”‚ â”‚  types â”‚ â”‚protocolsâ”‚ â”‚exceptions â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                         æ— ä¾èµ–ï¼ˆæœ€åº•å±‚ï¼‰                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                    â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
                    â•‘      æ¨ªåˆ‡å…³æ³¨ç‚¹ (Cross-Cutting)        â•‘
                    â•‘              plugins/                 â•‘
                    â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

### 2.2 ä¾èµ–è§„åˆ™

```
Layer 4 (bootstrap/)           â”€â”€â–º å¯ä¾èµ– Layer 0-3 å…¨éƒ¨ï¼ˆå¼•å¯¼å±‚ç‰¹æƒï¼‰
    â”‚
Layer 3 (testing/ + cli/)      â”€â”€â–º å¯ä¾èµ– Layer 0-2ï¼ˆé—¨é¢å±‚ï¼Œå¹¶è¡Œï¼‰
    â”‚
Layer 2 (capabilities/)        â”€â”€â–º å¯ä¾èµ– Layer 0-1
    â”‚
Layer 1 (infrastructure/)      â”€â”€â–º åªèƒ½ä¾èµ– Layer 0
    â”‚
Layer 0 (core/)                â”€â”€â–º æ— ä¾èµ–ï¼ˆæœ€åº•å±‚ï¼‰

plugins/ (æ¨ªåˆ‡å…³æ³¨ç‚¹)           â”€â”€â–º å¯ä¾èµ–ä»»æ„å±‚çº§
```

### 2.3 ä¾èµ–çŸ©é˜µ

| å±‚çº§ | ç›®å½• | å¯ä¾èµ– | ç¦æ­¢ä¾èµ– |
|-----|-----|-------|---------|
| **Layer 0** | `core/` | æ—  | - |
| **Layer 1** | `infrastructure/` | `core/` | `capabilities/` åŠä»¥ä¸Š |
| **Layer 2** | `capabilities/` | `core/`, `infrastructure/` | `testing/`, `cli/`, `bootstrap/` |
| **Layer 3** | `testing/` | `core/`, `infrastructure/`, `capabilities/` | `cli/`, `bootstrap/` |
| **Layer 3** | `cli/` | `core/`, `infrastructure/`, `capabilities/` | `testing/`, `bootstrap/` |
| **Layer 4** | `bootstrap/` | **æ‰€æœ‰å±‚** (0-3) | - |
| **æ¨ªåˆ‡** | `plugins/` | **ä»»æ„å±‚çº§** | - |

---

## 3. ç›®å½•ç»“æ„

### 3.1 å®Œæ•´ç›®å½•ç»“æ„

```
src/df_test_framework/
â”‚
â”œâ”€â”€ core/                          # Layer 0: æ ¸å¿ƒæŠ½è±¡ï¼ˆæ— ç¬¬ä¸‰æ–¹ä¾èµ–ï¼‰
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ protocols/                 # æ¥å£å®šä¹‰
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ client.py              # IHttpClient, IGrpcClient
â”‚   â”‚   â”œâ”€â”€ database.py            # IDatabase, IRepository
â”‚   â”‚   â”œâ”€â”€ telemetry.py           # ITelemetry
â”‚   â”‚   â”œâ”€â”€ event.py               # IEventBus
â”‚   â”‚   â””â”€â”€ plugin.py              # IPluginManager
â”‚   â”œâ”€â”€ middleware/                # ä¸­é—´ä»¶ç³»ç»Ÿ
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ protocol.py
â”‚   â”‚   â”œâ”€â”€ chain.py
â”‚   â”‚   â”œâ”€â”€ base.py
â”‚   â”‚   â””â”€â”€ decorator.py
â”‚   â”œâ”€â”€ context/                   # ä¸Šä¸‹æ–‡æŠ½è±¡
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ execution.py
â”‚   â”‚   â””â”€â”€ propagation.py
â”‚   â”œâ”€â”€ events/                    # äº‹ä»¶ç±»å‹å®šä¹‰
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â””â”€â”€ types.py
â”‚   â”œâ”€â”€ exceptions.py              # å¼‚å¸¸ä½“ç³»
â”‚   â””â”€â”€ types.py                   # åŸºç¡€ç±»å‹
â”‚
â”œâ”€â”€ infrastructure/                # Layer 1: åŸºç¡€è®¾æ–½å®ç°
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ config/                    # é…ç½®ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ schema.py
â”‚   â”‚   â”œâ”€â”€ sources.py
â”‚   â”‚   â””â”€â”€ manager.py
â”‚   â”œâ”€â”€ logging/                   # æ—¥å¿—ç³»ç»Ÿ
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ config.py
â”‚   â”‚   â””â”€â”€ handlers.py
â”‚   â”œâ”€â”€ telemetry/                 # å¯è§‚æµ‹æ€§
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ facade.py
â”‚   â”‚   â”œâ”€â”€ tracer.py
â”‚   â”‚   â””â”€â”€ meter.py
â”‚   â”œâ”€â”€ events/                    # EventBus å®ç°
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â””â”€â”€ bus.py
â”‚   â”œâ”€â”€ plugins/                   # PluginManager å®ç°
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ hooks.py
â”‚   â”‚   â”œâ”€â”€ manager.py
â”‚   â”‚   â””â”€â”€ discovery.py
â”‚   â””â”€â”€ context/                   # ä¸Šä¸‹æ–‡è½½ä½“
â”‚       â”œâ”€â”€ __init__.py
â”‚       â””â”€â”€ carriers/
â”‚           â”œâ”€â”€ __init__.py
â”‚           â”œâ”€â”€ http.py
â”‚           â”œâ”€â”€ grpc.py
â”‚           â””â”€â”€ mq.py
â”‚
â”œâ”€â”€ capabilities/                  # Layer 2: èƒ½åŠ›å±‚
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ clients/                   # HTTP/gRPC/GraphQL
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ http/
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ core/
â”‚   â”‚   â”‚   â”œâ”€â”€ rest/
â”‚   â”‚   â”‚   â””â”€â”€ middleware/
â”‚   â”‚   â”œâ”€â”€ grpc/
â”‚   â”‚   â””â”€â”€ graphql/
â”‚   â”œâ”€â”€ databases/                 # SQL/Redis/Repository/UoW
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ database.py
â”‚   â”‚   â”œâ”€â”€ uow.py
â”‚   â”‚   â”œâ”€â”€ repositories/
â”‚   â”‚   â””â”€â”€ redis/
â”‚   â”œâ”€â”€ messengers/                # Kafka/RabbitMQ/RocketMQ
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ kafka/
â”‚   â”‚   â”œâ”€â”€ rabbitmq/
â”‚   â”‚   â””â”€â”€ rocketmq/
â”‚   â”œâ”€â”€ storages/                  # S3/OSS/LocalFile
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ s3/
â”‚   â”‚   â”œâ”€â”€ oss/
â”‚   â”‚   â””â”€â”€ local/
â”‚   â”œâ”€â”€ drivers/                   # Playwright/Selenium
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â””â”€â”€ web/
â”‚   â””â”€â”€ engines/                   # é¢„ç•™
â”‚       â””â”€â”€ __init__.py
â”‚
â”œâ”€â”€ testing/                       # Layer 3: é—¨é¢å±‚ - æµ‹è¯•
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ fixtures/                  # pytest fixtures
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ core.py
â”‚   â”‚   â”œâ”€â”€ cleanup.py
â”‚   â”‚   â”œâ”€â”€ ui.py
â”‚   â”‚   â””â”€â”€ mq.py
â”‚   â”œâ”€â”€ data/                      # æµ‹è¯•æ•°æ®å·¥å…·
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ factories/
â”‚   â”‚   â”œâ”€â”€ builders/
â”‚   â”‚   â”œâ”€â”€ loaders/
â”‚   â”‚   â””â”€â”€ generators.py
â”‚   â”œâ”€â”€ mocking/                   # Mock å·¥å…·
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ http.py
â”‚   â”‚   â”œâ”€â”€ database.py
â”‚   â”‚   â””â”€â”€ redis.py
â”‚   â”œâ”€â”€ assertions/                # æ–­è¨€å·¥å…·
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â””â”€â”€ response.py
â”‚   â”œâ”€â”€ debugging/                 # è°ƒè¯•å·¥å…·
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ http.py
â”‚   â”‚   â””â”€â”€ database.py
â”‚   â””â”€â”€ reporting/                 # æŠ¥å‘Šé›†æˆ
â”‚       â”œâ”€â”€ __init__.py
â”‚       â””â”€â”€ allure/
â”‚
â”œâ”€â”€ cli/                           # Layer 3: é—¨é¢å±‚ - CLI
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ main.py
â”‚   â”œâ”€â”€ commands/
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ init.py
â”‚   â”‚   â””â”€â”€ generate.py
â”‚   â””â”€â”€ templates/
â”‚       â”œâ”€â”€ project/
â”‚       â””â”€â”€ generators/
â”‚
â”œâ”€â”€ bootstrap/                     # Layer 4: å¼•å¯¼å±‚ âœ¨ æ–°å¢
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ bootstrap.py               # æ¡†æ¶åˆå§‹åŒ–
â”‚   â”œâ”€â”€ providers.py               # æœåŠ¡å·¥å‚
â”‚   â””â”€â”€ runtime.py                 # è¿è¡Œæ—¶ä¸Šä¸‹æ–‡
â”‚
â”œâ”€â”€ plugins/                       # æ¨ªåˆ‡å…³æ³¨ç‚¹
â”‚   â”œâ”€â”€ __init__.py
â”‚   â””â”€â”€ builtin/
â”‚       â”œâ”€â”€ __init__.py
â”‚       â”œâ”€â”€ monitoring/
â”‚       â””â”€â”€ reporting/
â”‚
â””â”€â”€ __init__.py                    # é¡¶å±‚å¯¼å‡º
```

### 3.2 å„å±‚èŒè´£

#### Layer 0: Coreï¼ˆæ ¸å¿ƒæŠ½è±¡ï¼‰

çº¯ Python æŠ½è±¡ï¼Œ**æ— ç¬¬ä¸‰æ–¹ä¾èµ–**

| æ¨¡å— | èŒè´£ |
|-----|-----|
| `protocols/` | æ¥å£å®šä¹‰ï¼ˆIHttpClient, IDatabase, ITelemetry...ï¼‰ |
| `middleware/` | ä¸­é—´ä»¶åè®®ï¼ˆMiddleware[T,R], MiddlewareChainï¼‰ |
| `context/` | ä¸Šä¸‹æ–‡æŠ½è±¡ï¼ˆExecutionContextï¼‰ |
| `events/` | äº‹ä»¶ç±»å‹å®šä¹‰ |
| `exceptions.py` | å¼‚å¸¸ä½“ç³» |
| `types.py` | åŸºç¡€ç±»å‹ã€æšä¸¾ |

#### Layer 1: Infrastructureï¼ˆåŸºç¡€è®¾æ–½ï¼‰

æ¡†æ¶è¿è¡Œæ‰€éœ€çš„åŸºç¡€æœåŠ¡å®ç°

| æ¨¡å— | èŒè´£ |
|-----|-----|
| `config/` | é…ç½®ç®¡ç†ï¼ˆSettings, ConfigManagerï¼‰ |
| `logging/` | æ—¥å¿—ç³»ç»Ÿ |
| `telemetry/` | å¯è§‚æµ‹æ€§ï¼ˆTracing + Metricsï¼‰ |
| `events/` | EventBus å®ç° |
| `plugins/` | PluginManager å®ç° |
| `context/carriers/` | ä¸Šä¸‹æ–‡è½½ä½“ï¼ˆHTTP/gRPC/MQï¼‰ |

#### Layer 2: Capabilitiesï¼ˆèƒ½åŠ›å±‚ï¼‰

ä¸å¤–éƒ¨ç³»ç»Ÿäº¤äº’çš„å…·ä½“èƒ½åŠ›

| æ¨¡å— | èŒè´£ |
|-----|-----|
| `clients/` | HTTP/gRPC/GraphQL å®¢æˆ·ç«¯ |
| `databases/` | SQL/Redis/Repository/UoW |
| `messengers/` | Kafka/RabbitMQ/RocketMQ |
| `storages/` | S3/OSS/LocalFile |
| `drivers/` | Playwright/Selenium |
| `engines/` | Spark/Flinkï¼ˆé¢„ç•™ï¼‰ |

#### Layer 3: Facadesï¼ˆé—¨é¢å±‚ï¼‰

ä¸ºç”¨æˆ·æä¾›æ˜“ç”¨çš„æ¥å£

| æ¨¡å— | èŒè´£ |
|-----|-----|
| `testing/` | pytest é›†æˆï¼šfixtures, data, mocking, assertions, reporting |
| `cli/` | å‘½ä»¤è¡Œå·¥å…·ï¼šè„šæ‰‹æ¶ã€ä»£ç ç”Ÿæˆ |

#### Layer 4: Bootstrapï¼ˆå¼•å¯¼å±‚ï¼‰

æ¡†æ¶çš„ç»„è£…å’Œåˆå§‹åŒ–

| æ¨¡å— | èŒè´£ |
|-----|-----|
| `bootstrap.py` | æ¡†æ¶åˆå§‹åŒ–å…¥å£ |
| `providers.py` | æœåŠ¡å·¥å‚ï¼ˆåˆ›å»º HttpClient, Database ç­‰ï¼‰ |
| `runtime.py` | RuntimeContext ç®¡ç† |

---

## 4. åŠŸèƒ½å½’å±è¡¨

| åŠŸèƒ½ | å½’å±å±‚ | å½’å±æ¨¡å— |
|-----|-------|---------|
| æ¥å£/åè®®å®šä¹‰ | Layer 0 | `core/protocols/` |
| ä¸­é—´ä»¶åè®® | Layer 0 | `core/middleware/` |
| ä¸Šä¸‹æ–‡æŠ½è±¡ | Layer 0 | `core/context/` |
| äº‹ä»¶ç±»å‹ | Layer 0 | `core/events/` |
| å¼‚å¸¸ä½“ç³» | Layer 0 | `core/exceptions.py` |
| åŸºç¡€ç±»å‹ | Layer 0 | `core/types.py` |
| é…ç½®ç®¡ç† | Layer 1 | `infrastructure/config/` |
| æ—¥å¿—ç³»ç»Ÿ | Layer 1 | `infrastructure/logging/` |
| å¯è§‚æµ‹æ€§ | Layer 1 | `infrastructure/telemetry/` |
| äº‹ä»¶æ€»çº¿å®ç° | Layer 1 | `infrastructure/events/` |
| æ’ä»¶ç®¡ç†å®ç° | Layer 1 | `infrastructure/plugins/` |
| HTTP å®¢æˆ·ç«¯ | Layer 2 | `capabilities/clients/http/` |
| HTTP ä¸­é—´ä»¶ | Layer 2 | `capabilities/clients/http/middleware/` |
| æ•°æ®åº“ | Layer 2 | `capabilities/databases/` |
| Redis | Layer 2 | `capabilities/databases/redis/` |
| æ¶ˆæ¯é˜Ÿåˆ— | Layer 2 | `capabilities/messengers/` |
| å­˜å‚¨ | Layer 2 | `capabilities/storages/` |
| UI é©±åŠ¨ | Layer 2 | `capabilities/drivers/` |
| pytest fixtures | Layer 3 | `testing/fixtures/` |
| æµ‹è¯•æ•°æ®å·¥å…· | Layer 3 | `testing/data/` |
| Mock å·¥å…· | Layer 3 | `testing/mocking/` |
| æ–­è¨€å·¥å…· | Layer 3 | `testing/assertions/` |
| æŠ¥å‘Šé›†æˆ | Layer 3 | `testing/reporting/` |
| CLI å‘½ä»¤ | Layer 3 | `cli/commands/` |
| è„šæ‰‹æ¶æ¨¡æ¿ | Layer 3 | `cli/templates/` |
| æ¡†æ¶åˆå§‹åŒ– | Layer 4 | `bootstrap/bootstrap.py` |
| æœåŠ¡å·¥å‚ | Layer 4 | `bootstrap/providers.py` |
| è¿è¡Œæ—¶ä¸Šä¸‹æ–‡ | Layer 4 | `bootstrap/runtime.py` |
| å†…ç½®æ’ä»¶ | æ¨ªåˆ‡ | `plugins/builtin/` |

---

## 5. è¿ç§»è®¡åˆ’

### 5.1 è¿ç§»æ¸…å•

| ä¼˜å…ˆçº§ | è¿ç§»é¡¹ | ä» | åˆ° | çŠ¶æ€ | è¯´æ˜ |
|-------|-------|-----|-----|------|-----|
| P0 | Bootstrap | `infrastructure/bootstrap/` | `bootstrap/` | âœ… å®Œæˆ | æå‡ä¸º Layer 4 |
| P0 | Providers | `infrastructure/providers/` | `bootstrap/providers.py` | âœ… å®Œæˆ | æå‡ä¸º Layer 4 |
| P0 | Runtime | `infrastructure/runtime/` | `bootstrap/runtime.py` | âœ… å®Œæˆ | æå‡ä¸º Layer 4 |
| P1 | common/ | `common/` | åˆ é™¤ | âœ… å®Œæˆ | å·²è¿ç§»åˆ° `core/` |
| P1 | extensions/core | `extensions/core` | åˆ é™¤ | âœ… å®Œæˆ | æ”¹ç”¨ `infrastructure.plugins` |
| P1 | extensions/builtin | `extensions/builtin` | ä¿ç•™ | âš ï¸ éƒ¨åˆ† | ç›‘æ§åŠŸèƒ½æœªå®Œå…¨è¿ç§» |
| P2 | models/ | `models/` | ä¿ç•™ | âœ… å®Œæˆ | è¯„ä¼°åå†³å®šä¿ç•™ç°çŠ¶ |
| P2 | utils/ | `utils/` | ä¿ç•™ | âœ… å®Œæˆ | ä½œä¸ºè¾…åŠ©å·¥å…·å±‚ä¿ç•™ |

### 5.2 å¯¼å…¥è·¯å¾„å˜æ›´

```python
# v3.14.0 å¯¼å…¥ï¼ˆæ—§ï¼‰
from df_test_framework.infrastructure.bootstrap import Bootstrap
from df_test_framework.infrastructure.providers import ProviderRegistry
from df_test_framework.infrastructure.runtime import RuntimeContext

# v3.16.0 å¯¼å…¥ï¼ˆæ–°ï¼‰
from df_test_framework.bootstrap import Bootstrap
from df_test_framework.bootstrap import ProviderRegistry
from df_test_framework.bootstrap import RuntimeContext

# é¡¶å±‚ä¾¿æ·å¯¼å…¥ï¼ˆæ¨èï¼‰
from df_test_framework import Bootstrap, ProviderRegistry, RuntimeContext
```

---

## 6. å®æ–½æ­¥éª¤

### Phase 1: åˆ›å»º bootstrap/ å±‚ï¼ˆP0ï¼‰âœ… **å·²å®Œæˆ**

1. âœ… åˆ›å»º `bootstrap/` ç›®å½•
2. âœ… è¿ç§» `infrastructure/bootstrap/` â†’ `bootstrap/bootstrap.py`
3. âœ… è¿ç§» `infrastructure/providers/` â†’ `bootstrap/providers.py`
4. âœ… è¿ç§» `infrastructure/runtime/` â†’ `bootstrap/runtime.py`
5. âœ… æ›´æ–°æ‰€æœ‰å¯¼å…¥è·¯å¾„
6. âŒ åœ¨ `infrastructure/` æ·»åŠ åºŸå¼ƒè­¦å‘Šå…¼å®¹å±‚ï¼ˆè·³è¿‡ï¼Œç›´æ¥åˆ é™¤ï¼‰

**å®Œæˆæ—¶é—´**: v3.16.0
**æµ‹è¯•çŠ¶æ€**: 1143 passed, 48 skipped
**è¯´æ˜**: ç”¨æˆ·è¦æ±‚è·³è¿‡å‘åå…¼å®¹å±‚ï¼Œç›´æ¥åˆ é™¤æ—§ä»£ç 

### Phase 2: æ¸…ç†åºŸå¼ƒæ¨¡å—ï¼ˆP1ï¼‰âœ… **å·²å®Œæˆ**

1. âœ… ç§»é™¤ `common/`ï¼ˆæ›´æ–°7ä¸ªæºæ–‡ä»¶ + 4ä¸ªæµ‹è¯•æ–‡ä»¶çš„å¯¼å…¥ï¼‰
2. âœ… ç§»é™¤ `extensions/core`ï¼ˆä¿ç•™ `extensions/builtin` - ç›‘æ§åŠŸèƒ½æœªå®Œå…¨è¿ç§»ï¼‰
3. âœ… æ›´æ–°æ–‡æ¡£å’Œå¯¼å…¥

**å®Œæˆæ—¶é—´**: v3.16.0
**è¯¦ç»†æ›´æ”¹**:
- `common/` â†’ åˆ é™¤ï¼Œæ‰€æœ‰å¼•ç”¨æ”¹ä¸º `core/`
- `extensions/core` â†’ åˆ é™¤ï¼Œæ”¹ç”¨ `infrastructure.plugins.PluggyPluginManager`
- `extensions/builtin` â†’ æš‚æ—¶ä¿ç•™ï¼ˆ`APIPerformanceTracker`, `SlowQueryMonitor`ï¼‰

### Phase 3: ä¼˜åŒ–ç»“æ„ï¼ˆP2ï¼‰âœ… **å·²å®Œæˆ**

1. âœ… è¯„ä¼° `models/` å½’å±
   - **ç»“è®º**: `models/` ä»…ä½œä¸ºèšåˆå±‚ï¼Œé‡æ–°å¯¼å‡º `core.types`
   - **å»ºè®®**: æœªæ¥å¯è€ƒè™‘ç§»å…¥ `core/models.py`ï¼Œå½“å‰ä¿æŒä¸å˜

2. âœ… è¯„ä¼° `utils/` å½’å±
   - **ç»“è®º**: `utils/` å±äºè¾…åŠ©å·¥å…·å±‚ï¼ŒåŠŸèƒ½ç‹¬ç«‹
   - **å†³å®š**: ä¿ç•™ç°æœ‰ä½ç½®

3. âš ï¸ æ·»åŠ ä¾èµ–æ£€æŸ¥å·¥å…·ï¼ˆimport-linterï¼‰
   - **çŠ¶æ€**: å¯é€‰å¢å¼ºé¡¹ï¼Œæš‚æœªå®æ–½

4. âœ… æ›´æ–°æ¶æ„æ–‡æ¡£

**å®Œæˆæ—¶é—´**: v3.16.0

---

## 7. éªŒè¯æ–¹æ³•

### 7.1 ä¾èµ–æ£€æŸ¥

```bash
# ä½¿ç”¨ import-linter æ£€æŸ¥ä¾èµ–è§„åˆ™
uv run pip install import-linter
uv run lint-imports
```

### 7.2 æµ‹è¯•éªŒè¯

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•ç¡®ä¿è¿ç§»ä¸ç ´ååŠŸèƒ½
uv run pytest -v

# æ’é™¤éœ€è¦å¤–éƒ¨æœåŠ¡çš„æµ‹è¯•
uv run pytest -v --ignore=tests/test_messengers/
```

---

## 8. æ€»ç»“

| é—®é¢˜ | è§£å†³æ–¹æ¡ˆ |
|-----|---------|
| `infrastructure/` ä¾èµ– `capabilities/` | å°† `bootstrap/`ã€`providers/`ã€`runtime/` æå‡ä¸ºç‹¬ç«‹çš„ Layer 4 |
| `capabilities/` ä¾èµ– `testing/` | ä½¿ç”¨äº‹ä»¶ç³»ç»Ÿè§£è€¦ |
| å±‚çº§å®šä¹‰ä¸æ¸…æ™° | å¼•å…¥ Layer 4ï¼ˆå¼•å¯¼å±‚ï¼‰ï¼Œæ˜ç¡®å„å±‚èŒè´£ |
| åºŸå¼ƒæ¨¡å—æœªæ¸…ç† | åœ¨ v3.16.0 å½»åº•ç§»é™¤ `common/`ã€`extensions/` |

**æ ¸å¿ƒåŸåˆ™**ï¼š

1. **å¼•å¯¼å±‚å¿…é¡»åœ¨æœ€é¡¶å±‚** - `bootstrap/` å¯ä»¥ä¾èµ–æ‰€æœ‰å±‚
2. **ä½å±‚ä¸ä¾èµ–é«˜å±‚** - `infrastructure/` ç»ä¸èƒ½ä¾èµ– `capabilities/`
3. **è§£è€¦ç”¨äº‹ä»¶** - è·¨å±‚é€šä¿¡ä½¿ç”¨ EventBus
4. **æ¨ªåˆ‡ç”¨æ’ä»¶** - `plugins/` ä½œä¸ºæ¨ªåˆ‡å…³æ³¨ç‚¹å¯ä¾èµ–ä»»æ„å±‚
