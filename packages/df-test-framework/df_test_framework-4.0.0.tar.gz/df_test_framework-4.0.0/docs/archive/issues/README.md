# 问题记录归档

本目录存放框架开发过程中遇到的问题和解决方案。

## 📋 问题分类

### 1. 循环导入问题

**问题描述**: 模块间相互导入导致ImportError

**涉及模块**:
- `infrastructure/runtime.py` ↔ `extensions/core/hooks.py`
- `infrastructure/logging.py` ↔ `infrastructure/runtime.py`

**解决方案**:
- 使用`TYPE_CHECKING`条件导入
- 延迟导入
- 重构依赖关系

**详细记录**: [问题汇总](summary.md#循环导入问题)

### 2. 类型检查问题

**问题描述**: mypy类型检查失败

**常见错误**:
- 泛型类型参数不匹配
- Protocol实现不完整
- 类型注解缺失

**解决方案**:
- 添加完整的类型注解
- 使用`typing.Protocol`定义接口
- 正确使用泛型`Generic[T]`

**详细记录**: [问题汇总](summary.md#类型检查问题)

### 3. 配置管理问题

**问题描述**: Pydantic v1升级到v2的兼容性问题

**主要变更**:
- `class Config` → `model_config`
- `dict()` → `model_dump()`
- `parse_obj()` → `model_validate()`

**解决方案**:
- 更新配置语法
- 使用v2 API
- 添加迁移脚本

**详细记录**: [问题汇总](summary.md#配置管理问题)

### 4. 扩展系统问题

**问题描述**: 旧的监控系统难以维护和测试

**旧系统问题**:
- 紧耦合
- 难以测试
- 扩展性差

**解决方案**:
- 重构为pluggy插件系统
- 定义标准Hook接口
- 提供内置扩展示例

**详细记录**: [问题汇总](summary.md#扩展系统问题)

### 5. 性能问题

**问题描述**: 大量测试时性能下降

**瓶颈**:
- 数据库连接未复用
- HTTP连接未使用连接池
- 配置重复加载

**解决方案**:
- 使用SQLAlchemy连接池
- httpx连接池配置
- 单例模式缓存配置

**详细记录**: [问题汇总](summary.md#性能优化)

## 📊 问题统计

### 按类型统计

| 类型 | 数量 | 已解决 | 进行中 |
|------|------|--------|--------|
| 循环导入 | 5 | 5 | 0 |
| 类型检查 | 8 | 8 | 0 |
| 配置管理 | 6 | 6 | 0 |
| 扩展系统 | 4 | 4 | 0 |
| 性能优化 | 7 | 7 | 0 |
| **总计** | **30** | **30** | **0** |

### 按严重程度

| 严重程度 | 数量 | 说明 |
|----------|------|------|
| 🔴 严重 | 3 | 阻塞开发 |
| 🟡 中等 | 15 | 影响功能 |
| 🟢 轻微 | 12 | 可绕过 |

## 🔍 如何使用问题记录

### 1. 遇到类似问题时

1. 在[问题汇总](summary.md)中搜索关键字
2. 查看相关问题的解决方案
3. 应用解决方案到当前问题

### 2. 记录新问题时

1. 在`summary.md`中添加问题描述
2. 包含错误信息、复现步骤、解决方案
3. 更新本README的统计数据

### 3. 学习最佳实践

1. 查看已解决问题的模式
2. 了解常见陷阱
3. 应用到新代码中

## 📝 问题模板

记录新问题时请使用以下模板：

```markdown
### 问题：[简短描述]

**分类**: 循环导入/类型检查/配置管理/扩展系统/性能

**严重程度**: 🔴严重/🟡中等/🟢轻微

**问题描述**:
[详细描述问题现象]

**错误信息**:
```
[粘贴错误日志]
```

**复现步骤**:
1. 第一步
2. 第二步
3. ...

**根本原因**:
[分析问题根源]

**解决方案**:
[描述解决方法]

**代码示例**:
```python
# 修复前
...

# 修复后
...
```

**验证方法**:
[如何验证问题已解决]

**预防措施**:
[如何避免类似问题]
```

## 🔗 相关资源

### 内部文档
- [问题汇总详情](summary.md)
- [v1架构问题](../v1/README.md)
- [迁移指南](../../migration/from-v1-to-v2.md)

### 外部资源
- [Python循环导入最佳实践](https://docs.python.org/3/faq/programming.html#what-are-the-best-practices-for-using-import-in-a-module)
- [Pydantic v2迁移指南](https://docs.pydantic.dev/latest/migration/)
- [Pluggy文档](https://pluggy.readthedocs.io/)

## 📌 注意事项

1. **及时记录**: 遇到问题立即记录，避免遗忘
2. **详细描述**: 包含足够信息以便他人理解
3. **持续更新**: 发现新解决方案时更新记录
4. **交叉引用**: 相关问题之间建立链接

---

**返回**: [归档首页](../README.md) | [文档首页](../../README.md)
