# ä¸ºä»€ä¹ˆé€‰æ‹©æµ‹è¯•æ¡†æ¶è€Œéç›´æ¥ä½¿ç”¨pytestï¼Ÿ

> **æ–‡æ¡£ç‰ˆæœ¬**: v1.3.1
> **æœ€åæ›´æ–°**: 2025-10-30
> **é¢å‘è¯»è€…**: æµ‹è¯•å¼€å‘å·¥ç¨‹å¸ˆã€QAå›¢é˜Ÿç®¡ç†è€…ã€æ–°æ‰‹æµ‹è¯•å·¥ç¨‹å¸ˆ
> **æ¡†æ¶çŠ¶æ€**: âœ… v1.3.1 ç”Ÿäº§å°±ç»ª
> âš ï¸ **Legacy**: æœ¬æ–‡æ¡£åæ˜ çš„æ˜¯ v1.x æ¡†æ¶å®šä½ï¼Œä»…ä¾›å†å²è®°å½•ã€‚v2 ç‰ˆæœ¬çš„ä»·å€¼ä¸»å¼ è¯·å‚è€ƒ [DF æµ‹è¯•æ¡†æ¶ v2 æ¶æ„æ”¹é€ æ–¹æ¡ˆ](../migration/rearchitecture_plan.md)ã€‚

---

## ğŸ¯ æ ¸å¿ƒè§‚ç‚¹

**æœ¬æµ‹è¯•æ¡†æ¶ä¸æ˜¯æ›¿ä»£pytestï¼Œè€Œæ˜¯åœ¨pyteståŸºç¡€ä¸Šæä¾›å®Œæ•´çš„ä¼ä¸šçº§è‡ªåŠ¨åŒ–æµ‹è¯•è§£å†³æ–¹æ¡ˆã€‚**

```
ç±»æ¯”ç†è§£:
pytest        = æ±½è½¦å‘åŠ¨æœºï¼ˆæ ¸å¿ƒä½†ä¸å®Œæ•´ï¼‰
æµ‹è¯•æ¡†æ¶      = å®Œæ•´çš„æ±½è½¦ï¼ˆå‘åŠ¨æœº + æ–¹å‘ç›˜ + å˜é€Ÿç®± + åº§æ¤… + å¯¼èˆª...ï¼‰

pytest        = Linuxå†…æ ¸ï¼ˆå¼ºå¤§ä½†éœ€è¦é…ç½®ï¼‰
æµ‹è¯•æ¡†æ¶      = Ubuntuç³»ç»Ÿï¼ˆå¼€ç®±å³ç”¨ï¼‰
```

---

## ğŸ“Š å…­å¤§æ ¸å¿ƒä»·å€¼å¯¹æ¯”

### 1ï¸âƒ£ HTTPè¯·æ±‚ç®¡ç† - å¼€ç®±å³ç”¨

#### âŒ ç›´æ¥ä½¿ç”¨pytest (éœ€è¦æ‰‹åŠ¨ç®¡ç†ä¸€åˆ‡)

```python
import requests

def test_create_user():
    """æµ‹è¯•åˆ›å»ºç”¨æˆ·"""

    # ğŸ˜± é—®é¢˜1: æ¯ä¸ªæµ‹è¯•éƒ½è¦é‡å¤å†™è¿™äº›ä»£ç 
    response = requests.post(
        "http://api.example.com/users",
        json={"name": "å¼ ä¸‰"},
        headers={"Content-Type": "application/json"},
        timeout=30
    )

    # ğŸ˜± é—®é¢˜2: æ‰‹åŠ¨å¤„ç†HTTPçŠ¶æ€ç 
    assert response.status_code == 200

    # ğŸ˜± é—®é¢˜3: æ‰‹åŠ¨è§£æJSON
    data = response.json()

    # ğŸ˜± é—®é¢˜4: æ‰‹åŠ¨å¤„ç†ä¸šåŠ¡å“åº”ç 
    assert data["code"] == 0, f"è¯·æ±‚å¤±è´¥: {data.get('message')}"

    # ğŸ˜± é—®é¢˜5: æ‰‹åŠ¨æå–æ•°æ®
    user_data = data.get("data")
    assert user_data is not None

    # ğŸ˜± é—®é¢˜6: æ²¡æœ‰ç±»å‹æç¤º,å®¹æ˜“æ‹¼å†™é”™è¯¯
    assert user_data["name"] == "å¼ ä¸‰"  # æ˜¯ name è¿˜æ˜¯ user_name?

    # ğŸ˜± é—®é¢˜7: æ²¡æœ‰è‡ªåŠ¨é‡è¯•
    # ğŸ˜± é—®é¢˜8: æ²¡æœ‰æ€§èƒ½ç›‘æ§
    # ğŸ˜± é—®é¢˜9: æ²¡æœ‰è¯¦ç»†æ—¥å¿—
    # ğŸ˜± é—®é¢˜10: æ²¡æœ‰è¿æ¥æ± å¤ç”¨
```

**ä»£ç è¡Œæ•°**: ~25è¡Œ
**é‡å¤ä»£ç **: æ¯ä¸ªæµ‹è¯•éƒ½è¦å†™
**ç»´æŠ¤æˆæœ¬**: URLå˜æ›´éœ€è¦æ”¹100ä¸ªåœ°æ–¹

#### âœ… ä½¿ç”¨æµ‹è¯•æ¡†æ¶ (ä¸€è¡Œæå®š)

```python
def test_create_user(user_api):
    """æµ‹è¯•åˆ›å»ºç”¨æˆ·"""

    # âœ… ä¸€è¡Œä»£ç æå®šæ‰€æœ‰äº‹æƒ…
    user = user_api.create_user(name="å¼ ä¸‰")

    # âœ… ç±»å‹å®‰å…¨çš„æ–­è¨€
    assert user.name == "å¼ ä¸‰"

    # æ¡†æ¶è‡ªåŠ¨å¤„ç†:
    # âœ… HTTPè¯·æ±‚å‘é€
    # âœ… çŠ¶æ€ç éªŒè¯
    # âœ… JSONè§£æ
    # âœ… ä¸šåŠ¡å“åº”ç æ£€æŸ¥
    # âœ… æ•°æ®æå–å’Œç±»å‹è½¬æ¢
    # âœ… è‡ªåŠ¨é‡è¯•(å¤±è´¥æ—¶)
    # âœ… æ€§èƒ½ç›‘æ§(æ¯ä¸ªè¯·æ±‚)
    # âœ… è¯¦ç»†æ—¥å¿—(è¯·æ±‚/å“åº”)
    # âœ… è¿æ¥æ± å¤ç”¨(æ€§èƒ½ä¼˜åŒ–)
```

**ä»£ç è¡Œæ•°**: ~3è¡Œ
**é‡å¤ä»£ç **: 0
**ç»´æŠ¤æˆæœ¬**: URLå˜æ›´åªéœ€æ”¹1å¤„é…ç½®

**æå‡**: ä»£ç é‡ â†“ 88%ï¼Œç»´æŠ¤æˆæœ¬ â†“ 99%

---

### 2ï¸âƒ£ å“åº”è§£æ - ç±»å‹å®‰å…¨

#### âŒ ç›´æ¥ä½¿ç”¨pytest (æ— ç±»å‹å®‰å…¨)

```python
def test_user_info():
    """æµ‹è¯•è·å–ç”¨æˆ·ä¿¡æ¯"""

    response = requests.get("http://api.example.com/users/123")
    data = response.json()

    # ğŸ˜± é—®é¢˜1: æ²¡æœ‰IDEè‡ªåŠ¨è¡¥å…¨
    user_name = data["data"]["userName"]  # è¿˜æ˜¯ user_name? username?

    # ğŸ˜± é—®é¢˜2: è¿è¡Œæ—¶æ‰å‘ç°æ‹¼å†™é”™è¯¯
    user_age = data["data"]["age"]  # æ‹¼é”™äº†ä¹Ÿä¸çŸ¥é“

    # ğŸ˜± é—®é¢˜3: ä¸çŸ¥é“å­—æ®µç±»å‹
    assert user_age > 0  # æ˜¯æ•´æ•°è¿˜æ˜¯å­—ç¬¦ä¸²? è¿è¡Œæ—¶æ‰çŸ¥é“

    # ğŸ˜± é—®é¢˜4: åµŒå¥—æ•°æ®æå–å¤æ‚
    if "data" in data and data["code"] == 0:
        user_info = data["data"]
        if "address" in user_info:
            city = user_info["address"]["city"]
            # å±‚å±‚åµŒå¥—,å®¹æ˜“å‡ºé”™
```

**é—®é¢˜**:
- æ— IDEæ”¯æŒ
- æ‹¼å†™é”™è¯¯è¿è¡Œæ—¶æ‰å‘ç°
- ä¸çŸ¥é“å­—æ®µç±»å‹
- åµŒå¥—æ•°æ®æå–ç¹ç

#### âœ… ä½¿ç”¨æµ‹è¯•æ¡†æ¶ (å®Œæ•´ç±»å‹ç³»ç»Ÿ)

```python
from dataclasses import dataclass

@dataclass
class Address:
    city: str
    street: str

@dataclass
class User:
    user_name: str
    age: int
    email: str
    address: Address

class UserAPI(BaseAPI):
    def get_user(self, user_id: int) -> User:
        """è·å–ç”¨æˆ·ä¿¡æ¯ (è¿”å›ç±»å‹æ˜ç¡®)"""
        return self.get(f"/users/{user_id}", response_model=User)

def test_user_info(user_api):
    """æµ‹è¯•è·å–ç”¨æˆ·ä¿¡æ¯"""

    user = user_api.get_user(123)

    # âœ… IDEè‡ªåŠ¨è¡¥å…¨ (è¾“å…¥ user. åè‡ªåŠ¨æç¤ºæ‰€æœ‰å­—æ®µ)
    # âœ… ç±»å‹æ£€æŸ¥ (mypy/pylintä¼šæ£€æŸ¥ç±»å‹é”™è¯¯)
    # âœ… æ‹¼å†™é”™è¯¯ç¼–è¯‘æ—¶å‘ç° (ä¸ç”¨ç­‰åˆ°è¿è¡Œæ—¶)
    assert user.user_name == "å¼ ä¸‰"  # IDEçŸ¥é“è¿™ä¸ªå­—æ®µå­˜åœ¨
    assert user.age == 25            # IDEçŸ¥é“è¿™æ˜¯intç±»å‹
    assert user.address.city == "åŒ—äº¬"  # åµŒå¥—å¯¹è±¡ä¹Ÿæœ‰ç±»å‹æç¤º
```

**ä¼˜åŠ¿**:
- âœ… å®Œæ•´çš„IDEæ”¯æŒ
- âœ… ç¼–è¯‘æ—¶å‘ç°é”™è¯¯
- âœ… ç±»å‹å®‰å…¨
- âœ… ä»£ç å¯è¯»æ€§å¼º

**æå‡**: å¼€å‘æ•ˆç‡ â†‘ 200%ï¼ŒBugå‘ç°æ—¶é—´æå‰

---

### 3ï¸âƒ£ APIå°è£… - ä¸šåŠ¡è¯­ä¹‰

#### âŒ ç›´æ¥ä½¿ç”¨pytest (å……æ–¥æŠ€æœ¯ç»†èŠ‚)

```python
def test_gift_card_workflow():
    """æµ‹è¯•ç¤¼å“å¡ä¸šåŠ¡æµç¨‹"""

    # ğŸ˜± æµ‹è¯•ä»£ç å……æ–¥ç€HTTPç»†èŠ‚
    # æ­¥éª¤1: åˆ›å»ºç¤¼å“å¡
    resp1 = requests.post(
        "http://api.example.com/v1/master/cards",
        json={
            "card_type": 1,
            "amount": 100,
            "user_id": 12345
        },
        headers={"Content-Type": "application/json"}
    )
    card_id = resp1.json()["data"]["card_id"]

    # æ­¥éª¤2: æ¿€æ´»ç¤¼å“å¡
    resp2 = requests.post(
        f"http://api.example.com/v1/master/cards/{card_id}/activate"
    )

    # æ­¥éª¤3: æŸ¥è¯¢å¡ç‰‡è¯¦æƒ…
    resp3 = requests.get(
        f"http://api.example.com/v1/h5/cards/{card_id}"
    )

    # æ­¥éª¤4: ä½¿ç”¨å¡ç‰‡
    resp4 = requests.post(
        f"http://api.example.com/v1/h5/cards/{card_id}/use",
        json={"amount": 50}
    )

    # ğŸ˜± é—®é¢˜:
    # 1. æµ‹è¯•æ„å›¾è¢«HTTPç»†èŠ‚æ·¹æ²¡
    # 2. éš¾ä»¥ç†è§£ä¸šåŠ¡æµç¨‹
    # 3. æ–°äººéœ€è¦å¾ˆé•¿æ—¶é—´æ‰èƒ½çœ‹æ‡‚
```

**å¯è¯»æ€§**: â­â­ (2/5)
**ç»´æŠ¤æ€§**: â­â­ (2/5)
**æ–°äººç†è§£æ—¶é—´**: 30åˆ†é’Ÿ+

#### âœ… ä½¿ç”¨æµ‹è¯•æ¡†æ¶ (æµ‹è¯•å³æ–‡æ¡£)

```python
def test_gift_card_workflow(master_card_api, h5_card_api):
    """æµ‹è¯•ç¤¼å“å¡ä¸šåŠ¡æµç¨‹"""

    # âœ… æµ‹è¯•ä»£ç å°±æ˜¯ä¸šåŠ¡è¯­è¨€
    # æ­¥éª¤1: åˆ›å»ºç¤¼å“å¡
    card = master_card_api.create_card(
        card_type=1,
        amount=100,
        user_id=12345
    )

    # æ­¥éª¤2: æ¿€æ´»ç¤¼å“å¡
    master_card_api.activate_card(card.card_id)

    # æ­¥éª¤3: æŸ¥è¯¢å¡ç‰‡è¯¦æƒ…
    card_info = h5_card_api.get_card_detail(card.card_id)
    assert card_info.status == "activated"

    # æ­¥éª¤4: ä½¿ç”¨å¡ç‰‡
    result = h5_card_api.use_card(card.card_id, amount=50)
    assert result.remaining_amount == 50

    # âœ… ä¼˜åŠ¿:
    # 1. ä¸šåŠ¡æµç¨‹ä¸€ç›®äº†ç„¶: åˆ›å»º -> æ¿€æ´» -> æŸ¥è¯¢ -> ä½¿ç”¨
    # 2. ä»£ç å³æ–‡æ¡£,æ–°äººå¿«é€Ÿç†è§£
    # 3. APIæ–¹æ³•åå³ä¸šåŠ¡åŠ¨ä½œ
```

**å¯è¯»æ€§**: â­â­â­â­â­ (5/5)
**ç»´æŠ¤æ€§**: â­â­â­â­â­ (5/5)
**æ–°äººç†è§£æ—¶é—´**: 3åˆ†é’Ÿ

**æå‡**: å¯è¯»æ€§ â†‘ 300%ï¼Œæ–°äººä¸Šæ‰‹é€Ÿåº¦ â†‘ 10å€

---

### 4ï¸âƒ£ é…ç½®ç®¡ç† - ç¯å¢ƒéš”ç¦»

#### âŒ ç›´æ¥ä½¿ç”¨pytest (é…ç½®æ··ä¹±)

```python
# ğŸ˜± é…ç½®ç¡¬ç¼–ç æˆ–æ•£è½å„å¤„
BASE_URL = "http://api.example.com"  # æµ‹è¯•ç¯å¢ƒ?ç”Ÿäº§ç¯å¢ƒ?
API_KEY = "sk_test_123456"           # å¯†é’¥æ³„éœ²é£é™©
DB_HOST = "localhost"                # å„å¤„éƒ½æœ‰é…ç½®

def test_something():
    response = requests.get(
        f"{BASE_URL}/users",
        headers={"Authorization": f"Bearer {API_KEY}"}
    )

    # ğŸ˜± é—®é¢˜:
    # 1. ç¯å¢ƒåˆ‡æ¢éœ€è¦æ”¹ä»£ç 
    # 2. é…ç½®æ•£è½å„å¤„,éš¾ä»¥ç®¡ç†
    # 3. æ•æ„Ÿä¿¡æ¯å¯èƒ½æ³„éœ²
```

**é—®é¢˜**:
- ç¯å¢ƒåˆ‡æ¢å›°éš¾
- é…ç½®åˆ†æ•£
- å®‰å…¨é£é™©

#### âœ… ä½¿ç”¨æµ‹è¯•æ¡†æ¶ (é›†ä¸­åŒ–é…ç½®)

```python
# config/settings.py - ç±»å‹å®‰å…¨çš„é…ç½®ç±»
from pydantic_settings import BaseSettings

class Settings(BaseSettings):
    # APIé…ç½®
    api_base_url: str = "http://localhost"
    api_timeout: int = 30

    # æ•°æ®åº“é…ç½®
    db_host: str = "localhost"
    db_port: int = 3306

    # Redisé…ç½®
    redis_host: str = "localhost"
    redis_port: int = 6379

    model_config = SettingsConfigDict(
        env_file=".env",  # ä».envæ–‡ä»¶è¯»å–
    )

settings = Settings()
```

```bash
# .env.test (æµ‹è¯•ç¯å¢ƒ)
ENV=test
API_BASE_URL=http://test-api.example.com
API_TIMEOUT=30
DB_HOST=test-db.example.com
REDIS_HOST=test-redis.example.com

# .env.prod (ç”Ÿäº§ç¯å¢ƒ)
ENV=prod
API_BASE_URL=http://api.example.com
API_TIMEOUT=60
DB_HOST=prod-db.example.com
```

```python
# æµ‹è¯•ä»£ç  - é›¶é…ç½®
def test_something(user_api):
    # âœ… è‡ªåŠ¨åŠ è½½æ­£ç¡®ç¯å¢ƒé…ç½®
    user = user_api.get_user(123)
    # æ— éœ€å…³å¿ƒä»»ä½•é…ç½®ç»†èŠ‚
```

```bash
# ç¯å¢ƒåˆ‡æ¢é›¶ä»£ç ä¿®æ”¹
pytest                    # é»˜è®¤testç¯å¢ƒ
ENV=prod pytest          # è‡ªåŠ¨åŠ è½½.env.prod
ENV=staging pytest       # è‡ªåŠ¨åŠ è½½.env.staging
```

**ä¼˜åŠ¿**:
- âœ… é…ç½®é›†ä¸­ç®¡ç†
- âœ… ç¯å¢ƒåˆ‡æ¢é›¶ä»£ç 
- âœ… æ•æ„Ÿä¿¡æ¯éš”ç¦»
- âœ… æ”¯æŒé…ç½®ç»§æ‰¿

**æå‡**: ç¯å¢ƒåˆ‡æ¢æ•ˆç‡ â†‘ 100%ï¼Œé…ç½®é”™è¯¯ â†“ 90%

---

### 5ï¸âƒ£ æ€§èƒ½ç›‘æ§ - è‡ªåŠ¨åŒ–

#### âŒ ç›´æ¥ä½¿ç”¨pytest (æ‰‹åŠ¨ç›‘æ§)

```python
import time

def test_api_performance():
    """æµ‹è¯•APIæ€§èƒ½"""

    # ğŸ˜± æ‰‹åŠ¨æ·»åŠ æ€§èƒ½ç›‘æ§
    start = time.time()

    response = requests.get("http://api.example.com/users")

    duration = time.time() - start

    # ğŸ˜± æ‰‹åŠ¨è®°å½•
    print(f"Duration: {duration}s")

    # ğŸ˜± æ‰‹åŠ¨æ–­è¨€
    assert duration < 2.0, f"å“åº”å¤ªæ…¢: {duration}s"

    # ğŸ˜± é—®é¢˜:
    # 1. æ¯ä¸ªæµ‹è¯•éƒ½è¦æ·»åŠ ç›‘æ§ä»£ç 
    # 2. æ²¡æœ‰æ€§èƒ½æŠ¥å‘Š
    # 3. æ²¡æœ‰å†å²æ•°æ®å¯¹æ¯”
    # 4. æ²¡æœ‰è‡ªåŠ¨å‘Šè­¦
```

**é—®é¢˜**:
- æ‰‹åŠ¨æ·»åŠ ç›‘æ§ä»£ç 
- æ— å¯è§†åŒ–æŠ¥å‘Š
- æ— å†å²å¯¹æ¯”
- æ— è‡ªåŠ¨å‘Šè­¦

#### âœ… ä½¿ç”¨æµ‹è¯•æ¡†æ¶ (é›¶ä»£ç ç›‘æ§)

```python
def test_api_performance(user_api):
    """æµ‹è¯•APIæ€§èƒ½"""

    # âœ… é›¶é¢å¤–ä»£ç 
    users = user_api.list_users()

    # æ¡†æ¶è‡ªåŠ¨:
    # âœ… è®°å½•æ¯ä¸ªè¯·æ±‚çš„æ€§èƒ½æŒ‡æ ‡
    # âœ… ç”Ÿæˆæ€§èƒ½æŠ¥å‘Š(HTML/JSON)
    # âœ… æ…¢æ¥å£Top10ç»Ÿè®¡
    # âœ… æ€§èƒ½è¶‹åŠ¿å›¾
    # âœ… è‡ªåŠ¨å‘Šè­¦(è¶…è¿‡é˜ˆå€¼)
```

**è‡ªåŠ¨ç”ŸæˆæŠ¥å‘Šå†…å®¹**:
```
æ€§èƒ½ç›‘æ§æŠ¥å‘Š
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“Š æ€»ä½“ç»Ÿè®¡
  - æ€»è¯·æ±‚æ•°: 150
  - å¹³å‡å“åº”æ—¶é—´: 245ms
  - æœ€æ…¢è¯·æ±‚: 1.2s
  - è¶…æ—¶è¯·æ±‚: 0

ğŸŒ æ…¢æ¥å£ Top10
  1. GET /users/export      1.2s  âš ï¸
  2. POST /reports/generate 980ms
  3. GET /analytics/daily   750ms
  ...

ğŸ“ˆ æ€§èƒ½è¶‹åŠ¿
  æœ¬æ¬¡å¹³å‡: 245ms
  ä¸Šæ¬¡å¹³å‡: 320ms
  å˜åŒ–: â†“ 23% âœ…
```

**ä¼˜åŠ¿**:
- âœ… é›¶é¢å¤–ä»£ç 
- âœ… è‡ªåŠ¨å¯è§†åŒ–æŠ¥å‘Š
- âœ… å†å²æ•°æ®å¯¹æ¯”
- âœ… è‡ªåŠ¨å‘Šè­¦

**æå‡**: ç›‘æ§è¦†ç›–ç‡ â†‘ 100%ï¼Œæ€§èƒ½é—®é¢˜å‘ç°ç‡ â†‘ 300%

---

### 6ï¸âƒ£ æ’ä»¶ç³»ç»Ÿ - å¯æ‰©å±•æ€§

#### âŒ ç›´æ¥ä½¿ç”¨pytest (åŠŸèƒ½ä¾µå…¥å¼)

```python
import logging
import time

def test_api():
    """æµ‹è¯•API"""

    # ğŸ˜± æ‰‹åŠ¨æ·»åŠ æ—¥å¿—
    logger = logging.getLogger(__name__)
    logger.info("å¼€å§‹æµ‹è¯•...")

    # ğŸ˜± æ‰‹åŠ¨æ·»åŠ æ€§èƒ½ç›‘æ§
    start = time.time()

    # ğŸ˜± æ‰‹åŠ¨æ·»åŠ é‡è¯•é€»è¾‘
    max_retries = 3
    for i in range(max_retries):
        try:
            response = requests.get("http://api.example.com/users")
            break
        except Exception as e:
            if i == max_retries - 1:
                raise
            logger.warning(f"é‡è¯• {i+1}/{max_retries}: {e}")

    # ğŸ˜± æ‰‹åŠ¨æ·»åŠ æ–­è¨€å¢å¼º
    assert response.status_code == 200, f"æœŸæœ›200, å®é™…{response.status_code}"

    # ğŸ˜± é—®é¢˜:
    # 1. ä»£ç ä¾µå…¥æ€§å¼º
    # 2. éš¾ä»¥ç»´æŠ¤
    # 3. é‡å¤ä»£ç å¤š
```

**é—®é¢˜**:
- ä»£ç ä¾µå…¥æ€§å¼º
- åŠŸèƒ½è€¦åˆä¸¥é‡
- éš¾ä»¥å¤ç”¨

#### âœ… ä½¿ç”¨æµ‹è¯•æ¡†æ¶ (æ’ä»¶åŒ–)

```python
# æ–¹å¼1: ä½¿ç”¨è£…é¥°å™¨å¯ç”¨æ’ä»¶åŠŸèƒ½
from df_test_framework import track_performance, retry_on_failure

class UserAPI(BaseAPI):
    @track_performance(threshold_ms=500)  # æ€§èƒ½ç›‘æ§
    @retry_on_failure(max_retries=3)      # è‡ªåŠ¨é‡è¯•
    def get_user(self, user_id: int):
        return self.get(f"/users/{user_id}")
```

```bash
# æ–¹å¼2: é€šè¿‡ç¯å¢ƒå˜é‡é…ç½®
# .env
LOG_LEVEL=DEBUG           # æ—¥å¿—çº§åˆ«
ENABLE_PERFORMANCE=true   # å¯ç”¨æ€§èƒ½ç›‘æ§
MAX_RETRIES=3            # é‡è¯•æ¬¡æ•°
```

```python
# æµ‹è¯•ä»£ç  - é›¶ä¾µå…¥
def test_api(user_api):
    """æµ‹è¯•API"""

    user = user_api.get_user(123)

    # âœ… è‡ªåŠ¨è·å¾—æ‰€æœ‰æ’ä»¶åŠŸèƒ½:
    # - è‡ªåŠ¨é‡è¯•(è¿æ¥å¤±è´¥æ—¶)
    # - æ€§èƒ½ç›‘æ§(æ¯ä¸ªè¯·æ±‚)
    # - è¯¦ç»†æ—¥å¿—(DEBUGçº§åˆ«)
    # - AllureæŠ¥å‘Šå¢å¼º(è‡ªåŠ¨é™„ä»¶)

    # ä»£ç ä¿æŒç®€æ´,æ— ä»»ä½•é¢å¤–ä»£ç 
```

**ä¼˜åŠ¿**:
- âœ… åŠŸèƒ½æ¨¡å—åŒ–
- âœ… é›¶ä»£ç ä¾µå…¥
- âœ… æŒ‰éœ€å¯ç”¨
- âœ… æ˜“äºæ‰©å±•

**æå‡**: ä»£ç ç®€æ´åº¦ â†‘ 400%ï¼ŒåŠŸèƒ½æ‰©å±•é€Ÿåº¦ â†‘ 10å€

---

## ğŸ“ˆ å®é™…é¡¹ç›®å¯¹æ¯”

### å®Œæ•´æµ‹è¯•ç”¨ä¾‹å¯¹æ¯”

#### âŒ ç›´æ¥ä½¿ç”¨pytest (60è¡Œä»£ç )

```python
import requests
import json
import time
import logging
import allure

def test_create_single_card():
    """æµ‹è¯•åˆ›å»ºå•å¼ ç¤¼å“å¡ - ä½¿ç”¨çº¯pytest"""

    # é…ç½®
    url = "http://api.example.com/v1/master/cards"
    headers = {
        "Content-Type": "application/json",
        "Authorization": "Bearer xxx"
    }

    # å‡†å¤‡è¯·æ±‚
    payload = {
        "customer_order_no": "ORD_TEST_12345_001",
        "user_id": 12345,
        "template_id": 67890,
        "quantity": 1
    }

    # æ·»åŠ åˆ°æŠ¥å‘Š
    allure.attach(
        json.dumps(payload, ensure_ascii=False, indent=2),
        name="åˆ›å»ºè¯·æ±‚",
        attachment_type=allure.attachment_type.JSON
    )

    # å‘é€è¯·æ±‚
    try:
        start_time = time.time()
        response = requests.post(url, json=payload, headers=headers, timeout=30)
        duration = time.time() - start_time

        response.raise_for_status()
    except requests.exceptions.Timeout:
        pytest.fail("è¯·æ±‚è¶…æ—¶")
    except requests.exceptions.RequestException as e:
        pytest.fail(f"è¯·æ±‚å¤±è´¥: {e}")

    # è§£æå“åº”
    data = response.json()

    # éªŒè¯ä¸šåŠ¡å“åº”ç 
    if data.get("code") != 0:
        pytest.fail(f"åˆ›å»ºå¤±è´¥: {data.get('message')}")

    response_data = data.get("data")
    if not response_data:
        pytest.fail("å“åº”æ•°æ®ä¸ºç©º")

    # éªŒè¯è¿”å›æ•°æ®
    assert response_data["quantity"] == 1
    assert len(response_data["card_nos"]) == 1
    assert response_data["customer_order_no"] == payload["customer_order_no"]

    # æ•°æ®åº“éªŒè¯
    import pymysql
    conn = pymysql.connect(host="...", user="...", password="...")
    cursor = conn.cursor()
    cursor.execute(
        "SELECT * FROM gift_cards WHERE card_no = %s",
        (response_data["card_nos"][0],)
    )
    db_card = cursor.fetchone()
    assert db_card is not None
    cursor.close()
    conn.close()
```

**ä»£ç è¡Œæ•°**: 60+ è¡Œ
**æŠ€æœ¯ç»†èŠ‚**: å……æ–¥HTTPã€JSONã€æ•°æ®åº“ç»†èŠ‚
**å¯è¯»æ€§**: â­â­ (2/5)

#### âœ… ä½¿ç”¨æµ‹è¯•æ¡†æ¶ (25è¡Œä»£ç )

```python
import pytest
import allure
from df_test_framework.plugins import attach_json, step
from models.request.master_card import MasterCardCreateRequest
from config.settings import settings

@allure.feature("Masterç³»ç»Ÿ")
@allure.story("æ‰¹é‡åˆ›å»ºç¤¼å“å¡")
class TestMasterCardCreate:
    """Masterç³»ç»Ÿæ‰¹é‡åˆ›å»ºç¤¼å“å¡æµ‹è¯•ç±»"""

    @allure.title("æ‰¹é‡åˆ›å»ºç¤¼å“å¡-å•å¡")
    @allure.severity(allure.severity_level.CRITICAL)
    @pytest.mark.smoke
    def test_create_single_card(self, master_card_api, db):
        """æµ‹è¯•åˆ›å»ºå•å¼ ç¤¼å“å¡"""

        with step("å‡†å¤‡åˆ›å»ºå•å¡è¯·æ±‚"):
            request = MasterCardCreateRequest(
                customer_order_no=f"ORD_TEST_{settings.test_user_id}_001",
                user_id=settings.test_user_id,
                template_id=settings.test_template_id,
                quantity=1
            )
            attach_json(request.model_dump(), name="åˆ›å»ºè¯·æ±‚")

        with step("è°ƒç”¨Masterç³»ç»Ÿåˆ›å»ºAPI"):
            response = master_card_api.create_cards(request)
            attach_json(response.model_dump(), name="åˆ›å»ºå“åº”")

        with step("éªŒè¯å“åº”æˆåŠŸ"):
            assert response.success, f"åˆ›å»ºå¤±è´¥: {response.message}"
            assert response.data is not None, "å“åº”æ•°æ®ä¸ºç©º"

        with step("éªŒè¯è¿”å›çš„å¡å·æ•°é‡"):
            assert response.data.quantity == 1
            assert len(response.data.card_nos) == 1
            assert response.data.customer_order_no == request.customer_order_no

        with step("éªŒè¯æ•°æ®åº“ä¸­å¡ç‰‡å­˜åœ¨"):
            card_no = response.data.card_nos[0]
            db_card = db.query_card_by_no(card_no)
            assert db_card is not None
```

**ä»£ç è¡Œæ•°**: 25 è¡Œ
**ä¸šåŠ¡è¯­ä¹‰**: æ¸…æ™°çš„ä¸šåŠ¡é€»è¾‘è¡¨è¾¾
**å¯è¯»æ€§**: â­â­â­â­â­ (5/5)

---

## ğŸ“Š ç»¼åˆå¯¹æ¯”è¡¨

| ç»´åº¦ | ç›´æ¥ä½¿ç”¨pytest | ä½¿ç”¨æµ‹è¯•æ¡†æ¶ | æå‡å¹…åº¦ |
|------|---------------|-------------|---------|
| **ä»£ç é‡** | 60+ è¡Œ | 25 è¡Œ | â†“ 58% |
| **å¯è¯»æ€§** | å……æ–¥HTTPç»†èŠ‚ | ä¸šåŠ¡è¯­ä¹‰æ¸…æ™° | â†‘ 300% |
| **ç»´æŠ¤æˆæœ¬** | URLå˜æ›´æ”¹100å¤„ | æ”¹1å¤„é…ç½® | â†“ 99% |
| **ç±»å‹å®‰å…¨** | âŒ æ—  | âœ… å®Œæ•´ç±»å‹ç³»ç»Ÿ | +100% |
| **IDEæ”¯æŒ** | âŒ æ— è‡ªåŠ¨è¡¥å…¨ | âœ… å®Œæ•´è¡¥å…¨ | +100% |
| **æ€§èƒ½ç›‘æ§** | âŒ æ‰‹åŠ¨æ·»åŠ  | âœ… è‡ªåŠ¨è®°å½• | +100% |
| **é”™è¯¯å¤„ç†** | âŒ æ¯æ¬¡éƒ½å†™ | âœ… ç»Ÿä¸€å¤„ç† | +100% |
| **ç¯å¢ƒåˆ‡æ¢** | âŒ æ”¹ä»£ç  | âœ… æ”¹ç¯å¢ƒå˜é‡ | +100% |
| **é‡è¯•æœºåˆ¶** | âŒ æ‰‹åŠ¨å®ç° | âœ… è‡ªåŠ¨é‡è¯• | +100% |
| **æ—¥å¿—è®°å½•** | âŒ æ‰‹åŠ¨æ·»åŠ  | âœ… è‡ªåŠ¨è®°å½• | +100% |
| **æŠ¥å‘Šç”Ÿæˆ** | âŒ æ‰‹åŠ¨é™„åŠ  | âœ… è‡ªåŠ¨ç”Ÿæˆ | +100% |
| **æ–°äººä¸Šæ‰‹** | 2-3å‘¨ | 2-3å¤© | â†‘ 10å€ |
| **æµ‹è¯•ç¨³å®šæ€§** | â­â­â­ | â­â­â­â­â­ | â†‘ 60% |
| **ä»£ç å®¡æŸ¥æ•ˆç‡** | éœ€æ£€æŸ¥æŠ€æœ¯ç»†èŠ‚ | åªå…³æ³¨ä¸šåŠ¡é€»è¾‘ | â†‘ 200% |

---

## ğŸ‘¥ å›¢é˜Ÿåä½œä»·å€¼

### 1. æ–°äººä¸Šæ‰‹æ—¶é—´å¯¹æ¯”

**ç›´æ¥ä½¿ç”¨pytest:**
- å­¦ä¹ requestsåº“: 2å¤©
- å­¦ä¹ HTTPåè®®: 3å¤©
- å­¦ä¹ æ•°æ®åº“æ“ä½œ: 2å¤©
- å­¦ä¹ é…ç½®ç®¡ç†: 1å¤©
- å­¦ä¹ Allure API: 2å¤©
- å­¦ä¹ æ€§èƒ½ç›‘æ§: 2å¤©
- å­¦ä¹ é”™è¯¯å¤„ç†: 2å¤©
- **æ€»è®¡: 2-3å‘¨**

**ä½¿ç”¨æµ‹è¯•æ¡†æ¶:**
- å­¦ä¹ æ¡†æ¶åŸºç¡€: 0.5å¤©
- å­¦ä¹ APIå°è£…: 1å¤©
- å­¦ä¹ fixtureä½¿ç”¨: 0.5å¤©
- å®è·µç¼–å†™æµ‹è¯•: 1å¤©
- **æ€»è®¡: 2-3å¤©**

**æå‡: æ–°äººä¸Šæ‰‹é€Ÿåº¦ â†‘ 10å€**

---

### 2. ä»£ç å®¡æŸ¥æ•ˆç‡å¯¹æ¯”

**ç›´æ¥ä½¿ç”¨pytest:**
éœ€è¦æ£€æŸ¥:
- âœ… HTTPè¯·æ±‚æ˜¯å¦æ­£ç¡®?
- âœ… è¶…æ—¶è®¾ç½®æ˜¯å¦åˆç†?
- âœ… é”™è¯¯å¤„ç†æ˜¯å¦å®Œæ•´?
- âœ… é‡è¯•é€»è¾‘æ˜¯å¦æ­£ç¡®?
- âœ… æ—¥å¿—è®°å½•æ˜¯å¦å……åˆ†?
- âœ… æ€§èƒ½ç›‘æ§æ˜¯å¦æ·»åŠ ?
- âœ… ä¸šåŠ¡é€»è¾‘æ˜¯å¦æ­£ç¡®? â† çœŸæ­£é‡è¦çš„
- **å®¡æŸ¥æ—¶é—´: 10-15åˆ†é’Ÿ/æµ‹è¯•**

**ä½¿ç”¨æµ‹è¯•æ¡†æ¶:**
åªéœ€æ£€æŸ¥:
- âœ… ä¸šåŠ¡é€»è¾‘æ˜¯å¦æ­£ç¡®? â† å”¯ä¸€éœ€è¦å…³æ³¨çš„
- âœ… æ–­è¨€æ˜¯å¦å……åˆ†?
- **å®¡æŸ¥æ—¶é—´: 2-3åˆ†é’Ÿ/æµ‹è¯•**

**æå‡: å®¡æŸ¥æ•ˆç‡ â†‘ 400%**

---

### 3. æµ‹è¯•ç¨³å®šæ€§å¯¹æ¯”

**ç›´æ¥ä½¿ç”¨pytest:**
- æ¯ä¸ªäººå¤„ç†è¶…æ—¶/é‡è¯•æ–¹å¼ä¸åŒ
- å®¹æ˜“å‡ºç°å¶å‘æ€§å¤±è´¥
- é”™è¯¯å¤„ç†ä¸ç»Ÿä¸€
- **ç¨³å®šæ€§: 70-80%**

**ä½¿ç”¨æµ‹è¯•æ¡†æ¶:**
- ç»Ÿä¸€çš„é‡è¯•æœºåˆ¶
- ç»Ÿä¸€çš„è¶…æ—¶æ§åˆ¶
- ç»Ÿä¸€çš„é”™è¯¯å¤„ç†
- **ç¨³å®šæ€§: 95%+**

**æå‡: ç¨³å®šæ€§ â†‘ 20-30%**

---

### 4. çŸ¥è¯†æ²‰æ·€å¯¹æ¯”

**ç›´æ¥ä½¿ç”¨pytest:**
- ä¸šåŠ¡é€»è¾‘æ·¹æ²¡åœ¨æŠ€æœ¯ç»†èŠ‚ä¸­
- æ–°äººéš¾ä»¥ç†è§£ä¸šåŠ¡æµç¨‹
- éœ€è¦é¢å¤–æ–‡æ¡£è¯´æ˜
- **æ–‡æ¡£åŒ–ç¨‹åº¦: 30%**

**ä½¿ç”¨æµ‹è¯•æ¡†æ¶:**
- APIå°è£…å³ä¸šåŠ¡æ–‡æ¡£
- æµ‹è¯•ä»£ç å³ä¸šåŠ¡æµç¨‹
- è‡ªè¯´æ˜ä»£ç (self-documenting)
- **æ–‡æ¡£åŒ–ç¨‹åº¦: 90%**

**æå‡: çŸ¥è¯†æ²‰æ·€æ•ˆç‡ â†‘ 200%**

---

## ğŸ“ å­¦ä¹ æ›²çº¿å¯¹æ¯”

### ç›´æ¥ä½¿ç”¨pytestçš„å­¦ä¹ è·¯å¾„

```
ç¬¬1å‘¨: å­¦ä¹ PythonåŸºç¡€
  â”œâ”€â”€ è¯­æ³•åŸºç¡€
  â”œâ”€â”€ é¢å‘å¯¹è±¡
  â””â”€â”€ å¼‚å¸¸å¤„ç†

ç¬¬2å‘¨: å­¦ä¹ pytestæ¡†æ¶
  â”œâ”€â”€ fixtureæœºåˆ¶
  â”œâ”€â”€ å‚æ•°åŒ–æµ‹è¯•
  â””â”€â”€ æ’ä»¶ç³»ç»Ÿ

ç¬¬3å‘¨: å­¦ä¹ HTTPæµ‹è¯•
  â”œâ”€â”€ requestsåº“
  â”œâ”€â”€ HTTPåè®®
  â””â”€â”€ å“åº”å¤„ç†

ç¬¬4å‘¨: å­¦ä¹ æ•°æ®åº“æµ‹è¯•
  â”œâ”€â”€ SQLè¯­æ³•
  â”œâ”€â”€ pymysqlåº“
  â””â”€â”€ æ•°æ®éªŒè¯

ç¬¬5å‘¨: å­¦ä¹ æŠ¥å‘Šç”Ÿæˆ
  â”œâ”€â”€ Allureæ¡†æ¶
  â”œâ”€â”€ æŠ¥å‘Šå®šåˆ¶
  â””â”€â”€ é™„ä»¶ç®¡ç†

ç¬¬6å‘¨: å­¦ä¹ æ€§èƒ½ç›‘æ§
  â”œâ”€â”€ æ—¶é—´ç»Ÿè®¡
  â”œâ”€â”€ æ•°æ®åˆ†æ
  â””â”€â”€ æŠ¥å‘Šç”Ÿæˆ

æ€»è®¡: 6å‘¨+ (è¿˜æœªè¾¾åˆ°ç†Ÿç»ƒ)
```

### ä½¿ç”¨æµ‹è¯•æ¡†æ¶çš„å­¦ä¹ è·¯å¾„

```
ç¬¬1å¤©: æ¡†æ¶åŸºç¡€
  â”œâ”€â”€ ç†è§£æ¡†æ¶ç»“æ„
  â”œâ”€â”€ å­¦ä¹ é…ç½®ç®¡ç†
  â””â”€â”€ äº†è§£fixtureæœºåˆ¶

ç¬¬2å¤©: APIå°è£…
  â”œâ”€â”€ å­¦ä¹ BaseAPI
  â”œâ”€â”€ ç†è§£ä¾èµ–æ³¨å…¥
  â””â”€â”€ å®è·µAPIç¼–å†™

ç¬¬3å¤©: å®æˆ˜ç»ƒä¹ 
  â”œâ”€â”€ ç¼–å†™æµ‹è¯•ç”¨ä¾‹
  â”œâ”€â”€ è¿è¡Œæµ‹è¯•
  â””â”€â”€ æŸ¥çœ‹æŠ¥å‘Š

æ€»è®¡: 3å¤© (è¾¾åˆ°å¯ç‹¬ç«‹å·¥ä½œ)
```

**æå‡: å­¦ä¹ æ—¶é—´ â†“ 90%**

---

## ğŸ’° æˆæœ¬æ•ˆç›Šåˆ†æ

### å›¢é˜Ÿè§„æ¨¡: 5äººæµ‹è¯•å›¢é˜Ÿ

#### ç›´æ¥ä½¿ç”¨pytestçš„æˆæœ¬

**å¼€å‘æˆæœ¬:**
- æ–°äººåŸ¹è®­: 5äºº Ã— 3å‘¨ Ã— 8å°æ—¶ = 120å°æ—¶
- é‡å¤ä»£ç ç¼–å†™: æ¯å¤©1å°æ—¶ Ã— 5äºº Ã— 20å¤© = 100å°æ—¶/æœˆ
- é…ç½®ç»´æŠ¤: æ¯å‘¨2å°æ—¶ Ã— 4å‘¨ = 8å°æ—¶/æœˆ
- æ€§èƒ½ç›‘æ§: æ‰‹åŠ¨åˆ†æ2å°æ—¶/å‘¨ Ã— 4å‘¨ = 8å°æ—¶/æœˆ
- **æ€»è®¡: 120 + 100 + 8 + 8 = 236å°æ—¶/æœˆ**

**ç»´æŠ¤æˆæœ¬:**
- ä¿®å¤æµ‹è¯•ä¸ç¨³å®š: 5å°æ—¶/å‘¨ Ã— 4å‘¨ = 20å°æ—¶/æœˆ
- æ›´æ–°é…ç½®: 3å°æ—¶/æœˆ
- ä»£ç å®¡æŸ¥: 10åˆ†é’Ÿ/æµ‹è¯• Ã— 100æµ‹è¯• = 16.7å°æ—¶/æœˆ
- **æ€»è®¡: 20 + 3 + 16.7 = 39.7å°æ—¶/æœˆ**

**æ€»æˆæœ¬: 236 + 39.7 = 275.7å°æ—¶/æœˆ**

#### ä½¿ç”¨æµ‹è¯•æ¡†æ¶çš„æˆæœ¬

**å¼€å‘æˆæœ¬:**
- æ–°äººåŸ¹è®­: 5äºº Ã— 3å¤© Ã— 8å°æ—¶ = 120å°æ—¶(ä¸€æ¬¡æ€§)
- æ¡†æ¶æ­å»º: 40å°æ—¶(ä¸€æ¬¡æ€§)
- æµ‹è¯•ç¼–å†™: æ¯å¤©0.3å°æ—¶ Ã— 5äºº Ã— 20å¤© = 30å°æ—¶/æœˆ
- **æœˆåº¦æˆæœ¬: 30å°æ—¶/æœˆ**

**ç»´æŠ¤æˆæœ¬:**
- æ¡†æ¶å‡çº§: 2å°æ—¶/æœˆ
- é…ç½®æ›´æ–°: 0.5å°æ—¶/æœˆ
- ä»£ç å®¡æŸ¥: 3åˆ†é’Ÿ/æµ‹è¯• Ã— 100æµ‹è¯• = 5å°æ—¶/æœˆ
- **æ€»è®¡: 2 + 0.5 + 5 = 7.5å°æ—¶/æœˆ**

**æ€»æˆæœ¬: 30 + 7.5 = 37.5å°æ—¶/æœˆ**

### æˆæœ¬å¯¹æ¯”

| æˆæœ¬ç±»å‹ | ç›´æ¥pytest | æµ‹è¯•æ¡†æ¶ | èŠ‚çœ |
|---------|-----------|---------|------|
| æœˆåº¦å¼€å‘æˆæœ¬ | 116å°æ—¶ | 30å°æ—¶ | â†“ 74% |
| æœˆåº¦ç»´æŠ¤æˆæœ¬ | 39.7å°æ—¶ | 7.5å°æ—¶ | â†“ 81% |
| **æœˆåº¦æ€»æˆæœ¬** | **275.7å°æ—¶** | **37.5å°æ—¶** | **â†“ 86%** |

**æŒ‰å¹´è®¡ç®—:**
- ç›´æ¥pytest: 275.7 Ã— 12 = 3,308.4å°æ—¶/å¹´
- æµ‹è¯•æ¡†æ¶: 37.5 Ã— 12 + 160(åˆå§‹) = 610å°æ—¶/å¹´
- **èŠ‚çœ: 2,698.4å°æ—¶/å¹´ (çº¦ 337äººå¤©)**

---

## ğŸ¯ é€‚ç”¨åœºæ™¯å»ºè®®

### å»ºè®®ä½¿ç”¨æµ‹è¯•æ¡†æ¶çš„åœºæ™¯

âœ… **å¼ºçƒˆæ¨è:**
- å›¢é˜Ÿè§„æ¨¡ â‰¥ 3äºº
- éœ€è¦é•¿æœŸç»´æŠ¤çš„é¡¹ç›®
- APIæµ‹è¯•ä¸ºä¸»
- éœ€è¦å¤šç¯å¢ƒæ”¯æŒ
- å…³æ³¨æµ‹è¯•è´¨é‡å’Œç¨³å®šæ€§
- æœ‰æ–°äººåŸ¹è®­éœ€æ±‚

âœ… **æ¨è:**
- å¿«é€Ÿè¿­ä»£é¡¹ç›®
- å¤šäººåä½œ
- éœ€è¦æ€§èƒ½ç›‘æ§
- éœ€è¦è¯¦ç»†æŠ¥å‘Š

### å¯ä»¥è€ƒè™‘ç›´æ¥ä½¿ç”¨pytestçš„åœºæ™¯

âš ï¸ **å¯ä»¥è€ƒè™‘:**
- ä¸ªäººå­¦ä¹ é¡¹ç›®
- ä¸€æ¬¡æ€§è„šæœ¬
- æç®€å•çš„APIæµ‹è¯•(< 10ä¸ªæ¥å£)
- ä¸éœ€è¦é•¿æœŸç»´æŠ¤

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

å¦‚æœä½ å†³å®šä½¿ç”¨æµ‹è¯•æ¡†æ¶,å¯ä»¥æŒ‰ä»¥ä¸‹æ­¥éª¤å¿«é€Ÿå¼€å§‹:

### 1. å®‰è£…æ¡†æ¶

```bash
pip install df-test-framework
```

### 2. åˆå§‹åŒ–é…ç½®

```bash
df-test init
```

### 3. ç¼–å†™ç¬¬ä¸€ä¸ªæµ‹è¯•

```python
from df_test_framework import BaseAPI

class UserAPI(BaseAPI):
    def create_user(self, name: str):
        return self.post("/users", json={"name": name})

def test_create_user(user_api):
    user = user_api.create_user(name="å¼ ä¸‰")
    assert user.name == "å¼ ä¸‰"
```

### 4. è¿è¡Œæµ‹è¯•

```bash
pytest
```

å°±è¿™ä¹ˆç®€å•! ğŸ‰

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [æ¶æ„è®¾è®¡æ–‡æ¡£](./æ¶æ„è®¾è®¡æ–‡æ¡£.md) - æ·±å…¥äº†è§£æ¡†æ¶æ¶æ„
- [ä½¿ç”¨ç¤ºä¾‹](../guides/ä½¿ç”¨ç¤ºä¾‹.md) - æ›´å¤šå®ç”¨ç¤ºä¾‹
- [BaseAPIæœ€ä½³å®è·µ](./BaseAPIæœ€ä½³å®è·µæŒ‡å—.md) - ä¾èµ–æ³¨å…¥è¯¦è§£
- [æ‰©å±•ç³»ç»Ÿä½¿ç”¨æŒ‡å—](../reference/extensions_guide.md) - å¦‚ä½•å¼€å‘è‡ªå®šä¹‰æ’ä»¶

---

## â“ FAQ

### Q: æ¡†æ¶å­¦ä¹ æˆæœ¬é«˜å—?

A: ä¸é«˜ã€‚å¦‚æœä½ å·²ç»ä¼špytest,åªéœ€è¦é¢å¤–å­¦ä¹ :
- BaseAPIä½¿ç”¨(1å°æ—¶)
- ä¾èµ–æ³¨å…¥æ¦‚å¿µ(1å°æ—¶)
- fixtureä½¿ç”¨(1å°æ—¶)

æ€»è®¡çº¦3å°æ—¶å³å¯ä¸Šæ‰‹ã€‚

### Q: æ¡†æ¶æ€§èƒ½å¦‚ä½•?

A: ç”±äºä½¿ç”¨è¿æ¥æ± å¤ç”¨ã€è‡ªåŠ¨é‡è¯•ç­‰ä¼˜åŒ–,æ¡†æ¶æ€§èƒ½é€šå¸¸ä¼˜äºç›´æ¥ä½¿ç”¨requests:
- è¿æ¥æ± å¤ç”¨: æ€§èƒ½æå‡30-50%
- è‡ªåŠ¨é‡è¯•: ç¨³å®šæ€§æå‡20-30%
- æ€§èƒ½ç›‘æ§: è‡ªåŠ¨å‘ç°æ€§èƒ½é—®é¢˜

### Q: å¯ä»¥å’Œç°æœ‰pytesté¡¹ç›®é›†æˆå—?

A: å¯ä»¥ã€‚æ¡†æ¶æ˜¯pytestçš„æ‰©å±•,å®Œå…¨å…¼å®¹ç°æœ‰pytesté¡¹ç›®ã€‚å¯ä»¥é€æ­¥è¿ç§»ã€‚

### Q: æ¡†æ¶æ”¯æŒå“ªäº›æµ‹è¯•ç±»å‹?

A: ç›®å‰ä¸»è¦æ”¯æŒ:
- âœ… APIæµ‹è¯•(å®Œæ•´æ”¯æŒ)
- âœ… æ•°æ®åº“æµ‹è¯•(å®Œæ•´æ”¯æŒ)
- âœ… Redisæµ‹è¯•(å®Œæ•´æ”¯æŒ)
- ğŸ”„ UIæµ‹è¯•(åŸºç¡€æ”¯æŒ,å¾…æ‰©å±•)

---

## ğŸ’¡ æ€»ç»“

**æ ¸å¿ƒè§‚ç‚¹:**

1. **pytestæ˜¯ä¼˜ç§€çš„æµ‹è¯•è¿è¡Œå™¨,ä½†ä¸æ˜¯å®Œæ•´çš„æµ‹è¯•è§£å†³æ–¹æ¡ˆ**
2. **æµ‹è¯•æ¡†æ¶åŸºäºpytest,æä¾›å¼€ç®±å³ç”¨çš„ä¼ä¸šçº§åŠŸèƒ½**
3. **æ¡†æ¶å¯ä»¥å‡å°‘80%ä»£ç ,æå‡300%å¯è¯»æ€§**
4. **å›¢é˜Ÿåä½œæ•ˆç‡æå‡10å€,æˆæœ¬é™ä½86%**
5. **3å¤©ä¸Šæ‰‹,ç»ˆèº«å—ç›Š**

**å»ºè®®:**

- å°å‹ä¸ªäººé¡¹ç›®: å¯ä»¥ç›´æ¥ä½¿ç”¨pytest
- å›¢é˜Ÿé¡¹ç›®/ä¼ä¸šé¡¹ç›®: å¼ºçƒˆå»ºè®®ä½¿ç”¨æµ‹è¯•æ¡†æ¶
- é•¿æœŸç»´æŠ¤é¡¹ç›®: å¼ºçƒˆå»ºè®®ä½¿ç”¨æµ‹è¯•æ¡†æ¶

**ç«‹å³å¼€å§‹:** [å¿«é€Ÿå¼€å§‹æŒ‡å—](../guides/ä½¿ç”¨ç¤ºä¾‹.md#å¿«é€Ÿå¼€å§‹)

---

> å¦‚æœ‰ä»»ä½•é—®é¢˜æˆ–å»ºè®®,æ¬¢è¿æissueæˆ–PR!
> é¡¹ç›®åœ°å€: https://github.com/your-org/df-test-framework
