# v3.46.2 - UI è„šæ‰‹æ¶å‡çº§ & EventBus ä¿®å¤

**å‘å¸ƒæ—¥æœŸ**: 2026-01-15
**ç‰ˆæœ¬ç±»å‹**: åŠŸèƒ½å¢å¼º + Bug ä¿®å¤

---

## æ¦‚è¿°

v3.46.2 ç‰ˆæœ¬ä¸»è¦å‡çº§ UI è„šæ‰‹æ¶æ¨¡æ¿ï¼Œä½¿ç”¨ **practice.expandtesting.com** ä½œä¸ºæ¼”ç¤ºç½‘ç«™ï¼Œæä¾›ä¸‰å±‚æ¶æ„ï¼ˆActions + Pages + Componentsï¼‰çš„å®Œæ•´ç¤ºä¾‹ï¼Œå¹¶æ¼”ç¤ºä¸‰ç§ UI æ“ä½œæ–¹æ³•ã€‚åŒæ—¶ä¿®å¤äº† EventBus æ¶æ„ä¼˜åŒ–ä¸­çš„ä¸€äº›é—®é¢˜ã€‚

**æ ¸å¿ƒæ”¹è¿›**:
- ğŸ¨ **practice.expandtesting.com** - 50+ æµ‹è¯•åœºæ™¯çš„ä¸“ä¸šæµ‹è¯•ç½‘ç«™
- ğŸ—ï¸ **ä¸‰å±‚æ¶æ„æ¼”ç¤º** - Actionsï¼ˆä¸šåŠ¡æ“ä½œï¼‰+ Pagesï¼ˆé¡µé¢å¯¹è±¡ï¼‰+ Componentsï¼ˆå¯å¤ç”¨ç»„ä»¶ï¼‰
- ğŸ› ï¸ **ä¸‰ç§æ“ä½œæ–¹æ³•** - Playwright API + æ‰‹åŠ¨äº‹ä»¶ã€è¾…åŠ©æ–¹æ³•ã€æ··åˆä½¿ç”¨
- ğŸ› **EventBus ä¿®å¤** - å®Œå–„ä½œç”¨åŸŸè¿‡æ»¤å’Œäº‹ä»¶å‘å¸ƒæœºåˆ¶

---

## ä¸»è¦æ”¹è¿›

### 1. UI è„šæ‰‹æ¶æ¨¡æ¿å‡çº§

#### 1.1 æ¼”ç¤ºç½‘ç«™æ›´æ¢

ä½¿ç”¨ **practice.expandtesting.com** æ›¿ä»£åŸæœ‰æ¼”ç¤ºç½‘ç«™ï¼š

| ç‰¹æ€§ | practice.expandtesting.com |
|------|----------------------------|
| **æµ‹è¯•åœºæ™¯** | 50+ æµ‹è¯•åœºæ™¯ï¼ˆç™»å½•ã€è¡¨å•ã€Notesã€ä¸Šä¼ ç­‰ï¼‰ |
| **æµ‹è¯•è´¦å·** | `practice` / `SuperSecretPassword!` |
| **æ–‡æ¡£** | å®Œå–„çš„ä½¿ç”¨æ–‡æ¡£ |
| **ç¨³å®šæ€§** | ä¸“ä¸ºæµ‹è¯•è‡ªåŠ¨åŒ–è®¾è®¡ï¼Œç¨³å®šå¯é  |
| **è®¿é—®** | https://practice.expandtesting.com |

#### 1.2 ä¸‰å±‚æ¶æ„æ¼”ç¤º

**UI é¡¹ç›®æ¨¡æ¿** (`df-test init my-project --type ui`) åŒ…å«ï¼š

```
my-project/
â”œâ”€â”€ actions/                 # ä¸šåŠ¡æ“ä½œå±‚
â”‚   â”œâ”€â”€ login_actions.py    # ç™»å½•æ“ä½œï¼ˆPlaywright API + æ‰‹åŠ¨äº‹ä»¶ï¼‰
â”‚   â”œâ”€â”€ notes_actions.py    # Notes æ“ä½œï¼ˆè¾…åŠ©æ–¹æ³•ï¼‰
â”‚   â””â”€â”€ secure_page_actions.py  # å®‰å…¨é¡µé¢æ“ä½œï¼ˆæ··åˆä½¿ç”¨ï¼‰
â”œâ”€â”€ pages/                   # é¡µé¢å¯¹è±¡å±‚
â”‚   â”œâ”€â”€ login_page.py       # ç™»å½•é¡µé¢
â”‚   â””â”€â”€ secure_page.py      # å®‰å…¨é¡µé¢
â”œâ”€â”€ components/              # å¯å¤ç”¨ç»„ä»¶å±‚
â”‚   â”œâ”€â”€ login_form.py       # ç™»å½•è¡¨å•ç»„ä»¶
â”‚   â””â”€â”€ alert_message.py    # æ¶ˆæ¯æç¤ºç»„ä»¶
â”œâ”€â”€ tests/
â”‚   â””â”€â”€ test_ui_example.py  # å®Œæ•´æµ‹è¯•ç”¨ä¾‹
â””â”€â”€ config/
    â”œâ”€â”€ base.yaml           # practice.expandtesting.com é…ç½®
    â””â”€â”€ ...
```

#### 1.3 ä¸‰ç§æ“ä½œæ–¹æ³•

æ¡†æ¶æ”¯æŒä¸‰ç§ UI æ“ä½œæ–¹æ³•ï¼Œæ»¡è¶³ä¸åŒåœºæ™¯éœ€æ±‚ï¼š

**æ–¹æ³• 1: Playwright API + æ‰‹åŠ¨äº‹ä»¶å‘å¸ƒ**ï¼ˆLoginActionsï¼‰
```python
@actions_class()
class LoginActions(AppActions):
    """ç™»å½•æ“ä½œ - æ¼”ç¤º Playwright API + æ‰‹åŠ¨äº‹ä»¶å‘å¸ƒ"""

    def login_with_valid_credentials(self):
        self.goto("/login")

        # æ‰‹åŠ¨å‘å¸ƒäº‹ä»¶
        username_input = self.page.locator('input[name="username"]')
        self._publish_ui_action_event("fill", value="practice", description="ç”¨æˆ·åè¾“å…¥æ¡†")
        username_input.fill("practice")
```

**ä¼˜ç‚¹**: å®Œå…¨æ§åˆ¶ï¼Œçµæ´»æ€§æœ€é«˜
**ç¼ºç‚¹**: éœ€è¦æ‰‹åŠ¨å‘å¸ƒäº‹ä»¶ï¼Œä»£ç è¾ƒå¤š
**é€‚ç”¨**: å¤æ‚äº¤äº’ã€éœ€è¦å®Œå…¨æ§åˆ¶çš„åœºæ™¯

**æ–¹æ³• 2: è¾…åŠ©æ–¹æ³•ï¼ˆè‡ªåŠ¨å‘å¸ƒäº‹ä»¶ï¼‰**ï¼ˆNotesActionsï¼‰
```python
@actions_class()
class NotesActions(AppActions):
    """Notes æ“ä½œ - æ¼”ç¤ºè¾…åŠ©æ–¹æ³•ï¼ˆè‡ªåŠ¨å‘å¸ƒäº‹ä»¶ï¼‰"""

    def create_note(self, title: str, description: str, category: str = "Home") -> str:
        # è¾…åŠ©æ–¹æ³•è‡ªåŠ¨å‘å¸ƒäº‹ä»¶
        self.click('button[data-testid="add-note"]', "æ·»åŠ ç¬”è®°æŒ‰é’®")
        self.fill_input('input[id="title"]', title, "æ ‡é¢˜è¾“å…¥æ¡†")
        self.fill_input('textarea[id="description"]', description, "å†…å®¹è¾“å…¥æ¡†")
        self.select_option('select[id="category"]', category, "åˆ†ç±»ä¸‹æ‹‰æ¡†")
        self.click('button.btn-primary', "ä¿å­˜æŒ‰é’®")
```

**ä¼˜ç‚¹**: ç®€æ´ï¼Œè‡ªåŠ¨äº‹ä»¶è®°å½•ï¼Œæ˜“ç»´æŠ¤
**ç¼ºç‚¹**: åŠŸèƒ½æœ‰é™ï¼Œå¤æ‚åœºæ™¯éœ€è¦ç»„åˆä½¿ç”¨
**é€‚ç”¨**: å¤§éƒ¨åˆ†å¸¸è§åœºæ™¯ï¼ˆ80%+ï¼‰

**æ–¹æ³• 3: æ··åˆä½¿ç”¨**ï¼ˆSecurePageActionsï¼‰
```python
@actions_class()
class SecurePageActions(AppActions):
    """å®‰å…¨é¡µé¢æ“ä½œ - æ¼”ç¤ºæ··åˆä½¿ç”¨"""

    def verify_login_success(self) -> str:
        # è¾…åŠ©æ–¹æ³• + Playwright API
        message = self.page.locator('.alert-success').text_content() or ""
        self._publish_ui_action_event("get_text", value=message, description="æˆåŠŸæ¶ˆæ¯")
        return message
```

**ä¼˜ç‚¹**: å¹³è¡¡çµæ´»æ€§å’Œç®€æ´æ€§
**ç¼ºç‚¹**: éœ€è¦äº†è§£ä½•æ—¶ä½¿ç”¨ä½•ç§æ–¹æ³•
**é€‚ç”¨**: å®é™…é¡¹ç›®æ¨èæ–¹å¼

#### 1.4 Page Object æ¨¡å¼ç¤ºä¾‹

**LoginPage** - å®Œæ•´é¡µé¢å¯¹è±¡ï¼š
```python
class LoginPage(BasePage):
    """ç™»å½•é¡µé¢å¯¹è±¡"""

    def __init__(self, page, runtime=None, base_url: str | None = None):
        super().__init__(page, url="/login", base_url=base_url, runtime=runtime)

        # ç»„åˆä½¿ç”¨ç»„ä»¶
        self.login_form = LoginForm(page)
        self.success_alert = AlertMessage(page, alert_type="success")
        self.error_alert = AlertMessage(page, alert_type="error")

    def login(self, username: str, password: str):
        """æ‰§è¡Œç™»å½•æ“ä½œ"""
        self.login_form.login(username, password)
        self.page.wait_for_url("**/secure", timeout=5000)
```

**LoginForm** - å¯å¤ç”¨ç»„ä»¶ï¼š
```python
class LoginForm(BaseComponent):
    """ç™»å½•è¡¨å•ç»„ä»¶"""

    def __init__(self, page):
        super().__init__(page, css_selector='#login')

    def login(self, username: str, password: str):
        """ä¸€é”®ç™»å½•"""
        self.root.locator('input[name="username"]').fill(username)
        self.root.locator('input[name="password"]').fill(password)
        self.root.locator('button[type="submit"]').click()
```

#### 1.5 æµ‹è¯•ç”¨ä¾‹ç¤ºä¾‹

**å®Œæ•´æµ‹è¯•ç¤ºä¾‹**ï¼š
```python
class TestLogin:
    """ç™»å½•åŠŸèƒ½æµ‹è¯•"""

    @pytest.mark.ui
    def test_login_with_valid_credentials(self, login_actions):
        """æµ‹è¯•æœ‰æ•ˆå‡­è¯ç™»å½•"""
        login_actions.login_with_valid_credentials()

        # éªŒè¯ç™»å½•æˆåŠŸ
        assert login_actions.is_logged_in()
        message = login_actions.get_success_message()
        assert "secure area" in message.lower()

class TestNotes:
    """Notes åŠŸèƒ½æµ‹è¯•"""

    @pytest.mark.ui
    def test_create_note(self, notes_actions):
        """æµ‹è¯•åˆ›å»ºç¬”è®°"""
        # ç™»å½•
        notes_actions.login()

        # åˆ›å»ºç¬”è®°
        note_id = notes_actions.create_note(
            title="Test Note",
            description="This is a test note",
            category="Work"
        )

        # éªŒè¯ç¬”è®°åˆ›å»ºæˆåŠŸ
        assert note_id
        notes = notes_actions.get_notes_list()
        assert any(note["title"] == "Test Note" for note in notes)
```

### 2. Full é¡¹ç›®æ¨¡æ¿å‡çº§

**Full é¡¹ç›®æ¨¡æ¿** (`df-test init my-project --type full`) åŒæ—¶æ”¯æŒ API å’Œ UI æµ‹è¯•ï¼š

**é…ç½®**ï¼š
```python
class MyProjectSettings(FrameworkSettings):
    """å®Œæ•´é¡¹ç›®é…ç½®ï¼ˆAPI + UIï¼‰"""

    # HTTP é…ç½®ï¼ˆAPI æµ‹è¯•ï¼‰
    http: HTTPConfig = Field(
        default_factory=lambda: HTTPConfig(
            base_url="http://localhost:8000/api",
            timeout=30,
        )
    )

    # Web é…ç½®ï¼ˆUI æµ‹è¯•ï¼‰
    web: WebConfig = Field(
        default_factory=lambda: WebConfig(
            base_url="https://practice.expandtesting.com",
            browser_type="chromium",
            headless=True,
            timeout=30000,
        )
    )
```

**README åŒ…å«**ï¼š
- UI æµ‹è¯•æ¼”ç¤ºç½‘ç«™è¯´æ˜
- æµ‹è¯•è´¦å·ä¿¡æ¯
- å¿«é€Ÿå¼€å§‹æŒ‡å—
- ä¸‰å±‚æ¶æ„è¯´æ˜

### 3. é…ç½®æ¨¡æ¿æ”¹è¿›

**config/base.yaml**ï¼š
```yaml
env: dev

# Web UI é…ç½®ï¼ˆUI æµ‹è¯•ï¼‰
web:
  base_url: https://practice.expandtesting.com
  browser_type: chromium
  headless: true
  timeout: 30000
  viewport:
    width: 1920
    height: 1080

# HTTP é…ç½®ï¼ˆAPI æµ‹è¯•ï¼‰
http:
  base_url: http://localhost:8000/api
  timeout: 30
```

**.env æ¨¡æ¿**ï¼š
```bash
# Web UI é…ç½®ï¼ˆUI æµ‹è¯•ï¼‰
WEB__BASE_URL=https://practice.expandtesting.com
WEB__BROWSER_TYPE=chromium
WEB__HEADLESS=true
WEB__TIMEOUT=30000
WEB__VIEWPORT__width=1920
WEB__VIEWPORT__height=1080
```

---

## Bug ä¿®å¤

### 4.1 EventBus æ¶æ„ä¼˜åŒ–ä¿®å¤

ä¿®å¤ v3.46.1 EventBus æ¶æ„ä¼˜åŒ–ä¸­çš„ä¸€äº›é—®é¢˜ï¼š

**ä¿®å¤ 1: app_actions.py äº‹ä»¶å‘å¸ƒ**
```python
# âŒ æ—§ç‰ˆï¼ˆv3.46.1ï¼‰
event = UIActionEvent.create(...)
self.runtime.event_bus.publish_sync(event)

# âœ… æ–°ç‰ˆï¼ˆv3.46.2ï¼‰
event = UIActionEvent.create(...)
self.runtime.publish_event(event)  # è‡ªåŠ¨æ³¨å…¥ scope
```

**å½±å“**: ç¡®ä¿ UI äº‹ä»¶æ­£ç¡®æ³¨å…¥ scopeï¼Œå®ç°æµ‹è¯•éš”ç¦»ã€‚

**ä¿®å¤ 2: browser.py é‡å¤æ—¥å¿—è¾“å‡º**
```python
# âŒ æ—§ç‰ˆ - é‡å¤è¾“å‡º
logger.error(f"âŒ Page Error: {error}")  # æ—¥å¿—
event = UIErrorEvent.create(...)
self._publish_event(event)  # ConsoleDebugObserver ä¹Ÿä¼šè¾“å‡º

# âœ… æ–°ç‰ˆ - ç§»é™¤é‡å¤
# ä¸å†æ‰‹åŠ¨è®°å½•æ—¥å¿—ï¼Œè®© ConsoleDebugObserver ç»Ÿä¸€å¤„ç†
event = UIErrorEvent.create(...)
self._publish_event(event)
```

**å½±å“**: é¿å…æ§åˆ¶å°é‡å¤è¾“å‡ºï¼Œè°ƒè¯•ä¿¡æ¯æ›´æ¸…æ™°ã€‚

**ä¿®å¤ 3: types.py ExecutionContext åˆ›å»º**
```python
# âŒ æ—§ç‰ˆ
context = ExecutionContext()

# âœ… æ–°ç‰ˆ
context = ExecutionContext.create_root()
```

**å½±å“**: ä½¿ç”¨æ­£ç¡®çš„å·¥å‚æ–¹æ³•åˆ›å»ºæ ¹ä¸Šä¸‹æ–‡ã€‚

**ä¿®å¤ 4: console.py è¾“å‡ºä¼˜åŒ–**
```python
# âŒ æ—§ç‰ˆ - å¤šä½™ç©ºè¡Œ
logger.info("")
logger.info(f"ğŸ“ {event_name}")
logger.info("")

# âœ… æ–°ç‰ˆ - ç´§å‡‘è¾“å‡º
logger.info(f"ğŸ“ {event_name}")
```

**å½±å“**: è°ƒè¯•è¾“å‡ºæ›´ç´§å‡‘ï¼Œå‡å°‘ 28 å¤„å¤šä½™ç©ºè¡Œã€‚

---

## æ–‡æ¡£æ›´æ–°

### 5.1 Web UI æµ‹è¯•æŒ‡å—

æ›´æ–° `docs/guides/web-ui-testing.md`ï¼Œæ·»åŠ  **4.6 èŠ‚"UI æ“ä½œè¾…åŠ©æ–¹æ³• (v3.46.0)"**ï¼š

**å¯¹æ¯”ä¸‰ç§æ“ä½œæ–¹æ³•**ï¼š

| ç»´åº¦ | Playwright API + æ‰‹åŠ¨äº‹ä»¶ | è¾…åŠ©æ–¹æ³• | æ··åˆä½¿ç”¨ |
|------|---------------------------|---------|---------|
| **ä»£ç é‡** | å¤š | å°‘ | é€‚ä¸­ |
| **çµæ´»æ€§** | æœ€é«˜ | ä¸­ç­‰ | é«˜ |
| **äº‹ä»¶è®°å½•** | æ‰‹åŠ¨ | è‡ªåŠ¨ | è‡ªåŠ¨ + æ‰‹åŠ¨ |
| **å­¦ä¹ æˆæœ¬** | é«˜ | ä½ | ä¸­ç­‰ |
| **é€‚ç”¨åœºæ™¯** | å¤æ‚äº¤äº’ | å¸¸è§åœºæ™¯ï¼ˆ80%+ï¼‰ | å®é™…é¡¹ç›®æ¨è |

**ä½¿ç”¨å»ºè®®**ï¼š
- æ–°æ‰‹ï¼šä¼˜å…ˆä½¿ç”¨è¾…åŠ©æ–¹æ³•
- é«˜çº§ç”¨æˆ·ï¼šæ··åˆä½¿ç”¨
- ç‰¹æ®Šåœºæ™¯ï¼šPlaywright API + æ‰‹åŠ¨äº‹ä»¶

---

## å‡çº§æŒ‡å—

### 6.1 æ–°é¡¹ç›®

ä½¿ç”¨æ–°ç‰ˆè„šæ‰‹æ¶åˆå§‹åŒ–é¡¹ç›®ï¼š

```bash
# UI é¡¹ç›®
df-test init my-ui-project --type ui

# Full é¡¹ç›®ï¼ˆAPI + UIï¼‰
df-test init my-full-project --type full

# å®‰è£…ä¾èµ–
cd my-ui-project
uv sync --all-extras

# è¿è¡Œ UI æµ‹è¯•
uv run pytest tests/ -v -s -m ui
```

### 6.2 ç°æœ‰é¡¹ç›®

ç°æœ‰é¡¹ç›®æ— éœ€ä»»ä½•æ›´æ”¹ï¼Œå®Œå…¨å‘åå…¼å®¹ã€‚

å¦‚æœæƒ³å‚è€ƒæ–°çš„æ¨¡æ¿ç¤ºä¾‹ï¼š

1. **æŸ¥çœ‹æ¨¡æ¿ä»£ç **ï¼š`src/df_test_framework/cli/templates/project/`
2. **å‚è€ƒæ–‡æ¡£**ï¼š`docs/guides/web-ui-testing.md`
3. **å­¦ä¹ ä¸‰ç§æ“ä½œæ–¹æ³•**ï¼šæ ¹æ®é¡¹ç›®éœ€æ±‚é€‰æ‹©åˆé€‚çš„æ–¹æ³•

---

## æŠ€æœ¯ç»†èŠ‚

### 7.1 è„šæ‰‹æ¶æ¨¡æ¿æ–‡ä»¶

**æ›´æ–°çš„æ¨¡æ¿æ–‡ä»¶**ï¼š
- `ui_app_actions.py` - Actions ç¤ºä¾‹ï¼ˆä¸‰ç§æ“ä½œæ–¹æ³•ï¼‰
- `ui_page_object.py` - Page Object + Component ç¤ºä¾‹
- `ui_test_example.py` - å®Œæ•´æµ‹è¯•ç”¨ä¾‹
- `ui_settings.py` - UI é¡¹ç›®é…ç½®
- `full_settings.py` - Full é¡¹ç›®é…ç½®
- `env.py` - ç¯å¢ƒå˜é‡é…ç½®
- `readme.py` - README æ¨¡æ¿

### 7.2 æ¡†æ¶æ”¹è¿›æ–‡ä»¶

**ä¿®å¤çš„æ¡†æ¶æ–‡ä»¶**ï¼š
- `app_actions.py` - ä½¿ç”¨ `runtime.publish_event()`
- `browser.py` - ç§»é™¤é‡å¤æ—¥å¿—è¾“å‡º
- `types.py` - ä½¿ç”¨ `ExecutionContext.create_root()`
- `console.py` - ç§»é™¤å¤šä½™ç©ºè¡Œ

---

## å…¼å®¹æ€§

- âœ… **å®Œå…¨å‘åå…¼å®¹** - ç°æœ‰é¡¹ç›®æ— éœ€ä»»ä½•æ›´æ”¹
- âœ… **Python 3.12+** - ç»§ç»­æ”¯æŒ Python 3.12+
- âœ… **pytest 9.0+** - ç»§ç»­æ”¯æŒ pytest 9.0+
- âœ… **Playwright 1.40+** - ç»§ç»­æ”¯æŒ Playwright 1.40+

---

## è‡´è°¢

æ„Ÿè°¢ç¤¾åŒºåé¦ˆï¼Œä¿ƒä½¿æˆ‘ä»¬ï¼š
- é€‰æ‹©æ›´åˆé€‚çš„æ¼”ç¤ºç½‘ç«™ï¼ˆpractice.expandtesting.comï¼‰
- æä¾›å®Œæ•´çš„ä¸‰å±‚æ¶æ„ç¤ºä¾‹
- æ¼”ç¤ºä¸‰ç§æ“ä½œæ–¹æ³•çš„å¯¹æ¯”
- ä¿®å¤ EventBus æ¶æ„ä¼˜åŒ–ä¸­çš„é—®é¢˜

---

## ä¸‹ä¸€æ­¥è®¡åˆ’

v3.47.0 è®¡åˆ’ï¼š
- ğŸ¯ GraphQL å®¢æˆ·ç«¯å¢å¼º
- ğŸ“Š æ€§èƒ½æµ‹è¯•æ”¯æŒ
- ğŸ”’ å®‰å…¨æµ‹è¯•èƒ½åŠ›
- ğŸ“ æ›´å¤šæµ‹è¯•ç¤ºä¾‹

---

**å®Œæ•´æ›´æ–°æ—¥å¿—**: [CHANGELOG.md](../../CHANGELOG.md)
**Web UI æµ‹è¯•æŒ‡å—**: [docs/guides/web-ui-testing.md](../guides/web-ui-testing.md)
**é¡¹ç›®ä¸»é¡µ**: https://github.com/yourorg/df-test-framework
