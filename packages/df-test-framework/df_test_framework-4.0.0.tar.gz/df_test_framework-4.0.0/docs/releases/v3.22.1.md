# v3.22.1 å‘å¸ƒè¯´æ˜

> **å‘å¸ƒæ—¥æœŸ**: 2025-12-13
> **Python è¦æ±‚**: >= 3.12

---

## æ¦‚è¿°

v3.22.1 å°ç‰ˆæœ¬æ›´æ–°ï¼š**ConsoleDebugObserver æ”¯æŒæ•°æ®åº“è°ƒè¯•**ã€‚

æ ¸å¿ƒæ”¹è¿›ï¼š
- ConsoleDebugObserver ç°åœ¨æ”¯æŒæ•°æ®åº“ SQL æŸ¥è¯¢çš„å½©è‰²è°ƒè¯•è¾“å‡º
- æ–°å¢æ•°æ®åº“è°ƒè¯•é€‰é¡¹ï¼š`show_database`ã€`show_sql`ã€`show_sql_params`

---

## æ–°å¢åŠŸèƒ½

### 1. æ•°æ®åº“è°ƒè¯•æ”¯æŒ

ConsoleDebugObserver ç°åœ¨è®¢é˜…æ•°æ®åº“äº‹ä»¶ï¼Œæä¾› SQL æŸ¥è¯¢çš„å®æ—¶è°ƒè¯•è¾“å‡ºã€‚

```python
from df_test_framework.testing.debugging import create_console_debugger

# åˆ›å»ºè°ƒè¯•å™¨ï¼ˆå¯ç”¨æ•°æ®åº“è°ƒè¯•ï¼‰
debugger = create_console_debugger(
    show_database=True,   # æ˜¾ç¤ºæ•°æ®åº“æŸ¥è¯¢
    show_sql=True,        # æ˜¾ç¤º SQL è¯­å¥
    show_sql_params=True, # æ˜¾ç¤º SQL å‚æ•°
    max_sql_length=500,   # æœ€å¤§ SQL æ˜¾ç¤ºé•¿åº¦
)
```

### 2. æ§åˆ¶å°è¾“å‡ºæ•ˆæœ

```
ğŸ—„ï¸ SELECT users
ğŸ“ SQL: SELECT * FROM users WHERE id = :id
ğŸ“Š Params: {'id': 1}
âœ… å®Œæˆ: 1 row(s) in 5.23ms
```

### 3. æ–°å¢é…ç½®é€‰é¡¹

| é€‰é¡¹ | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|--------|------|
| `show_database` | bool | True | æ˜¯å¦æ˜¾ç¤ºæ•°æ®åº“æŸ¥è¯¢ |
| `show_sql` | bool | True | æ˜¯å¦æ˜¾ç¤º SQL è¯­å¥ |
| `show_sql_params` | bool | True | æ˜¯å¦æ˜¾ç¤º SQL å‚æ•° |
| `max_sql_length` | int | 500 | æœ€å¤§ SQL æ˜¾ç¤ºé•¿åº¦ |

---

## ä½¿ç”¨ç¤ºä¾‹

### ä½¿ç”¨ fixture

```python
def test_with_db_debug(database, console_debugger):
    """æ•°æ®åº“è°ƒè¯•è¾“å‡º"""
    result = database.execute(
        "SELECT * FROM users WHERE id = :id",
        {"id": 1}
    )
    # æ§åˆ¶å°è‡ªåŠ¨è¾“å‡ºå½©è‰² SQL è°ƒè¯•ä¿¡æ¯
```

### è‡ªå®šä¹‰é…ç½®

```python
def test_custom_db_debug(database, console_debugger):
    """è‡ªå®šä¹‰æ•°æ®åº“è°ƒè¯•é…ç½®"""
    console_debugger.show_sql_params = False  # éšè—å‚æ•°
    console_debugger.max_sql_length = 200     # é™åˆ¶ SQL é•¿åº¦

    result = database.execute("SELECT ...")
```

---

## è®¢é˜…çš„äº‹ä»¶

| äº‹ä»¶ç±»å‹ | è¯´æ˜ |
|----------|------|
| `DatabaseQueryStartEvent` | æŸ¥è¯¢å¼€å§‹ï¼ˆè®°å½•æ“ä½œç±»å‹ã€è¡¨åï¼‰ |
| `DatabaseQueryEndEvent` | æŸ¥è¯¢å®Œæˆï¼ˆæ˜¾ç¤ºè€—æ—¶ã€è¡Œæ•°ï¼‰ |
| `DatabaseQueryErrorEvent` | æŸ¥è¯¢é”™è¯¯ï¼ˆæ˜¾ç¤ºé”™è¯¯ä¿¡æ¯ï¼‰ |

---

## ç›¸å…³æ–‡æ¡£

- [v3.22.0 å‘å¸ƒè¯´æ˜](v3.22.0.md) - ConsoleDebugObserver åŸºç¡€ç‰ˆæœ¬
- [å¯è§‚æµ‹æ€§æ¶æ„è®¾è®¡](../architecture/observability-architecture.md)
