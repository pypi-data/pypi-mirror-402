# v3.34.0 å‘å¸ƒè¯´æ˜ - ConsoleDebugObserver MQ äº‹ä»¶æ”¯æŒ

**å‘å¸ƒæ—¥æœŸ**: 2025-12-17

## æ¦‚è¿°

v3.34.0 ä¸º ConsoleDebugObserver æ–°å¢äº† MQï¼ˆæ¶ˆæ¯é˜Ÿåˆ—ï¼‰äº‹ä»¶æ”¯æŒï¼Œå®ç°äº†æ¶ˆæ¯å‘å¸ƒå’Œæ¶ˆè´¹çš„å®æ—¶è°ƒè¯•æ˜¾ç¤ºã€‚è¿™ä½¿å¾— MQ ç»„ä»¶ä¸ HTTPã€GraphQLã€gRPCã€Databaseã€Redis ç­‰ç»„ä»¶åœ¨è°ƒè¯•ä½“éªŒä¸Šè¾¾åˆ°ä¸€è‡´ã€‚

## æ ¸å¿ƒç‰¹æ€§

### 1. æ¶ˆæ¯å‘å¸ƒè°ƒè¯•

å®æ—¶æ˜¾ç¤ºæ¶ˆæ¯å‘å¸ƒè¯¦æƒ…ï¼š

```
ğŸ“¤ MQ PUBLISH: orders.created
   Message ID: msg_abc123
   Body Size: 256 bytes
   Partition: 3
   Duration: 12ms
```

### 2. æ¶ˆæ¯æ¶ˆè´¹è°ƒè¯•

å®æ—¶æ˜¾ç¤ºæ¶ˆæ¯æ¶ˆè´¹è¯¦æƒ…ï¼š

```
ğŸ“¥ MQ CONSUME: orders.created
   Consumer Group: order-processor
   Message ID: msg_abc123
   Offset: 12345
   Duration: 45ms
```

### 3. ç‹¬ç«‹å¼€å…³æ§åˆ¶

é€šè¿‡ `show_mq` å‚æ•°æ§åˆ¶ MQ è°ƒè¯•è¾“å‡ºï¼š

```python
from df_test_framework.testing.debugging import create_console_debugger

# å¯ç”¨ MQ è°ƒè¯•ï¼ˆé»˜è®¤ï¼‰
debugger = create_console_debugger(show_mq=True)

# ç¦ç”¨ MQ è°ƒè¯•
debugger = create_console_debugger(show_mq=False)
```

### 4. å½©è‰²è¾“å‡º

- æ¶ˆæ¯å‘å¸ƒï¼šé’è‰² (cyan)
- æ¶ˆæ¯æ¶ˆè´¹ï¼šé»„è‰² (yellow)

## æ–°å¢ API

### MQMessageRecord

MQ æ¶ˆæ¯è®°å½•æ•°æ®ç±»ï¼š

```python
@dataclass
class MQMessageRecord:
    operation: str        # "publish" æˆ– "consume"
    topic: str           # ä¸»é¢˜åç§°
    message_id: str      # æ¶ˆæ¯ ID
    body_size: int       # æ¶ˆæ¯ä½“å¤§å°
    duration: float      # æ“ä½œè€—æ—¶
    partition: int | None = None      # åˆ†åŒºå·ï¼ˆå‘å¸ƒæ—¶ï¼‰
    consumer_group: str | None = None # æ¶ˆè´¹è€…ç»„ï¼ˆæ¶ˆè´¹æ—¶ï¼‰
    offset: int | None = None         # åç§»é‡ï¼ˆæ¶ˆè´¹æ—¶ï¼‰
```

### ConsoleDebugObserver æ–°å¢æ–¹æ³•

| æ–¹æ³• | è¯´æ˜ |
|------|------|
| `_handle_mq_publish()` | å¤„ç†æ¶ˆæ¯å‘å¸ƒäº‹ä»¶ |
| `_handle_mq_consume()` | å¤„ç†æ¶ˆæ¯æ¶ˆè´¹äº‹ä»¶ |
| `_print_mq_publish()` | æ‰“å°æ¶ˆæ¯å‘å¸ƒä¿¡æ¯ |
| `_print_mq_consume()` | æ‰“å°æ¶ˆæ¯æ¶ˆè´¹ä¿¡æ¯ |

## ä½¿ç”¨ç¤ºä¾‹

```python
from df_test_framework.testing.debugging import create_console_debugger
from df_test_framework.infrastructure.events import EventBus

# åˆ›å»º EventBus å’Œè°ƒè¯•å™¨
event_bus = EventBus()
debugger = create_console_debugger(
    show_http=True,
    show_db=True,
    show_mq=True,  # å¯ç”¨ MQ è°ƒè¯•
)
debugger.subscribe(event_bus)

# ä½¿ç”¨ Kafka å®¢æˆ·ç«¯
from df_test_framework.capabilities.messengers import KafkaClient

client = KafkaClient(bootstrap_servers="localhost:9092", event_bus=event_bus)

# å‘å¸ƒæ¶ˆæ¯ - æ§åˆ¶å°ä¼šè‡ªåŠ¨æ˜¾ç¤ºè°ƒè¯•ä¿¡æ¯
client.publish("orders.created", {"order_id": "12345"})
```

## æµ‹è¯•ç»“æœ

- æ‰€æœ‰æµ‹è¯•é€šè¿‡
