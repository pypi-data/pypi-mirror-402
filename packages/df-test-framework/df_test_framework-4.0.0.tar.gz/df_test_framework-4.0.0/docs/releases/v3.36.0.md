# v3.36.0 发布说明 - 配置 API 现代化重构

**发布日期**: 2025-12-21

## 概述

v3.36.0 完成了配置系统的现代化重构，删除了废弃的 ConfigRegistry 和 manager.py，统一使用 settings.py 的现代化 API。这次重构净删除约 1870 行代码，大幅简化了配置管理架构。

## 核心特性

### 1. 现代化配置 API

统一使用 `settings.py` 提供的函数式 API：

```python
from df_test_framework.infrastructure.config import (
    get_settings,           # 惰性加载 + 单例缓存
    get_config,             # 点号路径访问
    get_settings_for_class, # 自定义配置类
    clear_settings_cache,   # 清理缓存
)

# 获取框架配置
settings = get_settings()

# 点号路径访问配置值
timeout = get_config("http.timeout", default=30)

# 使用自定义配置类
from myproject.config import MySettings
settings = get_settings_for_class(MySettings, env="staging")
```

### 2. 删除废弃 API

移除了以下废弃模块和类：

| 废弃项 | 替代方案 |
|--------|----------|
| `ConfigRegistry` | `get_config()` 函数 |
| `manager.py` | `settings.py` 函数 |
| `configure_settings()` | `get_settings_for_class()` |
| `clear_settings()` | `clear_settings_cache()` |
| `InterceptorConfig` | 直接使用中间件配置 |

### 3. 技术债务清理

- 修复多个模块的导入错误
- 提升测试覆盖率
- 更新脚手架模板使用现代化 API
- 统一代码风格

## 迁移指南

### 从 v3.35.x 迁移

1. **ConfigRegistry 迁移**：

```python
# 旧代码
from df_test_framework.infrastructure.config import ConfigRegistry
registry = ConfigRegistry.get_instance()
timeout = registry.get("http.timeout")

# 新代码
from df_test_framework.infrastructure.config import get_config
timeout = get_config("http.timeout")
```

2. **configure_settings 迁移**：

```python
# 旧代码
from df_test_framework.infrastructure.config import configure_settings
configure_settings(MySettings, env="prod")

# 新代码
from df_test_framework.infrastructure.config import get_settings_for_class
settings = get_settings_for_class(MySettings, env="prod")
```

3. **clear_settings 迁移**：

```python
# 旧代码
from df_test_framework.infrastructure.config import clear_settings

# 新代码
from df_test_framework.infrastructure.config import clear_settings_cache
```

## 文件变更

### 删除
- `src/df_test_framework/infrastructure/config/manager.py` - 废弃的配置管理器
- `src/df_test_framework/infrastructure/config/registry.py` - ConfigRegistry 类

### 修改
- `env_plugin.py` - 直接使用 `get_settings_for_class()`
- `core.py` - 使用 `config._settings` 替代 ConfigRegistry
- 脚手架模板 - 更新为现代化 API

## 测试结果

- 所有测试通过
- 净删除约 1870 行代码
