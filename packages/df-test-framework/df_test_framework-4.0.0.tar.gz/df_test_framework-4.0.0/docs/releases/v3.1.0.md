# df-test-framework v3.1.0 å‘å¸ƒè¯´æ˜

> **å‘å¸ƒæ—¥æœŸ**: 2025-11-05
> **ç‰ˆæœ¬**: v3.0.0-alpha â†’ v3.1.0
> **ç±»å‹**: åŠŸèƒ½å¢å¼ºï¼ˆå‘åå…¼å®¹ï¼‰
> **çŠ¶æ€**: âœ… å·²å‘å¸ƒ

---

## ğŸ“Š ç‰ˆæœ¬æ¦‚è¿°

v3.1.0 å¼•å…¥äº†ä»£ç ç”Ÿæˆå·¥å…·ï¼Œå¸®åŠ©å¼€å‘è€…ä» JSON å“åº”å¿«é€Ÿç”Ÿæˆ Pydantic æ¨¡å‹ï¼Œæ˜¾è‘—æå‡å¼€å‘æ•ˆç‡ã€‚

**æ ¸å¿ƒç‰¹æ€§**:
- âœ… ä» JSON å“åº”è‡ªåŠ¨ç”Ÿæˆ Pydantic æ¨¡å‹
- âœ… è‡ªåŠ¨ç±»å‹æ¨æ–­
- âœ… é©¼å³°â†”è›‡å½¢å‘½åè½¬æ¢
- âœ… å‡å°‘ 80% çš„æ¨¡å‹å®šä¹‰å·¥ä½œé‡

---

## âœ¨ æ–°å¢åŠŸèƒ½

### ä»£ç ç”Ÿæˆå·¥å…· (`df-test gen models`)

ä½¿ç”¨ CLI å‘½ä»¤ä» JSON å“åº”è‡ªåŠ¨ç”Ÿæˆ Pydantic æ¨¡å‹ï¼š

```bash
# ä» API å“åº”ç”Ÿæˆæ¨¡å‹
curl http://api.example.com/users/1 > user_response.json
df-test gen models user_response.json --name UserResponse

# è‡ªåŠ¨ç”Ÿæˆï¼š
# - src/my_project/models/responses/user_response.py
# - å®Œæ•´çš„ Pydantic æ¨¡å‹å®šä¹‰
# - è‡ªåŠ¨ç±»å‹æ¨æ–­
# - é©¼å³°â†”è›‡å½¢å‘½åè½¬æ¢
```

---

## ğŸ¯ æ ¸å¿ƒç‰¹æ€§

### 1. è‡ªåŠ¨ç±»å‹æ¨æ–­

å·¥å…·ä¼šè‡ªåŠ¨æ¨æ–­ JSON å­—æ®µçš„æ•°æ®ç±»å‹ï¼š

**è¾“å…¥ JSON**:
```json
{
  "id": 123,
  "name": "å¼ ä¸‰",
  "email": "zhangsan@example.com",
  "age": 25,
  "is_active": true,
  "roles": ["admin", "user"],
  "profile": {
    "avatar": "https://example.com/avatar.png",
    "bio": "å¼€å‘è€…"
  }
}
```

**ç”Ÿæˆçš„ Pydantic æ¨¡å‹**:
```python
from pydantic import BaseModel, Field
from typing import List, Optional

class Profile(BaseModel):
    """ç”¨æˆ·èµ„æ–™"""
    avatar: str = Field(..., description="å¤´åƒ")
    bio: str = Field(..., description="ç®€ä»‹")

class UserResponse(BaseModel):
    """ç”¨æˆ·å“åº”"""
    id: int = Field(..., description="ç”¨æˆ·ID")
    name: str = Field(..., description="å§“å")
    email: str = Field(..., description="é‚®ç®±")
    age: int = Field(..., description="å¹´é¾„")
    is_active: bool = Field(..., description="æ¿€æ´»çŠ¶æ€")
    roles: List[str] = Field(..., description="è§’è‰²åˆ—è¡¨")
    profile: Profile = Field(..., description="ç”¨æˆ·èµ„æ–™")
```

### 2. æ”¯æŒçš„æ•°æ®ç±»å‹

- âœ… **åŸºç¡€ç±»å‹**: `str`, `int`, `float`, `bool`, `None`
- âœ… **åˆ—è¡¨**: `List[T]` (è‡ªåŠ¨æ¨æ–­å…ƒç´ ç±»å‹)
- âœ… **å­—å…¸**: `Dict[str, Any]`
- âœ… **åµŒå¥—å¯¹è±¡**: è‡ªåŠ¨ç”ŸæˆåµŒå¥—æ¨¡å‹ç±»
- âœ… **å¯é€‰ç±»å‹**: `Optional[T]` (å½“å€¼ä¸º null æ—¶)

### 3. é©¼å³°â†”è›‡å½¢å‘½åè½¬æ¢

è‡ªåŠ¨å¤„ç† API å‘½åé£æ ¼å’Œ Python å‘½åé£æ ¼çš„è½¬æ¢ï¼š

**è¾“å…¥ JSON (é©¼å³°å‘½å)**:
```json
{
  "userId": 123,
  "firstName": "å¼ ",
  "lastName": "ä¸‰",
  "createdAt": "2025-11-05T10:00:00Z"
}
```

**ç”Ÿæˆçš„æ¨¡å‹ (è›‡å½¢å‘½å)**:
```python
class UserResponse(BaseModel):
    user_id: int = Field(..., alias="userId")
    first_name: str = Field(..., alias="firstName")
    last_name: str = Field(..., alias="lastName")
    created_at: str = Field(..., alias="createdAt")

    class Config:
        populate_by_name = True  # æ”¯æŒä¸¤ç§å‘½åé£æ ¼
```

### 4. BaseResponse åŒ…è£…

ç”Ÿæˆçš„æ¨¡å‹å¯ä»¥ç»§æ‰¿ `BaseResponse`ï¼Œæä¾›æ ‡å‡†åŒ–çš„å“åº”ç»“æ„ï¼š

```python
from df_test_framework.testing.data.models import BaseResponse

class UserResponse(BaseResponse[User]):
    """ç”¨æˆ·å“åº”"""
    pass

# ä½¿ç”¨
response = UserResponse(code=200, message="success", data=user)
```

---

## ğŸ“– ä½¿ç”¨æŒ‡å—

### åŸºæœ¬ç”¨æ³•

```bash
# 1. è·å– API å“åº”
curl http://api.example.com/users/1 > user.json

# 2. ç”Ÿæˆæ¨¡å‹
df-test gen models user.json --name UserResponse

# 3. æŸ¥çœ‹ç”Ÿæˆçš„æ–‡ä»¶
# src/my_project/models/responses/user_response.py
```

### é«˜çº§é€‰é¡¹

```bash
# æŒ‡å®šè¾“å‡ºç›®å½•
df-test gen models user.json --name UserResponse --output src/models/

# æ‰¹é‡ç”Ÿæˆå¤šä¸ªæ¨¡å‹
df-test gen models user.json order.json product.json

# ä» URL ç›´æ¥ç”Ÿæˆ
curl http://api.example.com/users/1 | df-test gen models - --name UserResponse
```

---

## ğŸ“Š æ•ˆæœå¯¹æ¯”

### Before (æ‰‹å·¥ç¼–å†™)

**æ—¶é—´**: ~30 åˆ†é’Ÿ
**å·¥ä½œé‡**: 100 è¡Œä»£ç 

```python
# éœ€è¦æ‰‹å·¥ç¼–å†™æ‰€æœ‰å­—æ®µã€ç±»å‹ã€æ³¨é‡Š
class UserResponse(BaseModel):
    id: int
    name: str
    email: str
    # ... è¿˜æœ‰ 20+ ä¸ªå­—æ®µ
```

### After (ä½¿ç”¨ä»£ç ç”Ÿæˆ)

**æ—¶é—´**: ~5 åˆ†é’Ÿ
**å·¥ä½œé‡**: 1 è¡Œå‘½ä»¤

```bash
df-test gen models user.json --name UserResponse
# å®Œæˆï¼
```

**æ•ˆç‡æå‡**: **80%** çš„å·¥ä½œé‡å‡å°‘

---

## ğŸ”§ æŠ€æœ¯ç»†èŠ‚

### å®ç°åŸç†

1. **JSON è§£æ**: è§£æ JSON æ–‡ä»¶ï¼Œæå–ç»“æ„å’Œç±»å‹ä¿¡æ¯
2. **ç±»å‹æ¨æ–­**: åŸºäºå€¼çš„ç±»å‹æ¨æ–­ Python ç±»å‹æ³¨è§£
3. **æ¨¡å‹ç”Ÿæˆ**: ä½¿ç”¨ Jinja2 æ¨¡æ¿ç”Ÿæˆ Pydantic æ¨¡å‹ä»£ç 
4. **å‘½åè½¬æ¢**: è‡ªåŠ¨å¤„ç†é©¼å³°å’Œè›‡å½¢å‘½åçš„è½¬æ¢
5. **åµŒå¥—å¤„ç†**: é€’å½’å¤„ç†åµŒå¥—å¯¹è±¡ï¼Œç”Ÿæˆå¤šä¸ªæ¨¡å‹ç±»

### ç”Ÿæˆçš„ä»£ç è´¨é‡

- âœ… ç¬¦åˆ PEP 8 ä»£ç è§„èŒƒ
- âœ… å®Œæ•´çš„ç±»å‹æ³¨è§£
- âœ… æ¸…æ™°çš„å­—æ®µæè¿°
- âœ… æ”¯æŒ IDE è‡ªåŠ¨è¡¥å…¨
- âœ… é€šè¿‡ mypy ç±»å‹æ£€æŸ¥

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

### æ–°å¢æ–‡æ¡£
- `docs/user-guide/CODE_GENERATION.md` - ä»£ç ç”Ÿæˆå·¥å…·ä½¿ç”¨æŒ‡å—

### CLI å¸®åŠ©
```bash
# æŸ¥çœ‹å¸®åŠ©
df-test gen models --help

# æŸ¥çœ‹ç¤ºä¾‹
df-test gen models --examples
```

---

## ğŸ¯ é€‚ç”¨åœºæ™¯

ä»£ç ç”Ÿæˆå·¥å…·ç‰¹åˆ«é€‚åˆä»¥ä¸‹åœºæ™¯ï¼š

1. **API å¯¹æ¥**: ä» API æ–‡æ¡£å¿«é€Ÿç”Ÿæˆæ¨¡å‹
2. **æ¥å£æµ‹è¯•**: ä¸ºæµ‹è¯•ç”¨ä¾‹ç”Ÿæˆå“åº”æ¨¡å‹
3. **åŸå‹å¼€å‘**: å¿«é€Ÿåˆ›å»ºæ•°æ®æ¨¡å‹åŸå‹
4. **æ–‡æ¡£åŒæ­¥**: ä¿æŒä»£ç å’Œ API æ–‡æ¡£åŒæ­¥
5. **æ‰¹é‡å¤„ç†**: ä¸€æ¬¡æ€§ç”Ÿæˆå¤šä¸ªæ¨¡å‹

---

## ğŸ’¡ æœ€ä½³å®è·µ

### 1. éªŒè¯ç”Ÿæˆçš„æ¨¡å‹

ç”ŸæˆååŠ¡å¿…æ£€æŸ¥å’Œè°ƒæ•´ï¼š
```python
# æ£€æŸ¥ç±»å‹æ˜¯å¦æ­£ç¡®
# æ·»åŠ éªŒè¯é€»è¾‘
# è¡¥å……å­—æ®µæè¿°
```

### 2. ä½¿ç”¨ç‰ˆæœ¬æ§åˆ¶

ç”Ÿæˆçš„ä»£ç çº³å…¥ç‰ˆæœ¬æ§åˆ¶ï¼š
```bash
git add src/models/responses/user_response.py
git commit -m "feat: æ·»åŠ  UserResponse æ¨¡å‹"
```

### 3. å®šæœŸæ›´æ–°

å½“ API å˜æ›´æ—¶é‡æ–°ç”Ÿæˆï¼š
```bash
# API æ›´æ–°å
curl http://api.example.com/users/1 > user.json
df-test gen models user.json --name UserResponse --force
```

---

## ğŸ”„ å‘åå…¼å®¹æ€§

v3.1.0 **å®Œå…¨å‘åå…¼å®¹** v3.0.0ï¼Œæ‰€æœ‰ç°æœ‰ä»£ç æ— éœ€ä¿®æ”¹ã€‚

---

**å®Œæ•´å˜æ›´æ—¥å¿—**: [CHANGELOG.md](../../CHANGELOG.md#310---2025-11-05)
