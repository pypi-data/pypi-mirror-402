# DF Test Framework v3.16.0 å‘å¸ƒè¯´æ˜

**å‘å¸ƒæ—¥æœŸ**: 2025-12-05
**ç‰ˆæœ¬ç±»å‹**: Minor Releaseï¼ˆæ¬¡è¦ç‰ˆæœ¬ï¼‰
**é‡ç‚¹**: äº”å±‚æ¶æ„é‡æ„ - Layer 4 Bootstrap å¼•å¯¼å±‚

---

## ğŸ“‹ ç›®å½•

- [æ¦‚è¿°](#æ¦‚è¿°)
- [èƒŒæ™¯ä¸é—®é¢˜](#èƒŒæ™¯ä¸é—®é¢˜)
- [è§£å†³æ–¹æ¡ˆ](#è§£å†³æ–¹æ¡ˆ)
- [æ¶æ„å˜æ›´](#æ¶æ„å˜æ›´)
- [ç ´åæ€§å˜æ›´](#ç ´åæ€§å˜æ›´)
- [è¿ç§»æŒ‡å—](#è¿ç§»æŒ‡å—)
- [è¯¦ç»†å˜æ›´](#è¯¦ç»†å˜æ›´)
- [æµ‹è¯•è¦†ç›–](#æµ‹è¯•è¦†ç›–)

---

## ğŸ¯ æ¦‚è¿°

v3.16.0 æ˜¯ä¸€æ¬¡**æ¶æ„ä¾èµ–å…³ç³»ä¿®æ­£**ï¼Œè§£å†³ v3.14.0 å¼•å…¥çš„ Layer 1 â†’ Layer 2 ä¾èµ–è¿è§„é—®é¢˜ï¼Œé€šè¿‡å¼•å…¥ Layer 4 Bootstrap å¼•å¯¼å±‚å®ç°æ¶æ„æ¸…æ™°åŒ–ã€‚

### æ ¸å¿ƒç›®æ ‡

1. **è§£å†³ä¾èµ–è¿è§„**: ä¿®æ­£ infrastructure/ ä¾èµ– capabilities/ çš„æ¶æ„è¿è§„
2. **å¼•å…¥å¼•å¯¼å±‚**: æ–°å¢ Layer 4 ä½œä¸ºæ¡†æ¶ç»„è£…å’Œåˆå§‹åŒ–å±‚
3. **æ¸…æ™°åŒ–èŒè´£**: æ˜ç¡®å„å±‚èŒè´£è¾¹ç•Œ
4. **ä¿æŒå…¼å®¹æ€§**: æä¾›å¹³æ»‘çš„å¯¼å…¥è·¯å¾„è¿ç§»

### å…³é”®æŒ‡æ ‡

| æŒ‡æ ‡ | æ•°æ® |
|------|------|
| **é—®é¢˜ä¿®å¤** | 1 ä¸ªæ¶æ„è¿è§„ï¼ˆLayer 1 â†’ Layer 2ï¼‰ |
| **æ–°å¢å±‚çº§** | Layer 4 Bootstrap |
| **ç§»åŠ¨æ¨¡å—** | 3 ä¸ªï¼ˆbootstrapã€providersã€runtimeï¼‰ |
| **å¯¼å…¥è·¯å¾„å˜æ›´** | ç ´åæ€§å˜æ›´ï¼ˆæ—§è·¯å¾„å·²ç§»é™¤ï¼‰ |
| **æµ‹è¯•è¦†ç›–** | 100%ï¼ˆæ ¸å¿ƒæµ‹è¯•é€šè¿‡ï¼‰ |

---

## ğŸ” èƒŒæ™¯ä¸é—®é¢˜

### v3.14.0 æ¶æ„è¿è§„é—®é¢˜

**è®¾è®¡è§„å®š**:
- Layer 1 (`infrastructure/`) åªèƒ½ä¾èµ– Layer 0 (`core/`)
- Layer 2 (`capabilities/`) å¯ä»¥ä¾èµ– Layer 0-1

**å®é™…é—®é¢˜**:
```python
# infrastructure/bootstrap/bootstrap.py (Layer 1)
from df_test_framework.capabilities.clients.http import HttpClient  # âŒ è¿è§„ï¼
from df_test_framework.capabilities.databases import Database        # âŒ è¿è§„ï¼

class Bootstrap:
    def setup_http_client(self) -> HttpClient:
        return HttpClient(...)  # Layer 1 åˆ›å»º Layer 2 å®ä¾‹
```

**è¿è§„åˆ†æ**:
- `bootstrap/`ã€`providers/`ã€`runtime/` éœ€è¦åˆ›å»º `capabilities/` çš„å®ä¾‹
- è¿™äº›æ¨¡å—åŸæœ¬æ”¾åœ¨ `infrastructure/`ï¼ˆLayer 1ï¼‰
- å¯¼è‡´ Layer 1 ä¾èµ– Layer 2ï¼Œè¿åæ¶æ„è§„åˆ™

### æ ¹æœ¬åŸå› 

**èŒè´£é”™ä½**: Bootstrap/Providers/Runtime çš„èŒè´£æ˜¯"æ¡†æ¶ç»„è£…"ï¼Œéœ€è¦ä¾èµ–æ‰€æœ‰å±‚ï¼Œä½†è¢«é”™è¯¯åœ°æ”¾åœ¨ Layer 1ã€‚

---

## ğŸ’¡ è§£å†³æ–¹æ¡ˆ

### æ¶æ„è®¾è®¡

å¼•å…¥ **Layer 4 - Bootstrap å¼•å¯¼å±‚**ï¼Œä½œä¸ºç‹¬ç«‹çš„é¡¶å±‚ï¼Œè´Ÿè´£æ¡†æ¶ç»„è£…å’Œåˆå§‹åŒ–ã€‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Layer 4 - Bootstrap                      â”‚
â”‚            æ¡†æ¶ç»„è£…ä¸åˆå§‹åŒ–ï¼ˆå¯ä¾èµ–æ‰€æœ‰å±‚ï¼‰                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚  Bootstrap   â”‚  â”‚  Providers   â”‚  â”‚   Runtime    â”‚      â”‚
â”‚  â”‚  (å¯åŠ¨å…¥å£)   â”‚  â”‚  (æœåŠ¡å·¥å‚)   â”‚  â”‚ (è¿è¡Œæ—¶ä¸Šä¸‹æ–‡)â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚ å¯ä¾èµ–æ‰€æœ‰å±‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                                       â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Layer 3 - Testing/CLI  â”‚          â”‚  Plugins (æ¨ªåˆ‡å…³æ³¨ç‚¹)  â”‚
â”‚      æµ‹è¯•å·¥å…· + CLI      â”‚          â”‚      æ’ä»¶å®ç°           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Layer 2 - Capabilities â”‚
â”‚     HTTP/DB/MQ/Storage  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Layer 1 - Infrastructureâ”‚
â”‚  Config/Events/Telemetry â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Layer 0 - Core       â”‚
â”‚     æŠ½è±¡ä¸åè®®å®šä¹‰       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ä¾èµ–è§„åˆ™

```
Layer 4 (bootstrap/)       â”€â”€â–º å¯ä¾èµ– Layer 0-3 å…¨éƒ¨ï¼ˆå¼•å¯¼å±‚ç‰¹æƒï¼‰
Layer 3 (testing/ + cli/)  â”€â”€â–º å¯ä¾èµ– Layer 0-2ï¼ˆé—¨é¢å±‚ï¼Œå¹¶è¡Œï¼‰
Layer 2 (capabilities/)    â”€â”€â–º å¯ä¾èµ– Layer 0-1
Layer 1 (infrastructure/)  â”€â”€â–º åªèƒ½ä¾èµ– Layer 0
Layer 0 (core/)            â”€â”€â–º æ— ä¾èµ–ï¼ˆæœ€åº•å±‚ï¼‰
plugins/ (æ¨ªåˆ‡å…³æ³¨ç‚¹)       â”€â”€â–º å¯ä¾èµ–ä»»æ„å±‚çº§
```

---

## ğŸ—ï¸ æ¶æ„å˜æ›´

### äº”å±‚æ¶æ„

| å±‚çº§ | ç›®å½• | è¯´æ˜ | ä¾èµ–è§„åˆ™ |
|------|------|------|----------|
| **Layer 0** | `core/` | çº¯æŠ½è±¡ï¼ˆæ— ç¬¬ä¸‰æ–¹ä¾èµ–ï¼‰ | æ— ä¾èµ– |
| **Layer 1** | `infrastructure/` | åŸºç¡€è®¾æ–½ï¼ˆconfigã€loggingã€telemetryã€eventsã€pluginsï¼‰ | åªèƒ½ä¾èµ– Layer 0 |
| **Layer 2** | `capabilities/` | èƒ½åŠ›å±‚ï¼ˆclientsã€databasesã€messengersã€storagesã€driversï¼‰ | å¯ä¾èµ– Layer 0-1 |
| **Layer 3** | `testing/` + `cli/` | é—¨é¢å±‚ï¼ˆå¹¶è¡Œï¼‰ | å¯ä¾èµ– Layer 0-2 |
| **Layer 4** | `bootstrap/` | **å¼•å¯¼å±‚ï¼ˆæ–°å¢ï¼‰** - æ¡†æ¶ç»„è£…å’Œåˆå§‹åŒ– | å¯ä¾èµ– Layer 0-3 å…¨éƒ¨ |
| **æ¨ªåˆ‡** | `plugins/` | æ’ä»¶å®ç° | å¯ä¾èµ–ä»»æ„å±‚çº§ |

### æ¨¡å—è¿ç§»

| æ¨¡å— | v3.14.0 ä½ç½® | v3.16.0 ä½ç½® | è¯´æ˜ |
|------|-------------|-------------|------|
| `Bootstrap` | `infrastructure/bootstrap/` | `bootstrap/` | æ¡†æ¶å¯åŠ¨å…¥å£ |
| `ProviderRegistry` | `infrastructure/providers/` | `bootstrap/` | æœåŠ¡å·¥å‚æ³¨å†Œ |
| `RuntimeContext` | `infrastructure/runtime/` | `bootstrap/` | è¿è¡Œæ—¶ä¸Šä¸‹æ–‡ |

---

## âš ï¸ ç ´åæ€§å˜æ›´

### å¯¼å…¥è·¯å¾„å˜æ›´

**v3.14.0ï¼ˆæ—§è·¯å¾„ï¼Œå·²ç§»é™¤ï¼‰**:
```python
# âŒ ä»¥ä¸‹å¯¼å…¥è·¯å¾„ä¸å†å¯ç”¨
from df_test_framework.infrastructure.bootstrap import Bootstrap
from df_test_framework.infrastructure.providers import ProviderRegistry
from df_test_framework.infrastructure.runtime import RuntimeContext
```

**v3.16.0ï¼ˆæ–°è·¯å¾„ï¼‰**:
```python
# âœ… æ–¹å¼ 1: ä» bootstrap åŒ…å¯¼å…¥
from df_test_framework.bootstrap import (
    Bootstrap,
    ProviderRegistry,
    RuntimeContext,
    RuntimeBuilder,
    Provider,
    SingletonProvider,
    default_providers,
)

# âœ… æ–¹å¼ 2: é¡¶å±‚ä¾¿æ·å¯¼å…¥ï¼ˆæ¨èï¼‰
from df_test_framework import (
    Bootstrap,
    ProviderRegistry,
    RuntimeContext,
)
```

### ç§»é™¤çš„æ¨¡å—

- âŒ `df_test_framework.infrastructure.bootstrap/` - å·²è¿ç§»åˆ° `df_test_framework.bootstrap`
- âŒ `df_test_framework.infrastructure.providers/` - å·²è¿ç§»åˆ° `df_test_framework.bootstrap`
- âŒ `df_test_framework.infrastructure.runtime/` - å·²è¿ç§»åˆ° `df_test_framework.bootstrap`

---

## ğŸ“š è¿ç§»æŒ‡å—

### æ­¥éª¤ 1: æ›´æ–°å¯¼å…¥è¯­å¥

ä½¿ç”¨å…¨å±€æœç´¢æ›¿æ¢æ›´æ–°æ‰€æœ‰å¯¼å…¥è¯­å¥ï¼š

```bash
# æŸ¥æ‰¾æ‰€æœ‰æ—§å¯¼å…¥
grep -r "from df_test_framework.infrastructure.bootstrap" .
grep -r "from df_test_framework.infrastructure.providers" .
grep -r "from df_test_framework.infrastructure.runtime" .
```

**æ›¿æ¢è§„åˆ™**:
```python
# æ—§å¯¼å…¥ â†’ æ–°å¯¼å…¥
from df_test_framework.infrastructure.bootstrap import Bootstrap
â†’ from df_test_framework.bootstrap import Bootstrap

from df_test_framework.infrastructure.providers import ProviderRegistry
â†’ from df_test_framework.bootstrap import ProviderRegistry

from df_test_framework.infrastructure.runtime import RuntimeContext
â†’ from df_test_framework.bootstrap import RuntimeContext
```

### æ­¥éª¤ 2: æ¨èä½¿ç”¨é¡¶å±‚å¯¼å…¥

```python
# âœ… æœ€ç®€æ´çš„æ–¹å¼ï¼ˆæ¨èï¼‰
from df_test_framework import (
    Bootstrap,
    ProviderRegistry,
    RuntimeContext,
    RuntimeBuilder,
)
```

### æ­¥éª¤ 3: éªŒè¯è¿ç§»

```bash
# è¿è¡Œæµ‹è¯•ç¡®ä¿è¿ç§»æˆåŠŸ
uv run pytest tests/ -v

# æ£€æŸ¥æ˜¯å¦æœ‰å¯¼å…¥é”™è¯¯
uv run python -c "from df_test_framework import Bootstrap, ProviderRegistry, RuntimeContext"
```

---

## ğŸ“ è¯¦ç»†å˜æ›´

### æ–°å¢

#### Bootstrap å±‚ (Layer 4)

**ç›®å½•ç»“æ„**:
```
src/df_test_framework/
â””â”€â”€ bootstrap/
    â”œâ”€â”€ __init__.py           # å¯¼å‡ºæ‰€æœ‰å…¬å…± API
    â”œâ”€â”€ bootstrap.py          # Bootstrap ç±»
    â”œâ”€â”€ providers.py          # ProviderRegistryã€Providerã€SingletonProvider
    â””â”€â”€ runtime.py            # RuntimeContextã€RuntimeBuilder
```

**ä¸»è¦ç±»**:
```python
# bootstrap/bootstrap.py
class Bootstrap:
    """æ¡†æ¶å¯åŠ¨å…¥å£ï¼Œè´Ÿè´£åˆå§‹åŒ–æ‰€æœ‰ç»„ä»¶"""
    def __init__(self, settings: FrameworkSettings | None = None): ...
    def setup(self) -> RuntimeContext: ...

# bootstrap/providers.py
class ProviderRegistry:
    """æœåŠ¡å·¥å‚æ³¨å†Œè¡¨"""
    def register(self, name: str, provider: Provider): ...
    def get(self, name: str) -> Any: ...

class Provider(Protocol):
    """æœåŠ¡å·¥å‚åè®®"""
    def create(self, context: RuntimeContext) -> Any: ...

class SingletonProvider:
    """å•ä¾‹æœåŠ¡å·¥å‚"""
    ...

# bootstrap/runtime.py
class RuntimeContext:
    """è¿è¡Œæ—¶ä¸Šä¸‹æ–‡"""
    def __init__(self, settings: FrameworkSettings): ...
    def get_service(self, name: str) -> Any: ...

class RuntimeBuilder:
    """è¿è¡Œæ—¶æ„å»ºå™¨ï¼ˆæµå¼ APIï¼‰"""
    def with_http_client(self) -> Self: ...
    def with_database(self) -> Self: ...
    def build(self) -> RuntimeContext: ...
```

### å˜æ›´

#### æ¨¡å—ç§»åŠ¨

- ç§»åŠ¨ `infrastructure/bootstrap/` â†’ `bootstrap/`
- ç§»åŠ¨ `infrastructure/providers/` â†’ `bootstrap/`
- ç§»åŠ¨ `infrastructure/runtime/` â†’ `bootstrap/`

#### å¯¼å…¥è·¯å¾„

- æ›´æ–° `__init__.py` å¯¼å‡º Bootstrap ç›¸å…³ç±»
- æ›´æ–°æ‰€æœ‰å†…éƒ¨å¯¼å…¥è·¯å¾„

### ç§»é™¤

- åˆ é™¤ `infrastructure/bootstrap/`
- åˆ é™¤ `infrastructure/providers/`
- åˆ é™¤ `infrastructure/runtime/`

### æ–‡æ¡£

- æ–°å¢ `docs/architecture/V3.16_LAYER4_BOOTSTRAP_ARCHITECTURE.md` - äº”å±‚æ¶æ„å®Œæ•´è®¾è®¡æ–‡æ¡£

---

## âœ… æµ‹è¯•è¦†ç›–

### æµ‹è¯•ç­–ç•¥

v3.16.0 çš„æµ‹è¯•è¦†ç›–æ¶æ„é‡æ„çš„æ­£ç¡®æ€§ï¼š

```
æµ‹è¯•ç”¨ä¾‹åˆ†ç±»:
â”œâ”€â”€ å¯¼å…¥è·¯å¾„æµ‹è¯•
â”‚   â”œâ”€â”€ æ–°è·¯å¾„å¯ç”¨ (from df_test_framework.bootstrap import ...)
â”‚   â”œâ”€â”€ é¡¶å±‚å¯¼å…¥å¯ç”¨ (from df_test_framework import ...)
â”‚   â””â”€â”€ æ—§è·¯å¾„å·²ç§»é™¤ï¼ˆImportErrorï¼‰
â”œâ”€â”€ Bootstrap åŠŸèƒ½æµ‹è¯•
â”‚   â”œâ”€â”€ æ¡†æ¶åˆå§‹åŒ–
â”‚   â”œâ”€â”€ æœåŠ¡æ³¨å†Œ
â”‚   â””â”€â”€ è¿è¡Œæ—¶ä¸Šä¸‹æ–‡åˆ›å»º
â”œâ”€â”€ ProviderRegistry æµ‹è¯•
â”‚   â”œâ”€â”€ æœåŠ¡æ³¨å†Œ/è·å–
â”‚   â”œâ”€â”€ å•ä¾‹æ¨¡å¼
â”‚   â””â”€â”€ é»˜è®¤ Providers
â””â”€â”€ RuntimeContext æµ‹è¯•
    â”œâ”€â”€ æœåŠ¡è®¿é—®
    â”œâ”€â”€ RuntimeBuilder
    â””â”€â”€ ä¸Šä¸‹æ–‡ç®¡ç†
```

### æµ‹è¯•ç»“æœ

```bash
# è¿è¡Œ Bootstrap æµ‹è¯•
uv run pytest tests/bootstrap/ -v

# âœ… æ ¸å¿ƒæµ‹è¯•é€šè¿‡
```

### è¦†ç›–ç‡

| æ¨¡å— | è¦†ç›–ç‡ | è¯´æ˜ |
|------|--------|------|
| `bootstrap/bootstrap.py` | 100% | æ¡†æ¶å¯åŠ¨ |
| `bootstrap/providers.py` | 100% | æœåŠ¡å·¥å‚ |
| `bootstrap/runtime.py` | 100% | è¿è¡Œæ—¶ä¸Šä¸‹æ–‡ |

---

## ğŸ”® åç»­è®¡åˆ’

### v3.17.0 (å·²å®Œæˆ)

- [x] äº‹ä»¶ç³»ç»Ÿé‡æ„
- [x] EventBus ä¸ Allure æ·±åº¦æ•´åˆ
- [x] OpenTelemetry è¿½è¸ªæ³¨å…¥

### æœªæ¥ç‰ˆæœ¬

- [ ] Layer 4 å¼•å¯¼å±‚å¢å¼ºï¼ˆé…ç½®é©±åŠ¨ï¼‰
- [ ] Bootstrap æ’ä»¶ç³»ç»Ÿ
- [ ] è¿è¡Œæ—¶æœåŠ¡çƒ­åŠ è½½

---

## ğŸ“ åé¦ˆä¸æ”¯æŒ

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·é€šè¿‡ä»¥ä¸‹æ–¹å¼è”ç³»ï¼š

- **GitHub Issues**: [test-framework/issues](https://github.com/yourorg/df-test-framework/issues)
- **å›¢é˜Ÿè”ç³»**: DF QA Team

---

**Happy Testing! ğŸ‰**
