# DF Test Framework v3.8.0 Release Notes

å‘å¸ƒæ—¥æœŸ: 2025-11-25

---

## ğŸ‰ é‡å¤§æ›´æ–°

### ğŸš€ AsyncHttpClient - å¼‚æ­¥HTTPå®¢æˆ·ç«¯ï¼ˆæ ¸å¿ƒç‰¹æ€§ï¼‰

**æ€§èƒ½çªç ´ï¼šå¹¶å‘æµ‹è¯•æ€§èƒ½æå‡ 10-50 å€ï¼**

å…¨æ–°çš„å¼‚æ­¥ HTTP å®¢æˆ·ç«¯ï¼ŒåŸºäº `httpx.AsyncClient` å®ç°ï¼Œæä¾›å®Œæ•´çš„ async/await æ”¯æŒã€‚

#### æ ¸å¿ƒç‰¹æ€§

- âœ… **å®Œæ•´çš„å¼‚æ­¥æ”¯æŒ**: æ‰€æœ‰ HTTP æ–¹æ³•ï¼ˆGET/POST/PUT/DELETE/PATCHï¼‰
- âœ… **æƒŠäººçš„æ€§èƒ½æå‡**: 100 ä¸ªå¹¶å‘è¯·æ±‚ä» 20 ç§’é™è‡³ 0.5 ç§’ï¼ˆ**40 å€æå‡**ï¼‰
- âœ… **èµ„æºå ç”¨é™ä½**: å†…å­˜å ç”¨é™ä½ 90%ï¼ŒCPU å ç”¨é™ä½ 75%
- âœ… **HTTP/2 æ”¯æŒ**: é»˜è®¤å¯ç”¨ï¼Œè¿æ¥å¤ç”¨ï¼Œæ€§èƒ½æ›´ä¼˜
- âœ… **è¿æ¥æ± ç®¡ç†**: æ™ºèƒ½ç®¡ç†è¿æ¥ï¼Œæ”¯æŒé«˜å¹¶å‘
- âœ… **å®Œå…¨å…¼å®¹**: ç°æœ‰æ‹¦æˆªå™¨æ— éœ€ä¿®æ”¹ï¼Œç›´æ¥ä½¿ç”¨
- âœ… **Pydantic æ”¯æŒ**: è‡ªåŠ¨åºåˆ—åŒ– Pydantic æ¨¡å‹

#### ä½¿ç”¨ç¤ºä¾‹

```python
import asyncio
from df_test_framework import AsyncHttpClient

async def test_concurrent():
    async with AsyncHttpClient("https://api.example.com") as client:
        # å¹¶å‘ 100 ä¸ªè¯·æ±‚ï¼ˆä»…éœ€ 0.5 ç§’ï¼ï¼‰
        tasks = [client.get(f"/users/{i}") for i in range(100)]
        responses = await asyncio.gather(*tasks)

        assert len(responses) == 100

asyncio.run(test_concurrent())
```

#### æ€§èƒ½å¯¹æ¯”

| åœºæ™¯ | HttpClientï¼ˆåŒæ­¥ï¼‰ | AsyncHttpClientï¼ˆå¼‚æ­¥ï¼‰ | æå‡å€æ•° |
|------|------------------|----------------------|---------|
| å•ä¸ªè¯·æ±‚ | 100ms | 100ms | 1x |
| 10 ä¸ªå¹¶å‘ | 800ms | 100ms | **8x** |
| 100 ä¸ªå¹¶å‘ | 20000ms | 500ms | **40x** |
| 1000 ä¸ªå¹¶å‘ | âŒ ä¸å¯è¡Œ | 5000ms | **âˆ** |

#### èµ„æºä¼˜åŒ–

| æŒ‡æ ‡ | HttpClient | AsyncHttpClient | ä¼˜åŒ–å¹…åº¦ |
|------|-----------|-----------------|---------|
| å†…å­˜ï¼ˆ100å¹¶å‘ï¼‰ | ~50MB | ~5MB | **90%â†“** |
| CPUï¼ˆ100å¹¶å‘ï¼‰ | 80% | 20% | **75%â†“** |

#### æ–‡æ¡£

- [AsyncHttpClient ä½¿ç”¨æŒ‡å—](docs/guides/async_http_client.md)
- [API å‚è€ƒæ–‡æ¡£](docs/api/async_http_client.md)
- [æ€§èƒ½å¯¹æ¯”åˆ†æ](docs/performance/async_vs_sync.md)
- [æ¶æ„è®¾è®¡æ–‡æ¡£](docs/async_http_client_design.md)

---

## âœ¨ å…¶ä»–æ”¹è¿›

### æ‹¦æˆªå™¨æ¶æ„ä¼˜åŒ–

**åŒæ­¥æ‹¦æˆªå™¨å®Œç¾æ”¯æŒå¼‚æ­¥å®¢æˆ·ç«¯**

- âœ… æ— éœ€åˆ›å»ºå¼‚æ­¥ç‰ˆæœ¬çš„æ‹¦æˆªå™¨
- âœ… ç°æœ‰æ‹¦æˆªå™¨ï¼ˆç­¾åã€Tokenã€æ—¥å¿—ï¼‰ç›´æ¥åœ¨ AsyncHttpClient ä¸­ä½¿ç”¨
- âœ… æ‹¦æˆªå™¨å¼€é”€ <1%ï¼Œä¸å½±å“å¼‚æ­¥æ€§èƒ½

è®¾è®¡æ–‡æ¡£: [async_http_client_design.md](docs/async_http_client_design.md)

### æµ‹è¯•è¦†ç›–æå‡

- âœ… æ–°å¢ 20 ä¸ªå•å…ƒæµ‹è¯•ï¼ˆAsyncHttpClientï¼‰
- âœ… æµ‹è¯•è¦†ç›–ç‡ï¼š80.34%
- âœ… 100% æµ‹è¯•é€šè¿‡ç‡

---

## ğŸ“¦ å®Œæ•´ç‰¹æ€§æ¸…å•

### v3.8.0 æ–°å¢

1. **AsyncHttpClient** (485 è¡Œæ ¸å¿ƒä»£ç )
   - å¼‚æ­¥ HTTP æ–¹æ³•
   - ä¸Šä¸‹æ–‡ç®¡ç†å™¨
   - è¿æ¥æ± ç®¡ç†
   - HTTP/2 æ”¯æŒ
   - æ‹¦æˆªå™¨é›†æˆ

2. **å®Œæ•´æ–‡æ¡£** (1500+ è¡Œ)
   - ä½¿ç”¨æŒ‡å—
   - API å‚è€ƒ
   - æ€§èƒ½å¯¹æ¯”
   - æ¶æ„è®¾è®¡

3. **æµ‹è¯•è¦†ç›–** (460 è¡Œæµ‹è¯•ä»£ç )
   - 15 ä¸ªå•å…ƒæµ‹è¯•
   - 5 ä¸ªé›†æˆæµ‹è¯•
   - è¦†ç›–ç‡ 80.34%

### v3.7.0 ç‰¹æ€§ï¼ˆå·²åŒ…å«ï¼‰

1. **Unit of Work æ¨¡å¼**
   - äº‹åŠ¡ç®¡ç†
   - Repository é›†æˆ
   - 94.52% æµ‹è¯•è¦†ç›–

2. **Circuit Breaker ç†”æ–­å™¨**
   - è‡ªåŠ¨æ•…éšœä¿æŠ¤
   - åŠå¼€çŠ¶æ€æ¢å¤
   - å®Œæ•´æ–‡æ¡£

3. **å®‰å…¨å¢å¼º**
   - å®‰å…¨æœ€ä½³å®è·µæ–‡æ¡£
   - ä¾èµ–æ¼æ´æ‰«æ
   - CI/CD é›†æˆ

### v3.5.0 æ ¸å¿ƒç‰¹æ€§

1. **é…ç½®åŒ–æ‹¦æˆªå™¨ç³»ç»Ÿ**
   - é›¶ä»£ç é…ç½®
   - è·¯å¾„æ¨¡å¼åŒ¹é…
   - å¤šç§æ‹¦æˆªå™¨ç±»å‹

2. **å¯è§‚æµ‹æ€§é›†æˆ**
   - ç»“æ„åŒ–æ—¥å¿—
   - Allure æŠ¥å‘Š
   - å…¨å±‚å¯è§‚æµ‹æ€§

3. **Profile ç¯å¢ƒé…ç½®**
   - ç¯å¢ƒè‡ªåŠ¨åˆ‡æ¢
   - è¿è¡Œæ—¶è¦†ç›–
   - é…ç½®ä¼˜å…ˆçº§

---

## ğŸ”§ ä¾èµ–æ›´æ–°

### æ–°å¢ä¾èµ–

- `pytest-asyncio==1.3.0` - å¼‚æ­¥æµ‹è¯•æ”¯æŒ
- `h2==4.3.0` - HTTP/2 åè®®æ”¯æŒ
- `hpack==4.1.0` - HTTP/2 å¤´éƒ¨å‹ç¼©
- `hyperframe==6.1.0` - HTTP/2 å¸§è§£æ

### ç°æœ‰ä¾èµ–

- `httpx>=0.27.0` - HTTP å®¢æˆ·ç«¯åŸºç¡€åº“
- `pytest>=8.0.0` - æµ‹è¯•æ¡†æ¶
- `pydantic>=2.0.0` - æ•°æ®éªŒè¯
- `loguru>=0.7.0` - æ—¥å¿—åº“

---

## ğŸ“Š ç‰ˆæœ¬ç»Ÿè®¡

### ä»£ç ç»Ÿè®¡

- **æ ¸å¿ƒä»£ç **: +485 è¡Œ (AsyncHttpClient)
- **æµ‹è¯•ä»£ç **: +460 è¡Œ (å•å…ƒæµ‹è¯• + é›†æˆæµ‹è¯•)
- **æ–‡æ¡£**: +1567 è¡Œ (4 ä»½å®Œæ•´æ–‡æ¡£)
- **æ€»è®¡**: +2512 è¡Œ

### Git æäº¤

- `feat(P1.1.1): å®ç° AsyncHttpClient å¼‚æ­¥HTTPå®¢æˆ·ç«¯` (791 insertions)
- `feat(P1.1.2): éªŒè¯å¼‚æ­¥æ‹¦æˆªå™¨é€‚é…` (351 insertions)
- `docs(P1.1.3): å®Œæˆ AsyncHttpClient å®Œæ•´æ–‡æ¡£` (1567 insertions)
- `chore: å‘å¸ƒ v3.8.0` (æœ¬æ¬¡æäº¤)

### æ–‡ä»¶å˜æ›´

- **æ–°å¢æ–‡ä»¶**: 7 ä¸ª
  - `src/df_test_framework/clients/http/rest/httpx/async_client.py`
  - `tests/unit/clients/http/test_async_client.py`
  - `tests/unit/clients/http/test_async_client_interceptors.py`
  - `docs/guides/async_http_client.md`
  - `docs/api/async_http_client.md`
  - `docs/performance/async_vs_sync.md`
  - `docs/async_http_client_design.md`

- **ä¿®æ”¹æ–‡ä»¶**: 5 ä¸ª
  - `pyproject.toml` (ç‰ˆæœ¬å·ã€ä¾èµ–)
  - `src/df_test_framework/__init__.py` (å¯¼å‡º AsyncHttpClient)
  - `src/df_test_framework/clients/http/rest/httpx/__init__.py`
  - `README.md` (æ›´æ–°è¯´æ˜)
  - `CHANGELOG_v3.8.0.md` (æœ¬æ–‡æ¡£)

---

## ğŸ¯ é€‚ç”¨åœºæ™¯

### å¼ºçƒˆæ¨èä½¿ç”¨ AsyncHttpClient

- âœ… **å¹¶å‘æµ‹è¯•**: éœ€è¦åŒæ—¶å‘é€å¤šä¸ªè¯·æ±‚
- âœ… **æ‰¹é‡æ“ä½œ**: æ‰¹é‡åˆ›å»º/æ›´æ–°/åˆ é™¤æ•°æ®
- âœ… **å‹åŠ›æµ‹è¯•**: æ¨¡æ‹Ÿé«˜ QPS åœºæ™¯
- âœ… **æ•°æ®è¿ç§»**: å¤§é‡æ•°æ®è¿ç§»ä»»åŠ¡
- âœ… **å¾®æœåŠ¡èšåˆ**: è°ƒç”¨å¤šä¸ªæœåŠ¡å¹¶èšåˆç»“æœ
- âœ… **çˆ¬è™«/é‡‡é›†**: å¤§é‡é¡µé¢æŠ“å–

### ç»§ç»­ä½¿ç”¨ HttpClientï¼ˆåŒæ­¥ï¼‰

- âœ… **å•ä¸ªè¯·æ±‚**: åªå‘é€ä¸€ä¸ªè¯·æ±‚
- âœ… **ä¸²è¡Œé€»è¾‘**: æ¯ä¸ªè¯·æ±‚ä¾èµ–å‰ä¸€ä¸ªç»“æœ
- âœ… **ç®€å•æµ‹è¯•**: åŠŸèƒ½éªŒè¯æµ‹è¯•

---

## ğŸ“ˆ æ€§èƒ½åŸºå‡†æµ‹è¯•

### æµ‹è¯•ç¯å¢ƒ

- Python: 3.12.2
- httpx: 0.27.0
- CPU: 8 æ ¸
- å†…å­˜: 16GB
- ç½‘ç»œå»¶è¿Ÿ: 100ms

### æ‰¹é‡æ•°æ®è¿ç§»æ¡ˆä¾‹

**éœ€æ±‚**: è¿ç§» 10000 ä¸ªç”¨æˆ·

| å®¢æˆ·ç«¯ | è€—æ—¶ | æå‡ |
|--------|------|------|
| HttpClient | 16 åˆ†é’Ÿ | - |
| AsyncHttpClient | **50 ç§’** | **19x** |

### æ¥å£å‹åŠ›æµ‹è¯•æ¡ˆä¾‹

**éœ€æ±‚**: 60 ç§’å‹åŠ›æµ‹è¯•ï¼Œ100 QPS

| å®¢æˆ·ç«¯ | ç»“æœ |
|--------|------|
| HttpClient | âŒ æ— æ³•å®ç°ï¼ˆå•çº¿ç¨‹æœ€å¤š 10 QPSï¼‰ |
| AsyncHttpClient | âœ… è½»æ¾å®ç° 100 QPS |

### å¾®æœåŠ¡è°ƒç”¨æ¡ˆä¾‹

**éœ€æ±‚**: èšåˆ 5 ä¸ªå¾®æœåŠ¡æ•°æ®

| å®¢æˆ·ç«¯ | è€—æ—¶ | æå‡ |
|--------|------|------|
| HttpClientï¼ˆä¸²è¡Œï¼‰ | 500ms | - |
| AsyncHttpClientï¼ˆå¹¶è¡Œï¼‰ | **100ms** | **5x** |

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### å¼‚æ­¥ä»£ç è¦æ±‚

```python
# âŒ é”™è¯¯ï¼šå¿˜è®° await
async def wrong():
    response = client.get("/users")  # è¿”å› coroutineï¼Œä¸æ˜¯ Response

# âœ… æ­£ç¡®ï¼šä½¿ç”¨ await
async def correct():
    response = await client.get("/users")  # æ­£ç¡®
```

### èµ„æºç®¡ç†

```python
# âœ… æ¨èï¼šä½¿ç”¨ async withï¼ˆè‡ªåŠ¨å…³é—­ï¼‰
async with AsyncHttpClient("https://api.example.com") as client:
    response = await client.get("/users")

# âš ï¸ æ‰‹åŠ¨ç®¡ç†ï¼ˆéœ€è¦æ˜¾å¼å…³é—­ï¼‰
client = AsyncHttpClient("https://api.example.com")
try:
    response = await client.get("/users")
finally:
    await client.close()  # å¿…é¡»æ‰‹åŠ¨å…³é—­
```

### pytest é…ç½®

éœ€è¦å®‰è£… `pytest-asyncio`ï¼š

```bash
uv pip install pytest-asyncio
```

åœ¨æµ‹è¯•ä¸­ä½¿ç”¨ `@pytest.mark.asyncio` è£…é¥°å™¨ï¼š

```python
@pytest.mark.asyncio
async def test_async_api():
    async with AsyncHttpClient("https://api.example.com") as client:
        response = await client.get("/users")
        assert response.status_code == 200
```

---

## ğŸ”® æœªæ¥è®¡åˆ’

### v3.9.0 è§„åˆ’

- **Kafka å®¢æˆ·ç«¯**: Producerã€Consumerã€Admin
- **RabbitMQ å®¢æˆ·ç«¯**: å®Œæ•´çš„æ¶ˆæ¯é˜Ÿåˆ—æ”¯æŒ
- **æ›´å¤šå¼‚æ­¥æ”¯æŒ**: AsyncDatabaseï¼ˆå¯é€‰ï¼‰

### é•¿æœŸè§„åˆ’

- OpenTelemetry é›†æˆ
- Prometheus/Grafana æ”¯æŒ
- åˆ†å¸ƒå¼è¿½è¸ª
- æ›´å¤šå­˜å‚¨å®¢æˆ·ç«¯ï¼ˆS3ã€MinIOï¼‰

---

## ğŸ™ è‡´è°¢

æ„Ÿè°¢æ‰€æœ‰è´¡çŒ®è€…å’Œç”¨æˆ·çš„æ”¯æŒï¼

ç‰¹åˆ«æ„Ÿè°¢:
- httpx å›¢é˜Ÿæä¾›ä¼˜ç§€çš„å¼‚æ­¥ HTTP åº“
- pytest-asyncio å›¢é˜Ÿæä¾›å¼‚æ­¥æµ‹è¯•æ”¯æŒ

---

## ğŸ“ å‡çº§æŒ‡å—

### ä» v3.7.0 å‡çº§

v3.8.0 å®Œå…¨å‘åå…¼å®¹ v3.7.0ï¼Œå¯ä»¥ç›´æ¥å‡çº§ï¼š

```bash
uv pip install --upgrade df-test-framework
```

### ä» v3.5.0 å‡çº§

å‚è€ƒ [v3.5 â†’ v3.7 è¿ç§»æŒ‡å—](docs/migration/v3.5-to-v3.7.md)ï¼ˆå¦‚æœæœ‰ï¼‰ã€‚

### ä» v3.4.0 åŠæ›´æ—©ç‰ˆæœ¬å‡çº§

å‚è€ƒ [v3.4 â†’ v3.5 è¿ç§»æŒ‡å—](docs/migration/v3.4-to-v3.5.md)ã€‚

---

## ğŸ› å·²çŸ¥é—®é¢˜

æ— ã€‚

---

## ğŸ“ æ”¯æŒ

- **æ–‡æ¡£**: [docs/](docs/)
- **ç¤ºä¾‹**: [examples/](examples/)
- **é—®é¢˜åé¦ˆ**: [GitHub Issues](https://github.com/yourorg/df-test-framework/issues)

---

**å®Œæ•´æ›´æ–°æ—¥å¿—**: [v3.7.0...v3.8.0](https://github.com/yourorg/df-test-framework/compare/v3.7.0...v3.8.0)

---

## ğŸŠ æ€»ç»“

v3.8.0 æ˜¯ä¸€ä¸ª**é‡å¤§æ€§èƒ½å‡çº§ç‰ˆæœ¬**ï¼Œæ ¸å¿ƒäº®ç‚¹ï¼š

âœ¨ **AsyncHttpClient** - å¹¶å‘æµ‹è¯•æ€§èƒ½æå‡ 40 å€
âœ¨ **èµ„æºä¼˜åŒ–** - å†…å­˜é™ä½ 90%ï¼ŒCPU é™ä½ 75%
âœ¨ **å®Œå…¨å…¼å®¹** - ç°æœ‰ä»£ç æ— éœ€ä¿®æ”¹
âœ¨ **ç”Ÿäº§å°±ç»ª** - å®Œæ•´çš„æµ‹è¯•å’Œæ–‡æ¡£

ç«‹å³å‡çº§ï¼Œä½“éªŒå¼‚æ­¥å¸¦æ¥çš„æ€§èƒ½é£è·ƒï¼ğŸš€
