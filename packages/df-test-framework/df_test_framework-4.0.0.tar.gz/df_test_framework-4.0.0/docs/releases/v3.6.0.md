# DF Test Framework v3.6.0 Release Notes

å‘å¸ƒæ—¥æœŸ: 2025-11-12

---

## ğŸ‰ é‡å¤§æ›´æ–°

### ğŸ¯ Decimal åºåˆ—åŒ–ç°ä»£åŒ– - é›¶é…ç½®é‡‘èæ•°å€¼å¤„ç†ï¼ˆæ ¸å¿ƒç‰¹æ€§ï¼‰

**çªç ´æ€§ç®€åŒ–ï¼šå‘Šåˆ«æ‰‹åŠ¨é…ç½®ï¼ŒHttpClient è‡ªåŠ¨å¤„ç† Decimal ç±»å‹ï¼**

v3.6.0 ä¸“æ³¨äºç®€åŒ– Decimal ç±»å‹çš„ä½¿ç”¨ï¼Œæä¾›ç°ä»£åŒ–çš„åºåˆ—åŒ–æ–¹æ¡ˆï¼Œè®©é‡‘èæ•°å€¼å¤„ç†å˜å¾—ä¼˜é›…ç®€å•ã€‚

#### æ ¸å¿ƒç‰¹æ€§

- âœ… **é›¶é…ç½®è®¾è®¡**: ç›´æ¥ä½¿ç”¨æ ‡å‡† Decimal ç±»å‹ï¼Œæ— éœ€ç‰¹æ®Šæ³¨è§£
- âœ… **Pydantic æ¨¡å‹è‡ªåŠ¨åºåˆ—åŒ–**: HttpClient åŸç”Ÿæ”¯æŒ Pydantic æ¨¡å‹
- âœ… **è‡ªåŠ¨ç±»å‹å¤„ç†**: Decimal â†’ å­—ç¬¦ä¸², datetime â†’ ISO 8601, UUID â†’ å­—ç¬¦ä¸²
- âœ… **æ€§èƒ½ä¼˜åŒ–**: ä½¿ç”¨ Pydantic v2 çš„ Rust æ ¸å¿ƒ
- âœ… **å‘åå…¼å®¹**: ä»ç„¶æ”¯æŒä¼ å…¥å­—å…¸
- âœ… **ç±»å‹å·¥å…·æ¨¡å—**: æä¾›ç‰¹æ®Šåœºæ™¯ä½¿ç”¨çš„ç±»å‹å·¥å…·

---

## âœ¨ åŠŸèƒ½è¯¦è§£

### 1. HttpClient æ”¯æŒ Pydantic æ¨¡å‹è‡ªåŠ¨åºåˆ—åŒ–

**ä¿®æ”¹æ–‡ä»¶**: `src/df_test_framework/clients/http/rest/httpx/client.py`

HttpClient ç°åœ¨å¯ä»¥ç›´æ¥æ¥æ”¶ Pydantic æ¨¡å‹ï¼Œè‡ªåŠ¨ä½¿ç”¨ `model_dump_json()` åºåˆ—åŒ–ï¼š

#### ä½¿ç”¨ç¤ºä¾‹

```python
from pydantic import BaseModel
from decimal import Decimal

# âœ… v3.6.0 æ–°æ–¹å¼ - ç›´æ¥ä½¿ç”¨ Decimal
class PaymentRequest(BaseModel):
    amount: Decimal  # ä¸éœ€è¦ DecimalAsStr
    discount: Decimal
    total: Decimal

request = PaymentRequest(
    amount=Decimal("123.45"),
    discount=Decimal("10.50"),
    total=Decimal("112.95")
)

# âœ… HttpClient è‡ªåŠ¨åºåˆ—åŒ–
response = http_client.post("/api/payment", json=request)
# å‘é€çš„ JSON: {"amount":"123.45", "discount":"10.50", "total":"112.95"}
```

#### v3.5 vs v3.6 å¯¹æ¯”

**v3.5 åŠä¹‹å‰ï¼ˆéœ€è¦æ‰‹åŠ¨å¤„ç†ï¼‰**:

```python
# âŒ æ—§æ–¹å¼ï¼šéœ€è¦è‡ªå®šä¹‰ç±»å‹
from typing import Annotated
from pydantic import PlainSerializer

DecimalAsStr = Annotated[
    Decimal,
    PlainSerializer(lambda x: str(x), return_type=str, when_used='json')
]

class Request(BaseModel):
    amount: DecimalAsStr  # æ¯ä¸ªå­—æ®µéƒ½è¦ç”¨ DecimalAsStr
    discount: DecimalAsStr  # é‡å¤å®šä¹‰ç±»å‹
    total: DecimalAsStr
```

**v3.6+ï¼ˆé›¶é…ç½®ï¼‰**:

```python
# âœ… æ–°æ–¹å¼ï¼šç›´æ¥ä½¿ç”¨ Decimal
from decimal import Decimal

class Request(BaseModel):
    amount: Decimal  # HttpClient è‡ªåŠ¨å¤„ç†
    discount: Decimal
    total: Decimal

response = http_client.post("/api", json=request)  # è‡ªåŠ¨åºåˆ—åŒ–
```

#### è‡ªåŠ¨å¤„ç†çš„ç±»å‹

| Python ç±»å‹ | JSON è¡¨ç¤º | ç¤ºä¾‹ |
|------------|-----------|------|
| `Decimal` | å­—ç¬¦ä¸² | `"123.45"` |
| `datetime` | ISO 8601 | `"2025-11-12T10:30:00"` |
| `UUID` | å­—ç¬¦ä¸² | `"550e8400-e29b-41d4-a716-446655440000"` |
| `Enum` | å€¼ | `"active"` |
| `Path` | å­—ç¬¦ä¸² | `"/path/to/file"` |

---

### 2. ç±»å‹å·¥å…·æ¨¡å—

**æ–°å¢æ–‡ä»¶**: `src/df_test_framework/utils/types.py`

æä¾›ç‰¹æ®Šåœºæ™¯ä½¿ç”¨çš„ç±»å‹å·¥å…·ï¼š

```python
from df_test_framework import Decimal, DecimalAsFloat, DecimalAsCurrency

# åœºæ™¯ 1: é»˜è®¤ç”¨æ³•ï¼ˆ99%ï¼‰
class Request(BaseModel):
    amount: Decimal  # âœ… åºåˆ—åŒ–ä¸º "123.45"

# åœºæ™¯ 2: æµ®ç‚¹æ•°æ ¼å¼ï¼ˆå…¼å®¹è€æ—§ APIï¼‰
class LegacyRequest(BaseModel):
    price: DecimalAsFloat  # åºåˆ—åŒ–ä¸º 99.99

# åœºæ™¯ 3: è´§å¸æ ¼å¼ï¼ˆæ˜¾ç¤ºå±‚ï¼‰
class DisplayRequest(BaseModel):
    total: DecimalAsCurrency  # åºåˆ—åŒ–ä¸º "$123.45"
```

**å¯¼å‡ºç±»å‹**:
- `Decimal`: æ ‡å‡† Decimal ç±»å‹ï¼ˆä¾¿æ·å¯¼å…¥ï¼‰
- `DecimalAsFloat`: åºåˆ—åŒ–ä¸ºæµ®ç‚¹æ•°
- `DecimalAsCurrency`: åºåˆ—åŒ–ä¸ºè´§å¸æ ¼å¼ `$xxx.xx`

---

### 3. Decimal ä½¿ç”¨æŒ‡å—

**æ–°å¢æ–‡æ¡£**: `docs/user-guide/DECIMAL_GUIDE.md`

å®Œæ•´çš„ Decimal ä½¿ç”¨æŒ‡å—ï¼ŒåŒ…å«ï¼š
- ä¸ºä»€ä¹ˆä½¿ç”¨ Decimalï¼ˆæµ®ç‚¹æ•°ç²¾åº¦é—®é¢˜ï¼‰
- æ¨èç”¨æ³•ï¼ˆé›¶é…ç½®ï¼‰
- å·¥ä½œåŸç†ï¼ˆåºåˆ—åŒ–æµç¨‹ï¼‰
- ç‰¹æ®Šæ ¼å¼éœ€æ±‚ï¼ˆè‡ªå®šä¹‰åºåˆ—åŒ–ï¼‰
- å¸¸è§é—®é¢˜ FAQ

---

## ğŸ”§ æŠ€æœ¯ç»†èŠ‚

### åºåˆ—åŒ–æµç¨‹

```python
# 1. ç”¨æˆ·ä»£ç 
request = PaymentRequest(amount=Decimal("123.45"))

# 2. HttpClient æ£€æµ‹åˆ° Pydantic æ¨¡å‹
if isinstance(json, BaseModel):
    # 3. ä½¿ç”¨ model_dump_json() åºåˆ—åŒ–
    json_str = json.model_dump_json()
    # ç»“æœ: '{"amount":"123.45"}'

    # 4. è®¾ç½®æ­£ç¡®çš„ Content-Type
    headers['Content-Type'] = 'application/json'
```

### ä¸ºä»€ä¹ˆä½¿ç”¨ Decimal

```python
# âŒ æµ®ç‚¹æ•°ç²¾åº¦é—®é¢˜
0.1 + 0.2  # ç»“æœ: 0.30000000000000004

# âœ… Decimal ç²¾ç¡®è®¡ç®—
Decimal("0.1") + Decimal("0.2")  # ç»“æœ: Decimal('0.3')

# é‡‘èåœºæ™¯ç¤ºä¾‹
price = Decimal("19.99")
quantity = 3
total = price * quantity  # Decimal('59.97') - ç²¾ç¡®
```

---

## ğŸ“¦ å®Œæ•´ç‰¹æ€§æ¸…å•

### v3.6.0 æ–°å¢

1. **HttpClient Pydantic æ”¯æŒ**
   - è‡ªåŠ¨æ£€æµ‹ Pydantic æ¨¡å‹
   - ä½¿ç”¨ `model_dump_json()` åºåˆ—åŒ–
   - è‡ªåŠ¨è®¾ç½® Content-Type

2. **ç±»å‹å·¥å…·æ¨¡å—**
   - `Decimal` ä¾¿æ·å¯¼å…¥
   - `DecimalAsFloat` æµ®ç‚¹æ•°åºåˆ—åŒ–
   - `DecimalAsCurrency` è´§å¸æ ¼å¼

3. **å®Œæ•´æ–‡æ¡£**
   - Decimal ä½¿ç”¨æŒ‡å—
   - æœ€ä½³å®è·µè¯´æ˜
   - è¿ç§»æŒ‡å—

---

## ğŸ¯ é€‚ç”¨åœºæ™¯

### å¼ºçƒˆæ¨èä½¿ç”¨åœºæ™¯

- âœ… **é‡‘èç³»ç»Ÿ**: æ”¯ä»˜ã€è®¢å•ã€è´¦å•ç­‰æ¶‰åŠé‡‘é¢è®¡ç®—
- âœ… **ç”µå•†å¹³å°**: å•†å“ä»·æ ¼ã€æŠ˜æ‰£è®¡ç®—ã€è´­ç‰©è½¦æ€»ä»·
- âœ… **è®¡è´¹ç³»ç»Ÿ**: ç²¾ç¡®çš„è®¡è´¹è®¡ç®—å’Œè´¦å•ç”Ÿæˆ
- âœ… **ç»Ÿè®¡æŠ¥è¡¨**: éœ€è¦ç²¾ç¡®æ•°å€¼çš„ç»Ÿè®¡è®¡ç®—
- âœ… **ç§‘å­¦è®¡ç®—**: éœ€è¦é«˜ç²¾åº¦çš„æ•°å€¼è®¡ç®—

---

## ğŸ“ˆ æ€§èƒ½å½±å“

- âœ… ä½¿ç”¨ Pydantic v2 çš„ Rust æ ¸å¿ƒï¼Œåºåˆ—åŒ–æ€§èƒ½æå‡
- âœ… å‡å°‘ç”¨æˆ·ä»£ç é‡ï¼ˆæ— éœ€å®šä¹‰ DecimalAsStrï¼‰
- âœ… æ— é¢å¤–è¿è¡Œæ—¶å¼€é”€
- âœ… å†…å­˜å ç”¨æ— å˜åŒ–

---

## âš ï¸ è¿ç§»æŒ‡å—

### ä» v3.5 å‡çº§åˆ° v3.6

v3.6.0 å®Œå…¨å‘åå…¼å®¹ v3.5.0ï¼Œå¯ä»¥ç›´æ¥å‡çº§ï¼š

```bash
uv pip install --upgrade df-test-framework
```

### è¿ç§»è‡ªå®šä¹‰ DecimalAsStr ç±»å‹

å¦‚æœé¡¹ç›®ä¸­æœ‰è‡ªå®šä¹‰çš„ `DecimalAsStr` ç±»å‹ï¼š

```python
# æ­¥éª¤ 1: å…¨å±€æœç´¢æ›¿æ¢
# DecimalAsStr â†’ Decimal

# æ­¥éª¤ 2: æ›´æ–°å¯¼å…¥
# from project.models.base import DecimalAsStr
# â†“
from decimal import Decimal

# æ­¥éª¤ 3: è¿è¡Œæµ‹è¯•éªŒè¯
pytest tests/ -v
```

**æ³¨æ„**: æ­¤å˜æ›´**ä¸å½±å“**å“åº”æ¨¡å‹çš„ååºåˆ—åŒ–ï¼Œå“åº”æ¨¡å‹ç»§ç»­ä½¿ç”¨ `Decimal` å³å¯ã€‚

---

## ğŸ“Š ä»£ç ç¤ºä¾‹

### å®Œæ•´çš„æ”¯ä»˜åœºæ™¯ç¤ºä¾‹

```python
from pydantic import BaseModel
from decimal import Decimal
from df_test_framework import HttpClient

# å®šä¹‰è¯·æ±‚æ¨¡å‹
class PaymentRequest(BaseModel):
    order_id: str
    amount: Decimal
    currency: str
    discount: Decimal | None = None

# å®šä¹‰å“åº”æ¨¡å‹
class PaymentResponse(BaseModel):
    payment_id: str
    status: str
    final_amount: Decimal

# ä½¿ç”¨ HttpClient
client = HttpClient("https://api.example.com")

# å‘é€æ”¯ä»˜è¯·æ±‚
request = PaymentRequest(
    order_id="ORD-12345",
    amount=Decimal("199.99"),
    currency="USD",
    discount=Decimal("20.00")
)

# è‡ªåŠ¨åºåˆ—åŒ–å¹¶å‘é€
response = client.post("/api/payments", json=request)

# ååºåˆ—åŒ–å“åº”
payment = PaymentResponse.model_validate(response.json())

# éªŒè¯é‡‘é¢è®¡ç®—
assert payment.final_amount == Decimal("179.99")
```

---

## ğŸ“š æ–‡æ¡£æ›´æ–°

### æ–°å¢æ–‡æ¡£

1. `docs/user-guide/DECIMAL_GUIDE.md` - Decimal å®Œæ•´ä½¿ç”¨æŒ‡å—
2. HttpClient æ–¹æ³•æ·»åŠ è¯¦ç»†çš„ docstring å’Œç¤ºä¾‹

### æ›´æ–°æ–‡æ¡£

1. API æ–‡æ¡£æ›´æ–°ï¼Œè¯´æ˜ HttpClient æ”¯æŒ Pydantic æ¨¡å‹
2. æ·»åŠ  Decimal æœ€ä½³å®è·µè¯´æ˜
3. æ›´æ–°è¿ç§»æŒ‡å—

---

## ğŸ’¡ æœ€ä½³å®è·µ

### 1. ç»Ÿä¸€ä½¿ç”¨ Decimal

```python
# âœ… æ¨èï¼šæ‰€æœ‰é‡‘é¢å­—æ®µä½¿ç”¨ Decimal
class Order(BaseModel):
    subtotal: Decimal
    tax: Decimal
    shipping: Decimal
    total: Decimal

# âŒ ä¸æ¨èï¼šæ··ç”¨ float å’Œ Decimal
class BadOrder(BaseModel):
    subtotal: float  # ç²¾åº¦é—®é¢˜
    total: Decimal
```

### 2. å­—ç¬¦ä¸²åˆå§‹åŒ– Decimal

```python
# âœ… æ¨èï¼šä½¿ç”¨å­—ç¬¦ä¸²
amount = Decimal("19.99")

# âŒ ä¸æ¨èï¼šä½¿ç”¨æµ®ç‚¹æ•°ï¼ˆç²¾åº¦ä¸¢å¤±ï¼‰
amount = Decimal(19.99)  # å¯èƒ½å¾—åˆ° 19.989999999999998
```

### 3. å“åº”æ¨¡å‹éªŒè¯

```python
# âœ… å“åº”æ¨¡å‹ä¹Ÿä½¿ç”¨ Decimal
class PaymentResponse(BaseModel):
    amount: Decimal

# Pydantic è‡ªåŠ¨å°†å­—ç¬¦ä¸²è½¬æ¢ä¸º Decimal
response_data = {"amount": "123.45"}
payment = PaymentResponse.model_validate(response_data)
assert isinstance(payment.amount, Decimal)
```

---

## ğŸ› å·²çŸ¥é—®é¢˜

æ— ã€‚

---

## ğŸ“ æ”¯æŒ

- **æ–‡æ¡£**: [docs/user-guide/DECIMAL_GUIDE.md](../user-guide/DECIMAL_GUIDE.md)
- **é—®é¢˜åé¦ˆ**: [GitHub Issues](https://github.com/yourorg/df-test-framework/issues)

---

**å®Œæ•´æ›´æ–°æ—¥å¿—**: [v3.5.0...v3.6.0](https://github.com/yourorg/df-test-framework/compare/v3.5.0...v3.6.0)

---

## ğŸŠ æ€»ç»“

v3.6.0 æ˜¯ä¸€ä¸ª**å¼€å‘ä½“éªŒå¤§å¹…æå‡çš„ç‰ˆæœ¬**ï¼Œæ ¸å¿ƒäº®ç‚¹ï¼š

âœ¨ **é›¶é…ç½®**: ç›´æ¥ä½¿ç”¨æ ‡å‡† Decimal ç±»å‹
âœ¨ **è‡ªåŠ¨åºåˆ—åŒ–**: HttpClient åŸç”Ÿæ”¯æŒ Pydantic æ¨¡å‹
âœ¨ **ç²¾ç¡®è®¡ç®—**: å‘Šåˆ«æµ®ç‚¹æ•°ç²¾åº¦é—®é¢˜
âœ¨ **æ€§èƒ½ä¼˜åŒ–**: Pydantic v2 Rust æ ¸å¿ƒåŠ æŒ

ç«‹å³å‡çº§ï¼Œäº«å—ç°ä»£åŒ–çš„ Decimal å¤„ç†ä½“éªŒï¼
