# 文档维护指南

> **最后更新**: 2026-01-17
> **适用对象**: 框架开发者、文档维护者

## 概述

本指南规定了 DF Test Framework 文档的维护流程、结构规范、版本管理和归档策略，确保文档与代码保持同步，为用户提供准确、及时的文档支持。

### 核心原则

1. **文档与代码同步**：代码变更必须同步更新文档
2. **版本管理清晰**：明确标注文档适用的框架版本
3. **结构统一规范**：所有文档遵循统一的结构模板
4. **及时归档过时内容**：历史文档及时归档，避免混淆

---

## 文档分类与版本策略

### 核心文档（标注框架版本）

**定义**：与框架版本强绑定的顶级文档

**文档列表**（仅 5 个）：
1. `README.md` - 项目主文档
2. `CLAUDE.md` - AI 助手指南
3. `docs/ESSENTIAL_DOCS.md` - 核心文档导航
4. `docs/README.md` - 文档总览
5. `docs/architecture/ARCHITECTURE_V4.0.md` - 架构总览（每个大版本一个）

**版本标注格式**：
```markdown
> **版本**: v4.0.0
> **更新时间**: 2026-01-16
```

**更新时机**：
- 框架发布新的大版本（如 v4.0.0 → v5.0.0）时必须更新
- 版本号必须与 `pyproject.toml` 中的版本号一致

---

## 使用指南文档（标注适用版本范围）

**定义**：功能使用说明文档，可能跨多个版本

**文档位置**：`docs/guides/`

**版本标注格式**：
```markdown
> **最后更新**: 2026-01-16
> **适用版本**: v3.8.0+（异步支持），v4.0.0+（推荐）
```

**更新时机**：
- 功能新增或重大变更时更新
- 修复文档错误时更新
- 添加最佳实践或示例时更新

**版本标注规则**：
- 标注功能首次引入的版本（如 `v3.8.0+`）
- 如有重大改进，标注改进版本（如 `v4.0.0+（推荐）`）
- 如有破坏性变更，明确标注版本范围（如 `v3.0.0 - v3.9.x`）

---

## API 参考文档（标注引入版本 + 变更历史）

**定义**：详细的 API 接口文档

**文档位置**：`docs/api-reference/`

**版本标注格式**：
```markdown
## AsyncHttpClient

> **引入版本**: v3.8.0
> **稳定版本**: v3.10.0
> **重大改进**: v4.0.0（性能提升 30 倍）

### 版本历史
- v4.0.0: 性能优化，并发性能提升 30 倍
- v3.10.0: API 稳定，推荐生产使用
- v3.8.0: 首次引入异步 HTTP 客户端
```

**更新时机**：
- API 新增时创建文档
- API 变更时更新版本历史
- API 废弃时标注废弃版本

---

## 文档更新流程

### 新功能开发时的文档流程

**步骤 1：功能设计阶段**
- 在设计文档中说明功能的使用方式
- 确定功能适用的版本号

**步骤 2：功能实现阶段**
- 在代码中添加详细的 docstring
- 确保类型注解完整

**步骤 3：功能完成后**
- 创建或更新使用指南文档
- 如果是新 API，创建 API 参考文档
- 在 CHANGELOG.md 中记录变更

**步骤 4：发布前检查**
- 验证文档中的示例代码可运行
- 检查文档链接是否有效
- 确认版本标注正确

### Bug 修复时的文档流程

**如果 Bug 影响文档**：
- 更新相关文档，修正错误信息
- 在文档中添加注意事项或最佳实践
- 不需要更新"最后更新"时间（除非是重大修正）

**如果 Bug 不影响文档**：
- 无需更新文档

### 破坏性变更时的文档流程

**步骤 1：标注废弃**
- 在旧版本文档中添加废弃警告
- 说明替代方案

**步骤 2：创建迁移指南**
- 在 `docs/guides/` 中创建迁移指南
- 说明如何从旧 API 迁移到新 API

**步骤 3：更新版本标注**
- 明确标注版本范围
- 例如：`v3.0.0 - v3.9.x（已废弃）`

---

## 文档结构规范

### 使用指南文档结构

所有使用指南文档应遵循以下结构：

```markdown
# [功能名称]使用指南

> **最后更新**: YYYY-MM-DD
> **适用版本**: vX.X.X+

## 概述

[功能简介，核心特性]

### 核心特性
- 特性 1
- 特性 2

---

## 快速开始

### 基本使用

[最简单的使用示例]

---

## 详细指南

### 功能 1
[详细说明]

### 功能 2
[详细说明]

---

## 最佳实践

### 1. 实践 1
[说明]

### 2. 实践 2
[说明]

---

## 常见问题

### Q1: 问题 1？
[解答]

---

## 相关文档

- [相关文档 1](link)
- [相关文档 2](link)
```

### API 参考文档结构

```markdown
# [模块名称] API 参考

> **最后更新**: YYYY-MM-DD
> **适用版本**: vX.X.X+

## 概述

[模块简介]

---

## [类名/函数名]

> **引入版本**: vX.X.X
> **稳定版本**: vX.X.X

### 类签名/函数签名

[代码示例]

### 参数

[参数说明]

### 返回值

[返回值说明]

### 使用示例

[代码示例]

### 版本历史

- vX.X.X: 变更说明
```

---

## 归档策略

### 何时归档文档

**必须归档的情况**：
1. **功能已废弃**：功能在新版本中已移除
2. **文档已过时**：内容不再适用于当前版本
3. **临时文档**：分析报告、设计讨论等临时性文档
4. **历史版本文档**：旧版本的架构文档

**不应归档的情况**：
1. **功能仍在使用**：即使是旧版本引入的功能，只要还在使用就不归档
2. **向后兼容的功能**：保持文档可用，标注版本范围即可

### 归档目录结构

```
docs/archive/
├── README.md              # 归档索引
├── analysis/              # 分析报告
├── design/                # 设计讨论
├── plans/                 # 计划文档
├── guides/                # 历史指南
└── versions/              # 历史版本文档
    ├── v2/
    ├── v3/
    └── v4/
```

### 归档流程

**步骤 1：标注归档状态**
- 在文档顶部添加归档标记：
  ```markdown
  > **⚠️ 已归档**：此文档已过时，请参考 [新文档](link)
  ```

**步骤 2：移动文档**
- 将文档移动到 `docs/archive/` 对应的子目录
- 保持原有的文件名

**步骤 3：更新索引**
- 在 `docs/archive/README.md` 中添加归档记录
- 说明归档原因和替代文档

**步骤 4：更新链接**
- 检查其他文档中指向该文档的链接
- 更新链接或添加重定向说明

---

## 文档质量检查清单

### 发布前检查

**内容完整性**：
- [ ] 文档标题清晰，准确反映内容
- [ ] 版本标注正确（核心文档/使用指南/API 参考）
- [ ] 更新时间为当前日期
- [ ] 概述部分简洁明了
- [ ] 核心特性列表完整

**代码示例**：
- [ ] 所有代码示例可运行
- [ ] 代码示例包含必要的导入语句
- [ ] 代码示例遵循框架最佳实践
- [ ] 代码示例使用正确的类型注解

**链接和引用**：
- [ ] 所有内部链接有效
- [ ] 外部链接可访问
- [ ] 相关文档链接完整
- [ ] API 引用路径正确

**格式规范**：
- [ ] Markdown 格式正确
- [ ] 代码块语言标注正确
- [ ] 表格格式整齐
- [ ] 标题层级合理

**技术准确性**：
- [ ] 技术描述准确
- [ ] 版本信息正确
- [ ] 配置示例有效
- [ ] 最佳实践合理

---

## 常见问题

### Q1: 如何判断文档是否需要更新？

**判断标准**：
- 代码 API 发生变更
- 功能行为改变
- 配置方式调整
- 发现文档错误或不清晰
- 用户反馈问题

**更新时机**：
- 破坏性变更：立即更新，添加迁移指南
- 新功能：功能发布时同步更新
- Bug 修复：如果影响文档描述则更新
- 优化改进：可以批量更新

### Q2: 如何处理多版本文档？

**策略**：
- **不维护多版本文档**：只维护当前版本文档
- **版本标注**：在文档中标注适用版本范围
- **历史归档**：旧版本架构文档归档到 `docs/archive/versions/`
- **迁移指南**：破坏性变更提供迁移指南

**示例**：
```markdown
> **适用版本**: v3.8.0+（异步支持），v4.0.0+（推荐）
```

### Q3: 文档链接失效怎么办？

**预防措施**：
- 使用相对路径而非绝对路径
- 定期检查链接有效性
- 文档移动时更新所有引用

**修复流程**：
1. 使用 `grep -r "broken-link" docs/` 查找所有引用
2. 更新链接或添加重定向说明
3. 在归档文档中添加新文档链接

### Q4: 如何保持文档与代码同步？

**最佳实践**：
- **PR 检查**：代码变更 PR 必须包含文档更新
- **自动化检查**：CI 检查文档链接有效性
- **定期审查**：每个版本发布前审查文档完整性
- **文档测试**：示例代码纳入测试套件

---

## 工具和自动化

### 文档生成工具

**CLI 命令**：
```bash
# 初始化配置目录（自动生成配置文档结构）
df-test env init

# 显示环境配置（用于验证文档示例）
df-test env show --env=staging

# 验证配置完整性
df-test env validate --all
```

### 文档检查脚本

**链接检查**：
```bash
# 检查所有文档中的链接
find docs/ -name "*.md" -exec grep -H "\[.*\](.*)" {} \;

# 检查特定文档的链接
grep -n "\[.*\](.*)" docs/guides/config_guide.md
```

**版本标注检查**：
```bash
# 检查缺少版本标注的文档
grep -L "适用版本\|版本:" docs/guides/*.md
```

### CI/CD 集成

**GitHub Actions 示例**：
```yaml
name: Documentation Check

on: [pull_request]

jobs:
  check-docs:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Check broken links
        run: |
          # 检查文档链接
          find docs/ -name "*.md" -exec markdown-link-check {} \;

      - name: Validate code examples
        run: |
          # 提取并测试代码示例
          pytest tests/docs/
```

---

## 相关文档

### 核心文档

- [README.md](../../README.md) - 项目主文档
- [CLAUDE.md](../../CLAUDE.md) - AI 助手指南
- [ESSENTIAL_DOCS.md](../ESSENTIAL_DOCS.md) - 核心文档导航
- [docs/README.md](../README.md) - 文档总览
- [ARCHITECTURE_V4.0.md](../architecture/ARCHITECTURE_V4.0.md) - 架构总览

### 开发指南

- [DOC_REORGANIZATION_PLAN_v4.0.md](../DOC_REORGANIZATION_PLAN_v4.0.md) - 文档重组计划
- [CHANGELOG.md](../../CHANGELOG.md) - 更新日志

### 使用指南

- [配置系统指南](../guides/config_guide.md) - 配置管理
- [日志系统指南](../guides/logging_guide.md) - 日志配置
- [Bootstrap 引导系统指南](../guides/bootstrap_guide.md) - 框架初始化

---

**完成时间**: 2026-01-17
