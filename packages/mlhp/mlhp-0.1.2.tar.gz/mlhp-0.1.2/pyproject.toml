# https://scikit-build-core.readthedocs.io/en/latest/
# https://github.com/pybind/scikit_build_example/blob/master/pyproject.toml
#
# Build python package locally with (potentially export CXX=/usr/bin/...):
# python -m pipx run build
#
# (or for source distribution only: python -m pipx run build --sdist)
#
# Either install locally with
# python -m pip install ./dist/mlhp-[...].whl
#
# ... or upload to TestPyPi (use __token__ as name and then paste the generated token as password)
# python -m twine upload --repository testpypi ./dist/mlhp-[...].[VERSION]*
#
# (install with:)
# (python -m pip install --index-url https://test.pypi.org/simple/ --extra-index-url https://pypi.org/simple mlhp)
#
# ... or upload to PyPi (like above)
# python -m twine upload ./dist/mlhp-[...].[VERSION]*

[build-system]
requires = ["scikit-build-core"]#, "pybind11"]
build-backend = "scikit_build_core.build"

[project]
name = "mlhp"
version = "0.1.2"
authors = [
  { name="Philipp Kopp" }, #, email="name@example.com"
]
description = "A work-in-progress finite element library."
readme = "README.md"
#requires-python = ">=3.7"
classifiers = [
    "License :: OSI Approved :: MIT License",
#    "Programming Language :: Python :: 3",
#    "Operating System :: OS Independent",
]

[project.urls]
Homepage = "https://gitlab.com/phmkopp/mlhp"
Issues = "https://github.com/phmkopp/mlhp/issues"

#[tool.scikit-build]
#wheel.py-api = "py3"
#cmake.targets = ["pymlhpcore"]


# ====== Windows + Visual Studio ========
# https://cibuildwheel.pypa.io/en/stable/options/#build-skip
[tool.cibuildwheel]
skip = "cp36-* cp37-* pp* *-win32 *-manylinux_i686"

[tool.scikit-build.cmake.define]
BUILD_SHARED_LIBS="OFF"
MLHP_TEST_CPP="OFF"
MLHP_TEST_PYTHON="OFF"
MLHP_DEBUG_CHECKS="OFF"
MLHP_INDEX_SIZE_CELLS="64"
MLHP_INDEX_SIZE_DOFS="64"
MLHP_PYTHON="ON"

# # ====== Windows + MinGW + g++ ========
# 
# # https://cibuildwheel.pypa.io/en/stable/options/#build-skip
# [tool.cibuildwheel]
# skip = "cp36-* *-win32"
# 
# [tool.scikit-build]
# cmake.args = ["-G=MinGW Makefiles"]
# 
# [tool.scikit-build.cmake.define]
# BUILD_SHARED_LIBS="OFF"
# MLHP_TEST_CPP="OFF"
# MLHP_TEST_PYTHON="OFF"
# MLHP_INDEX_SIZE_CELLS="64"
# MLHP_INDEX_SIZE_DOFS="64"
# MLHP_PYTHON="ON"
# MLHP_ALL_OPTIMIZATIONS="OFF"
# CMAKE_CXX_FLAGS="-DMLHP_DISABLE_PURE -w -Ofast -mavx2 -march=haswell -mtune=core-avx2"
