# LLM Collaboration Protocol Schema v1.0
# é¡¹ç›®é…ç½®çš„ YAML Schema å®šä¹‰

project:
  type: object
  required: [name, version, domain]
  properties:
    name:
      type: string
      description: é¡¹ç›®åç§°
    version:
      type: string
      pattern: "^v\\d+\\.\\d+$"
      description: åè®®ç‰ˆæœ¬
    domain:
      type: string
      description: ä¸šåŠ¡é¢†åŸŸæ ‡è¯† (game/web/mobile/data/infra/...)
    description:
      type: string
      description: é¡¹ç›®ç®€è¿°

# ============================================
# ä¸€ã€æ ¸å¿ƒç†å¿µ (Philosophy)
# ============================================
philosophy:
  type: object
  properties:
    vibe_development:
      type: object
      description: Vibe Development å“²å­¦é…ç½®
      properties:
        enabled:
          type: boolean
          default: true
        principles:
          type: array
          items:
            type: string
          description: æ ¸å¿ƒåŸåˆ™åˆ—è¡¨
    decision_quality:
      type: object
      properties:
        target_rate:
          type: number
          minimum: 0.8
          maximum: 1.0
          default: 0.9
          description: å†³ç­–æ­£ç¡®ç‡ç›®æ ‡
        critical_tolerance:
          type: integer
          default: 0
          description: å…³é”®å†³ç­–å®¹é”™æ•°
    long_term_dialogue:
      type: boolean
      default: true
      description: æ˜¯å¦å¯ç”¨é•¿æœŸå¯¹è¯å·¥ç¨‹æ¨¡å¼

# ============================================
# äºŒã€èŒèƒ½è§’è‰²å®šä¹‰ (Roles)
# ============================================
roles:
  type: array
  items:
    type: object
    required: [code, name, focus]
    properties:
      code:
        type: string
        pattern: "^[A-Z]+$"
        description: è§’è‰²ä»£å· (å¦‚ DESIGN, ARCH, DEV)
      name:
        type: string
        description: è§’è‰²åç§°
      focus:
        type: array
        items:
          type: string
        description: å…³æ³¨é¢†åŸŸ
      triggers:
        type: array
        items:
          type: string
        description: è§¦å‘å…³é”®è¯
      is_gatekeeper:
        type: boolean
        default: false
        description: æ˜¯å¦ä¸ºå®ˆé—¨äººè§’è‰² (å¦‚ QA)

# ============================================
# ä¸‰ã€å†³ç­–åˆ†çº§ (Decision Levels)
# ============================================
decision_levels:
  type: array
  items:
    type: object
    required: [level, name, scope, review]
    properties:
      level:
        type: string
        enum: [S, A, B, C]
        description: å†³ç­–ç­‰çº§
      name:
        type: string
        description: å†³ç­–ç±»å‹åç§°
      scope:
        type: string
        description: å½±å“èŒƒå›´æè¿°
      review:
        type: object
        properties:
          required:
            type: boolean
          mode:
            type: string
            enum: [sync, async, auto, none]
          human_confirm:
            type: boolean

# ============================================
# å››ã€ä»»åŠ¡å•å…ƒ (Task Unit)
# ============================================
task_unit:
  type: object
  properties:
    id_pattern:
      type: string
      default: "TASK-{role}-{seq}"
      description: ä»»åŠ¡IDæ¨¡å¼
    statuses:
      type: array
      items:
        type: string
      default: [TODO, IN_PROGRESS, REVIEW, DONE]
    required_fields:
      type: array
      items:
        type: string
      default: [id, role, feature, dependencies, output, status]

# ============================================
# äº”ã€å¯¹è¯æµç¨‹ (Dialogue Protocol)
# ============================================
dialogue_protocol:
  type: object
  properties:
    on_start:
      type: object
      description: å¯¹è¯å¼€å§‹æ—¶çš„å¼ºåˆ¶æ“ä½œ
      properties:
        read_files:
          type: array
          items:
            type: string
          description: å¿…é¡»è¯»å–çš„æ–‡ä»¶åˆ—è¡¨
        actions:
          type: array
          items:
            type: string
    on_end:
      type: object
      description: å¯¹è¯ç»“æŸæ—¶çš„å¼ºåˆ¶æ“ä½œ
      properties:
        update_files:
          type: array
          items:
            type: string
        git_commit:
          type: boolean
          default: true
    standard_flow:
      type: array
      items:
        type: object
        properties:
          step:
            type: integer
          actor:
            type: string
            enum: [human, ai]
          action:
            type: string
          condition:
            type: string

# ============================================
# å…­ã€Git å·¥ä½œæµ (Git Workflow)
# ============================================
git_workflow:
  type: object
  properties:
    branches:
      type: object
      properties:
        main:
          type: string
          description: ä¸»åˆ†æ”¯åç§°
        dev:
          type: string
        feature_prefix:
          type: string
          default: "feature/"
        fix_prefix:
          type: string
          default: "fix/"
    commit_prefixes:
      type: array
      items:
        type: object
        properties:
          prefix:
            type: string
          description:
            type: string
          roles:
            type: array
            items:
              type: string
    commit_required:
      type: boolean
      default: true
      description: æ¯æ¬¡å¯¹è¯æ˜¯å¦å¿…é¡» commit

# ============================================
# ä¸ƒã€æµ‹è¯•ä½“ç³» (Testing)
# ============================================
testing:
  type: object
  properties:
    # 7.1 å•å…ƒæµ‹è¯• (å¼€å‘è€…è§†è§’)
    unit_test:
      type: object
      properties:
        enabled:
          type: boolean
          default: true
        framework:
          type: string
          description: æµ‹è¯•æ¡†æ¶ (jest/pytest/mocha/...)
        coverage_target:
          type: number
          minimum: 0
          maximum: 1
          default: 0.8
        patterns:
          type: array
          items:
            type: string
          description: æµ‹è¯•æ–‡ä»¶åŒ¹é…æ¨¡å¼
        run_on:
          type: array
          items:
            type: string
            enum: [pre-commit, pre-push, ci, manual]
    # 7.2 äº§å“QA (ç”¨æˆ·è§†è§’)
    product_qa:
      type: object
      properties:
        enabled:
          type: boolean
          default: true
        test_case_file:
          type: string
          default: "docs/QA_TEST_CASES.md"
        case_id_pattern:
          type: string
          default: "TC-{module}-{seq}"
        required_fields:
          type: array
          items:
            type: string
          default: [id, feature, precondition, steps, expected, status]
        statuses:
          type: array
          items:
            type: string
          default: [PASS, PARTIAL, FAIL, SKIP]

# ============================================
# å…«ã€é‡Œç¨‹ç¢‘ (Milestone)
# ============================================
milestone:
  type: object
  properties:
    lifecycle:
      type: array
      items:
        type: object
        properties:
          phase:
            type: string
          description:
            type: string
          exit_criteria:
            type: array
            items:
              type: string
    tag_pattern:
      type: string
      default: "v{major}.{minor}.{patch}"
    roadmap_file:
      type: string
      default: "docs/ROADMAP.md"

# ============================================
# ä¹ã€è¿­ä»£ç®¡ç† (Iteration)
# ============================================
iteration:
  type: object
  properties:
    suggestion_pool:
      type: object
      properties:
        file:
          type: string
          default: "docs/ROADMAP.md"
        categories:
          type: array
          items:
            type: object
            properties:
              symbol:
                type: string
              meaning:
                type: string
          default:
            - symbol: "âœ…"
              meaning: "çº³å…¥å½“å‰é‡Œç¨‹ç¢‘"
            - symbol: "â³"
              meaning: "å»¶ååˆ°ä¸‹ä¸ªé‡Œç¨‹ç¢‘"
            - symbol: "âŒ"
              meaning: "æ‹’ç»"
            - symbol: "ğŸ”„"
              meaning: "åˆå¹¶å…¶ä»–è¿­ä»£"
    config_level_iteration:
      type: object
      description: é…ç½®çº§è¿­ä»£ï¼ˆä»…æ”¹æ•°å€¼ä¸æ”¹é€»è¾‘ï¼‰
      properties:
        enabled:
          type: boolean
          default: true
        commit_prefix:
          type: string
          default: "[CONFIG]"
        skip_pm_review:
          type: boolean
          default: true

# ============================================
# åã€æ–‡æ¡£ä½“ç³» (Documentation)
# ============================================
documentation:
  type: object
  properties:
    key_files:
      type: array
      items:
        type: object
        properties:
          path:
            type: string
          purpose:
            type: string
          update_trigger:
            type: string
    context_file:
      type: string
      default: "docs/CONTEXT.md"
    changelog_file:
      type: string
      default: "docs/CHANGELOG.md"
    decisions_file:
      type: string
      default: "docs/DECISIONS.md"
