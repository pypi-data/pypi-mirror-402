<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>FlowMeta å®Œæ•´æ•™ç¨‹ | å®åŸºå› ç»„å­¦åˆ†ææµæ°´çº¿</title>
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans SC", sans-serif;
    line-height: 1.8;
    margin: 0;
    padding: 0;
    color: #1f1f1f;
    background: #fafafa;
  }
  .container {
    max-width: 1400px;
    margin: 0 auto;
    padding: 40px 20px;
    background: white;
    box-shadow: 0 0 40px rgba(0,0,0,0.05);
  }
  h1, h2, h3, h4 {
    color: #1a4d8f;
    margin-top: 1.8em;
    margin-bottom: 0.8em;
    font-weight: 600;
  }
  h1 { font-size: 2.5em; border-bottom: 3px solid #1a4d8f; padding-bottom: 0.3em; }
  h2 { font-size: 1.8em; border-left: 5px solid #1a4d8f; padding-left: 15px; }
  h3 { font-size: 1.4em; color: #2c5f8f; }
  h4 { font-size: 1.2em; color: #3a6f9f; }
  code {
    background: #f5f5f5;
    padding: 3px 6px;
    border-radius: 4px;
    font-family: "SFMono-Regular", Consolas, "Liberation Mono", Menlo, monospace;
    font-size: 0.9em;
    color: #d63384;
  }
  pre {
    background: #1e1e1e;
    color: #d4d4d4;
    padding: 16px;
    overflow-x: auto;
    border-radius: 6px;
    font-size: 0.9em;
    line-height: 1.5;
  }
  pre code {
    background: transparent;
    padding: 0;
    color: inherit;
  }
  table {
    border-collapse: collapse;
    margin: 20px 0;
    width: 100%;
    background: white;
    box-shadow: 0 2px 8px rgba(0,0,0,0.05);
  }
  th, td {
    border: 1px solid #e0e0e0;
    padding: 12px 15px;
    vertical-align: top;
    text-align: left;
  }
  th {
    background: linear-gradient(135deg, #1a4d8f 0%, #2c5f8f 100%);
    color: white;
    font-weight: 500;
  }
  tr:nth-child(even) { background: #f8f9fa; }
  tr:hover { background: #e8f4ff; }
  .tip {
    background: linear-gradient(135deg, #edf6ff 0%, #e8f4ff 100%);
    border-left: 5px solid #1a4d8f;
    padding: 16px 20px;
    margin: 20px 0;
    border-radius: 0 8px 8px 0;
  }
  .warning {
    background: linear-gradient(135deg, #fff3cd 0%, #ffe8a1 100%);
    border-left: 5px solid #ffc107;
    padding: 16px 20px;
    margin: 20px 0;
    border-radius: 0 8px 8px 0;
  }
  .section { margin-bottom: 60px; }

  /* æµæ°´çº¿å›¾æ ·å¼ */
  .pipeline-container {
    background: #f8f9fa;
    border-radius: 12px;
    padding: 30px;
    margin: 30px 0;
  }
  .pipeline-flow {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 15px;
    margin: 20px 0;
  }
  .step-card {
    background: white;
    border: 2px solid #1a4d8f;
    border-radius: 10px;
    padding: 20px;
    min-width: 200px;
    max-width: 250px;
    text-align: center;
    box-shadow: 0 4px 12px rgba(26, 77, 143, 0.15);
    transition: all 0.3s ease;
    position: relative;
  }
  .step-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 20px rgba(26, 77, 143, 0.25);
  }
  .step-number {
    display: inline-block;
    background: linear-gradient(135deg, #1a4d8f 0%, #2c5f8f 100%);
    color: white;
    width: 45px;
    height: 45px;
    line-height: 45px;
    border-radius: 50%;
    font-size: 1.3em;
    font-weight: bold;
    margin-bottom: 10px;
  }
  .step-title {
    font-weight: 600;
    font-size: 1.1em;
    color: #1a4d8f;
    margin-bottom: 8px;
  }
  .step-tool {
    color: #666;
    font-size: 0.9em;
    margin-bottom: 5px;
  }
  .step-io {
    font-size: 0.85em;
    color: #888;
  }
  .arrow-right {
    display: flex;
    align-items: center;
    color: #1a4d8f;
    font-size: 2em;
    margin: 0 5px;
  }

  /* è¯¦ç»†æ­¥éª¤è¯´æ˜ */
  .detail-step {
    background: white;
    border-left: 4px solid #1a4d8f;
    padding: 25px;
    margin: 25px 0;
    border-radius: 0 10px 10px 0;
    box-shadow: 0 2px 10px rgba(0,0,0,0.08);
  }
  .detail-step-header {
    display: flex;
    align-items: center;
    margin-bottom: 15px;
  }
  .detail-step-num {
    background: linear-gradient(135deg, #1a4d8f 0%, #2c5f8f 100%);
    color: white;
    width: 50px;
    height: 50px;
    line-height: 50px;
    text-align: center;
    border-radius: 50%;
    font-size: 1.4em;
    font-weight: bold;
    margin-right: 15px;
  }
  .detail-step-title {
    font-size: 1.3em;
    color: #1a4d8f;
    font-weight: 600;
  }
  .step-diagram {
    background: #f8f9fa;
    border: 1px dashed #1a4d8f;
    border-radius: 8px;
    padding: 20px;
    margin: 15px 0;
    font-family: monospace;
    white-space: pre;
    overflow-x: auto;
  }
  .param-table {
    margin: 15px 0;
  }
  .param-table th {
    background: #e8f4ff;
    color: #1a4d8f;
  }
  .output-tree {
    background: #1e1e1e;
    color: #4ec9b0;
    padding: 20px;
    border-radius: 8px;
    font-family: "SFMono-Regular", Consolas, monospace;
    line-height: 1.6;
    font-size: 0.9em;
  }
  .output-tree .dir { color: #4ec9b0; }
  .output-tree .file { color: #ce9178; }
  .output-tree .comment { color: #6a9955; }

  a { color: #1a4d8f; text-decoration: none; border-bottom: 1px dotted #1a4d8f; }
  a:hover { border-bottom-style: solid; }
  .header-meta {
    background: linear-gradient(135deg, #1a4d8f 0%, #2c5f8f 100%);
    color: white;
    padding: 30px;
    border-radius: 12px;
    margin-bottom: 30px;
  }
  .header-meta p { margin: 8px 0; }
  .header-meta a { color: #ffd700; border-bottom-color: #ffd700; }

  .metadata-badge {
    display: inline-block;
    padding: 4px 10px;
    border-radius: 12px;
    font-size: 0.8em;
    margin-left: 5px;
  }
  .badge-python { background: #3776ab; color: white; }
  .badge-bioinfo { background: #28a745; color: white; }
  .badge-input { background: #6c757d; color: white; }
  .badge-output { background: #17a2b8; color: white; }

  .flow-arrow {
    color: #1a4d8f;
    font-size: 1.5em;
    margin: 0 10px;
  }

  .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 20px 0; }
  .info-box {
    background: white;
    padding: 20px;
    border-radius: 8px;
    border-left: 4px solid #1a4d8f;
    box-shadow: 0 2px 8px rgba(0,0,0,0.08);
  }

  @media (max-width: 768px) {
    .grid-2 { grid-template-columns: 1fr; }
    .step-card { min-width: 150px; }
    .pipeline-flow { flex-direction: column; align-items: center; }
    .arrow-right { transform: rotate(90deg); margin: 10px 0; }
  }
</style>
</head>
<body>

<div class="container">

<div class="header-meta">
  <h1>ğŸŒŒ FlowMeta å®Œæ•´æ•™ç¨‹</h1>
  <p><strong>é¡¹ç›®åç§°ï¼š</strong> FlowMeta - è‡ªåŠ¨åŒ–å®åŸºå› ç»„å­¦åˆ†ææµæ°´çº¿</p>
  <p><strong>ä»£ç ä»“åº“ï¼š</strong> <a href="https://github.com/SkinMicrobe/FlowMeta" target="_blank" rel="noopener">https://github.com/SkinMicrobe/FlowMeta</a></p>
  <p><strong>ä½œè€…ï¼š</strong> æ›¾ä¸œå¼º (Dongqiang Zeng) Â· å—æ–¹åŒ»ç§‘å¤§å­¦</p>
  <p><strong>é‚®ç®±ï¼š</strong> <a href="mailto:interlaken@smu.edu.cn">interlaken@smu.edu.cn</a></p>
</div>

<!-- ======================================================================= -->
<div class="section">
  <h2>ğŸ“Š ä¸€ã€æŠ€æœ¯è·¯çº¿æ€»è§ˆ</h2>

  <p>FlowMeta æ˜¯ä¸€ä¸ªç«¯åˆ°ç«¯çš„å®åŸºå› ç»„å­¦åˆ†ææµæ°´çº¿ï¼Œæ•´åˆäº† 10 ä¸ªå¤„ç†æ­¥éª¤ï¼Œä»åŸå§‹ FASTQ æ–‡ä»¶åˆ°æœ€ç»ˆçš„ç‰©ç§ä¸°åº¦çŸ©é˜µã€‚</p>

  <div class="pipeline-container">
    <h3 style="text-align: center; margin-bottom: 30px;">å®Œæ•´æµæ°´çº¿æµç¨‹å›¾</h3>
    <div class="pipeline-flow">
      <div class="step-card">
        <div class="step-number">1</div>
        <div class="step-title">fastp è´¨æ§</div>
        <div class="step-tool">ğŸ§¬ fastp</div>
        <div class="step-io">01-raw â†’ 02-qc</div>
      </div>
      <div class="arrow-right">â†’</div>
      <div class="step-card">
        <div class="step-number">2</div>
        <div class="step-title">å®Œæ•´æ€§éªŒè¯</div>
        <div class="step-tool">âœ“ pigz</div>
        <div class="step-io">02-qc æ£€æŸ¥</div>
      </div>
      <div class="arrow-right">â†’</div>
      <div class="step-card">
        <div class="step-number">3</div>
        <div class="step-title">å®¿ä¸»å»é™¤</div>
        <div class="step-tool">ğŸ§¬ Bowtie2</div>
        <div class="step-io">02-qc â†’ 03-hr/04-bam</div>
      </div>
    </div>

    <div class="pipeline-flow">
      <div class="step-card">
        <div class="step-number">4</div>
        <div class="step-title">éªŒè¯</div>
        <div class="step-tool">âœ“ pigz</div>
        <div class="step-io">03-hr æ£€æŸ¥</div>
      </div>
      <div class="arrow-right">â†’</div>
      <div class="step-card">
        <div class="step-number">5</div>
        <div class="step-title">å®¿ä¸»æå–</div>
        <div class="step-tool">ğŸ§¬ samtools</div>
        <div class="step-io">04-bam â†’ 05-host</div>
      </div>
      <div class="arrow-right">â†’</div>
      <div class="step-card">
        <div class="step-number">6</div>
        <div class="step-title">æ•°æ®åº“ç¼“å­˜</div>
        <div class="step-tool">ğŸ’¾ /dev/shm</div>
        <div class="step-io">Kraken2 â†’ RAM</div>
      </div>
    </div>

    <div class="pipeline-flow">
      <div class="step-card">
        <div class="step-number">7</div>
        <div class="step-title">ç‰©ç§åˆ†ç±»</div>
        <div class="step-tool">ğŸ§¬ Kraken2</div>
        <div class="step-io">03-hr â†’ 06-ku/07-bracken</div>
      </div>
      <div class="arrow-right">â†’</div>
      <div class="step-card">
        <div class="step-number">8</div>
        <div class="step-title">éªŒè¯</div>
        <div class="step-tool">âœ“ å†…ç½®éªŒè¯</div>
        <div class="step-io">06-ku æ£€æŸ¥</div>
      </div>
      <div class="arrow-right">â†’</div>
      <div class="step-card">
        <div class="step-number">9</div>
        <div class="step-title">å®¿ä¸»è¿‡æ»¤</div>
        <div class="step-tool">ğŸ§¬ Kraken2</div>
        <div class="step-io">06-ku â†’ 08-ku2</div>
      </div>
    </div>

    <div class="pipeline-flow">
      <div class="step-card">
        <div class="step-number">10</div>
        <div class="step-title">çŸ©é˜µåˆå¹¶</div>
        <div class="step-tool">ğŸ pandas</div>
        <div class="step-io">08-ku2 â†’ 09-mpa</div>
      </div>
    </div>
  </div>

  <h3>æ•°æ®æµå‘æ€»è§ˆ</h3>
  <div class="step-diagram">
<span class="comment">åŸå§‹æ•°æ®è¾“å…¥</span>
<span class="dir">01-raw/</span>
â”œâ”€â”€ <span class="file">SAMPLE001_1.fastq.gz</span>
â”œâ”€â”€ <span class="file">SAMPLE001_2.fastq.gz</span>
â”œâ”€â”€ <span class="file">SAMPLE002_1.fastq.gz</span>
â””â”€â”€ <span class="file">SAMPLE002_2.fastq.gz</span>
              <span class="flow-arrow">â†“</span>
<span class="comment">æ­¥éª¤ 1: fastp è´¨é‡æ§åˆ¶ä¸ä¿®å‰ª</span>
<span class="dir">02-qc/</span>
â”œâ”€â”€ <span class="file">SAMPLE001_1.fastq.gz</span>          <span class="comment"># ä¿®å‰ªåçš„åºåˆ—</span>
â”œâ”€â”€ <span class="file">SAMPLE001_2.fastq.gz</span>
â”œâ”€â”€ <span class="file">SAMPLE001_fastp.html</span>       <span class="comment"># è´¨æ§æŠ¥å‘Š</span>
â”œâ”€â”€ <span class="file">SAMPLE001_fastp.json</span>       <span class="comment"># è´¨æ§ç»Ÿè®¡</span>
â””â”€â”€ <span class="file">SAMPLE001.task.complete</span>    <span class="comment"># å®Œæˆæ ‡è®°</span>
              <span class="flow-arrow">â†“</span>
<span class="comment">æ­¥éª¤ 3: Bowtie2 å®¿ä¸»åºåˆ—å»é™¤</span>
<span class="dir">03-hr/</span>      <span class="dir">04-bam/</span>
â”œâ”€â”€ <span class="file">SAMPLE001_host_remove_R1.fastq.gz</span>
â”œâ”€â”€ <span class="file">SAMPLE001_host_remove_R2.fastq.gz</span>
â”œâ”€â”€ <span class="file">SAMPLE001.task.complete</span>
â””â”€â”€ ...
â”œâ”€â”€ <span class="file">SAMPLE001.bam</span>                 <span class="comment"># æ¯”å¯¹æ–‡ä»¶</span>
â”œâ”€â”€ <span class="file">SAMPLE001.bam.bai</span>              <span class="comment"># ç´¢å¼•æ–‡ä»¶</span>
â””â”€â”€ ...
              <span class="flow-arrow">â†“</span>
<span class="comment">æ­¥éª¤ 5 (å¯é€‰): å®¿ä¸»åºåˆ—æå–</span>
<span class="dir">05-host/</span>
â”œâ”€â”€ <span class="file">SAMPLE001_host_R1.fastq.gz</span>  <span class="comment"># ç”¨äº HLA/mtDNA åˆ†æ</span>
â””â”€â”€ <span class="file">SAMPLE001_host_R2.fastq.gz</span>
              <span class="flow-arrow">â†“</span>
<span class="comment">æ­¥éª¤ 7: Kraken2 ç‰©ç§åˆ†ç±»</span>
<span class="dir">06-ku/</span>     <span class="dir">07-bracken/</span>
â”œâ”€â”€ <span class="file">SAMPLE001.kraken.report.std.txt</span>   <span class="comment"># åˆ†ç±»æŠ¥å‘Š</span>
â”œâ”€â”€ <span class="file">SAMPLE001.kraken.output.std.txt</span>   <span class="comment"># åˆ†ç±»è¯¦æƒ…</span>
â”œâ”€â”€ <span class="file">SAMPLE001.kraken.task.complete</span>
â””â”€â”€ ...
              <span class="flow-arrow">â†“</span>
<span class="comment">æ­¥éª¤ 9: å®¿ä¸»åˆ†ç±»è¿‡æ»¤ + é‡æ–°åˆ†ç±»</span>
<span class="dir">08-ku2/</span>
â”œâ”€â”€ <span class="file">SAMPLE001.nohuman.kraken.mpa.std.txt</span>    <span class="comment"># MPA æ ¼å¼</span>
â”œâ”€â”€ <span class="file">SAMPLE001.nohuman.kraken.report.std.txt</span> <span class="comment"># è¿‡æ»¤åæŠ¥å‘Š</span>
â”œâ”€â”€ <span class="file">SAMPLE001.nohuman.bracken</span>                <span class="comment"># Bracken ä¸°åº¦</span>
â””â”€â”€ <span class="file">SAMPLE001.task.complete</span>
              <span class="flow-arrow">â†“</span>
<span class="comment">æ­¥éª¤ 10: ç»“æœçŸ©é˜µåˆå¹¶</span>
<span class="dir">09-mpa/</span>
â”œâ”€â”€ <span class="file">prefix_combined.otu.tsv</span>      <span class="comment"># OTU è¡¨ (ç‰©ç§ Ã— æ ·æœ¬)</span>
â”œâ”€â”€ <span class="file">prefix_combined.mpa.tsv</span>      <span class="comment"># MPA è¡¨ (åˆ†ç±»è·¯å¾„ Ã— æ ·æœ¬)</span>
â”œâ”€â”€ <span class="file">prefix_combined.bracken.tsv</span>  <span class="comment"># Bracken åˆå¹¶è¡¨</span>
â””â”€â”€ <span class="file">step6.task.complete</span>
  </div>
</div>

<!-- ======================================================================= -->
<div class="section">
  <h2>ğŸ”¬ äºŒã€è¯¦ç»†æŠ€æœ¯è·¯çº¿å›¾</h2>

  <!-- æ­¥éª¤ 1 -->
  <div class="detail-step">
    <div class="detail-step-header">
      <div class="detail-step-num">1</div>
      <div class="detail-step-title">FASTQ è´¨é‡æ§åˆ¶ä¸ä¿®å‰ª (fastp)</div>
    </div>

    <div class="grid-2">
      <div class="info-box">
        <h4>ğŸ“ åŠŸèƒ½æè¿°</h4>
        <p>ä½¿ç”¨ fastp å¯¹åŸå§‹ FASTQ æ–‡ä»¶è¿›è¡Œè´¨é‡æ§åˆ¶ï¼ŒåŒ…æ‹¬ï¼š</p>
        <ul style="margin: 10px 0 10px 20px;">
          <li>æ¥å¤´åºåˆ—å»é™¤</li>
          <li>ä½è´¨é‡ç¢±åŸºä¿®å‰ª</li>
          <li>é•¿åº¦è¿‡æ»¤</li>
          <li>è´¨é‡è¿‡æ»¤</li>
          <li>ç”Ÿæˆè´¨æ§æŠ¥å‘Šï¼ˆHTML/JSONï¼‰</li>
        </ul>
      </div>

      <div class="info-box">
        <h4>ğŸ”§ å…³é”®å‚æ•°</h4>
        <table class="param-table">
          <tr><th>å‚æ•°</th><th>é»˜è®¤å€¼</th><th>è¯´æ˜</th></tr>
          <tr><td><code>--fastp_length_required</code></td><td>50</td><td>æœ€å°è¯»é•¿</td></tr>
          <tr><td><code>--fastp_retries</code></td><td>3</td><td>å¤±è´¥é‡è¯•æ¬¡æ•°</td></tr>
          <tr><td><code>--skip_integrity_checks</code></td><td>False</td><td>è·³è¿‡å®Œæ•´æ€§æ£€æŸ¥</td></tr>
        </table>
      </div>
    </div>

    <div class="step-diagram">
<span class="comment">è¾“å…¥: 01-raw/SAMPLE001_1.fastq.gz, SAMPLE001_2.fastq.gz</span>

<span class="flow-arrow">â†“ fastp å¤„ç†</span>

<span class="comment">ä¸­é—´æ–‡ä»¶ (in-place ç”Ÿæˆ)</span>
â”œâ”€â”€ fastp.json    <span class="comment"># JSON è´¨æ§æŠ¥å‘Š</span>
â”œâ”€â”€ fastp.html    <span class="comment"># HTML è´¨æ§æŠ¥å‘Š</span>
â”œâ”€â”€ fastp.fastq.gz    <span class="comment"># ä¿®å‰ªåçš„ R1 (é‡å‘½åä¸º sample_1.fastq.gz)</span>
â””â”€â”€ fastp.fastq.gz    <span class="comment"># ä¿®å‰ªåçš„ R2 (é‡å‘½åä¸º sample_2.fastq.gz)</span>

<span class="flow-arrow">â†“</span>

<span class="comment">è¾“å‡º: 02-qc/SAMPLE001_1.fastq.gz, SAMPLE001_2.fastq.gz</span>
<span class="comment">      SAMPLE001_fastp.html, SAMPLE001_fastp.json</span>
<span class="comment">      SAMPLE001.task.complete</span>
    </div>

    <div class="tip">
      <strong>ğŸ’¡ æ‰¹å¤„ç†æ¨¡å¼ï¼š</strong> ä½¿ç”¨ <code>--batch</code> å‚æ•°æ§åˆ¶å¹¶è¡Œå¤„ç†çš„æ ·æœ¬æ•°ï¼Œé»˜è®¤ä¸º 2ã€‚æ¯ä¸ªæ ·æœ¬ä½¿ç”¨ <code>--threads</code> æŒ‡å®šçš„çº¿ç¨‹æ•°è¿è¡Œ fastpã€‚
    </div>
  </div>

  <!-- æ­¥éª¤ 2 -->
  <div class="detail-step">
    <div class="detail-step-header">
      <div class="detail-step-num">2</div>
      <div class="detail-step-title">fastp ç»“æœå®Œæ•´æ€§éªŒè¯</div>
    </div>

    <p>éªŒè¯ fastp è¾“å‡ºæ–‡ä»¶çš„å®Œæ•´æ€§ï¼Œç¡®ä¿ FASTQ æ–‡ä»¶æœªæŸåã€‚ä½¿ç”¨ pigz è¿›è¡Œå‹ç¼©æµ‹è¯•ã€‚</p>

    <div class="step-diagram">
<span class="comment">æ£€æŸ¥å†…å®¹:</span>
â”œâ”€â”€ æ–‡ä»¶å­˜åœ¨æ€§æ£€æŸ¥
â”œâ”€â”€ æ–‡ä»¶å¤§å°éç©ºæ£€æŸ¥
â””â”€â”€ pigz -t å‹ç¼©æµ‹è¯•

<span class="flow-arrow">â†“</span>

<span class="comment">è¿”å›: (æœ‰æ•ˆæ ·æœ¬æ•°, æ— æ•ˆæ ·æœ¬æ•°)</span>

<span class="comment">æ— æ•ˆæ ·æœ¬å¤„ç†:</span>
â”œâ”€â”€ è®°å½•åˆ° 0-corrupted-samples.tsv
â”œâ”€â”€ ç§»åŠ¨æ–‡ä»¶åˆ° 00-corrupted/ ç›®å½•
â””â”€â”€ ä»æµæ°´çº¿ä¸­æ’é™¤
    </div>

    <div class="warning">
      <strong>âš ï¸ æ³¨æ„ï¼š</strong> æ­¥éª¤ 2 é»˜è®¤ä¸å¯ç”¨ï¼Œéœ€è¦ä½¿ç”¨ <code>--check_result</code> å‚æ•°ã€‚å¦‚æœä½¿ç”¨ <code>--skip_integrity_checks</code>ï¼Œåˆ™å³ä½¿æŒ‡å®š <code>--check_result</code> ä¹Ÿä¼šè·³è¿‡æ­¤æ­¥éª¤ã€‚
    </div>
  </div>

  <!-- æ­¥éª¤ 3 -->
  <div class="detail-step">
    <div class="detail-step-header">
      <div class="detail-step-num">3</div>
      <div class="detail-step-title">å®¿ä¸»åºåˆ—å»é™¤ (Bowtie2)</div>
    </div>

    <div class="grid-2">
      <div class="info-box">
        <h4>ğŸ“ åŠŸèƒ½æè¿°</h4>
        <p>ä½¿ç”¨ Bowtie2 å°†åºåˆ—æ¯”å¯¹åˆ°å®¿ä¸»å‚è€ƒåŸºå› ç»„ï¼Œå»é™¤å®¿ä¸»åºåˆ—ï¼š</p>
        <ul style="margin: 10px 0 10px 20px;">
          <li>åŒç«¯åºåˆ—æ¯”å¯¹</li>
          <li>æœªæ¯”å¯¹åºåˆ—è¾“å‡º</li>
          <li>BAM æ–‡ä»¶ç”Ÿæˆ</li>
          <li>æ”¯æŒæ•æ„Ÿæ¨¡å¼</li>
        </ul>
      </div>

      <div class="info-box">
        <h4>ğŸ”§ å…³é”®å‚æ•°</h4>
        <table class="param-table">
          <tr><th>å‚æ•°</th><th>é»˜è®¤å€¼</th><th>è¯´æ˜</th></tr>
          <tr><td><code>--host_retries</code></td><td>3</td><td>å¤±è´¥é‡è¯•æ¬¡æ•°</td></tr>
          <tr><td><code>--suffix1</code></td><td>_1.fastq.gz</td><td>R1 æ–‡ä»¶åç¼€</td></tr>
          <tr><td><code>--suffix2</code></td><td>_2.fastq.gz</td><td>R2 æ–‡ä»¶åç¼€</td></tr>
        </table>
      </div>
    </div>

    <div class="step-diagram">
<span class="comment">è¾“å…¥: 02-qc/SAMPLE001_1.fastq.gz, SAMPLE001_2.fastq.gz</span>

<span class="flow-arrow">â†“ Bowtie2 --very-sensitive</span>

<span class="comment">æ¯”å¯¹è¿‡ç¨‹:</span>
â”œâ”€â”€ æ¯”å¯¹æ¨¡å¼: --very-sensitive
â”œâ”€â”€ çº¿ç¨‹æ•°: --threads (é»˜è®¤ 32)
â”œâ”€â”€ è¾“å…¥: R1 + R2 FASTQ
â””â”€â”€ å‚è€ƒ: $db_bowtie2 ç´¢å¼•

<span class="flow-arrow">â†“</span>

<span class="comment">è¾“å‡ºæ–‡ä»¶:</span>
<span class="dir">03-hr/</span>
â”œâ”€â”€ <span class="file">SAMPLE001_host_remove_R1.fastq.gz</span>   <span class="comment"># æœªæ¯”å¯¹ R1</span>
â”œâ”€â”€ <span class="file">SAMPLE001_host_remove_R2.fastq.gz</span>   <span class="comment"># æœªæ¯”å¯¹ R2</span>
â””â”€â”€ <span class="file">SAMPLE001.task.complete</span>

<span class="dir">04-bam/</span>
â”œâ”€â”€ <span class="file">SAMPLE001.bam</span>                        <span class="comment"># æ¯”å¯¹ BAM</span>
â”œâ”€â”€ <span class="file">SAMPLE001.bam.bai</span>                     <span class="comment"># ç´¢å¼•</span>
â””â”€â”€ ...
    </div>

    <div class="tip">
      <strong>ğŸ’¡ æ€§èƒ½ä¼˜åŒ–ï¼š</strong> ä½¿ç”¨ <code>--very-sensitive</code> æ¨¡å¼ç¡®ä¿æœ€å¤§æ¯”å¯¹æ•æ„Ÿåº¦ã€‚è°ƒæ•´ <code>--threads</code> ä»¥åŒ¹é…å¯ç”¨ CPU æ ¸å¿ƒæ•°ã€‚
    </div>
  </div>

  <!-- æ­¥éª¤ 4 -->
  <div class="detail-step">
    <div class="detail-step-header">
      <div class="detail-step-num">4</div>
      <div class="detail-step-title">å®¿ä¸»å»é™¤ç»“æœéªŒè¯</div>
    </div>

    <p>éªŒè¯æ­¥éª¤ 3 è¾“å‡ºçš„ FASTQ æ–‡ä»¶å®Œæ•´æ€§ï¼Œç¡®ä¿æ‰€æœ‰æ–‡ä»¶å‡æ­£ç¡®ç”Ÿæˆã€‚</p>

    <div class="step-diagram">
<span class="comment">æ£€æŸ¥:</span>
â”œâ”€â”€ R1 æ–‡ä»¶: *_host_remove_R1.fastq.gz
â”œâ”€â”€ R2 æ–‡ä»¶: *_host_remove_R2.fastq.gz
â””â”€â”€ éªŒè¯å·¥å…·: pigz -t

<span class="flow-arrow">â†“</span>

<span class="comment">è¿”å›: (æœ‰æ•ˆæ ·æœ¬æ•°, æ— æ•ˆæ ·æœ¬æ•°)</span>

<span class="comment">éªŒè¯å¤±è´¥çš„æ–‡ä»¶ä¼šè¢«é‡æ–°å¤„ç†</span>
    </div>
  </div>

  <!-- æ­¥éª¤ 5 -->
  <div class="detail-step">
    <div class="detail-step-header">
      <div class="detail-step-num">5</div>
      <div class="detail-step-title">å®¿ä¸»åºåˆ—æå– (samtools fastq, å¯é€‰)</div>
    </div>

    <div class="grid-2">
      <div class="info-box">
        <h4>ğŸ“ åŠŸèƒ½æè¿°</h4>
        <p>ä» BAM æ–‡ä»¶ä¸­æå–æ¯”å¯¹åˆ°å®¿ä¸»åŸºå› ç»„çš„åºåˆ—ï¼Œç”¨äºåç»­åˆ†æï¼š</p>
        <ul style="margin: 10px 0 10px 20px;">
          <li>HLA åˆ†å‹åˆ†æ</li>
          <li>çº¿ç²’ä½“ DNA åˆ†æ</li>
          <li>å®¿ä¸»åŸºå› ç»„å˜å¼‚æ£€æµ‹</li>
        </ul>
      </div>

      <div class="info-box">
        <h4>ğŸ”§ å…³é”®å‚æ•°</h4>
        <table class="param-table">
          <tr><th>å‚æ•°</th><th>é»˜è®¤å€¼</th><th>è¯´æ˜</th></tr>
          <tr><td><code>--skip_host_extract</code></td><td>False</td><td>è·³è¿‡æ­¤æ­¥éª¤</td></tr>
          <tr><td><code>mode</code></td><td>mapped_anypair</td><td>æå–æ¨¡å¼</td></tr>
        </table>
      </div>
    </div>

    <div class="step-diagram">
<span class="comment">è¾“å…¥: 04-bam/SAMPLE001.bam</span>

<span class="flow-arrow">â†“ samtools fastq -F 0x2</span>

<span class="comment">æå–æ¨¡å¼:</span>
â”œâ”€â”€ mapped_anypair: ä»»ä¸€ç«¯æ¯”å¯¹
â”œâ”€â”€ mapped_all: ä¸¤ç«¯å‡æ¯”å¯¹
â”œâ”€â”€ unmapped: æœªæ¯”å¯¹
â””â”€â”€ ...

<span class="flow-arrow">â†“</span>

<span class="comment">è¾“å‡º: 05-host/SAMPLE001_host_R1.fastq.gz</span>
<span class="comment">      SAMPLE001_host_R2.fastq.gz</span>
    </div>

    <div class="tip">
      <strong>ğŸ’¡ è·³è¿‡æ­¤æ­¥éª¤ï¼š</strong> å¦‚æœä¸éœ€è¦å®¿ä¸»åºåˆ—è¿›è¡Œä¸‹æ¸¸åˆ†æï¼Œä½¿ç”¨ <code>--skip_host_extract</code> å¯ä»¥èŠ‚çœæ—¶é—´ã€‚
    </div>
  </div>

  <!-- æ­¥éª¤ 6 -->
  <div class="detail-step">
    <div class="detail-step-header">
      <div class="detail-step-num">6</div>
      <div class="detail-step-title">Kraken2 æ•°æ®åº“ç¼“å­˜ (å…±äº«å†…å­˜)</div>
    </div>

    <div class="grid-2">
      <div class="info-box">
        <h4>ğŸ“ åŠŸèƒ½æè¿°</h4>
        <p>å°† Kraken2 æ•°æ®åº“å¤åˆ¶åˆ°å…±äº«å†…å­˜ï¼ˆ/dev/shm/ï¼‰ï¼Œæ˜¾è‘—åŠ é€Ÿåˆ†ç±»æ­¥éª¤ï¼š</p>
        <ul style="margin: 10px 0 10px 20px;">
          <li>å‡å°‘ I/O ç­‰å¾…æ—¶é—´</li>
          <li>åˆ©ç”¨ RAM é«˜é€Ÿè®¿é—®</li>
          <li>å¯é€‰ vmtouch é¢„åŠ è½½</li>
        </ul>
      </div>

      <div class="info-box">
        <h4>ğŸ”§ å…³é”®å‚æ•°</h4>
        <table class="param-table">
          <tr><th>å‚æ•°</th><th>é»˜è®¤å€¼</th><th>è¯´æ˜</th></tr>
          <tr><td><code>--copy_db_to_shm</code></td><td>True</td><td>å¯ç”¨ç¼“å­˜</td></tr>
          <tr><td><code>--shm_path</code></td><td>/dev/shm/k2ppf</td><td>ç¼“å­˜è·¯å¾„</td></tr>
          <tr><td><code>--no_shm</code></td><td>-</td><td>ç¦ç”¨ç¼“å­˜</td></tr>
        </table>
      </div>
    </div>

    <div class="step-diagram">
<span class="comment">æ£€æŸ¥: æ•°æ®åº“å·²å­˜åœ¨?</span>
â”œâ”€â”€ æ˜¯: è·³è¿‡å¤åˆ¶
â””â”€â”€ å¦: æ‰§è¡Œå¤åˆ¶

<span class="flow-arrow">â†“</span>

<span class="comment">æ•°æ®åº“æ–‡ä»¶éªŒè¯:</span>
â”œâ”€â”€ hash.k2d    <span class="comment"># å“ˆå¸Œç´¢å¼•</span>
â”œâ”€â”€ opts.k2d    <span class="comment"># é€‰é¡¹æ–‡ä»¶</span>
â””â”€â”€ taxo.k2d    <span class="comment"># åˆ†ç±»å­¦ä¿¡æ¯</span>

<span class="flow-arrow">â†“</span>

<span class="comment">å¤åˆ¶åˆ°: /dev/shm/k2ppf/</span>

<span class="comment">å¯é€‰: vmtouch -t é¢„åŠ è½½åˆ°å†…å­˜</span>
    </div>

    <div class="tip">
      <strong>ğŸ’¡ å†…å­˜è¦æ±‚ï¼š</strong> æ ‡å‡†æ•°æ®åº“çº¦ 100GBï¼Œç¡®ä¿å…±äº«å†…å­˜è¶³å¤Ÿå¤§ã€‚ä½¿ç”¨ <code>df -h /dev/shm</code> æ£€æŸ¥å¯ç”¨ç©ºé—´ã€‚
    </div>

    <div class="warning">
      <strong>âš ï¸ æ³¨æ„ï¼š</strong> å¦‚æœå…±äº«å†…å­˜ä¸è¶³ï¼Œæµæ°´çº¿ä¼šè‡ªåŠ¨å›é€€åˆ°ä½¿ç”¨ç£ç›˜ä¸Šçš„æ•°æ®åº“ã€‚
    </div>
  </div>

  <!-- æ­¥éª¤ 7 -->
  <div class="detail-step">
    <div class="detail-step-header">
      <div class="detail-step-num">7</div>
      <div class="detail-step-title">ç‰©ç§åˆ†ç±» (Kraken2 + Bracken)</div>
    </div>

    <div class="grid-2">
      <div class="info-box">
        <h4>ğŸ“ åŠŸèƒ½æè¿°</h4>
        <p>ä½¿ç”¨ Kraken2 è¿›è¡Œç‰©ç§åˆ†ç±»ï¼Œå¯é€‰è¿è¡Œ Bracken ä¸°åº¦ä¼°è®¡ï¼š</p>
        <ul style="margin: 10px 0 10px 20px;">
          <li>k-mer ç²¾ç¡®åŒ¹é…åˆ†ç±»</li>
          <li>å¿«é€Ÿåˆ†ç±»é€Ÿåº¦</li>
          <li>Bracken ä¸°åº¦æ ¡æ­£</li>
          <li>æ”¯æŒå¤šåˆ†ç±»çº§åˆ«</li>
        </ul>
      </div>

      <div class="info-box">
        <h4>ğŸ”§ å…³é”®å‚æ•°</h4>
        <table class="param-table">
          <tr><th>å‚æ•°</th><th>é»˜è®¤å€¼</th><th>è¯´æ˜</th></tr>
          <tr><td><code>--kraken_retries</code></td><td>3</td><td>å¤±è´¥é‡è¯•æ¬¡æ•°</td></tr>
          <tr><td><code>--enable_bracken_step7</code></td><td>False</td><td>æ­¥éª¤ 7 è¿è¡Œ Bracken</td></tr>
          <tr><td><code>--batch</code></td><td>2</td><td>å¹¶è¡Œæ ·æœ¬æ•°</td></tr>
        </table>
      </div>
    </div>

    <div class="step-diagram">
<span class="comment">è¾“å…¥: 03-hr/SAMPLE001_host_remove_R1.fastq.gz</span>
<span class="comment">      SAMPLE001_host_remove_R2.fastq.gz</span>

<span class="flow-arrow">â†“ Kraken2 åˆ†ç±»</span>

<span class="comment">Kraken2 å‘½ä»¤:</span>
kraken2 --db $db_kraken \
        --threads 32 \
        --report SAMPLE001.kraken.report.std.txt \
        --output SAMPLE001.kraken.output.std.txt \
        --paired 03-hr/SAMPLE001_host_remove_R1.fastq.gz \
                03-hr/SAMPLE001_host_remove_R2.fastq.gz

<span class="flow-arrow">â†“</span>

<span class="comment">è¾“å‡º:</span>
<span class="dir">06-ku/</span>
â”œâ”€â”€ <span class="file">SAMPLE001.kraken.report.std.txt</span>    <span class="comment"># åˆ†ç±»æŠ¥å‘Š</span>
â”œâ”€â”€ <span class="file">SAMPLE001.kraken.output.std.txt</span>    <span class="comment"># åˆ†ç±»è¯¦æƒ…</span>
â””â”€â”€ <span class="file">SAMPLE001.kraken.task.complete</span>

<span class="comment">å¦‚æœå¯ç”¨ Bracken:</span>
<span class="dir">07-bracken/</span>
â”œâ”€â”€ <span class="file">SAMPLE001.S.bracken</span>               <span class="comment"># ç§çº§</span>
â”œâ”€â”€ <span class="file">SAMPLE001.G.bracken</span>               <span class="comment"># å±çº§</span>
â””â”€â”€ <span class="file">SAMPLE001.F.bracken</span>               <span class="comment"># ç§‘çº§</span>
    </div>

    <div class="tip">
      <strong>ğŸ’¡ æ‰¹å¤„ç†æ¨¡å¼ï¼š</strong> Kraken2 åˆ†ç±»å¯¹å†…å­˜éœ€æ±‚è¾ƒé«˜ï¼Œå»ºè®® <code>--batch</code> è®¾ç½®ä¸º 1-2ã€‚æ¯ä¸ªæ ·æœ¬ä½¿ç”¨ <code>--threads</code> æŒ‡å®šçš„çº¿ç¨‹æ•°ã€‚
    </div>
  </div>

  <!-- æ­¥éª¤ 8 -->
  <div class="detail-step">
    <div class="detail-step-header">
      <div class="detail-step-num">8</div>
      <div class="detail-step-title">Kraken æŠ¥å‘ŠéªŒè¯</div>
    </div>

    <p>éªŒè¯ Kraken2 æŠ¥å‘Šæ–‡ä»¶çš„æ ¼å¼å’Œå†…å®¹å®Œæ•´æ€§ã€‚</p>

    <div class="step-diagram">
<span class="comment">éªŒè¯é¡¹:</span>
â”œâ”€â”€ æ–‡ä»¶å­˜åœ¨æ€§
â”œâ”€â”€ æ–‡ä»¶æ ¼å¼æ­£ç¡®æ€§
â”œâ”€â”€ æŠ¥å‘Šå¤´æ ¼å¼
â””â”€â”€ è‡³å°‘æœ‰ä¸€æ¡åˆ†ç±»è®°å½•

<span class="flow-arrow">â†“</span>

<span class="comment">è¿”å›: (æœ‰æ•ˆæ ·æœ¬æ•°, æ— æ•ˆæ ·æœ¬æ•°)</span>

<span class="comment">æ— æ•ˆæ ·æœ¬:</span>
â”œâ”€â”€ è®°å½•æ—¥å¿—è­¦å‘Š
â””â”€â”€ ç»§ç»­å¤„ç†å…¶ä»–æ ·æœ¬
    </div>
  </div>

  <!-- æ­¥éª¤ 9 -->
  <div class="detail-step">
    <div class="detail-step-header">
      <div class="detail-step-num">9</div>
      <div class="detail-step-title">å®¿ä¸»åˆ†ç±»è¿‡æ»¤ + é‡æ–°åˆ†ç±»</div>
    </div>

    <div class="grid-2">
      <div class="info-box">
        <h4>ğŸ“ åŠŸèƒ½æè¿°</h4>
        <p>ä» Kraken æŠ¥å‘Šä¸­ç§»é™¤å®¿ä¸»ç›¸å…³åˆ†ç±»ï¼ˆå¦‚äººç±»ï¼‰ï¼Œé‡æ–°è¿è¡Œ Brackenï¼š</p>
        <ul style="margin: 10px 0 10px 20px;">
          <li>ç§»é™¤äººç±»/å®¿ä¸» taxid</li>
          <li>ä¿ç•™å¾®ç”Ÿç‰©åˆ†ç±»</li>
          <li>é‡æ–°ä¼°è®¡ä¸°åº¦</li>
          <li>è®¡ç®—å¤šæ ·æ€§æŒ‡æ•°ï¼ˆå¯é€‰ï¼‰</li>
        </ul>
      </div>

      <div class="info-box">
        <h4>ğŸ”§ å…³é”®å‚æ•°</h4>
        <table class="param-table">
          <tr><th>å‚æ•°</th><th>é»˜è®¤å€¼</th><th>è¯´æ˜</th></tr>
          <tr><td><code>--min_count</code></td><td>4</td><td>Bracken æœ€å°è®¡æ•°</td></tr>
        </table>
      </div>
    </div>

    <div class="step-diagram">
<span class="comment">è¾“å…¥: 06-ku/SAMPLE001.kraken.report.std.txt</span>

<span class="flow-arrow">â†“ è¿‡æ»¤å®¿ä¸»åˆ†ç±»</span>

<span class="comment">å¤„ç†:</span>
â”œâ”€â”€ ç§»é™¤äººç±» taxid (9606, 9605, ...)
â”œâ”€â”€ ä¿ç•™å¾®ç”Ÿç‰©åˆ†ç±»
â”œâ”€â”€ ç”Ÿæˆ MPA æ ¼å¼
â””â”€â”€ ç”Ÿæˆè¿‡æ»¤åæŠ¥å‘Š

<span class="flow-arrow">â†“</span>

<span class="comment">è¾“å‡º:</span>
<span class="dir">08-ku2/</span>
â”œâ”€â”€ <span class="file">SAMPLE001.nohuman.kraken.mpa.std.txt</span>      <span class="comment"># MPA æ ¼å¼</span>
â”œâ”€â”€ <span class="file">SAMPLE001.nohuman.kraken.report.std.txt</span> <span class="comment"># è¿‡æ»¤åæŠ¥å‘Š</span>
â””â”€â”€ <span class="file">SAMPLE001.task.complete</span>

<span class="flow-arrow">â†“ é‡æ–°è¿è¡Œ Bracken</span>

<span class="comment">Bracken è¾“å‡º:</span>
â”œâ”€â”€ <span class="file">SAMPLE001.nohuman.bracken</span>               <span class="comment"># é‡æ–°ä¼°è®¡çš„ä¸°åº¦</span>
â”œâ”€â”€ <span class="file">SAMPLE001.nohuman.S.bracken</span>
â”œâ”€â”€ <span class="file">SAMPLE001.nohuman.G.bracken</span>
â””â”€â”€ <span class="file">SAMPLE001.nohuman.F.bracken</span>

<span class="comment">å¯é€‰: è®¡ç®—å¤šæ ·æ€§æŒ‡æ•°</span>
â”œâ”€â”€ Shannon's diversity
â”œâ”€â”€ Simpson's index
â”œâ”€â”€ Berger-Parker dominance
â””â”€â”€ Fisher's alpha (éœ€è¦ scipy)
    </div>

    <div class="tip">
      <strong>ğŸ’¡ ä¸ºä»€ä¹ˆéœ€è¦æ­¥éª¤ 9ï¼š</strong> æ­¥éª¤ 7 çš„ Kraken æŠ¥å‘ŠåŒ…å«å®¿ä¸»åˆ†ç±»ï¼Œè¿™ä¼šå½±å“å¾®ç”Ÿç‰©ç¾¤è½åˆ†æã€‚æ­¥éª¤ 9 ç§»é™¤å®¿ä¸»åˆ†ç±»åé‡æ–°è¿è¡Œ Brackenï¼Œè·å¾—æ›´å‡†ç¡®çš„å¾®ç”Ÿç‰©ä¸°åº¦ä¼°è®¡ã€‚
    </div>
  </div>

  <!-- æ­¥éª¤ 10 -->
  <div class="detail-step">
    <div class="detail-step-header">
      <div class="detail-step-num">10</div>
      <div class="detail-step-title">ç»“æœçŸ©é˜µåˆå¹¶</div>
    </div>

    <div class="grid-2">
      <div class="info-box">
        <h4>ğŸ“ åŠŸèƒ½æè¿°</h4>
        <p>åˆå¹¶æ‰€æœ‰æ ·æœ¬çš„ç»“æœä¸ºç»Ÿä¸€çŸ©é˜µï¼Œä¾¿äºä¸‹æ¸¸åˆ†æï¼š</p>
        <ul style="margin: 10px 0 10px 20px;">
          <li>OTU è¡¨ç”Ÿæˆ</li>
          <li>MPA æ ¼å¼åˆå¹¶</li>
          <li>Bracken è¡¨åˆå¹¶</li>
          <li>æ”¯æŒé¡¹ç›®å‰ç¼€</li>
        </ul>
      </div>

      <div class="info-box">
        <h4>ğŸ”§ å…³é”®å‚æ•°</h4>
        <table class="param-table">
          <tr><th>å‚æ•°</th><th>é»˜è®¤å€¼</th><th>è¯´æ˜</th></tr>
          <tr><td><code>--project_prefix</code></td><td>""</td><td>è¾“å‡ºæ–‡ä»¶å‰ç¼€</td></tr>
        </table>
      </div>
    </div>

    <div class="step-diagram">
<span class="comment">è¾“å…¥: æ‰€æœ‰æ ·æœ¬çš„ 08-ku2/ ç›®å½•</span>
<span class="comment">      â”œâ”€â”€ SAMPLE001.nohuman.kraken.mpa.std.txt</span>
<span class="comment">      â”œâ”€â”€ SAMPLE001.nohuman.bracken</span>
<span class="comment">      â”œâ”€â”€ SAMPLE002.nohuman.kraken.mpa.std.txt</span>
<span class="comment">      â”œâ”€â”€ SAMPLE002.nohuman.bracken</span>
<span class="comment">      â””â”€â”€ ...</span>

<span class="flow-arrow">â†“ è°ƒç”¨ helper è„šæœ¬</span>

<span class="comment">helper/kreport2mpa.py</span>
â”œâ”€â”€ è½¬æ¢ Kraken æŠ¥å‘Šä¸º MPA æ ¼å¼
â””â”€â”€ ç”Ÿæˆç‰©ç§è·¯å¾„

<span class="comment">helper/combine_mpa.py</span>
â”œâ”€â”€ åˆå¹¶æ‰€æœ‰æ ·æœ¬çš„ MPA æ–‡ä»¶
â””â”€â”€ ç”Ÿæˆ combined.mpa.tsv

<span class="comment">helper/combine_bracken_outputs.py</span>
â”œâ”€â”€ åˆå¹¶æ‰€æœ‰æ ·æœ¬çš„ Bracken è¡¨
â””â”€â”€ ç”Ÿæˆ combined.bracken.tsv

<span class="comment">helper/kraken2otu.py</span>
â”œâ”€â”€ ç”Ÿæˆ OTU è¡¨
â””â”€â”€ ç”Ÿæˆ combined.otu.tsv

<span class="flow-arrow">â†“</span>

<span class="comment">è¾“å‡º: 09-mpa/</span>
â”œâ”€â”€ <span class="file">prefix_combined.mpa.tsv</span>        <span class="comment"># ç‰©ç§è·¯å¾„ Ã— æ ·æœ¬çŸ©é˜µ</span>
â”œâ”€â”€ <span class="file">prefix_combined.bracken.tsv</span>     <span class="comment"># Bracken ä¸°åº¦è¡¨</span>
â”œâ”€â”€ <span class="file">prefix_combined.otu.tsv</span>         <span class="comment"># OTU è¡¨</span>
â””â”€â”€ <span class="file">step6.task.complete</span>

<span class="comment">æ ¼å¼ç¤ºä¾‹:</span>
<span class="comment"># combined.mpa.tsv</span>
k__Bacteria|...|g__Escherichia|m_coli|s__coli    1000    500    0
k__Bacteria|...|g__Lactobacillus|...         500    2000   100
...
    </div>

    <div class="tip">
      <strong>ğŸ’¡ æ­¥éª¤ 10 å‰ç½®æ¡ä»¶ï¼š</strong> éœ€è¦æ­¥éª¤ 9 çš„è¾“å‡ºæ–‡ä»¶ï¼š<code>*.nohuman.kraken.mpa.std.txt</code> å’Œ <code>*.bracken</code>ã€‚æµæ°´çº¿å¯åŠ¨æ—¶ä¼šæ£€æŸ¥è¿™äº›æ–‡ä»¶æ˜¯å¦å­˜åœ¨ã€‚
    </div>

    <div class="warning">
      <strong>âš ï¸ pandas/numpy ä¾èµ–ï¼š</strong> æ­¥éª¤ 10 éœ€è¦ pandas å’Œ numpyã€‚å¦‚æœè¿™äº›åŒ…æœªå®‰è£…ï¼Œ<code>run_merge_step</code> å°†ä¸º Noneï¼Œæµæ°´çº¿ä¼šåœ¨æ­¥éª¤ 10 ä¹‹å‰åœæ­¢ã€‚
    </div>
  </div>
</div>

<!-- ======================================================================= -->
<div class="section">
  <h2>ğŸ§° ä¸‰ã€ç¯å¢ƒå‡†å¤‡</h2>

  <h3>3.1 ç³»ç»Ÿè¦æ±‚</h3>
  <table>
    <thead>
      <tr><th>é¡¹ç›®</th><th>æœ€ä½è¦æ±‚</th><th>æ¨èé…ç½®</th></tr>
    </thead>
    <tbody>
      <tr><td><strong>æ“ä½œç³»ç»Ÿ</strong></td><td>Linux / WSL</td><td>Ubuntu 20.04+, CentOS 7+, Rocky Linux 8+</td></tr>
      <tr><td><strong>Python ç‰ˆæœ¬</strong></td><td>â‰¥ 3.8</td><td>3.9 æˆ– 3.10</td></tr>
      <tr><td><strong>å†…å­˜</strong></td><td>32 GB</td><td>128 GB+ï¼ˆå¤§è§„æ¨¡æ ·æœ¬ï¼‰</td></tr>
      <tr><td><strong>å­˜å‚¨</strong></td><td>SSD</td><td>NVMe SSDï¼ˆåŠ é€Ÿ I/Oï¼‰</td></tr>
      <tr><td><strong>CPU</strong></td><td>8 æ ¸å¿ƒ</td><td>32+ æ ¸å¿ƒï¼ˆæ”¯æŒå¹¶è¡Œï¼‰</td></tr>
      <tr><td><strong>å…±äº«å†…å­˜</strong></td><td>â‰¥ 100 GB</td><td>â‰¥ 200 GBï¼ˆæ ‡å‡†æ•°æ®åº“ï¼‰</td></tr>
    </tbody>
  </table>

  <h3>3.2 åˆ›å»º Conda ç¯å¢ƒ</h3>
  <pre><code><span class="comment"># æ–¹æ³• 1ï¼šä½¿ç”¨é¡¹ç›®æä¾›çš„ environment.yml</span>
conda env create -f environment.yml
conda activate meta

<span class="comment"># æ–¹æ³• 2ï¼šæ‰‹åŠ¨åˆ›å»ºç¯å¢ƒ</span>
conda create -n flowmeta python=3.10 -y
conda activate flowmeta

<span class="comment"># å®‰è£…ç”Ÿç‰©ä¿¡æ¯å­¦å·¥å…·</span>
conda install -c bioconda fastp bowtie2 samtools kraken2 bracken -y
conda install -c conda-forge scipy pandas numpy pigz seqkit -y

<span class="comment"># éªŒè¯å®‰è£…</span>
fastp --version
bowtie2 --version
samtools --version
kraken2 --version
bracken --version
python -c "import pandas, numpy; print('Python OK')"</code></pre>

  <h3>3.3 å®‰è£… FlowMeta</h3>
  <pre><code><span class="comment"># æ–¹å¼ 1ï¼šä» PyPI å®‰è£…ï¼ˆæ¨èï¼‰</span>
pip install flowmeta

<span class="comment"># æ–¹å¼ 2ï¼šä»æœ¬åœ° wheel æ–‡ä»¶å®‰è£…</span>
pip install dist/flowmeta-0.1.5-py3-none-any.whl

<span class="comment"># æ–¹å¼ 3ï¼šå¼€å‘æ¨¡å¼å®‰è£…</span>
git clone https://github.com/SkinMicrobe/FlowMeta.git
cd FlowMeta
pip install -e .

<span class="comment"># éªŒè¯å®‰è£…</span>
flowmeta_base --help</code></pre>
</div>

<!-- ======================================================================= -->
<div class="section">
  <h2>ğŸ§¬ å››ã€æ•°æ®åº“å‡†å¤‡</h2>

  <h3>4.1 Kraken2 æ ‡å‡†æ•°æ®åº“</h3>
  <pre><code><span class="comment"># åˆ›å»ºæ•°æ®åº“ç›®å½•</span>
mkdir -p /mnt/db/kraken2
cd /mnt/db/kraken2

<span class="comment"># ä¸‹è½½æ ‡å‡†æ•°æ®åº“ï¼ˆçº¦ 100GBï¼‰</span>
wget https://benlangmead.github.io/aws-indexes/k2/k2_standard_20240112.tar.gz
tar -xzf k2_standard_20240112.tar.gz

<span class="comment"># éªŒè¯æ•°æ®åº“æ–‡ä»¶</span>
ls k2_standard_20240112/
<span class="comment"># åº”åŒ…å«ï¼šhash.k2d, opts.k2d, taxo.k2d, database.k2d, read_library.bin</span></code></pre>

  <h3>4.2 Bowtie2 å®¿ä¸»ç´¢å¼•ï¼ˆGRCh38ï¼‰</h3>
  <pre><code><span class="comment"># åˆ›å»ºç´¢å¼•ç›®å½•</span>
mkdir -p /mnt/db/bowtie2
cd /mnt/db/bowtie2

<span class="comment"># ä¸‹è½½äººç±»å‚è€ƒåŸºå› ç»„</span>
wget https://ftp.ncbi.nlm.nih.gov/genomes/all/\
GCA/000/001/405/GCA_000001405.28_GRCh38.p13/\
GCA_000001405.28_GRCh38.p13_genomic.fna.gz

<span class="comment"># å¯é€‰ï¼šå»é™¤æ›¿ä»£åºåˆ—å’Œè¡¥ä¸åºåˆ—</span>
seqkit grep -rvp "alt|PATCH" GCA_000001405.28_GRCh38.p13_genomic.fna.gz \
  > GRCh38_noalt.fna

<span class="comment"># æ„å»º Bowtie2 ç´¢å¼•</span>
bowtie2-build GRCh38_noalt.fna /mnt/db/bowtie2/GRCh38_noalt_as/GRCh38_noalt_as

<span class="comment"># éªŒè¯ç´¢å¼•æ–‡ä»¶</span>
ls /mnt/db/bowtie2/GRCh38_noalt_as/
<span class="comment"># åº”åŒ…å«ï¼š*.bt2 æ–‡ä»¶ï¼ˆ6 ä¸ªæ–‡ä»¶ï¼‰</span></code></pre>
</div>

<!-- ======================================================================= -->
<div class="section">
  <h2>ğŸš€ äº”ã€å¿«é€Ÿå¼€å§‹</h2>

  <h3>5.1 åŸºæœ¬å‘½ä»¤</h3>
  <pre><code><span class="comment"># å®Œæ•´æµæ°´çº¿è¿è¡Œ</span>
flowmeta_base \
  --input_dir /mnt/data/flowmeta/01-raw \
  --output_dir /mnt/data/flowmeta/results \
  --db_bowtie2 /mnt/db/bowtie2/GRCh38_noalt_as/GRCh38_noalt_as \
  --db_kraken /mnt/db/kraken2/k2_standard_20240112 \
  --threads 32 \
  --batch 2</code></pre>

  <h3>5.2 ä»æ­¥éª¤ 10 æ¢å¤ï¼ˆä»…åˆå¹¶ç»“æœï¼‰</h3>
  <pre><code><span class="comment"># è¿™æ­£æ˜¯æ‚¨ä¹‹å‰è¿è¡Œçš„å‘½ä»¤</span>
flowmeta_base \
  --input_dir /mnt/cephfs/s2z4/01-smooth/01-mg/01-raw \
  --output_dir /mnt/cephfs/s2z4/01-smooth/01-mg \
  --db_bowtie2 $db_bowtie2 \
  --db_kraken $db_kraken \
  --threads 32 \
  --step 10 \
  --batch 1</code></pre>

  <h3>5.3 å‚æ•°é€ŸæŸ¥è¡¨</h3>
  <table>
    <thead>
      <tr><th>å‚æ•°</th><th>é»˜è®¤å€¼</th><th>è¯´æ˜</th></tr>
    </thead>
    <tbody>
      <tr><td><code>--input_dir</code></td><td>-</td><td>åŸå§‹ FASTQ ç›®å½•</td></tr>
      <tr><td><code>--output_dir</code></td><td>-</td><td>è¾“å‡ºç›®å½•</td></tr>
      <tr><td><code>--db_bowtie2</code></td><td>-</td><td>Bowtie2 ç´¢å¼•å‰ç¼€</td></tr>
      <tr><td><code>--db_kraken</code></td><td>-</td><td>Kraken2 æ•°æ®åº“ç›®å½•</td></tr>
      <tr><td><code>--threads</code></td><td>32</td><td>æ¯è¿›ç¨‹çº¿ç¨‹æ•°</td></tr>
      <tr><td><code>--batch</code></td><td>2</td><td>å¹¶è¡Œæ ·æœ¬æ‰¹æ¬¡</td></tr>
      <tr><td><code>--step</code></td><td>None</td><td>ä»æ­¥éª¤ N æ¢å¤ (1-10)</td></tr>
      <tr><td><code>--step_only</code></td><td>False</td><td>ä»…è¿è¡ŒæŒ‡å®šæ­¥éª¤</td></tr>
      <tr><td><code>--force</code></td><td>False</td><td>å¼ºåˆ¶é‡æ–°è¿è¡Œ</td></tr>
      <tr><td><code>--project_prefix</code></td><td>""</td><td>æ­¥éª¤ 10 è¾“å‡ºå‰ç¼€</td></tr>
      <tr><td><code>--se</code></td><td>False</td><td>å•ç«¯æµ‹åºæ¨¡å¼</td></tr>
      <tr><td><code>--skip_integrity_checks</code></td><td>False</td><td>è·³è¿‡å®Œæ•´æ€§æ£€æŸ¥</td></tr>
      <tr><td><code>--skip_host_extract</code></td><td>False</td><td>è·³è¿‡æ­¥éª¤ 5</td></tr>
      <tr><td><code>--no_shm</code></td><td>-</td><td>ç¦ç”¨å…±äº«å†…å­˜ç¼“å­˜</td></tr>
      <tr><td><code>--fastp_length_required</code></td><td>50</td><td>fastp æœ€å°è¯»é•¿</td></tr>
      <tr><td><code>--enable_bracken_step7</code></td><td>False</td><td>æ­¥éª¤ 7 è¿è¡Œ Bracken</td></tr>
      <tr><td><code>--min_count</code></td><td>4</td><td>Bracken æœ€å°è®¡æ•°</td></tr>
    </tbody>
  </table>
</div>

<!-- ======================================================================= -->
<div class="section">
  <h2>ğŸ›¡ï¸ å…­ã€æ£€æŸ¥ç‚¹ä¸æ¢å¤æœºåˆ¶</h2>

  <p>FlowMeta ä½¿ç”¨ <code>.task.complete</code> æ–‡ä»¶æ ‡è®°æ¯ä¸ªæ ·æœ¬çš„å¤„ç†çŠ¶æ€ï¼Œæ”¯æŒæ–­ç‚¹ç»­è·‘ï¼š</p>

  <table>
    <thead>
      <tr><th>æ ‡è®°æ–‡ä»¶</th><th>ä½ç½®</th><th>å¯¹åº”æ­¥éª¤</th></tr>
    </thead>
    <tbody>
      <tr><td><code>*.task.complete</code></td><td><code>02-qc/</code></td><td>æ­¥éª¤ 1: fastp è´¨æ§å®Œæˆ</td></tr>
      <tr><td><code>*.task.complete</code></td><td><code>03-hr/</code></td><td>æ­¥éª¤ 3: å®¿ä¸»å»é™¤å®Œæˆ</td></tr>
      <tr><td><code>*.kraken.task.complete</code></td><td><code>06-ku/</code></td><td>æ­¥éª¤ 7: Kraken åˆ†ç±»å®Œæˆ</td></tr>
      <tr><td><code>*.task.complete</code></td><td><code>08-ku2/</code></td><td>æ­¥éª¤ 9: å®¿ä¸»è¿‡æ»¤å®Œæˆ</td></tr>
    </tbody>
  </table>

  <div class="tip">
    <strong>ğŸ’¡ æ¢å¤ç­–ç•¥ï¼š</strong>
    <ul style="margin: 10px 0 0 20px;">
      <li>ä½¿ç”¨ <code>--step N</code> ä»æ­¥éª¤ N å¼€å§‹è¿è¡Œ</li>
      <li>å·²å®Œæˆçš„æ ·æœ¬ä¼šè¢«è‡ªåŠ¨è·³è¿‡</li>
      <li>ä½¿ç”¨ <li><code>--force</code> å¼ºåˆ¶é‡æ–°è¿è¡Œæ‰€æœ‰æ ·æœ¬</li>
      <li>åˆ é™¤ç‰¹å®šæ ·æœ¬çš„ <code>.task.complete</code> æ–‡ä»¶å¯å•ç‹¬é‡æ–°å¤„ç†è¯¥æ ·æœ¬</li>
    </ul>
  </div>
</div>

<!-- ======================================================================= -->
<div class="section">
  <h2>â“ ä¸ƒã€å¸¸è§é—®é¢˜</h2>

  <h3>7.1 æŠ€æœ¯é—®é¢˜</h3>
  <table>
    <thead>
      <tr><th>é—®é¢˜</th><th>è§£å†³æ–¹æ¡ˆ</th></tr>
    </thead>
    <tbody>
      <tr><td>å¦‚ä½•ä»ç‰¹å®šæ­¥éª¤æ¢å¤ï¼Ÿ</td><td>ä½¿ç”¨ <code>--step N</code> å‚æ•°</td></tr>
      <tr><td>å¦‚ä½•å¼ºåˆ¶é‡æ–°è¿è¡ŒæŸä¸ªæ­¥éª¤ï¼Ÿ</td><td>ä½¿ç”¨ <code>--step N --force</code></td></tr>
      <tr><td>å…±äº«å†…å­˜ç¼“å­˜æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ</td><td>å°† Kraken2 æ•°æ®åº“å¤åˆ¶åˆ° <code>/dev/shm/</code> åŠ é€Ÿåˆ†ç±»</td></tr>
      <tr><td>å¦‚ä½•å¤„ç†å•ç«¯æµ‹åºæ•°æ®ï¼Ÿ</td><td>ä½¿ç”¨ <code>--se</code> æ ‡å¿—</td></tr>
      <tr><td>å¦‚ä½•è·³è¿‡å®Œæ•´æ€§æ£€æŸ¥ï¼Ÿ</td><td>ä½¿ç”¨ <code>--skip_integrity_checks</code></td></tr>
      <tr><td>æ­¥éª¤ 10 ä¾èµ–ä»€ä¹ˆï¼Ÿ</td><td>éœ€è¦æ­¥éª¤ 9 çš„è¾“å‡ºæ–‡ä»¶</td></tr>
      <tr><td>å¦‚ä½•å¢åŠ å¹¶è¡Œå¤„ç†çš„æ ·æœ¬æ•°ï¼Ÿ</td><td>è°ƒæ•´ <code>--batch</code> å‚æ•°</td></tr>
    </tbody>
  </table>

  <h3>7.2 æ€§èƒ½ä¼˜åŒ–å»ºè®®</h3>
  <table>
    <thead>
      <tr><th>åœºæ™¯</th><th>ä¼˜åŒ–æ–¹æ³•</th></tr>
    </thead>
    <tbody>
      <tr><td>Kraken2 åˆ†ç±»æ…¢</td><td>ä½¿ç”¨å…±äº«å†…å­˜ç¼“å­˜ <code>/dev/shm</code></td></tr>
      <tr><td>å¤§é‡å°æ–‡ä»¶</td><td>å¢åŠ  <code>--batch</code> å€¼</td></tr>
      <tr><td>I/O ç“¶é¢ˆ</td><td>ä½¿ç”¨ NVMe SSD å­˜å‚¨</td></tr>
      <tr><td>å†…å­˜ä¸è¶³</td><td>å‡å°‘ <code>--batch</code> å’Œ <code>--threads</code></td></tr>
      <tr><td>éœ€è¦å¿«é€Ÿç»“æœ</td><td>ä½¿ç”¨ <code>--skip_integrity_checks</code></td></tr>
    </tbody>
  </table>
</div>

<!-- ======================================================================= -->
<div class="section">
  <h2>ğŸ¤ å…«ã€æ”¯æŒä¸å¼•ç”¨</h2>

  <div class="tip">
    <h4 style="margin-top: 0;">ğŸ“§ æŠ€æœ¯æ”¯æŒ</h4>
    <p><strong>ç»´æŠ¤è€…ï¼š</strong> æ›¾ä¸œå¼º (Dongqiang Zeng)</p>
    <p><strong>æœºæ„ï¼š</strong> å—æ–¹åŒ»ç§‘å¤§å­¦ (Southern Medical University)</p>
    <p><strong>é‚®ç®±ï¼š</strong> <a href="mailto:interlaken@smu.edu.cn">interlaken@smu.edu.cn</a></p>
  </div>

  <h3>å¼•ç”¨</h3>
  <p>å¦‚æœ FlowMeta å¯¹æ‚¨çš„ç ”ç©¶æœ‰å¸®åŠ©ï¼Œè¯·å¼•ç”¨æˆ‘ä»¬çš„ä»£ç ä»“åº“ï¼š</p>
  <pre><code>@software{flowmeta2025,
  title = {FlowMeta: Automated End-to-End Metagenomic Profiling Pipeline},
  author = {Zeng, Dongqiang},
  year = {2025},
  url = {https://github.com/SkinMicrobe/FlowMeta},
  institution = {Southern Medical University}
}</code></pre>

  <h3>ç›¸å…³å·¥å…·</h3>
  <ul>
    <li><a href="https://github.com/OpenGene/fastp" target="_blank">fastp</a> - FASTQ è´¨æ§ä¸ä¿®å‰ª</li>
    <li><a href="http://bowtie-bio.sourceforge.net/bowtie2/index.shtml" target="_blank">Bowtie2</a> - åºåˆ—æ¯”å¯¹</li>
    <li><a href="https://github.com/DerrickWood/kraken2" target="_blank">Kraken2</a> - ç‰©ç§åˆ†ç±»</li>
    <li><a href="https://github.com/jenniferlu717/Bracken" target="_blank">Bracken</a> - ä¸°åº¦ä¼°è®¡</li>
  </ul>

  <p style="text-align: center; margin-top: 40px; font-size: 1.1em; color: #1a4d8f;">
    ğŸ‰ ç¥æ‚¨åˆ†æé¡ºåˆ©ï¼Happy Sequencing!
  </p>
</div>

</div>

</body>
</html>
