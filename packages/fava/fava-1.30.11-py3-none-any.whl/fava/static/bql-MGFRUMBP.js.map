{
  "version": 3,
  "sources": ["../../../frontend/src/codemirror/bql-highlight.ts", "../../../frontend/src/codemirror/bql-grammar.ts", "../../../frontend/src/codemirror/bql-autocomplete.ts", "../../../frontend/src/codemirror/bql-stream-parser.ts", "../../../frontend/src/codemirror/bql-language.ts", "../../../frontend/src/codemirror/bql.ts"],
  "sourcesContent": ["import { HighlightStyle } from \"@codemirror/language\";\nimport { tags } from \"@lezer/highlight\";\n\nexport const bql_highlight = HighlightStyle.define([\n  {\n    // Keywords: Select, Where, And\n    tag: tags.keyword,\n    color: \"var(--bql-keywords)\",\n  },\n  {\n    // Values\n    tag: [\n      tags.typeName,\n      tags.className,\n      tags.number,\n      tags.changed,\n      tags.annotation,\n      tags.modifier,\n      tags.self,\n      tags.namespace,\n    ],\n    color: \"var(--bql-values)\",\n  },\n  {\n    // Strings\n    tag: [tags.processingInstruction, tags.string, tags.inserted],\n    color: \"var(--bql-string)\",\n  },\n  {\n    // Errors\n    tag: [\n      tags.name,\n      tags.deleted,\n      tags.character,\n      tags.propertyName,\n      tags.macroName,\n    ],\n    color: \"var(--bql-errors)\",\n  },\n]);\n", "export default {\n  columns: [\n    \"account\",\n    \"accounts\",\n    \"amount\",\n    \"balance\",\n    \"close\",\n    \"comment\",\n    \"cost_currency\",\n    \"cost_date\",\n    \"cost_label\",\n    \"cost_number\",\n    \"currency\",\n    \"date\",\n    \"day\",\n    \"description\",\n    \"discrepancy\",\n    \"entry\",\n    \"filename\",\n    \"flag\",\n    \"id\",\n    \"lineno\",\n    \"links\",\n    \"location\",\n    \"meta\",\n    \"month\",\n    \"name\",\n    \"narration\",\n    \"number\",\n    \"open\",\n    \"other_accounts\",\n    \"payee\",\n    \"position\",\n    \"posting_flag\",\n    \"price\",\n    \"tags\",\n    \"tolerance\",\n    \"type\",\n    \"weight\",\n    \"year\",\n  ],\n  functions: [\n    \"abs\",\n    \"account_sortkey\",\n    \"any_meta\",\n    \"bool\",\n    \"close_date\",\n    \"commodity\",\n    \"commodity_meta\",\n    \"convert\",\n    \"cost\",\n    \"count\",\n    \"currency\",\n    \"currency_meta\",\n    \"date\",\n    \"date_add\",\n    \"date_bin\",\n    \"date_diff\",\n    \"date_part\",\n    \"date_trunc\",\n    \"day\",\n    \"decimal\",\n    \"empty\",\n    \"entry_meta\",\n    \"filter_currency\",\n    \"findfirst\",\n    \"first\",\n    \"getitem\",\n    \"getprice\",\n    \"grep\",\n    \"grepn\",\n    \"has_account\",\n    \"int\",\n    \"interval\",\n    \"joinstr\",\n    \"last\",\n    \"leaf\",\n    \"length\",\n    \"lower\",\n    \"max\",\n    \"maxwidth\",\n    \"meta\",\n    \"min\",\n    \"month\",\n    \"neg\",\n    \"number\",\n    \"only\",\n    \"open_date\",\n    \"open_meta\",\n    \"parent\",\n    \"parse_date\",\n    \"possign\",\n    \"quarter\",\n    \"repr\",\n    \"root\",\n    \"round\",\n    \"safediv\",\n    \"splitcomp\",\n    \"str\",\n    \"subst\",\n    \"substr\",\n    \"sum\",\n    \"today\",\n    \"units\",\n    \"upper\",\n    \"value\",\n    \"weekday\",\n    \"year\",\n    \"yearmonth\",\n  ],\n  keywords: [\n    \"and\",\n    \"as\",\n    \"asc\",\n    \"balances\",\n    \"by\",\n    \"create\",\n    \"desc\",\n    \"distinct\",\n    \"false\",\n    \"from\",\n    \"group\",\n    \"having\",\n    \"in\",\n    \"insert\",\n    \"into\",\n    \"is\",\n    \"journal\",\n    \"limit\",\n    \"not\",\n    \"or\",\n    \"order\",\n    \"pivot\",\n    \"print\",\n    \"select\",\n    \"table\",\n    \"true\",\n    \"using\",\n    \"where\",\n  ],\n};\n", "import type { CompletionSource } from \"@codemirror/autocomplete\";\n\nimport bql_grammar from \"./bql-grammar.ts\";\n\nconst { columns, functions, keywords } = bql_grammar;\n\nconst columns_functions_keywords = [\n  ...columns,\n  ...functions.map((f) => `${f}(`),\n  ...keywords,\n].map((label) => ({ label }));\n\nconst command_completions = [\n  \"balances\",\n  \"errors\",\n  \"explain\",\n  \"help\",\n  \"lex\",\n  \"parse\",\n  \"print\",\n  \"runcustom\",\n  \"select\",\n  \"tokenize\",\n].map((label) => ({ label }));\n\nexport const bql_completion: CompletionSource = (context) => {\n  const token = context.matchBefore(/\\w+/);\n  if (!token) {\n    return null;\n  }\n  if (token.from === 0) {\n    return { from: token.from, options: command_completions };\n  }\n  return { from: token.from, options: columns_functions_keywords };\n};\n", "import type { StreamParser, StringStream } from \"@codemirror/language\";\n\n// Import the autogenerated (by a script in the 'contrib' directory) lists\nimport bql_grammar from \"./bql-grammar.ts\";\n\nconst keywords = new Set(bql_grammar.keywords);\nconst columns = new Set(bql_grammar.columns);\nconst functions = new Set(bql_grammar.functions);\n\n// This should match the grammar defined in Beancount (`query/query_parser.py`).\nconst string = /^(\"[^\"]*\"|'[^']*')/;\nconst date = /^(?:#(?:\"[^\"]*\"|'[^']*')|\\d\\d\\d\\d-\\d\\d-\\d\\d)/;\nconst decimal = /^[-+]?([0-9]+\\.[0-9]*|[0-9]*\\.[0-9]+)/;\nconst integer = /^[-+]?[0-9]+/;\n\n// Check for matches - convert the response of StringStream.match into a boolean explicitly\nconst m = (s: StringStream, p: RegExp) => {\n  const match = s.match(p);\n  return match != null && match !== false;\n};\n\nexport const bql_stream_parser: StreamParser<unknown> = {\n  token(stream) {\n    if (stream.eatSpace() || stream.eol()) {\n      return null;\n    }\n    if (m(stream, string)) {\n      return \"string\";\n    }\n    if (m(stream, date) || m(stream, decimal) || m(stream, integer)) {\n      return \"number\";\n    }\n    if (m(stream, /\\w+/)) {\n      const word = stream.current().toLowerCase();\n      if (keywords.has(word)) {\n        return \"keyword\";\n      }\n      if (columns.has(word)) {\n        return \"typeName\";\n      }\n      if (functions.has(word) && stream.peek() === \"(\") {\n        return \"macroName\";\n      }\n      return \"name\";\n    }\n    // Skip one character since no known token matched.\n    const char = stream.next();\n    if (char === \"*\") {\n      return \"typeName\";\n    }\n    return null;\n  },\n};\n", "import { LanguageSupport, StreamLanguage } from \"@codemirror/language\";\n\nimport { bql_completion } from \"./bql-autocomplete.ts\";\nimport { bql_stream_parser } from \"./bql-stream-parser.ts\";\n\nconst bql_language = StreamLanguage.define(bql_stream_parser);\n\nexport const bql_language_support = new LanguageSupport(\n  bql_language,\n  bql_language.data.of({\n    autocomplete: bql_completion,\n  }),\n);\n", "import { syntaxHighlighting } from \"@codemirror/language\";\nimport { EditorState } from \"@codemirror/state\";\nimport { EditorView, keymap, placeholder } from \"@codemirror/view\";\n\nimport { base_extensions } from \"./base-extensions.ts\";\nimport { bql_highlight } from \"./bql-highlight.ts\";\nimport { bql_language_support } from \"./bql-language.ts\";\n\nexport { replace_contents } from \"./editor-transactions.ts\";\n\n/**\n * A basic readonly editor for an asynchronously loaded document.\n *\n * This doesn't use any of the BQL syntax but is provided in this file\n * to avoid more smaller chunks.\n */\nexport function init_document_preview_editor(): EditorView {\n  return new EditorView({\n    extensions: [\n      base_extensions,\n      EditorState.readOnly.of(true),\n      placeholder(\"Loading...\"),\n    ],\n  });\n}\n\n/**\n * A basic readonly BQL editor that only does syntax highlighting.\n */\nexport function init_readonly_query_editor(value: string): EditorView {\n  return new EditorView({\n    doc: value,\n    extensions: [\n      bql_language_support,\n      syntaxHighlighting(bql_highlight),\n      EditorState.readOnly.of(true),\n    ],\n  });\n}\n\n/**\n * The main BQL editor.\n */\nexport function init_query_editor(\n  value: string,\n  onDocChanges: (s: EditorState) => void,\n  placeholder_value: string,\n  get_submit: () => () => void,\n): EditorView {\n  return new EditorView({\n    doc: value,\n    extensions: [\n      bql_language_support,\n      EditorView.updateListener.of((update) => {\n        if (update.docChanged) {\n          onDocChanges(update.state);\n        }\n      }),\n      keymap.of([\n        {\n          key: \"Control-Enter\",\n          mac: \"Meta-Enter\",\n          run: () => {\n            const submit = get_submit();\n            submit();\n            return true;\n          },\n        },\n      ]),\n      placeholder(placeholder_value),\n      base_extensions,\n      syntaxHighlighting(bql_highlight),\n    ],\n  });\n}\n"],
  "mappings": "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",
  "names": ["keywords", "columns", "functions"]
}
