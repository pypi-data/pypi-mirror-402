body_bones = {
    0: "left_hip", 1: "right_hip", 2: "spine1", 3: "left_knee", 4: "right_knee",
    5: "spine2", 6: "left_ankle", 7: "right_ankle", 8: "spine3", 9: "left_foot",
    10: "right_foot", 11: "neck", 12: "left_collar", 13: "right_collar", 14: "head",
    15: "left_shoulder", 16: "right_shoulder", 17: "left_elbow", 18: "right_elbow",
    19: "left_wrist", 20: "right_wrist",
}

left_hand_bones = {i: n for i, n in enumerate([
    'left_index1','left_index2','left_index3','left_middle1','left_middle2','left_middle3',
    'left_pinky1','left_pinky2','left_pinky3','left_ring1','left_ring2','left_ring3',
    'left_thumb1','left_thumb2','left_thumb3'])}

right_hand_bones = {i: n for i, n in enumerate([
    'right_index1','right_index2','right_index3','right_middle1','right_middle2','right_middle3',
    'right_pinky1','right_pinky2','right_pinky3','right_ring1','right_ring2','right_ring3',
    'right_thumb1','right_thumb2','right_thumb3'])}

skeleton = {
    "parents": [
        -1,
        0,
        1,
        2,
        3,
        4,
        1,
        7,
        8,
        9,
        1,
        12,
        13,
        14,
        15,
        16,
        16,
        16,
        14,
        23,
        24,
        25,
        26,
        27,
        28,
        26,
        31,
        32,
        26,
        35,
        36,
        26,
        39,
        40,
        26,
        43,
        44,
        14,
        47,
        48,
        49,
        50,
        51,
        52,
        50,
        55,
        56,
        50,
        59,
        60,
        50,
        63,
        64,
        50,
        67,
        68
    ],
    "bone_names": [
        "root",
		"pelvis",
		"left_hip",
		"left_knee",
		"left_ankle",
		"left_foot",
		"right_hip",
		"right_knee",
		"right_ankle",
		"right_foot",
		"spine1",
		"spine2",
		"spine3",
		"neck",
		"head",
		"jaw",
		"left_eye_smplhf",
		"right_eye_smplhf",
		"left_collar",
		"left_shoulder",
		"left_elbow",
		"left_wrist",
		"left_index1",
		"left_index2",
		"left_index3",
		"left_middle1",
		"left_middle2",
		"left_middle3",
		"left_pinky1",
		"left_pinky2",
		"left_pinky3",
		"left_ring1",
		"left_ring2",
		"left_ring3",
		"left_thumb1",
		"left_thumb2",
		"left_thumb3",
		"right_collar",
		"right_shoulder",
		"right_elbow",
		"right_wrist",
		"right_index1",
		"right_index2",
		"right_index3",
		"right_middle1",
		"right_middle2",
		"right_middle3",
		"right_pinky1",
		"right_pinky2",
		"right_pinky3",
		"right_ring1",
		"right_ring2",
		"right_ring3",
		"right_thumb1",
		"right_thumb2",
		"right_thumb3"
    ]
}

# ---- Utility conversions ----

def rodrigues_to_euler(rodrigues):
    # Original implementation simplified (sign adjustments preserved)
    return [rodrigues[0], -rodrigues[1], -rodrigues[2]]

def to_frame_string(motion_data,axis,negation):
    num_frames = len(next(iter(motion_data.values())))

    bone_names = skeleton["bone_names"]

    s = ""

    for i in range(num_frames):
        for bone in bone_names:
            if bone == "root":
                s += "0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 "
            else:
                if bone in motion_data:
                    rots = motion_data[bone][i]
                    s += ("%.6f %.6f %.6f " % (
                        rots[axis[0]]*negation[0], rots[axis[1]]*negation[1], rots[axis[2]]*negation[2]))
                else:
                    s += "0.000000 0.000000 0.000000 "
        s += "\n"

    #s = "0.000000 0.000000 0.000000 0.000003 0.000000 -0.000000 0.003123 -0.012037 -0.351407 0.000000 0.000000 -0.000000 0.058189 0.026001 -0.092763 0.000000 0.000000 -0.000000 0.054695 0.009396 -0.378753 0.000000 0.000000 -0.000000 -0.043453 0.031876 -0.403060 0.000000 0.000000 -0.000000 0.047257 -0.118216 -0.057997 0.000000 0.000000 -0.000000 0.000000 0.000000 -0.000000 -0.063267 0.021250 -0.103908 -0.000000 0.000000 -0.000000 -0.044210 0.016824 -0.362380 -0.000000 0.000000 -0.000000 0.015417 0.020192 -0.410728 -0.000000 0.000000 -0.000000 -0.038812 -0.119049 -0.058328 -0.000000 0.000000 -0.000000 -0.000000 0.000000 -0.000000 -0.002763 0.027618 0.109891 -0.000000 0.000000 -0.000000 0.009448 0.005940 0.131853 -0.000000 0.000000 -0.000000 -0.011330 -0.028447 0.052235 -0.000000 0.000000 -0.000000 -0.012164 0.031615 0.165167 -0.000000 0.000000 -0.000000 0.024783 -0.020737 0.160452 -0.000000 0.000000 -0.000000 -0.015765 0.005639 -0.000520 -0.000000 0.000000 -0.000000 -0.000000 0.000000 -0.000000 0.020502 -0.066147 0.042642 -0.000000 0.000000 -0.000000 -0.000000 0.000000 -0.000000 -0.042697 -0.066147 0.042642 -0.000000 0.000000 -0.000000 -0.000000 0.000000 -0.000000 0.046364 0.007220 0.084944 -0.000000 0.000000 -0.000000 0.119239 0.015461 0.057728 -0.000000 0.000000 -0.000000 0.254123 0.042459 -0.072151 -0.000000 0.000000 -0.000000 0.251987 0.002472 0.023221 -0.000000 0.000000 -0.000000 0.101902 -0.019351 -0.008688 6.245529 23.947005 1.170564 0.031949 -0.003010 0.002218 9.604687 42.908860 -7.758025 0.022545 -0.000055 -0.002350 -5.085846 11.020444 -4.737671 0.000000 -0.000001 0.000000 0.109398 0.003981 -0.006328 -8.336589 30.054410 5.234333 0.030611 0.004023 0.000807 -11.290344 39.902272 7.419027 0.023515 0.004114 -0.002009 -0.203492 19.384190 -5.306826 -0.000001 0.000000 -0.000000 0.084047 0.043750 -0.014539 -26.175368 37.120883 -2.916366 0.015471 0.011999 -0.001132 -12.407916 29.224102 -0.633242 0.015534 0.011217 -0.001665 -21.087815 5.081989 -2.552766 -0.000001 0.000000 -0.000003 0.097444 0.027345 -0.009268 -7.559700 36.632804 -2.594672 0.028047 0.005266 0.001485 -18.877272 36.092837 2.741780 0.022822 0.007094 -0.001458 -9.078317 21.914667 -5.916440 -0.000001 -0.000000 0.000001 0.040636 -0.025611 -0.017977 47.936279 10.940110 12.031552 0.017015 -0.024978 0.000976 -28.626424 -3.277633 0.717958 0.020523 -0.015523 -0.005160 31.124677 15.824344 -1.716841 -0.000003 0.000000 -0.000001 -0.047695 0.013400 0.084339 -0.000000 0.000000 -0.000000 -0.102578 0.012669 0.053524 -0.000000 0.000000 -0.000000 -0.271150 0.026467 -0.036492 -0.000000 0.000000 -0.000000 -0.249268 0.015325 -0.004533 -0.000000 0.000000 -0.000000 -0.099881 -0.019600 -0.011783 6.245529 -23.947005 -1.170564 -0.031948 -0.003011 0.002218 9.604687 -42.908860 7.758024 -0.022545 -0.000055 -0.002349 -5.085845 -11.020444 4.737670 0.000000 0.000001 -0.000000 -0.107376 0.003734 -0.009422 -8.336589 -30.054410 -5.234333 -0.030611 0.004023 0.000808 -11.290344 -39.902272 -7.419027 -0.023515 0.004114 -0.002009 -0.203492 -19.384190 5.306826 -0.000001 0.000000 0.000000 -0.082027 0.043503 -0.017634 -26.175368 -37.120883 2.916366 -0.015471 0.011999 -0.001132 -12.407916 -29.224102 0.633242 -0.015533 0.011216 -0.001665 -21.087815 -5.081989 2.552766 -0.000001 -0.000000 0.000003 -0.095423 0.027099 -0.012362 -7.559700 -36.632804 2.594672 -0.028046 0.005266 0.001485 -18.877275 -36.092837 -2.741781 -0.022822 0.007093 -0.001459 -9.078318 -21.914670 5.916441 -0.000000 0.000000 -0.000000 -0.038613 -0.025861 -0.021074 47.936279 -10.940110 -12.031552 -0.017015 -0.024978 0.000976 -28.626424 3.277633 -0.717958 -0.020526 -0.015522 -0.005157 31.124677 -15.824344 1.716841 -0.000003 0.000000 0.000001 \n"

    return s
