edition = "2023";

package agentbench;
option go_package = "github.com/thudm/agentrl/controller/internal/pb/controller_v1;controller_v1";

import "google/protobuf/timestamp.proto";
import "common.proto";

message ReceiveHeartbeatRequest {
  string id = 1; // unique id generated by the worker
  string name = 2; // task name
  uint32 concurrency = 3;
  repeated agentrl.TaskIndex indices = 4;
}

message SessionCancelNotice {
  int64 session_id = 1;
}

message WorkerStreamEnvelope {
  string id = 1;
  MessageType type = 2;
  google.protobuf.Timestamp timestamp = 3;

  oneof body {
    // field numbering:
    // - the first digit is the message direction: 1 for receive; 2 for send
    // - the second digit is the message type as specified in the MessageType enum
    ReceiveHeartbeatRequest receive_heartbeat_request = 101;
    SessionCancelNotice session_cancel_notice = 111;
    WorkerRequest worker_request = 211;
    WorkerResponse worker_response = 121;
  }

  enum MessageType {
    HEARTBEAT = 0;
    REQUEST = 1;
    RESPONSE = 2;
  }

  message WorkerRequest {
    string method = 1;
    string endpoint = 2;
    bytes json = 3;
  }

  message WorkerResponse {
    int32 code = 1;
    string message = 2;
    bytes json = 3;
  }
}

service Controller {
  rpc WorkerStream(stream WorkerStreamEnvelope) returns (stream WorkerStreamEnvelope);
}
