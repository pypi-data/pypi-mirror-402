{#
  Template for GitLab/GitHub reviews (with collapsible sections).

  SECURITY NOTE: Do NOT add `| e` (HTML escape) filter to variables.
  - The `| e` filter converts quotes to HTML entities (e.g., ' ‚Üí &#39;)
  - This breaks markdown readability without providing security benefit
  - GitLab/GitHub sanitize HTML before rendering markdown
  - autoescape=False is set intentionally in templates.py
  - See: src/ai_code_review/utils/templates.py for full security rationale
#}
## AI Code Review

{% if include_summary and review.summary %}
### üìã MR Summary
{{ review.summary }}

{% if review.key_changes %}
- **Key Changes:**
{% for change in review.key_changes %}
  - {{ change }}
{% endfor %}
{% else %}
- **Key Changes:** See detailed review below
{% endif %}
- **Impact:** {{ review.modules_affected | join(", ") if review.modules_affected else "Multiple components" }}
- **Risk Level:** {{ review.risk_level | risk_emoji }} {{ review.risk_level | title }}{% if review.risk_justification %} - {{ review.risk_justification }}{% endif %}

{% endif %}
### Detailed Code Review

{{ review.general_feedback }}

{% if review.file_reviews %}
#### üìÇ File Reviews
{% for file_review in review.file_reviews %}

<details>
<summary><strong>üìÑ `{{ file_review.file_path }}`</strong> - {{ file_review.summary }}</summary>

{% for comment in file_review.comments %}
- **{{ comment.severity | title }}** [{{ comment.issue_type | title }}]: {{ comment.description }}
{% if comment.suggestion %}
  - *Suggestion:* {{ comment.suggestion }}
{% endif %}
{% if comment.code_example %}

````
{{ comment.code_example }}
````
{% endif %}
{% if not loop.last %}

{% endif %}
{% endfor %}

{% if file_review.questions %}
**Questions:**
{% for question in file_review.questions %}
- ‚ùì {{ question }}
{% endfor %}
{% endif %}

</details>
{% endfor %}
{% endif %}

### ‚úÖ Summary

- **Overall Assessment:** {{ review.overall_assessment }}
{% if review.priority_issues %}
- **Priority Issues:**
{% for issue in review.priority_issues %}
  - {{ issue }}
{% endfor %}
{% endif %}
{% if review.minor_suggestions %}
- **Minor Suggestions:**
{% for suggestion in review.minor_suggestions %}
  - {{ suggestion }}
{% endfor %}
{% endif %}

---
ü§ñ **AI Code Review** | Generated with [ai-code-review]({{ project_url }}) | **Model:** `{{ ai_model }}`

‚ö†Ô∏è *AI-generated suggestions may be incorrect. Verify before applying. Not a replacement for human review.*
{% if dry_run %}
**Mode:** DRY RUN - No actual changes were analyzed
{% endif %}
