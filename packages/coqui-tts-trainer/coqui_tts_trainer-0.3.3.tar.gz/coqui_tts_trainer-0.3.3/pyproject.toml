#
#                   ,*++++++*,                ,*++++++*,
#                *++.        .+++          *++.        .++*
#              *+*     ,++++*   *+*      *+*   ,++++,     *+*
#             ,+,   .++++++++++* ,++,,,,*+, ,++++++++++.   *+,
#             *+.  .++++++++++++..++    *+.,++++++++++++.  .+*
#             .+*   ++++++++++++.*+,    .+*.++++++++++++   *+,
#              .++   *++++++++* ++,      .++.*++++++++*   ++,
#               ,+++*.    . .*++,          ,++*.      .*+++*
#              *+,   .,*++**.                  .**++**.   ,+*
#             .+*                                          *+,
#             *+.                   Coqui                  .+*
#             *+*              +++ Trainer +++             *+*
#             .+++*.            .          .             *+++.
#              ,+* *+++*...                       ...*+++* *+,
#               .++.    .""""+++++++****+++++++"""".     ++.
#                 ,++.              ****              .++,
#                   .++*                            *++.
#                       *+++,                  ,+++*
#                           .,*++++::::::++++*,.
#

[build-system]
requires = ["hatchling"]
build-backend = "hatchling.build"

[project]
name = "coqui-tts-trainer"
version = "0.3.3"
description = "General purpose model trainer for PyTorch that is more flexible than it should be, by ðŸ¸Coqui."
readme = "README.md"
requires-python = ">=3.10, <3.15"
license = {text = "Apache-2.0"}
authors = [
    {name = "Eren GÃ¶lge", email = "egolge@coqui.ai"}
]
maintainers = [
    {name = "Enno Hermann", email = "enno.hermann@gmail.com"}
]
classifiers = [
    "Environment :: Console",
    "Natural Language :: English",
    "Development Status :: 4 - Beta",
    "Intended Audience :: Developers",
    "Intended Audience :: Science/Research",
    "License :: OSI Approved :: Apache Software License",
    "Operating System :: OS Independent",
    "Programming Language :: Python",
    "Programming Language :: Python :: 3",
    "Programming Language :: Python :: 3.10",
    "Programming Language :: Python :: 3.11",
    "Programming Language :: Python :: 3.12",
    "Programming Language :: Python :: 3.13",
    "Programming Language :: Python :: 3.14",
    "Topic :: Software Development",
    "Topic :: Software Development :: Libraries :: Python Modules",
    "Topic :: Scientific/Engineering :: Artificial Intelligence",
]
dependencies = [
    "coqpit-config>=0.2.2,<0.3.0",
    "fsspec>=2023.6.0",
    "packaging>=21.0",
    "psutil>=5",
    "tensorboard>=2.17.1",
]

[project.optional-dependencies]
cpu = [
    "torch>=2.2",
]
cuda = [
    "torch>=2.2",
]
aim = ["aim>=3.21; python_version < '3.13'"]
clearml = ["clearml>=2", "soundfile>=0.12.0"]
mlflow = ["mlflow>=3.7", "soundfile>=0.12.0"]
wandb = ["wandb>=0.19"]

[dependency-groups]
dev = [
    "coverage>=7",
    "pre-commit>=3",
    "pytest>=8",
    "ruff==0.14.7",
]
test = [
    "accelerate>=1.0.0",
    "matplotlib>=3.10.5",
    "numpy>=1.25.2",
    "torchvision>=0.17.0",
]
mypy = [
    "mypy==1.19.1",
    "types-psutil>=7.0.0.20250218",
]

[tool.uv]
default-groups = ["dev"]
required-environments = [
    "sys_platform == 'linux' and platform_machine == 'x86_64'"
]
conflicts = [
  [
    { extra = "cpu" },
    { extra = "cuda" },
  ],
]

[tool.uv.sources]
torch = [
  { index = "pytorch-cpu", extra = "cpu" },
  { index = "pytorch-cuda", extra = "cuda" },
]
torchvision = [
  { index = "pytorch-cpu" },
]

[[tool.uv.index]]
name = "pytorch-cpu"
url = "https://download.pytorch.org/whl/cpu"
explicit = true

[[tool.uv.index]]
name = "pytorch-cuda"
url = "https://download.pytorch.org/whl/cu128"
explicit = true

[project.urls]
Homepage = "https://github.com/idiap/coqui-ai-Trainer"
Repository = "https://github.com/idiap/coqui-ai-Trainer"
Issues = "https://github.com/idiap/coqui-ai-Trainer/issues"

[tool.hatch.build]
exclude = [
    "/.github",
    "/.gitignore",
    "/.pre-commit-config.yaml",
    "/CODE_OF_CONDUCT.md",
    "/CONTRIBUTING.md",
    "/Makefile",
    "/tests",
    "/trainer/TODO.txt",
]

[tool.hatch.build.targets.wheel]
packages = ["trainer"]

[tool.ruff]
line-length = 120
lint.extend-select = [
    "ANN204", # type hints
    "B",      # bugbear
    "D2",     # docs
    "D412",
    "D415",
    "EM",     # error messages
    "FBT",    # boolean arguments
    "FLY",
    "I",      # import sorting
    "PIE",
    "PL",     # pylint
    "RET",    # return statements
    "RUF",    # ruff-specific
    "UP",     # pyupgrade
    "SIM",    # simplify
]

lint.ignore = [
    "F821",  # TODO: enable
    "PLW2901",  # TODO: enable
    "PLR09",
]

[tool.ruff.lint.per-file-ignores]
"**/__init__.py" = [
    "F401",  # init files may have "unused" imports for now
    "F403",  # init files may have star imports for now
]
"tests/**" = [
    "PLR2004",  # magic values are ok in tests
]

[tool.ruff.lint.pydocstyle]
convention = "google"

[tool.coverage.report]
show_missing = true
skip_covered = true
skip_empty = true

[tool.coverage.run]
source = ["trainer", "tests"]
command_line = "-m pytest"

[tool.mypy]
warn_unused_configs = true
disallow_subclassing_any = true
disallow_untyped_decorators = true
warn_redundant_casts = true
warn_unused_ignores = true
strict_equality = true
extra_checks = true

[[tool.mypy.overrides]]
module = [
    "accelerate",
    "aim",
    "aim.sdk.run",
    "clearml",
    "fsspec",
    "plotly",
    "soundfile",
]
ignore_missing_imports = true
