[build-system]
requires = ["setuptools>=77.0"]
build-backend = "setuptools.build_meta"

[project]
name = "structural-lib-is456"
version = "0.18.0"
description = "IS 456 RC Beam Design Library (flexure, shear, ductile detailing, DXF export for RC beams)"
readme = "README.md"
requires-python = ">=3.11"
license = "MIT"
license-files = ["LICENSE"]
authors = [
  { name = "Pravin Surawase" }
]
classifiers = [
  "Development Status :: 3 - Alpha",
  "Intended Audience :: Developers",
  "Topic :: Scientific/Engineering",
  "Programming Language :: Python :: 3",
  "Programming Language :: Python :: 3.11",
  "Programming Language :: Python :: 3.12",
  "Programming Language :: Python :: 3.13",
]

dependencies = [
  "pydantic>=2.0",  # Canonical data model validation (TASK-DATA-001)
]

[project.urls]
Homepage = "https://github.com/Pravin-surawase/structural_engineering_lib"
Repository = "https://github.com/Pravin-surawase/structural_engineering_lib"
Documentation = "https://github.com/Pravin-surawase/structural_engineering_lib/tree/main/docs"
Changelog = "https://github.com/Pravin-surawase/structural_engineering_lib/blob/main/CHANGELOG.md"
Issues = "https://github.com/Pravin-surawase/structural_engineering_lib/issues"

[project.optional-dependencies]
dev = [
  "pytest",
  "pytest-cov",
  "pytest-benchmark",
  "black",
  "mypy",
  "pre-commit",
  "ruff",
  "bandit",
  "isort",
  "hypothesis>=6.0",
]
dxf = ["ezdxf>=1.0"]  # For DXF drawing generation
render = ["ezdxf>=1.0", "matplotlib>=3.5"]  # DXF render to PNG/PDF
report = ["jinja2>=3.1"]  # Optional HTML templating for reports
pdf = ["reportlab>=4.0"]  # PDF report generation (Streamlit app)
validation = ["jsonschema>=4.21"]  # Optional input/output schema validation

[tool.ruff]
target-version = "py311"
line-length = 88

[tool.ruff.lint]
# Expanded rule set for better code quality (TASK-189)
select = [
  "F",   # Pyflakes (errors)
  "E",   # pycodestyle errors
  "W",   # pycodestyle warnings
  "I",   # isort (import sorting)
  "N",   # pep8-naming
  "UP",  # pyupgrade (Python version-specific improvements)
  "B",   # flake8-bugbear (common bugs and design problems)
  "C4",  # flake8-comprehensions (better list/dict/set comprehensions)
  "PIE", # flake8-pie (misc lints including unnecessary code)
]

# Ignore specific rules that conflict with project style
ignore = [
  "E501",  # Line too long (handled by black)
  "B008",  # Do not perform function call in argument defaults (common in our API)
]

[tool.ruff.lint.pep8-naming]
# Allow structural engineering conventions (D = total depth, D_mm = depth in mm)
# Standard notation per IS 456:2000 and structural design practice
ignore-names = [
  "D", "D_mm", "D_m", "D_val", "D_scaled",  # Depth parameters (total depth)
  "Df", "Df_shallow", "Df_deep", "Df_mm",  # Flange depth variants
  "Mu", "Mu_lim", "Mu_knm",  # Moment parameters (factored moment)
  "Vu", "Vu_kn",  # Shear force (factored shear)
  "Ast", "Ast_prov",  # Steel area (tension reinforcement)
  "Asv",  # Stirrup area (shear reinforcement)
  "Ld",  # Development length
  "C", "T",  # Compression/Tension forces (physics notation)
  "baseline_D", "label_D",  # Variables containing depth values
  "require_d_less_than_D",  # Boolean flag (d < D check)
  "DEPTH_THRESHOLD", "PERCENTAGE_WEB_AREA", "MAX_SPACING",  # Local constants in functions
]

# classmethod decorators use cls
classmethod-decorators = ["classmethod"]

[tool.ruff.lint.per-file-ignores]
# Excel bridge uses intentional naming for UDF compatibility
"structural_lib/excel_bridge.py" = ["N802"]
# Compliance and dxf_export have optional imports after conditionals
"structural_lib/compliance.py" = ["E402"]
"structural_lib/dxf_export.py" = ["E402"]
"structural_lib/excel_integration.py" = ["E402"]
# Test files with intentional naming patterns (updated for new test structure)
"tests/integration/test_costing.py" = ["N802"]  # setUp method from unittest.TestCase
"tests/unit/test_validation.py" = ["N802"]  # test_*_D pattern tests parameter D
"tests/integration/test_tables_and_materials_additional.py" = ["N802"]  # test_*_D pattern
"tests/unit/test_error_schema.py" = ["B017"]  # pytest.raises(Exception) is intentional for frozen dataclass test
"tests/unit/test_serviceability.py" = ["E402"]  # Import after section header comment

[tool.mypy]
python_version = "3.11"
files = ["structural_lib"]
explicit_package_bases = true
ignore_missing_imports = true
warn_unused_ignores = true
# Sprint 1 (v0.14): Enable stricter type checking
warn_return_any = true
strict_optional = true
warn_redundant_casts = true
# Sprint 2 (v0.15): Enable stricter type checking
no_implicit_optional = true
check_untyped_defs = true
disallow_untyped_defs = true
disallow_incomplete_defs = false
show_error_codes = true

# Pydantic v2 has known mypy compatibility issues
# See: https://github.com/pydantic/pydantic/issues/6713
[[tool.mypy.overrides]]
module = "structural_lib.models"
disable_error_code = ["prop-decorator", "call-arg", "arg-type", "no-any-return"]

[[tool.mypy.overrides]]
module = "structural_lib.serialization"
disable_error_code = ["arg-type", "no-any-return"]

[[tool.mypy.overrides]]
module = "structural_lib.etabs_import"
disable_error_code = ["no-any-return"]

[tool.bandit]
skips = ["B101"]  # Skip assert_used (common in tests)
exclude_dirs = ["tests", "examples"]

[tool.isort]
profile = "black"
line_length = 88
skip_gitignore = true
