"use strict";(self.webpackChunk_naavre_workflow_jupyterlab=self.webpackChunk_naavre_workflow_jupyterlab||[]).push([[545],{8247:(e,t,n)=>{n.r(t),n.d(t,{IWorkflowTracker:()=>rn,default:()=>ln});var r=n(489),a=n(14),l=n(3083),i=n(7262),o=n(8490),s=n(2570),c=n(8581),d=n(4019),u=n(4602),p=n(1079),h=n.n(p),m=n(3345),f=n.n(m),g=n(2515),y=n(8856),w=n(1918),v=n(6469),k=n(2830);async function x(e="",t={}){const n=k.ServerConnection.makeSettings(),r=v.URLExt.join(n.baseUrl,e);let a;try{a=await k.ServerConnection.makeRequest(r,t,n)}catch(e){throw new k.ServerConnection.NetworkError(e)}let l=await a.text();if(l.length>0)try{l=JSON.parse(l)}catch(e){console.log("Not a JSON response body.",a)}if(!a.ok)throw new k.ServerConnection.ResponseError(a,l.message||l);return l}async function E(e,t,n={},r={}){const a="naavre-communicator/external-service",l={method:"POST",body:JSON.stringify({query:{method:e,url:t,headers:n,data:r}})};console.debug("request",a,l);const i=await x(a,l);console.debug("resp",i);try{console.debug("resp.content",JSON.parse(i.content))}catch(e){}return i}var b=n(4943),C=n.n(b);const S={offset:{x:0,y:0},scale:1,nodes:{},links:{},selected:{},hovered:{}};function _(e){return(new(C())).hex(e)}function A(e){const{fromNodeId:t,toNodeId:n}=e;return t!==n}const O=(0,n(710).A)({palette:{secondary:{main:"#ea5b2d",dark:"#b12800",light:"#ff8c5a"},primary:{main:"#0f4e8a",dark:"#00275c",light:"#4e79ba"}}}),I=(0,m.createContext)({});var R=n(2826),L=n.n(R),$=n(2691),T=n(5831),U=n(1228),N=n(5603),M=n(7763),P=n(2819);function F({label:e,variant:t}){const[n,r]=(0,m.useState)(!1),a=(0,m.useRef)(null);return(0,m.useEffect)((()=>{a.current&&r(a.current.scrollWidth>a.current.clientWidth)}),[]),f().createElement(M.A,{title:e,disableHoverListener:!n,placement:"bottom",arrow:!0},f().createElement(P.A,{variant:t,ref:a,sx:{overflow:"hidden",whiteSpace:"nowrap",textOverflow:"ellipsis"}},e))}const G=L().div`
  position: absolute;
  background: white;
  width: ${e=>e.width||"250px"};
  height: ${e=>e.height||"150px"};
  min-height: 60px;
  border-bottom-left-radius: 5px;
  border-bottom-right-radius: 5px;
  border: ${e=>e.isDraft?"1px dashed darkgray":"1px solid lightgray"};
  border-top-width: 0;
  box-shadow: rgba(0, 0, 0, 0.1) 0 7px 10px 0;
`;function D({cell:e,isSpecialNode:t,backgroundColor:n}){const r=new RegExp(`-${e.owner}$`),a=e.title.replace(r,"");return f().createElement("div",{style:{position:"absolute",bottom:"100%",left:"-1px",width:"100%",borderTopLeftRadius:"5px",borderTopRightRadius:"5px",border:e.is_draft?"1px dashed darkgray":"1px solid lightgray",borderBottomWidth:0,backgroundColor:n,display:"flex",justifyContent:"space-between"}},f().createElement(U.A,{direction:"row",spacing:1,sx:{padding:"10px",width:"calc(100% - 60px + 8px)",alignItems:"center",cursor:"grab","&:active":{cursor:"grabbing"}}},f().createElement(F,{variant:"subtitle2",label:a}),e.is_draft&&f().createElement(N.Typography,{variant:"body2",sx:{fontStyle:"italic"}},"draft"),t||f().createElement(N.Typography,{variant:"body2"},"v",e.version)),f().createElement($.A,{"aria-label":"Info",style:{borderRadius:"100%"},sx:{width:"40px",marginLeft:"-8px"}},f().createElement(T.A,null)))}function H(e){return 26*Math.max(Object.values(e.ports).filter((e=>"left"===e.type)).length,Object.values(e.ports).filter((e=>"right"===e.type)).length)+"px"}const V=f().forwardRef((({node:e,children:t,...n},r)=>function({node:e,children:t,...n},r){const a="workflow-cell"!==e.type;H(e);const l=a?"200px":"250px",i=H(e);return f().createElement(G,{width:l,height:i,isDraft:e.properties.cell.is_draft,ref:r,...n},f().createElement(D,{cell:e.properties.cell,isSpecialNode:a,backgroundColor:a?"rgb(195, 235, 202)":e.properties.cell.is_draft?"rgb(240,240,240)":"rgb(229,252,233)"}),t)}({node:e,children:t,...n},r)));var W=n(8593),j=n(2313);function z({nodeType:e,sx:t}){switch(e){case"splitter":return m.createElement(j.A,{sx:{transform:"rotate(90deg)",...t}});case"merger":return m.createElement(W.A,{sx:{transform:"rotate(90deg)",...t}});default:return m.createElement(m.Fragment,null)}}function B({node:e}){return m.createElement("div",{style:{width:"190px",padding:"5px",display:"flex",justifyContent:"center"}},m.createElement(z,{nodeType:e.type,sx:{fontSize:"50px"}}))}function Z({children:e}){return f().createElement("div",{style:{width:"20px",height:"20px",cursor:"pointer",display:"flex",justifyContent:"center",alignItems:"center"}},e)}function J({color:e}){return f().createElement("div",{style:{width:"20px",height:"20px",background:e,borderRadius:"50%",cursor:"pointer"}})}function Y({children:e}){return f().createElement("div",{style:{display:"inline-block",maxWidth:"100px",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",marginLeft:"5px",marginRight:"5px",fontSize:"13px"}},e)}const q=e=>{const t="workflow-cell"!==e.port.properties.parentNodeType,n="left"===e.port.type?{left:0}:{right:0};return f().createElement(Z,null,f().createElement(M.A,{title:e.port.id,placement:"bottom",arrow:!0},f().createElement("div",{style:{position:"absolute",display:"flex",...n}},t?f().createElement(J,{color:"#3C8F49"}):f().createElement(f().Fragment,null,"right"===e.port.type&&f().createElement(Y,null,e.port.id),f().createElement(J,{color:e.port.properties.color}),"left"===e.port.type&&f().createElement(Y,null,e.port.id)))))},K=e=>{const{className:t,link:n,config:r,isHovered:a,isSelected:l,startPos:i,endPos:o,fromPort:s,onLinkMouseEnter:c,onLinkMouseLeave:d,onLinkClick:u}=e,p=((e,t)=>{const{width:n,height:r,topToBottom:a,leftToRight:l,isHorizontal:i}=(0,w.getDirectional)(e,t),o=e,s=t,c=o.x+(l?1:-1)*n/2,d=o.y+(a?1:-1)*r/2,u=(l?1:-1)*(i?n/5:r/5);return`\n    M${o.x},${o.y}\n    C ${o.x+u},${o.y+0} ${c},${d} ${c},${d}\n    C ${c},${d} ${s.x-u},${s.y-0} ${s.x},${s.y}\n    `})(i,o),h=s.properties&&s.properties.linkColor||"cornflowerblue";return m.createElement("svg",{style:{overflow:"visible",position:"absolute",cursor:"pointer",left:0,right:0},className:t},m.createElement("defs",null,m.createElement("marker",{id:`arrowHead-${h}`,orient:"auto-start-reverse",markerWidth:"2",markerHeight:"4",refX:"0.1",refY:"2"},m.createElement("path",{d:"M0,0 V4 L2,2 Z",fill:h}))),m.createElement("path",{d:p,stroke:h,strokeWidth:"3",fill:"none",markerMid:`url(#arrowHead-${h})`}),m.createElement("path",{d:p,stroke:h,strokeWidth:"20",fill:"none",strokeLinecap:"round",strokeOpacity:a||l?.1:0,onMouseEnter:()=>c({config:r,linkId:n.id}),onMouseLeave:()=>d({config:r,linkId:n.id}),onClick:e=>{u({config:r,linkId:n.id}),e.stopPropagation()}}))};var X=n(2369),Q=n(951),ee=n(9579),te=n(4939),ne=n(6247),re=n(3603),ae=n(2823),le=n(4327),ie=n(4554);function oe({title:e,rows:t}){return f().createElement(f().Fragment,null,e&&f().createElement(P.A,{component:"h4",sx:{marginTop:"16px",marginBottom:"16px"}},e),f().createElement(le.A,{component:Q.A},f().createElement(ne.A,null,f().createElement(re.A,null,t.map((e=>f().createElement(se,{cells:e})))))))}function se({cells:e}){return f().createElement(ie.A,null,e.map((e=>f().createElement(ae.A,null,e))))}function ce({name:e,color:t}){return f().createElement("div",{style:{width:"20px",height:"20px",background:t||_(e),borderRadius:"50%"}})}function de({cell:e}){var t,n;const r="Splitter"===e.title||"Merger"===e.title,a=[{title:void 0,rows:[["Description",e.description],["Owner",e.owner],["Version",r?null:e.version?`${e.version} ${e.next_version?"":"(latest)"}`:"N/A"],["Shared",r?null:(e.shared_with_scopes||[]).length>0||(e.shared_with_users||[]).length>0?"Yes":"No"],["Draft",e.is_draft?"Yes":"No"]]},{title:"Inputs",rows:e.inputs.map((e=>[f().createElement(ce,{name:e.name,color:r?"#3C8F49":void 0}),e.name,e.type]))},{title:"Outputs",rows:e.outputs.map((e=>[f().createElement(ce,{name:e.name,color:r?"#3C8F49":void 0}),e.name,e.type]))},{title:"Parameters",rows:e.params.map((e=>e.default_value?[e.name,e.type,e.default_value]:[e.name,e.type,f().createElement("p",{style:{fontStyle:"italic"}},"n/a")]))},{title:"Secrets",rows:e.secrets.map((e=>[e.name,e.type]))},{title:"Technical information",rows:[["Image name",e.container_image],["Base image (build)",null===(t=e.base_container_image)||void 0===t?void 0:t.build],["Base image (runtime)",null===(n=e.base_container_image)||void 0===n?void 0:n.runtime],["Kernel",e.kernel],["Source",e.source_url&&f().createElement(te.A,{href:e.source_url,target:"_blank",rel:"noreferrer"},e.source_url)]]}].map((({title:e,rows:t})=>({title:e,rows:t.filter((e=>void 0!==e.at(-1)&&null!==e.at(-1)&&""!==e.at(-1)))}))).filter((({rows:e})=>e.length>0));return f().createElement(ee.A,{sx:{margin:"15px"}},a.map((({title:e,rows:t})=>f().createElement(oe,{title:e,rows:t}))))}var ue=n(7809);function pe({children:e,onClose:t}){return m.createElement(ee.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"10px",marginTop:"0",textAlign:"center",background:"#3c8f49",color:"white",fontSize:"medium",overflow:"hidden",textOverflow:"ellipsis"}},m.createElement("p",{style:{margin:"0"}},e),m.createElement($.A,{"aria-label":"Close",style:{color:"white",borderRadius:"100%"},onClick:t},m.createElement(ue.A,null)))}function he({link:e,onClose:t}){return m.createElement(pe,{onClose:t},"Link")}function me({node:e,onClose:t}){return m.createElement(m.Fragment,null,m.createElement(pe,{onClose:t},e.properties.cell.title),m.createElement(de,{cell:e.properties.cell}))}function fe({chart:e,setChart:t,callbacks:n,config:r}){if(!e.selected.id)return m.createElement(m.Fragment,null);function a(){t({...e,selected:{}})}return m.createElement(Q.A,{elevation:6,sx:{position:"absolute",top:20,right:20,width:380,maxHeight:"calc(100% - 40px)",overflowX:"clip",overflowY:"scroll"}},"link"===e.selected.type&&m.createElement(he,{link:e.links[e.selected.id],onClose:a}),"node"===e.selected.type&&m.createElement(me,{node:e.nodes[e.selected.id],onClose:a}),m.createElement("div",{style:{margin:"15px"}},m.createElement(X.A,{variant:"contained",onClick:()=>n.onDeleteKey({config:r})},"Delete")))}var ge=n(3837),ye=n(9211),we=n(8183),ve=n(1178),ke=n(6962),xe=n(5002),Ee=n(431),be=n.n(Ee),Ce=n(7375),Se=n.n(Ce),_e=n(4799),Ae=n(8245);function Oe(){const e=(t=[22,23,0,1,2,3,4,5])[Ie(0,t.length-1)];var t;const n=Ie(0,59);return be()().hour(e).minute(n)}function Ie(e,t){return e=Math.ceil(e),t=Math.floor(t),Math.floor(Math.random()*(t-e+1))+e}function Re({periodUnit:e,setPeriodUnit:t}){return f().createElement(N.Stack,{direction:"row",spacing:2,style:{padding:"1rem",alignItems:"center"}},f().createElement(N.InputLabel,{id:"input-label",style:{width:"50%"}},"Run every"),f().createElement(N.Select,{id:"period-interval",labelId:"input-label","aria-describedby":"repetion periodUnit duration",value:e,onChange:e=>{t(e.target.value)},style:{width:"50%"},MenuProps:{sx:{zIndex:3e4}}},f().createElement(N.MenuItem,{value:"hour"},"hour"),f().createElement(N.MenuItem,{value:"day"},"day"),f().createElement(N.MenuItem,{value:"week"},"week"),f().createElement(N.MenuItem,{value:"month"},"month")))}function Le({time:e,setTime:t}){return f().createElement(N.Stack,{direction:"row",spacing:2,style:{padding:"1rem",alignItems:"center"}},f().createElement(N.InputLabel,{id:"day-of-week-label",style:{width:"40%"}},"On"),f().createElement(N.Select,{id:"day-of-week-select",labelId:"day-of-week-label",value:e.day(),onChange:n=>{t(e.day(Number(n.target.value)))},style:{width:"60%"},MenuProps:{sx:{zIndex:3e4}}},f().createElement(N.MenuItem,{value:1},"Monday"),f().createElement(N.MenuItem,{value:2},"Tuesday"),f().createElement(N.MenuItem,{value:3},"Wednesday"),f().createElement(N.MenuItem,{value:4},"Thursday"),f().createElement(N.MenuItem,{value:5},"Friday"),f().createElement(N.MenuItem,{value:6},"Saturday"),f().createElement(N.MenuItem,{value:0},"Sunday")))}function $e({time:e,setTime:t}){return f().createElement(N.Stack,{direction:"row",spacing:2,style:{padding:"1rem",alignItems:"center"}},f().createElement(N.InputLabel,{style:{width:"40%"}},"On day"),f().createElement(N.TextField,{type:"number",id:"time",label:"Day",value:e.date(),onChange:n=>{const r=Number(n.target.value);t(e.date(r))},style:{width:"60%"}}))}function Te({periodUnit:e,time:t,setTime:n}){return f().createElement(f().Fragment,null,"week"===e&&f().createElement(Le,{time:t,setTime:n}),"month"===e&&f().createElement($e,{time:t,setTime:n}),f().createElement(N.Container,null,f().createElement(N.Typography,{variant:"body2"},function(e,t){const n="Your workflow will run ";switch(e){case"hour":return n+`at minute :${t.format("mm")}`;case"day":case"week":case"month":return n+`during quiet hours at ${t.format("HH:mm")}`}}(e,t))))}function Ue({setCron:e}){const[t,n]=(0,m.useState)(null),[r,a]=(0,m.useState)(!1),[l,i]=(0,m.useState)("day"),[o,s]=(0,m.useState)(Oe);(0,m.useEffect)((()=>{e(r?function(e,t){switch(e){case"hour":return`${t.minute()} * * * *`;case"day":return`${t.minute()} ${t.hour()} * * *`;case"week":return`${t.minute()} ${t.hour()} * * ${t.day()}`;case"month":return`${t.minute()} ${t.hour()} ${t.date()} * *`}}(l,o):null)}),[r,e,l,o]);const c=()=>{n(null)},d=Boolean(t),u=d?"simple-popover":void 0;return f().createElement(f().Fragment,null,f().createElement(N.Button,{onClick:e=>{r||i("day"),a(!0),n(e.currentTarget)},size:"small",variant:"text",startIcon:f().createElement(xe.A,{fontSize:"inherit"}),style:{color:ke.A[900],textTransform:"none",minWidth:"10rem"}},r?function(e,t){switch(e){case"hour":return`Every hour at :${t.format("mm")}`;case"day":return`Every day at ${t.format("HH:mm")}`;case"week":return`Every ${t.format("dddd")}`;case"month":return`On the ${t.format("Do")} of each month`}}(l,o):"Make recurring"),f().createElement(N.Popover,{id:u,open:d,anchorEl:t,onClose:c,anchorOrigin:{vertical:"bottom",horizontal:"left"},style:{zIndex:2e4}},f().createElement(_e.LocalizationProvider,{dateAdapter:Ae.R},f().createElement(N.Container,{style:{padding:"1rem",minWidth:"25rem"}},f().createElement(Re,{periodUnit:l,setPeriodUnit:i}),f().createElement(Te,{periodUnit:l,time:o,setTime:s}),f().createElement(N.Stack,{direction:"row",spacing:2,style:{float:"right",margin:"1rem"}},f().createElement(N.Button,{onClick:()=>{a(!1),c()}},"Disable"),f().createElement(N.Button,{onClick:c,variant:"contained"},"Apply"))))))}async function Ne(e,t){const n=await E("GET",`${t.workflowServiceUrl}/status/${t.virtualLab}?workflow_url=${e}`,{},{});if(200===n.status_code)return JSON.parse(n.content);if(404===n.status_code)return null;throw`${n.status_code} ${n.reason}`}be().extend(Se());var Me=n(1763),Pe=n(4721),Fe=n(2931),Ge=n(6761);function De({open:e,onClose:t,chart:n}){return f().createElement(Pe.A,{onClose:t,open:e},f().createElement(Me.A,null,"Run Workflow"),f().createElement(Fe.A,null,f().createElement(He,{onClose:t,chart:n})))}function He({onClose:e,chart:t}){const n=(0,m.useContext)(I),[r,l]=(0,m.useState)({}),[i,o]=(0,m.useState)({}),[s,c]=(0,m.useState)(null),[d,u]=(0,m.useState)(!1),[p,h]=(0,m.useState)(null),y=(e,t)=>{l((n=>({...n,[e]:t})))},w=null!==s;(0,m.useEffect)((()=>{let e=!1;const n={},r={};Object.values(t.nodes).forEach((t=>{!0===t.properties.cell.is_draft&&(e=!0),t.properties.cell.params.forEach((e=>{n[e.name]={value:null,default_value:e.default_value}})),t.properties.cell.secrets.forEach((e=>{r[e.name]={value:null}}))})),u(e),l(Object.fromEntries(Object.entries(n).sort())),o(Object.fromEntries(Object.entries(r).sort()))}),[t.nodes]);return f().createElement(g.A,{theme:O},f().createElement("div",{style:{display:"flex",overflow:"scroll",flexDirection:"column"}},p?f().createElement("div",null,f().createElement("div",{style:{padding:"10px",alignItems:"center",display:"flex",flexDirection:"column"}},f().createElement(ye.A,{fontSize:"large",sx:{color:ve.A[500]}}),w?f().createElement(f().Fragment,null,f().createElement("p",{style:{fontSize:"large"}},"Recurring workflow scheduled!"),f().createElement("p",{style:{fontSize:"medium"}},f().createElement("a",{style:{textDecoration:"underline",color:"var(--jp-content-link-color)"},href:p.run_url,target:"_blank"},"Show in workflow engine"))):f().createElement("p",{style:{fontSize:"large"}},"Workflow submitted!")),f().createElement(U.A,{direction:"row",spacing:2,style:{float:"right",alignItems:"center"}},f().createElement(X.A,{variant:"contained",className:"lw-panel-button",onClick:e,color:"primary",style:{float:"right"}},"Ok"))):d?f().createElement(Ge.A,{severity:"error"},"You cannot run this workflow because it contains draft cells."):f().createElement("div",null,0!==Object.keys(r).length&&f().createElement("div",{style:{textAlign:"right",padding:"10px 15px 10px 15px"}},f().createElement(X.A,{disabled:!1,onClick:async()=>{Object.entries(r).forEach((([e,t])=>{y(e,{value:t.default_value||null,default_value:t.default_value})}))},size:"small",variant:"text",endIcon:f().createElement(ge.A,{fontSize:"inherit"}),style:{color:ke.A[900],textTransform:"none"}},"Use default parameter values")),f().createElement(U.A,{direction:"column",spacing:2,style:{width:"80vw",maxWidth:"100%"}},Object.entries(r).map((([e,t])=>f().createElement(we.A,{key:e,label:e,slotProps:{inputLabel:{shrink:!0}},value:r[e].value,onChange:t=>(async(e,t)=>{y(t,{value:e.target.value,default_value:r[t].default_value})})(t,e)}))),Object.entries(i).map((([e,t])=>f().createElement(we.A,{key:e,label:e,slotProps:{inputLabel:{shrink:!0}},type:"password",autoComplete:"off",value:i[e].value,onChange:t=>(async(e,t)=>{var n,r;n=t,r={value:e.target.value},o((e=>({...e,[n]:r})))})(t,e)})))),f().createElement(U.A,{direction:"row",spacing:2,style:{float:"right",marginTop:"2rem",alignItems:"center"}},f().createElement(Ue,{setCron:c}),f().createElement(X.A,{variant:"contained",className:"lw-panel-button",onClick:()=>(async(e,r)=>{E("POST",`${n.workflowServiceUrl}/submit`,{},{virtual_lab:n.virtualLab,naavrewf2:t,params:e,secrets:r,cron_schedule:s}).then((e=>{if(200!==e.status_code)throw`${e.status_code} ${e.reason}`;const t=JSON.parse(e.content);h(t),w||async function(e,t){const n=e.split("/").at(-1),r=a.Notification.emit(`Starting workflow\n${n}`,"in-progress",{autoClose:!1,actions:[{label:"Show in workflow engine",callback:t=>{t.preventDefault(),window.open(e)}}]});let l;for(;;){await new Promise((e=>setTimeout(e,1e4)));try{l=await Ne(e,t)}catch(e){return void a.Notification.update({id:r,type:"error",message:`Could not get workflow status\n${n}`,autoClose:5e3})}switch(null==l?void 0:l.status.phase){case"Pending":a.Notification.update({id:r,message:`Starting workflow\n${n}`});break;case"Running":a.Notification.update({id:r,message:`Running workflow (${l.status.progress})\n${n}`});break;case"":return void a.Notification.update({id:r,type:"warning",message:`Unknown workflow status\n${n}`,autoClose:5e3});case"Succeeded":return void a.Notification.update({id:r,type:"success",message:`Workflow successful\n${n}`,autoClose:5e3});case"Failed":return void a.Notification.update({id:r,type:"error",message:`Workflow failed\n${n}`,autoClose:5e3});case"Error":return void a.Notification.update({id:r,type:"error",message:`Workflow error\n${n}`,autoClose:5e3})}}}(t.run_url,n)})).catch((e=>{const t=`Error running the workflow: ${e}`;console.log(t),alert(t)}))})(r,i),color:"primary",disabled:!(()=>{let e=!0;return Object.values(r).forEach((t=>{e=e&&null!==t.value})),Object.values(i).forEach((t=>{e=e&&null!==t.value})),e})(),style:{float:"right"}},"Run")))))}var Ve=n(250);const We=[{url:"splitter",title:"Splitter",description:"Split the input list and distribute its items to multiple containers that run in parallel.",type:"splitter",created:void 0,modified:void 0,owner:void 0,virtual_lab:void 0,shared_with_scopes:[],shared_with_users:[],version:1,next_version:null,container_image:"",base_container_image:{build:"",runtime:""},dependencies:[],inputs:[{name:"splitter_source",type:"list"}],outputs:[{name:"splitter_target",type:"list"}],confs:[],params:[],secrets:[],kernel:void 0,source_url:void 0},{url:"merger",title:"Merger",description:"Merge the output of multiple containers back into a single list.",type:"merger",created:void 0,modified:void 0,owner:void 0,virtual_lab:void 0,shared_with_scopes:[],shared_with_users:[],version:1,next_version:null,container_image:"",base_container_image:{build:"",runtime:""},dependencies:[],inputs:[{name:"merger_source",type:"list"}],outputs:[{name:"merger_target",type:"list"}],confs:[],params:[],secrets:[],kernel:void 0,source_url:void 0}];var je=n(7583),ze=n(5402),Be=n(9634),Ze=n(7980),Je=n(1794),Ye=n(988),qe=n(5613),Ke=n(2452),Xe=n(1),Qe=n(3619),et=n(4083),tt=n(2307),nt=n(3293);const rt=(0,m.createContext)([]),at=/^.*sharing-scopes\/([^/]+)\/?$/,lt={community:"Communities",virtual_lab:"Virtual labs"};function it(e,t,n,r){return t.map((t=>{const a=t.url.replace(at,"$1");return{key:a,title:t.title,section:t.label,checked:!e.virtualLab||t.check_in_virtual_labs.includes(e.virtualLab),getSearchParams:e=>{const t=n;return e?t.add(a):t.delete(a),r(t),{shared_with_scopes:Array.from(t).join(","),page:null}}}}))}function ot(e){const t=(0,m.useContext)(I),[n,r]=(0,m.useState)(e),[a,l]=(0,m.useState)([]),i=(0,m.useContext)(rt),[o,s]=(0,m.useState)(new Set([]));return(0,m.useEffect)((()=>{r((e=>[...e,...it(t,i.filter((e=>!t.virtualLab||e.show_in_virtual_labs.includes(t.virtualLab))),o,s).filter((t=>!e.some((e=>e.key===t.key))))]))}),[t,i,o,s]),(0,m.useEffect)((()=>{l(function(e){const t=Array.from(new Set(e.map((e=>e.section))));return t.sort(((e,t)=>null===e&&null===t?0:null===e?-1:null===t?1:e.localeCompare(t))),t.map((t=>({key:t,title:null!==t&&lt[t]||null,checkboxFilters:e.filter((e=>e.section===t))})))}(n))}),[n]),{checkboxFilters:n,setCheckboxFilters:r,checkboxFiltersBySection:a,activeSharingScopes:o}}function st(e){const t=new URL(e);if(t.searchParams.has("page")){const n=Number(t.searchParams.get("page"));if(isNaN(n))throw Error(`Unexpected url: ${e}`);return n}return 1}async function ct(e){const t=await E("GET",e,{accept:"application/json"});if(200!==t.status_code)throw`${t.status_code} ${t.reason}`;return JSON.parse(t.content)}async function dt(e,t){let n=await ct(e);if(t){const e={count:n.count,next:null,previous:null,results:n.results};for(;null!==n.next;)n=await ct(n.next),e.results=e.results.concat(n.results);return e}return n}function ut({children:e}){return f().createElement(P.A,{variant:"subtitle2",sx:{mt:2}},e)}function pt({usernames:e,setUsernames:t,disabled:n,sx:r}){const a=(0,m.useContext)(I),[l,i]=f().useState(!1),[o,s]=f().useState([]),[c,d]=f().useState(!1),[u,p]=(0,m.useState)(null),[h]=(0,Ye.useDebouncedValue)(u,200);return(0,m.useEffect)((()=>{const e=h&&a.catalogueServiceUrl?`${a.catalogueServiceUrl}/users/?search=${h}`:null;e&&(d(!0),dt(e).then((e=>{s(e.results.map((e=>e.username)))})).catch((e=>{const t=`Error loading cells: ${String(e)}`;console.error(t)})).finally((()=>{d(!1)})))}),[h]),f().createElement(qe.A,{multiple:!0,sx:r,open:l,disabled:n,onOpen:()=>i(!0),onClose:()=>{i(!1),s([])},value:e,onChange:(e,n)=>t(n),onInputChange:(e,t)=>{p(t)},noOptionsText:"Search users",options:o,loading:c,filterOptions:e=>e,renderInput:e=>f().createElement(we.A,{...e,slotProps:{input:{...e.InputProps,endAdornment:f().createElement(f().Fragment,null,c?f().createElement(Xe.A,{color:"inherit",size:20}):null,e.InputProps.endAdornment)}}})})}function ht({open:e,onClose:t,onUpdated:n,cell:r,readonly:a}){const[l,i]=(0,m.useState)(r.shared_with_users||[]),{checkboxFilters:o,setCheckboxFilters:s,checkboxFiltersBySection:c,activeSharingScopes:d}=ot([]),[u,p]=(0,m.useState)(!1),[h,g]=(0,m.useState)(null);(0,m.useEffect)((()=>{s((e=>(e.forEach((e=>{var t;e.checked=(null===(t=r.shared_with_scopes)||void 0===t?void 0:t.includes(e.key))||!1})),e)))}),[r]),(0,m.useEffect)((()=>{o.forEach((e=>{e.getSearchParams(e.checked)}))}),[o]);const y=(0,m.useCallback)((async()=>{const e=await E("PATCH",r.url,{accept:"application/json"},{shared_with_users:l,shared_with_scopes:Array.from(d)});if(200!==e.status_code)throw`${e.status_code} ${e.reason}`}),[r,l,d]);return f().createElement(Pe.A,{onClose:t,open:e},f().createElement(Me.A,null,r.title),f().createElement(Fe.A,null,a&&f().createElement(Ge.A,{severity:"info",sx:{mb:2}},"You cannot modify this cell because it belongs to another user."),f().createElement(ut,null,"Share with users"),f().createElement(pt,{usernames:l,setUsernames:i,disabled:a,sx:{width:500,mt:1}}),c.map((e=>f().createElement(tt.A,{key:e.key},f().createElement(ut,null,e.title),e.checkboxFilters.map((e=>f().createElement(et.A,{key:e.key,label:e.title,control:f().createElement(Ke.A,{checked:e.checked,disabled:a,onChange:t=>{s((n=>{const r=[...n];return r[r.findIndex((t=>t.key===e.key))].checked=t.target.checked,r}))}})})))))),h&&f().createElement(Ge.A,{severity:"error",sx:{mt:2}},"Cannot update cell: ",h),u&&f().createElement(nt.A,{sx:{mt:2}})),f().createElement(Qe.A,null,f().createElement(X.A,{color:"secondary",onClick:t},"Cancel"),f().createElement(X.A,{disabled:a,onClick:async()=>{g(null),p(!0),y().then(t).then(n).catch((e=>g(e))).finally((()=>p(!1)))}},"Apply")))}const mt={sub:null,preferred_username:null,username:null},ft=(0,m.createContext)(mt);function gt({cell:e,isSpecialNode:t,userIsOwner:n,sx:r}){const a=new RegExp(`-${e.owner}$`),l=e.title.replace(a,"");return f().createElement(U.A,{sx:r},f().createElement(F,{variant:"subtitle2",label:l}),t||f().createElement(U.A,{direction:"row",spacing:1,sx:{alignItems:"center"}},e.is_draft&&f().createElement(P.A,{variant:"body2",sx:{fontStyle:"italic"}},"draft"),f().createElement(Je.A,{color:"action",fontSize:"inherit"}),f().createElement(P.A,{variant:"body2"},"v",e.version),e.owner&&f().createElement(f().Fragment,null,f().createElement(Ze.A,{color:"action",fontSize:"inherit"}),f().createElement(F,{variant:"body2",label:n?"me":e.owner}))))}function yt({cell:e,selectedCellInList:t,setSelectedCell:n,fetchCellsListResponse:r}){const a=(0,m.useRef)(null),l=function(e){const t="type"in e?e.type:"workflow-cell";return{id:e.url,type:t,position:{x:35,y:15},properties:{cell:e},ports:Object.fromEntries([...e.inputs.map((e=>[e.name,{id:e.name,type:"left",properties:{color:_(e.name),parentNodeType:t}}])),...e.outputs.map((e=>[e.name,{id:e.name,type:"right",properties:{color:_(e.name),parentNodeType:t}}]))])}}(e),i="workflow-cell"!==l.type,o=(0,m.useContext)(ft),s=e.owner===o.preferred_username,[c,d]=(0,m.useState)(!1);return f().createElement(ee.A,{ref:a,draggable:!0,onDragStart:e=>{e.dataTransfer.setData(w.REACT_FLOW_CHART,JSON.stringify({type:l.type,ports:l.ports,properties:l.properties}))},sx:{margin:"10px",fontSize:"14px",display:"flex",height:"25px",border:e.is_draft?"1px dashed darkgray":"1px solid lightgray",justifyContent:"space-between",alignItems:"center",background:"rgb(195, 235, 202)",backgroundColor:i?"rgb(195, 235, 202)":e.is_draft?"rgb(240,240,240)":"rgb(229,252,233)",borderRadius:"5px",padding:"10px",paddingRight:"1px",cursor:"grab","&:active":{cursor:"grabbing"}}},f().createElement(gt,{cell:e,isSpecialNode:i,userIsOwner:s,sx:{width:"calc(100% - 80px + 8px)"}}),i||f().createElement(f().Fragment,null,f().createElement($.A,{"aria-label":"Info",style:{borderRadius:"100%"},sx:{width:"40px"},onClick:()=>d(!0)},(e.shared_with_users||[]).length>0||(e.shared_with_scopes||[]).length>0?f().createElement(Be.A,null):f().createElement(ze.A,null)),f().createElement(ht,{open:c,onClose:()=>d(!1),onUpdated:r,cell:e,readonly:!s})),f().createElement($.A,{"aria-label":"Info",style:{borderRadius:"100%"},sx:{width:"40px",marginLeft:"-8px"},onClick:function(){t===e?n(null,null):n(e,a.current||null)}},f().createElement(T.A,null)))}function wt(){return f().createElement(je.A,{variant:"rounded",style:{margin:"10px",fontSize:"14px",display:"flex",height:"25px",border:"1px solid transparent",padding:"10px",borderRadius:"5px"}})}function vt({title:e,cells:t,loading:n,message:r,selectedCellInList:a,setSelectedCell:l,fetchCellsListResponse:i,button:o,filter:s,pageNav:c}){return f().createElement("div",null,f().createElement("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",minHeight:"40px",paddingRight:"10px",paddingLeft:"10px",background:"#3c8f49",color:"white",fontSize:"medium"}},f().createElement("span",{style:{overflow:"hidden",textOverflow:"ellipsis"}},e),o&&o),s&&s,f().createElement("div",null,n?f().createElement(f().Fragment,null,f().createElement(wt,null),f().createElement(wt,null)):f().createElement(f().Fragment,null,null!==r&&f().createElement("p",{style:{margin:"10px",textAlign:"center"}},r),t.map((e=>f().createElement(yt,{cell:e,selectedCellInList:a,setSelectedCell:l,fetchCellsListResponse:i}))))),c&&c)}var kt=n(9093),xt=n(5875);function Et({listResponse:e,setUrl:t}){const[n,r]=function(e){let t,n;if(null===e.previous&&null===e.next)t=1,n=1;else if(null===e.previous&&null!==e.next)t=1,n=(0,p.ceil)(e.count/e.results.length);else if(null!==e.previous&&null!==e.next){t=st(e.previous)+1;const r=e.results.length;n=(0,p.ceil)(e.count/r)}else{if(null===e.previous||null!==e.next)throw Error(`Unexpected pagination: ${e}`);t=st(e.previous)+1,n=t}return[t,n]}(e);return f().createElement(U.A,{direction:"row",spacing:1,sx:{justifyContent:"center",alignItems:"center"}},f().createElement($.A,{"aria-label":"Previous",style:{borderRadius:"100%"},onClick:()=>t(e.previous),sx:{visibility:null===e.previous?"hidden":"visible"}},f().createElement(kt.A,null)),f().createElement("p",null,"Page ",n," of ",r),f().createElement($.A,{"aria-label":"Next",style:{borderRadius:"100%"},onClick:()=>t(e.next),sx:{visibility:null===e.next?"hidden":"visible"}},f().createElement(xt.A,null)))}var bt=n(6336),Ct=n(5749),St=n(8125);function _t({setUrl:e}){const[t,n]=(0,m.useState)(null),[r]=(0,Ye.useDebouncedValue)(t,200);return(0,m.useEffect)((()=>{e((e=>Pt(e,{search:r,page:null})))}),[r]),f().createElement(we.A,{value:t,onChange:e=>n(e.target.value),slotProps:{input:{startAdornment:f().createElement(Ct.A,{position:"start"},f().createElement(St.A,null)),endAdornment:t&&f().createElement(Ct.A,{position:"end"},f().createElement($.A,{"aria-label":"clear search",onClick:()=>n(""),edge:"end",style:{borderRadius:"100%"}},f().createElement(bt.A,null)))}},size:"small",sx:{"& .MuiInputBase-root":{borderRadius:"100px"},width:"100%","&:focus-within":{flexShrink:0},transition:"all 0.5s ease"}})}var At=n(6299),Ot=n(3269),It=n(1437);const Rt=[{value:"created",title:"First created"},{value:"-created",title:"Last created"},{value:"title",title:"A-Z"},{value:"-title",title:"Z-A"}];function Lt({setUrl:e}){const[t,n]=(0,m.useState)("-created");(0,m.useEffect)((()=>{e((e=>Pt(e,{ordering:t,page:null})))}),[t]);const[r,a]=f().useState(null),l=Boolean(r);return f().createElement(f().Fragment,null,f().createElement($.A,{id:"ordering-button","aria-label":"ordering","aria-controls":l?"ordering-menu":void 0,"aria-expanded":l?"true":void 0,"aria-haspopup":"true",style:{borderRadius:"100%"},onClick:e=>a(e.currentTarget)},f().createElement(It.A,null)),f().createElement(At.A,{id:"ordering-menu",anchorEl:r,open:l,onClose:()=>a(null),slotProps:{list:{"aria-labelledby":"ordering-button"}}},Rt.map((e=>f().createElement(Ot.A,{key:e.value,selected:e.value===t,onClick:()=>{n(e.value),a(null)}},e.title)))))}var $t=n(6099),Tt=n(5851);const Ut=[{key:"all_versions",title:"All versions",section:null,checked:!0,getSearchParams:e=>({all_versions:e?"true":"false",page:null})},{key:"shared_with_me",title:"Shared with me",section:null,checked:!0,getSearchParams:e=>({shared_with_me:e?"true":"false",page:null})}];function Nt({children:e}){return f().createElement(P.A,{variant:"subtitle2",sx:{mt:2}},e)}function Mt({setUrl:e}){const{checkboxFilters:t,setCheckboxFilters:n,checkboxFiltersBySection:r}=ot(Ut),{virtualLab:a}=(0,m.useContext)(I);(0,m.useEffect)((()=>{const e=[{key:"virtual_lab",title:"All virtual labs",section:null,checked:!0,getSearchParams:e=>({virtual_lab:e?null:a||null,page:null})}];n((t=>[...e,...t.filter((t=>!e.some((e=>e.key===t.key))))]))}),[a]),(0,m.useEffect)((()=>{t.forEach((t=>{e((e=>Pt(e,t.getSearchParams(t.checked))))}))}),[t]);const[l,i]=f().useState(null),o=Boolean(l),s=o?"checkboxfilter-popover":void 0;return f().createElement(f().Fragment,null,f().createElement($.A,{"aria-describedby":s,"aria-label":"checkbox-filters",style:{borderRadius:"100%"},onClick:e=>i(e.currentTarget)},f().createElement($t.A,null)),f().createElement(Tt.Ay,{id:s,open:o,anchorEl:l,onClose:()=>i(null),anchorOrigin:{vertical:"bottom",horizontal:"left"}},f().createElement(tt.A,{sx:{px:2,py:1}},r.map((e=>f().createElement(tt.A,{key:e.key},f().createElement(Nt,null,e.title),e.checkboxFilters.map((e=>f().createElement(et.A,{key:e.key,label:e.title,control:f().createElement(Ke.A,{checked:e.checked,onChange:t=>{n((n=>{const r=[...n];return r[r.findIndex((t=>t.key===e.key))].checked=t.target.checked,r}))}})})))))))))}function Pt(e,t){if(null===e)return null;const n=new URL(e);for(const[e,r]of Object.entries(t))null===r||""===r?n.searchParams.delete(e):n.searchParams.set(e,r);return n.toString()}function Ft({setUrl:e}){return f().createElement(U.A,{direction:"row",spacing:1,sx:{justifyContent:"start",alignItems:"center",padding:"10px"}},f().createElement(_t,{setUrl:e}),f().createElement(Mt,{setUrl:e}),f().createElement(Lt,{setUrl:e}))}function Gt({settings:e,initialPath:t,getAllPages:n}){const[r,a]=(0,m.useState)(!0),[l,i]=(0,m.useState)(null),[o,s]=(0,m.useState)(e.catalogueServiceUrl?`${e.catalogueServiceUrl}/${t}`:null);(0,m.useEffect)((()=>{e.catalogueServiceUrl&&s(`${e.catalogueServiceUrl}/${t}`)}),[e.catalogueServiceUrl]);const[c,d]=(0,m.useState)({count:0,next:null,previous:null,results:[]}),u=(0,m.useCallback)((()=>{i&&i(null),a&&a(!0),o&&dt(o,n).then((e=>{d(e)})).catch((e=>{const t=`Error listing items: ${String(e)}`;console.error(t),i&&i(t)})).finally((()=>{a&&a(!1)}))}),[o]);return(0,m.useEffect)((()=>u()),[u]),{url:o,setUrl:s,loading:r,setLoading:a,errorMessage:l,setErrorMessage:i,fetchResponse:u,response:c}}function Dt({selectedCellInList:e,setSelectedCell:t}){const n=(0,m.useContext)(I),{setUrl:r,loading:a,errorMessage:l,fetchResponse:i,response:o}=Gt({settings:n,initialPath:"workflow-cells/?ordering=-created"}),{response:s}=Gt({settings:n,initialPath:"sharing-scopes/?page_size=100",getAllPages:!0}),c=function(){const[e,t]=(0,m.useState)(mt);return(0,m.useEffect)((()=>{x("naavre-communicator/me").then((e=>{t(e)}))}),[]),e}();return f().createElement(Q.A,{elevation:12,style:{position:"absolute",top:0,left:0,width:300,height:"100%",overflowX:"hidden",overflowY:"scroll",display:"flex",flexDirection:"column",borderRadius:0}},f().createElement(rt.Provider,{value:s.results},f().createElement(ft.Provider,{value:c},f().createElement(vt,{title:"Cells Catalog",cells:o.results,loading:a,message:l||(0===o.count?"There are no cells in your catalogue. Get started by creating a notebook and containerizing a cell.":null),selectedCellInList:e,setSelectedCell:t,fetchCellsListResponse:i,button:f().createElement(M.A,{title:"Refresh",arrow:!0},f().createElement($.A,{"aria-label":"Reload",style:{color:"white",borderRadius:"100%"},onClick:()=>i()},f().createElement(Ve.A,null))),filter:f().createElement(Ft,{setUrl:r}),pageNav:f().createElement(Et,{listResponse:o,setUrl:r})}),f().createElement(vt,{title:"Special cells",cells:We,loading:!1,message:null,selectedCellInList:e,setSelectedCell:t,fetchCellsListResponse:i}))))}function Ht({cell:e,cellNode:t,onClose:n}){const[r,a]=(0,m.useState)(null);return(0,Ye.useClickOutside)(n,null,[r,t]),f().createElement(Q.A,{ref:a,elevation:12,sx:{position:"absolute",top:20,left:"calc(20px + 300px)",width:380,maxHeight:"calc(100% - 40px)",overflowX:"clip",overflowY:"scroll"}},f().createElement(pe,{onClose:n},e.title),f().createElement(de,{cell:e}))}const Vt={chart:S,selectedCellInList:null,selectedCellNode:null,runWorkflowDialogOpen:!1};class Wt extends m.Component{constructor(e){super(e),this.state=Vt,this.chartStateActions=(0,p.mapValues)(y,(e=>(...t)=>{const n=e(...t)(this.state.chart);this.setState({chart:{...this.state.chart,...n}})})),this.chartConfig={readonly:!1,validateLink:A},this.setSelectedCell=(e,t)=>{this.setState({selectedCellInList:e,selectedCellNode:t})},this.setChart=e=>{this.setState({chart:e})},this.setRunWorkflowDialogOpen=e=>{this.setState({runWorkflowDialogOpen:e})},this.exportWorkflow=async e=>{E("POST",`${this.context.workflowServiceUrl}/convert`,{},{virtual_lab:this.context.virtualLab,naavrewf2:this.state.chart}).then((t=>{var n;null===(n=e.tracker.currentWidget)||void 0===n||n.model.upload(new File([t.content],"workflow.yaml"))})).catch((e=>{const t=`Error exporting the workflow: ${String(e)}`;console.log(t),alert(t)}))}}componentDidUpdate(){}render(){return m.createElement(g.A,{theme:O},m.createElement(De,{open:this.state.runWorkflowDialogOpen,onClose:()=>this.setRunWorkflowDialogOpen(!1),chart:this.state.chart}),m.createElement("div",{style:{display:"flex",flexDirection:"row",flex:1,maxWidth:"100vw",maxHeight:"100vh"}},m.createElement("div",{style:{display:"flex",flexDirection:"column",flex:"1",overflow:"hidden"}},m.createElement(w.FlowChart,{chart:this.state.chart,callbacks:this.chartStateActions,config:this.chartConfig,Components:{Node:V,NodeInner:B,Port:q,Link:K}}),this.state.chart.selected.id&&m.createElement(fe,{chart:this.state.chart,setChart:this.setChart,callbacks:this.chartStateActions,config:this.chartConfig}),this.state.selectedCellInList&&m.createElement(Ht,{cell:this.state.selectedCellInList,cellNode:this.state.selectedCellNode,onClose:()=>this.setSelectedCell(null,null)}),m.createElement(Dt,{selectedCellInList:this.state.selectedCellInList,setSelectedCell:this.setSelectedCell}))))}}Wt.contextType=I;class jt extends d.DocumentWidget{constructor(e){super(e)}updateSettings(e){this.content.updateSettings(e)}dispose(){this.content.dispose(),super.dispose()}}class zt extends a.ReactWidget{constructor(e){super(),this.settings={},this._onContentChanged=()=>{var e;null===(e=this.composerRef.current)||void 0===e||e.setState({chart:this._model.chart})},this.addClass("vre-composer"),this.composerRef=f().createRef(),this._model=e.model,e.ready.then((e=>{this._model.contentChanged.connect(this._onContentChanged),this._onContentChanged(),this.update()})),this._onContentChanged()}updateSettings(e){this.settings={...this.settings,...e},this.update()}render(){return f().createElement(I.Provider,{value:this.settings},f().createElement(Wt,{ref:this.composerRef}))}dispose(){this.isDisposed||(this._model.contentChanged.disconnect(this._onContentChanged),u.Signal.clearData(this),super.dispose())}onAfterAttach(e){super.onAfterAttach(e),this.node.addEventListener("focusout",this,!0)}onBeforeDetach(e){this.node.removeEventListener("focusout",this,!0),super.onBeforeDetach(e)}handleEvent(e){var t,n;e.preventDefault(),e.stopPropagation(),e.type&&"focusout"===e.type&&(h().isEqual(this._model.chart,null===(t=this.composerRef.current)||void 0===t?void 0:t.state.chart)||(this._model.chart=(null===(n=this.composerRef.current)||void 0===n?void 0:n.state.chart)||S))}}var Bt=n(8e3);class Zt{constructor(e){this.defaultKernelName="",this.defaultKernelLanguage="",this.sharedModel=Jt.create(),this._onClientChanged=()=>{const e=this.sharedModel.awareness.getStates();this._clientChanged.emit(e)},this._onSharedModelChanged=(e,t)=>{t.chartChange&&this.triggerContentChange(),t.stateChange&&t.stateChange.forEach((e=>{"dirty"===e.name?this.dirty=e.newValue:e.oldValue!==e.newValue&&this.triggerStateChange({newValue:void 0,oldValue:void 0,...e})}))},this._dirty=!1,this._isDisposed=!1,this._readOnly=!1,this._clientChanged=new u.Signal(this),this._contentChanged=new u.Signal(this),this._stateChanged=new u.Signal(this);const{collaborationEnabled:t,sharedModel:n}=e;this._collaborationEnabled=!!t,this.sharedModel=n||Jt.create(),this.sharedModel.changed.connect(this._onSharedModelChanged),this.sharedModel.awareness.on("change",this._onClientChanged)}get collaborative(){return this._collaborationEnabled}get dirty(){return this._dirty}set dirty(e){const t=this._dirty;e!==t&&(this._dirty=e,this.triggerStateChange({name:"dirty",oldValue:t,newValue:e}))}get isDisposed(){return this._isDisposed}get readOnly(){return this._readOnly}set readOnly(e){if(e===this._readOnly)return;const t=this._readOnly;this._readOnly=e,this.triggerStateChange({name:"readOnly",oldValue:t,newValue:e})}get clientId(){return this.sharedModel.awareness.clientID}get chart(){return this.sharedModel.get("chart")}set chart(e){this.sharedModel.set("chart",e)}get clientChanged(){return this._clientChanged}get contentChanged(){return this._contentChanged}get stateChanged(){return this._stateChanged}dispose(){this._isDisposed||(this._isDisposed=!0,u.Signal.clearData(this))}toString(){return this.sharedModel.getSource()}fromString(e){this.sharedModel.setSource(e)}toJSON(){return JSON.parse(this.toString()||"null")}fromJSON(e){this.fromString(JSON.stringify(e))}initialize(){}triggerStateChange(e){this._stateChanged.emit(e)}triggerContentChange(){this._contentChanged.emit(void 0),this.dirty=!0}}class Jt extends Bt.YDocument{constructor(){super(),this.version="1.0.0",this._contentObserver=e=>{const t={};e.keysChanged.has("chart")&&(t.chartChange=this._content.get("chart")),this._changed.emit(t)},this._content=this.ydoc.getMap("content"),this._content.observe(this._contentObserver)}getSource(){var e;const t={chart:null!==(e=this.get("chart"))&&void 0!==e?e:S};return JSON.stringify(t,null,2)}setSource(e){let t=S;if(e){const n=JSON.parse(e);t=n.chart}this.transact((()=>{this.set("chart",t)}))}dispose(){this.isDisposed||(this._content.unobserve(this._contentObserver),super.dispose())}static create(){return new Jt}get(e){const t=this._content.get(e);return"chart"===e?t?JSON.parse(t):S:null!=t?t:""}set(e,t){this._content.set(e,["chart"].includes(e)?JSON.stringify(t):t)}}class Yt extends d.ABCWidgetFactory{constructor(e){super(e)}createNewWidget(e){return new jt({context:e,content:new zt(e)})}}class qt{constructor(){this.collaborative=!0,this._disposed=!1}get name(){return"naavrewf-model"}get contentType(){return"naavrewfdoc"}get fileFormat(){return"text"}get isDisposed(){return this._disposed}dispose(){this._disposed=!0}preferredLanguage(e){return""}createNew(e){return new Zt(e)}}var Kt,Xt=n(2840);!function(e){e.createSaveButton=function(e,t){return new a.ToolbarButton({label:"Save",tooltip:"Save the workflow",icon:Xt.saveIcon,onClick:()=>{t.execute("docmanager:save")}})},e.createExportButton=function(e,t){return new a.ToolbarButton({label:"Export",tooltip:"Export the workflow",icon:Xt.codeIcon,onClick:()=>{var n;null===(n=e.content.composerRef.current)||void 0===n||n.exportWorkflow(t)}})},e.createRunButton=function(e){return new a.ToolbarButton({label:"Run",tooltip:"Run the workflow",icon:Xt.runIcon,onClick:()=>{var t;return null===(t=e.content.composerRef.current)||void 0===t?void 0:t.setRunWorkflowDialogOpen(!0)}})}}(Kt||(Kt={}));const Qt=new Xt.LabIcon({name:"launcher-icon",svgstr:'<?xml version="1.0" encoding="UTF-8" standalone="no"?>\n<svg\n   width="66.69"\n   height="66.69"\n   viewBox="0 0 66.69 66.69"\n   version="1.1"\n   id="svg5"\n   sodipodi:docname="launcher-icon.svg"\n   inkscape:version="1.4 (e7c3feb100, 2024-10-09)"\n   xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"\n   xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd"\n   xmlns:xlink="http://www.w3.org/1999/xlink"\n   xmlns="http://www.w3.org/2000/svg"\n   xmlns:svg="http://www.w3.org/2000/svg">\n  <sodipodi:namedview\n     id="namedview5"\n     pagecolor="#ffffff"\n     bordercolor="#666666"\n     borderopacity="1.0"\n     inkscape:showpageshadow="2"\n     inkscape:pageopacity="0.0"\n     inkscape:pagecheckerboard="0"\n     inkscape:deskcolor="#d1d1d1"\n     inkscape:zoom="5.6423717"\n     inkscape:cx="12.671976"\n     inkscape:cy="62.739574"\n     inkscape:current-layer="svg5" />\n  <defs\n     id="defs1">\n    <linearGradient\n       id="swatch5"\n       inkscape:swatch="solid">\n      <stop\n         style="stop-color:#3c8f49;stop-opacity:1;"\n         offset="0"\n         id="stop5" />\n    </linearGradient>\n    <style\n       id="style1">\n      .a92fba6e-7ebd-4c32-8963-8296e20ef654 {\n        fill: #0f4e8b;\n      }\n    </style>\n    <linearGradient\n       inkscape:collect="always"\n       xlink:href="#swatch5"\n       id="linearGradient5"\n       x1="0"\n       y1="33.352931"\n       x2="66.69"\n       y2="33.352931"\n       gradientUnits="userSpaceOnUse" />\n  </defs>\n  <g\n     id="a472ef7c-dd17-4d49-9df0-027f7f177a8f"\n     data-name="Livello 2"\n     style="fill:url(#linearGradient5)">\n    <g\n       id="b55479a9-ce75-42ce-9f6a-fdbd00d931c6"\n       data-name="Livello 1"\n       style="fill:url(#linearGradient5)">\n      <g\n         id="g5"\n         style="fill:url(#linearGradient5)">\n        <path\n           class="a92fba6e-7ebd-4c32-8963-8296e20ef654"\n           d="M33.34,40.87a5.38,5.38,0,1,0,5.38,5.38,5.39,5.39,0,0,0-5.38-5.38Zm0,8.61a3.23,3.23,0,1,1,3.23-3.23,3.23,3.23,0,0,1-3.23,3.23Z"\n           id="path1"\n           style="fill:url(#linearGradient5)" />\n        <rect\n           class="a92fba6e-7ebd-4c32-8963-8296e20ef654"\n           x="32.27"\n           y="4.3"\n           width="8.6"\n           height="2.15"\n           id="rect1"\n           style="fill:url(#linearGradient5)" />\n        <rect\n           class="a92fba6e-7ebd-4c32-8963-8296e20ef654"\n           x="32.27"\n           y="8.6"\n           width="8.6"\n           height="2.15"\n           id="rect2"\n           style="fill:url(#linearGradient5)" />\n        <rect\n           class="a92fba6e-7ebd-4c32-8963-8296e20ef654"\n           x="25.81"\n           y="12.91"\n           width="15.06"\n           height="2.15"\n           id="rect3"\n           style="fill:url(#linearGradient5)" />\n        <rect\n           class="a92fba6e-7ebd-4c32-8963-8296e20ef654"\n           x="25.81"\n           y="17.21"\n           width="15.06"\n           height="2.15"\n           id="rect4"\n           style="fill:url(#linearGradient5)" />\n        <rect\n           class="a92fba6e-7ebd-4c32-8963-8296e20ef654"\n           x="25.81"\n           y="21.51"\n           width="15.06"\n           height="2.15"\n           id="rect5"\n           style="fill:url(#linearGradient5)" />\n        <path\n           class="a92fba6e-7ebd-4c32-8963-8296e20ef654"\n           d="M66.69,34.42V25.81H51.63v8.61h6.45V45.17H45.17V43.32l-2.64-.88L43.78,40l-4.14-4.14-2.49,1.25-.88-2.64H34.42V28H45.17V15.06H58.08v6L55.62,18.6l-1.53,1.52,5.07,5.06,5.06-5.06L62.7,18.6l-2.47,2.47V12.91H45.17V0H28.6L21.51,7.08v5.83H6.45v8.16L4,18.6,2.47,20.12l5.06,5.06,5.06-5.06L11.07,18.6,8.6,21.07v-6H21.51V28H32.27v6.45H30.42l-.88,2.64-2.49-1.25L22.91,40l1.24,2.49-2.64.88v1.85H8.6V34.42h6.46V25.81H0v8.61H6.45V51.78a4.31,4.31,0,1,0,2.15,0V47.33h6.46v13.1a3.23,3.23,0,1,0,2.15,0V47.33h4.3v1.85l2.64.88-1.24,2.49,4.14,4.14,2.49-1.25.88,2.64h5.85l.88-2.64,2.49,1.25,4.14-4.14-1.25-2.49,2.64-.88V47.33h4.31v13.1a3.23,3.23,0,1,0,2.15,0V47.33h6.45v4.45a4.31,4.31,0,1,0,2.15,0V34.42ZM28,3.67V6.45H25.18ZM23.66,8.6h6.46V2.15H43V25.81H23.66ZM2.15,28H12.91v4.3H2.15Zm7.53,28a2.15,2.15,0,1,1-2.15-2.15,2.15,2.15,0,0,1,2.15,2.15Zm6.45,8.61a1.08,1.08,0,1,1,1.08-1.08,1.08,1.08,0,0,1-1.08,1.08ZM43,47.63l-2.46.82-.19.47c0,.14-.1.28-.16.41L40,49.8l1.16,2.32-1.94,2-2.33-1.16-.46.2-.41.17-.48.18-.82,2.47H32l-.83-2.47-.48-.18-.4-.17-.46-.2-2.33,1.16-1.95-2,1.17-2.32-.21-.47c-.06-.13-.11-.27-.17-.41l-.18-.47-2.47-.82V44.87l2.47-.82.18-.47c.06-.14.11-.28.17-.41l.21-.47-1.17-2.32,1.95-2,2.33,1.16.46-.2.4-.17.48-.18L32,36.57h2.75L35.54,39l.48.18.41.17.46.21,2.33-1.17,1.94,2L40,42.7l.21.47c.06.13.11.27.17.41l.18.47,2.46.83Zm7.53,16.91a1.08,1.08,0,1,1,1.08-1.08,1.08,1.08,0,0,1-1.08,1.08Zm10.76-8.61a2.15,2.15,0,1,1-2.15-2.15,2.15,2.15,0,0,1,2.15,2.15ZM53.78,28H64.54v4.3H53.78Z"\n           id="path5"\n           style="fill:url(#linearGradient5)" />\n      </g>\n    </g>\n  </g>\n</svg>\n'});var en,tn;new Xt.LabIcon({name:"panel-icon",svgstr:'<?xml version="1.0" encoding="UTF-8" standalone="no"?>\n\x3c!-- Created with Inkscape (http://www.inkscape.org/) --\x3e\n\n<svg\n   width="20"\n   height="20"\n   version="1.1"\n   viewBox="0 0 5.2916639 5.2916639"\n   xml:space="preserve"\n   id="svg7"\n   sodipodi:docname="extension-icon.svg"\n   inkscape:version="1.4 (e7c3feb100, 2024-10-09)"\n   xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"\n   xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd"\n   xmlns:xlink="http://www.w3.org/1999/xlink"\n   xmlns="http://www.w3.org/2000/svg"\n   xmlns:svg="http://www.w3.org/2000/svg"><defs\n     id="defs7"><linearGradient\n       id="swatch20"\n       inkscape:swatch="solid"><stop\n         style="stop-color:#000000;stop-opacity:1;"\n         offset="0"\n         id="stop20" /></linearGradient><linearGradient\n       id="swatch12"\n       inkscape:swatch="solid"><stop\n         style="stop-color:#000000;stop-opacity:1;"\n         offset="0"\n         id="stop12" /></linearGradient><linearGradient\n       id="swatch9"\n       inkscape:swatch="solid"><stop\n         style="stop-color:#000000;stop-opacity:1;"\n         offset="0"\n         id="stop9" /></linearGradient><linearGradient\n       id="swatch8"\n       inkscape:swatch="solid"><stop\n         style="stop-color:#3c8f49;stop-opacity:1;"\n         offset="0"\n         id="stop8" /></linearGradient><linearGradient\n       id="swatch7"\n       inkscape:swatch="solid"><stop\n         style="stop-color:#000000;stop-opacity:1;"\n         offset="0"\n         id="stop7" /></linearGradient><clipPath\n       clipPathUnits="userSpaceOnUse"\n       id="clipPath33"><path\n         d="M 0,0 H 595.276 V 841.89 H 0 Z"\n         transform="translate(-364.14791,-348.99961)"\n         id="path33" /></clipPath><clipPath\n       clipPathUnits="userSpaceOnUse"\n       id="clipPath40"><path\n         d="M 0,0 H 595.276 V 841.89 H 0 Z"\n         transform="translate(-395.09281,-354.98901)"\n         id="path40" /></clipPath><linearGradient\n       inkscape:collect="always"\n       xlink:href="#swatch8"\n       id="linearGradient7"\n       x1="92.20253"\n       y1="296.08044"\n       x2="141.51561"\n       y2="296.08044"\n       gradientUnits="userSpaceOnUse"\n       gradientTransform="matrix(20.437953,0,0,20.400997,24.954893,177.72344)" /><linearGradient\n       inkscape:collect="always"\n       xlink:href="#swatch8"\n       id="linearGradient9"\n       gradientUnits="userSpaceOnUse"\n       x1="92.20253"\n       y1="296.08044"\n       x2="141.51561"\n       y2="296.08044"\n       gradientTransform="matrix(20.437953,0,0,20.400997,24.954893,177.72344)" /><linearGradient\n       inkscape:collect="always"\n       xlink:href="#swatch8"\n       id="linearGradient10"\n       gradientUnits="userSpaceOnUse"\n       x1="92.20253"\n       y1="296.08044"\n       x2="141.51561"\n       y2="296.08044"\n       gradientTransform="matrix(20.437953,0,0,20.400997,24.95489,177.72344)" /><linearGradient\n       inkscape:collect="always"\n       xlink:href="#swatch8"\n       id="linearGradient11"\n       gradientUnits="userSpaceOnUse"\n       x1="92.20253"\n       y1="296.08044"\n       x2="141.51561"\n       y2="296.08044"\n       gradientTransform="matrix(20.437953,0,0,20.400997,24.954893,177.72344)" /><linearGradient\n       inkscape:collect="always"\n       xlink:href="#swatch8"\n       id="linearGradient12"\n       x1="38.725582"\n       y1="239.17892"\n       x2="119.33492"\n       y2="239.17892"\n       gradientUnits="userSpaceOnUse"\n       gradientTransform="matrix(20.437955,0,0,20.400997,24.954895,177.72344)" /><linearGradient\n       inkscape:collect="always"\n       xlink:href="#swatch8"\n       id="linearGradient13"\n       x1="75.722961"\n       y1="217.14847"\n       x2="82.33754"\n       y2="217.14847"\n       gradientUnits="userSpaceOnUse"\n       gradientTransform="matrix(20.437954,0,0,20.400997,24.954894,177.72344)" /><linearGradient\n       inkscape:collect="always"\n       xlink:href="#swatch8"\n       id="linearGradient20"\n       x1="31.019951"\n       y1="250.64404"\n       x2="53.045799"\n       y2="250.64404"\n       gradientUnits="userSpaceOnUse"\n       gradientTransform="matrix(20.437954,0,0,20.400997,24.954893,177.72344)" /><linearGradient\n       inkscape:collect="always"\n       xlink:href="#swatch8"\n       id="linearGradient21"\n       x1="105.01471"\n       y1="250.64404"\n       x2="127.04055"\n       y2="250.64404"\n       gradientUnits="userSpaceOnUse"\n       gradientTransform="matrix(20.437955,0,0,20.400998,24.954894,177.72344)" /><linearGradient\n       inkscape:collect="always"\n       xlink:href="#swatch8"\n       id="linearGradient22"\n       x1="68.017326"\n       y1="250.64404"\n       x2="90.043175"\n       y2="250.64404"\n       gradientUnits="userSpaceOnUse"\n       gradientTransform="matrix(20.437955,0,0,20.400998,24.954894,177.72344)" /></defs><sodipodi:namedview\n     id="namedview7"\n     pagecolor="#ffffff"\n     bordercolor="#666666"\n     borderopacity="1.0"\n     inkscape:showpageshadow="2"\n     inkscape:pageopacity="0.0"\n     inkscape:pagecheckerboard="0"\n     inkscape:deskcolor="#d1d1d1"\n     inkscape:zoom="27.188668"\n     inkscape:cx="7.3192259"\n     inkscape:cy="21.001397"\n     inkscape:current-layer="g22"\n     showgrid="false"><inkscape:grid\n       id="grid1"\n       units="px"\n       originx="-0.5291664"\n       originy="-0.5291664"\n       spacingx="0.2645832"\n       spacingy="0.2645832"\n       empcolor="#ff3f3f"\n       empopacity="0.25098039"\n       color="#3f3fff"\n       opacity="0.1254902"\n       empspacing="10"\n       enabled="true"\n       visible="false" /></sodipodi:namedview><g\n     id="g22"\n     transform="matrix(0.04892858,0,0,0.04901721,-1.2210061,-8.7115099)"\n     style="stroke-width:5.40265;stroke-dasharray:none"><path\n       id="rect7"\n       style="opacity:1;fill:none;stroke:url(#linearGradient7);stroke-width:5.40263;stroke-miterlimit:8;stroke-dasharray:none;paint-order:stroke fill markers"\n       d="m 27.65618,261.39123 h 21.635064 v 21.58618 H 27.65618 Z"\n       sodipodi:nodetypes="ccccc" /><path\n       id="rect9"\n       style="opacity:1;fill:none;stroke:url(#linearGradient9);stroke-width:5.40263;stroke-miterlimit:8;stroke-dasharray:none;paint-order:stroke fill markers"\n       d="m 65.508951,261.39123 h 21.635064 v 21.58618 H 65.508951 Z"\n       sodipodi:nodetypes="ccccc" /><path\n       id="rect10"\n       style="opacity:1;fill:none;stroke:url(#linearGradient10);stroke-width:5.40263;stroke-miterlimit:8;stroke-dasharray:none;paint-order:stroke fill markers"\n       d="m 103.36172,261.39123 h 21.63507 v 21.58618 h -21.63507 z"\n       sodipodi:nodetypes="ccccc" /><path\n       id="rect11"\n       style="opacity:1;fill:none;stroke:url(#linearGradient11);stroke-width:5.40262;stroke-miterlimit:8;stroke-dasharray:none;paint-order:stroke fill markers"\n       d="M 65.508946,180.42481 V 202.011 H 87.14402 v -21.58619 z" /><path\n       style="opacity:1;fill:none;stroke:url(#linearGradient13);stroke-width:5.40263;stroke-miterlimit:8;stroke-dasharray:none;paint-order:stroke fill markers"\n       d="m 76.324548,210.11006 v 37.78433"\n       id="path11"\n       sodipodi:nodetypes="cc" /><path\n       style="opacity:1;fill:none;stroke:url(#linearGradient12);stroke-width:5.40263;stroke-miterlimit:8;stroke-dasharray:none;stroke-opacity:1;paint-order:stroke fill markers"\n       d="M 38.471258,247.89439 V 223.6069 h 75.710452 v 24.28749"\n       id="path12"\n       sodipodi:nodetypes="cccc" /><path\n       style="opacity:1;fill:none;stroke:url(#linearGradient20);stroke-width:5.40263;stroke-miterlimit:8;stroke-dasharray:none;stroke-opacity:1;paint-order:stroke fill markers"\n       d="m 26.855112,237.89486 11.716755,11.59659 11.716756,-11.59659"\n       id="path18"\n       inkscape:transform-center-y="-0.28421607"\n       sodipodi:nodetypes="ccc" /><path\n       style="opacity:1;fill:none;stroke:url(#linearGradient21);stroke-width:5.40263;stroke-miterlimit:8;stroke-dasharray:none;stroke-opacity:1;paint-order:stroke fill markers"\n       d="m 102.56065,237.89487 11.71676,11.59659 11.71676,-11.59659"\n       id="path19"\n       inkscape:transform-center-y="-0.28421561"\n       sodipodi:nodetypes="ccc" /><path\n       style="opacity:1;fill:none;stroke:url(#linearGradient22);stroke-width:5.40263;stroke-miterlimit:8;stroke-dasharray:none;stroke-opacity:1;paint-order:stroke fill markers"\n       d="m 64.707883,237.89487 11.716756,11.59659 11.716756,-11.59659"\n       id="path20"\n       inkscape:transform-center-y="-0.28421561"\n       sodipodi:nodetypes="ccc" /></g></svg>\n'}),function(e){e.createNew="create-vre-composer"}(en||(en={})),function(e){e.addCommands=function(e,t,n){e.addCommand(en.createNew,{label:"Experiment Manager",caption:"Launch Workflow Composition",icon:e=>e.isPalette?void 0:Qt,execute:r=>{var a;return async function(e,t,n){const r=await e.execute("docmanager:new-untitled",{path:t,type:"file",ext:"naavrewf"});if(void 0!==r){const t=await e.execute("docmanager:open",{path:r.path,factory:n});return t.isUntitled=!0,t}}(e,r.cwd||(null===(a=t.tracker.currentWidget)||void 0===a?void 0:a.model.path),n)}})}}(tn||(tn={}));const nn="NaaVRE workflow editor",rn=new i.Token("naavrewfDocTracker"),an={id:"@naavre/workflow-jupyterlab:plugin",autoStart:!0,requires:[r.ILayoutRestorer,l.ILauncher,s.ITranslator,a.IToolbarWidgetRegistry,o.ISettingRegistry,c.IFileBrowserFactory],optional:[],provides:rn,activate:(e,t,n,r,l,i,o)=>{let s;console.log("JupyterLab extension @naavre/workflow-jupyterlab is activated!"),tn.addCommands(e.commands,o,nn),n&&n.add({command:en.createNew,category:"VRE Components",rank:0}),l&&(l.registerFactory(nn,"saveWorkflow",(t=>Kt.createSaveButton(t,e.commands))),l.registerFactory(nn,"exportWorkflow",(e=>Kt.createExportButton(e,o))),l.registerFactory(nn,"runWorkflow",(e=>Kt.createRunButton(e))),i&&(s=(0,a.createToolbarFactory)(l,i,nn,an.id,r)));const c=new a.WidgetTracker({namespace:"documents-naavrewf"});function d(e){var t;null===(t=c.currentWidget)||void 0===t||t.updateSettings(e.composite)}t&&t.restore(c,{command:"docmanager:open",args:e=>({path:e.context.path,factory:nn}),name:e=>e.context.path}),i&&Promise.all([e.restored,i.load(an.id)]).then((([,e])=>{d(e),e.changed.connect(d),c.currentChanged.connect((()=>d(e)))})).catch((e=>{console.error("Failed to load settings for @naavre/containerizer-jupyterlab.",e)})),e.docRegistry.addFileType({name:"naavrewf",displayName:"NaaVRE Workflow",mimeTypes:["text/json","application/json"],extensions:[".naavrewf"],fileFormat:"text",contentType:"naavrewfdoc"});const u=new qt;e.docRegistry.addModelFactory(u);const p=new Yt({name:nn,modelName:"naavrewf-model",fileTypes:["naavrewf"],defaultFor:["naavrewf"],toolbarFactory:s});p.widgetCreated.connect(((e,t)=>{t.context.pathChanged.connect((()=>{c.save(t)})),c.add(t)})),e.docRegistry.addWidgetFactory(p)}},ln=an}}]);