[tool.poetry]
name = "oceanstream"
version = "0.1.1"
description = "Process oceanographic measurements from USVs and write partitioned GeoParquet datasets with geospatial metadata."
authors = ["Andrei Neacsu <andrei@oceanstream.io>"]
license = "MIT"
readme = "oceanstream/README.md"
homepage = "https://oceanstream.io"
keywords = ["oceanography", "geoparquet", "stac", "saildrone", "geospatial", "usv", "marine-data"]
classifiers = [
    "Development Status :: 4 - Beta",
    "Environment :: Console",
    "Intended Audience :: Science/Research",
    "License :: OSI Approved :: MIT License",
    "Operating System :: OS Independent",
    "Programming Language :: Python :: 3.11",
    "Programming Language :: Python :: 3.12",
    "Topic :: Scientific/Engineering :: GIS",
    "Topic :: Scientific/Engineering :: Oceanography",
]

# Explicitly include only the oceanstream package
packages = [{ include = "oceanstream" }]

# Exclude non-essential files from the package
exclude = [
    "oceanstream/tests/",
    "oceanstream/docs/",
    "oceanstream/MANIFEST.in",
    "oceanstream/pyproject.toml",
    "oceanstream/**/*.bak*",
    "oceanstream/**/__pycache__/",
    "oceanstream/**/.pytest_cache/",
    # Root-level files/folders that shouldn't be included
    "docs/",
    "docs-internal/",
    ".docs-website/",
    "notebooks/",
    "examples/",
    "scripts/",
    "raw_data/",
    "data/",
    "htmlcov/",
    "_oceanstream-website-static/",
    ".mkdocs-shadcn-fork/",
    "*.md",
    "Makefile",
    "*.toml.example",
    "test_*.py",
    "demo_*.py",
    "analyze_*.py",
]

[tool.poetry.scripts]
oceanstream = "oceanstream.cli:app"

[tool.poetry.dependencies]
python = ">=3.11,<3.13"
# Core dependencies (always installed)
pandas = ">=2.1"
pyarrow = ">=14"
azure-storage-blob = ">=12.19"
typer = ">=0.12"
rich = ">=13.7"
tqdm = ">=4.66"

# Optional dependencies for specific processing modules
geopandas = { version = ">=0.14", optional = true }
shapely = { version = ">=2.0", optional = true }
pynmea2 = { version = ">=1.18", optional = true }
seabirdscientific = { version = ">=2.7", optional = true }

# Echodata dependencies (pinned for echopype compatibility)
# NOTE: Install via pip for echopype fork: pip install "oceanstream[echodata]"
# Then manually: pip install git+https://github.com/OceanStreamIO/echopype-dev.git@oceanstream-iotedge
numpy = { version = "1.26.4", optional = true }
xarray = { version = "2024.11.0", optional = true }
dask = { version = "2024.9.0", extras = ["complete"], optional = true }
distributed = { version = "2024.9.0", optional = true }
zarr = { version = ">=2.16", optional = true }
netcdf4 = { version = ">=1.6", optional = true }
fsspec = { version = "2025.3.2", optional = true }
numcodecs = { version = "0.14.1", optional = true }
bottleneck = { version = "1.5.0", optional = true }
openpyxl = { version = ">=3.0", optional = true }
adlfs = { version = ">=2024.4.0", optional = true }

# Environmental data fallback (Copernicus Marine Service)
copernicusmarine = { version = ">=1.0.0", optional = true }
gsw = { version = ">=3.6.0", optional = true }

# Visualization (optional for echodata)
matplotlib = { version = ">=3.7", optional = true }
hvplot = { version = ">=0.9", optional = true }
datashader = { version = ">=0.16", optional = true }

[tool.poetry.extras]
# Processing module extras
geotrack = ["geopandas", "shapely", "pynmea2", "seabirdscientific"]

# Echodata processing (EK60/EK80 echosounders)
# NOTE: echopype must be installed separately from fork:
# pip install git+https://github.com/OceanStreamIO/echopype-dev.git@oceanstream-iotedge
echodata = [
    "numpy", "xarray", "dask", "distributed", "zarr", "netcdf4",
    "fsspec", "numcodecs", "bottleneck", "openpyxl",
    "copernicusmarine", "gsw", "adlfs"
]
echodata-viz = ["matplotlib", "hvplot", "datashader"]

multibeam = []  # Future: MB-System Python bindings when available
adcp = []  # Future: ADCP processing libraries

# Convenience extras
all = [
    "geopandas", "shapely", "pynmea2", "seabirdscientific",
    "numpy", "xarray", "dask", "distributed", "zarr", "netcdf4",
    "fsspec", "numcodecs", "bottleneck", "openpyxl", "adlfs",
    "copernicusmarine", "gsw", "matplotlib", "hvplot", "datashader"
]
geo = ["geopandas", "shapely", "pynmea2", "seabirdscientific"]  # Legacy alias for geotrack

[tool.poetry.group.dev.dependencies]
pytest = ">=8.0"
pytest-cov = ">=5.0"
ruff = ">=0.6"
mypy = ">=1.10"

[build-system]
requires = ["poetry-core>=1.0.0"]
build-backend = "poetry.core.masonry.api"
