<!DOCTYPE html>



<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />

        <title>
            
    
    2.1 Changelog
 &mdash;
    SQLAlchemy 2.1 Documentation

        </title>

        
            <!-- begin iterate through site-imported + sphinx environment css_files -->
                <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
                <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
                <link rel="stylesheet" href="../_static/default.css" type="text/css" />
                <link rel="stylesheet" href="../_static/copybutton.css" type="text/css" />
                <link rel="stylesheet" href="../_static/docs.css" type="text/css" />
                <link rel="stylesheet" href="../_static/changelog.css" type="text/css" />
                <link rel="stylesheet" href="../_static/sphinx_paramlinks.css" type="text/css" />
            <!-- end iterate through site-imported + sphinx environment css_files -->
        

        

    

    <!-- begin layout.mako headers -->

    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
        <link rel="copyright" title="Copyright" href="../copyright.html" />
    <link rel="top" title="SQLAlchemy 2.1 Documentation" href="../index.html" />
        <link rel="up" title="Changes and Migration" href="index.html" />
        <link rel="next" title="2.0 Changelog" href="changelog_20.html" />
        <link rel="prev" title="What’s New in SQLAlchemy 2.1?" href="migration_21.html" />
    <!-- end layout.mako headers -->


    </head>
    <body>
        
















<div id="docs-container">





<div id="docs-top-navigation-container" class="body-background">
<div id="docs-header">
    <div id="docs-version-header">
        Release: <span class="version-num">2.1.0b1</span>


        | Release Date: January 21, 2026

    </div>

    <h1><a href="../index.html">SQLAlchemy 2.1 Documentation</a></h1>

</div>
</div>

<div id="docs-body-container">

    <div id="fixed-sidebar" class="withsidebar">



        <div id="docs-sidebar-popout">
            <h3><a href="../index.html">SQLAlchemy 2.1 Documentation</a></h3>
            <p id="sidebar-topnav">
                <a href="../index.html">Home</a>
            </p>

            <div id="sidebar-search">
                <form class="search" action="../search.html" method="get">
                  <label>
                  Search terms:
                  <input type="text" placeholder="search..." name="q" size="12" />
                  </label>
                  <input type="hidden" name="check_keywords" value="yes" />
                  <input type="hidden" name="area" value="default" />
                </form>
            </div>

        </div>

        <div id="docs-sidebar">

        <div id="sidebar-banner">
            
        </div>

        <div id="docs-sidebar-inner">

        
        <h3>
            <a href="index.html" title="Changes and Migration">Changes and Migration</a>
        </h3>

        <ul>
<li><span class="link-container"><a class="reference external" href="migration_21.html">What’s New in SQLAlchemy 2.1?</a></span></li>
<li class="selected"><span class="link-container"><strong>2.1 Changelog</strong><a class="paramlink headerlink reference internal" href="#">¶</a></span><ul>
<li><span class="link-container"><a class="reference external" href="#change-2.1.0b1">2.1.0b1</a></span><ul>
<li><span class="link-container"><a class="reference external" href="#change-2.1.0b1-platform">platform</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.1.0b1-orm">orm</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.1.0b1-engine">engine</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.1.0b1-sql">sql</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.1.0b1-schema">schema</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.1.0b1-typing">typing</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.1.0b1-asyncio">asyncio</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.1.0b1-postgresql">postgresql</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.1.0b1-mysql">mysql</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.1.0b1-mariadb">mariadb</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.1.0b1-sqlite">sqlite</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.1.0b1-mssql">mssql</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.1.0b1-oracle">oracle</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.1.0b1-tests">tests</a></span></li>
<li><span class="link-container"><a class="reference external" href="#change-2.1.0b1-misc">misc</a></span></li>
</ul>
</li>
</ul>
</li>
<li><span class="link-container"><a class="reference external" href="changelog_20.html">2.0 Changelog</a></span></li>
<li><span class="link-container"><a class="reference external" href="changelog_14.html">1.4 Changelog</a></span></li>
<li><span class="link-container"><a class="reference external" href="changelog_13.html">1.3 Changelog</a></span></li>
<li><span class="link-container"><a class="reference external" href="changelog_12.html">1.2 Changelog</a></span></li>
<li><span class="link-container"><a class="reference external" href="changelog_11.html">1.1 Changelog</a></span></li>
<li><span class="link-container"><a class="reference external" href="changelog_10.html">1.0 Changelog</a></span></li>
<li><span class="link-container"><a class="reference external" href="changelog_09.html">0.9 Changelog</a></span></li>
<li><span class="link-container"><a class="reference external" href="changelog_08.html">0.8 Changelog</a></span></li>
<li><span class="link-container"><a class="reference external" href="changelog_07.html">0.7 Changelog</a></span></li>
<li><span class="link-container"><a class="reference external" href="changelog_06.html">0.6 Changelog</a></span></li>
<li><span class="link-container"><a class="reference external" href="changelog_05.html">0.5 Changelog</a></span></li>
<li><span class="link-container"><a class="reference external" href="changelog_04.html">0.4 Changelog</a></span></li>
<li><span class="link-container"><a class="reference external" href="changelog_03.html">0.3 Changelog</a></span></li>
<li><span class="link-container"><a class="reference external" href="changelog_02.html">0.2 Changelog</a></span></li>
<li><span class="link-container"><a class="reference external" href="changelog_01.html">0.1 Changelog</a></span></li>
<li><span class="link-container"><a class="reference external" href="migration_20.html">SQLAlchemy 2.0 - Major Migration Guide</a></span></li>
<li><span class="link-container"><a class="reference external" href="whatsnew_20.html">What’s New in SQLAlchemy 2.0?</a></span></li>
<li><span class="link-container"><a class="reference external" href="migration_14.html">What’s New in SQLAlchemy 1.4?</a></span></li>
<li><span class="link-container"><a class="reference external" href="migration_13.html">What’s New in SQLAlchemy 1.3?</a></span></li>
<li><span class="link-container"><a class="reference external" href="migration_12.html">What’s New in SQLAlchemy 1.2?</a></span></li>
<li><span class="link-container"><a class="reference external" href="migration_11.html">What’s New in SQLAlchemy 1.1?</a></span></li>
<li><span class="link-container"><a class="reference external" href="migration_10.html">What’s New in SQLAlchemy 1.0?</a></span></li>
<li><span class="link-container"><a class="reference external" href="migration_09.html">What’s New in SQLAlchemy 0.9?</a></span></li>
<li><span class="link-container"><a class="reference external" href="migration_08.html">What’s New in SQLAlchemy 0.8?</a></span></li>
<li><span class="link-container"><a class="reference external" href="migration_07.html">What’s New in SQLAlchemy 0.7?</a></span></li>
<li><span class="link-container"><a class="reference external" href="migration_06.html">What’s New in SQLAlchemy 0.6?</a></span></li>
<li><span class="link-container"><a class="reference external" href="migration_05.html">What’s new in SQLAlchemy 0.5?</a></span></li>
<li><span class="link-container"><a class="reference external" href="migration_04.html">What’s new in SQLAlchemy 0.4?</a></span></li>
</ul>



        </div>

        </div>

    </div>

    <div id="narrow-index-nav">
        <form class="search" action="../search.html" method="get">
            <label>
                Search terms:
            <input type="text" placeholder="search..." name="q" size="12" />
            </label>
            <input type="submit" value="Search" />
            <input type="hidden" name="check_keywords" value="yes" />
            <input type="hidden" name="area" value="default" />
        </form>

        <p>
        <a href="../index.html">Home</a>
        </p>

    </div>


        <div id="docs-narrow-top-navigation">
            <ul>
                <li><b>Previous:</b>
                <a href="migration_21.html" title="previous chapter">What’s New in SQLAlchemy 2.1?</a></li>
                <li><b>Next:</b>
                <a href="changelog_20.html" title="next chapter">2.0 Changelog</a></li>

            <li><b>Up:</b> <a href="../index.html">Home</a></li>
                    <ul><li><a href="index.html" title="Changes and Migration">Changes and Migration</a></li>
                </ul>



            <li><b>On this page:</b></li>
            <ul>
<li><a class="reference internal" href="#changelog">2.1 Changelog</a><ul>
<li><a class="reference internal" href="#change-2.1.0b1">2.1.0b1</a><ul>
<li><a class="reference internal" href="#change-2.1.0b1-platform">platform</a></li>
<li><a class="reference internal" href="#change-2.1.0b1-orm">orm</a></li>
<li><a class="reference internal" href="#change-2.1.0b1-engine">engine</a></li>
<li><a class="reference internal" href="#change-2.1.0b1-sql">sql</a></li>
<li><a class="reference internal" href="#change-2.1.0b1-schema">schema</a></li>
<li><a class="reference internal" href="#change-2.1.0b1-typing">typing</a></li>
<li><a class="reference internal" href="#change-2.1.0b1-asyncio">asyncio</a></li>
<li><a class="reference internal" href="#change-2.1.0b1-postgresql">postgresql</a></li>
<li><a class="reference internal" href="#change-2.1.0b1-mysql">mysql</a></li>
<li><a class="reference internal" href="#change-2.1.0b1-mariadb">mariadb</a></li>
<li><a class="reference internal" href="#change-2.1.0b1-sqlite">sqlite</a></li>
<li><a class="reference internal" href="#change-2.1.0b1-mssql">mssql</a></li>
<li><a class="reference internal" href="#change-2.1.0b1-oracle">oracle</a></li>
<li><a class="reference internal" href="#change-2.1.0b1-tests">tests</a></li>
<li><a class="reference internal" href="#change-2.1.0b1-misc">misc</a></li>
</ul>
</li>
</ul>
</li>
</ul>


            </ul>

        </div>



    <div id="docs-body" role="main" class="withsidebar changelog-changelog_21" >
        
<section id="changelog">
<h1>2.1 Changelog<a class="headerlink" href="#changelog" title="Link to this heading">¶</a></h1>
<section id="change-2.1.0b1">
<h2 class="release-version">2.1.0b1<a class="headerlink" href="#change-2.1.0b1" title="Link to this heading">¶</a></h2>
Released: January 21, 2026<section id="change-2.1.0b1-platform">
<h3>platform<a class="headerlink" href="#change-2.1.0b1-platform" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.1.0b1-0"><span class="target" id="change-1ac07ae4b6dd658922c9fd55fa9bc971"><strong>[platform] [feature]</strong> <a class="changelog-reference headerlink reference internal" href="#change-1ac07ae4b6dd658922c9fd55fa9bc971">¶</a></span><p>Free-threaded Python versions are now supported in wheels released on Pypi.
This integrates with overall free-threaded support added as part of
<a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/12881">#12881</a> for the 2.0 and 2.1 series, which includes new test suites
as well as a few improvements to race conditions observed under
freethreading.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/12881">#12881</a></p>
</p>
</li>
<li><p class="caption" id="change-2.1.0b1-1"><span class="target" id="change-6b4efde26419ca4f278e06deb110086c"><strong>[platform] [change]</strong> <a class="changelog-reference headerlink reference internal" href="#change-6b4efde26419ca4f278e06deb110086c">¶</a></span><p>The <code class="docutils literal notranslate"><span class="pre">greenlet</span></code> dependency used for asyncio support no longer installs
by default.  This dependency does not publish wheel files for every architecture
and is not needed for applications that aren’t using asyncio features.
Use the <code class="docutils literal notranslate"><span class="pre">sqlalchemy[asyncio]</span></code> install target to include this dependency.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="migration_21.html#change-10197"><span class="std std-ref">Asyncio “greenlet” dependency no longer installs by default</span></a></p>
</div>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/10197">#10197</a></p>
</p>
</li>
<li><p class="caption" id="change-2.1.0b1-2"><span class="target" id="change-6d6c6392a39e2865ab3faae482b23ecc"><strong>[platform] [change]</strong> <a class="changelog-reference headerlink reference internal" href="#change-6d6c6392a39e2865ab3faae482b23ecc">¶</a></span><p>Updated the setup manifest definition to use PEP 621-compliant
pyproject.toml. Also updated the extra install dependency to comply with
PEP-685. Thanks for the help of Matt Oberle and KOLANICH on this change.</p>
<p></p>
</p>
</li>
<li><p class="caption" id="change-2.1.0b1-3"><span class="target" id="change-7a1eae71a14f375fba2fac3feadc3ab4"><strong>[platform] [change]</strong> <a class="changelog-reference headerlink reference internal" href="#change-7a1eae71a14f375fba2fac3feadc3ab4">¶</a></span><p>Python 3.10 or above is now required; support for Python 3.9, 3.8 and 3.7
is dropped as these versions are EOL.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/10357">#10357</a>, <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/12029">#12029</a>, <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/12819">#12819</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.1.0b1-orm">
<h3>orm<a class="headerlink" href="#change-2.1.0b1-orm" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.1.0b1-4"><span class="target" id="change-dfd82854336e6a97732fff1b294d05c8"><strong>[orm] [feature]</strong> <a class="changelog-reference headerlink reference internal" href="#change-dfd82854336e6a97732fff1b294d05c8">¶</a></span><p>The <a class="reference internal" href="../orm/relationship_api.html#sqlalchemy.orm.relationship.params.back_populates" title="sqlalchemy.orm.relationship"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">relationship.back_populates</span></code></a> argument to
<a class="reference internal" href="../orm/relationship_api.html#sqlalchemy.orm.relationship" title="sqlalchemy.orm.relationship"><code class="xref py py-func docutils literal notranslate"><span class="pre">relationship()</span></code></a> may now be passed as a Python callable, which
resolves to either the direct linked ORM attribute, or a string value as
before.  ORM attributes are also accepted directly by
<a class="reference internal" href="../orm/relationship_api.html#sqlalchemy.orm.relationship.params.back_populates" title="sqlalchemy.orm.relationship"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">relationship.back_populates</span></code></a>.   This change allows type
checkers and IDEs to confirm the argument for
<a class="reference internal" href="../orm/relationship_api.html#sqlalchemy.orm.relationship.params.back_populates" title="sqlalchemy.orm.relationship"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">relationship.back_populates</span></code></a> is valid. Thanks to Priyanshu
Parikh for the help on suggesting and helping to implement this feature.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="migration_21.html#change-10050"><span class="std std-ref">ORM Relationship allows callable for back_populates</span></a></p>
</div>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/10050">#10050</a></p>
</p>
</li>
<li><p class="caption" id="change-2.1.0b1-5"><span class="target" id="change-ddf40287c68ee9bbc40003a1e32b4ce7"><strong>[orm] [feature]</strong> <a class="changelog-reference headerlink reference internal" href="#change-ddf40287c68ee9bbc40003a1e32b4ce7">¶</a></span><p>Added new hybrid method <a class="reference internal" href="../orm/extensions/hybrid.html#sqlalchemy.ext.hybrid.hybrid_property.bulk_dml" title="sqlalchemy.ext.hybrid.hybrid_property.bulk_dml"><code class="xref py py-meth docutils literal notranslate"><span class="pre">hybrid_property.bulk_dml()</span></code></a> which
works in a similar way as <a class="reference internal" href="../orm/extensions/hybrid.html#sqlalchemy.ext.hybrid.hybrid_property.update_expression" title="sqlalchemy.ext.hybrid.hybrid_property.update_expression"><code class="xref py py-meth docutils literal notranslate"><span class="pre">hybrid_property.update_expression()</span></code></a> for
bulk ORM operations.  A user-defined class method can now populate a bulk
insert mapping dictionary using the desired hybrid mechanics.   New
documentation is added showing how both of these methods can be used
including in combination with the new <a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.from_dml_column" title="sqlalchemy.sql.expression.from_dml_column"><code class="xref py py-func docutils literal notranslate"><span class="pre">from_dml_column()</span></code></a>
construct.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="migration_21.html#change-12496"><span class="std std-ref">New Hybrid DML hook features</span></a></p>
</div>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/12496">#12496</a></p>
</p>
</li>
<li><p class="caption" id="change-2.1.0b1-6"><span class="target" id="change-8897d88e0bb3b3e8596723461f48cacd"><strong>[orm] [feature]</strong> <a class="changelog-reference headerlink reference internal" href="#change-8897d88e0bb3b3e8596723461f48cacd">¶</a></span><p>Added new parameter <a class="reference internal" href="../orm/composites.html#sqlalchemy.orm.composite.params.return_none_on" title="sqlalchemy.orm.composite"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">composite.return_none_on</span></code></a> to
<a class="reference internal" href="../orm/composites.html#sqlalchemy.orm.composite" title="sqlalchemy.orm.composite"><code class="xref py py-func docutils literal notranslate"><span class="pre">composite()</span></code></a>, which allows control over if and when this
composite attribute should resolve to <code class="docutils literal notranslate"><span class="pre">None</span></code> when queried or retrieved
from the object directly.  By default, a composite object is always present
on the attribute, including for a pending object which is a behavioral
change since 2.0.   When <a class="reference internal" href="../orm/composites.html#sqlalchemy.orm.composite.params.return_none_on" title="sqlalchemy.orm.composite"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">composite.return_none_on</span></code></a> is
specified, a callable is passed that returns True or False to indicate if
the given arguments indicate the composite should be returned as None. This
parameter may also be set automatically when ORM Annotated Declarative is
used; if the annotation is given as <code class="docutils literal notranslate"><span class="pre">Mapped[SomeClass|None]</span></code>, a
<a class="reference internal" href="../orm/composites.html#sqlalchemy.orm.composite.params.return_none_on" title="sqlalchemy.orm.composite"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">composite.return_none_on</span></code></a> rule is applied that will return
<code class="docutils literal notranslate"><span class="pre">None</span></code> if all contained columns are themselves <code class="docutils literal notranslate"><span class="pre">None</span></code>.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="migration_21.html#change-12570"><span class="std std-ref">New rules for None-return for ORM Composites</span></a></p>
</div>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/12570">#12570</a></p>
</p>
</li>
<li><p class="caption" id="change-2.1.0b1-7"><span class="target" id="change-bd83117a72bedefdba394df7065051c0"><strong>[orm] [feature]</strong> <a class="changelog-reference headerlink reference internal" href="#change-bd83117a72bedefdba394df7065051c0">¶</a></span><p>Added support for per-session execution options that are merged into all
queries executed within that session. The <a class="reference internal" href="../orm/session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></a>,
<a class="reference internal" href="../orm/session_api.html#sqlalchemy.orm.sessionmaker" title="sqlalchemy.orm.sessionmaker"><code class="xref py py-class docutils literal notranslate"><span class="pre">sessionmaker</span></code></a>, <a class="reference internal" href="../orm/contextual.html#sqlalchemy.orm.scoped_session" title="sqlalchemy.orm.scoped_session"><code class="xref py py-class docutils literal notranslate"><span class="pre">scoped_session</span></code></a>,
<code class="xref py py-class docutils literal notranslate"><span class="pre">_ext.asyncio.AsyncSession</span></code>, and
<code class="xref py py-class docutils literal notranslate"><span class="pre">_ext.asyncio.async_sessionmaker</span></code> constructors now accept an
<a class="reference internal" href="../orm/session_api.html#sqlalchemy.orm.Session.params.execution_options" title="sqlalchemy.orm.Session"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Session.execution_options</span></code></a> parameter that will be applied
to all explicit query executions (e.g. using <a class="reference internal" href="../orm/session_api.html#sqlalchemy.orm.Session.execute" title="sqlalchemy.orm.Session.execute"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.execute()</span></code></a>,
<a class="reference internal" href="../orm/session_api.html#sqlalchemy.orm.Session.get" title="sqlalchemy.orm.Session.get"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.get()</span></code></a>, <a class="reference internal" href="../orm/session_api.html#sqlalchemy.orm.Session.scalars" title="sqlalchemy.orm.Session.scalars"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.scalars()</span></code></a>) for that session
instance.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/12659">#12659</a></p>
</p>
</li>
<li><p class="caption" id="change-2.1.0b1-8"><span class="target" id="change-b14ed1dd6f3e8dda7a25919d6450460c"><strong>[orm] [feature]</strong> <a class="changelog-reference headerlink reference internal" href="#change-b14ed1dd6f3e8dda7a25919d6450460c">¶</a></span><p>Session autoflush behavior has been simplified to unconditionally flush the
session each time an execution takes place, regardless of whether an ORM
statement or Core statement is being executed. This change eliminates the
previous conditional logic that only flushed when ORM-related statements
were detected, which had become difficult to define clearly with the unified
v2 syntax that allows both Core and ORM execution patterns. The change
provides more consistent and predictable session behavior across all types
of SQL execution.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="migration_21.html#change-9809"><span class="std std-ref">Session autoflush behavior simplified to be unconditional</span></a></p>
</div>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9809">#9809</a></p>
</p>
</li>
<li><p class="caption" id="change-2.1.0b1-9"><span class="target" id="change-9635a0c8de8011c550853befbcc780dc"><strong>[orm] [feature]</strong> <a class="changelog-reference headerlink reference internal" href="#change-9635a0c8de8011c550853befbcc780dc">¶</a></span><p>Added <a class="reference internal" href="../orm/events.html#sqlalchemy.orm.RegistryEvents" title="sqlalchemy.orm.RegistryEvents"><code class="xref py py-class docutils literal notranslate"><span class="pre">RegistryEvents</span></code></a> event class that allows event listeners
to be established on a <a class="reference internal" href="../orm/mapping_api.html#sqlalchemy.orm.registry" title="sqlalchemy.orm.registry"><code class="xref py py-class docutils literal notranslate"><span class="pre">registry</span></code></a> object. The new class
provides three events: <a class="reference internal" href="../orm/events.html#sqlalchemy.orm.RegistryEvents.resolve_type_annotation" title="sqlalchemy.orm.RegistryEvents.resolve_type_annotation"><code class="xref py py-meth docutils literal notranslate"><span class="pre">RegistryEvents.resolve_type_annotation()</span></code></a>
which allows customization of type annotation resolution that can
supplement or replace the use of the
<a class="reference internal" href="../orm/mapping_api.html#sqlalchemy.orm.registry.params.type_annotation_map" title="sqlalchemy.orm.registry"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">registry.type_annotation_map</span></code></a> dictionary, including that it can
be helpful with custom resolution for complex types such as those of
<span class="target" id="index-4"></span><a class="pep reference external" href="https://peps.python.org/pep-0695/"><strong>PEP 695</strong></a>, as well as <a class="reference internal" href="../orm/events.html#sqlalchemy.orm.RegistryEvents.before_configured" title="sqlalchemy.orm.RegistryEvents.before_configured"><code class="xref py py-meth docutils literal notranslate"><span class="pre">RegistryEvents.before_configured()</span></code></a> and
<a class="reference internal" href="../orm/events.html#sqlalchemy.orm.RegistryEvents.after_configured" title="sqlalchemy.orm.RegistryEvents.after_configured"><code class="xref py py-meth docutils literal notranslate"><span class="pre">RegistryEvents.after_configured()</span></code></a>, which are registry-local
forms of the mapper-wide version of these hooks.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="migration_21.html#change-9832"><span class="std std-ref">New RegistryEvents System for ORM Mapping Customization</span></a></p>
</div>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9832">#9832</a></p>
</p>
</li>
<li><p class="caption" id="change-2.1.0b1-10"><span class="target" id="change-a51f1c5ea542ada891115f5e4f8f8b63"><strong>[orm] [usecase]</strong> <a class="changelog-reference headerlink reference internal" href="#change-a51f1c5ea542ada891115f5e4f8f8b63">¶</a></span><p>The <a class="reference internal" href="../orm/session_api.html#sqlalchemy.orm.Session.flush.params.objects" title="sqlalchemy.orm.Session.flush"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Session.flush.objects</span></code></a> parameter is now
deprecated.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/10816">#10816</a></p>
</p>
</li>
<li><p class="caption" id="change-2.1.0b1-11"><span class="target" id="change-3cc4f54cdac688f3ea756de4253bbb9f"><strong>[orm] [usecase]</strong> <a class="changelog-reference headerlink reference internal" href="#change-3cc4f54cdac688f3ea756de4253bbb9f">¶</a></span><p>Added the utility method <a class="reference internal" href="../orm/session_api.html#sqlalchemy.orm.Session.merge_all" title="sqlalchemy.orm.Session.merge_all"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.merge_all()</span></code></a> and
<a class="reference internal" href="../orm/session_api.html#sqlalchemy.orm.Session.delete_all" title="sqlalchemy.orm.Session.delete_all"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.delete_all()</span></code></a> that operate on a collection
of instances.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/11776">#11776</a></p>
</p>
</li>
<li><p class="caption" id="change-2.1.0b1-12"><span class="target" id="change-6336e9c943f9ca97b7ceadf541de0481"><strong>[orm] [usecase]</strong> <a class="changelog-reference headerlink reference internal" href="#change-6336e9c943f9ca97b7ceadf541de0481">¶</a></span><p>Added support for using <a class="reference internal" href="../orm/queryguide/columns.html#sqlalchemy.orm.with_expression" title="sqlalchemy.orm.with_expression"><code class="xref py py-func docutils literal notranslate"><span class="pre">with_expression()</span></code></a> to populate a
<a class="reference internal" href="../orm/queryguide/columns.html#sqlalchemy.orm.query_expression" title="sqlalchemy.orm.query_expression"><code class="xref py py-func docutils literal notranslate"><span class="pre">query_expression()</span></code></a> attribute that is also configured as the
<code class="docutils literal notranslate"><span class="pre">polymorphic_on</span></code> discriminator column. The ORM now detects when a query
expression column is serving as the polymorphic discriminator and updates
it to use the column provided via <a class="reference internal" href="../orm/queryguide/columns.html#sqlalchemy.orm.with_expression" title="sqlalchemy.orm.with_expression"><code class="xref py py-func docutils literal notranslate"><span class="pre">with_expression()</span></code></a>, enabling
polymorphic loading to work correctly in this scenario. This allows for
patterns such as where the discriminator value is computed from a related
table.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/12631">#12631</a></p>
</p>
</li>
<li><p class="caption" id="change-2.1.0b1-13"><span class="target" id="change-c15819a42d1676eb4d8fc1a66f517cb0"><strong>[orm] [usecase]</strong> <a class="changelog-reference headerlink reference internal" href="#change-c15819a42d1676eb4d8fc1a66f517cb0">¶</a></span><p>Added default implementations of <a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.ColumnOperators.desc" title="sqlalchemy.sql.expression.ColumnOperators.desc"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ColumnOperators.desc()</span></code></a>,
<a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.ColumnOperators.asc" title="sqlalchemy.sql.expression.ColumnOperators.asc"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ColumnOperators.asc()</span></code></a>, <a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.ColumnOperators.nulls_first" title="sqlalchemy.sql.expression.ColumnOperators.nulls_first"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ColumnOperators.nulls_first()</span></code></a>,
<a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.ColumnOperators.nulls_last" title="sqlalchemy.sql.expression.ColumnOperators.nulls_last"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ColumnOperators.nulls_last()</span></code></a> to <a class="reference internal" href="../orm/composites.html#sqlalchemy.orm.composite" title="sqlalchemy.orm.composite"><code class="xref py py-func docutils literal notranslate"><span class="pre">composite()</span></code></a> attributes,
by default applying the modifier to all contained columns.  Can be
overridden using a custom comparator.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/12769">#12769</a></p>
</p>
</li>
<li><p class="caption" id="change-2.1.0b1-14"><span class="target" id="change-eaed59cceabbafea734ce5070c0f9cdc"><strong>[orm] [usecase]</strong> <a class="changelog-reference headerlink reference internal" href="#change-eaed59cceabbafea734ce5070c0f9cdc">¶</a></span><p>The <a class="reference internal" href="../orm/queryguide/api.html#sqlalchemy.orm.aliased" title="sqlalchemy.orm.aliased"><code class="xref py py-func docutils literal notranslate"><span class="pre">aliased()</span></code></a> object now emits warnings when an attribute is
accessed on an aliased class that cannot be located in the target
selectable, for those cases where the <a class="reference internal" href="../orm/queryguide/api.html#sqlalchemy.orm.aliased" title="sqlalchemy.orm.aliased"><code class="xref py py-func docutils literal notranslate"><span class="pre">aliased()</span></code></a> is against a
different FROM clause than the regular mapped table (such as a subquery).
This helps users identify cases where column names don’t match between the
aliased class and the underlying selectable. When
<a class="reference internal" href="../orm/queryguide/api.html#sqlalchemy.orm.aliased.params.adapt_on_names" title="sqlalchemy.orm.aliased"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">aliased.adapt_on_names</span></code></a> is <code class="docutils literal notranslate"><span class="pre">True</span></code>, the warning suggests
checking the column name; when <code class="docutils literal notranslate"><span class="pre">False</span></code>, it suggests using the
<code class="docutils literal notranslate"><span class="pre">adapt_on_names</span></code> parameter for name-based matching.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/12838">#12838</a></p>
</p>
</li>
<li><p class="caption" id="change-2.1.0b1-15"><span class="target" id="change-acea8f41a68d172f7b99a57719e7c59a"><strong>[orm] [usecase]</strong> <a class="changelog-reference headerlink reference internal" href="#change-acea8f41a68d172f7b99a57719e7c59a">¶</a></span><p>Improvements to the use case of using <a class="reference internal" href="../orm/dataclasses.html#orm-declarative-native-dataclasses"><span class="std std-ref">Declarative Dataclass Mapping</span></a> with intermediary classes that are
unmapped.   As was the existing behavior, classes can subclass
<a class="reference internal" href="../orm/mapping_api.html#sqlalchemy.orm.MappedAsDataclass" title="sqlalchemy.orm.MappedAsDataclass"><code class="xref py py-class docutils literal notranslate"><span class="pre">MappedAsDataclass</span></code></a> alone without a declarative base to act as
mixins, or along with a declarative base as well as <code class="docutils literal notranslate"><span class="pre">__abstract__</span> <span class="pre">=</span> <span class="pre">True</span></code>
to define an abstract base.  However, the improved behavior scans ORM
attributes like <a class="reference internal" href="../orm/mapping_api.html#sqlalchemy.orm.mapped_column" title="sqlalchemy.orm.mapped_column"><code class="xref py py-func docutils literal notranslate"><span class="pre">mapped_column()</span></code></a> in this case to create correct
<code class="docutils literal notranslate"><span class="pre">dataclasses.field()</span></code> constructs based on their arguments, allowing for
more natural ordering of fields without dataclass errors being thrown.
Additionally, added a new <a class="reference internal" href="../orm/mapping_api.html#sqlalchemy.orm.unmapped_dataclass" title="sqlalchemy.orm.unmapped_dataclass"><code class="xref py py-func docutils literal notranslate"><span class="pre">unmapped_dataclass()</span></code></a> decorator
function, which may be used to create unmapped mixins in a mapped hierarchy
that is using the <code class="xref py py-func docutils literal notranslate"><span class="pre">mapped_dataclass()</span></code> decorator to create mapped
dataclasses.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="../orm/dataclasses.html#orm-declarative-dc-mixins"><span class="std std-ref">Using mixins and abstract superclasses</span></a></p>
</div>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/12854">#12854</a></p>
</p>
</li>
<li><p class="caption" id="change-2.1.0b1-16"><span class="target" id="change-6e94c50b3c36471e9baf15928707d5b1"><strong>[orm] [usecase]</strong> <a class="changelog-reference headerlink reference internal" href="#change-6e94c50b3c36471e9baf15928707d5b1">¶</a></span><p>Added <a class="reference internal" href="../orm/queryguide/api.html#sqlalchemy.orm.DictBundle" title="sqlalchemy.orm.DictBundle"><code class="xref py py-class docutils literal notranslate"><span class="pre">DictBundle</span></code></a> as a subclass of <a class="reference internal" href="../orm/queryguide/api.html#sqlalchemy.orm.Bundle" title="sqlalchemy.orm.Bundle"><code class="xref py py-class docutils literal notranslate"><span class="pre">Bundle</span></code></a>
that returns <code class="docutils literal notranslate"><span class="pre">dict</span></code> objects.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/12960">#12960</a></p>
</p>
</li>
<li><p class="caption" id="change-2.1.0b1-17"><span class="target" id="change-9f111f3062f198dfede2adc9f49f75a6"><strong>[orm] [change]</strong> <a class="changelog-reference headerlink reference internal" href="#change-9f111f3062f198dfede2adc9f49f75a6">¶</a></span><p>A sweep through class and function names in the ORM renames many classes
and functions that have no intent of public visibility to be underscored.
This is to reduce ambiguity as to which APIs are intended to be targeted by
third party applications and extensions.  Third parties are encouraged to
propose new public APIs in Discussions to the extent they are needed to
replace those that have been clarified as private.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/10497">#10497</a></p>
</p>
</li>
<li><p class="caption" id="change-2.1.0b1-18"><span class="target" id="change-125e138071dc56c152a07e536ae7fe37"><strong>[orm] [change]</strong> <a class="changelog-reference headerlink reference internal" href="#change-125e138071dc56c152a07e536ae7fe37">¶</a></span><p>The <code class="docutils literal notranslate"><span class="pre">first_init</span></code> ORM event has been removed.  This event was
non-functional throughout the 1.4 and 2.0 series and could not be invoked
without raising an internal error, so it is not expected that there is any
real-world use of this event hook.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/10500">#10500</a></p>
</p>
</li>
<li><p class="caption" id="change-2.1.0b1-19"><span class="target" id="change-318c6ab764fb45ab54732b96ac5f15e5"><strong>[orm] [change]</strong> <a class="changelog-reference headerlink reference internal" href="#change-318c6ab764fb45ab54732b96ac5f15e5">¶</a></span><p>Removed legacy signatures dating back to 0.9 release from the
<a class="reference internal" href="../orm/events.html#sqlalchemy.orm.SessionEvents.after_bulk_update" title="sqlalchemy.orm.SessionEvents.after_bulk_update"><code class="xref py py-meth docutils literal notranslate"><span class="pre">SessionEvents.after_bulk_update()</span></code></a> and
<a class="reference internal" href="../orm/events.html#sqlalchemy.orm.SessionEvents.after_bulk_delete" title="sqlalchemy.orm.SessionEvents.after_bulk_delete"><code class="xref py py-meth docutils literal notranslate"><span class="pre">SessionEvents.after_bulk_delete()</span></code></a>.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/10721">#10721</a></p>
</p>
</li>
<li><p class="caption" id="change-2.1.0b1-20"><span class="target" id="change-be48c720fe425155b897f8542c9aea44"><strong>[orm] [changed]</strong> <a class="changelog-reference headerlink reference internal" href="#change-be48c720fe425155b897f8542c9aea44">¶</a></span><p>The “non primary” mapper feature, long deprecated in SQLAlchemy since
version 1.3, has been removed.   The sole use case for “non primary”
mappers was that of using <a class="reference internal" href="../orm/relationship_api.html#sqlalchemy.orm.relationship" title="sqlalchemy.orm.relationship"><code class="xref py py-func docutils literal notranslate"><span class="pre">relationship()</span></code></a> to link to a mapped
class against an alternative selectable; this use case is now suited by the
<a class="reference internal" href="../orm/join_conditions.html#relationship-aliased-class"><span class="std std-ref">Relationship to Aliased Class</span></a> feature.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/12437">#12437</a></p>
</p>
</li>
<li><p class="caption" id="change-2.1.0b1-21"><span class="target" id="change-e37eff2c86324e023dba36bd711a6394"><strong>[orm] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-e37eff2c86324e023dba36bd711a6394">¶</a></span><p>The <a class="reference internal" href="../orm/relationship_api.html#sqlalchemy.orm.relationship.params.secondary" title="sqlalchemy.orm.relationship"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">relationship.secondary</span></code></a> parameter no longer uses Python
<code class="docutils literal notranslate"><span class="pre">eval()</span></code> to evaluate the given string.   This parameter when passed a
string should resolve to a table name that’s present in the local
<a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.MetaData" title="sqlalchemy.schema.MetaData"><code class="xref py py-class docutils literal notranslate"><span class="pre">MetaData</span></code></a> collection only, and never needs to be any kind of
Python expression otherwise.  To use a real deferred callable based on a
name that may not be locally present yet, use a lambda instead.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/10564">#10564</a></p>
</p>
</li>
<li><p class="caption" id="change-2.1.0b1-22"><span class="target" id="change-947ade1ce39e8b61fbd187915faa1ed2"><strong>[orm] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-947ade1ce39e8b61fbd187915faa1ed2">¶</a></span><p>Fixed issue where joined eager loading would fail to use the “nested” form
of the query when GROUP BY or DISTINCT were present if the eager joins
being added were many-to-ones, leading to additional columns in the columns
clause which would then cause errors.  The check for “nested” is tuned to
be enabled for these queries even for many-to-one joined eager loaders, and
the “only do nested if it’s one to many” aspect is now localized to when
the query only has LIMIT or OFFSET added.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/11226">#11226</a></p>
</p>
</li>
<li><p class="caption" id="change-2.1.0b1-23"><span class="target" id="change-1b1c28ceb8ef7e096c67f199d27ce895"><strong>[orm] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-1b1c28ceb8ef7e096c67f199d27ce895">¶</a></span><p>Revised the set “binary” operators for the association proxy <code class="docutils literal notranslate"><span class="pre">set()</span></code>
interface to correctly raise <code class="docutils literal notranslate"><span class="pre">TypeError</span></code> for invalid use of the <code class="docutils literal notranslate"><span class="pre">|</span></code>,
<code class="docutils literal notranslate"><span class="pre">&amp;</span></code>, <code class="docutils literal notranslate"><span class="pre">^</span></code>, and <code class="docutils literal notranslate"><span class="pre">-</span></code> operators, as well as the in-place mutation
versions of these methods, to match the behavior of standard Python
<code class="docutils literal notranslate"><span class="pre">set()</span></code> as well as SQLAlchemy ORM’s “instrumented” set implementation.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/11349">#11349</a></p>
</p>
</li>
<li><p class="caption" id="change-2.1.0b1-24"><span class="target" id="change-bf06bab8c4ab8c10de75a7ce2798a05b"><strong>[orm] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-bf06bab8c4ab8c10de75a7ce2798a05b">¶</a></span><p>A significant behavioral change has been made to the behavior of the
<a class="reference internal" href="../orm/mapping_api.html#sqlalchemy.orm.mapped_column.params.default" title="sqlalchemy.orm.mapped_column"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">mapped_column.default</span></code></a> and
<a class="reference internal" href="../orm/relationship_api.html#sqlalchemy.orm.relationship.params.default" title="sqlalchemy.orm.relationship"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">relationship.default</span></code></a> parameters, as well as the
<a class="reference internal" href="../orm/relationship_api.html#sqlalchemy.orm.relationship.params.default_factory" title="sqlalchemy.orm.relationship"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">relationship.default_factory</span></code></a> parameter with
collection-based relationships, when used with SQLAlchemy’s
<a class="reference internal" href="../orm/dataclasses.html#orm-declarative-native-dataclasses"><span class="std std-ref">Declarative Dataclass Mapping</span></a> feature introduced in 2.0, where
the given value (assumed to be an immutable scalar value for
<a class="reference internal" href="../orm/mapping_api.html#sqlalchemy.orm.mapped_column.params.default" title="sqlalchemy.orm.mapped_column"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">mapped_column.default</span></code></a> and a simple collection class for
<a class="reference internal" href="../orm/relationship_api.html#sqlalchemy.orm.relationship.params.default_factory" title="sqlalchemy.orm.relationship"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">relationship.default_factory</span></code></a>) is no longer passed to the
<code class="docutils literal notranslate"><span class="pre">&#64;dataclass</span></code> API as a real default, instead a token that leaves the value
un-set in the object’s <code class="docutils literal notranslate"><span class="pre">__dict__</span></code> is used, in conjunction with a
descriptor-level default.  This prevents an un-set default value from
overriding a default that was actually set elsewhere, such as in
relationship / foreign key assignment patterns as well as in
<a class="reference internal" href="../orm/session_api.html#sqlalchemy.orm.Session.merge" title="sqlalchemy.orm.Session.merge"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.merge()</span></code></a> scenarios.   See the full writeup in the
<a class="reference internal" href="migration_21.html"><span class="std std-ref">What’s New in SQLAlchemy 2.1?</span></a> document which includes guidance on how to
re-enable the 2.0 version of the behavior if needed.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="migration_21.html#change-12168"><span class="std std-ref">ORM Mapped Dataclasses no longer populate implicit default, collection-based default_factory in __dict__</span></a></p>
</div>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/12168">#12168</a></p>
</p>
</li>
<li><p class="caption" id="change-2.1.0b1-25"><span class="target" id="change-4a02c20d7e6d3f6ddf81f1dd00c5679b"><strong>[orm] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-4a02c20d7e6d3f6ddf81f1dd00c5679b">¶</a></span><p>The behavior of <a class="reference internal" href="../orm/queryguide/inheritance.html#sqlalchemy.orm.with_polymorphic" title="sqlalchemy.orm.with_polymorphic"><code class="xref py py-func docutils literal notranslate"><span class="pre">with_polymorphic()</span></code></a> when used with a single
inheritance mapping has been changed such that its behavior should match as
closely as possible to that of an equivalent joined inheritance mapping.
Specifically this means that the base class specified in the
<a class="reference internal" href="../orm/queryguide/inheritance.html#sqlalchemy.orm.with_polymorphic" title="sqlalchemy.orm.with_polymorphic"><code class="xref py py-func docutils literal notranslate"><span class="pre">with_polymorphic()</span></code></a> construct will be the basemost class that is
loaded, as well as all descendant classes of that basemost class.
The change includes that the descendant classes named will no longer be
exclusively indicated in “WHERE polymorphic_col IN” criteria; instead, the
whole hierarchy starting with the given basemost class will be loaded.  If
the query indicates that rows should only be instances of a specific
subclass within the polymorphic hierarchy, an error is raised if an
incompatible superclass is loaded in the result since it cannot be made to
match the requested class; this behavior is the same as what joined
inheritance has done for many years. The change also allows a single result
set to include column-level results from multiple sibling classes at once
which was not previously possible with single table inheritance.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/12395">#12395</a></p>
</p>
</li>
<li><p class="caption" id="change-2.1.0b1-26"><span class="target" id="change-04e458b01e4c78e66e6e9f56d8d9ba92"><strong>[orm] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-04e458b01e4c78e66e6e9f56d8d9ba92">¶</a></span><p>Improved the behavior of standalone “operators” like <a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.desc" title="sqlalchemy.sql.expression.desc"><code class="xref py py-func docutils literal notranslate"><span class="pre">desc()</span></code></a>,
<a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.asc" title="sqlalchemy.sql.expression.asc"><code class="xref py py-func docutils literal notranslate"><span class="pre">asc()</span></code></a>, <a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.all_" title="sqlalchemy.sql.expression.all_"><code class="xref py py-func docutils literal notranslate"><span class="pre">all_()</span></code></a>, etc. so that they consult the given
expression object for an overriding method for that operator, even if the
object is not itself a <code class="docutils literal notranslate"><span class="pre">ClauseElement</span></code>, such as if it’s an ORM attribute.
This allows custom comparators for things like <a class="reference internal" href="../orm/composites.html#sqlalchemy.orm.composite" title="sqlalchemy.orm.composite"><code class="xref py py-func docutils literal notranslate"><span class="pre">composite()</span></code></a> to
provide custom implementations of methods like <code class="docutils literal notranslate"><span class="pre">desc()</span></code>, <code class="docutils literal notranslate"><span class="pre">asc()</span></code>, etc.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/12769">#12769</a></p>
</p>
</li>
<li><p class="caption" id="change-2.1.0b1-27"><span class="target" id="change-57a0dd629c6d4d31a318c2d02d7a4917"><strong>[orm] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-57a0dd629c6d4d31a318c2d02d7a4917">¶</a></span><p>ORM entities can now be involved within the SQL expressions used within
<a class="reference internal" href="../orm/relationship_api.html#sqlalchemy.orm.relationship.params.primaryjoin" title="sqlalchemy.orm.relationship"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">relationship.primaryjoin</span></code></a> and
<a class="reference internal" href="../orm/relationship_api.html#sqlalchemy.orm.relationship.params.secondaryjoin" title="sqlalchemy.orm.relationship"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">relationship.secondaryjoin</span></code></a> parameters without the ORM
entity information being implicitly sanitized, allowing ORM-specific
features such as single-inheritance criteria in subqueries to continue
working even when used in this context.   This is made possible by overall
ORM simplifications that occurred as of the 2.0 series.  The changes here
also provide a performance boost (up to 20%) for certain query compilation
scenarios.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/12843">#12843</a></p>
</p>
</li>
<li><p class="caption" id="change-2.1.0b1-28"><span class="target" id="change-ebd891706cc47beb67aa0dc7e66707f1"><strong>[orm] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-ebd891706cc47beb67aa0dc7e66707f1">¶</a></span><p>The <code class="xref py py-meth docutils literal notranslate"><span class="pre">SessionEvents.do_orm_execute()</span></code> event now allows direct
mutation or replacement of the <a class="reference internal" href="../orm/session_api.html#sqlalchemy.orm.ORMExecuteState.parameters" title="sqlalchemy.orm.ORMExecuteState.parameters"><code class="xref py py-attr docutils literal notranslate"><span class="pre">ORMExecuteState.parameters</span></code></a>
dictionary or list, which will take effect when the the statement is
executed.  Previously, changes to this collection were not accommodated by
the event hook.  Pull request courtesy Shamil.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/12921">#12921</a></p>
</p>
</li>
<li><p class="caption" id="change-2.1.0b1-29"><span class="target" id="change-59bc7a8ce3967d35bb6acee77ddba5e1"><strong>[orm] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-59bc7a8ce3967d35bb6acee77ddba5e1">¶</a></span><p>A change in the mechanics of how Python dataclasses are applied to classes
that use <a class="reference internal" href="../orm/mapping_api.html#sqlalchemy.orm.MappedAsDataclass" title="sqlalchemy.orm.MappedAsDataclass"><code class="xref py py-class docutils literal notranslate"><span class="pre">MappedAsDataclass</span></code></a> or
<a class="reference internal" href="../orm/mapping_api.html#sqlalchemy.orm.registry.mapped_as_dataclass" title="sqlalchemy.orm.registry.mapped_as_dataclass"><code class="xref py py-meth docutils literal notranslate"><span class="pre">registry.mapped_as_dataclass()</span></code></a> to apply <code class="docutils literal notranslate"><span class="pre">__annotations__</span></code> that are
as identical as is possible to the original <code class="docutils literal notranslate"><span class="pre">__annotations__</span></code> given,
while also adding attributes that SQLAlchemy considers to be part of
dataclass <code class="docutils literal notranslate"><span class="pre">__annotations__</span></code>, then restoring the previous annotations in
exactly the same format as they were, using patterns that work with
<span class="target" id="index-3"></span><a class="pep reference external" href="https://peps.python.org/pep-0649/"><strong>PEP 649</strong></a> as closely as possible.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/13021">#13021</a></p>
</p>
</li>
<li><p class="caption" id="change-2.1.0b1-30"><span class="target" id="change-0c3e4ea086a671d4df4aedab7a5e0abe"><strong>[orm] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-0c3e4ea086a671d4df4aedab7a5e0abe">¶</a></span><p>Removed the <code class="docutils literal notranslate"><span class="pre">ORDER</span> <span class="pre">BY</span></code> clause from queries generated by
<a class="reference internal" href="../orm/queryguide/inheritance.html#sqlalchemy.orm.selectin_polymorphic" title="sqlalchemy.orm.selectin_polymorphic"><code class="xref py py-func docutils literal notranslate"><span class="pre">selectin_polymorphic()</span></code></a> and the
<a class="reference internal" href="../orm/mapping_api.html#sqlalchemy.orm.Mapper.params.polymorphic_load" title="sqlalchemy.orm.Mapper"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Mapper.polymorphic_load</span></code></a> parameter set to <code class="docutils literal notranslate"><span class="pre">&quot;selectin&quot;</span></code>.
The <code class="docutils literal notranslate"><span class="pre">ORDER</span> <span class="pre">BY</span></code> clause appears to have been an unnecessary implementation
artifact.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/13060">#13060</a></p>
</p>
</li>
<li><p class="caption" id="change-2.1.0b1-31"><span class="target" id="change-68a548d98898035290122c80c2dbfcff"><strong>[orm] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-68a548d98898035290122c80c2dbfcff">¶</a></span><p>A significant change to the ORM mechanics involved with both
<a class="reference internal" href="../orm/queryguide/api.html#sqlalchemy.orm.with_loader_criteria" title="sqlalchemy.orm.with_loader_criteria"><code class="xref py py-func docutils literal notranslate"><span class="pre">with_loader_criteria()</span></code></a> as well as single table inheritance, to
more aggressively locate WHERE criteria which should be augmented by either
the custom criteria or single-table inheritance criteria; SELECT statements
that do not include the entity within the columns clause or as an explicit
FROM, but still reference the entity within the WHERE clause, are now
covered, in particular this will allow subqueries using <code class="docutils literal notranslate"><span class="pre">EXISTS</span> <span class="pre">(SELECT</span>
<span class="pre">1)</span></code> such as those rendered by <a class="reference internal" href="../orm/internals.html#sqlalchemy.orm.RelationshipProperty.Comparator.any" title="sqlalchemy.orm.RelationshipProperty.Comparator.any"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Comparator.any()</span></code></a>
and <a class="reference internal" href="../orm/internals.html#sqlalchemy.orm.RelationshipProperty.Comparator.has" title="sqlalchemy.orm.RelationshipProperty.Comparator.has"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Comparator.has()</span></code></a>.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/13070">#13070</a></p>
</p>
</li>
<li><p class="caption" id="change-2.1.0b1-32"><span class="target" id="change-0e9ce2cb93320bc5b49bfdbfba7481c6"><strong>[orm]</strong> <a class="changelog-reference headerlink reference internal" href="#change-0e9ce2cb93320bc5b49bfdbfba7481c6">¶</a></span><p>The <a class="reference internal" href="../orm/queryguide/relationships.html#sqlalchemy.orm.noload" title="sqlalchemy.orm.noload"><code class="xref py py-func docutils literal notranslate"><span class="pre">noload()</span></code></a> relationship loader option and related
<code class="docutils literal notranslate"><span class="pre">lazy='noload'</span></code> setting is deprecated and will be removed in a future
release.   This option was originally intended for custom loader patterns
that are no longer applicable in modern SQLAlchemy.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/11045">#11045</a></p>
</p>
</li>
<li><p class="caption" id="change-2.1.0b1-33"><span class="target" id="change-9684c4c6a30753efedaa9f84f4ef15a4"><strong>[orm]</strong> <a class="changelog-reference headerlink reference internal" href="#change-9684c4c6a30753efedaa9f84f4ef15a4">¶</a></span><p>Ignore <a class="reference internal" href="../orm/session_api.html#sqlalchemy.orm.Session.params.join_transaction_mode" title="sqlalchemy.orm.Session"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Session.join_transaction_mode</span></code></a> in all cases when
the bind provided to the <a class="reference internal" href="../orm/session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></a> is an
<a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Engine" title="sqlalchemy.engine.Engine"><code class="xref py py-class docutils literal notranslate"><span class="pre">Engine</span></code></a>.
Previously if an event that executed before the session logic,
like <code class="xref py py-meth docutils literal notranslate"><span class="pre">ConnectionEvents.engine_connect()</span></code>,
left the connection with an active transaction, the
<a class="reference internal" href="../orm/session_api.html#sqlalchemy.orm.Session.params.join_transaction_mode" title="sqlalchemy.orm.Session"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Session.join_transaction_mode</span></code></a> behavior took
place, leading to a surprising behavior.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/11163">#11163</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.1.0b1-engine">
<h3>engine<a class="headerlink" href="#change-2.1.0b1-engine" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.1.0b1-34"><span class="target" id="change-108bdcd295a2fa397a3e532d426bffc0"><strong>[engine] [usecase]</strong> <a class="changelog-reference headerlink reference internal" href="#change-108bdcd295a2fa397a3e532d426bffc0">¶</a></span><p>Added new execution option
<a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Connection.execution_options.params.driver_column_names" title="sqlalchemy.engine.Connection.execution_options"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Connection.execution_options.driver_column_names</span></code></a>. This
option disables the “name normalize” step that takes place against the
DBAPI <code class="docutils literal notranslate"><span class="pre">cursor.description</span></code> for uppercase-default backends like Oracle,
and will cause the keys of a result set (e.g. named tuple names, dictionary
keys in <a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Row._mapping" title="sqlalchemy.engine.Row._mapping"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Row._mapping</span></code></a>, etc.) to be exactly what was delivered in
cursor.description.   This is mostly useful for plain textual statements
using <a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.text" title="sqlalchemy.sql.expression.text"><code class="xref py py-func docutils literal notranslate"><span class="pre">text()</span></code></a> or <a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Connection.exec_driver_sql" title="sqlalchemy.engine.Connection.exec_driver_sql"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Connection.exec_driver_sql()</span></code></a>.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/10789">#10789</a></p>
</p>
</li>
<li><p class="caption" id="change-2.1.0b1-35"><span class="target" id="change-f4c981bcd220be1b3c4a3b21b4207e84"><strong>[engine] [change]</strong> <a class="changelog-reference headerlink reference internal" href="#change-f4c981bcd220be1b3c4a3b21b4207e84">¶</a></span><p>An empty sequence passed to any <code class="docutils literal notranslate"><span class="pre">execute()</span></code> method now
raised a deprecation warning, since such an executemany
is invalid.
Pull request courtesy of Carlos Sousa.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/9647">#9647</a></p>
</p>
</li>
<li><p class="caption" id="change-2.1.0b1-36"><span class="target" id="change-a786e2b89a74997810ecef5ce39a40d6"><strong>[engine] [change]</strong> <a class="changelog-reference headerlink reference internal" href="#change-a786e2b89a74997810ecef5ce39a40d6">¶</a></span><p>The private method <code class="docutils literal notranslate"><span class="pre">Connection._execute_compiled</span></code> is removed.  This method may
have been used for some special purposes however the <a class="reference internal" href="../core/internals.html#sqlalchemy.sql.compiler.SQLCompiler" title="sqlalchemy.sql.compiler.SQLCompiler"><code class="xref py py-class docutils literal notranslate"><span class="pre">SQLCompiler</span></code></a>
object has lots of special state that should be set up for an execute call,
which we don’t support.</p>
<p></p>
</p>
</li>
<li><p class="caption" id="change-2.1.0b1-37"><span class="target" id="change-04110244b8d9ac7269ff1ce5cb46f316"><strong>[engine] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-04110244b8d9ac7269ff1ce5cb46f316">¶</a></span><p>Fixed issue in “insertmanyvalues” feature where an INSERT..RETURNING
that also made use of a sentinel column to track results would fail to
filter out the additional column when <a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Result.unique" title="sqlalchemy.engine.Result.unique"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.unique()</span></code></a> were used
to uniquify the result set.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/10802">#10802</a></p>
</p>
</li>
<li><p class="caption" id="change-2.1.0b1-38"><span class="target" id="change-bd948188af8857d9012575a88290744d"><strong>[engine] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-bd948188af8857d9012575a88290744d">¶</a></span><p>Adjusted URL parsing and stringification to apply url quoting to the
“database” portion of the URL.  This allows a URL where the “database”
portion includes special characters such as question marks to be
accommodated.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="migration_21.html#change-11234"><span class="std std-ref">URL stringify and parse now supports URL escaping for the “database” portion</span></a></p>
</div>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/11234">#11234</a></p>
</p>
</li>
<li><p class="caption" id="change-2.1.0b1-39"><span class="target" id="change-7f3af414beb8e086373d1c0f2483c2d0"><strong>[engine] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-7f3af414beb8e086373d1c0f2483c2d0">¶</a></span><p>Fixed issue in the <a class="reference internal" href="../core/events.html#sqlalchemy.events.ConnectionEvents.after_cursor_execute" title="sqlalchemy.events.ConnectionEvents.after_cursor_execute"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ConnectionEvents.after_cursor_execute()</span></code></a> method
where the SQL statement and parameter list for an “insertmanyvalues”
operation sent to the event would not be the actual SQL / parameters just
emitted on the cursor, instead being the non-batched form of the statement
that’s used as a template to generate the batched statements.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/13018">#13018</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.1.0b1-sql">
<h3>sql<a class="headerlink" href="#change-2.1.0b1-sql" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.1.0b1-40"><span class="target" id="change-0bf896628b29496e0a1452958f334395"><strong>[sql] [feature]</strong> <a class="changelog-reference headerlink reference internal" href="#change-0bf896628b29496e0a1452958f334395">¶</a></span><p>Added the ability to create custom SQL constructs that can define new
clauses within SELECT, INSERT, UPDATE, and DELETE statements without
needing to modify the construction or compilation code of of
<a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.Select" title="sqlalchemy.sql.expression.Select"><code class="xref py py-class docutils literal notranslate"><span class="pre">Select</span></code></a>, <a class="reference internal" href="../core/dml.html#sqlalchemy.sql.expression.Insert" title="sqlalchemy.sql.expression.Insert"><code class="xref py py-class docutils literal notranslate"><span class="pre">Insert</span></code></a>, <a class="reference internal" href="../core/dml.html#sqlalchemy.sql.expression.Update" title="sqlalchemy.sql.expression.Update"><code class="xref py py-class docutils literal notranslate"><span class="pre">Update</span></code></a>, or <a class="reference internal" href="../core/dml.html#sqlalchemy.sql.expression.Delete" title="sqlalchemy.sql.expression.Delete"><code class="xref py py-class docutils literal notranslate"><span class="pre">Delete</span></code></a>
directly.  Support for testing these constructs, including caching support,
is present along with an example test suite.  The use case for these
constructs is expected to be third party dialects for analytical SQL
(so-called NewSQL) or other novel styles of database that introduce new
clauses to these statements.   A new example suite is included which
illustrates the <code class="docutils literal notranslate"><span class="pre">QUALIFY</span></code> SQL construct used by several NewSQL databases
which includes a cacheable implementation as well as a test suite.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="../orm/examples.html#examples-syntax-extensions"><span class="std std-ref">Extending Statements like SELECT, INSERT, etc</span></a></p>
</div>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/12195">#12195</a></p>
</p>
</li>
<li><p class="caption" id="change-2.1.0b1-41"><span class="target" id="change-985dd55b046cc728c8cde482163da75f"><strong>[sql] [feature] [core]</strong> <a class="changelog-reference headerlink reference internal" href="#change-985dd55b046cc728c8cde482163da75f">¶</a></span><blockquote>
<div><p>The Core operator system now includes the <code class="docutils literal notranslate"><span class="pre">matmul</span></code> operator, i.e. the
<code class="docutils literal notranslate"><span class="pre">&#64;</span></code> operator in Python as an optional operator.
In addition to the <code class="docutils literal notranslate"><span class="pre">__matmul__</span></code> and <code class="docutils literal notranslate"><span class="pre">__rmatmul__</span></code> operator support
this change also adds the missing <code class="docutils literal notranslate"><span class="pre">__rrshift__</span></code> and <code class="docutils literal notranslate"><span class="pre">__rlshift__</span></code>.
Pull request courtesy Aramís Segovia.</p>
</div></blockquote>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/12479">#12479</a></p>
</p>
</li>
<li><p class="caption" id="change-2.1.0b1-42"><span class="target" id="change-13fc419b75712259cb27e2f7510fc245"><strong>[sql] [feature]</strong> <a class="changelog-reference headerlink reference internal" href="#change-13fc419b75712259cb27e2f7510fc245">¶</a></span><p>Added new Core feature <a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.from_dml_column" title="sqlalchemy.sql.expression.from_dml_column"><code class="xref py py-func docutils literal notranslate"><span class="pre">from_dml_column()</span></code></a> that may be used in
expressions inside of <code class="xref py py-meth docutils literal notranslate"><span class="pre">UpdateBase.values()</span></code> for INSERT or UPDATE; this
construct will copy whatever SQL expression is used for the given target
column in the statement to be used with additional columns. The construct
is mostly intended to be a helper with ORM <a class="reference internal" href="../orm/extensions/hybrid.html#sqlalchemy.ext.hybrid.hybrid_property" title="sqlalchemy.ext.hybrid.hybrid_property"><code class="xref py py-class docutils literal notranslate"><span class="pre">hybrid_property</span></code></a> within
DML hooks.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/12496">#12496</a></p>
</p>
</li>
<li><p class="caption" id="change-2.1.0b1-43"><span class="target" id="change-074c655b31fade33e41fa805b6170bee"><strong>[sql] [feature]</strong> <a class="changelog-reference headerlink reference internal" href="#change-074c655b31fade33e41fa805b6170bee">¶</a></span><p>Added support for Python 3.14+ template strings (t-strings) via the new
<a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.tstring" title="sqlalchemy.sql.expression.tstring"><code class="xref py py-func docutils literal notranslate"><span class="pre">tstring()</span></code></a> construct. This feature makes use of Python 3.14
template strings as defined in <span class="target" id="index-2"></span><a class="pep reference external" href="https://peps.python.org/pep-0750/"><strong>PEP 750</strong></a>, allowing for ergonomic SQL
statement construction by automatically interpolating Python values and
SQLAlchemy expressions within template strings.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="migration_21.html#change-12548"><span class="std std-ref">Template String (t-string) Support for Python 3.14+</span></a> - in <a class="reference internal" href="migration_21.html"><span class="std std-ref">What’s New in SQLAlchemy 2.1?</span></a></p>
</div>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/12548">#12548</a></p>
</p>
</li>
<li><p class="caption" id="change-2.1.0b1-44"><span class="target" id="change-bfdb897dbc00fe11119cf7a9c5b52269"><strong>[sql] [usecase]</strong> <a class="changelog-reference headerlink reference internal" href="#change-bfdb897dbc00fe11119cf7a9c5b52269">¶</a></span><p>Added new generalized aggregate function ordering to functions via the
<a class="reference internal" href="../core/functions.html#sqlalchemy.sql.functions.FunctionElement.aggregate_order_by" title="sqlalchemy.sql.functions.FunctionElement.aggregate_order_by"><code class="xref py py-func docutils literal notranslate"><span class="pre">aggregate_order_by()</span></code></a> method, which
receives an expression and generates the appropriate embedded “ORDER BY” or
“WITHIN GROUP (ORDER BY)” phrase depending on backend database.  This new
function supersedes the use of the PostgreSQL
<a class="reference internal" href="../dialects/postgresql.html#sqlalchemy.dialects.postgresql.aggregate_order_by" title="sqlalchemy.dialects.postgresql.aggregate_order_by"><code class="xref py py-func docutils literal notranslate"><span class="pre">aggregate_order_by()</span></code></a> function, which remains present for
backward compatibility.   To complement the new parameter, the
<a class="reference internal" href="../core/functions.html#sqlalchemy.sql.functions.aggregate_strings.params.order_by" title="sqlalchemy.sql.functions.aggregate_strings"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">aggregate_strings.order_by</span></code></a> which adds ORDER BY
capability to the <a class="reference internal" href="../core/functions.html#sqlalchemy.sql.functions.aggregate_strings" title="sqlalchemy.sql.functions.aggregate_strings"><code class="xref py py-class docutils literal notranslate"><span class="pre">aggregate_strings</span></code></a> dialect-agnostic
function which works for all included backends. Thanks much to Reuven
Starodubski with help on this patch.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/12853">#12853</a></p>
</p>
</li>
<li><p class="caption" id="change-2.1.0b1-45"><span class="target" id="change-ef1f8f4b23ddfc1ae346060646ca676b"><strong>[sql] [usecase]</strong> <a class="changelog-reference headerlink reference internal" href="#change-ef1f8f4b23ddfc1ae346060646ca676b">¶</a></span><p>Changed the query style for ORM queries emitted by <a class="reference internal" href="../orm/session_api.html#sqlalchemy.orm.Session.get" title="sqlalchemy.orm.Session.get"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.get()</span></code></a> as
well as many-to-one lazy load queries to use the default labeling style,
<a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.SelectLabelStyle.LABEL_STYLE_DISAMBIGUATE_ONLY" title="sqlalchemy.sql.expression.SelectLabelStyle.LABEL_STYLE_DISAMBIGUATE_ONLY"><code class="xref py py-attr docutils literal notranslate"><span class="pre">SelectLabelStyle.LABEL_STYLE_DISAMBIGUATE_ONLY</span></code></a>, which normally
does not apply labels to columns in a SELECT statement. Previously, the
older style <a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.SelectLabelStyle.LABEL_STYLE_TABLENAME_PLUS_COL" title="sqlalchemy.sql.expression.SelectLabelStyle.LABEL_STYLE_TABLENAME_PLUS_COL"><code class="xref py py-attr docutils literal notranslate"><span class="pre">SelectLabelStyle.LABEL_STYLE_TABLENAME_PLUS_COL</span></code></a>
that labels columns as <cite>&lt;tablename&gt;_&lt;columname&gt;</cite> was used for
<a class="reference internal" href="../orm/session_api.html#sqlalchemy.orm.Session.get" title="sqlalchemy.orm.Session.get"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.get()</span></code></a> to maintain compatibility with <a class="reference internal" href="../orm/queryguide/query.html#sqlalchemy.orm.Query" title="sqlalchemy.orm.Query"><code class="xref py py-class docutils literal notranslate"><span class="pre">Query</span></code></a>.
The change allows the string representation of ORM queries to be less
verbose in all cases outside of legacy <a class="reference internal" href="../orm/queryguide/query.html#sqlalchemy.orm.Query" title="sqlalchemy.orm.Query"><code class="xref py py-class docutils literal notranslate"><span class="pre">Query</span></code></a> use. Pull
request courtesy Inada Naoki.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/12932">#12932</a></p>
</p>
</li>
<li><p class="caption" id="change-2.1.0b1-46"><span class="target" id="change-1e27f7d3e82a158784be8ceca52a0689"><strong>[sql] [usecase]</strong> <a class="changelog-reference headerlink reference internal" href="#change-1e27f7d3e82a158784be8ceca52a0689">¶</a></span><p>Added method <code class="xref py py-meth docutils literal notranslate"><span class="pre">TableClause.insert_column()</span></code> to complement
<code class="xref py py-meth docutils literal notranslate"><span class="pre">TableClause.append_column()</span></code>, which inserts the given column at a
specific index.   This can be helpful for prepending primary key columns to
tables, etc.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/7910">#7910</a></p>
</p>
</li>
<li><p class="caption" id="change-2.1.0b1-47"><span class="target" id="change-ccf0602058c5c6c77b82dd2382162f95"><strong>[sql] [usecase]</strong> <a class="changelog-reference headerlink reference internal" href="#change-ccf0602058c5c6c77b82dd2382162f95">¶</a></span><p>Added support for the pow operator (<code class="docutils literal notranslate"><span class="pre">**</span></code>), with a default SQL
implementation of the <code class="docutils literal notranslate"><span class="pre">POW()</span></code> function.   On Oracle Database, PostgreSQL
and MSSQL it renders as <code class="docutils literal notranslate"><span class="pre">POWER()</span></code>.   As part of this change, the operator
routes through a new first class <code class="docutils literal notranslate"><span class="pre">func</span></code> member <a class="reference internal" href="../core/functions.html#sqlalchemy.sql.functions.pow" title="sqlalchemy.sql.functions.pow"><code class="xref py py-class docutils literal notranslate"><span class="pre">pow</span></code></a>,
which renders on Oracle Database, PostgreSQL and MSSQL as <code class="docutils literal notranslate"><span class="pre">POWER()</span></code>.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/8579">#8579</a></p>
</p>
</li>
<li><p class="caption" id="change-2.1.0b1-48"><span class="target" id="change-ab187d2a6367480d8390eb29391aea8e"><strong>[sql] [usecase] [orm]</strong> <a class="changelog-reference headerlink reference internal" href="#change-ab187d2a6367480d8390eb29391aea8e">¶</a></span><p>The <a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.Select.filter_by" title="sqlalchemy.sql.expression.Select.filter_by"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Select.filter_by()</span></code></a>, <code class="xref py py-meth docutils literal notranslate"><span class="pre">Update.filter_by()</span></code> and
<code class="xref py py-meth docutils literal notranslate"><span class="pre">Delete.filter_by()</span></code> methods now search across all entities
present in the statement, rather than limiting their search to only the
last joined entity or the first FROM entity. This allows these methods
to locate attributes unambiguously across multiple joined tables,
resolving issues where changing the order of operations such as
<a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.Select.with_only_columns" title="sqlalchemy.sql.expression.Select.with_only_columns"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Select.with_only_columns()</span></code></a> would cause the method to fail.</p>
<p>If an attribute name exists in more than one FROM clause entity, an
<a class="reference internal" href="../core/exceptions.html#sqlalchemy.exc.AmbiguousColumnError" title="sqlalchemy.exc.AmbiguousColumnError"><code class="xref py py-class docutils literal notranslate"><span class="pre">AmbiguousColumnError</span></code></a> is now raised, indicating that
<a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.Select.filter" title="sqlalchemy.sql.expression.Select.filter"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Select.filter()</span></code></a> (or <a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.Select.where" title="sqlalchemy.sql.expression.Select.where"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Select.where()</span></code></a>) should be used
instead with explicit table-qualified column references.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="migration_21.html#change-8601"><span class="std std-ref">filter_by() now searches across all FROM clause entities</span></a> - Migration notes</p>
</div>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/8601">#8601</a></p>
</p>
</li>
<li><p class="caption" id="change-2.1.0b1-49"><span class="target" id="change-4a0eb97a54bd3872e593a172bdb16da2"><strong>[sql] [change]</strong> <a class="changelog-reference headerlink reference internal" href="#change-4a0eb97a54bd3872e593a172bdb16da2">¶</a></span><p>The <code class="docutils literal notranslate"><span class="pre">.c</span></code> and <code class="docutils literal notranslate"><span class="pre">.columns</span></code> attributes on the <a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.Select" title="sqlalchemy.sql.expression.Select"><code class="xref py py-class docutils literal notranslate"><span class="pre">Select</span></code></a> and
<a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.TextualSelect" title="sqlalchemy.sql.expression.TextualSelect"><code class="xref py py-class docutils literal notranslate"><span class="pre">TextualSelect</span></code></a> constructs, which are not instances of
<a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.FromClause" title="sqlalchemy.sql.expression.FromClause"><code class="xref py py-class docutils literal notranslate"><span class="pre">FromClause</span></code></a>, have been removed completely, in addition to the
<code class="docutils literal notranslate"><span class="pre">.select()</span></code> method as well as other codepaths which would implicitly
generate a subquery from a <a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.Select" title="sqlalchemy.sql.expression.Select"><code class="xref py py-class docutils literal notranslate"><span class="pre">Select</span></code></a> without the need to explicitly
call the <a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.Select.subquery" title="sqlalchemy.sql.expression.Select.subquery"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Select.subquery()</span></code></a> method.</p>
<p>In the case of <code class="docutils literal notranslate"><span class="pre">.c</span></code> and <code class="docutils literal notranslate"><span class="pre">.columns</span></code>, these attributes were never useful
in practice and have caused a great deal of confusion, hence were
deprecated back in version 1.4, and have emitted warnings since that
version.   Accessing the columns that are specific to a <a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.Select" title="sqlalchemy.sql.expression.Select"><code class="xref py py-class docutils literal notranslate"><span class="pre">Select</span></code></a>
construct is done via the <a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.Select.selected_columns" title="sqlalchemy.sql.expression.Select.selected_columns"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Select.selected_columns</span></code></a> attribute, which
was added in version 1.4 to suit the use case that users often expected
<code class="docutils literal notranslate"><span class="pre">.c</span></code> to accomplish.  In the larger sense, implicit production of
subqueries works against SQLAlchemy’s modern practice of making SQL
structure as explicit as possible.</p>
<p>Note that this is <strong>not related</strong> to the usual <a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.FromClause.c" title="sqlalchemy.sql.expression.FromClause.c"><code class="xref py py-attr docutils literal notranslate"><span class="pre">FromClause.c</span></code></a> and
<a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.FromClause.columns" title="sqlalchemy.sql.expression.FromClause.columns"><code class="xref py py-attr docutils literal notranslate"><span class="pre">FromClause.columns</span></code></a> attributes, common to objects such as
<a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Table" title="sqlalchemy.schema.Table"><code class="xref py py-class docutils literal notranslate"><span class="pre">Table</span></code></a> and <a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.Subquery" title="sqlalchemy.sql.expression.Subquery"><code class="xref py py-class docutils literal notranslate"><span class="pre">Subquery</span></code></a>,  which are unaffected by this
change.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="migration_14.html#change-4617"><span class="std std-ref">A SELECT statement is no longer implicitly considered to be a FROM clause</span></a> - original notes from SQLAlchemy 1.4</p>
</div>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/10236">#10236</a></p>
</p>
</li>
<li><p class="caption" id="change-2.1.0b1-50"><span class="target" id="change-f209f702ffdc001cf7f6731d60dbc626"><strong>[sql] [change]</strong> <a class="changelog-reference headerlink reference internal" href="#change-f209f702ffdc001cf7f6731d60dbc626">¶</a></span><p>the <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.Numeric" title="sqlalchemy.types.Numeric"><code class="xref py py-class docutils literal notranslate"><span class="pre">Numeric</span></code></a> and <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.Float" title="sqlalchemy.types.Float"><code class="xref py py-class docutils literal notranslate"><span class="pre">Float</span></code></a> SQL types have been separated out
so that <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.Float" title="sqlalchemy.types.Float"><code class="xref py py-class docutils literal notranslate"><span class="pre">Float</span></code></a> no longer inherits from <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.Numeric" title="sqlalchemy.types.Numeric"><code class="xref py py-class docutils literal notranslate"><span class="pre">Numeric</span></code></a>; instead,
they both extend from a common mixin <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.NumericCommon" title="sqlalchemy.types.NumericCommon"><code class="xref py py-class docutils literal notranslate"><span class="pre">NumericCommon</span></code></a>.  This
corrects for some architectural shortcomings where numeric and float types
are typically separate, and establishes more consistency with
<a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.Integer" title="sqlalchemy.types.Integer"><code class="xref py py-class docutils literal notranslate"><span class="pre">Integer</span></code></a> also being a distinct type.   The change should not have
any end-user implications except for code that may be using
<code class="docutils literal notranslate"><span class="pre">isinstance()</span></code> to test for the <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.Numeric" title="sqlalchemy.types.Numeric"><code class="xref py py-class docutils literal notranslate"><span class="pre">Numeric</span></code></a> datatype; third party
dialects which rely upon specific implementation types for numeric and/or
float may also require adjustment to maintain compatibility.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/5252">#5252</a></p>
</p>
</li>
<li><p class="caption" id="change-2.1.0b1-51"><span class="target" id="change-1b4298f82bbb0573872ad2995a2cad42"><strong>[sql] [change]</strong> <a class="changelog-reference headerlink reference internal" href="#change-1b4298f82bbb0573872ad2995a2cad42">¶</a></span><p>Added new implementation for the <a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.Select.params" title="sqlalchemy.sql.expression.Select.params"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Select.params()</span></code></a> method and that of
similar statements, via a new statement-only
<a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.ExecutableStatement.params" title="sqlalchemy.sql.expression.ExecutableStatement.params"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ExecutableStatement.params()</span></code></a> method which works more efficiently and
correctly than the previous implementations available from
<a class="reference internal" href="../core/foundation.html#sqlalchemy.sql.expression.ClauseElement" title="sqlalchemy.sql.expression.ClauseElement"><code class="xref py py-class docutils literal notranslate"><span class="pre">ClauseElement</span></code></a>, by associating the given parameter dictionary with
the statement overall rather than cloning the statement and rewriting its
bound parameters.  The <a class="reference internal" href="../core/foundation.html#sqlalchemy.sql.expression.ClauseElement.params" title="sqlalchemy.sql.expression.ClauseElement.params"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ClauseElement.params()</span></code></a> and
<a class="reference internal" href="../core/foundation.html#sqlalchemy.sql.expression.ClauseElement.unique_params" title="sqlalchemy.sql.expression.ClauseElement.unique_params"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ClauseElement.unique_params()</span></code></a> methods, when called on an object
that does not implement <a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.ExecutableStatement" title="sqlalchemy.sql.expression.ExecutableStatement"><code class="xref py py-class docutils literal notranslate"><span class="pre">ExecutableStatement</span></code></a>, will continue to
work the old way of cloning the object, and will emit a deprecation
warning.    This issue both resolves the architectural / performance
concerns of <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/7066">#7066</a> and also provides correct ORM compatibility for
functions like <a class="reference internal" href="../orm/queryguide/api.html#sqlalchemy.orm.aliased" title="sqlalchemy.orm.aliased"><code class="xref py py-func docutils literal notranslate"><span class="pre">aliased()</span></code></a>, reported by <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/12915">#12915</a>.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="migration_21.html#change-7066"><span class="std std-ref">Improved params() implementation for executable statements</span></a></p>
</div>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/12915">#12915</a>, <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/7066">#7066</a></p>
</p>
</li>
<li><p class="caption" id="change-2.1.0b1-52"><span class="target" id="change-1fe22cf3b73fff984885ec8034497853"><strong>[sql] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-1fe22cf3b73fff984885ec8034497853">¶</a></span><p>The <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.Double" title="sqlalchemy.types.Double"><code class="xref py py-class docutils literal notranslate"><span class="pre">Double</span></code></a> type is now used when a Python float value is detected
as a literal value to be sent as a bound parameter, rather than the
<a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.Float" title="sqlalchemy.types.Float"><code class="xref py py-class docutils literal notranslate"><span class="pre">Float</span></code></a> type.  <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.Double" title="sqlalchemy.types.Double"><code class="xref py py-class docutils literal notranslate"><span class="pre">Double</span></code></a> has the same implementation as
<a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.Float" title="sqlalchemy.types.Float"><code class="xref py py-class docutils literal notranslate"><span class="pre">Float</span></code></a>, but when rendered in a CAST, produces <code class="docutils literal notranslate"><span class="pre">DOUBLE</span></code> or
<code class="docutils literal notranslate"><span class="pre">DOUBLE</span> <span class="pre">PRECISION</span></code> rather than <code class="docutils literal notranslate"><span class="pre">FLOAT</span></code>.   The former better matches
Python’s <code class="docutils literal notranslate"><span class="pre">float</span></code> datatype which uses 8-byte double-precision storage.
Third party dialects which don’t support the <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.Double" title="sqlalchemy.types.Double"><code class="xref py py-class docutils literal notranslate"><span class="pre">Double</span></code></a> type directly
may need adjustment so that they render an appropriate keyword (e.g.
<code class="docutils literal notranslate"><span class="pre">FLOAT</span></code>) when the <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.Double" title="sqlalchemy.types.Double"><code class="xref py py-class docutils literal notranslate"><span class="pre">Double</span></code></a> datatype is encountered.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="migration_21.html#change-10300"><span class="std std-ref">Python float literals now render as DOUBLE in CAST expressions</span></a></p>
</div>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/10300">#10300</a></p>
</p>
</li>
<li><p class="caption" id="change-2.1.0b1-53"><span class="target" id="change-45dd6833627d47780a5dc485f455af58"><strong>[sql] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-45dd6833627d47780a5dc485f455af58">¶</a></span><p>Fixed issue in name normalization (e.g. “uppercase” backends like Oracle)
where using a <a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.TextualSelect" title="sqlalchemy.sql.expression.TextualSelect"><code class="xref py py-class docutils literal notranslate"><span class="pre">TextualSelect</span></code></a> would not properly maintain as
uppercase column names that were quoted as uppercase, even though
the <a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.TextualSelect" title="sqlalchemy.sql.expression.TextualSelect"><code class="xref py py-class docutils literal notranslate"><span class="pre">TextualSelect</span></code></a> includes a <a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Column" title="sqlalchemy.schema.Column"><code class="xref py py-class docutils literal notranslate"><span class="pre">Column</span></code></a> that explicitly
holds this uppercase name.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/10788">#10788</a></p>
</p>
</li>
<li><p class="caption" id="change-2.1.0b1-54"><span class="target" id="change-24bd84272d6ec6f184227d1c59e24da1"><strong>[sql] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-24bd84272d6ec6f184227d1c59e24da1">¶</a></span><p>Enhanced the caching structure of the <a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.over.params.rows" title="sqlalchemy.sql.expression.over"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">over.rows</span></code></a>
and <a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.over.params.range" title="sqlalchemy.sql.expression.over"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">over.range</span></code></a> so that different numerical
values for the rows /
range fields are cached on the same cache key, to the extent that the
underlying SQL does not actually change (i.e. “unbounded”, “current row”,
negative/positive status will still change the cache key).  This prevents
the use of many different numerical range/rows value for a query that is
otherwise identical from filling up the SQL cache.</p>
<p>Note that the semi-private compiler method <code class="docutils literal notranslate"><span class="pre">_format_frame_clause()</span></code>
is removed by this fix, replaced with a new method
<code class="docutils literal notranslate"><span class="pre">visit_frame_clause()</span></code>.  Third party dialects which may have referred
to this method will need to change the name and revise the approach to
rendering the correct SQL for that dialect.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/11515">#11515</a></p>
</p>
</li>
<li><p class="caption" id="change-2.1.0b1-55"><span class="target" id="change-69af418c8e4b7f5fc895027d5b44f378"><strong>[sql] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-69af418c8e4b7f5fc895027d5b44f378">¶</a></span><p>Updated the <a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.over" title="sqlalchemy.sql.expression.over"><code class="xref py py-func docutils literal notranslate"><span class="pre">over()</span></code></a> clause to allow non integer values in
<a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.over.params.range_" title="sqlalchemy.sql.expression.over"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">over.range_</span></code></a> clause. Previously, only integer values
were allowed and any other values would lead to a failure.
To specify a non-integer value, use the new <a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.FrameClause" title="sqlalchemy.sql.expression.FrameClause"><code class="xref py py-class docutils literal notranslate"><span class="pre">FrameClause</span></code></a>
construct along with the new <a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.FrameClauseType" title="sqlalchemy.sql.expression.FrameClauseType"><code class="xref py py-class docutils literal notranslate"><span class="pre">FrameClauseType</span></code></a> enum to specify
the frame boundaries. For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">FrameClause</span><span class="p">,</span> <span class="n">FrameClauseType</span>

<span class="n">select</span><span class="p">(</span>
    <span class="n">func</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">value</span><span class="p">)</span><span class="o">.</span><span class="n">over</span><span class="p">(</span>
        <span class="n">range_</span><span class="o">=</span><span class="n">FrameClause</span><span class="p">(</span>
            <span class="mf">3.14</span><span class="p">,</span>
            <span class="mf">2.71</span><span class="p">,</span>
            <span class="n">FrameClauseType</span><span class="o">.</span><span class="n">PRECEDING</span><span class="p">,</span>
            <span class="n">FrameClauseType</span><span class="o">.</span><span class="n">FOLLOWING</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="p">)</span>
<span class="p">)</span></pre></div>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="migration_21.html#change-12596"><span class="std std-ref">Non-integer RANGE window frame clauses now supported</span></a> - in the <a class="reference internal" href="migration_21.html"><span class="std std-ref">migration guide</span></a></p>
</div>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/12596">#12596</a></p>
</p>
</li>
<li><p class="caption" id="change-2.1.0b1-56"><span class="target" id="change-4e5fa71bf18b754ba102ba918f8bdb32"><strong>[sql] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-4e5fa71bf18b754ba102ba918f8bdb32">¶</a></span><p>Added a new concept of “operator classes” to the SQL operators supported by
SQLAlchemy, represented within the enum <a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.OperatorClass" title="sqlalchemy.sql.expression.OperatorClass"><code class="xref py py-class docutils literal notranslate"><span class="pre">OperatorClass</span></code></a>.  The
purpose of this structure is to provide an extra layer of validation when a
particular kind of SQL operation is used with a particular datatype, to
catch early the use of an operator that does not have any relevance to the
datatype in use; a simple example is an integer or numeric column used with
a “string match” operator.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="migration_21.html#change-12736"><span class="std std-ref">Operator classes added to validate operator usage with datatypes</span></a></p>
</div>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/12736">#12736</a></p>
</p>
</li>
<li><p class="caption" id="change-2.1.0b1-57"><span class="target" id="change-ed7a446e217dabcfe7695097f407a2dc"><strong>[sql] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-ed7a446e217dabcfe7695097f407a2dc">¶</a></span><p>Fixed an issue in <a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.Select.join_from" title="sqlalchemy.sql.expression.Select.join_from"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Select.join_from()</span></code></a> where the join condition
between the left and right tables specified in the method call could be
incorrectly determined based on an intermediate table already present in
the FROM clause, rather than matching the foreign keys between the
immediate left and right arguments. The join condition is now determined by
matching primary keys between the two tables explicitly passed to
<a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.Select.join_from" title="sqlalchemy.sql.expression.Select.join_from"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Select.join_from()</span></code></a>, ensuring consistent and predictable join
behavior regardless of the order of join operations or other tables present
in the query.  The fix is applied to both the Core and ORM implementations
of <a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.Select.join_from" title="sqlalchemy.sql.expression.Select.join_from"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Select.join_from()</span></code></a>.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/12931">#12931</a></p>
</p>
</li>
<li><p class="caption" id="change-2.1.0b1-58"><span class="target" id="change-517f81481f78a69a49a5cbad0eb2eaf5"><strong>[sql] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-517f81481f78a69a49a5cbad0eb2eaf5">¶</a></span><p>Fixed issue where anonymous label generation for <a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.CTE" title="sqlalchemy.sql.expression.CTE"><code class="xref py py-class docutils literal notranslate"><span class="pre">CTE</span></code></a> constructs
could produce name collisions when Python’s garbage collector reused memory
addresses during complex query compilation. The anonymous name generation
for <a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.CTE" title="sqlalchemy.sql.expression.CTE"><code class="xref py py-class docutils literal notranslate"><span class="pre">CTE</span></code></a> and other aliased constructs like <a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.Alias" title="sqlalchemy.sql.expression.Alias"><code class="xref py py-class docutils literal notranslate"><span class="pre">Alias</span></code></a>,
<a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.Subquery" title="sqlalchemy.sql.expression.Subquery"><code class="xref py py-class docutils literal notranslate"><span class="pre">Subquery</span></code></a> and others now use <code class="xref py py-func docutils literal notranslate"><span class="pre">os.urandom()</span></code> to generate unique
identifiers instead of relying on object <code class="docutils literal notranslate"><span class="pre">id()</span></code>, ensuring uniqueness even
in cases of aggressive garbage collection and memory reuse.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/12990">#12990</a></p>
</p>
</li>
<li><p class="caption" id="change-2.1.0b1-59"><span class="target" id="change-1d834cb2805f6955890c008f81832642"><strong>[sql]</strong> <a class="changelog-reference headerlink reference internal" href="#change-1d834cb2805f6955890c008f81832642">¶</a></span><p>Removed the automatic coercion of executable objects, such as
<a class="reference internal" href="../orm/queryguide/query.html#sqlalchemy.orm.Query" title="sqlalchemy.orm.Query"><code class="xref py py-class docutils literal notranslate"><span class="pre">Query</span></code></a>, when passed into <a class="reference internal" href="../orm/session_api.html#sqlalchemy.orm.Session.execute" title="sqlalchemy.orm.Session.execute"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.execute()</span></code></a>.
This usage raised a deprecation warning since the 1.4 series.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/12218">#12218</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.1.0b1-schema">
<h3>schema<a class="headerlink" href="#change-2.1.0b1-schema" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.1.0b1-60"><span class="target" id="change-022d8f88f5fa4c715cfdcad31e070bbf"><strong>[schema] [feature]</strong> <a class="changelog-reference headerlink reference internal" href="#change-022d8f88f5fa4c715cfdcad31e070bbf">¶</a></span><p>Added support for the SQL <code class="docutils literal notranslate"><span class="pre">CREATE</span> <span class="pre">VIEW</span></code> statement via the new
<a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.CreateView" title="sqlalchemy.schema.CreateView"><code class="xref py py-class docutils literal notranslate"><span class="pre">CreateView</span></code></a> DDL class. The new class allows creating database
views from SELECT statements, with support for options such as
<code class="docutils literal notranslate"><span class="pre">TEMPORARY</span></code>, <code class="docutils literal notranslate"><span class="pre">IF</span> <span class="pre">NOT</span> <span class="pre">EXISTS</span></code>, and <code class="docutils literal notranslate"><span class="pre">MATERIALIZED</span></code> where supported by
the target database. Views defined with <a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.CreateView" title="sqlalchemy.schema.CreateView"><code class="xref py py-class docutils literal notranslate"><span class="pre">CreateView</span></code></a> integrate with
<a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.MetaData" title="sqlalchemy.schema.MetaData"><code class="xref py py-class docutils literal notranslate"><span class="pre">MetaData</span></code></a> for automated DDL generation and provide a
<a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Table" title="sqlalchemy.schema.Table"><code class="xref py py-class docutils literal notranslate"><span class="pre">Table</span></code></a> object for querying.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="migration_21.html#change-4950"><span class="std std-ref">CREATE VIEW and CREATE TABLE AS SELECT Support</span></a></p>
</div>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/181">#181</a></p>
</p>
</li>
<li><p class="caption" id="change-2.1.0b1-61"><span class="target" id="change-efb5b1515a1f813d2e5f5a8789b95d61"><strong>[schema] [feature]</strong> <a class="changelog-reference headerlink reference internal" href="#change-efb5b1515a1f813d2e5f5a8789b95d61">¶</a></span><p>Added support for the SQL <code class="docutils literal notranslate"><span class="pre">CREATE</span> <span class="pre">TABLE</span> <span class="pre">...</span> <span class="pre">AS</span> <span class="pre">SELECT</span></code> construct via the
new <a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.CreateTableAs" title="sqlalchemy.schema.CreateTableAs"><code class="xref py py-class docutils literal notranslate"><span class="pre">CreateTableAs</span></code></a> DDL construct and the
<a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.Select.into" title="sqlalchemy.sql.expression.Select.into"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Select.into()</span></code></a> method. The new construct allows creating a
table directly from the results of a SELECT statement, with support for
options such as <code class="docutils literal notranslate"><span class="pre">TEMPORARY</span></code> and <code class="docutils literal notranslate"><span class="pre">IF</span> <span class="pre">NOT</span> <span class="pre">EXISTS</span></code> where supported by the
target database. Tables defined with <a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.CreateTableAs" title="sqlalchemy.schema.CreateTableAs"><code class="xref py py-class docutils literal notranslate"><span class="pre">CreateTableAs</span></code></a>
integrate with <a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.MetaData" title="sqlalchemy.schema.MetaData"><code class="xref py py-class docutils literal notranslate"><span class="pre">MetaData</span></code></a> for automated DDL generation and provide
a <a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Table" title="sqlalchemy.schema.Table"><code class="xref py py-class docutils literal notranslate"><span class="pre">Table</span></code></a> object for querying. Pull request courtesy Greg Jarzab.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="migration_21.html#change-4950"><span class="std std-ref">CREATE VIEW and CREATE TABLE AS SELECT Support</span></a></p>
</div>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/4950">#4950</a></p>
</p>
</li>
<li><p class="caption" id="change-2.1.0b1-62"><span class="target" id="change-d4ba6bc475eff08e8671fc798d1a0366"><strong>[schema] [usecase]</strong> <a class="changelog-reference headerlink reference internal" href="#change-d4ba6bc475eff08e8671fc798d1a0366">¶</a></span><p>The the parameter <a class="reference internal" href="../core/ddl.html#sqlalchemy.schema.DropConstraint.params.isolate_from_table" title="sqlalchemy.schema.DropConstraint"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">DropConstraint.isolate_from_table</span></code></a>
was deprecated since it has no effect on the drop table behavior.
Its default values was also changed to <code class="docutils literal notranslate"><span class="pre">False</span></code>.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/13006">#13006</a></p>
</p>
</li>
<li><p class="caption" id="change-2.1.0b1-63"><span class="target" id="change-8840f07ad6bcb7f1e09bc0af639d8aa1"><strong>[schema] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-8840f07ad6bcb7f1e09bc0af639d8aa1">¶</a></span><p>The <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.Float" title="sqlalchemy.types.Float"><code class="xref py py-class docutils literal notranslate"><span class="pre">Float</span></code></a> and <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.Numeric" title="sqlalchemy.types.Numeric"><code class="xref py py-class docutils literal notranslate"><span class="pre">Numeric</span></code></a> types are no longer automatically
considered as auto-incrementing columns when the
<a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Column.params.autoincrement" title="sqlalchemy.schema.Column"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Column.autoincrement</span></code></a> parameter is left at its default
of <code class="docutils literal notranslate"><span class="pre">&quot;auto&quot;</span></code> on a <a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Column" title="sqlalchemy.schema.Column"><code class="xref py py-class docutils literal notranslate"><span class="pre">Column</span></code></a> that is part of the primary key.
When the parameter is set to <code class="docutils literal notranslate"><span class="pre">True</span></code>, a <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.Numeric" title="sqlalchemy.types.Numeric"><code class="xref py py-class docutils literal notranslate"><span class="pre">Numeric</span></code></a> type will be
accepted as an auto-incrementing datatype for primary key columns, but only
if its scale is explicitly given as zero; otherwise, an error is raised.
This is a change from 2.0 where all numeric types including floats were
automatically considered as “autoincrement” for primary key columns.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/11811">#11811</a></p>
</p>
</li>
<li><p class="caption" id="change-2.1.0b1-64"><span class="target" id="change-1a6404a1e2dd78f050a956f73d3e0439"><strong>[schema]</strong> <a class="changelog-reference headerlink reference internal" href="#change-1a6404a1e2dd78f050a956f73d3e0439">¶</a></span><p>Deprecate Oracle only parameters <a class="reference internal" href="../core/defaults.html#sqlalchemy.schema.Sequence.params.order" title="sqlalchemy.schema.Sequence"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Sequence.order</span></code></a>,
<a class="reference internal" href="../core/defaults.html#sqlalchemy.schema.Identity.params.order" title="sqlalchemy.schema.Identity"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Identity.order</span></code></a> and <a class="reference internal" href="../core/defaults.html#sqlalchemy.schema.Identity.params.on_null" title="sqlalchemy.schema.Identity"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Identity.on_null</span></code></a>.
They should be configured using the dialect kwargs <code class="docutils literal notranslate"><span class="pre">oracle_order</span></code> and
<code class="docutils literal notranslate"><span class="pre">oracle_on_null</span></code>.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/10247">#10247</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.1.0b1-typing">
<h3>typing<a class="headerlink" href="#change-2.1.0b1-typing" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.1.0b1-65"><span class="target" id="change-6a326a06ef003c78cf401b8c3b755e45"><strong>[typing] [feature]</strong> <a class="changelog-reference headerlink reference internal" href="#change-6a326a06ef003c78cf401b8c3b755e45">¶</a></span><p>The <a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Row" title="sqlalchemy.engine.Row"><code class="xref py py-class docutils literal notranslate"><span class="pre">Row</span></code></a> object now no longer makes use of an intermediary
<code class="docutils literal notranslate"><span class="pre">Tuple</span></code> in order to represent its individual element types; instead,
the individual element types are present directly, via new <span class="target" id="index-1"></span><a class="pep reference external" href="https://peps.python.org/pep-0646/"><strong>PEP 646</strong></a>
integration, now available in more recent versions of Mypy.  Mypy
1.7 or greater is now required for statements, results and rows
to be correctly typed.   Pull request courtesy Yurii Karabas.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="migration_21.html#change-10635"><span class="std std-ref">Row now represents individual column types directly without Tuple</span></a></p>
</div>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/10635">#10635</a></p>
</p>
</li>
<li><p class="caption" id="change-2.1.0b1-66"><span class="target" id="change-0fc22c268bd3c324d8cdacb7f38a73f4"><strong>[typing]</strong> <a class="changelog-reference headerlink reference internal" href="#change-0fc22c268bd3c324d8cdacb7f38a73f4">¶</a></span><p>The default implementation of <code class="xref py py-attr docutils literal notranslate"><span class="pre">TypeEngine.python_type</span></code> now
returns <code class="docutils literal notranslate"><span class="pre">object</span></code> instead of <code class="docutils literal notranslate"><span class="pre">NotImplementedError</span></code>, since that’s the
base for all types in Python3.
The <code class="docutils literal notranslate"><span class="pre">python_type</span></code> of <code class="xref py py-class docutils literal notranslate"><span class="pre">JSON</span></code> no longer returns <code class="docutils literal notranslate"><span class="pre">dict</span></code>,
but instead fallbacks to the generic implementation.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/10646">#10646</a></p>
</p>
</li>
<li><p class="caption" id="change-2.1.0b1-67"><span class="target" id="change-85258419a4408c1d4daa82355a1bd2c0"><strong>[typing] [orm]</strong> <a class="changelog-reference headerlink reference internal" href="#change-85258419a4408c1d4daa82355a1bd2c0">¶</a></span><p>Removed the deprecated mypy plugin.
The plugin was non-functional with newer version of mypy and it’s no
longer needed with modern SQLAlchemy declarative style.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/12293">#12293</a></p>
</p>
</li>
<li><p class="caption" id="change-2.1.0b1-68"><span class="target" id="change-e73fb6e9288bf5e8a8da8f8983f761fb"><strong>[typing] [orm]</strong> <a class="changelog-reference headerlink reference internal" href="#change-e73fb6e9288bf5e8a8da8f8983f761fb">¶</a></span><p>Deprecated the <code class="docutils literal notranslate"><span class="pre">declarative_mixin</span></code> decorator since it was used only
by the now removed mypy plugin.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/12346">#12346</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.1.0b1-asyncio">
<h3>asyncio<a class="headerlink" href="#change-2.1.0b1-asyncio" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.1.0b1-69"><span class="target" id="change-5801a333b8aca8f3e82a6c15c71329e7"><strong>[asyncio] [feature]</strong> <a class="changelog-reference headerlink reference internal" href="#change-5801a333b8aca8f3e82a6c15c71329e7">¶</a></span><p>The “emulated” exception hierarchies for the asyncio
drivers such as asyncpg, aiomysql, aioodbc, etc. have been standardized
on a common base <a class="reference internal" href="../core/exceptions.html#sqlalchemy.exc.EmulatedDBAPIException" title="sqlalchemy.exc.EmulatedDBAPIException"><code class="xref py py-class docutils literal notranslate"><span class="pre">EmulatedDBAPIException</span></code></a>, which is now what’s
available from the <code class="xref py py-attr docutils literal notranslate"><span class="pre">StatementException.orig</span></code> attribute on a
SQLAlchemy <a class="reference internal" href="../core/exceptions.html#sqlalchemy.exc.DBAPIError" title="sqlalchemy.exc.DBAPIError"><code class="xref py py-class docutils literal notranslate"><span class="pre">DBAPIError</span></code></a> object.   Within <a class="reference internal" href="../core/exceptions.html#sqlalchemy.exc.EmulatedDBAPIException" title="sqlalchemy.exc.EmulatedDBAPIException"><code class="xref py py-class docutils literal notranslate"><span class="pre">EmulatedDBAPIException</span></code></a>
and the subclasses in its hierarchy, the original driver-level exception is
also now available via the <code class="xref py py-attr docutils literal notranslate"><span class="pre">EmulatedDBAPIException.orig</span></code> attribute,
and is also available from <a class="reference internal" href="../core/exceptions.html#sqlalchemy.exc.DBAPIError" title="sqlalchemy.exc.DBAPIError"><code class="xref py py-class docutils literal notranslate"><span class="pre">DBAPIError</span></code></a> directly using the
<a class="reference internal" href="../core/exceptions.html#sqlalchemy.exc.DBAPIError.driver_exception" title="sqlalchemy.exc.DBAPIError.driver_exception"><code class="xref py py-attr docutils literal notranslate"><span class="pre">DBAPIError.driver_exception</span></code></a> attribute.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/8047">#8047</a></p>
</p>
</li>
<li><p class="caption" id="change-2.1.0b1-70"><span class="target" id="change-66bde029a3118ceaf8fb6336378002bf"><strong>[asyncio] [change]</strong> <a class="changelog-reference headerlink reference internal" href="#change-66bde029a3118ceaf8fb6336378002bf">¶</a></span><p>Added an initialize step to the import of
<code class="docutils literal notranslate"><span class="pre">sqlalchemy.ext.asyncio</span></code> so that <code class="docutils literal notranslate"><span class="pre">greenlet</span></code> will
be imported only when the asyncio extension is first imported.
Alternatively, the <code class="docutils literal notranslate"><span class="pre">greenlet</span></code> library is still imported lazily on
first use to support use case that don’t make direct use of the
SQLAlchemy asyncio extension.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/10296">#10296</a></p>
</p>
</li>
<li><p class="caption" id="change-2.1.0b1-71"><span class="target" id="change-acde0657e22ad9a9197550370544f762"><strong>[asyncio] [change]</strong> <a class="changelog-reference headerlink reference internal" href="#change-acde0657e22ad9a9197550370544f762">¶</a></span><p>Adapted all asyncio dialects, including aiosqlite, aiomysql, asyncmy,
psycopg, asyncpg to use the generic asyncio connection adapter first added
in <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/6521">#6521</a> for the aioodbc DBAPI, allowing these dialects to take
advantage of a common framework.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/10415">#10415</a></p>
</p>
</li>
<li><p class="caption" id="change-2.1.0b1-72"><span class="target" id="change-eecc6b085d3127211206517b3dc97750"><strong>[asyncio] [change]</strong> <a class="changelog-reference headerlink reference internal" href="#change-eecc6b085d3127211206517b3dc97750">¶</a></span><p>Removed the compatibility <code class="docutils literal notranslate"><span class="pre">async_fallback</span></code> mode for async dialects,
since it’s no longer used by SQLAlchemy tests.
Also removed the internal function <code class="docutils literal notranslate"><span class="pre">await_fallback()</span></code> and renamed
the internal function <code class="docutils literal notranslate"><span class="pre">await_only()</span></code> to <code class="docutils literal notranslate"><span class="pre">await_()</span></code>.
No change is expected to user code.</p>
<p></p>
</p>
</li>
<li><p class="caption" id="change-2.1.0b1-73"><span class="target" id="change-4c520d0f71ad0ac7b448ac6b6a32656d"><strong>[asyncio] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-4c520d0f71ad0ac7b448ac6b6a32656d">¶</a></span><p>Refactored all asyncio dialects so that exceptions which occur on failed
connection attempts are appropriately wrapped with SQLAlchemy exception
objects, allowing for consistent error handling.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/11956">#11956</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.1.0b1-postgresql">
<h3>postgresql<a class="headerlink" href="#change-2.1.0b1-postgresql" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.1.0b1-74"><span class="target" id="change-46b4827bde3d08a93e4e3d5d49487ef3"><strong>[postgresql] [feature]</strong> <a class="changelog-reference headerlink reference internal" href="#change-46b4827bde3d08a93e4e3d5d49487ef3">¶</a></span><p>Adds a new <code class="docutils literal notranslate"><span class="pre">str</span></code> subclass <a class="reference internal" href="../dialects/postgresql.html#sqlalchemy.dialects.postgresql.BitString" title="sqlalchemy.dialects.postgresql.BitString"><code class="xref py py-class docutils literal notranslate"><span class="pre">BitString</span></code></a> representing
PostgreSQL bitstrings in python, that includes
functionality for converting to and from <code class="docutils literal notranslate"><span class="pre">int</span></code> and <code class="docutils literal notranslate"><span class="pre">bytes</span></code>, in
addition to implementing utility methods and operators for dealing with bits.</p>
<p>This new class is returned automatically by the <code class="xref py py-class docutils literal notranslate"><span class="pre">postgresql.BIT</span></code> type.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="migration_21.html#change-10556"><span class="std std-ref">Addition of BitString subclass for handling postgresql BIT columns</span></a></p>
</div>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/10556">#10556</a></p>
</p>
</li>
<li><p class="caption" id="change-2.1.0b1-75"><span class="target" id="change-ac098eec4f39d09914f5a83988418a88"><strong>[postgresql] [feature]</strong> <a class="changelog-reference headerlink reference internal" href="#change-ac098eec4f39d09914f5a83988418a88">¶</a></span><p>Support for storage parameters in <code class="docutils literal notranslate"><span class="pre">CREATE</span> <span class="pre">TABLE</span></code> using the <code class="docutils literal notranslate"><span class="pre">WITH</span></code>
clause has been added. The <code class="docutils literal notranslate"><span class="pre">postgresql_with</span></code> dialect option of
<a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Table" title="sqlalchemy.schema.Table"><code class="xref py py-class docutils literal notranslate"><span class="pre">Table</span></code></a> accepts a mapping of key/value options.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="../dialects/postgresql.html#postgresql-table-options-with"><span class="std std-ref">WITH</span></a> - in the PostgreSQL dialect
documentation</p>
</div>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/10909">#10909</a></p>
</p>
</li>
<li><p class="caption" id="change-2.1.0b1-76"><span class="target" id="change-0b4ec646d25686a1089e4bd6bf9552cc"><strong>[postgresql] [feature]</strong> <a class="changelog-reference headerlink reference internal" href="#change-0b4ec646d25686a1089e4bd6bf9552cc">¶</a></span><p>Added syntax extension <a class="reference internal" href="../dialects/postgresql.html#sqlalchemy.dialects.postgresql.distinct_on" title="sqlalchemy.dialects.postgresql.distinct_on"><code class="xref py py-func docutils literal notranslate"><span class="pre">distinct_on()</span></code></a> to build <code class="docutils literal notranslate"><span class="pre">DISTINCT</span>
<span class="pre">ON</span></code> clauses. The old api, that passed columns to
<a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.Select.distinct" title="sqlalchemy.sql.expression.Select.distinct"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Select.distinct()</span></code></a>, is now deprecated.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/12342">#12342</a></p>
</p>
</li>
<li><p class="caption" id="change-2.1.0b1-77"><span class="target" id="change-f5f1ed958c7db0c70eaecd7edb590e66"><strong>[postgresql] [feature]</strong> <a class="changelog-reference headerlink reference internal" href="#change-f5f1ed958c7db0c70eaecd7edb590e66">¶</a></span><p>Support for <code class="docutils literal notranslate"><span class="pre">VIRTUAL</span></code> computed columns on PostgreSQL 18 and later has
been added. The default behavior when <a class="reference internal" href="../core/defaults.html#sqlalchemy.schema.Computed.params.persisted" title="sqlalchemy.schema.Computed"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Computed.persisted</span></code></a> is
not specified has been changed to align with PostgreSQL 18’s default of
<code class="docutils literal notranslate"><span class="pre">VIRTUAL</span></code>. When <a class="reference internal" href="../core/defaults.html#sqlalchemy.schema.Computed.params.persisted" title="sqlalchemy.schema.Computed"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Computed.persisted</span></code></a> is not specified, no
keyword is rendered on PostgreSQL 18 and later; on older versions a
warning is emitted and <code class="docutils literal notranslate"><span class="pre">STORED</span></code> is used as the default. To explicitly
request <code class="docutils literal notranslate"><span class="pre">STORED</span></code> behavior on all PostgreSQL versions, specify
<code class="docutils literal notranslate"><span class="pre">persisted=True</span></code>.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/12866">#12866</a></p>
</p>
</li>
<li><p class="caption" id="change-2.1.0b1-78"><span class="target" id="change-84b0bbbca6adb5b79d7108b130117888"><strong>[postgresql] [feature] [sql]</strong> <a class="changelog-reference headerlink reference internal" href="#change-84b0bbbca6adb5b79d7108b130117888">¶</a></span><p>Added support for monotonic server-side functions such as PostgreSQL 18’s
<code class="docutils literal notranslate"><span class="pre">uuidv7()</span></code> to work with the <a class="reference internal" href="../core/connections.html#engine-insertmanyvalues"><span class="std std-ref">“Insert Many Values” Behavior for INSERT statements</span></a> feature.
By passing <code class="docutils literal notranslate"><span class="pre">monotonic=True</span></code> to any <a class="reference internal" href="../core/functions.html#sqlalchemy.sql.functions.Function" title="sqlalchemy.sql.functions.Function"><code class="xref py py-class docutils literal notranslate"><span class="pre">Function</span></code></a>, the function can
be used as a sentinel for tracking row order in batched INSERT operations
with RETURNING, allowing the ORM and Core to efficiently batch INSERT
statements while maintaining deterministic row ordering.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="migration_21.html#change-13014-postgresql"><span class="std std-ref">Support for Server-Side Monotonic Functions such as uuidv7() in Batched INSERT Operations</span></a></p>
<p><a class="reference internal" href="../core/connections.html#engine-insertmanyvalues-monotonic-functions"><span class="std std-ref">Configuring Monotonic Functions such as UUIDV7</span></a></p>
<p><a class="reference internal" href="../dialects/postgresql.html#postgresql-monotonic-functions"><span class="std std-ref">PostgreSQL 18 and above UUID with uuidv7 as a server default</span></a></p>
</div>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/13014">#13014</a></p>
</p>
</li>
<li><p class="caption" id="change-2.1.0b1-79"><span class="target" id="change-b1320ef84fc4bc750ea80dfac02c3dde"><strong>[postgresql] [feature]</strong> <a class="changelog-reference headerlink reference internal" href="#change-b1320ef84fc4bc750ea80dfac02c3dde">¶</a></span><p>Added additional emulated error classes for the subclasses of
<code class="docutils literal notranslate"><span class="pre">asyncpg.exception.IntegrityError</span></code> including <code class="docutils literal notranslate"><span class="pre">RestrictViolationError</span></code>,
<code class="docutils literal notranslate"><span class="pre">NotNullViolationError</span></code>, <code class="docutils literal notranslate"><span class="pre">ForeignKeyViolationError</span></code>,
<code class="docutils literal notranslate"><span class="pre">UniqueViolationError</span></code> <code class="docutils literal notranslate"><span class="pre">CheckViolationError</span></code>,
<code class="docutils literal notranslate"><span class="pre">ExclusionViolationError</span></code>.  These exceptions are not directly thrown by
SQLAlchemy’s asyncio emulation, however are available from the
newly added <a class="reference internal" href="../core/exceptions.html#sqlalchemy.exc.DBAPIError.driver_exception" title="sqlalchemy.exc.DBAPIError.driver_exception"><code class="xref py py-attr docutils literal notranslate"><span class="pre">DBAPIError.driver_exception</span></code></a> attribute when a
<a class="reference internal" href="../core/exceptions.html#sqlalchemy.exc.IntegrityError" title="sqlalchemy.exc.IntegrityError"><code class="xref py py-class docutils literal notranslate"><span class="pre">IntegrityError</span></code></a> is caught.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/8047">#8047</a></p>
</p>
</li>
<li><p class="caption" id="change-2.1.0b1-80"><span class="target" id="change-cdafbb7670f2870deeaa60f65eba9a1f"><strong>[postgresql] [usecase]</strong> <a class="changelog-reference headerlink reference internal" href="#change-cdafbb7670f2870deeaa60f65eba9a1f">¶</a></span><p>Added new parameter <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.Enum.params.create_type" title="sqlalchemy.types.Enum"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Enum.create_type</span></code></a> to the Core
<a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.Enum" title="sqlalchemy.types.Enum"><code class="xref py py-class docutils literal notranslate"><span class="pre">Enum</span></code></a> class. This parameter is automatically passed to the
corresponding <a class="reference internal" href="../dialects/postgresql.html#sqlalchemy.dialects.postgresql.ENUM" title="sqlalchemy.dialects.postgresql.ENUM"><code class="xref py py-class docutils literal notranslate"><span class="pre">ENUM</span></code></a> native type during DDL operations,
allowing control over whether the PostgreSQL ENUM type is implicitly
created or dropped within DDL operations that are otherwise targeting
tables only. This provides control over the
<a class="reference internal" href="../dialects/postgresql.html#sqlalchemy.dialects.postgresql.ENUM.params.create_type" title="sqlalchemy.dialects.postgresql.ENUM"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">ENUM.create_type</span></code></a> behavior without requiring
explicit creation of a <a class="reference internal" href="../dialects/postgresql.html#sqlalchemy.dialects.postgresql.ENUM" title="sqlalchemy.dialects.postgresql.ENUM"><code class="xref py py-class docutils literal notranslate"><span class="pre">ENUM</span></code></a> object.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/10604">#10604</a></p>
</p>
</li>
<li><p class="caption" id="change-2.1.0b1-81"><span class="target" id="change-ed8a47043f976f6d23378826c707aa5f"><strong>[postgresql] [usecase]</strong> <a class="changelog-reference headerlink reference internal" href="#change-ed8a47043f976f6d23378826c707aa5f">¶</a></span><p>The PostgreSQL dialect now support reflection of table options, including
the storage parameters, table access method and table spaces. These options
are automatically reflected when autoloading a table, and are also
available via the <code class="xref py py-meth docutils literal notranslate"><span class="pre">Inspector.get_table_options()</span></code> and
<code class="xref py py-meth docutils literal notranslate"><span class="pre">Inspector.get_multi_table_optionsmethod()</span></code> methods.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/10909">#10909</a></p>
</p>
</li>
<li><p class="caption" id="change-2.1.0b1-82"><span class="target" id="change-1e8f9dd712cadac917e5dc3844be320b"><strong>[postgresql] [usecase]</strong> <a class="changelog-reference headerlink reference internal" href="#change-1e8f9dd712cadac917e5dc3844be320b">¶</a></span><p>Added support for PostgreSQL 14+ HSTORE subscripting syntax. When connected
to PostgreSQL 14 or later, HSTORE columns now automatically use the native
subscript notation <code class="docutils literal notranslate"><span class="pre">hstore_col['key']</span></code> instead of the arrow operator
<code class="docutils literal notranslate"><span class="pre">hstore_col</span> <span class="pre">-&gt;</span> <span class="pre">'key'</span></code> for both read and write operations. This provides
better compatibility with PostgreSQL’s native HSTORE subscripting feature
while maintaining backward compatibility with older PostgreSQL versions.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Indexes in existing PostgreSQL databases which were indexed
on an HSTORE subscript expression would need to be updated in order to
match the new SQL syntax.</p>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="migration_21.html#change-12948"><span class="std std-ref">HSTORE subscripting now uses native PostgreSQL 14+ syntax</span></a> - in the <a class="reference internal" href="migration_21.html"><span class="std std-ref">migration guide</span></a></p>
</div>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/12948">#12948</a></p>
</p>
</li>
<li><p class="caption" id="change-2.1.0b1-83"><span class="target" id="change-bb4fc905d5e7a23adcb3dd455617983d"><strong>[postgresql] [usecase]</strong> <a class="changelog-reference headerlink reference internal" href="#change-bb4fc905d5e7a23adcb3dd455617983d">¶</a></span><p>The default DBAPI driver for the PostgreSQL dialect has been changed to
<code class="docutils literal notranslate"><span class="pre">psycopg</span></code> (psycopg version 3) instead of <code class="docutils literal notranslate"><span class="pre">psycopg2</span></code>. The <code class="docutils literal notranslate"><span class="pre">psycopg2</span></code>
driver remains fully supported and can be explicitly specified in the
connection URL using <code class="docutils literal notranslate"><span class="pre">postgresql+psycopg2://</span></code>.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">psycopg</span></code> (version 3) driver includes improvements over <code class="docutils literal notranslate"><span class="pre">psycopg2</span></code>
including better performance when using C extensions and native support
for async operations.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="migration_21.html#change-13010-postgresql"><span class="std std-ref">Default PostgreSQL driver changed to psycopg (psycopg 3)</span></a></p>
</div>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/13010">#13010</a></p>
</p>
</li>
<li><p class="caption" id="change-2.1.0b1-84"><span class="target" id="change-ba9d1d63da46f6e6819f35b645af9e28"><strong>[postgresql] [change]</strong> <a class="changelog-reference headerlink reference internal" href="#change-ba9d1d63da46f6e6819f35b645af9e28">¶</a></span><p>The <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.ARRAY.Comparator.any" title="sqlalchemy.types.ARRAY.Comparator.any"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Comparator.any()</span></code></a> and
<a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.ARRAY.Comparator.all" title="sqlalchemy.types.ARRAY.Comparator.all"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Comparator.all()</span></code></a> methods for the <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.ARRAY" title="sqlalchemy.types.ARRAY"><code class="xref py py-class docutils literal notranslate"><span class="pre">ARRAY</span></code></a>
type are now deprecated for removal; these two methods along with
<a class="reference internal" href="../dialects/postgresql.html#sqlalchemy.dialects.postgresql.Any" title="sqlalchemy.dialects.postgresql.Any"><code class="xref py py-func docutils literal notranslate"><span class="pre">Any()</span></code></a> and <a class="reference internal" href="../dialects/postgresql.html#sqlalchemy.dialects.postgresql.All" title="sqlalchemy.dialects.postgresql.All"><code class="xref py py-func docutils literal notranslate"><span class="pre">All()</span></code></a> have been legacy for
some time as they are superseded by the <a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.any_" title="sqlalchemy.sql.expression.any_"><code class="xref py py-func docutils literal notranslate"><span class="pre">any_()</span></code></a> and
<a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.all_" title="sqlalchemy.sql.expression.all_"><code class="xref py py-func docutils literal notranslate"><span class="pre">all_()</span></code></a> functions, which feature more intuitive use.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/10821">#10821</a></p>
</p>
</li>
<li><p class="caption" id="change-2.1.0b1-85"><span class="target" id="change-a01064523120a1e7642c116922eb56e6"><strong>[postgresql] [change]</strong> <a class="changelog-reference headerlink reference internal" href="#change-a01064523120a1e7642c116922eb56e6">¶</a></span><p>Named types such as <a class="reference internal" href="../dialects/postgresql.html#sqlalchemy.dialects.postgresql.ENUM" title="sqlalchemy.dialects.postgresql.ENUM"><code class="xref py py-class docutils literal notranslate"><span class="pre">ENUM</span></code></a> and
<a class="reference internal" href="../dialects/postgresql.html#sqlalchemy.dialects.postgresql.DOMAIN" title="sqlalchemy.dialects.postgresql.DOMAIN"><code class="xref py py-class docutils literal notranslate"><span class="pre">DOMAIN</span></code></a> (as well as the dialect-agnostic
<a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.Enum" title="sqlalchemy.types.Enum"><code class="xref py py-class docutils literal notranslate"><span class="pre">Enum</span></code></a> version) are now more strongly associated with the
<a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.MetaData" title="sqlalchemy.schema.MetaData"><code class="xref py py-class docutils literal notranslate"><span class="pre">MetaData</span></code></a> at the top of the table hierarchy and are
de-associated with any particular <a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Table" title="sqlalchemy.schema.Table"><code class="xref py py-class docutils literal notranslate"><span class="pre">Table</span></code></a> they may be a part
of. This better represents how PostgreSQL named types exist independently
of any particular table, and that they may be used across many tables
simultaneously.  The change impacts the behavior of the “default schema”
for a named type, as well as the CREATE/DROP behavior in relationship to
the <a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.MetaData" title="sqlalchemy.schema.MetaData"><code class="xref py py-class docutils literal notranslate"><span class="pre">MetaData</span></code></a> and <a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Table" title="sqlalchemy.schema.Table"><code class="xref py py-class docutils literal notranslate"><span class="pre">Table</span></code></a> construct.  The change also
includes a new <a class="reference internal" href="../core/ddl.html#sqlalchemy.schema.CheckFirst" title="sqlalchemy.schema.CheckFirst"><code class="xref py py-class docutils literal notranslate"><span class="pre">CheckFirst</span></code></a> enumeration which allows fine grained
control over “check” queries during DDL operations, as well as that the
<a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.SchemaType.params.inherit_schema" title="sqlalchemy.types.SchemaType"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">SchemaType.inherit_schema</span></code></a> parameter is deprecated and
will emit a deprecation warning when used.  See the migration notes for
full details.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="migration_21.html#change-10594-postgresql"><span class="std std-ref">Changes to Named Type Handling in PostgreSQL</span></a> - Complete details on PostgreSQL named type changes</p>
</div>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/10594">#10594</a>, <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/12690">#12690</a></p>
</p>
</li>
<li><p class="caption" id="change-2.1.0b1-86"><span class="target" id="change-a4efa2af2e2f3d4211648e79f882c6e0"><strong>[postgresql] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-a4efa2af2e2f3d4211648e79f882c6e0">¶</a></span><p>A <a class="reference internal" href="../core/exceptions.html#sqlalchemy.exc.CompileError" title="sqlalchemy.exc.CompileError"><code class="xref py py-class docutils literal notranslate"><span class="pre">CompileError</span></code></a> is raised if attempting to create a PostgreSQL
<a class="reference internal" href="../dialects/postgresql.html#sqlalchemy.dialects.postgresql.ENUM" title="sqlalchemy.dialects.postgresql.ENUM"><code class="xref py py-class docutils literal notranslate"><span class="pre">ENUM</span></code></a> or <a class="reference internal" href="../dialects/postgresql.html#sqlalchemy.dialects.postgresql.DOMAIN" title="sqlalchemy.dialects.postgresql.DOMAIN"><code class="xref py py-class docutils literal notranslate"><span class="pre">DOMAIN</span></code></a> datatype using a
name that matches a known pg_catalog datatype name, and a default schema is
not specified.   These types must be explicit within a schema in order to
be differentiated from the built-in pg_catalog type.  The “public” or
otherwise default schema is not chosen by default here since the type can
only be reflected back using the explicit schema name as well (it is
otherwise not visible due to the pg_catalog name).  Pull request courtesy
Kapil Dagur.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/12761">#12761</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.1.0b1-mysql">
<h3>mysql<a class="headerlink" href="#change-2.1.0b1-mysql" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.1.0b1-87"><span class="target" id="change-5ef7d7ab273f520a576a4d0184afadb4"><strong>[mysql] [feature]</strong> <a class="changelog-reference headerlink reference internal" href="#change-5ef7d7ab273f520a576a4d0184afadb4">¶</a></span><p>Added new construct <a class="reference internal" href="../dialects/mysql.html#sqlalchemy.dialects.mysql.limit" title="sqlalchemy.dialects.mysql.limit"><code class="xref py py-func docutils literal notranslate"><span class="pre">limit()</span></code></a> which can be applied to any
<a class="reference internal" href="../core/dml.html#sqlalchemy.sql.expression.update" title="sqlalchemy.sql.expression.update"><code class="xref py py-func docutils literal notranslate"><span class="pre">update()</span></code></a> or <a class="reference internal" href="../core/dml.html#sqlalchemy.sql.expression.delete" title="sqlalchemy.sql.expression.delete"><code class="xref py py-func docutils literal notranslate"><span class="pre">delete()</span></code></a> to provide the LIMIT keyword to
UPDATE and DELETE.  This new construct supersedes the use of the
“mysql_limit” dialect keyword argument.</p>
<p></p>
</p>
</li>
<li><p class="caption" id="change-2.1.0b1-88"><span class="target" id="change-c480bf16fb65fb4aeaca1a3281b713a5"><strong>[mysql] [mariadb] [reflection]</strong> <a class="changelog-reference headerlink reference internal" href="#change-c480bf16fb65fb4aeaca1a3281b713a5">¶</a></span><p>Updated the reflection logic for indexes in the MariaDB and MySQL
dialect to avoid setting the undocumented <code class="docutils literal notranslate"><span class="pre">type</span></code> key in the
<code class="xref py py-class docutils literal notranslate"><span class="pre">ReflectedIndex</span></code> dicts returned by
<code class="xref py py-class docutils literal notranslate"><span class="pre">get_indexes</span></code> method.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/12240">#12240</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.1.0b1-mariadb">
<h3>mariadb<a class="headerlink" href="#change-2.1.0b1-mariadb" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.1.0b1-89"><span class="target" id="change-afb8877dd36a207f40855db603bd843f"><strong>[mariadb] [usecase]</strong> <a class="changelog-reference headerlink reference internal" href="#change-afb8877dd36a207f40855db603bd843f">¶</a></span><p>Modified the MariaDB dialect so that when using the <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.Uuid" title="sqlalchemy.types.Uuid"><code class="xref py py-class docutils literal notranslate"><span class="pre">Uuid</span></code></a>
datatype with  MariaDB &gt;= 10.7, leaving the
<a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.Uuid.params.native_uuid" title="sqlalchemy.types.Uuid"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Uuid.native_uuid</span></code></a> parameter at its default of True,
the native <code class="docutils literal notranslate"><span class="pre">UUID</span></code> datatype will be rendered in DDL and used for database
communication, rather than <code class="docutils literal notranslate"><span class="pre">CHAR(32)</span></code> (the non-native UUID type) as was
the case previously.   This is a behavioral change since 2.0, where the
generic <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.Uuid" title="sqlalchemy.types.Uuid"><code class="xref py py-class docutils literal notranslate"><span class="pre">Uuid</span></code></a> datatype delivered <code class="docutils literal notranslate"><span class="pre">CHAR(32)</span></code> for all
MySQL and MariaDB variants.   Support for all major DBAPIs is implemented
including support for less common “insertmanyvalues” scenarios where UUID
values are generated in different ways for primary keys.   Thanks much to
Volodymyr Kochetkov for delivering the PR.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/10339">#10339</a></p>
</p>
</li>
<li><p class="caption" id="change-2.1.0b1-90"><span class="target" id="change-47f6ee1d19f21999983395054d513d1a"><strong>[mariadb] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-47f6ee1d19f21999983395054d513d1a">¶</a></span><p>Fixes to the MySQL/MariaDB dialect so that mariadb-specific features such
as the <a class="reference internal" href="../dialects/mysql.html#sqlalchemy.dialects.mysql.INET4" title="sqlalchemy.dialects.mysql.mariadb.INET4"><code class="xref py py-class docutils literal notranslate"><span class="pre">INET4</span></code></a> and <a class="reference internal" href="../dialects/mysql.html#sqlalchemy.dialects.mysql.INET6" title="sqlalchemy.dialects.mysql.mariadb.INET6"><code class="xref py py-class docutils literal notranslate"><span class="pre">INET6</span></code></a> datatype may be
used with an <a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Engine" title="sqlalchemy.engine.Engine"><code class="xref py py-class docutils literal notranslate"><span class="pre">Engine</span></code></a> that uses a <code class="docutils literal notranslate"><span class="pre">mysql://</span></code> URL, if the backend
database is actually a mariadb database.   Previously, support for MariaDB
features when <code class="docutils literal notranslate"><span class="pre">mysql://</span></code> URLs were used instead of <code class="docutils literal notranslate"><span class="pre">mariadb://</span></code> URLs
was ad-hoc; with this issue resolution, the full set of schema / compiler /
type features are now available regardless of how the URL was presented.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/13076">#13076</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.1.0b1-sqlite">
<h3>sqlite<a class="headerlink" href="#change-2.1.0b1-sqlite" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.1.0b1-91"><span class="target" id="change-2b4ae99271cfaad4c747a306f5cb329c"><strong>[sqlite] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-2b4ae99271cfaad4c747a306f5cb329c">¶</a></span><p>Improved the behavior of JSON accessors <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.JSON.Comparator.as_string" title="sqlalchemy.types.JSON.Comparator.as_string"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Comparator.as_string()</span></code></a>,
<a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.JSON.Comparator.as_boolean" title="sqlalchemy.types.JSON.Comparator.as_boolean"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Comparator.as_boolean()</span></code></a>, <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.JSON.Comparator.as_float" title="sqlalchemy.types.JSON.Comparator.as_float"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Comparator.as_float()</span></code></a>,
<a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.JSON.Comparator.as_integer" title="sqlalchemy.types.JSON.Comparator.as_integer"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Comparator.as_integer()</span></code></a> to use CAST in a similar way that
the PostgreSQL, MySQL and SQL Server dialects do to help enforce the
expected Python type is returned.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/11074">#11074</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.1.0b1-mssql">
<h3>mssql<a class="headerlink" href="#change-2.1.0b1-mssql" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.1.0b1-92"><span class="target" id="change-40b146b86d09595c47a17825f0f82019"><strong>[mssql] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-40b146b86d09595c47a17825f0f82019">¶</a></span><p>The <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.JSON.Comparator.as_boolean" title="sqlalchemy.types.JSON.Comparator.as_boolean"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Comparator.as_boolean()</span></code></a> method when used on a JSON value on
SQL Server will now force a cast to occur for values that are not simple
<cite>true</cite>/<cite>false</cite> JSON literals, forcing SQL Server to attempt to interpret
the given value as a 1/0 BIT, or raise an error if not possible. Previously
the expression would return NULL.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/11074">#11074</a></p>
</p>
</li>
<li><p class="caption" id="change-2.1.0b1-93"><span class="target" id="change-b1141414aa538af2420a5ea07452f598"><strong>[mssql] [bug]</strong> <a class="changelog-reference headerlink reference internal" href="#change-b1141414aa538af2420a5ea07452f598">¶</a></span><p>Fix mssql+pyodbc issue where valid plus signs in an already-unquoted
<code class="docutils literal notranslate"><span class="pre">odbc_connect=</span></code> (raw DBAPI) connection string are replaced with spaces.</p>
<p>The pyodbc connector would unconditionally pass the odbc_connect value
to unquote_plus(), even if it was not required. So, if the (unquoted)
odbc_connect value contained <code class="docutils literal notranslate"><span class="pre">PWD=pass+word</span></code> that would get changed to
<code class="docutils literal notranslate"><span class="pre">PWD=pass</span> <span class="pre">word</span></code>, and the login would fail. One workaround was to quote
just the plus sign — <code class="docutils literal notranslate"><span class="pre">PWD=pass%2Bword</span></code> — which would then get unquoted
to <code class="docutils literal notranslate"><span class="pre">PWD=pass+word</span></code>.</p>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/11250">#11250</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.1.0b1-oracle">
<h3>oracle<a class="headerlink" href="#change-2.1.0b1-oracle" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.1.0b1-94"><span class="target" id="change-6e4d322bc5ffac907b672d65b000fbc6"><strong>[oracle] [feature]</strong> <a class="changelog-reference headerlink reference internal" href="#change-6e4d322bc5ffac907b672d65b000fbc6">¶</a></span><p>Added support for native BOOLEAN support in Oracle Database 23c and above.
The Oracle dialect now renders <code class="docutils literal notranslate"><span class="pre">BOOLEAN</span></code> automatically when
<a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.Boolean" title="sqlalchemy.types.Boolean"><code class="xref py py-class docutils literal notranslate"><span class="pre">Boolean</span></code></a> is used in DDL, and also now supports direct use of the
<a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.BOOLEAN" title="sqlalchemy.types.BOOLEAN"><code class="xref py py-class docutils literal notranslate"><span class="pre">BOOLEAN</span></code></a> datatype, when 23c and above is in use.  For Oracle
versions prior to 23c, boolean values continue to be emulated using
SMALLINT as before.   Special case handling is also present to ensure a
SMALLINT that’s interpreted with the <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.Boolean" title="sqlalchemy.types.Boolean"><code class="xref py py-class docutils literal notranslate"><span class="pre">Boolean</span></code></a> datatype on Oracle
Database 23c and above continues to return bool values. Pull request
courtesy Yeongbae Jeon.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="../dialects/oracle.html#oracle-boolean-support"><span class="std std-ref">Boolean Support</span></a></p>
</div>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/11633">#11633</a></p>
</p>
</li>
<li><p class="caption" id="change-2.1.0b1-95"><span class="target" id="change-ab3ea239460fadc1d7204ea9c0d0aaaa"><strong>[oracle] [usecase]</strong> <a class="changelog-reference headerlink reference internal" href="#change-ab3ea239460fadc1d7204ea9c0d0aaaa">¶</a></span><p>The default DBAPI driver for the Oracle Database dialect has been changed
to <code class="docutils literal notranslate"><span class="pre">oracledb</span></code> instead of <code class="docutils literal notranslate"><span class="pre">cx_oracle</span></code>. The <code class="docutils literal notranslate"><span class="pre">cx_oracle</span></code> driver remains
fully supported and can be explicitly specified in the connection URL
using <code class="docutils literal notranslate"><span class="pre">oracle+cx_oracle://</span></code>.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">oracledb</span></code> driver is a modernized version of <code class="docutils literal notranslate"><span class="pre">cx_oracle</span></code> with
better performance characteristics and ongoing active development from
Oracle.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="migration_21.html#change-13010-oracle"><span class="std std-ref">Default Oracle driver changed to python-oracledb</span></a></p>
</div>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/13010">#13010</a></p>
</p>
</li>
</ul>
</section>
<section id="change-2.1.0b1-tests">
<h3>tests<a class="headerlink" href="#change-2.1.0b1-tests" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.1.0b1-96"><span class="target" id="change-d067dc635e89594f82cd9618a3aaf41e"><strong>[tests] [change]</strong> <a class="changelog-reference headerlink reference internal" href="#change-d067dc635e89594f82cd9618a3aaf41e">¶</a></span><p>The top-level test runner has been changed to use <code class="docutils literal notranslate"><span class="pre">nox</span></code>, adding a
<code class="docutils literal notranslate"><span class="pre">noxfile.py</span></code> as well as some included modules.   The <code class="docutils literal notranslate"><span class="pre">tox.ini</span></code> file
remains in place so that <code class="docutils literal notranslate"><span class="pre">tox</span></code> runs will continue to function in the near
term, however it will be eventually removed and improvements and
maintenance going forward will be only towards <code class="docutils literal notranslate"><span class="pre">noxfile.py</span></code>.</p>
<p></p>
</p>
</li>
</ul>
</section>
<section id="change-2.1.0b1-misc">
<h3>misc<a class="headerlink" href="#change-2.1.0b1-misc" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p class="caption" id="change-2.1.0b1-97"><span class="target" id="change-0105c94d7a13190750bdaa4844b4a87b"><strong>[misc] [changed]</strong> <a class="changelog-reference headerlink reference internal" href="#change-0105c94d7a13190750bdaa4844b4a87b">¶</a></span><p>Removed multiple api that were deprecated in the 1.3 series and earlier.
The list of removed features includes:</p>
<ul>
<li><p>The <code class="docutils literal notranslate"><span class="pre">force</span></code> parameter of <code class="docutils literal notranslate"><span class="pre">IdentifierPreparer.quote</span></code> and
<code class="docutils literal notranslate"><span class="pre">IdentifierPreparer.quote_schema</span></code>;</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">threaded</span></code> parameter of the cx-Oracle dialect;</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">_json_serializer</span></code> and <code class="docutils literal notranslate"><span class="pre">_json_deserializer</span></code> parameters of the
SQLite dialect;</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">collection.converter</span></code> decorator;</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">Mapper.mapped_table</span></code> property;</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">Session.close_all</span></code> method;</p></li>
<li><p>Support for multiple arguments in <a class="reference internal" href="../orm/queryguide/columns.html#sqlalchemy.orm.defer" title="sqlalchemy.orm.defer"><code class="xref py py-func docutils literal notranslate"><span class="pre">defer()</span></code></a> and
<a class="reference internal" href="../orm/queryguide/columns.html#sqlalchemy.orm.undefer" title="sqlalchemy.orm.undefer"><code class="xref py py-func docutils literal notranslate"><span class="pre">undefer()</span></code></a>.</p></li>
</ul>
<p>References: <a class="reference external" href="https://www.sqlalchemy.org/trac/ticket/12441">#12441</a></p>
</p>
</li>
</ul>
</section>
</section>
</section>

    </div>

</div>

<div id="docs-bottom-navigation" class="docs-navigation-links, withsidebar">
        Previous:
        <a href="migration_21.html" title="previous chapter">What’s New in SQLAlchemy 2.1?</a>
        Next:
        <a href="changelog_20.html" title="next chapter">2.0 Changelog</a>

    <div id="docs-copyright">
        &copy; <a href="../copyright.html">Copyright</a> 2007-2026, the SQLAlchemy authors and contributors.


    <p><b>flambé!</b> the dragon and <b><i>The Alchemist</i></b> image designs created and generously donated by <a href="https://github.com/vmalloc">Rotem Yaari</a>.</p>

        Created using <a href="https://www.sphinx-doc.org">Sphinx</a> 9.1.0.

    Documentation last generated: Wed 21 Jan 2026 02:26:37 PM  EST

    </div>
</div>

</div>



        
        

    <script type="text/javascript">
      document.documentElement.dataset.content_root = '../';

    </script>

    <!-- begin iterate through sphinx environment script_files -->
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script type="text/javascript" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/sphinx_highlight.js"></script>
        <script type="text/javascript" src="../_static/clipboard.min.js"></script>
        <script type="text/javascript" src="../_static/copybutton.js"></script>
    <!-- end iterate through sphinx environment script_files -->

    <script type="text/javascript" src="../_static/init.js"></script>


    </body>
</html>


