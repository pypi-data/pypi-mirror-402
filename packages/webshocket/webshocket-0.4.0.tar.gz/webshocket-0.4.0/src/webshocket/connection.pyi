import websockets
from typing import Any, Union, Iterable, Optional, Generic, TypeVar
from uuid import UUID

from .handler import WebSocketHandler, SessionState
from .enum import ConnectionState
from .packets import Packet, RPCResponse

TState = TypeVar("TState", bound=SessionState)

class ClientConnection(Generic[TState]):
    __slots__ = ("_packet_queue", "_protocol", "_handler", "connection_state", "session_state", "uid")

    _protocol: websockets.ServerConnection
    session_state: TState
    connection_state: ConnectionState
    uid: UUID

    def __init__(
        self,
        websocket_protocol: websockets.ServerConnection,
        handler: WebSocketHandler,
        packet_qsize: int = 1,
    ) -> None: ...
    @property
    def subscribed_channel(self) -> set[str]: ...
    async def send(self, data: Union[Any, Packet]) -> None: ...
    async def _send_rpc_response(self, rpc_response: "RPCResponse") -> None: ...
    async def recv(self, timeout: Optional[float] = 30.0) -> Packet: ...
    def subscribe(self, channel: Union[str, Iterable[str]]) -> None: ...
    def unsubscribe(self, channel: Union[str, Iterable[str]]) -> None: ...
    async def close(self, code: int = 1000, reason: str = "") -> None: ...
    def __setattr__(self, name: str, value: Any) -> None: ...
    def __getattr__(self, name: str) -> Any: ...
    def __delattr__(self, name: str) -> None: ...
    def __setitem__(self, name: str, value: Any) -> None: ...
    def __getitem__(self, name: str) -> Any: ...
    def __delitem__(self, name: str) -> None: ...
    def __repr__(self) -> str: ...
    def __hash__(self) -> int: ...
    def __eq__(self, other: object) -> bool: ...
