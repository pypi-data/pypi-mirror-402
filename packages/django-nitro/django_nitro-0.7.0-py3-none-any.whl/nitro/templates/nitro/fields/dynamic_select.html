<!-- Nitro Dynamic Select - Options from Alpine State -->
{% if is_edit_buffer %}
{# For edit_buffer fields, wrap in x-if to prevent null access errors #}
<template x-if="{{ buffer_name }}">
    <div>
        {% if label %}
        <label class="block text-sm font-medium text-gray-700 mb-1">
            {{ label }}{% if required %} *{% endif %}
        </label>
        {% endif %}
        <select
            class="w-full rounded-lg border-gray-300"
            x-model="{{ field }}"
            @change="trackChange('{{ field }}'); {{ change_handler }}"
            :class="{'border-red-500': {{ error_path }}}"
            {{ extra_attrs|safe }}
            {% if debug %}data-nitro-debug="nitro_dynamic_select: field='{{ field }}' options='{{ options_var }}'"{% endif %}
        >
            <option value="">{{ placeholder }}</option>
            <template x-for="opt in {{ options_var }}" :key="opt.{{ option_value }}">
                <option :value="opt.{{ option_value }}" x-text="opt.{{ option_label }}"></option>
            </template>
        </select>
    </div>
</template>
{% else %}
<div>
    {% if label %}
    <label class="block text-sm font-medium text-gray-700 mb-1">
        {{ label }}{% if required %} *{% endif %}
    </label>
    {% endif %}
    <select
        class="w-full rounded-lg border-gray-300"
        x-model="{{ field }}"
        @change="trackChange('{{ field }}'); {{ change_handler }}"
        :class="{'border-red-500': {{ error_path }}}"
        {{ extra_attrs|safe }}
        {% if debug %}data-nitro-debug="nitro_dynamic_select: field='{{ field }}' options='{{ options_var }}'"{% endif %}
    >
        <option value="">{{ placeholder }}</option>
        <template x-for="opt in {{ options_var }}" :key="opt.{{ option_value }}">
            <option :value="opt.{{ option_value }}" x-text="opt.{{ option_label }}"></option>
        </template>
    </select>
</div>
{% endif %}
