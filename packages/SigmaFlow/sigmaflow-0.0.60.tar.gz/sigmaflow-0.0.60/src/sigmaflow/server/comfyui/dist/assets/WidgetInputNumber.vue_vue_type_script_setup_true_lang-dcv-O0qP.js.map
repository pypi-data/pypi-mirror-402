{"version":3,"file":"WidgetInputNumber.vue_vue_type_script_setup_true_lang-dcv-O0qP.js","sources":["../../../../../../../ComfyUI_frontend/src/renderer/extensions/vueNodes/widgets/components/WidgetInputNumberInput.vue","../../../../../../../ComfyUI_frontend/src/renderer/extensions/vueNodes/widgets/composables/useNumberStepCalculation.ts","../../../../../../../ComfyUI_frontend/src/renderer/extensions/vueNodes/widgets/composables/useNumberWidgetButtonPt.ts","../../../../../../../ComfyUI_frontend/src/renderer/extensions/vueNodes/widgets/components/WidgetInputNumberSlider.vue","../../../../../../../ComfyUI_frontend/src/renderer/extensions/vueNodes/widgets/components/WidgetInputNumber.vue"],"sourcesContent":["<script setup lang=\"ts\">\nimport InputNumber from 'primevue/inputnumber'\nimport { computed } from 'vue'\n\nimport type { SimplifiedWidget } from '@/types/simplifiedWidget'\nimport { cn } from '@/utils/tailwindUtil'\nimport {\n  INPUT_EXCLUDED_PROPS,\n  filterWidgetProps\n} from '@/utils/widgetPropFilter'\n\nimport { WidgetInputBaseClass } from './layout'\nimport WidgetLayoutField from './layout/WidgetLayoutField.vue'\n\nconst props = defineProps<{\n  widget: SimplifiedWidget<number>\n}>()\n\nconst modelValue = defineModel<number>({ default: 0 })\n\nconst filteredProps = computed(() =>\n  filterWidgetProps(props.widget.options, INPUT_EXCLUDED_PROPS)\n)\n\n// Get the precision value for proper number formatting\nconst precision = computed(() => {\n  const p = props.widget.options?.precision\n  // Treat negative or non-numeric precision as undefined\n  return typeof p === 'number' && p >= 0 ? p : undefined\n})\n\n// Calculate the step value based on precision or widget options\nconst stepValue = computed(() => {\n  // Use step2 (correct input spec value) if available\n  if (props.widget.options?.step2 !== undefined) {\n    return Number(props.widget.options.step2)\n  }\n  // Use step / 10 for custom large step values (> 10) to match litegraph behavior\n  // This is important for extensions like Impact Pack that use custom step values (e.g., 640)\n  // We skip default step values (1, 10) to avoid affecting normal widgets\n  const step = props.widget.options?.step\n  if (step !== undefined && step > 10) {\n    return Number(step) / 10\n  }\n  // Otherwise, derive from precision\n  if (precision.value !== undefined) {\n    if (precision.value === 0) {\n      return 1\n    }\n    // For precision > 0, step = 1 / (10^precision)\n    // precision 1 → 0.1, precision 2 → 0.01, etc.\n    return Number((1 / Math.pow(10, precision.value)).toFixed(precision.value))\n  }\n  // Default to 'any' for unrestricted stepping\n  return 0\n})\n\n// Disable grouping separators by default unless explicitly enabled by the node author\nconst useGrouping = computed(() => {\n  return props.widget.options?.useGrouping === true\n})\n\n// Check if increment/decrement buttons should be disabled due to precision limits\nconst buttonsDisabled = computed(() => {\n  const currentValue = modelValue.value ?? 0\n  return (\n    !Number.isFinite(currentValue) ||\n    Math.abs(currentValue) > Number.MAX_SAFE_INTEGER\n  )\n})\n\nconst buttonTooltip = computed(() => {\n  if (buttonsDisabled.value) {\n    return 'Increment/decrement disabled: value exceeds JavaScript precision limit (±2^53)'\n  }\n  return null\n})\n</script>\n\n<template>\n  <WidgetLayoutField :widget>\n    <InputNumber\n      v-model=\"modelValue\"\n      v-tooltip=\"buttonTooltip\"\n      v-bind=\"filteredProps\"\n      fluid\n      button-layout=\"horizontal\"\n      size=\"small\"\n      variant=\"outlined\"\n      :step=\"stepValue\"\n      :min-fraction-digits=\"precision\"\n      :max-fraction-digits=\"precision\"\n      :use-grouping=\"useGrouping\"\n      :class=\"cn(WidgetInputBaseClass, 'grow text-xs')\"\n      :aria-label=\"widget.name\"\n      :show-buttons=\"!buttonsDisabled\"\n      :pt=\"{\n        root: {\n          class: cn(\n            '[&>input]:bg-transparent [&>input]:border-0',\n            '[&>input]:truncate [&>input]:min-w-[4ch]',\n            $slots.default && '[&>input]:pr-7'\n          )\n        },\n        decrementButton: {\n          class: 'w-8 border-0'\n        },\n        incrementButton: {\n          class: 'w-8 border-0'\n        }\n      }\"\n    >\n      <template #incrementicon>\n        <span class=\"pi pi-plus text-sm\" />\n      </template>\n      <template #decrementicon>\n        <span class=\"pi pi-minus text-sm\" />\n      </template>\n    </InputNumber>\n    <div class=\"absolute top-5 right-8 h-4 w-7 -translate-y-4/5 flex\">\n      <slot />\n    </div>\n  </WidgetLayoutField>\n</template>\n\n<style scoped>\n:deep(.p-inputnumber-input) {\n  height: 1.625rem;\n  margin: 1px 0;\n  box-shadow: none;\n}\n</style>\n","import { computed, toValue } from 'vue'\nimport type { MaybeRefOrGetter } from 'vue'\n\ninterface NumberWidgetOptions {\n  step?: number\n  step2?: number\n  precision?: number\n}\n\n/**\n * Shared composable for calculating step values in number input widgets\n * Handles both explicit step2 values and precision-derived steps\n */\nexport function useNumberStepCalculation(\n  options: NumberWidgetOptions | undefined,\n  precisionArg: MaybeRefOrGetter<number | undefined>,\n  returnUndefinedForDefault = false\n) {\n  return computed(() => {\n    const precision = toValue(precisionArg)\n    // Use step2 (correct input spec value) if available\n    if (options?.step2 !== undefined) {\n      return Number(options.step2)\n    }\n    // Use step / 10 for custom large step values (> 10) to match litegraph behavior\n    // This is important for extensions like Impact Pack that use custom step values (e.g., 640)\n    // We skip default step values (1, 10) to avoid affecting normal widgets\n    const step = options?.step\n    if (step !== undefined && step > 10) {\n      return Number(step) / 10\n    }\n\n    if (precision === undefined) {\n      return returnUndefinedForDefault ? undefined : 0\n    }\n\n    if (precision === 0) return 1\n\n    // For precision > 0, step = 1 / (10^precision)\n    const calculatedStep = 1 / Math.pow(10, precision)\n    return returnUndefinedForDefault\n      ? calculatedStep\n      : Number(calculatedStep.toFixed(precision))\n  })\n}\n","import { cn } from '@comfyorg/tailwind-utils'\n\nconst sharedButtonClasses = cn(\n  'inline-flex items-center justify-center border-0 bg-transparent text-inherit transition-colors duration-150 ease-in-out ',\n  'hover:bg-node-component-surface-hovered active:bg-node-component-surface-selected',\n  'disabled:bg-node-component-disabled disabled:text-node-icon-disabled disabled:cursor-not-allowed'\n)\n\nexport function useNumberWidgetButtonPt(options?: {\n  roundedLeft?: boolean\n  roundedRight?: boolean\n}) {\n  const { roundedLeft = false, roundedRight = false } = options ?? {}\n\n  const increment = cn(sharedButtonClasses, roundedRight && 'rounded-r-lg')\n  const decrement = cn(sharedButtonClasses, roundedLeft && 'rounded-l-lg')\n\n  return {\n    incrementButton: {\n      class: increment\n    },\n    decrementButton: {\n      class: decrement\n    }\n  }\n}\n","<template>\n  <WidgetLayoutField :widget=\"widget\">\n    <div :class=\"cn(WidgetInputBaseClass, 'flex items-center gap-2 pl-3 pr-2')\">\n      <Slider\n        :model-value=\"[modelValue]\"\n        v-bind=\"filteredProps\"\n        class=\"flex-grow text-xs\"\n        :step=\"stepValue\"\n        :aria-label=\"widget.name\"\n        @update:model-value=\"updateLocalValue\"\n      />\n      <InputNumber\n        :key=\"timesEmptied\"\n        :model-value=\"modelValue\"\n        v-bind=\"filteredProps\"\n        :step=\"stepValue\"\n        :min-fraction-digits=\"precision\"\n        :max-fraction-digits=\"precision\"\n        :aria-label=\"widget.name\"\n        size=\"small\"\n        pt:pc-input-text:root=\"min-w-[4ch] bg-transparent border-none text-center truncate\"\n        class=\"w-16\"\n        :pt=\"sliderNumberPt\"\n        @update:model-value=\"handleNumberInputUpdate\"\n      />\n    </div>\n  </WidgetLayoutField>\n</template>\n\n<script setup lang=\"ts\">\nimport InputNumber from 'primevue/inputnumber'\nimport { computed, ref } from 'vue'\n\nimport Slider from '@/components/ui/slider/Slider.vue'\nimport type { SimplifiedWidget } from '@/types/simplifiedWidget'\nimport { cn } from '@/utils/tailwindUtil'\nimport {\n  STANDARD_EXCLUDED_PROPS,\n  filterWidgetProps\n} from '@/utils/widgetPropFilter'\n\nimport { useNumberStepCalculation } from '../composables/useNumberStepCalculation'\nimport { useNumberWidgetButtonPt } from '../composables/useNumberWidgetButtonPt'\nimport { WidgetInputBaseClass } from './layout'\nimport WidgetLayoutField from './layout/WidgetLayoutField.vue'\n\nconst { widget } = defineProps<{\n  widget: SimplifiedWidget<number>\n}>()\n\nconst modelValue = defineModel<number>({ default: 0 })\n\nconst timesEmptied = ref(0)\n\nconst updateLocalValue = (newValue: number[] | undefined): void => {\n  if (newValue?.length) modelValue.value = newValue[0]\n}\n\nconst handleNumberInputUpdate = (newValue: number | undefined) => {\n  if (newValue !== undefined) {\n    updateLocalValue([newValue])\n    return\n  }\n  timesEmptied.value += 1\n}\n\nconst filteredProps = computed(() =>\n  filterWidgetProps(widget.options, STANDARD_EXCLUDED_PROPS)\n)\n\nconst p = widget.options?.precision\nconst precision = typeof p === 'number' && p >= 0 ? p : undefined\n\n// Calculate the step value based on precision or widget options\nconst stepValue = useNumberStepCalculation(widget.options, precision, true)\n\nconst sliderNumberPt = useNumberWidgetButtonPt({\n  roundedLeft: true,\n  roundedRight: true\n})\n</script>\n\n<style scoped>\n:deep(.p-inputnumber-button.p-disabled .pi),\n:deep(.p-inputnumber-button.p-disabled .p-icon) {\n  color: var(--color-node-icon-disabled) !important;\n}\n</style>\n","<script setup lang=\"ts\">\nimport { computed } from 'vue'\n\nimport type {\n  SimplifiedControlWidget,\n  SimplifiedWidget\n} from '@/types/simplifiedWidget'\n\nimport WidgetInputNumberInput from './WidgetInputNumberInput.vue'\nimport WidgetInputNumberSlider from './WidgetInputNumberSlider.vue'\nimport WidgetWithControl from './WidgetWithControl.vue'\n\nconst props = defineProps<{\n  widget: SimplifiedWidget<number>\n}>()\n\nconst modelValue = defineModel<number>({ default: 0 })\n\nconst hasControlAfterGenerate = computed(() => {\n  return !!props.widget.controlWidget\n})\n</script>\n\n<template>\n  <WidgetWithControl\n    v-if=\"hasControlAfterGenerate\"\n    v-model=\"modelValue\"\n    :widget=\"widget as SimplifiedControlWidget<number>\"\n    :component=\"\n      widget.type === 'slider'\n        ? WidgetInputNumberSlider\n        : WidgetInputNumberInput\n    \"\n  />\n  <component\n    :is=\"\n      widget.type === 'slider'\n        ? WidgetInputNumberSlider\n        : WidgetInputNumberInput\n    \"\n    v-else\n    v-model=\"modelValue\"\n    :widget=\"widget\"\n    v-bind=\"$attrs\"\n  />\n</template>\n"],"names":["props","__props","modelValue","_useModel","filteredProps","computed","filterWidgetProps","INPUT_EXCLUDED_PROPS","precision","p","stepValue","step","useGrouping","buttonsDisabled","currentValue","buttonTooltip","useNumberStepCalculation","options","precisionArg","returnUndefinedForDefault","toValue","calculatedStep","__name","sharedButtonClasses","cn","useNumberWidgetButtonPt","roundedLeft","roundedRight","increment","decrement","timesEmptied","ref","updateLocalValue","newValue","handleNumberInputUpdate","STANDARD_EXCLUDED_PROPS","sliderNumberPt","hasControlAfterGenerate"],"mappings":"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"}