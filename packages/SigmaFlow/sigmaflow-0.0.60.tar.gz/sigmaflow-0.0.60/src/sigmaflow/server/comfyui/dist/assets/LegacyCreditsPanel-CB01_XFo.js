var Q=Object.defineProperty;var l=(h,m)=>Q(h,"name",{value:m,configurable:!0});import{a as O,w as W,g as X,s as Y,ad as z,d as Z,ae as L,q,C as ee}from"./vendor-primevue-6nO4LMK3.js";import{u as V}from"./vendor-vue-Cz2Pyvdp.js";import{a3 as R,a4 as N,a5 as te,a6 as H,_ as S,o as se,a0 as ae,p as oe,a2 as ne,A as ie,m as re,dq as le}from"./index-Btwre5kD.js";import{bx as j,E as k,c as $,d as p,e as n,z as c,by as a,j as T,q as I,k as u,u as i,s as G,r as A,w as J,cp as K,h as ce,A as D,l as de}from"./vendor-other-PcOcwbNM.js";import"./vendor-xterm-CWYFmgbN.js";import"./vendor-three-Bbe9LX3q.js";import"./vendor-tiptap-BsEBJZ_K.js";const ue={key:0,class:"flex items-center gap-1"},me={class:"flex items-center gap-2"},pe={key:1,class:"flex items-center gap-1"},fe=j({__name:"UserCredit",props:{textClass:{},showCreditsOnly:{type:Boolean}},setup(h){const m=R(),x=k(()=>m.isFetchingBalance),{t:w,locale:f}=V(),v=k(()=>{const _=m.balance?.effective_balance_micros??m.balance?.amount_micros??0;return`${N({cents:_,locale:f.value})} ${w("credits.credits")}`}),d=k(()=>{const _=m.balance?.effective_balance_micros??m.balance?.amount_micros??0;return N({cents:_,locale:f.value,numberOptions:{minimumFractionDigits:0,maximumFractionDigits:0}})});return(_,g)=>x.value?(p(),$("div",ue,[n("div",me,[c(a(O),{shape:"circle",width:"1.5rem",height:"1.5rem"})]),g[0]||(g[0]=n("div",{class:"flex-1"},null,-1)),c(a(O),{width:"8rem",height:"2rem"})])):(p(),$("div",pe,[_.showCreditsOnly?I("",!0):(p(),T(a(W),{key:0,severity:"secondary",rounded:"",class:"p-1 text-amber-400"},{icon:u(()=>g[1]||(g[1]=[n("i",{class:"icon-[lucide--component]"},null,-1)])),_:1})),n("div",{class:G(_.textClass)},i(_.showCreditsOnly?d.value:v.value),3)]))}});var F=(h=>(h.CREDIT_ADDED="credit_added",h.ACCOUNT_CREATED="account_created",h.API_USAGE_STARTED="api_usage_started",h.API_USAGE_COMPLETED="api_usage_completed",h))(F||{});const M=K.create({baseURL:H(),headers:{"Content-Type":"application/json"}}),ve=l(()=>{const h=A(!1),m=A(null),{d:x}=V();J(()=>H(),e=>{M.defaults.baseURL=e});const w=l((e,s,b)=>{if(te(e))return;let y;if(!K.isAxiosError(e))y=`${s} failed: ${e instanceof Error?e.message:String(e)}`;else{const o=e,r=o.response?.status;r&&b?.[r]?y=b[r]:y=o.response?.data?.message??`${s} failed with status ${r}`}m.value=y},"handleRequestError"),f=l(async(e,s)=>{const{errorContext:b,routeSpecificErrors:y}=s;h.value=!0,m.value=null;try{return(await e()).data}catch(o){return w(o,b,y),null}finally{h.value=!1}},"executeRequest");function v(e){switch(e){case"credit_added":return"Credits Added";case"account_created":return"Account Created";case"api_usage_completed":return"API Usage";default:return e}}l(v,"formatEventType");function d(e){const s=new Date(e);return x(s,{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}l(d,"formatDate");function _(e){return e.split("_").map(s=>s.charAt(0).toUpperCase()+s.slice(1)).join(" ")}l(_,"formatJsonKey");function g(e){return typeof e=="number"?e.toLocaleString():typeof e=="string"&&e.match(/^\d{4}-\d{2}-\d{2}/)?new Date(e).toLocaleString():e}l(g,"formatJsonValue");function P(e){switch(e){case"credit_added":return"success";case"account_created":return"info";case"api_usage_completed":return"warning";default:return"info"}}l(P,"getEventSeverity");function E(e){const{amount:s,api_name:b,model:y,...o}=e.params||{};return Object.keys(o).length>0}l(E,"hasAdditionalInfo");function B(e){const{...s}=e.params||{};return Object.entries(s).map(([b,y])=>{const o=_(b),r=g(y);return`<strong>${o}:</strong> ${r}`}).join("<br>")}l(B,"getTooltipContent");function t(e){return e?(e/100).toFixed(2):"0.00"}l(t,"formatAmount");async function C({page:e=1,limit:s=10}={}){const b="Fetching customer events",y={400:"Invalid input, object invalid",404:"Not found"},o=await R().getAuthHeader();return o?await f(()=>M.get("/customers/events",{params:{page:e,limit:s},headers:o}),{errorContext:b,routeSpecificErrors:y}):(m.value="Authentication header is missing",null)}return l(C,"getMyEvents"),{isLoading:h,error:m,getMyEvents:C,formatEventType:v,getEventSeverity:P,formatAmount:t,hasAdditionalInfo:E,formatDate:d,formatJsonKey:_,formatJsonValue:g,getTooltipContent:B}},"useCustomerEventsService"),ge={key:0,class:"flex items-center justify-center p-8"},he={key:1,class:"p-4"},_e={class:"event-details"},ye={key:0,class:"font-semibold text-green-500"},Ce={key:1},be={key:2,class:"flex flex-col gap-1"},$e={class:"font-semibold"},xe={class:"text-sm text-smoke-400"},we=j({__name:"UsageLogsTable",setup(h,{expose:m}){const x=A([]),w=A(!0),f=A(null),v=ve(),d=A({page:1,limit:7,total:0,totalPages:0}),_=k(()=>(d.value.page-1)*d.value.limit),g=k(()=>{const t=new Map;return x.value.forEach(C=>{v.hasAdditionalInfo(C)&&C.event_id&&t.set(C.event_id,v.getTooltipContent(C))}),t}),P=l(async()=>{w.value=!0,f.value=null;try{const t=await v.getMyEvents({page:d.value.page,limit:d.value.limit});t?(t.events&&(x.value=t.events),t.page&&(d.value.page=t.page),t.limit&&(d.value.limit=t.limit),t.total&&(d.value.total=t.total),t.totalPages&&(d.value.totalPages=t.totalPages),se()?.checkForCompletedTopup(t.events)):f.value=v.error.value||"Failed to load events"}catch(t){f.value=t instanceof Error?t.message:"Unknown error",console.error("Error loading events:",t)}finally{w.value=!1}},"loadEvents"),E=l(t=>{d.value.page=t.page+1,P().catch(C=>{console.error("Error loading events:",C)})},"onPageChange");return m({refresh:l(async()=>{d.value.page=1,await P()},"refresh")}),(t,C)=>{const e=ce("tooltip");return p(),$("div",null,[w.value?(p(),$("div",ge,[c(a(X))])):f.value?(p(),$("div",he,[c(a(Y),{severity:"error",closable:!1},{default:u(()=>[D(i(f.value),1)]),_:1})])):(p(),T(a(z),{key:2,value:x.value,paginator:!0,rows:d.value.limit,"total-records":d.value.total,first:_.value,lazy:!0,class:"p-datatable-sm custom-datatable",onPage:E},{default:u(()=>[c(a(L),{field:"event_type",header:t.$t("credits.eventType")},{body:u(({data:s})=>[c(a(Z),{value:a(v).formatEventType(s.event_type),severity:a(v).getEventSeverity(s.event_type)},null,8,["value","severity"])]),_:1},8,["header"]),c(a(L),{field:"details",header:t.$t("credits.details")},{body:u(({data:s})=>[n("div",_e,[s.event_type===a(F).CREDIT_ADDED?(p(),$("div",ye,i(t.$t("credits.added"))+" $"+i(a(v).formatAmount(s.params?.amount)),1)):s.event_type===a(F).ACCOUNT_CREATED?(p(),$("div",Ce,i(t.$t("credits.accountInitialized")),1)):s.event_type===a(F).API_USAGE_COMPLETED?(p(),$("div",be,[n("div",$e,i(s.params?.api_name||"API"),1),n("div",xe,i(t.$t("credits.model"))+": "+i(s.params?.model||"-"),1)])):I("",!0)])]),_:1},8,["header"]),c(a(L),{field:"createdAt",header:t.$t("credits.time")},{body:u(({data:s})=>[D(i(a(v).formatDate(s.createdAt)),1)]),_:1},8,["header"]),c(a(L),{field:"params",header:t.$t("credits.additionalInfo")},{body:u(({data:s})=>[a(v).hasAdditionalInfo(s)?de((p(),T(S,{key:0,variant:"textonly",size:"icon-sm","aria-label":t.$t("credits.additionalInfo")},{default:u(()=>C[0]||(C[0]=[n("i",{class:"pi pi-info-circle"},null,-1)])),_:2},1032,["aria-label"])),[[e,{escape:!1,value:g.value.get(s.event_id)||"",pt:{text:{style:{width:"max-content !important"}}}},void 0,{top:!0}]]):I("",!0)]),_:1},8,["header"])]),_:1},8,["value","rows","total-records","first"]))])}}}),Ae={class:"flex h-full flex-col"},ke={class:"mb-2 text-2xl font-bold"},Ee={class:"flex flex-col gap-2"},Se={class:"text-sm font-medium text-muted"},De={class:"flex items-center justify-between"},Te={class:"flex flex-row items-center"},Pe={key:1,class:"text-xs text-muted"},Ue={class:"flex items-center justify-between"},Le={key:0,class:"grow"},Ie={class:"text-sm font-medium"},Be={class:"text-xs text-muted"},Fe={class:"flex flex-row gap-2"},He=j({__name:"LegacyCreditsPanel",setup(h){const{buildDocsUrl:m,docsPaths:x}=ae(),w=oe(),f=R(),v=ne(),d=ie(),{isActiveSubscription:_}=re(),g=k(()=>f.loading),P=k(()=>f.isFetchingBalance),E=A(null),B=k(()=>f.lastBalanceUpdateTime?f.lastBalanceUpdateTime.toLocaleString():"");J(()=>f.lastBalanceUpdateTime,(o,r)=>{o&&o!==r&&E.value&&E.value.refresh()});const t=l(()=>{w.showTopUpCreditsDialog()},"handlePurchaseCreditsClick"),C=l(async()=>{await v.accessBillingPortal()},"handleCreditsHistoryClick"),e=l(async()=>{await d.execute("Comfy.ContactSupport")},"handleMessageSupport"),s=l(()=>{window.open(m("/tutorials/api-nodes/faq",{includeLocale:!0}),"_blank")},"handleFaqClick"),b=l(()=>{window.open(m(x.partnerNodesPricing,{includeLocale:!0}),"_blank")},"handleOpenPartnerNodesInfo"),y=A([]);return(o,r)=>(p(),T(a(ee),{value:"Credits",class:"credits-container h-full"},{default:u(()=>[n("div",Ae,[n("h2",ke,i(o.$t("credits.credits")),1),c(a(q)),n("div",Ee,[n("h3",Se,i(o.$t("credits.yourCreditBalance")),1),n("div",De,[c(fe,{"text-class":"text-3xl font-bold"}),g.value?(p(),T(a(O),{key:0,width:"2rem",height:"2rem"})):a(_)?(p(),T(S,{key:1,loading:g.value,onClick:t},{default:u(()=>[D(i(o.$t("credits.purchaseCredits")),1)]),_:1},8,["loading"])):I("",!0)]),n("div",Te,[P.value?(p(),T(a(O),{key:0,width:"12rem",height:"1rem",class:"text-xs"})):B.value?(p(),$("div",Pe,i(o.$t("credits.lastUpdated"))+": "+i(B.value),1)):I("",!0),c(S,{variant:"muted-textonly",size:"icon-sm","aria-label":o.$t("g.refresh"),onClick:r[0]||(r[0]=()=>a(v).fetchBalance())},{default:u(()=>r[1]||(r[1]=[n("i",{class:"pi pi-refresh"},null,-1)])),_:1},8,["aria-label"])])]),n("div",Ue,[n("h3",null,i(o.$t("credits.activity")),1),c(S,{variant:"muted-textonly",loading:g.value,onClick:C},{default:u(()=>[r[2]||(r[2]=n("i",{class:"pi pi-arrow-up-right"},null,-1)),D(" "+i(o.$t("credits.invoiceHistory")),1)]),_:1},8,["loading"])]),y.value.length>0?(p(),$("div",Le,[c(a(z),{value:y.value,"show-headers":!1},{default:u(()=>[c(a(L),{field:"title",header:o.$t("g.name")},{body:u(({data:U})=>[n("div",Ie,i(U.title),1),n("div",Be,i(U.timestamp),1)]),_:1},8,["header"]),c(a(L),{field:"amount",header:o.$t("g.amount")},{body:u(({data:U})=>[n("div",{class:G(["text-center text-base font-medium",U.isPositive?"text-sky-500":"text-red-400"])},i(U.isPositive?"+":"-")+"$"+i(a(le)(U.amount,"usd")),3)]),_:1},8,["header"])]),_:1},8,["value"])])):I("",!0),c(a(q)),c(we,{ref_key:"usageLogsTableRef",ref:E},null,512),n("div",Fe,[c(S,{variant:"muted-textonly",onClick:s},{default:u(()=>[r[3]||(r[3]=n("i",{class:"pi pi-question-circle"},null,-1)),D(" "+i(o.$t("credits.faqs")),1)]),_:1}),c(S,{variant:"muted-textonly",onClick:b},{default:u(()=>[r[4]||(r[4]=n("i",{class:"pi pi-question-circle"},null,-1)),D(" "+i(o.$t("subscription.partnerNodesCredits")),1)]),_:1}),c(S,{variant:"muted-textonly",onClick:e},{default:u(()=>[r[5]||(r[5]=n("i",{class:"pi pi-comments"},null,-1)),D(" "+i(o.$t("credits.messageSupport")),1)]),_:1})])])]),_:1}))}});export{He as default};
//# sourceMappingURL=LegacyCreditsPanel-CB01_XFo.js.map
