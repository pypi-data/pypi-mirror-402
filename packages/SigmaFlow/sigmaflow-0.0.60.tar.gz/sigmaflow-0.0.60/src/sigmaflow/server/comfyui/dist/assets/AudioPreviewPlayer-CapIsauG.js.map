{"version":3,"file":"AudioPreviewPlayer-CapIsauG.js","sources":["../../../../../../../ComfyUI_frontend/src/renderer/extensions/vueNodes/widgets/components/audio/AudioPreviewPlayer.vue"],"sourcesContent":["<template>\n  <div class=\"relative\">\n    <div\n      v-if=\"!hidden\"\n      :class=\"\n        cn(\n          'bg-component-node-widget-background box-border flex gap-4 items-center justify-start relative rounded-lg w-full h-16 px-4 py-0',\n          { hidden: hideWhenEmpty && !hasAudio }\n        )\n      \"\n    >\n      <!-- Hidden audio element -->\n      <audio\n        ref=\"audioRef\"\n        @loadedmetadata=\"handleLoadedMetadata\"\n        @timeupdate=\"handleTimeUpdate\"\n        @ended=\"handleEnded\"\n      />\n\n      <!-- Left Actions -->\n      <div class=\"relative flex shrink-0 items-center justify-start gap-2\">\n        <!-- Play/Pause Button -->\n        <div\n          role=\"button\"\n          :tabindex=\"0\"\n          :aria-label=\"$t('g.playPause')\"\n          class=\"flex size-6 cursor-pointer items-center justify-center rounded hover:bg-interface-menu-component-surface-hovered\"\n          @click=\"togglePlayPause\"\n        >\n          <i\n            v-if=\"!isPlaying\"\n            class=\"text-secondary icon-[lucide--play] size-4\"\n          />\n          <i v-else class=\"text-secondary icon-[lucide--pause] size-4\" />\n        </div>\n\n        <!-- Time Display -->\n        <div class=\"text-sm font-normal text-nowrap text-base-foreground\">\n          {{ formatTime(currentTime) }} / {{ formatTime(duration) }}\n        </div>\n      </div>\n\n      <!-- Progress Bar -->\n      <div class=\"relative h-0.5 flex-1 rounded-full bg-interface-stroke\">\n        <div\n          class=\"absolute top-0 left-0 h-full rounded-full bg-button-icon transition-all\"\n          :style=\"{ width: `${progressPercentage}%` }\"\n        />\n        <input\n          type=\"range\"\n          :value=\"progressPercentage\"\n          min=\"0\"\n          max=\"100\"\n          step=\"0.1\"\n          :aria-label=\"$t('g.audioProgress')\"\n          class=\"absolute inset-0 w-full cursor-pointer opacity-0\"\n          @input=\"handleSeek\"\n        />\n      </div>\n\n      <!-- Right Actions -->\n      <div class=\"relative flex shrink-0 items-center justify-start gap-2\">\n        <!-- Volume Button -->\n        <div\n          role=\"button\"\n          :tabindex=\"0\"\n          :aria-label=\"$t('g.volume')\"\n          class=\"flex size-6 cursor-pointer items-center justify-center rounded hover:bg-interface-menu-component-surface-hovered\"\n          @click=\"toggleMute\"\n        >\n          <i\n            v-if=\"showVolumeTwo\"\n            class=\"text-secondary icon-[lucide--volume-2] size-4\"\n          />\n          <i\n            v-else-if=\"showVolumeOne\"\n            class=\"text-secondary icon-[lucide--volume-1] size-4\"\n          />\n          <i v-else class=\"text-secondary icon-[lucide--volume-x] size-4\" />\n        </div>\n\n        <!-- Options Button -->\n        <div\n          v-if=\"showOptionsButton\"\n          role=\"button\"\n          :tabindex=\"0\"\n          :aria-label=\"$t('g.moreOptions')\"\n          class=\"flex size-6 cursor-pointer items-center justify-center rounded hover:bg-interface-menu-component-surface-hovered\"\n          @click=\"toggleOptionsMenu\"\n        >\n          <i class=\"text-secondary icon-[lucide--more-vertical] size-4\" />\n        </div>\n      </div>\n\n      <!-- Options Menu -->\n      <TieredMenu\n        ref=\"optionsMenu\"\n        :model=\"menuItems\"\n        popup\n        class=\"audio-player-menu\"\n        :pt:root:class=\"\n          cn('bg-component-node-widget-background border-component-node-border')\n        \"\n        :pt:submenu:class=\"cn('bg-component-node-widget-background')\"\n      >\n        <template #item=\"{ item }\">\n          <div v-if=\"item.key === 'volume'\" class=\"w-48 px-4 py-2\">\n            <label class=\"mb-2 block text-xs text-base-foreground\">{{\n              item.label\n            }}</label>\n            <Slider\n              :model-value=\"volume * 10\"\n              :min=\"0\"\n              :max=\"10\"\n              :step=\"1\"\n              class=\"w-full\"\n              @update:model-value=\"handleVolumeChange\"\n            />\n          </div>\n          <div\n            v-else\n            class=\"flex cursor-pointer items-center px-4 py-2 text-xs hover:bg-white/10\"\n            @click=\"item.onClick?.()\"\n          >\n            <span class=\"text-base-foreground\">{{ item.label }}</span>\n            <i\n              v-if=\"item.selected\"\n              class=\"ml-auto icon-[lucide--check] size-4 text-base-foreground\"\n            />\n          </div>\n        </template>\n      </TieredMenu>\n    </div>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport Slider from 'primevue/slider'\nimport TieredMenu from 'primevue/tieredmenu'\nimport { computed, nextTick, onUnmounted, ref, watch } from 'vue'\nimport { useI18n } from 'vue-i18n'\n\nimport type { LGraphNode } from '@/lib/litegraph/src/LGraphNode'\nimport { api } from '@/scripts/api'\nimport { app } from '@/scripts/app'\nimport { useNodeOutputStore } from '@/stores/imagePreviewStore'\nimport { getLocatorIdFromNodeData } from '@/utils/graphTraversalUtil'\nimport { isOutputNode } from '@/utils/nodeFilterUtil'\nimport { cn } from '@/utils/tailwindUtil'\n\nimport { formatTime, getResourceURL } from '../../utils/audioUtils'\n\nconst { t } = useI18n()\n\nconst props = withDefaults(\n  defineProps<{\n    hideWhenEmpty?: boolean\n    showOptionsButton?: boolean\n    nodeId?: string\n    audioUrl?: string\n  }>(),\n  {\n    hideWhenEmpty: true\n  }\n)\n\n// Refs\nconst audioRef = ref<HTMLAudioElement>()\nconst optionsMenu = ref()\nconst isPlaying = ref(false)\nconst isMuted = ref(false)\nconst volume = ref(1)\nconst currentTime = ref(0)\nconst duration = ref(0)\nconst hasAudio = ref(false)\nconst playbackRate = ref(1)\n\n// Computed\nconst progressPercentage = computed(() => {\n  if (!duration.value || duration.value === 0) return 0\n  return (currentTime.value / duration.value) * 100\n})\n\nconst showVolumeTwo = computed(() => !isMuted.value && volume.value > 0.5)\nconst showVolumeOne = computed(() => isMuted.value && volume.value > 0)\n\nconst litegraphNode = computed(() => {\n  if (!props.nodeId || !app.canvas.graph) return null\n  return app.canvas.graph.getNodeById(props.nodeId) as LGraphNode | null\n})\n\nconst hidden = computed(() => {\n  if (!litegraphNode.value) return false\n  // dont show if its a LoadAudio and we have nodeId\n  const isLoadAudio =\n    litegraphNode.value.constructor?.comfyClass === 'LoadAudio'\n  return isLoadAudio && !!props.nodeId\n})\n\n// Check if this is an output node\nconst isOutputNodeRef = computed(() => {\n  const node = litegraphNode.value\n  return !!node && isOutputNode(node)\n})\n\nconst nodeLocatorId = computed(() => {\n  const node = litegraphNode.value\n  if (!node) return null\n  return getLocatorIdFromNodeData(node)\n})\n\nconst nodeOutputStore = useNodeOutputStore()\n\n// Computed audio URL from node output (for output nodes)\nconst audioUrlFromOutput = computed(() => {\n  if (!isOutputNodeRef.value || !nodeLocatorId.value) return ''\n\n  const nodeOutput = nodeOutputStore.nodeOutputs[nodeLocatorId.value]\n  if (!nodeOutput?.audio || nodeOutput.audio.length === 0) return ''\n\n  const audio = nodeOutput.audio[0]\n  if (!audio.filename) return ''\n\n  return api.apiURL(\n    getResourceURL(\n      audio.subfolder || '',\n      audio.filename,\n      audio.type || 'output'\n    )\n  )\n})\n\n// Combined audio URL (output takes precedence for output nodes)\nconst finalAudioUrl = computed(() => {\n  return audioUrlFromOutput.value || props.audioUrl || ''\n})\n\n// Playback controls\nconst togglePlayPause = () => {\n  if (!audioRef.value || !audioRef.value.src) {\n    return\n  }\n\n  if (isPlaying.value) {\n    audioRef.value.pause()\n  } else {\n    void audioRef.value.play()\n  }\n  isPlaying.value = !isPlaying.value\n}\n\nconst toggleMute = () => {\n  if (audioRef.value) {\n    isMuted.value = !isMuted.value\n    audioRef.value.muted = isMuted.value\n  }\n}\n\nconst handleSeek = (event: Event) => {\n  const target = event.target as HTMLInputElement\n  const value = parseFloat(target.value)\n  if (audioRef.value && duration.value > 0) {\n    const newTime = (value / 100) * duration.value\n    audioRef.value.currentTime = newTime\n    currentTime.value = newTime\n  }\n}\n\n// Audio events\nconst handleLoadedMetadata = () => {\n  if (audioRef.value) {\n    duration.value = audioRef.value.duration\n  }\n}\n\nconst handleTimeUpdate = () => {\n  if (audioRef.value) {\n    currentTime.value = audioRef.value.currentTime\n  }\n}\n\nconst handleEnded = () => {\n  isPlaying.value = false\n  currentTime.value = 0\n}\n\n// Options menu\nconst toggleOptionsMenu = (event: Event) => {\n  optionsMenu.value?.toggle(event)\n}\n\nconst setPlaybackSpeed = (speed: number) => {\n  playbackRate.value = speed\n  if (audioRef.value) {\n    audioRef.value.playbackRate = speed\n  }\n}\n\nconst handleVolumeChange = (value: number | number[]) => {\n  const numValue = Array.isArray(value) ? value[0] : value\n  volume.value = numValue / 10\n  if (audioRef.value) {\n    audioRef.value.volume = volume.value\n    if (volume.value > 0 && isMuted.value) {\n      isMuted.value = false\n      audioRef.value.muted = false\n    }\n  }\n}\n\nconst menuItems = computed(() => [\n  {\n    label: t('g.playbackSpeed'),\n    items: [\n      {\n        label: t('g.halfSpeed'),\n        onClick: () => setPlaybackSpeed(0.5),\n        selected: playbackRate.value === 0.5\n      },\n      {\n        label: t('g.1x'),\n        onClick: () => setPlaybackSpeed(1),\n        selected: playbackRate.value === 1\n      },\n      {\n        label: t('g.2x'),\n        onClick: () => setPlaybackSpeed(2),\n        selected: playbackRate.value === 2\n      }\n    ]\n  },\n  {\n    label: t('g.volume'),\n    key: 'volume'\n  }\n])\n\n// Load audio from URL\nconst loadAudioFromUrl = (url: string) => {\n  if (!audioRef.value) return\n  isPlaying.value = false\n  audioRef.value.pause()\n  audioRef.value.src = url\n  void audioRef.value.load()\n  hasAudio.value = !!url\n}\n\n// Watch for finalAudioUrl changes\nwatch(\n  finalAudioUrl,\n  (newUrl) => {\n    if (newUrl) {\n      void nextTick(() => {\n        loadAudioFromUrl(newUrl)\n      })\n    }\n  },\n  { immediate: true }\n)\n\n// Cleanup\nonUnmounted(() => {\n  if (audioRef.value) {\n    audioRef.value.pause()\n    audioRef.value.src = ''\n  }\n})\n</script>\n\n<style scoped>\n.audio-player-menu {\n  --p-tieredmenu-item-focus-background: rgb(255 255 255 / 0.1);\n  --p-tieredmenu-item-active-background: rgb(255 255 255 / 0.1);\n}\n</style>\n"],"names":["t","useI18n","props","__props","audioRef","ref","optionsMenu","isPlaying","isMuted","volume","currentTime","duration","hasAudio","playbackRate","progressPercentage","computed","showVolumeTwo","showVolumeOne","litegraphNode","app","hidden","isOutputNodeRef","node","isOutputNode","nodeLocatorId","getLocatorIdFromNodeData","nodeOutputStore","useNodeOutputStore","audioUrlFromOutput","nodeOutput","audio","api","getResourceURL","finalAudioUrl","togglePlayPause","__name","toggleMute","handleSeek","event","target","value","newTime","handleLoadedMetadata","handleTimeUpdate","handleEnded","toggleOptionsMenu","setPlaybackSpeed","speed","handleVolumeChange","numValue","menuItems","loadAudioFromUrl","url","watch","newUrl","nextTick","onUnmounted"],"mappings":"knDAwJA,KAAM,CAAE,EAAAA,CAAA,EAAMC,EAAA,EAERC,EAAQC,EAaRC,EAAWC,EAAA,EACXC,EAAcD,EAAA,EACdE,EAAYF,EAAI,EAAK,EACrBG,EAAUH,EAAI,EAAK,EACnBI,EAASJ,EAAI,CAAC,EACdK,EAAcL,EAAI,CAAC,EACnBM,EAAWN,EAAI,CAAC,EAChBO,EAAWP,EAAI,EAAK,EACpBQ,EAAeR,EAAI,CAAC,EAGpBS,EAAqBC,EAAS,IAC9B,CAACJ,EAAS,OAASA,EAAS,QAAU,EAAU,EAC5CD,EAAY,MAAQC,EAAS,MAAS,GAC/C,EAEKK,EAAgBD,EAAS,IAAM,CAACP,EAAQ,OAASC,EAAO,MAAQ,EAAG,EACnEQ,EAAgBF,EAAS,IAAMP,EAAQ,OAASC,EAAO,MAAQ,CAAC,EAEhES,EAAgBH,EAAS,IACzB,CAACb,EAAM,QAAU,CAACiB,EAAI,OAAO,MAAc,KACxCA,EAAI,OAAO,MAAM,YAAYjB,EAAM,MAAM,CACjD,EAEKkB,EAASL,EAAS,IACjBG,EAAc,MAGjBA,EAAc,MAAM,aAAa,aAAe,aAC5B,CAAC,CAAChB,EAAM,OAJG,EAKlC,EAGKmB,EAAkBN,EAAS,IAAM,CACrC,MAAMO,EAAOJ,EAAc,MAC3B,MAAO,CAAC,CAACI,GAAQC,GAAaD,CAAI,CACpC,CAAC,EAEKE,EAAgBT,EAAS,IAAM,CACnC,MAAMO,EAAOJ,EAAc,MAC3B,OAAKI,EACEG,GAAyBH,CAAI,EADlB,IAEpB,CAAC,EAEKI,EAAkBC,GAAA,EAGlBC,EAAqBb,EAAS,IAAM,CACxC,GAAI,CAACM,EAAgB,OAAS,CAACG,EAAc,MAAO,MAAO,GAE3D,MAAMK,EAAaH,EAAgB,YAAYF,EAAc,KAAK,EAClE,GAAI,CAACK,GAAY,OAASA,EAAW,MAAM,SAAW,EAAG,MAAO,GAEhE,MAAMC,EAAQD,EAAW,MAAM,CAAC,EAChC,OAAKC,EAAM,SAEJC,GAAI,OACTC,GACEF,EAAM,WAAa,GACnBA,EAAM,SACNA,EAAM,MAAQ,QAAA,CAChB,EAP0B,EAS9B,CAAC,EAGKG,EAAgBlB,EAAS,IACtBa,EAAmB,OAAS1B,EAAM,UAAY,EACtD,EAGKgC,EAAkBC,EAAA,IAAM,CACxB,CAAC/B,EAAS,OAAS,CAACA,EAAS,MAAM,MAInCG,EAAU,MACZH,EAAS,MAAM,MAAA,EAEVA,EAAS,MAAM,KAAA,EAEtBG,EAAU,MAAQ,CAACA,EAAU,MAC/B,EAXwB,mBAalB6B,EAAaD,EAAA,IAAM,CACnB/B,EAAS,QACXI,EAAQ,MAAQ,CAACA,EAAQ,MACzBJ,EAAS,MAAM,MAAQI,EAAQ,MAEnC,EALmB,cAOb6B,EAAaF,EAACG,GAAiB,CACnC,MAAMC,EAASD,EAAM,OACfE,EAAQ,WAAWD,EAAO,KAAK,EACrC,GAAInC,EAAS,OAASO,EAAS,MAAQ,EAAG,CACxC,MAAM8B,EAAWD,EAAQ,IAAO7B,EAAS,MACzCP,EAAS,MAAM,YAAcqC,EAC7B/B,EAAY,MAAQ+B,CACtB,CACF,EARmB,cAWbC,EAAuBP,EAAA,IAAM,CAC7B/B,EAAS,QACXO,EAAS,MAAQP,EAAS,MAAM,SAEpC,EAJ6B,wBAMvBuC,EAAmBR,EAAA,IAAM,CACzB/B,EAAS,QACXM,EAAY,MAAQN,EAAS,MAAM,YAEvC,EAJyB,oBAMnBwC,EAAcT,EAAA,IAAM,CACxB5B,EAAU,MAAQ,GAClBG,EAAY,MAAQ,CACtB,EAHoB,eAMdmC,EAAoBV,EAACG,GAAiB,CAC1ChC,EAAY,OAAO,OAAOgC,CAAK,CACjC,EAF0B,qBAIpBQ,EAAmBX,EAACY,GAAkB,CAC1ClC,EAAa,MAAQkC,EACjB3C,EAAS,QACXA,EAAS,MAAM,aAAe2C,EAElC,EALyB,oBAOnBC,EAAqBb,EAACK,GAA6B,CACvD,MAAMS,EAAW,MAAM,QAAQT,CAAK,EAAIA,EAAM,CAAC,EAAIA,EACnD/B,EAAO,MAAQwC,EAAW,GACtB7C,EAAS,QACXA,EAAS,MAAM,OAASK,EAAO,MAC3BA,EAAO,MAAQ,GAAKD,EAAQ,QAC9BA,EAAQ,MAAQ,GAChBJ,EAAS,MAAM,MAAQ,IAG7B,EAV2B,sBAYrB8C,EAAYnC,EAAS,IAAM,CAC/B,CACE,MAAOf,EAAE,iBAAiB,EAC1B,MAAO,CACL,CACE,MAAOA,EAAE,aAAa,EACtB,QAASmC,EAAA,IAAMW,EAAiB,EAAG,EAA1B,WACT,SAAUjC,EAAa,QAAU,EAAA,EAEnC,CACE,MAAOb,EAAE,MAAM,EACf,QAASmC,EAAA,IAAMW,EAAiB,CAAC,EAAxB,WACT,SAAUjC,EAAa,QAAU,CAAA,EAEnC,CACE,MAAOb,EAAE,MAAM,EACf,QAASmC,EAAA,IAAMW,EAAiB,CAAC,EAAxB,WACT,SAAUjC,EAAa,QAAU,CAAA,CACnC,CACF,EAEF,CACE,MAAOb,EAAE,UAAU,EACnB,IAAK,QAAA,CACP,CACD,EAGKmD,EAAmBhB,EAACiB,GAAgB,CACnChD,EAAS,QACdG,EAAU,MAAQ,GAClBH,EAAS,MAAM,MAAA,EACfA,EAAS,MAAM,IAAMgD,EAChBhD,EAAS,MAAM,KAAA,EACpBQ,EAAS,MAAQ,CAAC,CAACwC,EACrB,EAPyB,oBAUzB,OAAAC,GACEpB,EACCqB,GAAW,CACNA,GACGC,GAAS,IAAM,CAClBJ,EAAiBG,CAAM,CACzB,CAAC,CAEL,EACA,CAAE,UAAW,EAAA,CAAK,EAIpBE,GAAY,IAAM,CACZpD,EAAS,QACXA,EAAS,MAAM,MAAA,EACfA,EAAS,MAAM,IAAM,GAEzB,CAAC"}