{"version":3,"file":"ExtensionPanel-D63DN5Km.js","sources":["../../../../../../../ComfyUI_frontend/src/platform/settings/components/ExtensionPanel.vue"],"sourcesContent":["<template>\n  <PanelTemplate value=\"Extension\" class=\"extension-panel\">\n    <template #header>\n      <SearchBox\n        v-model=\"filters['global'].value\"\n        :placeholder=\"$t('g.searchExtensions') + '...'\"\n      />\n      <Message\n        v-if=\"hasChanges\"\n        severity=\"info\"\n        pt:text=\"w-full\"\n        class=\"max-h-96 overflow-y-auto\"\n      >\n        <ul>\n          <li v-for=\"ext in changedExtensions\" :key=\"ext.name\">\n            <span>\n              {{ extensionStore.isExtensionEnabled(ext.name) ? '[-]' : '[+]' }}\n            </span>\n            {{ ext.name }}\n          </li>\n        </ul>\n        <div class=\"flex justify-end\">\n          <Button variant=\"destructive\" @click=\"applyChanges\">\n            {{ $t('g.reloadToApplyChanges') }}\n          </Button>\n        </div>\n      </Message>\n    </template>\n    <div class=\"mb-3 flex gap-2\">\n      <SelectButton\n        v-model=\"filterType\"\n        :options=\"filterTypes\"\n        option-label=\"label\"\n        option-value=\"value\"\n      />\n    </div>\n    <DataTable\n      v-model:selection=\"selectedExtensions\"\n      :value=\"filteredExtensions\"\n      striped-rows\n      size=\"small\"\n      :filters=\"filters\"\n      selection-mode=\"multiple\"\n      data-key=\"name\"\n    >\n      <Column selection-mode=\"multiple\" :frozen=\"true\" style=\"width: 3rem\" />\n      <Column :header=\"$t('g.extensionName')\" sortable field=\"name\">\n        <template #body=\"slotProps\">\n          {{ slotProps.data.name }}\n          <Tag\n            v-if=\"extensionStore.isCoreExtension(slotProps.data.name)\"\n            :value=\"$t('g.core')\"\n          />\n          <Tag v-else :value=\"$t('g.custom')\" severity=\"info\" />\n        </template>\n      </Column>\n      <Column\n        :pt=\"{\n          headerCell: 'flex items-center justify-end',\n          bodyCell: 'flex items-center justify-end'\n        }\"\n      >\n        <template #header>\n          <Button\n            size=\"icon\"\n            variant=\"muted-textonly\"\n            @click=\"menu?.show($event)\"\n          >\n            <i class=\"pi pi-ellipsis-h\" />\n          </Button>\n          <ContextMenu ref=\"menu\" :model=\"contextMenuItems\" />\n        </template>\n        <template #body=\"slotProps\">\n          <ToggleSwitch\n            v-model=\"editingEnabledExtensions[slotProps.data.name]\"\n            :disabled=\"extensionStore.isExtensionReadOnly(slotProps.data.name)\"\n            @change=\"updateExtensionStatus\"\n          />\n        </template>\n      </Column>\n    </DataTable>\n  </PanelTemplate>\n</template>\n\n<script setup lang=\"ts\">\nimport { FilterMatchMode } from '@primevue/core/api'\nimport Column from 'primevue/column'\nimport ContextMenu from 'primevue/contextmenu'\nimport DataTable from 'primevue/datatable'\nimport Message from 'primevue/message'\nimport SelectButton from 'primevue/selectbutton'\nimport Tag from 'primevue/tag'\nimport ToggleSwitch from 'primevue/toggleswitch'\nimport { computed, onMounted, ref } from 'vue'\nimport { useI18n } from 'vue-i18n'\n\nimport SearchBox from '@/components/common/SearchBox.vue'\nimport PanelTemplate from '@/components/dialog/content/setting/PanelTemplate.vue'\nimport Button from '@/components/ui/button/Button.vue'\nimport { useSettingStore } from '@/platform/settings/settingStore'\nimport { useExtensionStore } from '@/stores/extensionStore'\nimport type { ComfyExtension } from '@/types/comfy'\n\nconst { t } = useI18n()\n\nconst filterTypeKeys = ['all', 'core', 'custom'] as const\ntype FilterTypeKey = (typeof filterTypeKeys)[number]\nconst filterTypes = computed(() =>\n  filterTypeKeys.map((key) => ({\n    label: t(`g.${key}`),\n    value: key\n  }))\n)\nconst filterType = ref<FilterTypeKey>('all')\nconst selectedExtensions = ref<ComfyExtension[]>([])\n\nconst filters = ref({\n  global: { value: '', matchMode: FilterMatchMode.CONTAINS }\n})\n\nconst extensionStore = useExtensionStore()\nconst settingStore = useSettingStore()\n\nconst editingEnabledExtensions = ref<Record<string, boolean>>({})\n\nconst filteredExtensions = computed(() => {\n  const extensions = extensionStore.extensions\n  switch (filterType.value) {\n    case 'core':\n      return extensions.filter((ext) =>\n        extensionStore.isCoreExtension(ext.name)\n      )\n    case 'custom':\n      return extensions.filter(\n        (ext) => !extensionStore.isCoreExtension(ext.name)\n      )\n    default:\n      return extensions\n  }\n})\n\nonMounted(() => {\n  extensionStore.extensions.forEach((ext) => {\n    editingEnabledExtensions.value[ext.name] =\n      extensionStore.isExtensionEnabled(ext.name)\n  })\n})\n\nconst changedExtensions = computed(() => {\n  return extensionStore.extensions.filter(\n    (ext) =>\n      editingEnabledExtensions.value[ext.name] !==\n      extensionStore.isExtensionEnabled(ext.name)\n  )\n})\n\nconst hasChanges = computed(() => {\n  return changedExtensions.value.length > 0\n})\n\nconst updateExtensionStatus = async () => {\n  const editingDisabledExtensionNames = Object.entries(\n    editingEnabledExtensions.value\n  )\n    .filter(([_, enabled]) => !enabled)\n    .map(([name]) => name)\n\n  await settingStore.set('Comfy.Extension.Disabled', [\n    ...extensionStore.inactiveDisabledExtensionNames,\n    ...editingDisabledExtensionNames\n  ])\n}\n\nconst enableAllExtensions = async () => {\n  extensionStore.extensions.forEach((ext) => {\n    if (extensionStore.isExtensionReadOnly(ext.name)) return\n\n    editingEnabledExtensions.value[ext.name] = true\n  })\n  await updateExtensionStatus()\n}\n\nconst disableAllExtensions = async () => {\n  extensionStore.extensions.forEach((ext) => {\n    if (extensionStore.isExtensionReadOnly(ext.name)) return\n\n    editingEnabledExtensions.value[ext.name] = false\n  })\n  await updateExtensionStatus()\n}\n\nconst disableThirdPartyExtensions = async () => {\n  extensionStore.extensions.forEach((ext) => {\n    if (extensionStore.isCoreExtension(ext.name)) return\n\n    editingEnabledExtensions.value[ext.name] = false\n  })\n  await updateExtensionStatus()\n}\n\nconst applyChanges = () => {\n  // Refresh the page to apply changes\n  window.location.reload()\n}\n\nconst menu = ref<InstanceType<typeof ContextMenu>>()\nconst contextMenuItems = computed(() => [\n  {\n    label: t('g.enableSelected'),\n    icon: 'pi pi-check',\n    command: async () => {\n      selectedExtensions.value.forEach((ext) => {\n        if (!extensionStore.isExtensionReadOnly(ext.name)) {\n          editingEnabledExtensions.value[ext.name] = true\n        }\n      })\n      await updateExtensionStatus()\n    }\n  },\n  {\n    label: t('g.disableSelected'),\n    icon: 'pi pi-times',\n    command: async () => {\n      selectedExtensions.value.forEach((ext) => {\n        if (!extensionStore.isExtensionReadOnly(ext.name)) {\n          editingEnabledExtensions.value[ext.name] = false\n        }\n      })\n      await updateExtensionStatus()\n    }\n  },\n  {\n    separator: true\n  },\n  {\n    label: t('g.enableAll'),\n    icon: 'pi pi-check',\n    command: enableAllExtensions\n  },\n  {\n    label: t('g.disableAll'),\n    icon: 'pi pi-times',\n    command: disableAllExtensions\n  },\n  {\n    label: t('g.disableThirdParty'),\n    icon: 'pi pi-times',\n    command: disableThirdPartyExtensions,\n    disabled: !extensionStore.hasThirdPartyExtensions\n  }\n])\n</script>\n"],"names":["t","useI18n","filterTypeKeys","filterTypes","computed","key","filterType","ref","selectedExtensions","filters","FilterMatchMode","extensionStore","useExtensionStore","settingStore","useSettingStore","editingEnabledExtensions","filteredExtensions","extensions","ext","onMounted","changedExtensions","hasChanges","updateExtensionStatus","__name","editingDisabledExtensionNames","_","enabled","name","enableAllExtensions","disableAllExtensions","disableThirdPartyExtensions","applyChanges","menu","contextMenuItems"],"mappings":"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"}