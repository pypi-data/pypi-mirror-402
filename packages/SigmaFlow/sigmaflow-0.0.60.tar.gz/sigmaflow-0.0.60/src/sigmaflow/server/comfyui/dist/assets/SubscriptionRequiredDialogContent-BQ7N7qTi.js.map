{"version":3,"file":"SubscriptionRequiredDialogContent-BQ7N7qTi.js","sources":["../../../../../../../ComfyUI_frontend/src/components/topbar/CloudBadge.vue","../../../../../../../../../../assets/images/cloud-subscription.webm","../../../../../../../ComfyUI_frontend/src/config/subscriptionPricesConfig.ts","../../../../../../../ComfyUI_frontend/src/platform/cloud/subscription/utils/subscriptionTierRank.ts","../../../../../../../ComfyUI_frontend/src/platform/cloud/subscription/components/PricingTable.vue","../../../../../../../ComfyUI_frontend/src/platform/cloud/subscription/components/SubscriptionBenefits.vue","../../../../../../../ComfyUI_frontend/src/platform/cloud/subscription/components/SubscriptionRequiredDialogContent.vue"],"sourcesContent":["<template>\n  <TopbarBadge\n    :badge=\"cloudBadge\"\n    :display-mode=\"displayMode\"\n    :reverse-order=\"reverseOrder\"\n    :no-padding=\"noPadding\"\n    :background-color=\"backgroundColor\"\n  />\n</template>\n\n<script setup lang=\"ts\">\nimport { computed } from 'vue'\n\nimport { t } from '@/i18n'\nimport type { TopbarBadge as TopbarBadgeType } from '@/types/comfy'\n\nimport TopbarBadge from './TopbarBadge.vue'\n\nwithDefaults(\n  defineProps<{\n    displayMode?: 'full' | 'compact' | 'icon-only'\n    reverseOrder?: boolean\n    noPadding?: boolean\n    backgroundColor?: string\n  }>(),\n  {\n    displayMode: 'full',\n    reverseOrder: false,\n    noPadding: false,\n    backgroundColor: 'var(--comfy-menu-bg)'\n  }\n)\n\nconst cloudBadge = computed<TopbarBadgeType>(() => ({\n  label: t('g.beta'),\n  text: 'Comfy Cloud'\n}))\n</script>\n","export default \"__VITE_PUBLIC_ASSET__b4a125b1__\"","export const MONTHLY_SUBSCRIPTION_PRICE = 20\n","import type { TierKey } from '@/platform/cloud/subscription/constants/tierPricing'\n\nexport type BillingCycle = 'monthly' | 'yearly'\n\ntype RankedTierKey = Exclude<TierKey, 'founder'>\ntype RankedPlanKey = `${BillingCycle}-${RankedTierKey}`\n\ninterface PlanDescriptor {\n  tierKey: TierKey\n  billingCycle: BillingCycle\n}\n\nconst PLAN_ORDER: RankedPlanKey[] = [\n  'yearly-pro',\n  'yearly-creator',\n  'yearly-standard',\n  'monthly-pro',\n  'monthly-creator',\n  'monthly-standard'\n]\n\nconst PLAN_RANK = PLAN_ORDER.reduce<Map<RankedPlanKey, number>>(\n  (acc, plan, index) => acc.set(plan, index),\n  new Map()\n)\n\nconst toRankedPlanKey = (\n  tierKey: TierKey,\n  billingCycle: BillingCycle\n): RankedPlanKey | null => {\n  if (tierKey === 'founder') return null\n  return `${billingCycle}-${tierKey}` as RankedPlanKey\n}\n\nexport const getPlanRank = ({\n  tierKey,\n  billingCycle\n}: PlanDescriptor): number => {\n  const planKey = toRankedPlanKey(tierKey, billingCycle)\n  if (!planKey) return Number.POSITIVE_INFINITY\n\n  return PLAN_RANK.get(planKey) ?? Number.POSITIVE_INFINITY\n}\n\ninterface DowngradeCheckParams {\n  current: PlanDescriptor\n  target: PlanDescriptor\n}\n\nexport const isPlanDowngrade = ({\n  current,\n  target\n}: DowngradeCheckParams): boolean => {\n  const currentRank = getPlanRank(current)\n  const targetRank = getPlanRank(target)\n\n  return targetRank > currentRank\n}\n","<template>\n  <div class=\"flex flex-col gap-8\">\n    <div class=\"flex justify-center\">\n      <SelectButton\n        v-model=\"currentBillingCycle\"\n        :options=\"billingCycleOptions\"\n        option-label=\"label\"\n        option-value=\"value\"\n        :allow-empty=\"false\"\n        unstyled\n        :pt=\"{\n          root: {\n            class: 'flex gap-1 bg-secondary-background rounded-lg p-1.5'\n          },\n          pcToggleButton: {\n            root: ({ context }: ToggleButtonPassThroughMethodOptions) => ({\n              class: [\n                'w-36  h-8 rounded-md transition-colors cursor-pointer border-none outline-none ring-0 text-sm font-medium flex items-center justify-center',\n                context.active\n                  ? 'bg-base-foreground text-base-background'\n                  : 'bg-transparent text-muted-foreground hover:bg-secondary-background-hover'\n              ]\n            }),\n            label: { class: 'flex items-center gap-2 ' }\n          }\n        }\"\n      >\n        <template #option=\"{ option }\">\n          <div class=\"flex items-center gap-2\">\n            <span>{{ option.label }}</span>\n            <div\n              v-if=\"option.value === 'yearly'\"\n              class=\"bg-primary-background text-white text-[11px] px-1 py-0.5 rounded-full flex items-center font-bold\"\n            >\n              -20%\n            </div>\n          </div>\n        </template>\n      </SelectButton>\n    </div>\n    <div class=\"flex flex-col xl:flex-row items-stretch gap-6\">\n      <div\n        v-for=\"tier in tiers\"\n        :key=\"tier.id\"\n        :class=\"\n          cn(\n            'flex-1 flex flex-col rounded-2xl border border-border-default bg-base-background shadow-[0_0_12px_rgba(0,0,0,0.1)]',\n            tier.isPopular ? 'border-muted-foreground' : ''\n          )\n        \"\n      >\n        <div class=\"p-8 pb-0 flex flex-col gap-8\">\n          <div class=\"flex flex-row items-center gap-2 justify-between\">\n            <span\n              class=\"font-inter text-base font-bold leading-normal text-base-foreground\"\n            >\n              {{ tier.name }}\n            </span>\n            <div\n              v-if=\"tier.isPopular\"\n              class=\"rounded-full bg-base-foreground px-1.5 text-[11px] font-bold uppercase text-base-background h-5 tracking-tight flex items-center\"\n            >\n              {{ t('subscription.mostPopular') }}\n            </div>\n          </div>\n          <div class=\"flex flex-col\">\n            <div class=\"flex flex-col gap-2\">\n              <div class=\"flex flex-row items-baseline gap-2\">\n                <span\n                  class=\"font-inter text-[32px] font-semibold leading-normal text-base-foreground\"\n                >\n                  <span\n                    v-show=\"currentBillingCycle === 'yearly'\"\n                    class=\"line-through text-2xl text-muted-foreground\"\n                  >\n                    ${{ tier.pricing.monthly }}\n                  </span>\n                  ${{ getPrice(tier) }}\n                </span>\n                <span\n                  class=\"font-inter text-xl leading-normal text-base-foreground\"\n                >\n                  {{ t('subscription.usdPerMonth') }}\n                </span>\n              </div>\n              <div class=\"flex items-center gap-2\">\n                <span class=\"text-sm text-muted-foreground\">\n                  {{\n                    currentBillingCycle === 'yearly'\n                      ? t('subscription.billedYearly', {\n                          total: `$${getAnnualTotal(tier)}`\n                        })\n                      : t('subscription.billedMonthly')\n                  }}\n                </span>\n              </div>\n            </div>\n          </div>\n\n          <div class=\"flex flex-col gap-4 pb-0 flex-1\">\n            <div class=\"flex flex-row items-center justify-between\">\n              <span\n                class=\"font-inter text-sm font-normal leading-normal text-foreground\"\n              >\n                {{\n                  currentBillingCycle === 'yearly'\n                    ? t('subscription.yearlyCreditsLabel')\n                    : t('subscription.monthlyCreditsLabel')\n                }}\n              </span>\n              <div class=\"flex flex-row items-center gap-1\">\n                <i class=\"icon-[lucide--component] text-amber-400 text-sm\" />\n                <span\n                  class=\"font-inter text-sm font-bold leading-normal text-base-foreground\"\n                >\n                  {{ n(getCreditsDisplay(tier)) }}\n                </span>\n              </div>\n            </div>\n\n            <div class=\"flex flex-row items-center justify-between\">\n              <span class=\"text-sm font-normal text-foreground\">\n                {{ t('subscription.maxDurationLabel') }}\n              </span>\n              <span\n                class=\"font-inter text-sm font-bold leading-normal text-base-foreground\"\n              >\n                {{ tier.maxDuration }}\n              </span>\n            </div>\n\n            <div class=\"flex flex-row items-center justify-between\">\n              <span class=\"text-sm font-normal text-foreground\">\n                {{ t('subscription.gpuLabel') }}\n              </span>\n              <i class=\"pi pi-check text-xs text-success-foreground\" />\n            </div>\n\n            <div class=\"flex flex-row items-center justify-between\">\n              <span class=\"text-sm font-normal text-foreground\">\n                {{ t('subscription.addCreditsLabel') }}\n              </span>\n              <i class=\"pi pi-check text-xs text-success-foreground\" />\n            </div>\n\n            <div class=\"flex flex-row items-center justify-between\">\n              <span class=\"text-sm font-normal text-foreground\">\n                {{ t('subscription.customLoRAsLabel') }}\n              </span>\n              <i\n                v-if=\"tier.customLoRAs\"\n                class=\"pi pi-check text-xs text-success-foreground\"\n              />\n              <i v-else class=\"pi pi-times text-xs text-foreground\" />\n            </div>\n\n            <div class=\"flex flex-col gap-2\">\n              <div class=\"flex flex-row items-start justify-between\">\n                <div class=\"flex flex-col gap-2\">\n                  <span\n                    class=\"text-sm font-normal text-foreground leading-relaxed\"\n                  >\n                    {{ t('subscription.videoEstimateLabel') }}\n                  </span>\n                  <div class=\"flex flex-row items-center gap-2 group pt-2\">\n                    <i\n                      class=\"pi pi-question-circle text-xs text-muted-foreground group-hover:text-base-foreground\"\n                    />\n                    <span\n                      class=\"text-sm font-normal text-muted-foreground cursor-pointer group-hover:text-base-foreground\"\n                      @click=\"togglePopover\"\n                    >\n                      {{ t('subscription.videoEstimateHelp') }}\n                    </span>\n                  </div>\n                </div>\n                <span\n                  class=\"font-inter text-sm font-bold leading-normal text-base-foreground\"\n                >\n                  ~{{ n(tier.pricing.videoEstimate) }}\n                </span>\n              </div>\n            </div>\n          </div>\n        </div>\n        <div class=\"flex flex-col p-8\">\n          <Button\n            :variant=\"getButtonSeverity(tier)\"\n            :disabled=\"isLoading || isCurrentPlan(tier.key)\"\n            :loading=\"loadingTier === tier.key\"\n            :class=\"\n              cn(\n                'h-10 w-full',\n                getButtonTextClass(tier),\n                tier.key === 'creator'\n                  ? 'bg-base-foreground border-transparent hover:bg-inverted-background-hover'\n                  : 'bg-secondary-background border-transparent hover:bg-secondary-background-hover focus:bg-secondary-background-selected'\n              )\n            \"\n            @click=\"() => handleSubscribe(tier.key)\"\n          >\n            {{ getButtonLabel(tier) }}\n          </Button>\n        </div>\n      </div>\n    </div>\n\n    <!-- Video Estimate Help Popover -->\n    <Popover\n      ref=\"popover\"\n      append-to=\"body\"\n      :auto-z-index=\"true\"\n      :base-z-index=\"1000\"\n      :dismissable=\"true\"\n      :close-on-escape=\"true\"\n      unstyled\n      :pt=\"{\n        root: {\n          class:\n            'rounded-lg border border-interface-stroke bg-interface-panel-surface shadow-lg p-4 max-w-xs'\n        }\n      }\"\n    >\n      <div class=\"flex flex-col gap-2\">\n        <p class=\"text-sm text-base-foreground leading-normal\">\n          {{ t('subscription.videoEstimateExplanation') }}\n        </p>\n        <a\n          href=\"https://cloud.comfy.org/?template=video_wan2_2_14B_fun_camera\"\n          target=\"_blank\"\n          rel=\"noopener noreferrer\"\n          class=\"text-sm text-azure-600 hover:text-azure-400 no-underline flex gap-1\"\n        >\n          <span class=\"underline\">\n            {{ t('subscription.videoEstimateTryTemplate') }}\n          </span>\n          <span class=\"no-underline\" v-html=\"'&rarr;'\"></span>\n        </a>\n      </div>\n    </Popover>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { cn } from '@comfyorg/tailwind-utils'\nimport Popover from 'primevue/popover'\nimport SelectButton from 'primevue/selectbutton'\nimport type { ToggleButtonPassThroughMethodOptions } from 'primevue/togglebutton'\nimport { computed, ref } from 'vue'\nimport { useI18n } from 'vue-i18n'\n\nimport Button from '@/components/ui/button/Button.vue'\nimport { useFirebaseAuthActions } from '@/composables/auth/useFirebaseAuthActions'\nimport { useErrorHandling } from '@/composables/useErrorHandling'\nimport { getComfyApiBaseUrl } from '@/config/comfyApi'\nimport { t } from '@/i18n'\nimport { useSubscription } from '@/platform/cloud/subscription/composables/useSubscription'\nimport {\n  TIER_PRICING,\n  TIER_TO_KEY\n} from '@/platform/cloud/subscription/constants/tierPricing'\nimport type {\n  TierKey,\n  TierPricing\n} from '@/platform/cloud/subscription/constants/tierPricing'\nimport { isPlanDowngrade } from '@/platform/cloud/subscription/utils/subscriptionTierRank'\nimport type { BillingCycle } from '@/platform/cloud/subscription/utils/subscriptionTierRank'\nimport { isCloud } from '@/platform/distribution/types'\nimport {\n  FirebaseAuthStoreError,\n  useFirebaseAuthStore\n} from '@/stores/firebaseAuthStore'\nimport type { components } from '@/types/comfyRegistryTypes'\n\ntype SubscriptionTier = components['schemas']['SubscriptionTier']\ntype CheckoutTierKey = Exclude<TierKey, 'founder'>\ntype CheckoutTier = CheckoutTierKey | `${CheckoutTierKey}-yearly`\n\nconst getCheckoutTier = (\n  tierKey: CheckoutTierKey,\n  billingCycle: BillingCycle\n): CheckoutTier => (billingCycle === 'yearly' ? `${tierKey}-yearly` : tierKey)\n\ninterface BillingCycleOption {\n  label: string\n  value: BillingCycle\n}\n\ninterface PricingTierConfig {\n  id: SubscriptionTier\n  key: CheckoutTierKey\n  name: string\n  pricing: TierPricing\n  maxDuration: string\n  customLoRAs: boolean\n  isPopular?: boolean\n}\n\nconst billingCycleOptions: BillingCycleOption[] = [\n  { label: t('subscription.yearly'), value: 'yearly' },\n  { label: t('subscription.monthly'), value: 'monthly' }\n]\n\nconst tiers: PricingTierConfig[] = [\n  {\n    id: 'STANDARD',\n    key: 'standard',\n    name: t('subscription.tiers.standard.name'),\n    pricing: TIER_PRICING.standard,\n    maxDuration: t('subscription.maxDuration.standard'),\n    customLoRAs: false,\n    isPopular: false\n  },\n  {\n    id: 'CREATOR',\n    key: 'creator',\n    name: t('subscription.tiers.creator.name'),\n    pricing: TIER_PRICING.creator,\n    maxDuration: t('subscription.maxDuration.creator'),\n    customLoRAs: true,\n    isPopular: true\n  },\n  {\n    id: 'PRO',\n    key: 'pro',\n    name: t('subscription.tiers.pro.name'),\n    pricing: TIER_PRICING.pro,\n    maxDuration: t('subscription.maxDuration.pro'),\n    customLoRAs: true,\n    isPopular: false\n  }\n]\n\nconst { n } = useI18n()\nconst { getAuthHeader } = useFirebaseAuthStore()\nconst { isActiveSubscription, subscriptionTier, isYearlySubscription } =\n  useSubscription()\nconst { accessBillingPortal, reportError } = useFirebaseAuthActions()\nconst { wrapWithErrorHandlingAsync } = useErrorHandling()\n\nconst isLoading = ref(false)\nconst loadingTier = ref<CheckoutTierKey | null>(null)\nconst popover = ref()\nconst currentBillingCycle = ref<BillingCycle>('yearly')\n\nconst currentTierKey = computed<TierKey | null>(() =>\n  subscriptionTier.value ? TIER_TO_KEY[subscriptionTier.value] : null\n)\n\nconst currentPlanDescriptor = computed(() => {\n  if (!currentTierKey.value) return null\n\n  return {\n    tierKey: currentTierKey.value,\n    billingCycle: isYearlySubscription.value ? 'yearly' : 'monthly'\n  } as const\n})\n\nconst isCurrentPlan = (tierKey: CheckoutTierKey): boolean => {\n  if (!currentTierKey.value) return false\n\n  const selectedIsYearly = currentBillingCycle.value === 'yearly'\n\n  return (\n    currentTierKey.value === tierKey &&\n    isYearlySubscription.value === selectedIsYearly\n  )\n}\n\nconst togglePopover = (event: Event) => {\n  popover.value.toggle(event)\n}\n\nconst getButtonLabel = (tier: PricingTierConfig): string => {\n  if (isCurrentPlan(tier.key)) return t('subscription.currentPlan')\n\n  const planName =\n    currentBillingCycle.value === 'yearly'\n      ? t('subscription.tierNameYearly', { name: tier.name })\n      : tier.name\n\n  return isActiveSubscription.value\n    ? t('subscription.changeTo', { plan: planName })\n    : t('subscription.subscribeTo', { plan: planName })\n}\n\nconst getButtonSeverity = (tier: PricingTierConfig): 'primary' | 'secondary' =>\n  isCurrentPlan(tier.key)\n    ? 'secondary'\n    : tier.key === 'creator'\n      ? 'primary'\n      : 'secondary'\n\nconst getButtonTextClass = (tier: PricingTierConfig): string =>\n  tier.key === 'creator'\n    ? 'font-inter text-sm font-bold leading-normal text-base-background'\n    : 'font-inter text-sm font-bold leading-normal text-primary-foreground'\n\nconst getPrice = (tier: PricingTierConfig): number =>\n  tier.pricing[currentBillingCycle.value]\n\nconst getAnnualTotal = (tier: PricingTierConfig): number =>\n  tier.pricing.yearly * 12\n\nconst getCreditsDisplay = (tier: PricingTierConfig): number =>\n  tier.pricing.credits * (currentBillingCycle.value === 'yearly' ? 12 : 1)\n\nconst initiateCheckout = async (tierKey: CheckoutTierKey) => {\n  const authHeader = await getAuthHeader()\n  if (!authHeader) {\n    throw new FirebaseAuthStoreError(t('toastMessages.userNotAuthenticated'))\n  }\n\n  const checkoutTier = getCheckoutTier(tierKey, currentBillingCycle.value)\n  const response = await fetch(\n    `${getComfyApiBaseUrl()}/customers/cloud-subscription-checkout/${checkoutTier}`,\n    {\n      method: 'POST',\n      headers: { ...authHeader, 'Content-Type': 'application/json' }\n    }\n  )\n\n  if (!response.ok) {\n    let errorMessage = 'Failed to initiate checkout'\n    try {\n      const errorData = await response.json()\n      errorMessage = errorData.message || errorMessage\n    } catch {\n      // If JSON parsing fails, try to get text response or use HTTP status\n      try {\n        const errorText = await response.text()\n        errorMessage =\n          errorText || `HTTP ${response.status} ${response.statusText}`\n      } catch {\n        errorMessage = `HTTP ${response.status} ${response.statusText}`\n      }\n    }\n\n    throw new FirebaseAuthStoreError(\n      t('toastMessages.failedToInitiateSubscription', {\n        error: errorMessage\n      })\n    )\n  }\n\n  return await response.json()\n}\n\nconst handleSubscribe = wrapWithErrorHandlingAsync(\n  async (tierKey: CheckoutTierKey) => {\n    if (!isCloud || isLoading.value || isCurrentPlan(tierKey)) return\n\n    isLoading.value = true\n    loadingTier.value = tierKey\n\n    try {\n      if (isActiveSubscription.value) {\n        // Pass the target tier to create a deep link to subscription update confirmation\n        const checkoutTier = getCheckoutTier(tierKey, currentBillingCycle.value)\n        const targetPlan = {\n          tierKey,\n          billingCycle: currentBillingCycle.value\n        }\n        const downgrade =\n          currentPlanDescriptor.value &&\n          isPlanDowngrade({\n            current: currentPlanDescriptor.value,\n            target: targetPlan\n          })\n\n        if (downgrade) {\n          // TODO(COMFY-StripeProration): Remove once backend checkout creation mirrors portal proration (\"change at billing end\")\n          await accessBillingPortal()\n        } else {\n          await accessBillingPortal(checkoutTier)\n        }\n      } else {\n        const response = await initiateCheckout(tierKey)\n        if (response.checkout_url) {\n          window.open(response.checkout_url, '_blank')\n        }\n      }\n    } finally {\n      isLoading.value = false\n      loadingTier.value = null\n    }\n  },\n  reportError\n)\n</script>\n","<template>\n  <div class=\"flex flex-col items-start gap-0 self-stretch\">\n    <div class=\"flex items-center gap-2 py-2\">\n      <i class=\"pi pi-check text-xs text-text-primary\" />\n      <span class=\"text-sm text-text-primary\">\n        {{ $t('subscription.benefits.benefit1') }}\n      </span>\n    </div>\n\n    <div class=\"flex items-center gap-2 py-2\">\n      <i class=\"pi pi-check text-xs text-text-primary\" />\n      <span class=\"text-sm text-text-primary\">\n        {{ $t('subscription.benefits.benefit2') }}\n      </span>\n    </div>\n  </div>\n</template>\n\n<script setup lang=\"ts\"></script>\n","<template>\n  <div\n    v-if=\"showCustomPricingTable\"\n    class=\"relative flex flex-col p-4 pt-8 md:p-16 !overflow-y-auto h-full gap-8\"\n  >\n    <Button\n      size=\"icon\"\n      variant=\"muted-textonly\"\n      class=\"rounded-full shrink-0 text-text-secondary hover:bg-white/10 absolute right-2.5 top-2.5\"\n      :aria-label=\"$t('g.close')\"\n      @click=\"handleClose\"\n    >\n      <i class=\"pi pi-times text-xl\" />\n    </Button>\n    <div class=\"text-center\">\n      <h2 class=\"text-xl lg:text-2xl text-muted-foreground m-0\">\n        {{ $t('subscription.description') }}\n      </h2>\n    </div>\n\n    <PricingTable class=\"flex-1\" />\n\n    <!-- Contact and Enterprise Links -->\n    <div class=\"flex flex-col items-center gap-2\">\n      <p class=\"text-sm text-text-secondary m-0\">\n        {{ $t('subscription.haveQuestions') }}\n      </p>\n      <div class=\"flex items-center gap-1.5\">\n        <Button\n          variant=\"muted-textonly\"\n          class=\"h-6 p-1 text-sm text-text-secondary hover:text-base-foreground\"\n          @click=\"handleContactUs\"\n        >\n          {{ $t('subscription.contactUs') }}\n          <i class=\"pi pi-comments\" />\n        </Button>\n        <span class=\"text-sm text-text-secondary\">{{ $t('g.or') }}</span>\n        <Button\n          variant=\"muted-textonly\"\n          class=\"h-6 p-1 text-sm text-text-secondary hover:text-base-foreground\"\n          @click=\"handleViewEnterprise\"\n        >\n          {{ $t('subscription.viewEnterprise') }}\n          <i class=\"pi pi-external-link\" />\n        </Button>\n      </div>\n    </div>\n  </div>\n  <div v-else class=\"legacy-dialog relative grid h-full grid-cols-5\">\n    <!-- Custom close button -->\n    <Button\n      size=\"icon\"\n      variant=\"muted-textonly\"\n      class=\"rounded-full absolute top-2.5 right-2.5 z-10 h-8 w-8 p-0 text-white hover:bg-white/20\"\n      :aria-label=\"$t('g.close')\"\n      @click=\"handleClose\"\n    >\n      <i class=\"pi pi-times\" />\n    </Button>\n\n    <div\n      class=\"relative col-span-2 flex items-center justify-center overflow-hidden rounded-sm\"\n    >\n      <video\n        autoplay\n        loop\n        muted\n        playsinline\n        class=\"h-full min-w-[125%] object-cover p-0\"\n        style=\"margin-left: -20%\"\n      >\n        <source\n          src=\"/assets/images/cloud-subscription.webm\"\n          type=\"video/webm\"\n        />\n      </video>\n    </div>\n\n    <div class=\"col-span-3 flex flex-col justify-between p-8\">\n      <div>\n        <div class=\"flex flex-col gap-6\">\n          <div class=\"inline-flex items-center gap-2\">\n            <div class=\"text-sm text-text-primary\">\n              {{ $t('subscription.required.title') }}\n            </div>\n            <CloudBadge\n              reverse-order\n              no-padding\n              background-color=\"var(--p-dialog-background)\"\n              use-subscription\n            />\n          </div>\n\n          <div class=\"flex items-baseline gap-2\">\n            <span class=\"text-4xl font-bold\">{{ formattedMonthlyPrice }}</span>\n            <span class=\"text-xl\">{{ $t('subscription.perMonth') }}</span>\n          </div>\n        </div>\n\n        <SubscriptionBenefits class=\"mt-6 text-muted\" />\n      </div>\n\n      <div class=\"flex flex-col pt-8\">\n        <SubscribeButton\n          class=\"py-2 px-4 rounded-lg\"\n          :pt=\"{\n            root: {\n              style: 'background: var(--color-accent-blue, #0B8CE9);'\n            },\n            label: {\n              class: 'font-inter font-[700] text-sm'\n            }\n          }\"\n          @subscribed=\"handleSubscribed\"\n        />\n      </div>\n    </div>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { computed, onBeforeUnmount, watch } from 'vue'\n\nimport CloudBadge from '@/components/topbar/CloudBadge.vue'\nimport Button from '@/components/ui/button/Button.vue'\nimport { MONTHLY_SUBSCRIPTION_PRICE } from '@/config/subscriptionPricesConfig'\nimport PricingTable from '@/platform/cloud/subscription/components/PricingTable.vue'\nimport SubscribeButton from '@/platform/cloud/subscription/components/SubscribeButton.vue'\nimport SubscriptionBenefits from '@/platform/cloud/subscription/components/SubscriptionBenefits.vue'\nimport { useSubscription } from '@/platform/cloud/subscription/composables/useSubscription'\nimport { isCloud } from '@/platform/distribution/types'\nimport { useTelemetry } from '@/platform/telemetry'\nimport { useCommandStore } from '@/stores/commandStore'\n\nconst props = defineProps<{\n  onClose: () => void\n}>()\n\nconst emit = defineEmits<{\n  close: [subscribed: boolean]\n}>()\n\nconst { fetchStatus, isActiveSubscription } = useSubscription()\n\n// Legacy price for non-tier flow with locale-aware formatting\nconst formattedMonthlyPrice = new Intl.NumberFormat(\n  navigator.language || 'en-US',\n  {\n    style: 'currency',\n    currency: 'USD',\n    minimumFractionDigits: 0,\n    maximumFractionDigits: 0\n  }\n).format(MONTHLY_SUBSCRIPTION_PRICE)\nconst commandStore = useCommandStore()\nconst telemetry = useTelemetry()\n\n// Always show custom pricing table for cloud subscriptions\nconst showCustomPricingTable = computed(\n  () => isCloud && window.__CONFIG__?.subscription_required\n)\n\nconst POLL_INTERVAL_MS = 3000\nconst MAX_POLL_ATTEMPTS = 3\nlet pollInterval: number | null = null\nlet pollAttempts = 0\n\nconst stopPolling = () => {\n  if (pollInterval) {\n    clearInterval(pollInterval)\n    pollInterval = null\n  }\n}\n\nconst startPolling = () => {\n  stopPolling()\n  pollAttempts = 0\n\n  const poll = async () => {\n    try {\n      await fetchStatus()\n      pollAttempts++\n\n      if (pollAttempts >= MAX_POLL_ATTEMPTS) {\n        stopPolling()\n      }\n    } catch (error) {\n      console.error(\n        '[SubscriptionDialog] Failed to poll subscription status',\n        error\n      )\n      stopPolling()\n    }\n  }\n\n  void poll()\n  pollInterval = window.setInterval(() => {\n    void poll()\n  }, POLL_INTERVAL_MS)\n}\n\nconst handleWindowFocus = () => {\n  if (showCustomPricingTable.value) {\n    startPolling()\n  }\n}\n\nwatch(\n  showCustomPricingTable,\n  (enabled) => {\n    if (enabled) {\n      window.addEventListener('focus', handleWindowFocus)\n    } else {\n      window.removeEventListener('focus', handleWindowFocus)\n      stopPolling()\n    }\n  },\n  { immediate: true }\n)\n\nwatch(\n  () => isActiveSubscription.value,\n  (isActive) => {\n    if (isActive && showCustomPricingTable.value) {\n      emit('close', true)\n    }\n  }\n)\n\nconst handleSubscribed = () => {\n  emit('close', true)\n}\n\nconst handleClose = () => {\n  stopPolling()\n  props.onClose()\n}\n\nconst handleContactUs = async () => {\n  telemetry?.trackHelpResourceClicked({\n    resource_type: 'help_feedback',\n    is_external: true,\n    source: 'subscription'\n  })\n  await commandStore.execute('Comfy.ContactSupport')\n}\n\nconst handleViewEnterprise = () => {\n  telemetry?.trackHelpResourceClicked({\n    resource_type: 'docs',\n    is_external: true,\n    source: 'subscription'\n  })\n  window.open('https://www.comfy.org/cloud/enterprise', '_blank')\n}\n\nonBeforeUnmount(() => {\n  stopPolling()\n  window.removeEventListener('focus', handleWindowFocus)\n})\n</script>\n\n<style scoped>\n.legacy-dialog :deep(.bg-comfy-menu-secondary) {\n  background-color: transparent;\n}\n\n.legacy-dialog :deep(.p-button) {\n  color: white;\n}\n</style>\n"],"names":["cloudBadge","computed","t","_imports_0","MONTHLY_SUBSCRIPTION_PRICE","PLAN_ORDER","acc","plan","index","billingCycleOptions","tiers","TIER_PRICING","n","useI18n","getAuthHeader","useFirebaseAuthStore","isActiveSubscription","subscriptionTier","isYearlySubscription","useSubscription","accessBillingPortal","reportError","useFirebaseAuthActions","wrapWithErrorHandlingAsync","useErrorHandling","isLoading","ref","loadingTier","popover","currentBillingCycle","currentTierKey","TIER_TO_KEY","isCurrentPlan","__name","tierKey","selectedIsYearly","togglePopover","event","getButtonLabel","tier","planName","getButtonSeverity","getButtonTextClass","getPrice","getAnnualTotal","getCreditsDisplay","handleSubscribe","_hoisted_1","_hoisted_2","_hoisted_3","_hoisted_4","_hoisted_5","_openBlock","_createElementBlock","_createElementVNode","_toDisplayString","_ctx","POLL_INTERVAL_MS","MAX_POLL_ATTEMPTS","props","__props","emit","__emit","fetchStatus","formattedMonthlyPrice","commandStore","useCommandStore","showCustomPricingTable","isCloud","pollInterval","pollAttempts","stopPolling","startPolling","poll","error","handleWindowFocus","watch","enabled","isActive","handleSubscribed","handleClose","handleContactUs","handleViewEnterprise","onBeforeUnmount"],"mappings":"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"}