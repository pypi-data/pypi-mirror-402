{"version":3,"file":"ComfyQueueButton-CBfnK4k7.js","sources":["../../../../../../../ComfyUI_frontend/src/components/actionbar/BatchCountEdit.vue","../../../../../../../ComfyUI_frontend/src/components/actionbar/ComfyRunButton/ComfyQueueButton.vue"],"sourcesContent":["<template>\n  <div\n    v-tooltip.bottom=\"{\n      value: $t('menu.batchCount'),\n      showDelay: 600\n    }\"\n    class=\"batch-count\"\n    :aria-label=\"$t('menu.batchCount')\"\n  >\n    <InputNumber\n      v-model=\"batchCount\"\n      class=\"w-14\"\n      :min=\"minQueueCount\"\n      :max=\"maxQueueCount\"\n      fluid\n      show-buttons\n      :pt=\"{\n        incrementButton: {\n          class: 'w-6',\n          onmousedown: () => {\n            handleClick(true)\n          }\n        },\n        decrementButton: {\n          class: 'w-6',\n          onmousedown: () => {\n            handleClick(false)\n          }\n        }\n      }\"\n    />\n  </div>\n</template>\n\n<script lang=\"ts\" setup>\nimport { storeToRefs } from 'pinia'\nimport InputNumber from 'primevue/inputnumber'\nimport { computed } from 'vue'\n\nimport { useSettingStore } from '@/platform/settings/settingStore'\nimport { useQueueSettingsStore } from '@/stores/queueStore'\n\nconst queueSettingsStore = useQueueSettingsStore()\nconst { batchCount } = storeToRefs(queueSettingsStore)\nconst minQueueCount = 1\n\nconst settingStore = useSettingStore()\nconst maxQueueCount = computed(() =>\n  settingStore.get('Comfy.QueueButton.BatchCountLimit')\n)\n\nconst handleClick = (increment: boolean) => {\n  let newCount: number\n  if (increment) {\n    const originalCount = batchCount.value - 1\n    newCount = Math.min(originalCount * 2, maxQueueCount.value)\n  } else {\n    const originalCount = batchCount.value + 1\n    newCount = Math.floor(originalCount / 2)\n  }\n\n  batchCount.value = newCount\n}\n</script>\n\n<style scoped>\n:deep(.p-inputtext) {\n  border-top-left-radius: 0;\n  border-bottom-left-radius: 0;\n}\n</style>\n","<template>\n  <div class=\"queue-button-group flex\">\n    <SplitButton\n      v-tooltip.bottom=\"{\n        value: queueButtonTooltip,\n        showDelay: 600\n      }\"\n      class=\"comfyui-queue-button\"\n      :label=\"String(activeQueueModeMenuItem?.label ?? '')\"\n      severity=\"primary\"\n      size=\"small\"\n      :model=\"queueModeMenuItems\"\n      data-testid=\"queue-button\"\n      @click=\"queuePrompt\"\n    >\n      <template #icon>\n        <i :class=\"iconClass\" />\n      </template>\n      <template #item=\"{ item }\">\n        <Button\n          v-tooltip=\"{\n            value: item.tooltip,\n            showDelay: 600\n          }\"\n          :variant=\"item.key === queueMode ? 'primary' : 'secondary'\"\n          size=\"sm\"\n          class=\"w-full justify-start\"\n        >\n          <i v-if=\"item.icon\" :class=\"item.icon\" />\n          {{ String(item.label ?? '') }}\n        </Button>\n      </template>\n    </SplitButton>\n    <BatchCountEdit />\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { storeToRefs } from 'pinia'\nimport type { MenuItem } from 'primevue/menuitem'\nimport SplitButton from 'primevue/splitbutton'\nimport { computed } from 'vue'\nimport { useI18n } from 'vue-i18n'\n\nimport Button from '@/components/ui/button/Button.vue'\nimport { isCloud } from '@/platform/distribution/types'\nimport { useTelemetry } from '@/platform/telemetry'\nimport { app } from '@/scripts/app'\nimport { useCommandStore } from '@/stores/commandStore'\nimport { useNodeDefStore } from '@/stores/nodeDefStore'\nimport { useQueueSettingsStore } from '@/stores/queueStore'\nimport { useWorkspaceStore } from '@/stores/workspaceStore'\nimport { graphHasMissingNodes } from '@/workbench/extensions/manager/utils/graphHasMissingNodes'\n\nimport BatchCountEdit from '../BatchCountEdit.vue'\n\nconst workspaceStore = useWorkspaceStore()\nconst { mode: queueMode, batchCount } = storeToRefs(useQueueSettingsStore())\n\nconst nodeDefStore = useNodeDefStore()\nconst hasMissingNodes = computed(() =>\n  graphHasMissingNodes(app.rootGraph, nodeDefStore.nodeDefsByName)\n)\n\nconst { t } = useI18n()\nconst queueModeMenuItemLookup = computed(() => {\n  const items: Record<string, MenuItem> = {\n    disabled: {\n      key: 'disabled',\n      label: t('menu.run'),\n      tooltip: t('menu.disabledTooltip'),\n      command: () => {\n        queueMode.value = 'disabled'\n      }\n    },\n    change: {\n      key: 'change',\n      label: `${t('menu.run')} (${t('menu.onChange')})`,\n      tooltip: t('menu.onChangeTooltip'),\n      command: () => {\n        useTelemetry()?.trackUiButtonClicked({\n          button_id: 'queue_mode_option_run_on_change_selected'\n        })\n        queueMode.value = 'change'\n      }\n    }\n  }\n  if (!isCloud) {\n    items.instant = {\n      key: 'instant',\n      label: `${t('menu.run')} (${t('menu.instant')})`,\n      tooltip: t('menu.instantTooltip'),\n      command: () => {\n        useTelemetry()?.trackUiButtonClicked({\n          button_id: 'queue_mode_option_run_instant_selected'\n        })\n        queueMode.value = 'instant'\n      }\n    }\n  }\n  return items\n})\n\nconst activeQueueModeMenuItem = computed(() => {\n  // Fallback to disabled mode if current mode is not available (e.g., instant mode in cloud)\n  return (\n    queueModeMenuItemLookup.value[queueMode.value] ||\n    queueModeMenuItemLookup.value.disabled\n  )\n})\nconst queueModeMenuItems = computed(() =>\n  Object.values(queueModeMenuItemLookup.value)\n)\n\nconst iconClass = computed(() => {\n  if (hasMissingNodes.value) {\n    return 'icon-[lucide--triangle-alert]'\n  }\n  if (workspaceStore.shiftDown) {\n    return 'icon-[lucide--list-start]'\n  }\n  if (queueMode.value === 'disabled') {\n    return 'icon-[lucide--play]'\n  }\n  if (queueMode.value === 'instant') {\n    return 'icon-[lucide--fast-forward]'\n  }\n  if (queueMode.value === 'change') {\n    return 'icon-[lucide--step-forward]'\n  }\n  return 'icon-[lucide--play]'\n})\n\nconst queueButtonTooltip = computed(() => {\n  if (hasMissingNodes.value) {\n    return t('menu.runWorkflowDisabled')\n  }\n  if (workspaceStore.shiftDown) {\n    return t('menu.runWorkflowFront')\n  }\n  return t('menu.runWorkflow')\n})\n\nconst commandStore = useCommandStore()\nconst queuePrompt = async (e: Event) => {\n  const isShiftPressed = 'shiftKey' in e && e.shiftKey\n  const commandId = isShiftPressed\n    ? 'Comfy.QueuePromptFront'\n    : 'Comfy.QueuePrompt'\n\n  if (batchCount.value > 1) {\n    useTelemetry()?.trackUiButtonClicked({\n      button_id: 'queue_run_multiple_batches_submitted'\n    })\n  }\n\n  await commandStore.execute(commandId, {\n    metadata: {\n      subscribe_to_run: false,\n      trigger_source: 'button'\n    }\n  })\n}\n</script>\n\n<style scoped>\n.comfyui-queue-button :deep(.p-splitbutton-dropdown) {\n  border-top-right-radius: 0;\n  border-bottom-right-radius: 0;\n}\n</style>\n"],"names":["minQueueCount","queueSettingsStore","useQueueSettingsStore","batchCount","storeToRefs","settingStore","useSettingStore","maxQueueCount","computed","handleClick","__name","increment","newCount","originalCount","workspaceStore","useWorkspaceStore","queueMode","nodeDefStore","useNodeDefStore","hasMissingNodes","graphHasMissingNodes","app","t","useI18n","queueModeMenuItemLookup","items","activeQueueModeMenuItem","queueModeMenuItems","iconClass","queueButtonTooltip","commandStore","useCommandStore","queuePrompt","e","commandId"],"mappings":"0lCA4CMA,EAAgB,wCAFtB,MAAMC,EAAqBC,EAAA,EACrB,CAAE,WAAAC,CAAA,EAAeC,EAAYH,CAAkB,EAG/CI,EAAeC,EAAA,EACfC,EAAgBC,EAAS,IAC7BH,EAAa,IAAI,mCAAmC,CAAA,EAGhDI,EAAcC,EAACC,GAAuB,CAC1C,IAAIC,EACJ,GAAID,EAAW,CACb,MAAME,EAAgBV,EAAW,MAAQ,EACzCS,EAAW,KAAK,IAAIC,EAAgB,EAAGN,EAAc,KAAK,CAC5D,KAAO,CACL,MAAMM,EAAgBV,EAAW,MAAQ,EACzCS,EAAW,KAAK,MAAMC,EAAgB,CAAC,CACzC,CAEAV,EAAW,MAAQS,CACrB,EAXoB,+oBCKpB,MAAME,EAAiBC,EAAA,EACjB,CAAE,KAAMC,EAAW,WAAAb,GAAeC,EAAYF,GAAuB,EAErEe,EAAeC,EAAA,EACfC,EAAkBX,EAAS,IAC/BY,EAAqBC,EAAI,UAAWJ,EAAa,cAAc,CAAA,EAG3D,CAAE,EAAAK,CAAA,EAAMC,EAAA,EACRC,EAA0BhB,EAAS,IAAM,CAC7C,MAAMiB,EAAkC,CACtC,SAAU,CACR,IAAK,WACL,MAAOH,EAAE,UAAU,EACnB,QAASA,EAAE,sBAAsB,EACjC,QAASZ,EAAA,IAAM,CACbM,EAAU,MAAQ,UACpB,EAFS,UAET,EAEF,OAAQ,CACN,IAAK,SACL,MAAO,GAAGM,EAAE,UAAU,CAAC,KAAKA,EAAE,eAAe,CAAC,IAC9C,QAASA,EAAE,sBAAsB,EACjC,QAASZ,EAAA,IAAM,CAIbM,EAAU,MAAQ,QACpB,EALS,UAKT,CACF,EAGA,OAAAS,EAAM,QAAU,CACd,IAAK,UACL,MAAO,GAAGH,EAAE,UAAU,CAAC,KAAKA,EAAE,cAAc,CAAC,IAC7C,QAASA,EAAE,qBAAqB,EAChC,QAASZ,EAAA,IAAM,CAIbM,EAAU,MAAQ,SACpB,EALS,UAKT,EAGGS,CACT,CAAC,EAEKC,EAA0BlB,EAAS,IAGrCgB,EAAwB,MAAMR,EAAU,KAAK,GAC7CQ,EAAwB,MAAM,QAEjC,EACKG,EAAqBnB,EAAS,IAClC,OAAO,OAAOgB,EAAwB,KAAK,CAAA,EAGvCI,EAAYpB,EAAS,IACrBW,EAAgB,MACX,gCAELL,EAAe,UACV,4BAELE,EAAU,QAAU,WACf,sBAELA,EAAU,QAAU,UACf,8BAELA,EAAU,QAAU,SACf,8BAEF,qBACR,EAEKa,EAAqBrB,EAAS,IAC9BW,EAAgB,MACXG,EAAE,0BAA0B,EAEjCR,EAAe,UACVQ,EAAE,uBAAuB,EAE3BA,EAAE,kBAAkB,CAC5B,EAEKQ,EAAeC,EAAA,EACfC,EAActB,EAAA,MAAOuB,GAAa,CAEtC,MAAMC,EADiB,aAAcD,GAAKA,EAAE,SAExC,yBACA,oBAEA9B,EAAW,MAAQ,EAMvB,MAAM2B,EAAa,QAAQI,EAAW,CACpC,SAAU,CACR,iBAAkB,GAClB,eAAgB,QAAA,CAClB,CACD,CACH,EAlBoB"}