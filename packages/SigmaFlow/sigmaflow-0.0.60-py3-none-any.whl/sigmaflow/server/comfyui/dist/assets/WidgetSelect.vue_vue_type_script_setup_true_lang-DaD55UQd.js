var fe=Object.defineProperty;var v=(l,e)=>fe(l,"name",{value:e,configurable:!0});import{c as x,_ as me,f as oe,t as L,M as ge,a as ve,k as ye,cD as be}from"./index-Btwre5kD.js";import{E as c,bx as T,cM as F,cN as z,j as I,d as m,k as E,z as B,e as M,by as b,m as ae,p as we,c as $,s as C,q as P,u as j,dF as J,r as D,l as se,dm as he,F as _,y as ee,i as Se,h as ke,A as Me,du as $e,w as Y,bB as xe,eE as Ue,bl as Ce}from"./vendor-other-PcOcwbNM.js";import{i as ze,p as ne}from"./vendor-primevue-6nO4LMK3.js";import"./vendor-xterm-CWYFmgbN.js";import{f as ie,P as re}from"./widgetPropFilter-CygYoMQt.js";import{W as de}from"./index-nFsJo5_A.js";import{_ as ue}from"./WidgetLayoutField.vue_vue_type_script_setup_true_lang-_5MIxhdG.js";import{a as Ve,c as Oe}from"./LazyImage.vue_vue_type_script_setup_true_lang-DWsAzzJG.js";import{_ as Ae}from"./WidgetWithControl.vue_vue_type_script_setup_true_lang-D8uN-qtF.js";function ce(l={}){return c(()=>({appendTo:"self",...l}))}v(ce,"useTransformCompatOverlayProps");const De={class:"absolute top-5 right-8 h-4 w-7 -translate-y-4/5 flex"},te=T({__name:"WidgetSelectDefault",props:F({widget:{}},{modelValue:{default(l){return l.widget.options?.values?.[0]||""}},modelModifiers:{}}),emits:["update:modelValue"],setup(l){const e=l,i=z(l,"modelValue"),w=ce(),r=c(()=>{const a=e.widget.options;return a?.values&&Array.isArray(a.values)?a.values:[]}),y=c(()=>!!i.value&&!r.value.includes(i.value)),p=c(()=>({...ie(e.widget.options,re),...w.value,...y.value?{placeholder:`${i.value}`}:{}}));return(a,u)=>(m(),I(ue,{widget:a.widget},{default:E(()=>[B(b(ze),ae({modelValue:i.value,"onUpdate:modelValue":u[0]||(u[0]=g=>i.value=g),invalid:y.value,filter:r.value.length>4,"auto-filter-focus":r.value.length>4,options:r.value},p.value,{class:b(x)(b(de),"w-full text-xs"),"aria-label":a.widget.name,size:"small",pt:{option:"text-xs",dropdown:"w-8",label:b(x)("truncate min-w-[4ch]",a.$slots.default&&"mr-5"),overlay:"w-fit min-w-full"},"data-capture-wheel":"true"}),null,16,["modelValue","invalid","filter","auto-filter-focus","options","class","aria-label","pt"]),M("div",De,[we(a.$slots,"default")])]),_:3},8,["widget"]))}}),Ie={class:"min-w-0 flex-1 px-1 py-2 text-left truncate"},Te={key:0},Qe={key:1},Fe=["multiple","disabled","accept"],Pe=T({__name:"FormDropdownInput",props:{isOpen:{type:Boolean,default:!1},placeholder:{default:"Select..."},items:{},selected:{},maxSelectable:{},uploadable:{type:Boolean},disabled:{type:Boolean},accept:{}},emits:["select-click","file-change"],setup(l,{emit:e}){const i=l,w=e,r=c(()=>i.items.filter(p=>i.selected.has(p.id))),y=c(()=>x("border-0 bg-component-node-widget-background outline-none text-text-secondary",i.disabled?"cursor-not-allowed":"hover:bg-component-node-widget-background-hovered cursor-pointer",r.value.length>0&&"text-text-primary"));return(p,a)=>(m(),$("div",{class:C(b(x)(b(de),"flex text-base leading-none",{"opacity-50 cursor-not-allowed !outline-zinc-300/10":p.disabled}))},[M("button",{class:C(b(x)(y.value,"flex justify-between items-center flex-1 min-w-0 h-8",{"rounded-l-lg":p.uploadable,"rounded-lg":!p.uploadable})),onClick:a[0]||(a[0]=u=>w("select-click",u))},[M("span",Ie,[r.value.length?(m(),$("span",Qe,j(r.value.map(u=>u.label??u.name).join(", ")),1)):(m(),$("span",Te,j(p.placeholder),1))]),M("i",{class:C(["icon-[lucide--chevron-down]",b(x)("mr-2 size-4 transition-transform duration-200 flex-shrink-0 text-component-node-foreground-secondary",p.isOpen&&"rotate-180")])},null,2)],2),p.uploadable?(m(),$("label",{key:0,class:C(b(x)(y.value,"relative","size-8 flex justify-center items-center border-l rounded-r-lg border-zinc-300/10"))},[a[2]||(a[2]=M("i",{class:"icon-[lucide--folder-search] size-4"},null,-1)),M("input",{type:"file",class:"absolute inset-0 -z-1 opacity-0",multiple:p.maxSelectable>1,disabled:p.disabled,accept:p.accept,onChange:a[1]||(a[1]=u=>w("file-change",u))},null,40,Fe)],2)):P("",!0)],2))}}),Le={class:"text-secondary flex gap-2 px-4"},Be={key:0,class:"mr-2 icon-[lucide--loader-circle] size-4 animate-spin"},je={key:1,class:"mr-2 icon-[lucide--search] size-4"},Re=["placeholder"],We={key:0,class:"absolute top-[-2px] left-[-2px] size-2 rounded-full bg-component-node-widget-background-highlighted"},Ke=["onClick"],Ee={key:0,class:"icon-[lucide--check] size-4"},K="bg-transparent border-0 outline-0 ring-0 text-left",le="size-6 flex justify-center items-center rounded-sm cursor-pointer transition-all duration-150 hover:scale-108 hover:text-base-foreground active:scale-95",qe=T({__name:"FormDropdownMenuActions",props:F({isQuerying:{type:Boolean},sortOptions:{}},{layoutMode:{},layoutModeModifiers:{},searchQuery:{},searchQueryModifiers:{},sortSelected:{},sortSelectedModifiers:{}}),emits:["update:layoutMode","update:searchQuery","update:sortSelected"],setup(l){const e=z(l,"layoutMode"),i=z(l,"searchQuery"),w=z(l,"sortSelected"),r=x("h-8 bg-zinc-500/20 rounded-lg outline outline-1 outline-offset-[-1px] outline-node-component-border transition-all duration-150"),y=J("sortPopoverRef"),p=J("sortTriggerRef"),a=D(!1);function u(n){!y.value||!p.value||(a.value=!a.value,y.value.toggle(n,p.value))}v(u,"toggleSortPopover");function g(){a.value=!1,y.value?.hide()}v(g,"closeSortPopover");function o(n){w.value=n.id,g()}return v(o,"handleSortSelected"),(n,f)=>(m(),$("div",Le,[M("label",{class:C(b(x)(b(r),"flex-1 flex px-2 items-center text-base leading-none cursor-text",i.value?.trim()!==""?"text-base-foreground":"","hover:outline-component-node-widget-background-highlighted/80","focus-within:outline-component-node-widget-background-highlighted/80"))},[n.isQuerying?(m(),$("i",Be)):(m(),$("i",je)),se(M("input",{"onUpdate:modelValue":f[0]||(f[0]=h=>i.value=h),type:"text",autofocus:"",class:C(K),placeholder:n.$t("g.search")},null,8,Re),[[he,i.value]])],2),M("button",{ref_key:"sortTriggerRef",ref:p,class:C(b(x)(K,b(r),"relative w-8 flex justify-center items-center cursor-pointer","hover:outline-component-node-widget-background-highlighted","active:!scale-95")),onClick:u},[w.value!=="default"?(m(),$("div",We)):P("",!0),f[4]||(f[4]=M("i",{class:"icon-[lucide--arrow-up-down] size-4"},null,-1))],2),B(b(ne),{ref_key:"sortPopoverRef",ref:y,dismissable:!0,"close-on-escape":!0,unstyled:"",pt:{root:{class:"absolute z-50"},content:{class:["bg-transparent border-none p-0 pt-2 rounded-lg shadow-lg"]}},onHide:f[1]||(f[1]=h=>a.value=!1)},{default:E(()=>[M("div",{class:C(b(x)("flex flex-col gap-2 p-2 min-w-32","bg-component-node-background","rounded-lg outline outline-offset-[-1px] outline-component-node-border"))},[(m(!0),$(_,null,ee(n.sortOptions,h=>(m(),$("button",{key:h.name,class:C(b(x)(K,"flex justify-between items-center h-6 cursor-pointer","hover:!text-blue-500")),onClick:v(V=>o(h),"onClick")},[M("span",null,j(h.name),1),w.value===h.id?(m(),$("i",Ee)):P("",!0)],10,Ke))),128))],2)]),_:1},512),M("div",{class:C(b(x)(b(r),"flex justify-center items-center p-1 gap-1 hover:outline-component-node-widget-background-highlighted"))},[M("button",{class:C(b(x)(K,le,e.value==="list"?"bg-neutral-500/50 text-base-foreground":"")),onClick:f[2]||(f[2]=h=>e.value="list")},f[5]||(f[5]=[M("i",{class:"icon-[lucide--list] size-4"},null,-1)]),2),M("button",{class:C(b(x)(K,le,e.value==="grid"?"bg-neutral-500/50 text-base-foreground":"")),onClick:f[3]||(f[3]=h=>e.value="grid")},f[6]||(f[6]=[M("i",{class:"icon-[lucide--layout-grid] size-4"},null,-1)]),2)],2)]))}}),He={class:"text-secondary mb-4 flex gap-1 px-4 justify-start"},Ne=["disabled","onClick"],Xe=T({__name:"FormDropdownMenuFilter",props:F({filterOptions:{}},{filterSelected:{},filterSelectedModifiers:{}}),emits:["update:filterSelected"],setup(l){const e=z(l,"filterSelected"),{isUploadButtonEnabled:i,showUploadDialog:w}=Ve(),r=c(()=>l.filterOptions.length===1);return(y,p)=>(m(),$("div",He,[(m(!0),$(_,null,ee(y.filterOptions,a=>(m(),$("button",{key:a.id,type:"button",disabled:r.value,class:C(b(x)("px-4 py-2 rounded-md inline-flex justify-center items-center select-none appearance-none border-0 text-base-foreground",!r.value&&"transition-all duration-150 hover:text-base-foreground hover:bg-interface-menu-component-surface-hovered cursor-pointer active:scale-95",!r.value&&e.value===a.id?"!bg-interface-menu-component-surface-selected text-base-foreground":"bg-transparent")),onClick:v(u=>e.value=a.id,"onClick")},j(a.name),11,Ne))),128)),b(i)&&r.value?(m(),I(me,{key:0,class:"ml-auto",size:"md",variant:"textonly",onClick:b(w)},{default:E(()=>[p[0]||(p[0]=M("i",{class:"icon-[lucide--folder-input]"},null,-1)),M("span",null,j(y.$t("g.import")),1)]),_:1},8,["onClick"])):P("",!0)]))}}),pe=Symbol("assetKind"),Ze={key:0,class:"absolute top-1 left-1 size-4 rounded-full border-1 border-base-foreground bg-primary-background"},Ge=["src"],Je={key:3,class:"size-full bg-gradient-to-tr from-blue-400 via-teal-500 to-green-400"},Ye={class:"text-secondary block text-xs"},_e=T({__name:"FormDropdownMenuItem",props:{index:{},selected:{type:Boolean},mediaSrc:{},name:{},label:{},metadata:{},layout:{}},emits:["click","mediaLoad"],setup(l,{emit:e}){const i=l,w=e,r=D(null),y=Se(pe),p=c(()=>y?.value==="video");function a(){w("click",i.index)}v(a,"handleClick");function u(o){if(w("mediaLoad",o),!o.target||!(o.target instanceof HTMLImageElement))return;const n=o.target;n.naturalWidth&&n.naturalHeight&&(r.value=`${n.naturalWidth} x ${n.naturalHeight}`)}v(u,"handleImageLoad");function g(o){if(w("mediaLoad",o),!o.target||!(o.target instanceof HTMLVideoElement))return;const n=o.target;n.videoWidth&&n.videoHeight&&(r.value=`${n.videoWidth} x ${n.videoHeight}`)}return v(g,"handleVideoLoad"),(o,n)=>{const f=ke("tooltip");return m(),$("div",{class:C(b(x)("flex gap-1 select-none group/item cursor-pointer bg-component-node-widget-background","transition-all duration-150",{"flex-col text-center":o.layout==="grid","flex-row text-left max-h-16 rounded-lg hover:scale-102 active:scale-98":o.layout==="list","flex-row text-left hover:bg-component-node-widget-background-hovered rounded-lg":o.layout==="list-small","ring-2 ring-component-node-widget-background-highlighted":o.layout==="list"&&o.selected})),onClick:a},[o.layout!=="list-small"?(m(),$("div",{key:0,class:C(b(x)("relative","w-full aspect-square overflow-hidden outline-1 outline-offset-[-1px] outline-interface-stroke","transition-all duration-150",{"min-w-16 max-w-16 rounded-l-lg":o.layout==="list","rounded-sm group-hover/item:scale-108 group-active/item:scale-95":o.layout==="grid","ring-2 ring-component-node-widget-background-highlighted":o.layout==="grid"&&o.selected}))},[o.selected?(m(),$("div",Ze,n[0]||(n[0]=[M("i",{class:"icon-[lucide--check] size-3 translate-y-[-0.5px] text-base-foreground bold"},null,-1)]))):P("",!0),o.mediaSrc&&p.value?(m(),$("video",{key:1,src:o.mediaSrc,class:"size-full object-cover",preload:"metadata",muted:"",onLoadeddata:g},null,40,Ge)):o.mediaSrc?(m(),I(Oe,{key:2,src:o.mediaSrc,alt:o.name,"image-class":"size-full object-cover",onLoad:u},null,8,["src","alt"])):(m(),$("div",Je))],2)):P("",!0),M("div",{class:C(b(x)("flex gap-1",{"flex-col":o.layout==="grid","flex-col px-4 py-1 w-full justify-center min-w-0":o.layout==="list","flex-row p-2 items-center justify-between w-full":o.layout==="list-small"}))},[se((m(),$("span",{class:C(b(x)("block text-xs line-clamp-2 break-words overflow-hidden","transition-colors duration-150",!!o.selected&&"text-base-foreground"))},[Me(j(o.label??o.name),1)],2)),[[f,o.layout==="grid"?o.label??o.name:void 0]]),M("span",Ye,j(o.metadata||r.value),1)],2)],2)}}}),et={class:"flex max-h-[640px] w-103 flex-col rounded-lg bg-component-node-background pt-4 outline outline-offset-[-1px] outline-node-component-border"},tt={class:"relative flex h-full mt-2 overflow-y-scroll"},lt={key:0,class:"h-50 col-span-full flex items-center justify-center"},ot=["title","aria-label"],at=T({__name:"FormDropdownMenu",props:F({items:{},isSelected:{type:Function},isQuerying:{type:Boolean},filterOptions:{},sortOptions:{}},{filterSelected:{},filterSelectedModifiers:{},layoutMode:{},layoutModeModifiers:{},sortSelected:{},sortSelectedModifiers:{},searchQuery:{},searchQueryModifiers:{}}),emits:F(["item-click"],["update:filterSelected","update:layoutMode","update:sortSelected","update:searchQuery"]),setup(l,{emit:e}){const i=e,w=z(l,"filterSelected"),r=z(l,"layoutMode"),y=z(l,"sortSelected"),p=z(l,"searchQuery");return(a,u)=>(m(),$("div",et,[a.filterOptions.length>0?(m(),I(Xe,{key:0,"filter-selected":w.value,"onUpdate:filterSelected":u[0]||(u[0]=g=>w.value=g),"filter-options":a.filterOptions},null,8,["filter-selected","filter-options"])):P("",!0),B(qe,{"layout-mode":r.value,"onUpdate:layoutMode":u[1]||(u[1]=g=>r.value=g),"sort-selected":y.value,"onUpdate:sortSelected":u[2]||(u[2]=g=>y.value=g),"search-query":p.value,"onUpdate:searchQuery":u[3]||(u[3]=g=>p.value=g),"sort-options":a.sortOptions,"is-querying":a.isQuerying},null,8,["layout-mode","sort-selected","search-query","sort-options","is-querying"]),M("div",tt,[M("div",{class:C(b(x)("h-full max-h-full grid gap-x-2 gap-y-4 overflow-y-auto px-4 pt-4 pb-4 w-full",{"grid-cols-4":r.value==="grid","grid-cols-1 gap-y-2":r.value==="list","grid-cols-1 gap-y-1":r.value==="list-small"}))},[u[4]||(u[4]=M("div",{class:"pointer-events-none absolute inset-x-3 top-0 z-10 h-5"},null,-1)),a.items.length===0?(m(),$("div",lt,[M("i",{title:a.$t("g.noItems"),"aria-label":a.$t("g.noItems"),class:"icon-[lucide--circle-off] size-30 text-zinc-500/20"},null,8,ot)])):P("",!0),(m(!0),$(_,null,ee(a.items,(g,o)=>(m(),I(_e,{key:g.id,index:o,selected:a.isSelected(g,o),"media-src":g.mediaSrc,name:g.name,label:g.label,metadata:g.metadata,layout:r.value,onClick:v(n=>i("item-click",g,o),"onClick")},null,8,["index","selected","media-src","name","label","metadata","layout","onClick"]))),128))],2)])]))}});async function st(l,e){if(l.trim()==="")return e;const i=l.trim().toLowerCase().split(" ");return e.filter(w=>{const r=w.name.toLowerCase();return i.every(y=>r.includes(y))})}v(st,"defaultSearcher");function nt(){return[{name:"Default",id:"default",sorter:v(({items:l})=>l.slice(),"sorter")},{name:"A-Z",id:"a-z",sorter:v(({items:l})=>l.slice().sort((e,i)=>e.name.localeCompare(i.name)),"sorter")}]}v(nt,"getDefaultSortOptions");const it=T({__name:"FormDropdown",props:F({items:{},placeholder:{default:L("widgets.uploadSelect.placeholder")},multiple:{type:[Boolean,Number],default:!1},uploadable:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},accept:{},filterOptions:{default:v(()=>[],"default")},sortOptions:{default:v(()=>nt(),"default")},isSelected:{type:Function,default:v((l,e,i)=>l.has(e.id),"default")},searcher:{type:Function,default:st}},{selected:{default:new Set},selectedModifiers:{},filterSelected:{default:""},filterSelectedModifiers:{},sortSelected:{default:"default"},sortSelectedModifiers:{},layoutMode:{default:"grid"},layoutModeModifiers:{},files:{default:[]},filesModifiers:{},searchQuery:{default:""},searchQueryModifiers:{}}),emits:["update:selected","update:filterSelected","update:sortSelected","update:layoutMode","update:files","update:searchQuery"],setup(l){const e=l,i=z(l,"selected"),w=z(l,"filterSelected"),r=z(l,"sortSelected"),y=z(l,"layoutMode"),p=z(l,"files"),a=z(l,"searchQuery"),u=$e(a,700,{maxWait:700}),g=D(!1),o=oe(),n=D(),f=J("triggerRef"),h=D(!1),V=c(()=>e.multiple===!0?1/0:typeof e.multiple=="number"?e.multiple:1),R=D([]);Y(a,k=>{g.value=k!==u.value}),Y([u,()=>e.items],(k,S,t)=>{let s=!1,d;t(()=>{s=!0,d?.()}),e.searcher(u.value,e.items,U=>d=U).then(U=>{s||(R.value=U)}).finally(()=>{s||(g.value=!1)})},{immediate:!0});const O=c(()=>e.sortOptions.find(S=>S.id==="default")?.sorter||(({items:S})=>S.slice())),Q=c(()=>r.value==="default"?O.value:e.sortOptions.find(S=>S.id===r.value)?.sorter||O.value),q=c(()=>Q.value({items:R.value})||[]);function H(k,S){return e.isSelected?.(i.value,k,S)??!1}v(H,"internalIsSelected");const N=v(k=>{e.disabled||n.value&&f.value&&(n.value.toggle(k,f.value),h.value=!h.value)},"toggleDropdown"),X=v(()=>{n.value&&(n.value.hide(),h.value=!1)},"closeDropdown");function Z(k){if(e.disabled)return;const S=k.target;S.files&&(p.value=Array.from(S.files)),S.value=""}v(Z,"handleFileChange");function G(k,S){if(e.disabled)return;const t=i.value;if(H(k,S))t.delete(k.id);else if(t.size<V.value)t.add(k.id);else if(V.value===1)t.clear(),t.add(k.id);else{o.addAlert("Maximum selection limit reached");return}i.value=new Set(t),V.value===1&&X()}return v(G,"handleSelection"),(k,S)=>(m(),$("div",{ref_key:"triggerRef",ref:f},[B(Pe,{files:p.value,"is-open":h.value,placeholder:k.placeholder,items:k.items,"max-selectable":V.value,selected:i.value,uploadable:k.uploadable,disabled:k.disabled,accept:k.accept,onSelectClick:N,onFileChange:Z},null,8,["files","is-open","placeholder","items","max-selectable","selected","uploadable","disabled","accept"]),B(b(ne),{ref_key:"popoverRef",ref:n,dismissable:!0,"close-on-escape":!0,unstyled:"",pt:{root:{class:"absolute z-50"},content:{class:["bg-transparent border-none p-0 pt-2 rounded-lg shadow-lg"]}},onHide:S[4]||(S[4]=t=>h.value=!1)},{default:E(()=>[B(at,{"filter-selected":w.value,"onUpdate:filterSelected":S[0]||(S[0]=t=>w.value=t),"layout-mode":y.value,"onUpdate:layoutMode":S[1]||(S[1]=t=>y.value=t),"sort-selected":r.value,"onUpdate:sortSelected":S[2]||(S[2]=t=>r.value=t),"search-query":a.value,"onUpdate:searchQuery":S[3]||(S[3]=t=>a.value=t),"filter-options":k.filterOptions,"sort-options":k.sortOptions,disabled:k.disabled,"is-querying":g.value,items:q.value,"is-selected":H,"max-selectable":V.value,onClose:X,onItemClick:G},null,8,["filter-selected","layout-mode","sort-selected","search-query","filter-options","sort-options","disabled","is-querying","items","max-selectable"])]),_:1},512)],512))}});function rt(l){return{category:c(()=>{}),assets:c(()=>[]),dropdownItems:c(()=>[]),isLoading:c(()=>!1),error:c(()=>null)}}v(rt,"useAssetWidgetData");const dt=T({__name:"WidgetSelectDropdown",props:F({widget:{},nodeType:{},assetKind:{},allowUpload:{type:Boolean},uploadFolder:{},isAssetMode:{type:Boolean},defaultLayoutMode:{}},{modelValue:{default(l){return l.widget.options?.values?.[0]||""}},modelModifiers:{}}),emits:["update:modelValue"],setup(l){const e=l;xe(pe,c(()=>e.assetKind));const i=z(l,"modelValue"),w=oe(),r=ge(),y=ce(),p=c(()=>({...ie(e.widget.options,re),...y.value})),u=v(()=>{const t=e.widget.options?.nodeType??e.nodeType;return e.isAssetMode&&t?rt(Ce(t)):null},"getAssetData")(),g=D("all"),o=c(()=>{if(e.isAssetMode){const t=u?.category.value??"All";return[{id:"all",name:Ue(t)}]}return[{id:"all",name:"All"},{id:"inputs",name:"Inputs"},{id:"outputs",name:"Outputs"}]}),n=D(new Set);function f(t){const s=e.widget.options?.getOptionLabel;if(!s)return t;try{return s(t)}catch(d){return console.error("Failed to map value:",d),t}}v(f,"getDisplayLabel");const h=c(()=>{const t=e.widget.options?.values||[];return Array.isArray(t)?t.map((s,d)=>({id:`input-${d}`,mediaSrc:S(s,"input"),name:s,label:f(s),metadata:""})):[]}),V=c(()=>{if(!["image","video"].includes(e.assetKind??""))return[];const t=new Set;return r.historyTasks.forEach(s=>{s.flatOutputs.forEach(d=>{const U=e.assetKind==="image"&&d.mediaType==="images"||e.assetKind==="video"&&d.mediaType==="video";if(d.type==="output"&&U){const W=`${d.subfolder?`${d.subfolder}/${d.filename}`:d.filename} [output]`;t.add(W)}})}),Array.from(t).map(s=>({id:`output-${s}`,mediaSrc:S(s.replace(" [output]",""),"output"),name:s,label:f(s),metadata:""}))}),R=c(()=>e.isAssetMode&&u?u.dropdownItems.value:[...h.value,...V.value]),O=c(()=>{if(e.isAssetMode)return R.value;switch(g.value){case"inputs":return h.value;case"outputs":return V.value;case"all":default:return[...h.value,...V.value]}}),Q=c(()=>{const t=e.widget.options;if(t?.placeholder)return t.placeholder;switch(e.assetKind){case"image":return L("widgets.uploadSelect.placeholderImage");case"video":return L("widgets.uploadSelect.placeholderVideo");case"audio":return L("widgets.uploadSelect.placeholderAudio");case"model":return L("widgets.uploadSelect.placeholderModel");case"unknown":return L("widgets.uploadSelect.placeholderUnknown")}return L("widgets.uploadSelect.placeholder")}),q=c(()=>e.isAssetMode?!1:e.allowUpload===!0),H=c(()=>{switch(e.assetKind){case"image":return"image/*";case"video":return"video/*";case"audio":return"audio/*";default:return}}),N=D(e.defaultLayoutMode??"grid");Y([i,O],([t,s])=>{if(t===void 0){n.value.clear();return}const d=O.value.find(U=>U.name===t);d&&(n.value.clear(),n.value.add(d.id))},{immediate:!0});function X(t){let s;if(t.size>0&&(s=t.values().next().value),s==null){i.value=void 0;return}const d=O.value.find(U=>U.id===s)?.name;if(!d){i.value=void 0;return}i.value=d}v(X,"updateSelectedItems");const Z=v(async(t,s=!1,d={})=>{const U=new FormData;U.append("image",t),s&&U.append("subfolder","pasted"),d.type&&U.append("type",d.type);const A=await ve.fetchApi("/upload/image",{method:"POST",body:U});if(A.status!==200)return w.addAlert(A.status+" - "+A.statusText),null;const W=await A.json();return(d.type==="input"||!d.type&&!s)&&await ye().updateInputs(),W.subfolder?`${W.subfolder}/${W.name}`:W.name},"uploadFile"),G=v(async t=>{const s=e.uploadFolder??"input",d=t.map(A=>Z(A,!1,{type:s}));return(await Promise.all(d)).filter(A=>A!==null)},"uploadFiles");async function k(t){if(!(!t||t.length===0))try{const s=await G(t);if(s.length===0){w.addAlert("File upload failed");return}e.widget.options?.values&&s.forEach(d=>{const U=e.widget.options.values;U.includes(d)||U.push(d)}),i.value=s[0],e.widget.callback&&e.widget.callback(s[0])}catch(s){console.error("Upload error:",s),w.addAlert(`Upload failed: ${s}`)}}v(k,"handleFilesUpdate");function S(t,s="input"){return["image","video"].includes(e.assetKind??"")?`/api/view?filename=${encodeURIComponent(t)}&type=${s}`:""}return v(S,"getMediaUrl"),(t,s)=>(m(),I(ue,{widget:t.widget},{default:E(()=>[B(it,ae({selected:n.value,"onUpdate:selected":s[0]||(s[0]=d=>n.value=d),"filter-selected":g.value,"onUpdate:filterSelected":s[1]||(s[1]=d=>g.value=d),"layout-mode":N.value,"onUpdate:layoutMode":s[2]||(s[2]=d=>N.value=d),items:O.value,placeholder:Q.value,multiple:!1,uploadable:q.value,accept:H.value,"filter-options":o.value},p.value,{class:"w-full","onUpdate:selected":X,"onUpdate:files":k}),null,16,["selected","filter-selected","layout-mode","items","placeholder","uploadable","accept","filter-options"])]),_:1},8,["widget"]))}}),St=T({__name:"WidgetSelect",props:F({widget:{},nodeType:{}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(l){const e=l,i=z(l,"modelValue"),w=c(()=>{if(e.widget.spec&&be(e.widget.spec))return e.widget.spec}),r=c(()=>{const n=w.value;if(!n)return{kind:"unknown",allowUpload:!1,folder:void 0};const{image_upload:f,animated_image_upload:h,video_upload:V,image_folder:R,audio_upload:O}=n;let Q="unknown";return V?Q="video":f||h?Q="image":O&&(Q="audio"),{kind:Q,allowUpload:f===!0||h===!0||V===!0||O===!0,folder:R}}),y=c(()=>!1),p=c(()=>r.value.kind),a=c(()=>y.value||p.value!=="unknown"),u=c(()=>r.value.allowUpload),g=c(()=>r.value.folder??"input"),o=c(()=>y.value?"list":"grid");return(n,f)=>a.value?(m(),I(dt,{key:0,modelValue:i.value,"onUpdate:modelValue":f[0]||(f[0]=h=>i.value=h),widget:n.widget,"node-type":n.widget.nodeType??n.nodeType,"asset-kind":p.value,"allow-upload":u.value,"upload-folder":g.value,"is-asset-mode":y.value,"default-layout-mode":o.value},null,8,["modelValue","widget","node-type","asset-kind","allow-upload","upload-folder","is-asset-mode","default-layout-mode"])):n.widget.controlWidget?(m(),I(Ae,{key:1,modelValue:i.value,"onUpdate:modelValue":f[1]||(f[1]=h=>i.value=h),component:te,widget:n.widget},null,8,["modelValue","widget"])):(m(),I(te,{key:2,modelValue:i.value,"onUpdate:modelValue":f[2]||(f[2]=h=>i.value=h),widget:n.widget},null,8,["modelValue","widget"]))}});export{St as _};
//# sourceMappingURL=WidgetSelect.vue_vue_type_script_setup_true_lang-DaD55UQd.js.map
