var K=Object.defineProperty;var t=(k,r)=>K(k,"name",{value:r,configurable:!0});import{a7 as Q,j as X}from"./vendor-primevue-6nO4LMK3.js";import{u as Y}from"./vendor-vue-Cz2Pyvdp.js";import{r as L,az as ee,b_ as ae,bZ as te,a as oe,c as C,d as se}from"./index-Btwre5kD.js";import{g as le,f as N}from"./audioUtils-DI1f8_g7.js";import{bx as ne,r as i,E as u,w as ue,cd as ie,c as l,d as n,q as z,s as re,by as p,e as o,z as T,u as _,G as ce,k as de,n as ve}from"./vendor-other-PcOcwbNM.js";import"./vendor-xterm-CWYFmgbN.js";import"./vendor-three-Bbe9LX3q.js";import"./vendor-tiptap-BsEBJZ_K.js";const pe={class:"relative"},me={class:"relative flex shrink-0 items-center justify-start gap-2"},fe=["aria-label"],be={key:0,class:"text-secondary icon-[lucide--play] size-4"},ge={key:1,class:"text-secondary icon-[lucide--pause] size-4"},he={class:"text-sm font-normal text-nowrap text-base-foreground"},ye={class:"relative h-0.5 flex-1 rounded-full bg-interface-stroke"},_e=["value","aria-label"],ke={class:"relative flex shrink-0 items-center justify-start gap-2"},xe=["aria-label"],we={key:0,class:"text-secondary icon-[lucide--volume-2] size-4"},Ce={key:1,class:"text-secondary icon-[lucide--volume-1] size-4"},ze={key:2,class:"text-secondary icon-[lucide--volume-x] size-4"},Oe=["aria-label"],Ie={key:0,class:"w-48 px-4 py-2"},Pe={class:"mb-2 block text-xs text-base-foreground"},Ae=["onClick"],Le={class:"text-base-foreground"},Ne={key:0,class:"ml-auto icon-[lucide--check] size-4 text-base-foreground"},Te=ne({__name:"AudioPreviewPlayer",props:{hideWhenEmpty:{type:Boolean,default:!0},showOptionsButton:{type:Boolean},nodeId:{},audioUrl:{}},setup(k){const{t:r}=Y(),g=k,a=i(),O=i(),m=i(!1),c=i(!1),f=i(1),b=i(0),d=i(0),I=i(!1),h=i(1),P=u(()=>!d.value||d.value===0?0:b.value/d.value*100),U=u(()=>!c.value&&f.value>.5),B=u(()=>c.value&&f.value>0),y=u(()=>!g.nodeId||!L.canvas.graph?null:L.canvas.graph.getNodeById(g.nodeId)),R=u(()=>y.value?y.value.constructor?.comfyClass==="LoadAudio"&&!!g.nodeId:!1),S=u(()=>{const e=y.value;return!!e&&ee(e)}),A=u(()=>{const e=y.value;return e?ae(e):null}),V=te(),j=u(()=>{if(!S.value||!A.value)return"";const e=V.nodeOutputs[A.value];if(!e?.audio||e.audio.length===0)return"";const s=e.audio[0];return s.filename?oe.apiURL(le(s.subfolder||"",s.filename,s.type||"output")):""}),$=u(()=>j.value||g.audioUrl||""),E=t(()=>{!a.value||!a.value.src||(m.value?a.value.pause():a.value.play(),m.value=!m.value)},"togglePlayPause"),M=t(()=>{a.value&&(c.value=!c.value,a.value.muted=c.value)},"toggleMute"),F=t(e=>{const s=e.target,v=parseFloat(s.value);if(a.value&&d.value>0){const w=v/100*d.value;a.value.currentTime=w,b.value=w}},"handleSeek"),D=t(()=>{a.value&&(d.value=a.value.duration)},"handleLoadedMetadata"),W=t(()=>{a.value&&(b.value=a.value.currentTime)},"handleTimeUpdate"),q=t(()=>{m.value=!1,b.value=0},"handleEnded"),G=t(e=>{O.value?.toggle(e)},"toggleOptionsMenu"),x=t(e=>{h.value=e,a.value&&(a.value.playbackRate=e)},"setPlaybackSpeed"),Z=t(e=>{const s=Array.isArray(e)?e[0]:e;f.value=s/10,a.value&&(a.value.volume=f.value,f.value>0&&c.value&&(c.value=!1,a.value.muted=!1))},"handleVolumeChange"),H=u(()=>[{label:r("g.playbackSpeed"),items:[{label:r("g.halfSpeed"),onClick:t(()=>x(.5),"onClick"),selected:h.value===.5},{label:r("g.1x"),onClick:t(()=>x(1),"onClick"),selected:h.value===1},{label:r("g.2x"),onClick:t(()=>x(2),"onClick"),selected:h.value===2}]},{label:r("g.volume"),key:"volume"}]),J=t(e=>{a.value&&(m.value=!1,a.value.pause(),a.value.src=e,a.value.load(),I.value=!!e)},"loadAudioFromUrl");return ue($,e=>{e&&ve(()=>{J(e)})},{immediate:!0}),ie(()=>{a.value&&(a.value.pause(),a.value.src="")}),(e,s)=>(n(),l("div",pe,[R.value?z("",!0):(n(),l("div",{key:0,class:re(p(C)("bg-component-node-widget-background box-border flex gap-4 items-center justify-start relative rounded-lg w-full h-16 px-4 py-0",{hidden:e.hideWhenEmpty&&!I.value}))},[o("audio",{ref_key:"audioRef",ref:a,onLoadedmetadata:D,onTimeupdate:W,onEnded:q},null,544),o("div",me,[o("div",{role:"button",tabindex:0,"aria-label":e.$t("g.playPause"),class:"flex size-6 cursor-pointer items-center justify-center rounded hover:bg-interface-menu-component-surface-hovered",onClick:E},[m.value?(n(),l("i",ge)):(n(),l("i",be))],8,fe),o("div",he,_(p(N)(b.value))+" / "+_(p(N)(d.value)),1)]),o("div",ye,[o("div",{class:"absolute top-0 left-0 h-full rounded-full bg-button-icon transition-all",style:ce({width:`${P.value}%`})},null,4),o("input",{type:"range",value:P.value,min:"0",max:"100",step:"0.1","aria-label":e.$t("g.audioProgress"),class:"absolute inset-0 w-full cursor-pointer opacity-0",onInput:F},null,40,_e)]),o("div",ke,[o("div",{role:"button",tabindex:0,"aria-label":e.$t("g.volume"),class:"flex size-6 cursor-pointer items-center justify-center rounded hover:bg-interface-menu-component-surface-hovered",onClick:M},[U.value?(n(),l("i",we)):B.value?(n(),l("i",Ce)):(n(),l("i",ze))],8,xe),e.showOptionsButton?(n(),l("div",{key:0,role:"button",tabindex:0,"aria-label":e.$t("g.moreOptions"),class:"flex size-6 cursor-pointer items-center justify-center rounded hover:bg-interface-menu-component-surface-hovered",onClick:G},s[0]||(s[0]=[o("i",{class:"text-secondary icon-[lucide--more-vertical] size-4"},null,-1)]),8,Oe)):z("",!0)]),T(p(Q),{ref_key:"optionsMenu",ref:O,model:H.value,popup:"",class:"audio-player-menu","pt:root:class":p(C)("bg-component-node-widget-background border-component-node-border"),"pt:submenu:class":p(C)("bg-component-node-widget-background")},{item:de(({item:v})=>[v.key==="volume"?(n(),l("div",Ie,[o("label",Pe,_(v.label),1),T(p(X),{"model-value":f.value*10,min:0,max:10,step:1,class:"w-full","onUpdate:modelValue":Z},null,8,["model-value"])])):(n(),l("div",{key:1,class:"flex cursor-pointer items-center px-4 py-2 text-xs hover:bg-white/10",onClick:t(w=>v.onClick?.(),"onClick")},[o("span",Le,_(v.label),1),v.selected?(n(),l("i",Ne)):z("",!0)],8,Ae))]),_:1},8,["model","pt:root:class","pt:submenu:class"])],2))]))}}),Fe=se(Te,[["__scopeId","data-v-b2e1591f"]]);export{Fe as default};
//# sourceMappingURL=AudioPreviewPlayer-CapIsauG.js.map
