import{b as g,t as e,R as N,x as He,A as Be,B as Y}from"./index-C6J4Pqq0.js";import{c as re,t as je,r as oe,P as O,w as ge,x as qe,v as ve,G as Ke,q as $,u as P,B as Ue,a as ze,b as F,j as X,k as Z,d as Ge,L as I,H as We,e as he,I as be,J as Je,K as ye,M as Qe}from"./api-Di6evdbS.js";import{t as V,u as Ye}from"./index-DDT61vXN.js";import{e as Ne,n as Xe,E as B,a as q,b as K,c as U,d as z,u as Ze}from"./empty-DVWE5J5D.js";import{m as et,T as ae,a as le,b as M,c as R,F as tt,D as st,d as nt,e as rt,f as ot,g as at,h as lt,L as it,S as ct,i as dt,j as ut,k as mt,l as ee}from"./tabs-BIl2Mbyw.js";import{u as xt,C as A,B as pe}from"./code-block-CLtCnWW-.js";import"./mutation-CzWEsub0.js";const ht=[["circle",{cx:"6",cy:"19",r:"3",key:"1kj8tv"}],["path",{d:"M9 19h8.5a3.5 3.5 0 0 0 0-7h-11a3.5 3.5 0 0 1 0-7H15",key:"1d8sl"}],["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}]],pt=re("route",ht);const ft=[["path",{d:"M15 12h-5",key:"r7krc0"}],["path",{d:"M15 8h-5",key:"1khuty"}],["path",{d:"M19 17V5a2 2 0 0 0-2-2H4",key:"zz82l3"}],["path",{d:"M8 21h12a2 2 0 0 0 2-2v-1a1 1 0 0 0-1-1H11a1 1 0 0 0-1 1v1a2 2 0 1 1-4 0V5a2 2 0 1 0-4 0v2a1 1 0 0 0 1 1h3",key:"1ph1d7"}]],jt=re("scroll-text",ft);const gt=[["path",{d:"M12 19h8",key:"baeox8"}],["path",{d:"m4 17 6-6-6-6",key:"1yngyt"}]],vt=re("terminal",gt);var G="Collapsible",[bt,Ce]=je(G),[yt,ie]=bt(G),_e=g.forwardRef((t,n)=>{const{__scopeCollapsible:s,open:o,defaultOpen:a,disabled:r,onOpenChange:l,...u}=t,[x,i]=oe({prop:o,defaultProp:a??!1,onChange:l,caller:G});return e.jsx(yt,{scope:s,disabled:r,contentId:Ne(),open:x,onOpenToggle:g.useCallback(()=>i(h=>!h),[i]),children:e.jsx(O.div,{"data-state":de(x),"data-disabled":r?"":void 0,...u,ref:n})})});_e.displayName=G;var we="CollapsibleTrigger",ke=g.forwardRef((t,n)=>{const{__scopeCollapsible:s,...o}=t,a=ie(we,s);return e.jsx(O.button,{type:"button","aria-controls":a.contentId,"aria-expanded":a.open||!1,"data-state":de(a.open),"data-disabled":a.disabled?"":void 0,disabled:a.disabled,...o,ref:n,onClick:ge(t.onClick,a.onOpenToggle)})});ke.displayName=we;var ce="CollapsibleContent",Te=g.forwardRef((t,n)=>{const{forceMount:s,...o}=t,a=ie(ce,t.__scopeCollapsible);return e.jsx(qe,{present:s||a.open,children:({present:r})=>e.jsx(Nt,{...o,ref:n,present:r})})});Te.displayName=ce;var Nt=g.forwardRef((t,n)=>{const{__scopeCollapsible:s,present:o,children:a,...r}=t,l=ie(ce,s),[u,x]=g.useState(o),i=g.useRef(null),h=ve(n,i),j=g.useRef(0),p=j.current,f=g.useRef(0),v=f.current,b=l.open||u,m=g.useRef(b),c=g.useRef(void 0);return g.useEffect(()=>{const d=requestAnimationFrame(()=>m.current=!1);return()=>cancelAnimationFrame(d)},[]),Ke(()=>{const d=i.current;if(d){c.current=c.current||{transitionDuration:d.style.transitionDuration,animationName:d.style.animationName},d.style.transitionDuration="0s",d.style.animationName="none";const y=d.getBoundingClientRect();j.current=y.height,f.current=y.width,m.current||(d.style.transitionDuration=c.current.transitionDuration,d.style.animationName=c.current.animationName),x(o)}},[l.open,o]),e.jsx(O.div,{"data-state":de(l.open),"data-disabled":l.disabled?"":void 0,id:l.contentId,hidden:!b,...r,ref:h,style:{"--radix-collapsible-content-height":p?`${p}px`:void 0,"--radix-collapsible-content-width":v?`${v}px`:void 0,...t.style},children:b&&a})});function de(t){return t?"open":"closed"}var Ct=_e,_t=ke,wt=Te,w="Accordion",kt=["Home","End","ArrowDown","ArrowUp","ArrowLeft","ArrowRight"],[ue,Tt,St]=et(w),[W]=je(w,[St,Ce]),me=Ce(),Se=N.forwardRef((t,n)=>{const{type:s,...o}=t,a=o,r=o;return e.jsx(ue.Provider,{scope:t.__scopeAccordion,children:s==="multiple"?e.jsx(Rt,{...r,ref:n}):e.jsx(Mt,{...a,ref:n})})});Se.displayName=w;var[Ae,At]=W(w),[Ie,It]=W(w,{collapsible:!1}),Mt=N.forwardRef((t,n)=>{const{value:s,defaultValue:o,onValueChange:a=()=>{},collapsible:r=!1,...l}=t,[u,x]=oe({prop:s,defaultProp:o??"",onChange:a,caller:w});return e.jsx(Ae,{scope:t.__scopeAccordion,value:N.useMemo(()=>u?[u]:[],[u]),onItemOpen:x,onItemClose:N.useCallback(()=>r&&x(""),[r,x]),children:e.jsx(Ie,{scope:t.__scopeAccordion,collapsible:r,children:e.jsx(Me,{...l,ref:n})})})}),Rt=N.forwardRef((t,n)=>{const{value:s,defaultValue:o,onValueChange:a=()=>{},...r}=t,[l,u]=oe({prop:s,defaultProp:o??[],onChange:a,caller:w}),x=N.useCallback(h=>u((j=[])=>[...j,h]),[u]),i=N.useCallback(h=>u((j=[])=>j.filter(p=>p!==h)),[u]);return e.jsx(Ae,{scope:t.__scopeAccordion,value:l,onItemOpen:x,onItemClose:i,children:e.jsx(Ie,{scope:t.__scopeAccordion,collapsible:!0,children:e.jsx(Me,{...r,ref:n})})})}),[$t,J]=W(w),Me=N.forwardRef((t,n)=>{const{__scopeAccordion:s,disabled:o,dir:a,orientation:r="vertical",...l}=t,u=N.useRef(null),x=ve(u,n),i=Tt(s),j=xt(a)==="ltr",p=ge(t.onKeyDown,f=>{if(!kt.includes(f.key))return;const v=f.target,b=i().filter(Q=>!Q.ref.current?.disabled),m=b.findIndex(Q=>Q.ref.current===v),c=b.length;if(m===-1)return;f.preventDefault();let d=m;const y=0,k=c-1,D=()=>{d=m+1,d>k&&(d=y)},E=()=>{d=m-1,d<y&&(d=k)};switch(f.key){case"Home":d=y;break;case"End":d=k;break;case"ArrowRight":r==="horizontal"&&(j?D():E());break;case"ArrowDown":r==="vertical"&&D();break;case"ArrowLeft":r==="horizontal"&&(j?E():D());break;case"ArrowUp":r==="vertical"&&E();break}const Ve=d%c;b[Ve].ref.current?.focus()});return e.jsx($t,{scope:s,disabled:o,direction:a,orientation:r,children:e.jsx(ue.Slot,{scope:s,children:e.jsx(O.div,{...l,"data-orientation":r,ref:x,onKeyDown:o?void 0:p})})})}),H="AccordionItem",[Pt,xe]=W(H),Re=N.forwardRef((t,n)=>{const{__scopeAccordion:s,value:o,...a}=t,r=J(H,s),l=At(H,s),u=me(s),x=Ne(),i=o&&l.value.includes(o)||!1,h=r.disabled||t.disabled;return e.jsx(Pt,{scope:s,open:i,disabled:h,triggerId:x,children:e.jsx(Ct,{"data-orientation":r.orientation,"data-state":Oe(i),...u,...a,ref:n,disabled:h,open:i,onOpenChange:j=>{j?l.onItemOpen(o):l.onItemClose(o)}})})});Re.displayName=H;var $e="AccordionHeader",Pe=N.forwardRef((t,n)=>{const{__scopeAccordion:s,...o}=t,a=J(w,s),r=xe($e,s);return e.jsx(O.h3,{"data-orientation":a.orientation,"data-state":Oe(r.open),"data-disabled":r.disabled?"":void 0,...o,ref:n})});Pe.displayName=$e;var se="AccordionTrigger",De=N.forwardRef((t,n)=>{const{__scopeAccordion:s,...o}=t,a=J(w,s),r=xe(se,s),l=It(se,s),u=me(s);return e.jsx(ue.ItemSlot,{scope:s,children:e.jsx(_t,{"aria-disabled":r.open&&!l.collapsible||void 0,"data-orientation":a.orientation,id:r.triggerId,...u,...o,ref:n})})});De.displayName=se;var Ee="AccordionContent",Le=N.forwardRef((t,n)=>{const{__scopeAccordion:s,...o}=t,a=J(w,s),r=xe(Ee,s),l=me(s);return e.jsx(wt,{role:"region","aria-labelledby":r.triggerId,"data-orientation":a.orientation,...l,...o,ref:n,style:{"--radix-accordion-content-height":"var(--radix-collapsible-content-height)","--radix-accordion-content-width":"var(--radix-collapsible-content-width)",...t.style}})});Le.displayName=Ee;function Oe(t){return t?"open":"closed"}var Dt=Se,Et=Re,Lt=Pe,Ot=De,Ft=Le;function Vt({...t}){return e.jsx(Dt,{"data-slot":"accordion",...t})}function Ht({className:t,...n}){return e.jsx(Et,{"data-slot":"accordion-item",className:$("border-b last:border-b-0",t),...n})}function Bt({className:t,children:n,...s}){return e.jsx(Lt,{className:"flex min-w-0",children:e.jsxs(Ot,{"data-slot":"accordion-trigger",className:$("group focus-visible:border-ring focus-visible:ring-ring/50 flex flex-1 min-w-0 items-start justify-between gap-4 rounded-md py-4 text-left text-sm transition-all outline-none focus-visible:ring-[3px] disabled:pointer-events-none disabled:opacity-50 [&[data-state=open]>svg]:rotate-180",t),...s,children:[n,e.jsx(Xe,{className:"text-muted-foreground pointer-events-none size-4 shrink-0 translate-y-0.5 transition-transform duration-200"})]})})}function qt({className:t,children:n,...s}){return e.jsx(Ft,{"data-slot":"accordion-content",className:"data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down overflow-hidden text-sm",...s,children:e.jsx("div",{className:$("pt-0 pb-4",t),children:n})})}function C({className:t,...n}){return e.jsx("div",{"data-slot":"card",className:$("bg-card text-card-foreground flex flex-col gap-6 border py-6",t),...n})}function T({className:t,...n}){return e.jsx("div",{"data-slot":"card-header",className:$("flex flex-col gap-1.5 px-6",t),...n})}function S({className:t,...n}){return e.jsx("div",{"data-slot":"card-title",className:$("leading-none font-semibold",t),...n})}function _({className:t,...n}){return e.jsx("div",{"data-slot":"card-content",className:$("px-6",t),...n})}function Kt(t){return t?new Date(t).toLocaleString():"-"}function Fe(t,n){if(!t)return"-";const s=new Date(t).getTime(),a=(n?new Date(n).getTime():Date.now())-s,r=Math.floor(a/1e3),l=Math.floor(r/60),u=Math.floor(l/60);return u>0?`${u}h ${l%60}m ${r%60}s`:l>0?`${l}m ${r%60}s`:`${r}s`}function Ut(t){if(!t?.started_at)return 0;const n=new Date(t.started_at).getTime();return(t.finished_at?new Date(t.finished_at).getTime():Date.now())-n}function zt({segments:t,totalLabel:n}){const[s,o]=g.useState(null),[a,r]=g.useState(0),l=t.reduce((m,c)=>m+c.value,0);if(l===0)return e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"h-8 bg-muted"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"No token data"})]});const u=1,x=t.map(m=>m.value>0?m.value/l*100:0),i=x.map(m=>m>0&&m<u),h=i.reduce((m,c,d)=>c?m+(u-x[d]):m,0),j=x.reduce((m,c,d)=>!i[d]&&c>0?m+c:m,0),p=j>0?(j-h)/j:1,f=x.map((m,c)=>m===0?0:i[c]?u:m*p),v=[];let b=0;for(let m=0;m<f.length;m++)v.push(b),b+=f[m];return e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"relative",children:[s!==null&&e.jsx("div",{className:"absolute bottom-full mb-2 z-10 -translate-x-1/2 pointer-events-none",style:{left:`${a}%`},children:e.jsxs("div",{className:"bg-popover border border-border rounded-md shadow-md px-3 py-2 whitespace-nowrap",children:[e.jsx("div",{className:"text-sm font-medium",children:t[s].label}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[t[s].value.toLocaleString()," tokens"]})]})}),e.jsx("div",{className:"flex h-8 overflow-hidden",children:t.map((m,c)=>{if(m.value===0)return null;const d=f[c],y=s!==null&&s!==c,k=v[c]+d/2;return e.jsx("div",{className:"transition-opacity duration-150",style:{width:`${d}%`,backgroundColor:m.color,opacity:y?.3:1},onMouseEnter:()=>{o(c),r(k)},onMouseLeave:()=>o(null)},m.label)})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex gap-4",children:t.map((m,c)=>{if(m.value===0)return null;const d=i[c];return e.jsxs("div",{className:"flex items-center gap-1.5 text-xs",children:[e.jsx("div",{className:"w-2.5 h-2.5 rounded-sm",style:{backgroundColor:m.color}}),e.jsxs("span",{className:"text-muted-foreground",children:[m.label,d&&" (scaled)"]})]},m.label)})}),e.jsx("div",{className:"text-xs text-muted-foreground",children:n})]})]})}function Gt({phases:t,totalDuration:n}){const[s,o]=g.useState(null),[a,r]=g.useState(0),l=t.map(c=>Ut(c.timing)),u=l.reduce((c,d)=>c+d,0);if(u===0)return e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"h-8 bg-muted rounded"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"No timing data"})]});const x=1,i=l.map(c=>c>0?c/u*100:0),h=i.map(c=>c>0&&c<x),j=h.reduce((c,d,y)=>d?c+(x-i[y]):c,0),p=i.reduce((c,d,y)=>!h[y]&&d>0?c+d:c,0),f=p>0?(p-j)/p:1,v=i.map((c,d)=>c===0?0:h[d]?x:c*f),b=[];let m=0;for(let c=0;c<v.length;c++)b.push(m),m+=v[c];return e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"relative",children:[s!==null&&e.jsx("div",{className:"absolute bottom-full mb-2 z-10 -translate-x-1/2 pointer-events-none",style:{left:`${a}%`},children:e.jsxs("div",{className:"bg-popover border border-border rounded-md shadow-md px-3 py-2 whitespace-nowrap",children:[e.jsx("div",{className:"text-sm font-medium",children:t[s].label}),e.jsx("div",{className:"text-sm text-muted-foreground",children:Fe(t[s].timing?.started_at??null,t[s].timing?.finished_at??null)})]})}),e.jsx("div",{className:"flex h-8 overflow-hidden",children:t.map((c,d)=>{if(l[d]===0)return null;const k=v[d],D=s!==null&&s!==d,E=b[d]+k/2;return e.jsx("div",{className:"transition-opacity duration-150",style:{width:`${k}%`,backgroundColor:c.color,opacity:D?.3:1},onMouseEnter:()=>{o(d),r(E)},onMouseLeave:()=>o(null)},c.label)})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex gap-4",children:t.map((c,d)=>{if(l[d]===0)return null;const k=h[d];return e.jsxs("div",{className:"flex items-center gap-1.5 text-xs",children:[e.jsx("div",{className:"w-2.5 h-2.5 rounded-sm",style:{backgroundColor:c.color}}),e.jsxs("span",{className:"text-muted-foreground",children:[c.label,k&&" (scaled)"]})]},c.label)})}),e.jsx("div",{className:"text-xs text-muted-foreground",children:n})]})]})}function te({label:t,value:n,className:s,showBorder:o=!0}){return e.jsxs("div",{className:`flex justify-between py-1 text-sm ${o?"border-b border-border last:border-0":""}`,children:[e.jsx("span",{className:"text-muted-foreground",children:t}),e.jsx("span",{className:s,children:n})]})}function fe(t,n){if(!t||!n)return null;const s=new Date(t).getTime(),a=new Date(n).getTime()-s;return a<0?null:ne(a)}function ne(t){const n=t/1e3;if(n<60)return`${n.toFixed(1)}s`;const s=Math.floor(n/60),o=n%60;return`${s}m ${o.toFixed(0)}s`}function Wt({step:t}){const s={agent:"text-purple-600 dark:text-purple-300"}.agent;return e.jsxs("div",{className:"space-y-3",children:[t.message&&e.jsx("div",{className:"text-sm whitespace-pre-wrap wrap-break-words",children:t.message}),t.reasoning_content&&e.jsxs("div",{children:[e.jsx("h5",{className:"text-xs font-medium text-muted-foreground mb-1",children:"Reasoning"}),e.jsx("pre",{className:"text-xs bg-muted p-2 overflow-x-auto whitespace-pre-wrap",children:t.reasoning_content})]}),t.tool_calls&&t.tool_calls.length>0&&e.jsxs("div",{children:[e.jsx("h5",{className:"text-xs font-medium text-muted-foreground mb-1",children:"Tool Calls"}),t.tool_calls.map(o=>e.jsxs("div",{className:"mb-2",children:[e.jsx("div",{className:`text-xs font-mono mb-1 ${s}`,children:o.function_name}),e.jsx(A,{code:JSON.stringify(o.arguments,null,2),lang:"json"})]},o.tool_call_id))]}),t.observation&&t.observation.results.length>0&&e.jsxs("div",{children:[e.jsx("h5",{className:"text-xs font-medium text-muted-foreground mb-1",children:"Observations"}),t.observation.results.map((o,a)=>e.jsx("div",{className:"mb-2",children:e.jsx(A,{code:o.content||"(empty)",lang:"text"})},a))]}),t.metrics&&e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Tokens: ",(t.metrics.prompt_tokens??0).toLocaleString()," prompt /"," ",(t.metrics.completion_tokens??0).toLocaleString()," completion",t.metrics.cost_usd&&` / $${t.metrics.cost_usd.toFixed(4)}`]})]})}function Jt({step:t,nextTimestamp:n,startTimestamp:s}){const o={system:"text-gray-600 dark:text-gray-300",user:"text-blue-600 dark:text-blue-300",agent:"text-purple-600 dark:text-purple-300"},a=fe(t.timestamp,n),r=fe(s,t.timestamp),l=t.message?.split(`
`)[0]||null;return e.jsxs("div",{className:"flex-1 min-w-0 flex items-center gap-4 overflow-hidden",children:[e.jsxs("div",{className:"flex-1 min-w-0 flex items-center gap-2 overflow-hidden",children:[e.jsxs("span",{className:"text-xs text-muted-foreground shrink-0",children:["#",t.step_id]}),e.jsx("span",{className:`text-xs font-medium shrink-0 ${o[t.source]}`,children:t.source}),t.model_name&&e.jsx("span",{className:"text-xs text-muted-foreground shrink-0",children:t.model_name}),e.jsx("span",{className:"text-xs truncate min-w-0 transition-colors group-data-[state=open]:text-border",children:l||e.jsx("span",{className:"text-muted-foreground italic",children:"No message"})})]}),(r||a)&&e.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground shrink-0",children:[a&&e.jsxs(pe,{variant:"secondary",className:"text-xs font-normal",children:["+",a]}),r&&e.jsx(pe,{variant:"outline",className:"text-xs font-normal",children:r})]})]})}function Qt(t){const n=["var(--color-neutral-400)","var(--color-neutral-500)","var(--color-neutral-600)","var(--color-neutral-700)"],s=t%6,o=s<=3?s:6-s;return n[o]}function Yt({steps:t,onStepClick:n}){const[s,o]=g.useState(null),[a,r]=g.useState(0);if(t.length===0)return null;const l=t[0].timestamp?new Date(t[0].timestamp).getTime():0,u=t.map((p,f)=>{const v=p.timestamp?new Date(p.timestamp).getTime():0,b=f<t.length-1?t[f+1]:null,m=b?.timestamp?new Date(b.timestamp).getTime():v;return{stepId:p.step_id,durationMs:Math.max(0,m-v),elapsedMs:v-l}}),x=u.reduce((p,f)=>p+f.durationMs,0);if(x===0)return e.jsx("div",{className:"mb-4",children:e.jsx("div",{className:"h-6 bg-muted"})});const i=u.map(p=>p.durationMs/x*100),h=[];let j=0;for(const p of i)h.push(j),j+=p;return e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"relative",children:[s!==null&&e.jsx("div",{className:"absolute bottom-full mb-2 z-10 -translate-x-1/2 pointer-events-none",style:{left:`${a}%`},children:e.jsxs("div",{className:"bg-popover border border-border rounded-md shadow-md px-3 py-2 whitespace-nowrap",children:[e.jsxs("div",{className:"text-sm font-medium",children:["Step #",u[s].stepId]}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Duration: ",ne(u[s].durationMs)]}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Started at: ",ne(u[s].elapsedMs)]})]})}),e.jsx("div",{className:"flex h-6 overflow-hidden",children:u.map((p,f)=>{if(p.durationMs===0)return null;const v=i[f],b=s!==null&&s!==f,m=h[f]+v/2;return e.jsx("div",{className:"transition-opacity duration-150 cursor-pointer",style:{width:`${v}%`,backgroundColor:Qt(f),opacity:b?.3:1},onMouseEnter:()=>{o(f),r(m)},onMouseLeave:()=>o(null),onClick:()=>n(f)},p.stepId)})})]})})}function Xt({jobName:t,trialName:n}){const{data:s,isLoading:o}=P({queryKey:["trajectory",t,n],queryFn:()=>be(t,n)}),[a,r]=g.useState([]),l=g.useRef([]);if(o)return e.jsxs(C,{children:[e.jsx(T,{children:e.jsx(S,{children:"Trajectory"})}),e.jsx(_,{children:e.jsx("div",{className:"text-sm text-muted-foreground",children:e.jsx(I,{})})})]});if(!s)return e.jsx(B,{className:"bg-card border",children:e.jsxs(q,{children:[e.jsx(K,{variant:"icon",children:e.jsx(pt,{})}),e.jsx(U,{children:"No trajectory"}),e.jsxs(z,{children:["No ATIF trajectory found at ",n,"/agent/trajectory.json"]})]})});const u=x=>{const i=`step-${x}`;r(h=>h.includes(i)?h:[...h,i]),l.current[x]?.scrollIntoView({behavior:"smooth",block:"start"})};return e.jsxs(C,{children:[e.jsxs(T,{children:[e.jsx(S,{children:"Trajectory"}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[s.steps.length," steps",s.final_metrics?.total_cost_usd&&e.jsxs(e.Fragment,{children:[" / $",s.final_metrics.total_cost_usd.toFixed(4)," total"]})]})]}),e.jsxs(_,{children:[e.jsx(Yt,{steps:s.steps,onStepClick:u}),e.jsx(Vt,{type:"multiple",value:a,onValueChange:r,children:s.steps.map((x,i)=>e.jsxs(Ht,{value:`step-${i}`,ref:h=>{l.current[i]=h},children:[e.jsx(Bt,{children:e.jsx(Jt,{step:x,nextTimestamp:i<s.steps.length-1?s.steps[i+1].timestamp:null,startTimestamp:s.steps[0]?.timestamp??null})}),e.jsx(qt,{children:e.jsx(Wt,{step:x})})]},x.step_id))})]})]})}function Zt({jobName:t,trialName:n}){const{data:s,isLoading:o}=P({queryKey:["verifier-output",t,n],queryFn:()=>Je(t,n)});if(o)return e.jsxs(C,{children:[e.jsx(T,{children:e.jsx(S,{children:"Verifier Output"})}),e.jsx(_,{children:e.jsx("div",{className:"text-sm text-muted-foreground",children:e.jsx(I,{})})})]});const a=!!s?.stdout,r=!!s?.ctrf;return!a&&!r?e.jsx(B,{className:"bg-card border",children:e.jsxs(q,{children:[e.jsx(K,{variant:"icon",children:e.jsx(jt,{})}),e.jsx(U,{children:"No verifier logs"}),e.jsx(z,{children:"No test output or CTRF results found"})]})}):a&&r?e.jsx(C,{className:"py-0 gap-0",children:e.jsx(_,{className:"p-0",children:e.jsxs(ae,{defaultValue:"stdout",children:[e.jsxs(le,{children:[e.jsx(M,{value:"stdout",children:"Output"}),e.jsx(M,{value:"ctrf",children:"CTRF"})]}),e.jsx(R,{value:"stdout",className:"mt-0 -mx-px",children:e.jsx(A,{code:s.stdout,lang:"text"})}),e.jsx(R,{value:"ctrf",className:"mt-0 -mx-px",children:e.jsx(A,{code:s.ctrf,lang:"json"})})]})})}):a?e.jsx(A,{code:s.stdout,lang:"text"}):e.jsx(A,{code:s.ctrf,lang:"json"})}function es({jobName:t,trialName:n}){const s=Ye(),[o,a]=g.useState(!1),[r,l]=g.useState("haiku"),u=Ze({mutationFn:()=>We(t,n,r),onSuccess:()=>{s.invalidateQueries({queryKey:["agent-logs",t,n]}),a(!1),V.success("Summary generated")},onError:x=>{V.error("Failed to generate summary",{description:x.message})}});return e.jsxs(st,{open:o,onOpenChange:a,children:[e.jsx(nt,{asChild:!0,children:e.jsx(he,{children:"Generate Summary"})}),e.jsxs(rt,{children:[e.jsxs(ot,{children:[e.jsx(at,{children:"Generate Summary"}),e.jsx(lt,{children:"Use Claude to analyze this trial and generate a summary."})]}),e.jsxs("div",{className:"space-y-4 pt-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(it,{htmlFor:"model",children:"Model"}),e.jsxs(ct,{value:r,onValueChange:l,children:[e.jsx(dt,{id:"model",children:e.jsx(ut,{})}),e.jsxs(mt,{children:[e.jsx(ee,{value:"haiku",children:"Haiku (Recommended)"}),e.jsx(ee,{value:"sonnet",children:"Sonnet"}),e.jsx(ee,{value:"opus",children:"Opus"})]})]})]}),e.jsx(he,{className:"w-full",onClick:()=>u.mutate(),disabled:u.isPending,children:u.isPending?e.jsx(I,{text:"Generating"}):"Generate"})]})]})]})}function ts({jobName:t,trialName:n}){const{data:s,isLoading:o}=P({queryKey:["agent-logs",t,n],queryFn:()=>ye(t,n)});return o?e.jsx("div",{className:"text-sm text-muted-foreground p-4",children:e.jsx(I,{})}):s?.summary?e.jsx(A,{code:s.summary,lang:"markdown",wrap:!0}):e.jsxs(B,{className:"bg-card border",children:[e.jsxs(q,{children:[e.jsx(K,{variant:"icon",children:e.jsx(tt,{})}),e.jsx(U,{children:"No summary"}),e.jsx(z,{children:"Generate a summary of this trial using Claude."})]}),e.jsx(es,{jobName:t,trialName:n})]})}function ss({jobName:t,trialName:n}){const{data:s,isLoading:o}=P({queryKey:["agent-logs",t,n],queryFn:()=>ye(t,n)});if(o)return e.jsxs(C,{children:[e.jsx(T,{children:e.jsx(S,{children:"Agent Logs"})}),e.jsx(_,{children:e.jsx("div",{className:"text-sm text-muted-foreground",children:e.jsx(I,{})})})]});if(!(s&&(s.oracle||s.setup||s.commands.length>0)))return e.jsx(B,{className:"bg-card border",children:e.jsxs(q,{children:[e.jsx(K,{variant:"icon",children:e.jsx(vt,{})}),e.jsx(U,{children:"No agent logs"}),e.jsx(z,{children:"No oracle, setup, or command logs found"})]})});const r=[];s.oracle&&r.push({id:"oracle",label:"Oracle",content:s.oracle,lang:"text"}),s.setup&&r.push({id:"setup",label:"Setup",content:s.setup,lang:"text"});for(const l of s.commands)r.push({id:`command-${l.index}`,label:`Command ${l.index}`,content:l.content,lang:"text"});return r.length===0?null:e.jsx(C,{className:"py-0 gap-0",children:e.jsx(_,{className:"p-0",children:e.jsxs(ae,{defaultValue:r[0].id,children:[e.jsx(le,{children:r.map(l=>e.jsx(M,{value:l.id,children:l.label},l.id))}),r.map(l=>e.jsx(R,{value:l.id,className:"mt-0 -mx-px",children:e.jsx(A,{code:l.content,lang:l.lang})},l.id))]})})})}function ns(t){const n=["harbor run"];t.source&&n.push(`-d ${t.source}`),n.push(`-t ${t.task_name}`),n.push(`-a ${t.agent_info.name}`);const s=t.agent_info.model_info;if(s){const o=s.provider?`${s.provider}/${s.name}`:s.name;n.push(`-m ${o}`)}return n.join(" ")}function L({value:t}){const n=async()=>{await navigator.clipboard.writeText(t),V("Copied to clipboard",{description:t})};return e.jsx("span",{onClick:n,className:"cursor-default hover:text-foreground transition-colors",children:t})}function rs(t,n){return`/jobs/${encodeURIComponent(t)}/tasks/${encodeURIComponent(n.source)}/${encodeURIComponent(n.agent)}/${encodeURIComponent(n.modelProvider)}/${encodeURIComponent(n.modelName)}/${encodeURIComponent(n.taskName)}`}function os({trial:t,jobName:n,trialName:s}){const{data:o}=P({queryKey:["trajectory",n,s],queryFn:()=>be(n,s)}),a=t.verifier_result?.rewards?.reward??null,r=o?.final_metrics;return e.jsxs(e.Fragment,{children:[e.jsx(A,{code:ns(t),lang:"bash",className:"-mb-px -mx-px"}),e.jsxs("div",{className:"grid grid-cols-1 -mx-px",children:[e.jsxs(C,{className:"-mb-px gap-3 py-4",children:[e.jsxs(T,{className:"flex flex-row items-center justify-between",children:[e.jsx(S,{children:"Outcome"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:Kt(t.started_at)})]}),e.jsxs(_,{children:[e.jsx(te,{label:"Reward",value:a!==null?a.toFixed(2):"-",showBorder:!1}),r?.total_cost_usd&&e.jsx(te,{label:"Cost",value:`$${r.total_cost_usd.toFixed(4)}`,showBorder:!1}),t.exception_info&&e.jsx(te,{label:"Error",value:t.exception_info.exception_type,className:"text-destructive",showBorder:!1})]})]}),e.jsxs(C,{className:"-mb-px -mt-px gap-3 py-4",children:[e.jsx(T,{children:e.jsx(S,{children:"Tokens"})}),e.jsx(_,{children:e.jsx(zt,{segments:[{label:"Cached",value:r?.total_cached_tokens??0,color:"var(--color-neutral-400)"},{label:"Prompt",value:Math.max(0,(r?.total_prompt_tokens??0)-(r?.total_cached_tokens??0)),color:"var(--color-neutral-500)"},{label:"Output",value:r?.total_completion_tokens??0,color:"var(--color-neutral-600)"}],totalLabel:`${((r?.total_prompt_tokens??0)+(r?.total_completion_tokens??0)).toLocaleString()} tokens`})})]}),e.jsxs(C,{className:"-mt-px gap-3 py-4",children:[e.jsx(T,{children:e.jsx(S,{children:"Timing"})}),e.jsx(_,{children:e.jsx(Gt,{phases:[{label:"Env Setup",timing:t.environment_setup,color:"var(--color-neutral-400)"},{label:"Agent Setup",timing:t.agent_setup,color:"var(--color-neutral-500)"},{label:"Agent Execution",timing:t.agent_execution,color:"var(--color-neutral-600)"},{label:"Verifier",timing:t.verifier,color:"var(--color-neutral-700)"}],totalDuration:Fe(t.started_at,t.finished_at)})})]})]}),e.jsxs(ae,{defaultValue:"trajectory",className:"mt-6",children:[e.jsxs(le,{className:"bg-card border border-b-0 w-full",children:[e.jsx(M,{value:"trajectory",children:"Trajectory"}),e.jsx(M,{value:"agent-logs",children:"Agent Logs"}),e.jsx(M,{value:"test-output",children:"Verifier Logs"}),e.jsx(M,{value:"summary",children:"Summary"})]}),e.jsx(R,{value:"trajectory",children:e.jsx(Xt,{jobName:n,trialName:s})}),e.jsx(R,{value:"agent-logs",children:e.jsx(ss,{jobName:n,trialName:s})}),e.jsx(R,{value:"test-output",children:e.jsx(Zt,{jobName:n,trialName:s})}),e.jsx(R,{value:"summary",children:e.jsx(ts,{jobName:n,trialName:s})})]})]})}function as(){return e.jsxs("div",{className:"grid grid-cols-1 -mx-px",children:[e.jsxs(C,{className:"-mb-px gap-3 py-4",children:[e.jsx(T,{children:e.jsx(S,{children:"Outcome"})}),e.jsx(_,{children:e.jsx("div",{className:"text-sm text-muted-foreground",children:e.jsx(I,{})})})]}),e.jsxs(C,{className:"-mb-px -mt-px gap-3 py-4",children:[e.jsx(T,{children:e.jsx(S,{children:"Tokens"})}),e.jsx(_,{children:e.jsx("div",{className:"text-sm text-muted-foreground",children:e.jsx(I,{})})})]}),e.jsxs(C,{className:"-mt-px gap-3 py-4",children:[e.jsx(T,{children:e.jsx(S,{children:"Timing"})}),e.jsx(_,{children:e.jsx("div",{className:"text-sm text-muted-foreground",children:e.jsx(I,{})})})]})]})}const hs=He(function(){const{jobName:n,trialName:s,source:o,agent:a,modelProvider:r,modelName:l,taskName:u}=Be(),x={source:o,agent:a,modelProvider:r,modelName:l,taskName:u},{data:i,isLoading:h,error:j}=P({queryKey:["trial",n,s],queryFn:()=>Qe(n,s),enabled:!!n&&!!s});return e.jsxs("div",{className:"container mx-auto py-10",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx(Ue,{className:"mb-4",children:e.jsxs(ze,{children:[e.jsx(F,{children:e.jsx(X,{asChild:!0,children:e.jsx(Y,{to:"/",children:"Jobs"})})}),e.jsx(Z,{}),e.jsx(F,{children:e.jsx(X,{asChild:!0,children:e.jsx(Y,{to:`/jobs/${encodeURIComponent(n)}`,children:n})})}),e.jsx(Z,{}),e.jsx(F,{children:e.jsx(X,{asChild:!0,children:e.jsx(Y,{to:rs(n,x),children:u})})}),e.jsx(Z,{}),e.jsx(F,{children:e.jsx(Ge,{children:s})})]})}),e.jsx("h1",{className:"text-4xl font-medium mb-4 cursor-default hover:text-foreground/80 transition-colors",onClick:async()=>{await navigator.clipboard.writeText(s),V("Copied to clipboard",{description:s})},children:s}),h?e.jsx("div",{className:"text-sm text-muted-foreground",children:e.jsx(I,{})}):i?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex gap-2 text-sm text-muted-foreground",children:[i.source&&e.jsxs(e.Fragment,{children:[e.jsx(L,{value:i.source}),e.jsx("span",{className:"text-border",children:"|"})]}),e.jsx(L,{value:i.task_name}),e.jsx("span",{className:"text-border",children:"|"}),e.jsx(L,{value:i.agent_info.version&&i.agent_info.version!=="unknown"?`${i.agent_info.name}@${i.agent_info.version}`:i.agent_info.name}),i.agent_info.model_info&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-border",children:"|"}),e.jsx(L,{value:`${i.agent_info.model_info.provider}/${i.agent_info.model_info.name}`})]})]}),e.jsx("div",{className:"text-xs text-muted-foreground mt-3",children:e.jsx(L,{value:i.trial_uri.startsWith("file://")?i.trial_uri.slice(7):i.trial_uri})})]}):null]}),!h&&(j||!i)?e.jsx("div",{className:"text-destructive",children:j instanceof Error?j.message:"Failed to load trial"}):h?e.jsx(as,{}):i?e.jsx(os,{trial:i,jobName:n,trialName:s}):null]})});export{hs as default};
