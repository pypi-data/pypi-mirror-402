import{b as g,t as e,R as _,x as He,A as Be,B as X}from"./index-C6J4Pqq0.js";import{c as W,v as je,t as oe,P as O,x as ge,y as qe,w as ve,H as Ke,r as $,u as P,B as ze,a as Ue,b as K,j as Z,k as ee,d as We,L as I,I as Ge,e as he,J as be,K as Je,M as ye,N as Qe,O as Ye}from"./api-Cbkug5dl.js";import{t as z,u as Xe}from"./index-DDT61vXN.js";import{e as Ne,n as Ze,E as F,a as V,b as H,c as B,d as q,u as et}from"./empty-Bq79pVAD.js";import{m as tt,T as ae,a as ie,b as M,c as R,F as st,D as nt,d as rt,e as ot,f as at,g as it,h as ct,L as lt,S as dt,i as ut,j as xt,k as mt,l as te}from"./tabs-D1aTDsf_.js";import{u as ht,C as A,B as pe}from"./code-block-C1sg3uaS.js";import"./mutation-CzWEsub0.js";const pt=[["circle",{cx:"6",cy:"19",r:"3",key:"1kj8tv"}],["path",{d:"M9 19h8.5a3.5 3.5 0 0 0 0-7h-11a3.5 3.5 0 0 1 0-7H15",key:"1d8sl"}],["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}]],ft=W("route",pt);const jt=[["path",{d:"M15 12h-5",key:"r7krc0"}],["path",{d:"M15 8h-5",key:"1khuty"}],["path",{d:"M19 17V5a2 2 0 0 0-2-2H4",key:"zz82l3"}],["path",{d:"M8 21h12a2 2 0 0 0 2-2v-1a1 1 0 0 0-1-1H11a1 1 0 0 0-1 1v1a2 2 0 1 1-4 0V5a2 2 0 1 0-4 0v2a1 1 0 0 0 1 1h3",key:"1ph1d7"}]],gt=W("scroll-text",jt);const vt=[["path",{d:"M12 19h8",key:"baeox8"}],["path",{d:"m4 17 6-6-6-6",key:"1yngyt"}]],bt=W("terminal",vt);const yt=[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]],Nt=W("triangle-alert",yt);var G="Collapsible",[Ct,Ce]=je(G),[_t,ce]=Ct(G),_e=g.forwardRef((t,n)=>{const{__scopeCollapsible:s,open:o,defaultOpen:a,disabled:r,onOpenChange:i,...u}=t,[m,c]=oe({prop:o,defaultProp:a??!1,onChange:i,caller:G});return e.jsx(_t,{scope:s,disabled:r,contentId:Ne(),open:m,onOpenToggle:g.useCallback(()=>c(h=>!h),[c]),children:e.jsx(O.div,{"data-state":de(m),"data-disabled":r?"":void 0,...u,ref:n})})});_e.displayName=G;var we="CollapsibleTrigger",ke=g.forwardRef((t,n)=>{const{__scopeCollapsible:s,...o}=t,a=ce(we,s);return e.jsx(O.button,{type:"button","aria-controls":a.contentId,"aria-expanded":a.open||!1,"data-state":de(a.open),"data-disabled":a.disabled?"":void 0,disabled:a.disabled,...o,ref:n,onClick:ge(t.onClick,a.onOpenToggle)})});ke.displayName=we;var le="CollapsibleContent",Te=g.forwardRef((t,n)=>{const{forceMount:s,...o}=t,a=ce(le,t.__scopeCollapsible);return e.jsx(qe,{present:s||a.open,children:({present:r})=>e.jsx(wt,{...o,ref:n,present:r})})});Te.displayName=le;var wt=g.forwardRef((t,n)=>{const{__scopeCollapsible:s,present:o,children:a,...r}=t,i=ce(le,s),[u,m]=g.useState(o),c=g.useRef(null),h=ve(n,c),j=g.useRef(0),p=j.current,f=g.useRef(0),v=f.current,b=i.open||u,x=g.useRef(b),l=g.useRef(void 0);return g.useEffect(()=>{const d=requestAnimationFrame(()=>x.current=!1);return()=>cancelAnimationFrame(d)},[]),Ke(()=>{const d=c.current;if(d){l.current=l.current||{transitionDuration:d.style.transitionDuration,animationName:d.style.animationName},d.style.transitionDuration="0s",d.style.animationName="none";const y=d.getBoundingClientRect();j.current=y.height,f.current=y.width,x.current||(d.style.transitionDuration=l.current.transitionDuration,d.style.animationName=l.current.animationName),m(o)}},[i.open,o]),e.jsx(O.div,{"data-state":de(i.open),"data-disabled":i.disabled?"":void 0,id:i.contentId,hidden:!b,...r,ref:h,style:{"--radix-collapsible-content-height":p?`${p}px`:void 0,"--radix-collapsible-content-width":v?`${v}px`:void 0,...t.style},children:b&&a})});function de(t){return t?"open":"closed"}var kt=_e,Tt=ke,St=Te,T="Accordion",At=["Home","End","ArrowDown","ArrowUp","ArrowLeft","ArrowRight"],[ue,It,Mt]=tt(T),[J]=je(T,[Mt,Ce]),xe=Ce(),Se=_.forwardRef((t,n)=>{const{type:s,...o}=t,a=o,r=o;return e.jsx(ue.Provider,{scope:t.__scopeAccordion,children:s==="multiple"?e.jsx(Dt,{...r,ref:n}):e.jsx(Pt,{...a,ref:n})})});Se.displayName=T;var[Ae,Rt]=J(T),[Ie,$t]=J(T,{collapsible:!1}),Pt=_.forwardRef((t,n)=>{const{value:s,defaultValue:o,onValueChange:a=()=>{},collapsible:r=!1,...i}=t,[u,m]=oe({prop:s,defaultProp:o??"",onChange:a,caller:T});return e.jsx(Ae,{scope:t.__scopeAccordion,value:_.useMemo(()=>u?[u]:[],[u]),onItemOpen:m,onItemClose:_.useCallback(()=>r&&m(""),[r,m]),children:e.jsx(Ie,{scope:t.__scopeAccordion,collapsible:r,children:e.jsx(Me,{...i,ref:n})})})}),Dt=_.forwardRef((t,n)=>{const{value:s,defaultValue:o,onValueChange:a=()=>{},...r}=t,[i,u]=oe({prop:s,defaultProp:o??[],onChange:a,caller:T}),m=_.useCallback(h=>u((j=[])=>[...j,h]),[u]),c=_.useCallback(h=>u((j=[])=>j.filter(p=>p!==h)),[u]);return e.jsx(Ae,{scope:t.__scopeAccordion,value:i,onItemOpen:m,onItemClose:c,children:e.jsx(Ie,{scope:t.__scopeAccordion,collapsible:!0,children:e.jsx(Me,{...r,ref:n})})})}),[Et,Q]=J(T),Me=_.forwardRef((t,n)=>{const{__scopeAccordion:s,disabled:o,dir:a,orientation:r="vertical",...i}=t,u=_.useRef(null),m=ve(u,n),c=It(s),j=ht(a)==="ltr",p=ge(t.onKeyDown,f=>{if(!At.includes(f.key))return;const v=f.target,b=c().filter(Y=>!Y.ref.current?.disabled),x=b.findIndex(Y=>Y.ref.current===v),l=b.length;if(x===-1)return;f.preventDefault();let d=x;const y=0,S=l-1,D=()=>{d=x+1,d>S&&(d=y)},E=()=>{d=x-1,d<y&&(d=S)};switch(f.key){case"Home":d=y;break;case"End":d=S;break;case"ArrowRight":r==="horizontal"&&(j?D():E());break;case"ArrowDown":r==="vertical"&&D();break;case"ArrowLeft":r==="horizontal"&&(j?E():D());break;case"ArrowUp":r==="vertical"&&E();break}const Ve=d%l;b[Ve].ref.current?.focus()});return e.jsx(Et,{scope:s,disabled:o,direction:a,orientation:r,children:e.jsx(ue.Slot,{scope:s,children:e.jsx(O.div,{...i,"data-orientation":r,ref:m,onKeyDown:o?void 0:p})})})}),U="AccordionItem",[Lt,me]=J(U),Re=_.forwardRef((t,n)=>{const{__scopeAccordion:s,value:o,...a}=t,r=Q(U,s),i=Rt(U,s),u=xe(s),m=Ne(),c=o&&i.value.includes(o)||!1,h=r.disabled||t.disabled;return e.jsx(Lt,{scope:s,open:c,disabled:h,triggerId:m,children:e.jsx(kt,{"data-orientation":r.orientation,"data-state":Oe(c),...u,...a,ref:n,disabled:h,open:c,onOpenChange:j=>{j?i.onItemOpen(o):i.onItemClose(o)}})})});Re.displayName=U;var $e="AccordionHeader",Pe=_.forwardRef((t,n)=>{const{__scopeAccordion:s,...o}=t,a=Q(T,s),r=me($e,s);return e.jsx(O.h3,{"data-orientation":a.orientation,"data-state":Oe(r.open),"data-disabled":r.disabled?"":void 0,...o,ref:n})});Pe.displayName=$e;var ne="AccordionTrigger",De=_.forwardRef((t,n)=>{const{__scopeAccordion:s,...o}=t,a=Q(T,s),r=me(ne,s),i=$t(ne,s),u=xe(s);return e.jsx(ue.ItemSlot,{scope:s,children:e.jsx(Tt,{"aria-disabled":r.open&&!i.collapsible||void 0,"data-orientation":a.orientation,id:r.triggerId,...u,...o,ref:n})})});De.displayName=ne;var Ee="AccordionContent",Le=_.forwardRef((t,n)=>{const{__scopeAccordion:s,...o}=t,a=Q(T,s),r=me(Ee,s),i=xe(s);return e.jsx(St,{role:"region","aria-labelledby":r.triggerId,"data-orientation":a.orientation,...i,...o,ref:n,style:{"--radix-accordion-content-height":"var(--radix-collapsible-content-height)","--radix-accordion-content-width":"var(--radix-collapsible-content-width)",...t.style}})});Le.displayName=Ee;function Oe(t){return t?"open":"closed"}var Ot=Se,Ft=Re,Vt=Pe,Ht=De,Bt=Le;function qt({...t}){return e.jsx(Ot,{"data-slot":"accordion",...t})}function Kt({className:t,...n}){return e.jsx(Ft,{"data-slot":"accordion-item",className:$("border-b last:border-b-0",t),...n})}function zt({className:t,children:n,...s}){return e.jsx(Vt,{className:"flex min-w-0",children:e.jsxs(Ht,{"data-slot":"accordion-trigger",className:$("group focus-visible:border-ring focus-visible:ring-ring/50 flex flex-1 min-w-0 items-start justify-between gap-4 rounded-md py-4 text-left text-sm transition-all outline-none focus-visible:ring-[3px] disabled:pointer-events-none disabled:opacity-50 [&[data-state=open]>svg]:rotate-180",t),...s,children:[n,e.jsx(Ze,{className:"text-muted-foreground pointer-events-none size-4 shrink-0 translate-y-0.5 transition-transform duration-200"})]})})}function Ut({className:t,children:n,...s}){return e.jsx(Bt,{"data-slot":"accordion-content",className:"data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down overflow-hidden text-sm",...s,children:e.jsx("div",{className:$("pt-0 pb-4",t),children:n})})}function N({className:t,...n}){return e.jsx("div",{"data-slot":"card",className:$("bg-card text-card-foreground flex flex-col gap-6 border py-6",t),...n})}function w({className:t,...n}){return e.jsx("div",{"data-slot":"card-header",className:$("flex flex-col gap-1.5 px-6",t),...n})}function k({className:t,...n}){return e.jsx("div",{"data-slot":"card-title",className:$("leading-none font-semibold",t),...n})}function C({className:t,...n}){return e.jsx("div",{"data-slot":"card-content",className:$("px-6",t),...n})}function Wt(t){return t?new Date(t).toLocaleString():"-"}function Fe(t,n){if(!t)return"-";const s=new Date(t).getTime(),a=(n?new Date(n).getTime():Date.now())-s,r=Math.floor(a/1e3),i=Math.floor(r/60),u=Math.floor(i/60);return u>0?`${u}h ${i%60}m ${r%60}s`:i>0?`${i}m ${r%60}s`:`${r}s`}function Gt(t){if(!t?.started_at)return 0;const n=new Date(t.started_at).getTime();return(t.finished_at?new Date(t.finished_at).getTime():Date.now())-n}function Jt({segments:t,totalLabel:n}){const[s,o]=g.useState(null),[a,r]=g.useState(0),i=t.reduce((x,l)=>x+l.value,0);if(i===0)return e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"h-8 bg-muted"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"No token data"})]});const u=1,m=t.map(x=>x.value>0?x.value/i*100:0),c=m.map(x=>x>0&&x<u),h=c.reduce((x,l,d)=>l?x+(u-m[d]):x,0),j=m.reduce((x,l,d)=>!c[d]&&l>0?x+l:x,0),p=j>0?(j-h)/j:1,f=m.map((x,l)=>x===0?0:c[l]?u:x*p),v=[];let b=0;for(let x=0;x<f.length;x++)v.push(b),b+=f[x];return e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"relative",children:[s!==null&&e.jsx("div",{className:"absolute bottom-full mb-2 z-10 -translate-x-1/2 pointer-events-none",style:{left:`${a}%`},children:e.jsxs("div",{className:"bg-popover border border-border rounded-md shadow-md px-3 py-2 whitespace-nowrap",children:[e.jsx("div",{className:"text-sm font-medium",children:t[s].label}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[t[s].value.toLocaleString()," tokens"]})]})}),e.jsx("div",{className:"flex h-8 overflow-hidden",children:t.map((x,l)=>{if(x.value===0)return null;const d=f[l],y=s!==null&&s!==l,S=v[l]+d/2;return e.jsx("div",{className:"transition-opacity duration-150",style:{width:`${d}%`,backgroundColor:x.color,opacity:y?.3:1},onMouseEnter:()=>{o(l),r(S)},onMouseLeave:()=>o(null)},x.label)})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex gap-4",children:t.map((x,l)=>{if(x.value===0)return null;const d=c[l];return e.jsxs("div",{className:"flex items-center gap-1.5 text-xs",children:[e.jsx("div",{className:"w-2.5 h-2.5 rounded-sm",style:{backgroundColor:x.color}}),e.jsxs("span",{className:"text-muted-foreground",children:[x.label,d&&" (scaled)"]})]},x.label)})}),e.jsx("div",{className:"text-xs text-muted-foreground",children:n})]})]})}function Qt({phases:t,totalDuration:n}){const[s,o]=g.useState(null),[a,r]=g.useState(0),i=t.map(l=>Gt(l.timing)),u=i.reduce((l,d)=>l+d,0);if(u===0)return e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"h-8 bg-muted rounded"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"No timing data"})]});const m=1,c=i.map(l=>l>0?l/u*100:0),h=c.map(l=>l>0&&l<m),j=h.reduce((l,d,y)=>d?l+(m-c[y]):l,0),p=c.reduce((l,d,y)=>!h[y]&&d>0?l+d:l,0),f=p>0?(p-j)/p:1,v=c.map((l,d)=>l===0?0:h[d]?m:l*f),b=[];let x=0;for(let l=0;l<v.length;l++)b.push(x),x+=v[l];return e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"relative",children:[s!==null&&e.jsx("div",{className:"absolute bottom-full mb-2 z-10 -translate-x-1/2 pointer-events-none",style:{left:`${a}%`},children:e.jsxs("div",{className:"bg-popover border border-border rounded-md shadow-md px-3 py-2 whitespace-nowrap",children:[e.jsx("div",{className:"text-sm font-medium",children:t[s].label}),e.jsx("div",{className:"text-sm text-muted-foreground",children:Fe(t[s].timing?.started_at??null,t[s].timing?.finished_at??null)})]})}),e.jsx("div",{className:"flex h-8 overflow-hidden",children:t.map((l,d)=>{if(i[d]===0)return null;const S=v[d],D=s!==null&&s!==d,E=b[d]+S/2;return e.jsx("div",{className:"transition-opacity duration-150",style:{width:`${S}%`,backgroundColor:l.color,opacity:D?.3:1},onMouseEnter:()=>{o(d),r(E)},onMouseLeave:()=>o(null)},l.label)})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex gap-4",children:t.map((l,d)=>{if(i[d]===0)return null;const S=h[d];return e.jsxs("div",{className:"flex items-center gap-1.5 text-xs",children:[e.jsx("div",{className:"w-2.5 h-2.5 rounded-sm",style:{backgroundColor:l.color}}),e.jsxs("span",{className:"text-muted-foreground",children:[l.label,S&&" (scaled)"]})]},l.label)})}),e.jsx("div",{className:"text-xs text-muted-foreground",children:n})]})]})}function se({label:t,value:n,className:s,showBorder:o=!0}){return e.jsxs("div",{className:`flex justify-between py-1 text-sm ${o?"border-b border-border last:border-0":""}`,children:[e.jsx("span",{className:"text-muted-foreground",children:t}),e.jsx("span",{className:s,children:n})]})}function fe(t,n){if(!t||!n)return null;const s=new Date(t).getTime(),a=new Date(n).getTime()-s;return a<0?null:re(a)}function re(t){const n=t/1e3;if(n<60)return`${n.toFixed(1)}s`;const s=Math.floor(n/60),o=n%60;return`${s}m ${o.toFixed(0)}s`}function Yt({step:t}){const s={agent:"text-purple-600 dark:text-purple-300"}.agent;return e.jsxs("div",{className:"space-y-3",children:[t.message&&e.jsx("div",{className:"text-sm whitespace-pre-wrap wrap-break-words",children:t.message}),t.reasoning_content&&e.jsxs("div",{children:[e.jsx("h5",{className:"text-xs font-medium text-muted-foreground mb-1",children:"Reasoning"}),e.jsx("pre",{className:"text-xs bg-muted p-2 overflow-x-auto whitespace-pre-wrap",children:t.reasoning_content})]}),t.tool_calls&&t.tool_calls.length>0&&e.jsxs("div",{children:[e.jsx("h5",{className:"text-xs font-medium text-muted-foreground mb-1",children:"Tool Calls"}),t.tool_calls.map(o=>e.jsxs("div",{className:"mb-2",children:[e.jsx("div",{className:`text-xs font-mono mb-1 ${s}`,children:o.function_name}),e.jsx(A,{code:JSON.stringify(o.arguments,null,2),lang:"json"})]},o.tool_call_id))]}),t.observation&&t.observation.results.length>0&&e.jsxs("div",{children:[e.jsx("h5",{className:"text-xs font-medium text-muted-foreground mb-1",children:"Observations"}),t.observation.results.map((o,a)=>e.jsx("div",{className:"mb-2",children:e.jsx(A,{code:o.content||"(empty)",lang:"text"})},a))]}),t.metrics&&e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Tokens: ",(t.metrics.prompt_tokens??0).toLocaleString()," prompt /"," ",(t.metrics.completion_tokens??0).toLocaleString()," completion",t.metrics.cost_usd&&` / $${t.metrics.cost_usd.toFixed(4)}`]})]})}function Xt({step:t,nextTimestamp:n,startTimestamp:s}){const o={system:"text-gray-600 dark:text-gray-300",user:"text-blue-600 dark:text-blue-300",agent:"text-purple-600 dark:text-purple-300"},a=fe(t.timestamp,n),r=fe(s,t.timestamp),i=t.message?.split(`
`)[0]||null;return e.jsxs("div",{className:"flex-1 min-w-0 flex items-center gap-4 overflow-hidden",children:[e.jsxs("div",{className:"flex-1 min-w-0 flex items-center gap-2 overflow-hidden",children:[e.jsxs("span",{className:"text-xs text-muted-foreground shrink-0",children:["#",t.step_id]}),e.jsx("span",{className:`text-xs font-medium shrink-0 ${o[t.source]}`,children:t.source}),t.model_name&&e.jsx("span",{className:"text-xs text-muted-foreground shrink-0",children:t.model_name}),e.jsx("span",{className:"text-xs truncate min-w-0 transition-colors group-data-[state=open]:text-border",children:i||e.jsx("span",{className:"text-muted-foreground italic",children:"No message"})})]}),(r||a)&&e.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground shrink-0",children:[a&&e.jsxs(pe,{variant:"secondary",className:"text-xs font-normal",children:["+",a]}),r&&e.jsx(pe,{variant:"outline",className:"text-xs font-normal",children:r})]})]})}function Zt(t){const n=["var(--color-neutral-400)","var(--color-neutral-500)","var(--color-neutral-600)","var(--color-neutral-700)"],s=t%6,o=s<=3?s:6-s;return n[o]}function es({steps:t,onStepClick:n}){const[s,o]=g.useState(null),[a,r]=g.useState(0);if(t.length===0)return null;const i=t[0].timestamp?new Date(t[0].timestamp).getTime():0,u=t.map((p,f)=>{const v=p.timestamp?new Date(p.timestamp).getTime():0,b=f<t.length-1?t[f+1]:null,x=b?.timestamp?new Date(b.timestamp).getTime():v;return{stepId:p.step_id,durationMs:Math.max(0,x-v),elapsedMs:v-i}}),m=u.reduce((p,f)=>p+f.durationMs,0);if(m===0)return e.jsx("div",{className:"mb-4",children:e.jsx("div",{className:"h-6 bg-muted"})});const c=u.map(p=>p.durationMs/m*100),h=[];let j=0;for(const p of c)h.push(j),j+=p;return e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"relative",children:[s!==null&&e.jsx("div",{className:"absolute bottom-full mb-2 z-10 -translate-x-1/2 pointer-events-none",style:{left:`${a}%`},children:e.jsxs("div",{className:"bg-popover border border-border rounded-md shadow-md px-3 py-2 whitespace-nowrap",children:[e.jsxs("div",{className:"text-sm font-medium",children:["Step #",u[s].stepId]}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Duration: ",re(u[s].durationMs)]}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Started at: ",re(u[s].elapsedMs)]})]})}),e.jsx("div",{className:"flex h-6 overflow-hidden",children:u.map((p,f)=>{if(p.durationMs===0)return null;const v=c[f],b=s!==null&&s!==f,x=h[f]+v/2;return e.jsx("div",{className:"transition-opacity duration-150 cursor-pointer",style:{width:`${v}%`,backgroundColor:Zt(f),opacity:b?.3:1},onMouseEnter:()=>{o(f),r(x)},onMouseLeave:()=>o(null),onClick:()=>n(f)},p.stepId)})})]})})}function ts({jobName:t,trialName:n}){const{data:s,isLoading:o}=P({queryKey:["trajectory",t,n],queryFn:()=>be(t,n)}),[a,r]=g.useState([]),i=g.useRef([]);if(o)return e.jsxs(N,{children:[e.jsx(w,{children:e.jsx(k,{children:"Trajectory"})}),e.jsx(C,{children:e.jsx("div",{className:"text-sm text-muted-foreground",children:e.jsx(I,{})})})]});if(!s)return e.jsx(F,{className:"bg-card border",children:e.jsxs(V,{children:[e.jsx(H,{variant:"icon",children:e.jsx(ft,{})}),e.jsx(B,{children:"No trajectory"}),e.jsxs(q,{children:["No ATIF trajectory found at ",n,"/agent/trajectory.json"]})]})});const u=m=>{const c=`step-${m}`;r(h=>h.includes(c)?h:[...h,c]),i.current[m]?.scrollIntoView({behavior:"smooth",block:"start"})};return e.jsxs(N,{children:[e.jsxs(w,{children:[e.jsx(k,{children:"Trajectory"}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[s.steps.length," steps",s.final_metrics?.total_cost_usd&&e.jsxs(e.Fragment,{children:[" / $",s.final_metrics.total_cost_usd.toFixed(4)," total"]})]})]}),e.jsxs(C,{children:[e.jsx(es,{steps:s.steps,onStepClick:u}),e.jsx(qt,{type:"multiple",value:a,onValueChange:r,children:s.steps.map((m,c)=>e.jsxs(Kt,{value:`step-${c}`,ref:h=>{i.current[c]=h},children:[e.jsx(zt,{children:e.jsx(Xt,{step:m,nextTimestamp:c<s.steps.length-1?s.steps[c+1].timestamp:null,startTimestamp:s.steps[0]?.timestamp??null})}),e.jsx(Ut,{children:e.jsx(Yt,{step:m})})]},m.step_id))})]})]})}function ss({jobName:t,trialName:n}){const{data:s,isLoading:o}=P({queryKey:["verifier-output",t,n],queryFn:()=>Je(t,n)});if(o)return e.jsxs(N,{children:[e.jsx(w,{children:e.jsx(k,{children:"Verifier Output"})}),e.jsx(C,{children:e.jsx("div",{className:"text-sm text-muted-foreground",children:e.jsx(I,{})})})]});const a=!!s?.stdout,r=!!s?.ctrf;return!a&&!r?e.jsx(F,{className:"bg-card border",children:e.jsxs(V,{children:[e.jsx(H,{variant:"icon",children:e.jsx(gt,{})}),e.jsx(B,{children:"No verifier logs"}),e.jsx(q,{children:"No test output or CTRF results found"})]})}):a&&r?e.jsx(N,{className:"py-0 gap-0",children:e.jsx(C,{className:"p-0",children:e.jsxs(ae,{defaultValue:"stdout",children:[e.jsxs(ie,{children:[e.jsx(M,{value:"stdout",children:"Output"}),e.jsx(M,{value:"ctrf",children:"CTRF"})]}),e.jsx(R,{value:"stdout",className:"mt-0 -mx-px",children:e.jsx(A,{code:s.stdout,lang:"text"})}),e.jsx(R,{value:"ctrf",className:"mt-0 -mx-px",children:e.jsx(A,{code:s.ctrf,lang:"json"})})]})})}):a?e.jsx(A,{code:s.stdout,lang:"text"}):e.jsx(A,{code:s.ctrf,lang:"json"})}function ns({jobName:t,trialName:n}){const s=Xe(),[o,a]=g.useState(!1),[r,i]=g.useState("haiku"),u=et({mutationFn:()=>Ge(t,n,r),onSuccess:()=>{s.invalidateQueries({queryKey:["agent-logs",t,n]}),a(!1),z.success("Summary generated")},onError:m=>{z.error("Failed to generate summary",{description:m.message})}});return e.jsxs(nt,{open:o,onOpenChange:a,children:[e.jsx(rt,{asChild:!0,children:e.jsx(he,{children:"Generate Summary"})}),e.jsxs(ot,{children:[e.jsxs(at,{children:[e.jsx(it,{children:"Generate Summary"}),e.jsx(ct,{children:"Use Claude to analyze this trial and generate a summary."})]}),e.jsxs("div",{className:"space-y-4 pt-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(lt,{htmlFor:"model",children:"Model"}),e.jsxs(dt,{value:r,onValueChange:i,children:[e.jsx(ut,{id:"model",children:e.jsx(xt,{})}),e.jsxs(mt,{children:[e.jsx(te,{value:"haiku",children:"Haiku (Recommended)"}),e.jsx(te,{value:"sonnet",children:"Sonnet"}),e.jsx(te,{value:"opus",children:"Opus"})]})]})]}),e.jsx(he,{className:"w-full",onClick:()=>u.mutate(),disabled:u.isPending,children:u.isPending?e.jsx(I,{text:"Generating"}):"Generate"})]})]})]})}function rs({jobName:t,trialName:n}){const{data:s,isLoading:o}=P({queryKey:["agent-logs",t,n],queryFn:()=>ye(t,n)});return o?e.jsxs(N,{children:[e.jsx(w,{children:e.jsx(k,{children:"Summary"})}),e.jsx(C,{children:e.jsx("div",{className:"text-sm text-muted-foreground",children:e.jsx(I,{})})})]}):s?.summary?e.jsx(A,{code:s.summary,lang:"markdown",wrap:!0}):e.jsxs(F,{className:"bg-card border",children:[e.jsxs(V,{children:[e.jsx(H,{variant:"icon",children:e.jsx(st,{})}),e.jsx(B,{children:"No summary"}),e.jsx(q,{children:"Generate a summary of this trial using Claude."})]}),e.jsx(ns,{jobName:t,trialName:n})]})}function os({jobName:t,trialName:n}){const{data:s,isLoading:o}=P({queryKey:["exception",t,n],queryFn:()=>Qe(t,n)});return o?e.jsxs(N,{children:[e.jsx(w,{children:e.jsx(k,{children:"Exception"})}),e.jsx(C,{children:e.jsx("div",{className:"text-sm text-muted-foreground",children:e.jsx(I,{})})})]}):s?e.jsx(A,{code:s,lang:"text"}):e.jsx(F,{className:"bg-card border",children:e.jsxs(V,{children:[e.jsx(H,{variant:"icon",children:e.jsx(Nt,{})}),e.jsx(B,{children:"No exception"}),e.jsx(q,{children:"No exception.txt file found in this trial."})]})})}function as({jobName:t,trialName:n}){const{data:s,isLoading:o}=P({queryKey:["agent-logs",t,n],queryFn:()=>ye(t,n)});if(o)return e.jsxs(N,{children:[e.jsx(w,{children:e.jsx(k,{children:"Agent Logs"})}),e.jsx(C,{children:e.jsx("div",{className:"text-sm text-muted-foreground",children:e.jsx(I,{})})})]});if(!(s&&(s.oracle||s.setup||s.commands.length>0)))return e.jsx(F,{className:"bg-card border",children:e.jsxs(V,{children:[e.jsx(H,{variant:"icon",children:e.jsx(bt,{})}),e.jsx(B,{children:"No agent logs"}),e.jsx(q,{children:"No oracle, setup, or command logs found"})]})});const r=[];s.oracle&&r.push({id:"oracle",label:"Oracle",content:s.oracle,lang:"text"}),s.setup&&r.push({id:"setup",label:"Setup",content:s.setup,lang:"text"});for(const i of s.commands)r.push({id:`command-${i.index}`,label:`Command ${i.index}`,content:i.content,lang:"text"});return r.length===0?null:e.jsx(N,{className:"py-0 gap-0",children:e.jsx(C,{className:"p-0",children:e.jsxs(ae,{defaultValue:r[0].id,children:[e.jsx(ie,{children:r.map(i=>e.jsx(M,{value:i.id,children:i.label},i.id))}),r.map(i=>e.jsx(R,{value:i.id,className:"mt-0 -mx-px",children:e.jsx(A,{code:i.content,lang:i.lang})},i.id))]})})})}function is(t){const n=["harbor run"];t.source&&n.push(`-d ${t.source}`),n.push(`-t ${t.task_name}`),n.push(`-a ${t.agent_info.name}`);const s=t.agent_info.model_info;if(s){const o=s.provider?`${s.provider}/${s.name}`:s.name;n.push(`-m ${o}`)}return n.join(" ")}function L({value:t}){const n=async()=>{await navigator.clipboard.writeText(t),z("Copied to clipboard",{description:t})};return e.jsx("span",{onClick:n,className:"cursor-default hover:text-foreground transition-colors",children:t})}function cs(t,n){return`/jobs/${encodeURIComponent(t)}/tasks/${encodeURIComponent(n.source)}/${encodeURIComponent(n.agent)}/${encodeURIComponent(n.modelProvider)}/${encodeURIComponent(n.modelName)}/${encodeURIComponent(n.taskName)}`}function ls({trial:t,jobName:n,trialName:s}){const{data:o}=P({queryKey:["trajectory",n,s],queryFn:()=>be(n,s)}),a=t.verifier_result?.rewards?.reward??null,r=o?.final_metrics;return e.jsxs(e.Fragment,{children:[e.jsx(A,{code:is(t),lang:"bash",className:"-mb-px -mx-px"}),e.jsxs("div",{className:"grid grid-cols-1 -mx-px",children:[e.jsxs(N,{className:"-mb-px gap-3 py-4",children:[e.jsxs(w,{className:"flex flex-row items-center justify-between",children:[e.jsx(k,{children:"Outcome"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:Wt(t.started_at)})]}),e.jsxs(C,{children:[e.jsx(se,{label:"Reward",value:a!==null?a.toFixed(2):"-",showBorder:!1}),r?.total_cost_usd&&e.jsx(se,{label:"Cost",value:`$${r.total_cost_usd.toFixed(4)}`,showBorder:!1}),t.exception_info&&e.jsx(se,{label:"Error",value:t.exception_info.exception_type,className:"text-destructive",showBorder:!1})]})]}),e.jsxs(N,{className:"-mb-px -mt-px gap-3 py-4",children:[e.jsx(w,{children:e.jsx(k,{children:"Tokens"})}),e.jsx(C,{children:e.jsx(Jt,{segments:[{label:"Cached",value:r?.total_cached_tokens??0,color:"var(--color-neutral-400)"},{label:"Prompt",value:Math.max(0,(r?.total_prompt_tokens??0)-(r?.total_cached_tokens??0)),color:"var(--color-neutral-500)"},{label:"Output",value:r?.total_completion_tokens??0,color:"var(--color-neutral-600)"}],totalLabel:`${((r?.total_prompt_tokens??0)+(r?.total_completion_tokens??0)).toLocaleString()} tokens`})})]}),e.jsxs(N,{className:"-mt-px gap-3 py-4",children:[e.jsx(w,{children:e.jsx(k,{children:"Timing"})}),e.jsx(C,{children:e.jsx(Qt,{phases:[{label:"Env Setup",timing:t.environment_setup,color:"var(--color-neutral-400)"},{label:"Agent Setup",timing:t.agent_setup,color:"var(--color-neutral-500)"},{label:"Agent Execution",timing:t.agent_execution,color:"var(--color-neutral-600)"},{label:"Verifier",timing:t.verifier,color:"var(--color-neutral-700)"}],totalDuration:Fe(t.started_at,t.finished_at)})})]})]}),e.jsxs(ae,{defaultValue:"trajectory",className:"mt-6",children:[e.jsxs(ie,{className:"bg-card border border-b-0 w-full",children:[e.jsx(M,{value:"trajectory",children:"Trajectory"}),e.jsx(M,{value:"agent-logs",children:"Agent Logs"}),e.jsx(M,{value:"test-output",children:"Verifier Logs"}),e.jsx(M,{value:"summary",children:"Summary"}),e.jsx(M,{value:"exception",children:"Exception"})]}),e.jsx(R,{value:"trajectory",forceMount:!0,className:"data-[state=inactive]:hidden",children:e.jsx(ts,{jobName:n,trialName:s})}),e.jsx(R,{value:"agent-logs",forceMount:!0,className:"data-[state=inactive]:hidden",children:e.jsx(as,{jobName:n,trialName:s})}),e.jsx(R,{value:"test-output",forceMount:!0,className:"data-[state=inactive]:hidden",children:e.jsx(ss,{jobName:n,trialName:s})}),e.jsx(R,{value:"summary",forceMount:!0,className:"data-[state=inactive]:hidden",children:e.jsx(rs,{jobName:n,trialName:s})}),e.jsx(R,{value:"exception",forceMount:!0,className:"data-[state=inactive]:hidden",children:e.jsx(os,{jobName:n,trialName:s})})]})]})}function ds(){return e.jsxs("div",{className:"grid grid-cols-1 -mx-px",children:[e.jsxs(N,{className:"-mb-px gap-3 py-4",children:[e.jsx(w,{children:e.jsx(k,{children:"Outcome"})}),e.jsx(C,{children:e.jsx("div",{className:"text-sm text-muted-foreground",children:e.jsx(I,{})})})]}),e.jsxs(N,{className:"-mb-px -mt-px gap-3 py-4",children:[e.jsx(w,{children:e.jsx(k,{children:"Tokens"})}),e.jsx(C,{children:e.jsx("div",{className:"text-sm text-muted-foreground",children:e.jsx(I,{})})})]}),e.jsxs(N,{className:"-mt-px gap-3 py-4",children:[e.jsx(w,{children:e.jsx(k,{children:"Timing"})}),e.jsx(C,{children:e.jsx("div",{className:"text-sm text-muted-foreground",children:e.jsx(I,{})})})]})]})}const gs=He(function(){const{jobName:n,trialName:s,source:o,agent:a,modelProvider:r,modelName:i,taskName:u}=Be(),m={source:o,agent:a,modelProvider:r,modelName:i,taskName:u},{data:c,isLoading:h,error:j}=P({queryKey:["trial",n,s],queryFn:()=>Ye(n,s),enabled:!!n&&!!s});return e.jsxs("div",{className:"container mx-auto py-10",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx(ze,{className:"mb-4",children:e.jsxs(Ue,{children:[e.jsx(K,{children:e.jsx(Z,{asChild:!0,children:e.jsx(X,{to:"/",children:"Jobs"})})}),e.jsx(ee,{}),e.jsx(K,{children:e.jsx(Z,{asChild:!0,children:e.jsx(X,{to:`/jobs/${encodeURIComponent(n)}`,children:n})})}),e.jsx(ee,{}),e.jsx(K,{children:e.jsx(Z,{asChild:!0,children:e.jsx(X,{to:cs(n,m),children:u})})}),e.jsx(ee,{}),e.jsx(K,{children:e.jsx(We,{children:s})})]})}),e.jsx("h1",{className:"text-4xl font-medium mb-4 cursor-default hover:text-foreground/80 transition-colors",onClick:async()=>{await navigator.clipboard.writeText(s),z("Copied to clipboard",{description:s})},children:s}),h?e.jsx("div",{className:"text-sm text-muted-foreground",children:e.jsx(I,{})}):c?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex gap-2 text-sm text-muted-foreground",children:[c.source&&e.jsxs(e.Fragment,{children:[e.jsx(L,{value:c.source}),e.jsx("span",{className:"text-border",children:"|"})]}),e.jsx(L,{value:c.task_name}),e.jsx("span",{className:"text-border",children:"|"}),e.jsx(L,{value:c.agent_info.version&&c.agent_info.version!=="unknown"?`${c.agent_info.name}@${c.agent_info.version}`:c.agent_info.name}),c.agent_info.model_info&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-border",children:"|"}),e.jsx(L,{value:`${c.agent_info.model_info.provider}/${c.agent_info.model_info.name}`})]})]}),e.jsx("div",{className:"text-xs text-muted-foreground mt-3",children:e.jsx(L,{value:c.trial_uri.startsWith("file://")?c.trial_uri.slice(7):c.trial_uri})})]}):null]}),!h&&(j||!c)?e.jsx("div",{className:"text-destructive",children:j instanceof Error?j.message:"Failed to load trial"}):h?e.jsx(ds,{}):c?e.jsx(ls,{trial:c,jobName:n,trialName:s}):null]})});export{gs as default};
