import{x as ne,v as oe,b as i,t as e}from"./index-C6J4Pqq0.js";import{u as le,t as E,l as ie}from"./index-DDT61vXN.js";import{c as ce,u as M,B as de,a as he,b as ue,d as me,e as xe,f as ge,g as pe,h as je,i as fe}from"./api-Cbkug5dl.js";import{u as ve,X as be,E as $,a as q,b as O,c as B,d as Ne}from"./empty-Bq79pVAD.js";import{u as b,p as S,a as N,T as ye,I as we,S as L,C as F}from"./input-DA0UiS7g.js";import{u as Se,d as Ce,a as De,K as y,D as Pe,c as _e,P as Fe,b as Te,e as c,f as ke,g as C,h as R,i as Ee,S as h}from"./hooks-DRsDoT6m.js";import"./mutation-CzWEsub0.js";import"./compare-Br3z3FUS-D05ZBVBy.js";const Me=[["path",{d:"m6 14 1.5-2.9A2 2 0 0 1 9.24 10H20a2 2 0 0 1 1.94 2.5l-1.54 6a2 2 0 0 1-1.95 1.5H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H18a2 2 0 0 1 2 2v2",key:"usdka0"}]],Ke=ce("folder-open",Me),K=100,Ie=[{value:"today",label:"Last 24 hours"},{value:"week",label:"Last 7 days"},{value:"month",label:"Last 30 days"}];function Ve(s,t){if(!s)return"-";const n=new Date(s).getTime(),D=(t?new Date(t).getTime():Date.now())-n,u=Math.floor(D/1e3),l=Math.floor(u/60),r=Math.floor(l/60);return r>0?`${r}h ${l%60}m`:l>0?`${l}m ${u%60}s`:`${u}s`}const Ae=[_e(),{accessorKey:"name",header:({column:s})=>e.jsx(h,{column:s,children:"Job Name"})},{accessorKey:"agents",header:({column:s})=>e.jsx(h,{column:s,children:"Agents"}),sortingFn:(s,t)=>{const n=s.original.agents[0]??"",o=t.original.agents[0]??"";return n.localeCompare(o)},cell:({row:s})=>{const t=s.original.agents;return t.length===0?e.jsx("span",{className:"text-muted-foreground",children:"-"}):t.length===1?e.jsx("span",{className:"text-sm",children:t[0]}):e.jsxs("span",{className:"text-sm",title:t.join(", "),children:[t[0]," ",e.jsxs("span",{className:"text-muted-foreground",children:["+",t.length-1," more"]})]})}},{accessorKey:"providers",header:({column:s})=>e.jsx(h,{column:s,children:"Providers"}),sortingFn:(s,t)=>{const n=s.original.providers[0]??"",o=t.original.providers[0]??"";return n.localeCompare(o)},cell:({row:s})=>{const t=s.original.providers;return t.length===0?e.jsx("span",{className:"text-muted-foreground",children:"-"}):t.length===1?e.jsx("span",{className:"text-sm",children:t[0]}):e.jsxs("span",{className:"text-sm",title:t.join(", "),children:[t[0]," ",e.jsxs("span",{className:"text-muted-foreground",children:["+",t.length-1," more"]})]})}},{accessorKey:"models",header:({column:s})=>e.jsx(h,{column:s,children:"Models"}),sortingFn:(s,t)=>{const n=s.original.models[0]??"",o=t.original.models[0]??"";return n.localeCompare(o)},cell:({row:s})=>{const t=s.original.models;return t.length===0?e.jsx("span",{className:"text-muted-foreground",children:"-"}):t.length===1?e.jsx("span",{className:"text-sm",children:t[0]}):e.jsxs("span",{className:"text-sm",title:t.join(", "),children:[t[0]," ",e.jsxs("span",{className:"text-muted-foreground",children:["+",t.length-1," more"]})]})}},{accessorKey:"started_at",header:({column:s})=>e.jsx(h,{column:s,children:"Started"}),cell:({row:s})=>{const t=s.original.started_at;return t?new Date(t).toLocaleString(void 0,{dateStyle:"short",timeStyle:"short"}):"-"}},{id:"duration",header:({column:s})=>e.jsx(h,{column:s,children:"Duration"}),accessorFn:s=>!s.started_at||!s.finished_at?0:new Date(s.finished_at).getTime()-new Date(s.started_at).getTime(),cell:({row:s})=>{const{started_at:t,finished_at:n}=s.original;return!t||!n?"-":Ve(t,n)}},{accessorKey:"n_total_trials",header:({column:s})=>e.jsx("div",{className:"text-right",children:e.jsx(h,{column:s,children:"Trials"})}),cell:({row:s})=>{const t=s.original.n_total_trials,n=s.original.n_completed_trials;return e.jsxs("div",{className:"text-right",children:[n,"/",t]})}},{accessorKey:"n_errors",header:({column:s})=>e.jsx("div",{className:"text-right",children:e.jsx(h,{column:s,children:"Errors"})}),cell:({row:s})=>{const t=s.original.n_errors;return e.jsx("div",{className:"text-right",children:t})}}],Qe=ne(function(){const t=oe(),n=le(),[o,D]=b("selected",S(N).withDefault([])),[u,l]=i.useState(!1),[r,m]=i.useState(1),[T,I]=b("q",N.withDefault("")),[x,H]=b("agent",S(N).withDefault([])),[g,Q]=b("provider",S(N).withDefault([])),[p,z]=b("model",S(N).withDefault([])),[j,G]=b("date",S(N).withDefault([])),P=Se(T,300);i.useEffect(()=>{m(1)},[P,x,g,p,j]);const{data:f}=M({queryKey:["jobFilters"],queryFn:pe,staleTime:6e4}),{data:X}=M({queryKey:["config"],queryFn:je,staleTime:1/0}),Z=i.useMemo(()=>(f?.agents??[]).map(a=>({value:a.value,label:a.value,count:a.count})),[f?.agents]),U=i.useMemo(()=>(f?.providers??[]).map(a=>({value:a.value,label:a.value,count:a.count})),[f?.providers]),W=i.useMemo(()=>(f?.models??[]).map(a=>({value:a.value,label:a.value,count:a.count})),[f?.models]),{data:k,isLoading:Y}=M({queryKey:["jobs",r,P,x,g,p,j],queryFn:()=>fe(r,K,{search:P||void 0,agents:x.length>0?x:void 0,providers:g.length>0?g:void 0,models:p.length>0?p:void 0,dates:j.length>0?j:void 0}),placeholderData:ie}),_=k?.items??[],d=k?.total_pages??0,V=k?.total??0,A=i.useRef(null);Ce("mod+k",a=>{a.preventDefault(),A.current?.focus()},{enableOnFormTags:!0});const{highlightedIndex:ee}=De({rows:_,onNavigate:a=>t(`/jobs/${a.name}`)}),se=i.useMemo(()=>{const a={};for(const v of o)a[v]=!0;return a},[o]),w=i.useMemo(()=>_.filter(a=>o.includes(a.name)),[_,o]),te=a=>{const v=Object.keys(a).filter(re=>a[re]);D(v.length>0?v:null)},J=ve({mutationFn:async a=>{await Promise.all(a.map(v=>ge(v)))},onSuccess:()=>{n.invalidateQueries({queryKey:["jobs"]}),E("Jobs deleted",{description:`${w.length} job(s) deleted`}),D(null),l(!1)},onError:a=>{E.error("Failed to delete jobs",{description:a.message}),l(!1)}}),ae=()=>{u?J.mutate(w.map(a=>a.name)):l(!0)};return e.jsxs("div",{className:"container mx-auto py-10",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx(de,{className:"mb-4",children:e.jsx(he,{children:e.jsx(ue,{children:e.jsx(me,{children:"Jobs"})})})}),e.jsxs("div",{className:"flex items-end justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-4xl font-medium mb-2",children:"Jobs"}),e.jsx("p",{className:"text-muted-foreground",children:"Browse and inspect Harbor jobs"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3 text-xs text-muted-foreground",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(y,{children:"j"}),e.jsx(y,{children:"k"}),e.jsx("span",{children:"to navigate"})]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(y,{children:"Enter"}),e.jsx("span",{children:"to open"})]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(y,{children:"Esc"}),e.jsx("span",{children:"to deselect"})]})]}),w.length>0&&e.jsxs(xe,{variant:u?"destructive":"secondary",onClick:ae,onBlur:()=>l(!1),disabled:J.isPending,children:[e.jsx(ye,{className:"h-4 w-4"}),u?`Confirm delete (${w.length})`:`Delete (${w.length})`]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-6 -mb-px",children:[e.jsxs("div",{className:"col-span-2 relative",children:[e.jsx(we,{ref:A,placeholder:"Search for jobs...",value:T,onChange:a=>I(a.target.value||null),size:"lg",variant:"card",className:"peer pl-9 pr-16 shadow-none"}),e.jsx(L,{className:"pointer-events-none absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-border transition-colors peer-focus-visible:text-ring"}),T?e.jsx("button",{type:"button",onClick:()=>I(null),className:"absolute right-3 top-1/2 -translate-y-1/2 text-muted-foreground hover:text-foreground transition-colors",children:e.jsx(be,{className:"h-4 w-4"})}):e.jsxs("div",{className:"pointer-events-none absolute right-3 top-1/2 -translate-y-1/2 flex items-center gap-0.5",children:[e.jsx(y,{children:"âŒ˜"}),e.jsx(y,{children:"K"})]})]}),e.jsx(F,{options:Z,value:x,onValueChange:H,placeholder:"All agents",searchPlaceholder:"Search agents...",emptyText:"No agents found.",variant:"card",className:"w-full border-l-0 shadow-none"}),e.jsx(F,{options:U,value:g,onValueChange:Q,placeholder:"All providers",searchPlaceholder:"Search providers...",emptyText:"No providers found.",variant:"card",className:"w-full border-l-0 shadow-none"}),e.jsx(F,{options:W,value:p,onValueChange:z,placeholder:"All models",searchPlaceholder:"Search models...",emptyText:"No models found.",variant:"card",className:"w-full border-l-0 shadow-none"}),e.jsx(F,{options:Ie,value:j,onValueChange:G,placeholder:"All time",searchPlaceholder:"Search...",emptyText:"No options.",variant:"card",className:"w-full border-l-0 shadow-none"})]}),e.jsx(Pe,{columns:Ae,data:_,onRowClick:a=>t(`/jobs/${a.name}`),enableRowSelection:!0,rowSelection:se,onRowSelectionChange:te,getRowId:a=>a.name,isLoading:Y,className:"border-t-0",highlightedIndex:ee,emptyState:P||x.length>0||g.length>0||p.length>0||j.length>0?e.jsx($,{className:"border-0",children:e.jsxs(q,{children:[e.jsx(O,{variant:"icon",children:e.jsx(L,{})}),e.jsx(B,{children:"No jobs match those filters"})]})}):e.jsx($,{className:"border-0",children:e.jsxs(q,{children:[e.jsx(O,{variant:"icon",children:e.jsx(Ke,{})}),e.jsxs(B,{children:["No jobs in ",X?.jobs_dir??"jobs directory"]}),e.jsxs(Ne,{children:["Start a job using"," ",e.jsx("code",{className:"bg-muted px-1 py-0.5 cursor-default hover:bg-ring/20 hover:text-foreground transition-colors",onClick:()=>{navigator.clipboard.writeText("harbor run -d <dataset>"),E("Copied to clipboard")},children:"harbor run -d <dataset>"})]})]})})}),d>1&&e.jsxs("div",{className:"grid grid-cols-3 items-center mt-4",children:[e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Showing ",(r-1)*K+1,"-",Math.min(r*K,V)," of ",V," jobs"]}),e.jsx(Fe,{children:e.jsxs(Te,{children:[e.jsx(c,{children:e.jsx(ke,{onClick:()=>m(a=>Math.max(1,a-1)),className:r===1?"pointer-events-none opacity-50":"cursor-pointer"})}),r>2&&e.jsx(c,{children:e.jsx(C,{onClick:()=>m(1),className:"cursor-pointer",children:"1"})}),r>3&&e.jsx(c,{children:e.jsx(R,{})}),r>1&&e.jsx(c,{children:e.jsx(C,{onClick:()=>m(r-1),className:"cursor-pointer",children:r-1})}),e.jsx(c,{children:e.jsx(C,{isActive:!0,children:r})}),r<d&&e.jsx(c,{children:e.jsx(C,{onClick:()=>m(r+1),className:"cursor-pointer",children:r+1})}),r<d-2&&e.jsx(c,{children:e.jsx(R,{})}),r<d-1&&e.jsx(c,{children:e.jsx(C,{onClick:()=>m(d),className:"cursor-pointer",children:d})}),e.jsx(c,{children:e.jsx(Ee,{onClick:()=>m(a=>Math.min(d,a+1)),className:r===d?"pointer-events-none opacity-50":"cursor-pointer"})})]})}),e.jsx("div",{})]})]})});export{Qe as default};
