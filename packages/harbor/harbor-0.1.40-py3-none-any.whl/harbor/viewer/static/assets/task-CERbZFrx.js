import{x as E,A as F,w as q,v as H,t as e,B as w}from"./index-C6J4Pqq0.js";import{u as A,B as J,a as Q,b as R,j as P,k as B,d as G,A as O}from"./api-Cbkug5dl.js";import{C as V,B as S}from"./code-block-C1sg3uaS.js";import{a as W,K as f,D as X,P as Y,b as Z,e as g,f as ee,h as se,g as ne,i as te,S as b}from"./hooks-DRsDoT6m.js";import"./index-DDT61vXN.js";function ae({reward:s}){const n=Math.max(0,Math.min(1,s)),t=Math.round(n*100);return e.jsx(S,{variant:"outline",className:"tabular-nums border-transparent rounded-none",style:{backgroundColor:`color-mix(in oklab, var(--foreground) ${t}%, transparent)`,color:n>.5?"var(--background)":void 0},children:s.toFixed(2)})}function re(s,n){if(!s)return"-";const t=new Date(s).getTime(),r=(n?new Date(n).getTime():Date.now())-t,o=Math.floor(r/1e3),c=Math.floor(o/60),l=Math.floor(c/60);return l>0?`${l}h ${c%60}m`:c>0?`${c}m ${o%60}s`:`${o}s`}const oe=[{accessorKey:"name",header:({column:s})=>e.jsx(b,{column:s,children:"Trial"})},{id:"duration",accessorFn:s=>{if(!s.started_at)return null;const n=new Date(s.started_at).getTime();return(s.finished_at?new Date(s.finished_at).getTime():Date.now())-n},header:({column:s})=>e.jsx(b,{column:s,children:"Duration"}),cell:({row:s})=>{const{started_at:n,finished_at:t}=s.original,a=re(n,t);return!t&&n?e.jsxs("span",{className:"text-muted-foreground",children:[a,"..."]}):a}},{accessorKey:"started_at",header:({column:s})=>e.jsx(b,{column:s,children:"Started"}),cell:({row:s})=>{const n=s.original.started_at;return n?new Date(n).toLocaleString():"-"}},{accessorKey:"reward",header:({column:s})=>e.jsx("div",{className:"text-right",children:e.jsx(b,{column:s,children:"Reward"})}),cell:({row:s})=>{const n=s.original.reward,t=s.original.error_type;return t?e.jsx("div",{className:"text-right",children:e.jsx(S,{variant:"destructive",children:t})}):n===null?e.jsx("div",{className:"text-right text-muted-foreground",children:"-"}):e.jsx("div",{className:"text-right",children:e.jsx(ae,{reward:n})})}}];function U(s,n){const t=new URLSearchParams(s);return t.set("page",n.toString()),`?${t.toString()}`}function ie(s,n,t,a){const r=["harbor run"];return n&&r.push(`-d ${n}`),r.push(`-t ${s}`),t&&r.push(`-a ${t}`),a&&r.push(`-m ${a}`),r.join(" ")}function ce(s,n){const t=[];if(n<=7)for(let a=1;a<=n;a++)t.push(a);else{t.push(1),s>3&&t.push("ellipsis");const a=Math.max(2,s-1),r=Math.min(n-1,s+1);for(let o=a;o<=r;o++)t.push(o);s<n-2&&t.push("ellipsis"),t.push(n)}return t}const ue=E(function(){const{jobName:n,taskName:t,source:a,agent:r,modelProvider:o,modelName:c}=F(),[l]=q(),_=H(),v=parseInt(l.get("page")||"1",10),$=parseInt(l.get("pageSize")||"100",10),h=a==="_"?void 0:a,m=r==="_"?void 0:r,N=o==="_"?void 0:o,C=c==="_"?void 0:c,x=N?C?`${N}/${C}`:N:C,{data:u,isLoading:D}=A({queryKey:["trials",n,t,v,$,h,m,x],queryFn:()=>O(n,v,$,{taskName:t,source:h,agentName:m,modelName:x}),enabled:!!n&&!!t}),y=u?.items??[],I=u?.total??0,i=u?.page??v,k=u?.page_size??$,p=u?.total_pages??0,M=I>0?(i-1)*k+1:0,T=Math.min(i*k,I),K=ce(i,p),{highlightedIndex:L}=W({rows:y,onNavigate:d=>_(`/jobs/${encodeURIComponent(n)}/tasks/${encodeURIComponent(a)}/${encodeURIComponent(r)}/${encodeURIComponent(o)}/${encodeURIComponent(c)}/${encodeURIComponent(t)}/trials/${encodeURIComponent(d.name)}`)}),j=[];return m&&j.push(x?`${m} (${x})`:m),h&&j.push(h),e.jsxs("div",{className:"container mx-auto py-10",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx(J,{className:"mb-4",children:e.jsxs(Q,{children:[e.jsx(R,{children:e.jsx(P,{asChild:!0,children:e.jsx(w,{to:"/",children:"Jobs"})})}),e.jsx(B,{}),e.jsx(R,{children:e.jsx(P,{asChild:!0,children:e.jsx(w,{to:`/jobs/${encodeURIComponent(n)}`,children:n})})}),e.jsx(B,{}),e.jsx(R,{children:e.jsx(G,{children:t})})]})}),e.jsxs("div",{className:"flex items-end justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-4xl font-medium mb-2",children:t}),j.length>0&&e.jsx("div",{className:"text-sm text-muted-foreground",children:j.join(" / ")})]}),e.jsxs("div",{className:"flex items-center gap-3 text-xs text-muted-foreground",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(f,{children:"j"}),e.jsx(f,{children:"k"}),e.jsx("span",{children:"to navigate"})]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(f,{children:"Enter"}),e.jsx("span",{children:"to open"})]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(f,{children:"Esc"}),e.jsx("span",{children:"to deselect"})]})]})]})]}),e.jsx(V,{code:ie(t,h,m,x),lang:"bash",className:"-mb-px"}),e.jsx(X,{columns:oe,data:y,onRowClick:d=>_(`/jobs/${encodeURIComponent(n)}/tasks/${encodeURIComponent(a)}/${encodeURIComponent(r)}/${encodeURIComponent(o)}/${encodeURIComponent(c)}/${encodeURIComponent(t)}/trials/${encodeURIComponent(d.name)}`),isLoading:D,highlightedIndex:L}),p>1&&e.jsxs("div",{className:"flex items-center mt-4",children:[e.jsxs("div",{className:"flex-1 text-sm text-muted-foreground",children:["Showing ",M,"-",T," of ",I," trials"]}),e.jsx(Y,{className:"flex-1 justify-center",children:e.jsxs(Z,{children:[e.jsx(g,{children:e.jsx(ee,{href:i>1?U(l,i-1):"#","aria-disabled":i<=1,className:i<=1?"pointer-events-none opacity-50":""})}),K.map((d,z)=>d==="ellipsis"?e.jsx(g,{children:e.jsx(se,{})},`ellipsis-${z}`):e.jsx(g,{children:e.jsx(ne,{href:U(l,d),isActive:d===i,children:d})},d)),e.jsx(g,{children:e.jsx(te,{href:i<p?U(l,i+1):"#","aria-disabled":i>=p,className:i>=p?"pointer-events-none opacity-50":""})})]})}),e.jsx("div",{className:"flex-1"})]})]})});export{ue as default};
