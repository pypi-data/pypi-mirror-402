import{x as me,A as he,v as xe,b as n,t as e,B as je}from"./index-C6J4Pqq0.js";import{u as _,B as ge,a as pe,b as U,j as ve,k as be,d as fe,e as R,f as ye,s as Ne,L as Ce,l as ke,m as Se,n as we,o as Te}from"./api-Cbkug5dl.js";import{u as G,t as w,l as _e}from"./index-DDT61vXN.js";import{u as H,X as De,E as Fe,a as Pe,b as Ke,c as Ee,d as Me}from"./empty-Bq79pVAD.js";import{u as C,a as k,p as D,T as Ie,I as W,S as Re,C as F}from"./input-DA0UiS7g.js";import{d as Ae,u as Be,a as Le,K as b,D as qe,P as Oe,b as Ve,e as c,f as Ue,g as S,h as J,i as Je,S as x,C as Qe}from"./hooks-DRsDoT6m.js";import{C as $e,B as ze}from"./code-block-C1sg3uaS.js";import{T as Ge,a as He,b as Q,c as $,F as We,D as Xe,d as Ze,e as Ye,f as es,g as ss,h as as,L as E,S as rs,i as ts,j as ns,k as ls,l as M}from"./tabs-D1aTDsf_.js";import"./mutation-CzWEsub0.js";import"./compare-Br3z3FUS-D05ZBVBy.js";function os({value:s}){const a=async()=>{await navigator.clipboard.writeText(s),w("Copied to clipboard",{description:s})};return e.jsx("span",{onClick:a,className:"cursor-default hover:text-foreground transition-colors",children:s})}function is({jobName:s}){const a=G(),[l,p]=n.useState(!1),[d,j]=n.useState("haiku"),[t,o]=n.useState(32),[v,T]=n.useState(!0),i=H({mutationFn:()=>Ne(s,d,t,v),onSuccess:()=>{a.invalidateQueries({queryKey:["job-summary",s]}),p(!1),w.success("Summary generated")},onError:g=>{w.error("Failed to generate summary",{description:g.message})}});return e.jsxs(Xe,{open:l,onOpenChange:p,children:[e.jsx(Ze,{asChild:!0,children:e.jsx(R,{children:"Generate Summary"})}),e.jsxs(Ye,{children:[e.jsxs(es,{children:[e.jsx(ss,{children:"Generate Summary"}),e.jsx(as,{children:"Use Claude to analyze all failing trials and generate a summary. This can take a couple minutes."})]}),e.jsxs("div",{className:"space-y-4 pt-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{htmlFor:"model",children:"Model"}),e.jsxs(rs,{value:d,onValueChange:j,children:[e.jsx(ts,{id:"model",children:e.jsx(ns,{})}),e.jsxs(ls,{children:[e.jsx(M,{value:"haiku",children:"Haiku (Recommended)"}),e.jsx(M,{value:"sonnet",children:"Sonnet"}),e.jsx(M,{value:"opus",children:"Opus"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{htmlFor:"n-concurrent",children:"Concurrent Claude Codes"}),e.jsx(W,{id:"n-concurrent",type:"number",min:1,max:100,value:t,onChange:g=>o(parseInt(g.target.value)||1)})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Qe,{id:"only-failed",checked:v,onCheckedChange:g=>T(g===!0)}),e.jsx(E,{htmlFor:"only-failed",className:"font-normal",children:"Only analyze failed trials"})]}),e.jsx(R,{className:"w-full",onClick:()=>i.mutate(),disabled:i.isPending,children:i.isPending?e.jsx(Ce,{text:"Generating"}):"Generate"})]})]})]})}function cs({reward:s}){const a=Math.max(0,Math.min(1,s)),l=Math.round(a*100);return e.jsx(ze,{variant:"outline",className:"tabular-nums border-transparent rounded-none",style:{backgroundColor:`color-mix(in oklab, var(--foreground) ${l}%, transparent)`,color:a>.5?"var(--background)":void 0},children:s.toFixed(2)})}function z(s,a){const l=s.source||"_",p=s.agent_name||"_",d=s.model_provider||"_",j=s.model_name||"_";return`/jobs/${encodeURIComponent(a)}/tasks/${encodeURIComponent(l)}/${encodeURIComponent(p)}/${encodeURIComponent(d)}/${encodeURIComponent(j)}/${encodeURIComponent(s.task_name)}`}const ds=[{accessorKey:"task_name",header:({column:s})=>e.jsx(x,{column:s,children:"Task"})},{accessorKey:"agent_name",header:({column:s})=>e.jsx(x,{column:s,children:"Agent"}),cell:({row:s})=>s.original.agent_name||"-"},{accessorKey:"model_provider",header:({column:s})=>e.jsx(x,{column:s,children:"Provider"}),cell:({row:s})=>s.original.model_provider||"-"},{accessorKey:"model_name",header:({column:s})=>e.jsx(x,{column:s,children:"Model"}),cell:({row:s})=>s.original.model_name||"-"},{accessorKey:"source",header:({column:s})=>e.jsx(x,{column:s,children:"Dataset"}),cell:({row:s})=>s.original.source||"-"},{accessorKey:"n_trials",header:({column:s})=>e.jsx("div",{className:"text-right",children:e.jsx(x,{column:s,children:"Trials"})}),cell:({row:s})=>{const{n_trials:a,n_completed:l}=s.original;return l<a?e.jsxs("div",{className:"text-right",children:[l,"/",a]}):e.jsx("div",{className:"text-right",children:a})}},{accessorKey:"n_errors",header:({column:s})=>e.jsx("div",{className:"text-right",children:e.jsx(x,{column:s,children:"Errors"})}),cell:({row:s})=>{const a=s.original.n_errors;return e.jsx("div",{className:"text-right",children:a})}},{accessorKey:"avg_reward",header:({column:s})=>e.jsx("div",{className:"text-right",children:e.jsx(x,{column:s,children:"Avg Reward"})}),cell:({row:s})=>{const a=s.original.avg_reward;return a===null?e.jsx("div",{className:"text-right text-muted-foreground",children:"-"}):e.jsx("div",{className:"text-right",children:e.jsx(cs,{reward:a})})}}],I=100,ys=me(function(){const{jobName:a}=he(),l=xe(),p=G(),[d,j]=n.useState(!1),[t,o]=n.useState(1),[v,T]=C("q",k.withDefault("")),[i,g]=C("agent",D(k).withDefault([])),[f,X]=C("provider",D(k).withDefault([])),[y,Z]=C("model",D(k).withDefault([])),[N,Y]=C("task",D(k).withDefault([])),A=n.useRef(null);Ae("mod+k",r=>{r.preventDefault(),A.current?.focus()},{enableOnFormTags:!0});const P=Be(v,300);n.useEffect(()=>{o(1)},[P,i,f,y,N]);const{data:u,isLoading:ee}=_({queryKey:["job",a],queryFn:()=>ke(a),enabled:!!a}),{data:m}=_({queryKey:["task-filters",a],queryFn:()=>Se(a),enabled:!!a,staleTime:6e4}),se=n.useMemo(()=>(m?.agents??[]).map(r=>({value:r.value,label:r.value,count:r.count})),[m?.agents]),ae=n.useMemo(()=>(m?.providers??[]).map(r=>({value:r.value,label:r.value,count:r.count})),[m?.providers]),re=n.useMemo(()=>(m?.models??[]).map(r=>({value:r.value,label:r.value,count:r.count})),[m?.models]),te=n.useMemo(()=>(m?.tasks??[]).map(r=>({value:r.value,label:r.value,count:r.count})),[m?.tasks]),{data:K,isLoading:ne}=_({queryKey:["tasks",a,t,P,i,f,y,N],queryFn:()=>we(a,t,I,{search:P||void 0,agents:i.length>0?i:void 0,providers:f.length>0?f:void 0,models:y.length>0?y:void 0,tasks:N.length>0?N:void 0}),enabled:!!a,placeholderData:_e}),B=K?.items??[],h=K?.total_pages??0,L=K?.total??0,[q,le]=n.useState("results"),{highlightedIndex:oe}=Le({rows:B,onNavigate:r=>l(z(r,a)),enabled:q==="results"}),{data:O}=_({queryKey:["job-summary",a],queryFn:()=>Te(a),enabled:!!a}),V=H({mutationFn:()=>ye(a),onSuccess:()=>{p.invalidateQueries({queryKey:["jobs"]}),w("Job deleted",{description:a}),l("/")},onError:r=>{w.error("Failed to delete job",{description:r.message}),j(!1)}}),ie=()=>{d?V.mutate():j(!0)};if(!ee&&!u)return e.jsx("div",{className:"container mx-auto py-10",children:e.jsx("div",{className:"text-destructive",children:"Failed to load job"})});const ce=u?.stats.n_trials??0,de=u?.n_total_trials??0,ue=u?.stats.n_errors??0;return e.jsxs("div",{className:"container mx-auto py-10",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx(ge,{className:"mb-4",children:e.jsxs(pe,{children:[e.jsx(U,{children:e.jsx(ve,{asChild:!0,children:e.jsx(je,{to:"/",children:"Jobs"})})}),e.jsx(be,{}),e.jsx(U,{children:e.jsx(fe,{children:a})})]})}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-4xl font-medium",children:a}),e.jsxs(R,{variant:d?"destructive":"secondary",onClick:ie,onBlur:()=>j(!1),disabled:V.isPending,children:[e.jsx(Ie,{className:"h-4 w-4"}),d?"Confirm delete":"Delete"]})]}),e.jsxs("div",{className:"flex gap-2 text-sm text-muted-foreground mt-2",children:[e.jsxs("span",{children:[ce,"/",de," trials completed"]}),e.jsx("span",{className:"text-border",children:"|"}),e.jsxs("span",{children:[ue," errors"]})]}),u?.job_uri&&e.jsx("div",{className:"text-xs text-muted-foreground mt-3",children:e.jsx(os,{value:u.job_uri.startsWith("file://")?u.job_uri.slice(7):u.job_uri})})]}),e.jsxs(Ge,{value:q,onValueChange:le,className:"mt-6",children:[e.jsxs("div",{className:"flex items-center justify-between bg-card border border-b-0",children:[e.jsxs(He,{className:"border-0",children:[e.jsx(Q,{value:"results",children:"Results"}),e.jsx(Q,{value:"summary",children:"Summary"})]}),e.jsxs("div",{className:"flex items-center gap-3 px-3 text-xs text-muted-foreground",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(b,{children:"j"}),e.jsx(b,{children:"k"}),e.jsx("span",{children:"to navigate"})]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(b,{children:"Enter"}),e.jsx("span",{children:"to open"})]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(b,{children:"Esc"}),e.jsx("span",{children:"to deselect"})]})]})]}),e.jsxs($,{value:"results",children:[e.jsxs("div",{className:"grid grid-cols-6 -mb-px",children:[e.jsxs("div",{className:"col-span-2 relative",children:[e.jsx(W,{ref:A,placeholder:"Search for tasks...",value:v,onChange:r=>T(r.target.value||null),size:"lg",variant:"card",className:"peer pl-9 pr-16 shadow-none"}),e.jsx(Re,{className:"pointer-events-none absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-border transition-colors peer-focus-visible:text-ring"}),v?e.jsx("button",{type:"button",onClick:()=>T(null),className:"absolute right-3 top-1/2 -translate-y-1/2 text-muted-foreground hover:text-foreground transition-colors",children:e.jsx(De,{className:"h-4 w-4"})}):e.jsxs("div",{className:"pointer-events-none absolute right-3 top-1/2 -translate-y-1/2 flex items-center gap-0.5",children:[e.jsx(b,{children:"âŒ˜"}),e.jsx(b,{children:"K"})]})]}),e.jsx(F,{options:se,value:i,onValueChange:g,placeholder:"All agents",searchPlaceholder:"Search agents...",emptyText:"No agents found.",variant:"card",className:"w-full border-l-0 shadow-none"}),e.jsx(F,{options:ae,value:f,onValueChange:X,placeholder:"All providers",searchPlaceholder:"Search providers...",emptyText:"No providers found.",variant:"card",className:"w-full border-l-0 shadow-none"}),e.jsx(F,{options:re,value:y,onValueChange:Z,placeholder:"All models",searchPlaceholder:"Search models...",emptyText:"No models found.",variant:"card",className:"w-full border-l-0 shadow-none"}),e.jsx(F,{options:te,value:N,onValueChange:Y,placeholder:"All tasks",searchPlaceholder:"Search tasks...",emptyText:"No tasks found.",variant:"card",className:"w-full border-l-0 shadow-none"})]}),e.jsx(qe,{columns:ds,data:B,onRowClick:r=>l(z(r,a)),isLoading:ne,className:"border-t-0",highlightedIndex:oe}),h>1&&e.jsxs("div",{className:"grid grid-cols-3 items-center mt-4",children:[e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Showing ",(t-1)*I+1,"-",Math.min(t*I,L)," of ",L," tasks"]}),e.jsx(Oe,{children:e.jsxs(Ve,{children:[e.jsx(c,{children:e.jsx(Ue,{onClick:()=>o(r=>Math.max(1,r-1)),className:t===1?"pointer-events-none opacity-50":"cursor-pointer"})}),t>2&&e.jsx(c,{children:e.jsx(S,{onClick:()=>o(1),className:"cursor-pointer",children:"1"})}),t>3&&e.jsx(c,{children:e.jsx(J,{})}),t>1&&e.jsx(c,{children:e.jsx(S,{onClick:()=>o(t-1),className:"cursor-pointer",children:t-1})}),e.jsx(c,{children:e.jsx(S,{isActive:!0,children:t})}),t<h&&e.jsx(c,{children:e.jsx(S,{onClick:()=>o(t+1),className:"cursor-pointer",children:t+1})}),t<h-2&&e.jsx(c,{children:e.jsx(J,{})}),t<h-1&&e.jsx(c,{children:e.jsx(S,{onClick:()=>o(h),className:"cursor-pointer",children:h})}),e.jsx(c,{children:e.jsx(Je,{onClick:()=>o(r=>Math.min(h,r+1)),className:t===h?"pointer-events-none opacity-50":"cursor-pointer"})})]})}),e.jsx("div",{})]})]}),e.jsx($,{value:"summary",children:O?.summary?e.jsx($e,{code:O.summary,lang:"markdown",wrap:!0}):e.jsxs(Fe,{className:"bg-card border",children:[e.jsxs(Pe,{children:[e.jsx(Ke,{variant:"icon",children:e.jsx(We,{})}),e.jsx(Ee,{children:"No summary"}),e.jsx(Me,{children:"Generate a summary of all trials in this job using Claude."})]}),e.jsx(is,{jobName:a})]})})]})]})});export{ys as default};
