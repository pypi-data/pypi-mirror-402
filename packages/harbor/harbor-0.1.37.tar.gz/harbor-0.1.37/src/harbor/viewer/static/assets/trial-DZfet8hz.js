import{b as g,t as e,R as y,x as Oe,B as Fe,C as J}from"./index-Dnn6g2C-.js";import{e as te,m as pe,l as ne,P as E,h as he,n as Ve,g as fe,j as He,p as P,u as S,B as Be,a as qe,b as O,r as Q,s as Y,c as Ue,D as je,E as ze,F as ge,G as Ke}from"./api-jJhccEct.js";import{t as se}from"./index-Cq-h8E2r.js";import{u as ve,c as We,C as Ge,T as oe,a as re,b as I,d as T,E as V,e as H,f as B,g as q,h as U,F as Je}from"./tabs-CiO_rjxh.js";import{a as Qe,C as w,B as me}from"./code-block-BIa9jDUN.js";const Ye=[["circle",{cx:"6",cy:"19",r:"3",key:"1kj8tv"}],["path",{d:"M9 19h8.5a3.5 3.5 0 0 0 0-7h-11a3.5 3.5 0 0 1 0-7H15",key:"1d8sl"}],["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}]],Xe=te("route",Ye);const Ze=[["path",{d:"M15 12h-5",key:"r7krc0"}],["path",{d:"M15 8h-5",key:"1khuty"}],["path",{d:"M19 17V5a2 2 0 0 0-2-2H4",key:"zz82l3"}],["path",{d:"M8 21h12a2 2 0 0 0 2-2v-1a1 1 0 0 0-1-1H11a1 1 0 0 0-1 1v1a2 2 0 1 1-4 0V5a2 2 0 1 0-4 0v2a1 1 0 0 0 1 1h3",key:"1ph1d7"}]],et=te("scroll-text",Ze);const tt=[["path",{d:"M12 19h8",key:"baeox8"}],["path",{d:"m4 17 6-6-6-6",key:"1yngyt"}]],nt=te("terminal",tt);var z="Collapsible",[st,be]=pe(z),[ot,ae]=st(z),Ne=g.forwardRef((t,s)=>{const{__scopeCollapsible:n,open:o,defaultOpen:c,disabled:r,onOpenChange:a,...u}=t,[x,m]=ne({prop:o,defaultProp:c??!1,onChange:a,caller:z});return e.jsx(ot,{scope:n,disabled:r,contentId:ve(),open:x,onOpenToggle:g.useCallback(()=>m(p=>!p),[m]),children:e.jsx(E.div,{"data-state":ie(x),"data-disabled":r?"":void 0,...u,ref:s})})});Ne.displayName=z;var ye="CollapsibleTrigger",Ce=g.forwardRef((t,s)=>{const{__scopeCollapsible:n,...o}=t,c=ae(ye,n);return e.jsx(E.button,{type:"button","aria-controls":c.contentId,"aria-expanded":c.open||!1,"data-state":ie(c.open),"data-disabled":c.disabled?"":void 0,disabled:c.disabled,...o,ref:s,onClick:he(t.onClick,c.onOpenToggle)})});Ce.displayName=ye;var ce="CollapsibleContent",_e=g.forwardRef((t,s)=>{const{forceMount:n,...o}=t,c=ae(ce,t.__scopeCollapsible);return e.jsx(Ve,{present:n||c.open,children:({present:r})=>e.jsx(rt,{...o,ref:s,present:r})})});_e.displayName=ce;var rt=g.forwardRef((t,s)=>{const{__scopeCollapsible:n,present:o,children:c,...r}=t,a=ae(ce,n),[u,x]=g.useState(o),m=g.useRef(null),p=fe(s,m),j=g.useRef(0),h=j.current,f=g.useRef(0),v=f.current,b=a.open||u,d=g.useRef(b),i=g.useRef(void 0);return g.useEffect(()=>{const l=requestAnimationFrame(()=>d.current=!1);return()=>cancelAnimationFrame(l)},[]),He(()=>{const l=m.current;if(l){i.current=i.current||{transitionDuration:l.style.transitionDuration,animationName:l.style.animationName},l.style.transitionDuration="0s",l.style.animationName="none";const N=l.getBoundingClientRect();j.current=N.height,f.current=N.width,d.current||(l.style.transitionDuration=i.current.transitionDuration,l.style.animationName=i.current.animationName),x(o)}},[a.open,o]),e.jsx(E.div,{"data-state":ie(a.open),"data-disabled":a.disabled?"":void 0,id:a.contentId,hidden:!b,...r,ref:p,style:{"--radix-collapsible-content-height":h?`${h}px`:void 0,"--radix-collapsible-content-width":v?`${v}px`:void 0,...t.style},children:b&&c})});function ie(t){return t?"open":"closed"}var at=Ne,ct=Ce,it=_e,C="Accordion",lt=["Home","End","ArrowDown","ArrowUp","ArrowLeft","ArrowRight"],[le,dt,ut]=We(C),[K]=pe(C,[ut,be]),de=be(),we=y.forwardRef((t,s)=>{const{type:n,...o}=t,c=o,r=o;return e.jsx(le.Provider,{scope:t.__scopeAccordion,children:n==="multiple"?e.jsx(ht,{...r,ref:s}):e.jsx(pt,{...c,ref:s})})});we.displayName=C;var[ke,mt]=K(C),[Ae,xt]=K(C,{collapsible:!1}),pt=y.forwardRef((t,s)=>{const{value:n,defaultValue:o,onValueChange:c=()=>{},collapsible:r=!1,...a}=t,[u,x]=ne({prop:n,defaultProp:o??"",onChange:c,caller:C});return e.jsx(ke,{scope:t.__scopeAccordion,value:y.useMemo(()=>u?[u]:[],[u]),onItemOpen:x,onItemClose:y.useCallback(()=>r&&x(""),[r,x]),children:e.jsx(Ae,{scope:t.__scopeAccordion,collapsible:r,children:e.jsx(Ie,{...a,ref:s})})})}),ht=y.forwardRef((t,s)=>{const{value:n,defaultValue:o,onValueChange:c=()=>{},...r}=t,[a,u]=ne({prop:n,defaultProp:o??[],onChange:c,caller:C}),x=y.useCallback(p=>u((j=[])=>[...j,p]),[u]),m=y.useCallback(p=>u((j=[])=>j.filter(h=>h!==p)),[u]);return e.jsx(ke,{scope:t.__scopeAccordion,value:a,onItemOpen:x,onItemClose:m,children:e.jsx(Ae,{scope:t.__scopeAccordion,collapsible:!0,children:e.jsx(Ie,{...r,ref:s})})})}),[ft,W]=K(C),Ie=y.forwardRef((t,s)=>{const{__scopeAccordion:n,disabled:o,dir:c,orientation:r="vertical",...a}=t,u=y.useRef(null),x=fe(u,s),m=dt(n),j=Qe(c)==="ltr",h=he(t.onKeyDown,f=>{if(!lt.includes(f.key))return;const v=f.target,b=m().filter(G=>!G.ref.current?.disabled),d=b.findIndex(G=>G.ref.current===v),i=b.length;if(d===-1)return;f.preventDefault();let l=d;const N=0,_=i-1,M=()=>{l=d+1,l>_&&(l=N)},D=()=>{l=d-1,l<N&&(l=_)};switch(f.key){case"Home":l=N;break;case"End":l=_;break;case"ArrowRight":r==="horizontal"&&(j?M():D());break;case"ArrowDown":r==="vertical"&&M();break;case"ArrowLeft":r==="horizontal"&&(j?D():M());break;case"ArrowUp":r==="vertical"&&D();break}const Ee=l%i;b[Ee].ref.current?.focus()});return e.jsx(ft,{scope:n,disabled:o,direction:c,orientation:r,children:e.jsx(le.Slot,{scope:n,children:e.jsx(E.div,{...a,"data-orientation":r,ref:x,onKeyDown:o?void 0:h})})})}),F="AccordionItem",[jt,ue]=K(F),Te=y.forwardRef((t,s)=>{const{__scopeAccordion:n,value:o,...c}=t,r=W(F,n),a=mt(F,n),u=de(n),x=ve(),m=o&&a.value.includes(o)||!1,p=r.disabled||t.disabled;return e.jsx(jt,{scope:n,open:m,disabled:p,triggerId:x,children:e.jsx(at,{"data-orientation":r.orientation,"data-state":De(m),...u,...c,ref:s,disabled:p,open:m,onOpenChange:j=>{j?a.onItemOpen(o):a.onItemClose(o)}})})});Te.displayName=F;var $e="AccordionHeader",Re=y.forwardRef((t,s)=>{const{__scopeAccordion:n,...o}=t,c=W(C,n),r=ue($e,n);return e.jsx(E.h3,{"data-orientation":c.orientation,"data-state":De(r.open),"data-disabled":r.disabled?"":void 0,...o,ref:s})});Re.displayName=$e;var Z="AccordionTrigger",Pe=y.forwardRef((t,s)=>{const{__scopeAccordion:n,...o}=t,c=W(C,n),r=ue(Z,n),a=xt(Z,n),u=de(n);return e.jsx(le.ItemSlot,{scope:n,children:e.jsx(ct,{"aria-disabled":r.open&&!a.collapsible||void 0,"data-orientation":c.orientation,id:r.triggerId,...u,...o,ref:s})})});Pe.displayName=Z;var Se="AccordionContent",Me=y.forwardRef((t,s)=>{const{__scopeAccordion:n,...o}=t,c=W(C,n),r=ue(Se,n),a=de(n);return e.jsx(it,{role:"region","aria-labelledby":r.triggerId,"data-orientation":c.orientation,...a,...o,ref:s,style:{"--radix-accordion-content-height":"var(--radix-collapsible-content-height)","--radix-accordion-content-width":"var(--radix-collapsible-content-width)",...t.style}})});Me.displayName=Se;function De(t){return t?"open":"closed"}var gt=we,vt=Te,bt=Re,Nt=Pe,yt=Me;function Ct({...t}){return e.jsx(gt,{"data-slot":"accordion",...t})}function _t({className:t,...s}){return e.jsx(vt,{"data-slot":"accordion-item",className:P("border-b last:border-b-0",t),...s})}function wt({className:t,children:s,...n}){return e.jsx(bt,{className:"flex min-w-0",children:e.jsxs(Nt,{"data-slot":"accordion-trigger",className:P("group focus-visible:border-ring focus-visible:ring-ring/50 flex flex-1 min-w-0 items-start justify-between gap-4 rounded-md py-4 text-left text-sm transition-all outline-none focus-visible:ring-[3px] disabled:pointer-events-none disabled:opacity-50 [&[data-state=open]>svg]:rotate-180",t),...n,children:[s,e.jsx(Ge,{className:"text-muted-foreground pointer-events-none size-4 shrink-0 translate-y-0.5 transition-transform duration-200"})]})})}function kt({className:t,children:s,...n}){return e.jsx(yt,{"data-slot":"accordion-content",className:"data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down overflow-hidden text-sm",...n,children:e.jsx("div",{className:P("pt-0 pb-4",t),children:s})})}function k({className:t,...s}){return e.jsx("div",{"data-slot":"card",className:P("bg-card text-card-foreground flex flex-col gap-6 border py-6",t),...s})}function $({className:t,...s}){return e.jsx("div",{"data-slot":"card-header",className:P("flex flex-col gap-1.5 px-6",t),...s})}function R({className:t,...s}){return e.jsx("div",{"data-slot":"card-title",className:P("leading-none font-semibold",t),...s})}function A({className:t,...s}){return e.jsx("div",{"data-slot":"card-content",className:P("px-6",t),...s})}function At(t){return t?new Date(t).toLocaleString():"-"}function Le(t,s){if(!t)return"-";const n=new Date(t).getTime(),c=(s?new Date(s).getTime():Date.now())-n,r=Math.floor(c/1e3),a=Math.floor(r/60),u=Math.floor(a/60);return u>0?`${u}h ${a%60}m ${r%60}s`:a>0?`${a}m ${r%60}s`:`${r}s`}function It(t){if(!t?.started_at)return 0;const s=new Date(t.started_at).getTime();return(t.finished_at?new Date(t.finished_at).getTime():Date.now())-s}function Tt({segments:t,totalLabel:s}){const[n,o]=g.useState(null),[c,r]=g.useState(0),a=t.reduce((d,i)=>d+i.value,0);if(a===0)return e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"h-8 bg-muted"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"No token data"})]});const u=1,x=t.map(d=>d.value>0?d.value/a*100:0),m=x.map(d=>d>0&&d<u),p=m.reduce((d,i,l)=>i?d+(u-x[l]):d,0),j=x.reduce((d,i,l)=>!m[l]&&i>0?d+i:d,0),h=j>0?(j-p)/j:1,f=x.map((d,i)=>d===0?0:m[i]?u:d*h),v=[];let b=0;for(let d=0;d<f.length;d++)v.push(b),b+=f[d];return e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"relative",children:[n!==null&&e.jsx("div",{className:"absolute bottom-full mb-2 z-10 -translate-x-1/2 pointer-events-none",style:{left:`${c}%`},children:e.jsxs("div",{className:"bg-popover border border-border rounded-md shadow-md px-3 py-2 whitespace-nowrap",children:[e.jsx("div",{className:"text-sm font-medium",children:t[n].label}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[t[n].value.toLocaleString()," tokens"]})]})}),e.jsx("div",{className:"flex h-8 overflow-hidden",children:t.map((d,i)=>{if(d.value===0)return null;const l=f[i],N=n!==null&&n!==i,_=v[i]+l/2;return e.jsx("div",{className:"transition-opacity duration-150",style:{width:`${l}%`,backgroundColor:d.color,opacity:N?.3:1},onMouseEnter:()=>{o(i),r(_)},onMouseLeave:()=>o(null)},d.label)})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex gap-4",children:t.map((d,i)=>{if(d.value===0)return null;const l=m[i];return e.jsxs("div",{className:"flex items-center gap-1.5 text-xs",children:[e.jsx("div",{className:"w-2.5 h-2.5 rounded-sm",style:{backgroundColor:d.color}}),e.jsxs("span",{className:"text-muted-foreground",children:[d.label,l&&" (scaled)"]})]},d.label)})}),e.jsx("div",{className:"text-xs text-muted-foreground",children:s})]})]})}function $t({phases:t,totalDuration:s}){const[n,o]=g.useState(null),[c,r]=g.useState(0),a=t.map(i=>It(i.timing)),u=a.reduce((i,l)=>i+l,0);if(u===0)return e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"h-8 bg-muted rounded"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"No timing data"})]});const x=1,m=a.map(i=>i>0?i/u*100:0),p=m.map(i=>i>0&&i<x),j=p.reduce((i,l,N)=>l?i+(x-m[N]):i,0),h=m.reduce((i,l,N)=>!p[N]&&l>0?i+l:i,0),f=h>0?(h-j)/h:1,v=m.map((i,l)=>i===0?0:p[l]?x:i*f),b=[];let d=0;for(let i=0;i<v.length;i++)b.push(d),d+=v[i];return e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"relative",children:[n!==null&&e.jsx("div",{className:"absolute bottom-full mb-2 z-10 -translate-x-1/2 pointer-events-none",style:{left:`${c}%`},children:e.jsxs("div",{className:"bg-popover border border-border rounded-md shadow-md px-3 py-2 whitespace-nowrap",children:[e.jsx("div",{className:"text-sm font-medium",children:t[n].label}),e.jsx("div",{className:"text-sm text-muted-foreground",children:Le(t[n].timing?.started_at??null,t[n].timing?.finished_at??null)})]})}),e.jsx("div",{className:"flex h-8 overflow-hidden",children:t.map((i,l)=>{if(a[l]===0)return null;const _=v[l],M=n!==null&&n!==l,D=b[l]+_/2;return e.jsx("div",{className:"transition-opacity duration-150",style:{width:`${_}%`,backgroundColor:i.color,opacity:M?.3:1},onMouseEnter:()=>{o(l),r(D)},onMouseLeave:()=>o(null)},i.label)})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex gap-4",children:t.map((i,l)=>{if(a[l]===0)return null;const _=p[l];return e.jsxs("div",{className:"flex items-center gap-1.5 text-xs",children:[e.jsx("div",{className:"w-2.5 h-2.5 rounded-sm",style:{backgroundColor:i.color}}),e.jsxs("span",{className:"text-muted-foreground",children:[i.label,_&&" (scaled)"]})]},i.label)})}),e.jsx("div",{className:"text-xs text-muted-foreground",children:s})]})]})}function X({label:t,value:s,className:n,showBorder:o=!0}){return e.jsxs("div",{className:`flex justify-between py-1 text-sm ${o?"border-b border-border last:border-0":""}`,children:[e.jsx("span",{className:"text-muted-foreground",children:t}),e.jsx("span",{className:n,children:s})]})}function xe(t,s){if(!t||!s)return null;const n=new Date(t).getTime(),c=new Date(s).getTime()-n;return c<0?null:ee(c)}function ee(t){const s=t/1e3;if(s<60)return`${s.toFixed(1)}s`;const n=Math.floor(s/60),o=s%60;return`${n}m ${o.toFixed(0)}s`}function Rt({step:t}){const n={agent:"text-purple-600 dark:text-purple-300"}.agent;return e.jsxs("div",{className:"space-y-3",children:[t.message&&e.jsx("div",{className:"text-sm whitespace-pre-wrap wrap-break-words",children:t.message}),t.reasoning_content&&e.jsxs("div",{children:[e.jsx("h5",{className:"text-xs font-medium text-muted-foreground mb-1",children:"Reasoning"}),e.jsx("pre",{className:"text-xs bg-muted p-2 overflow-x-auto whitespace-pre-wrap",children:t.reasoning_content})]}),t.tool_calls&&t.tool_calls.length>0&&e.jsxs("div",{children:[e.jsx("h5",{className:"text-xs font-medium text-muted-foreground mb-1",children:"Tool Calls"}),t.tool_calls.map(o=>e.jsxs("div",{className:"mb-2",children:[e.jsx("div",{className:`text-xs font-mono mb-1 ${n}`,children:o.function_name}),e.jsx(w,{code:JSON.stringify(o.arguments,null,2),lang:"json"})]},o.tool_call_id))]}),t.observation&&t.observation.results.length>0&&e.jsxs("div",{children:[e.jsx("h5",{className:"text-xs font-medium text-muted-foreground mb-1",children:"Observations"}),t.observation.results.map((o,c)=>e.jsx("div",{className:"mb-2",children:e.jsx(w,{code:o.content||"(empty)",lang:"text"})},c))]}),t.metrics&&e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Tokens: ",(t.metrics.prompt_tokens??0).toLocaleString()," prompt /"," ",(t.metrics.completion_tokens??0).toLocaleString()," completion",t.metrics.cost_usd&&` / $${t.metrics.cost_usd.toFixed(4)}`]})]})}function Pt({step:t,nextTimestamp:s,startTimestamp:n}){const o={system:"text-gray-600 dark:text-gray-300",user:"text-blue-600 dark:text-blue-300",agent:"text-purple-600 dark:text-purple-300"},c=xe(t.timestamp,s),r=xe(n,t.timestamp),a=t.message?.split(`
`)[0]||null;return e.jsxs("div",{className:"flex-1 min-w-0 flex items-start gap-4 overflow-hidden",children:[e.jsxs("div",{className:"flex-1 min-w-0 overflow-hidden",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsxs("span",{className:"text-xs text-muted-foreground",children:["#",t.step_id]}),e.jsx("span",{className:`text-xs font-medium ${o[t.source]}`,children:t.source}),t.model_name&&e.jsx("span",{className:"text-xs text-muted-foreground",children:t.model_name})]}),e.jsx("p",{className:"text-sm text-left truncate group-data-[state=open]:hidden",children:a||e.jsx("span",{className:"text-muted-foreground italic",children:"No message"})})]}),(r||c)&&e.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground shrink-0",children:[c&&e.jsxs(me,{variant:"secondary",className:"text-xs font-normal",children:["+",c]}),r&&e.jsx(me,{variant:"outline",className:"text-xs font-normal",children:r})]})]})}function St(t){const s=["var(--color-neutral-400)","var(--color-neutral-500)","var(--color-neutral-600)","var(--color-neutral-700)"],n=t%6,o=n<=3?n:6-n;return s[o]}function Mt({steps:t,onStepClick:s}){const[n,o]=g.useState(null),[c,r]=g.useState(0);if(t.length===0)return null;const a=t[0].timestamp?new Date(t[0].timestamp).getTime():0,u=t.map((h,f)=>{const v=h.timestamp?new Date(h.timestamp).getTime():0,b=f<t.length-1?t[f+1]:null,d=b?.timestamp?new Date(b.timestamp).getTime():v;return{stepId:h.step_id,durationMs:Math.max(0,d-v),elapsedMs:v-a}}),x=u.reduce((h,f)=>h+f.durationMs,0);if(x===0)return e.jsx("div",{className:"mb-4",children:e.jsx("div",{className:"h-6 bg-muted"})});const m=u.map(h=>h.durationMs/x*100),p=[];let j=0;for(const h of m)p.push(j),j+=h;return e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"relative",children:[n!==null&&e.jsx("div",{className:"absolute bottom-full mb-2 z-10 -translate-x-1/2 pointer-events-none",style:{left:`${c}%`},children:e.jsxs("div",{className:"bg-popover border border-border rounded-md shadow-md px-3 py-2 whitespace-nowrap",children:[e.jsxs("div",{className:"text-sm font-medium",children:["Step #",u[n].stepId]}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Duration: ",ee(u[n].durationMs)]}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Started at: ",ee(u[n].elapsedMs)]})]})}),e.jsx("div",{className:"flex h-6 overflow-hidden",children:u.map((h,f)=>{if(h.durationMs===0)return null;const v=m[f],b=n!==null&&n!==f,d=p[f]+v/2;return e.jsx("div",{className:"transition-opacity duration-150 cursor-pointer",style:{width:`${v}%`,backgroundColor:St(f),opacity:b?.3:1},onMouseEnter:()=>{o(f),r(d)},onMouseLeave:()=>o(null),onClick:()=>s(f)},h.stepId)})})]})})}function Dt({jobName:t,trialName:s}){const{data:n,isLoading:o}=S({queryKey:["trajectory",t,s],queryFn:()=>je(t,s)}),[c,r]=g.useState([]),a=g.useRef([]);if(o)return e.jsxs(k,{children:[e.jsx($,{children:e.jsx(R,{children:"Trajectory"})}),e.jsx(A,{children:e.jsx("div",{className:"text-sm text-muted-foreground",children:"Loading..."})})]});if(!n)return e.jsx(V,{className:"bg-card border",children:e.jsxs(H,{children:[e.jsx(B,{variant:"icon",children:e.jsx(Xe,{})}),e.jsx(q,{children:"No trajectory"}),e.jsxs(U,{children:["No ATIF trajectory found at ",s,"/agent/trajectory.json"]})]})});const u=x=>{const m=`step-${x}`;r(p=>p.includes(m)?p:[...p,m]),a.current[x]?.scrollIntoView({behavior:"smooth",block:"start"})};return e.jsxs(k,{children:[e.jsxs($,{children:[e.jsx(R,{children:"Trajectory"}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[n.steps.length," steps",n.final_metrics?.total_cost_usd&&e.jsxs(e.Fragment,{children:[" / $",n.final_metrics.total_cost_usd.toFixed(4)," total"]})]})]}),e.jsxs(A,{children:[e.jsx(Mt,{steps:n.steps,onStepClick:u}),e.jsx(Ct,{type:"multiple",value:c,onValueChange:r,children:n.steps.map((x,m)=>e.jsxs(_t,{value:`step-${m}`,ref:p=>{a.current[m]=p},children:[e.jsx(wt,{children:e.jsx(Pt,{step:x,nextTimestamp:m<n.steps.length-1?n.steps[m+1].timestamp:null,startTimestamp:n.steps[0]?.timestamp??null})}),e.jsx(kt,{children:e.jsx(Rt,{step:x})})]},x.step_id))})]})]})}function Lt({jobName:t,trialName:s}){const{data:n,isLoading:o}=S({queryKey:["verifier-output",t,s],queryFn:()=>ze(t,s)});if(o)return e.jsxs(k,{children:[e.jsx($,{children:e.jsx(R,{children:"Verifier Output"})}),e.jsx(A,{children:e.jsx("div",{className:"text-sm text-muted-foreground",children:"Loading..."})})]});const c=!!n?.stdout,r=!!n?.ctrf;return!c&&!r?e.jsx(V,{className:"bg-card border",children:e.jsxs(H,{children:[e.jsx(B,{variant:"icon",children:e.jsx(et,{})}),e.jsx(q,{children:"No verifier logs"}),e.jsx(U,{children:"No test output or CTRF results found"})]})}):c&&r?e.jsx(k,{className:"py-0 gap-0",children:e.jsx(A,{className:"p-0",children:e.jsxs(oe,{defaultValue:"stdout",children:[e.jsxs(re,{children:[e.jsx(I,{value:"stdout",children:"Output"}),e.jsx(I,{value:"ctrf",children:"CTRF"})]}),e.jsx(T,{value:"stdout",className:"mt-0 -mx-px",children:e.jsx(w,{code:n.stdout,lang:"text"})}),e.jsx(T,{value:"ctrf",className:"mt-0 -mx-px",children:e.jsx(w,{code:n.ctrf,lang:"json"})})]})})}):c?e.jsx(w,{code:n.stdout,lang:"text"}):e.jsx(w,{code:n.ctrf,lang:"json"})}function Et({jobName:t,trialName:s,jobPath:n}){const{data:o,isLoading:c}=S({queryKey:["agent-logs",t,s],queryFn:()=>ge(t,s)});return c?e.jsx("div",{className:"text-sm text-muted-foreground p-4",children:"Loading..."}):o?.summary?e.jsx(w,{code:o.summary,lang:"markdown",wrap:!0}):e.jsx(V,{className:"bg-card border",children:e.jsxs(H,{children:[e.jsx(B,{variant:"icon",children:e.jsx(Je,{})}),e.jsx(q,{children:"No summary"}),e.jsxs(U,{children:[e.jsx("p",{className:"mb-1",children:"Generate a summary by running"}),e.jsxs("code",{className:"bg-muted px-1.5 py-0.5 text-foreground cursor-default hover:bg-ring/20 dark:hover:bg-ring/50 transition-colors",onClick:async()=>{await navigator.clipboard.writeText(`harbor jobs summarize ${n}`),se("Copied to clipboard",{description:`harbor jobs summarize ${n}`})},children:["harbor jobs summarize ",n]})]})]})})}function Ot({jobName:t,trialName:s}){const{data:n,isLoading:o}=S({queryKey:["agent-logs",t,s],queryFn:()=>ge(t,s)});if(o)return e.jsxs(k,{children:[e.jsx($,{children:e.jsx(R,{children:"Agent Logs"})}),e.jsx(A,{children:e.jsx("div",{className:"text-sm text-muted-foreground",children:"Loading..."})})]});if(!(n&&(n.oracle||n.setup||n.commands.length>0)))return e.jsx(V,{className:"bg-card border",children:e.jsxs(H,{children:[e.jsx(B,{variant:"icon",children:e.jsx(nt,{})}),e.jsx(q,{children:"No agent logs"}),e.jsx(U,{children:"No oracle, setup, or command logs found"})]})});const r=[];n.oracle&&r.push({id:"oracle",label:"Oracle",content:n.oracle,lang:"text"}),n.setup&&r.push({id:"setup",label:"Setup",content:n.setup,lang:"text"});for(const a of n.commands)r.push({id:`command-${a.index}`,label:`Command ${a.index}`,content:a.content,lang:"text"});return r.length===0?null:e.jsx(k,{className:"py-0 gap-0",children:e.jsx(A,{className:"p-0",children:e.jsxs(oe,{defaultValue:r[0].id,children:[e.jsx(re,{children:r.map(a=>e.jsx(I,{value:a.id,children:a.label},a.id))}),r.map(a=>e.jsx(T,{value:a.id,className:"mt-0 -mx-px",children:e.jsx(w,{code:a.content,lang:a.lang})},a.id))]})})})}function Ft(t){const s=["harbor run"];t.source&&s.push(`-d ${t.source}`),s.push(`-t ${t.task_name}`),s.push(`-a ${t.agent_info.name}`);const n=t.agent_info.model_info;if(n){const o=n.provider?`${n.provider}/${n.name}`:n.name;s.push(`-m ${o}`)}return s.join(" ")}function L({value:t}){const s=async()=>{await navigator.clipboard.writeText(t),se("Copied to clipboard",{description:t})};return e.jsx("span",{onClick:s,className:"cursor-default hover:text-foreground transition-colors",children:t})}function Vt(t,s){return`/jobs/${encodeURIComponent(t)}/tasks/${encodeURIComponent(s.source)}/${encodeURIComponent(s.agent)}/${encodeURIComponent(s.modelProvider)}/${encodeURIComponent(s.modelName)}/${encodeURIComponent(s.taskName)}`}function Ht(t){return t.startsWith("file://")?new URL(t).pathname:t}function Bt(t){return t.substring(0,t.lastIndexOf("/"))}function qt({trial:t,jobName:s,trialName:n,taskUrlParams:o}){const{data:c}=S({queryKey:["trajectory",s,n],queryFn:()=>je(s,n)}),r=t.verifier_result?.rewards?.reward??null,a=c?.final_metrics;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-8",children:[e.jsx(Be,{className:"mb-4",children:e.jsxs(qe,{children:[e.jsx(O,{children:e.jsx(Q,{asChild:!0,children:e.jsx(J,{to:"/",children:"Jobs"})})}),e.jsx(Y,{}),e.jsx(O,{children:e.jsx(Q,{asChild:!0,children:e.jsx(J,{to:`/jobs/${encodeURIComponent(s)}`,children:s})})}),e.jsx(Y,{}),e.jsx(O,{children:e.jsx(Q,{asChild:!0,children:e.jsx(J,{to:Vt(s,o),children:o.taskName})})}),e.jsx(Y,{}),e.jsx(O,{children:e.jsx(Ue,{children:n})})]})}),e.jsx("h1",{className:"text-4xl font-medium mb-4 cursor-default hover:text-foreground/80 transition-colors",onClick:async()=>{await navigator.clipboard.writeText(n),se("Copied to clipboard",{description:n})},children:n}),e.jsxs("div",{className:"flex gap-2 text-sm text-muted-foreground",children:[t.source&&e.jsxs(e.Fragment,{children:[e.jsx(L,{value:t.source}),e.jsx("span",{className:"text-border",children:"|"})]}),e.jsx(L,{value:t.task_name}),e.jsx("span",{className:"text-border",children:"|"}),e.jsx(L,{value:t.agent_info.version&&t.agent_info.version!=="unknown"?`${t.agent_info.name}@${t.agent_info.version}`:t.agent_info.name}),t.agent_info.model_info&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-border",children:"|"}),e.jsx(L,{value:`${t.agent_info.model_info.provider}/${t.agent_info.model_info.name}`})]})]}),e.jsx("div",{className:"text-xs text-muted-foreground mt-3",children:e.jsx(L,{value:t.trial_uri.startsWith("file://")?t.trial_uri.slice(7):t.trial_uri})})]}),e.jsx(w,{code:Ft(t),lang:"bash",className:"-mb-px -mx-px"}),e.jsxs("div",{className:"grid grid-cols-1 -mx-px",children:[e.jsxs(k,{className:"-mb-px gap-3 py-4",children:[e.jsxs($,{className:"flex flex-row items-center justify-between",children:[e.jsx(R,{children:"Outcome"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:At(t.started_at)})]}),e.jsxs(A,{children:[e.jsx(X,{label:"Reward",value:r!==null?r.toFixed(2):"-",showBorder:!1}),a?.total_cost_usd&&e.jsx(X,{label:"Cost",value:`$${a.total_cost_usd.toFixed(4)}`,showBorder:!1}),t.exception_info&&e.jsx(X,{label:"Error",value:t.exception_info.exception_type,className:"text-destructive",showBorder:!1})]})]}),e.jsxs(k,{className:"-mb-px -mt-px gap-3 py-4",children:[e.jsx($,{children:e.jsx(R,{children:"Tokens"})}),e.jsx(A,{children:e.jsx(Tt,{segments:[{label:"Cached",value:a?.total_cached_tokens??0,color:"var(--color-neutral-400)"},{label:"Prompt",value:Math.max(0,(a?.total_prompt_tokens??0)-(a?.total_cached_tokens??0)),color:"var(--color-neutral-500)"},{label:"Output",value:a?.total_completion_tokens??0,color:"var(--color-neutral-600)"}],totalLabel:`${((a?.total_prompt_tokens??0)+(a?.total_completion_tokens??0)).toLocaleString()} tokens`})})]}),e.jsxs(k,{className:"-mt-px gap-3 py-4",children:[e.jsx($,{children:e.jsx(R,{children:"Timing"})}),e.jsx(A,{children:e.jsx($t,{phases:[{label:"Env Setup",timing:t.environment_setup,color:"var(--color-neutral-400)"},{label:"Agent Setup",timing:t.agent_setup,color:"var(--color-neutral-500)"},{label:"Agent Execution",timing:t.agent_execution,color:"var(--color-neutral-600)"},{label:"Verifier",timing:t.verifier,color:"var(--color-neutral-700)"}],totalDuration:Le(t.started_at,t.finished_at)})})]})]}),e.jsxs(oe,{defaultValue:"trajectory",className:"mt-6",children:[e.jsxs(re,{className:"bg-card border border-b-0 w-full",children:[e.jsx(I,{value:"trajectory",children:"Trajectory"}),e.jsx(I,{value:"agent-logs",children:"Agent Logs"}),e.jsx(I,{value:"test-output",children:"Verifier Logs"}),e.jsx(I,{value:"summary",children:"Summary"})]}),e.jsx(T,{value:"trajectory",children:e.jsx(Dt,{jobName:s,trialName:n})}),e.jsx(T,{value:"agent-logs",children:e.jsx(Ot,{jobName:s,trialName:n})}),e.jsx(T,{value:"test-output",children:e.jsx(Lt,{jobName:s,trialName:n})}),e.jsx(T,{value:"summary",children:e.jsx(Et,{jobName:s,trialName:n,jobPath:Bt(Ht(t.trial_uri))})})]})]})}const Jt=Oe(function(){const{jobName:s,trialName:n,source:o,agent:c,modelProvider:r,modelName:a,taskName:u}=Fe(),x={source:o,agent:c,modelProvider:r,modelName:a,taskName:u},{data:m,isLoading:p,error:j}=S({queryKey:["trial",s,n],queryFn:()=>Ke(s,n),enabled:!!s&&!!n});return p?e.jsx("div",{className:"container mx-auto py-10",children:e.jsx("div",{className:"text-muted-foreground",children:"Loading..."})}):j||!m?e.jsx("div",{className:"container mx-auto py-10",children:e.jsx("div",{className:"text-destructive",children:j instanceof Error?j.message:"Failed to load trial"})}):e.jsx("div",{className:"container mx-auto py-10",children:e.jsx(qt,{trial:m,jobName:s,trialName:n,taskUrlParams:x})})});export{Jt as default};
