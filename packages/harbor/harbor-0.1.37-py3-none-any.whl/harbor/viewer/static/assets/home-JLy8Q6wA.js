import{b as S,x as te,v as se,t as i}from"./index-Dnn6g2C-.js";import{u as re,B as ne,a as ae,b as oe,c as le,d as ie,f as ue}from"./api-jJhccEct.js";import{u as ce,t as X}from"./index-Cq-h8E2r.js";import{u as de,T as fe}from"./trash-2-B1pgm1F6.js";import{u as me,h as he,i as Y,j as be,a as V,d as N,f as pe,e as ge,g as Q,c as je,k as Se,w as Oe}from"./compare-Br3z3FUS-BM0xwwTM.js";import{B as xe,D as ye,c as ve,S as I}from"./data-table-DJCdmYte.js";import"./mutation-uklu9hQX.js";function k(e,t,s){try{return e(t)}catch(a){return Oe("[nuqs] Error while parsing value `%s`: %O"+(s?" (for key `%s`)":""),t,a,s),null}}function q(e){function t(s){if(typeof s>"u")return null;let a="";if(Array.isArray(s)){if(s[0]===void 0)return null;a=s[0]}return typeof s=="string"&&(a=s),k(e.parse,a)}return{type:"single",eq:(s,a)=>s===a,...e,parseServerSide:t,withDefault(s){return{...this,defaultValue:s,parseServerSide(a){return t(a)??s}}},withOptions(s){return{...this,...s}}}}const we=q({parse:e=>e,serialize:String});q({parse:e=>{const t=parseInt(e);return t==t?t:null},serialize:e=>""+Math.round(e)});q({parse:e=>{const t=parseInt(e);return t==t?t-1:null},serialize:e=>""+Math.round(e+1)});q({parse:e=>{const t=parseInt(e,16);return t==t?t:null},serialize:e=>{const t=Math.round(e).toString(16);return(t.length&1?"0":"")+t}});q({parse:e=>{const t=parseFloat(e);return t==t?t:null},serialize:String});q({parse:e=>e.toLowerCase()==="true",serialize:String});function G(e,t){return e.valueOf()===t.valueOf()}q({parse:e=>{const t=parseInt(e);return t==t?new Date(t):null},serialize:e=>""+e.valueOf(),eq:G});q({parse:e=>{const t=new Date(e);return t.valueOf()==t.valueOf()?t:null},serialize:e=>e.toISOString(),eq:G});q({parse:e=>{const t=new Date(e.slice(0,10));return t.valueOf()==t.valueOf()?t:null},serialize:e=>e.toISOString().slice(0,10),eq:G});function qe(e,t=","){const s=e.eq??((o,n)=>o===n),a=encodeURIComponent(t);return q({parse:o=>o===""?[]:o.split(t).map((n,u)=>k(e.parse,n.replaceAll(a,t),`[${u}]`)).filter(n=>n!=null),serialize:o=>o.map(n=>(e.serialize?e.serialize(n):String(n)).replaceAll(t,a)).join(t),eq(o,n){return o===n?!0:o.length!==n.length?!1:o.every((u,b)=>s(u,n[b]))}})}const F=pe(),De={};function Ue(e,t={}){const s=S.useId(),a=me(),o=he(),{history:n="replace",scroll:u=a?.scroll??!1,shallow:b=a?.shallow??!0,throttleMs:p=Y.timeMs,limitUrlUpdates:d=a?.limitUrlUpdates,clearOnDefault:f=a?.clearOnDefault??!0,startTransition:O,urlKeys:x=De}=t,m=Object.keys(e).join(","),r=S.useMemo(()=>Object.fromEntries(Object.keys(e).map(l=>[l,x[l]??l])),[m,JSON.stringify(x)]),g=be(Object.values(r)),v=g.searchParams,C=S.useRef({}),_=S.useMemo(()=>Object.fromEntries(Object.keys(e).map(l=>[l,e[l].defaultValue??null])),[Object.values(e).map(({defaultValue:l})=>l).join(",")]),E=V.useQueuedQueries(Object.values(r)),[$,J]=S.useState(()=>H(e,x,v??new URLSearchParams,E).state),y=S.useRef($);if(N("[nuq+ %s `%s`] render - state: %O, iSP: %s",s,m,$,v),Object.keys(C.current).join("&")!==Object.values(r).join("&")){const{state:l,hasChanged:c}=H(e,x,v,E,C.current,y.current);c&&(N("[nuq+ %s `%s`] State changed: %O",s,m,{state:l,initialSearchParams:v,queuedQueries:E,queryRef:C.current,stateRef:y.current}),y.current=l,J(l)),C.current=Object.fromEntries(Object.entries(r).map(([h,w])=>[w,e[h]?.type==="multi"?v?.getAll(w):v?.get(w)??null]))}S.useEffect(()=>{const{state:l,hasChanged:c}=H(e,x,v,E,C.current,y.current);c&&(N("[nuq+ %s `%s`] State changed: %O",s,m,{state:l,initialSearchParams:v,queuedQueries:E,queryRef:C.current,stateRef:y.current}),y.current=l,J(l))},[Object.values(r).map(l=>`${l}=${v?.getAll(l)}`).join("&"),JSON.stringify(E)]),S.useEffect(()=>{const l=Object.keys(e).reduce((c,h)=>(c[h]=({state:w,query:A})=>{J(z=>{const{defaultValue:R}=e[h],P=r[h],T=w??R??null,U=z[h]??R??null;return Object.is(U,T)?(N("[nuq+ %s `%s`] Cross-hook key sync %s: %O (default: %O). no change, skipping, resolved: %O",s,m,P,w,R,y.current),z):(y.current={...y.current,[h]:T},C.current[P]=A,N("[nuq+ %s `%s`] Cross-hook key sync %s: %O (default: %O). updateInternalState, resolved: %O",s,m,P,w,R,y.current),y.current)})},c),{});for(const c of Object.keys(e)){const h=r[c];N("[nuq+ %s `%s`] Subscribing to sync for `%s`",s,h,m),F.on(h,l[c])}return()=>{for(const c of Object.keys(e)){const h=r[c];N("[nuq+ %s `%s`] Unsubscribing to sync for `%s`",s,h,m),F.off(h,l[c])}}},[m,r]);const ee=S.useCallback((l,c={})=>{const h=Object.fromEntries(Object.keys(e).map(U=>[U,null])),w=typeof l=="function"?l(Z(y.current,_))??h:l??h;N("[nuq+ %s `%s`] setState: %O",s,m,w);let A,z=0,R=!1;const P=[];for(let[U,D]of Object.entries(w)){const j=e[U],K=r[U];if(!j||D===void 0)continue;(c.clearOnDefault??j.clearOnDefault??f)&&D!==null&&j.defaultValue!==void 0&&(j.eq??((M,L)=>M===L))(D,j.defaultValue)&&(D=null);const W=D===null?null:(j.serialize??String)(D);F.emit(K,{state:D,query:W});const B={key:K,query:W,options:{history:c.history??j.history??n,shallow:c.shallow??j.shallow??b,scroll:c.scroll??j.scroll??u,startTransition:c.startTransition??j.startTransition??O}};if(c?.limitUrlUpdates?.method==="debounce"||d?.method==="debounce"||j.limitUrlUpdates?.method==="debounce"){B.options.shallow===!0&&console.warn(ge(422));const M=c?.limitUrlUpdates?.timeMs??d?.timeMs??j.limitUrlUpdates?.timeMs??Y.timeMs,L=V.push(B,M,g,o);z<M&&(A=L,z=M)}else{const M=c?.limitUrlUpdates?.timeMs??j?.limitUrlUpdates?.timeMs??d?.timeMs??c.throttleMs??j.throttleMs??p;P.push(V.abort(K)),Q.push(B,M),R=!0}}const T=P.reduce((U,D)=>D(U),R?Q.flush(g,o):Q.getPendingPromise(g));return A??T},[m,n,b,u,p,d?.method,d?.timeMs,O,r,g.updateUrl,g.getSearchParamsSnapshot,g.rateLimitFactor,o,_]);return[S.useMemo(()=>Z($,_),[$,_]),ee]}function H(e,t,s,a,o,n){let u=!1;const b=Object.entries(e).reduce((p,[d,f])=>{const O=t?.[d]??d,x=a[O],m=f.type==="multi"?[]:null,r=x===void 0?(f.type==="multi"?s?.getAll(O):s?.get(O))??m:x;return o&&n&&je(o[O]??m,r)?(p[d]=n[d]??null,p):(u=!0,p[d]=(Se(r)?null:k(f.parse,r,O))??null,o&&(o[O]=r),p)},{});if(!u){const p=Object.keys(e),d=Object.keys(n??{});u=p.length!==d.length||p.some(f=>!d.includes(f))}return{state:b,hasChanged:u}}function Z(e,t){return Object.fromEntries(Object.keys(e).map(s=>[s,e[s]??t[s]??null]))}function Ne(e,t={}){const{parse:s,type:a,serialize:o,eq:n,defaultValue:u,...b}=t,[{[e]:p},d]=Ue({[e]:{parse:s??(f=>f),type:a,serialize:o,eq:n,defaultValue:u}},b);return[p,S.useCallback((f,O={})=>d(x=>({[e]:typeof f=="function"?f(x[e]):f}),O),[e,d])]}function Ce(e,t){if(!e)return"-";const s=new Date(e).getTime(),o=(t?new Date(t).getTime():Date.now())-s,n=Math.floor(o/1e3),u=Math.floor(n/60),b=Math.floor(u/60);return b>0?`${b}h ${u%60}m`:u>0?`${u}m ${n%60}s`:`${n}s`}const Re=[ve(),{accessorKey:"name",header:({column:e})=>i.jsx(I,{column:e,children:"Job Name"})},{accessorKey:"n_total_trials",header:({column:e})=>i.jsx("div",{className:"text-right",children:i.jsx(I,{column:e,children:"Trials"})}),cell:({row:e})=>{const t=e.original.n_total_trials,s=e.original.n_completed_trials;return i.jsxs("div",{className:"text-right",children:[s,"/",t]})}},{accessorKey:"n_errors",header:({column:e})=>i.jsx("div",{className:"text-right",children:i.jsx(I,{column:e,children:"Errors"})}),cell:({row:e})=>{const t=e.original.n_errors;return i.jsx("div",{className:"text-right",children:t})}},{id:"duration",header:"Duration",enableSorting:!1,cell:({row:e})=>{const{started_at:t,finished_at:s}=e.original;return!t||!s?"-":Ce(t,s)}},{accessorKey:"started_at",header:({column:e})=>i.jsx(I,{column:e,children:"Started"}),cell:({row:e})=>{const t=e.original.started_at;return t?new Date(t).toLocaleString():"-"}},{accessorKey:"finished_at",header:({column:e})=>i.jsx(I,{column:e,children:"Ended"}),cell:({row:e})=>{const t=e.original.finished_at;return t?new Date(t).toLocaleString():"-"}}],Ae=te(function(){const t=se(),s=ce(),[a,o]=Ne("selected",qe(we).withDefault([])),[n,u]=S.useState(!1),{data:b=[],isLoading:p}=re({queryKey:["jobs"],queryFn:ue}),d=S.useMemo(()=>{const r={};for(const g of a)r[g]=!0;return r},[a]),f=S.useMemo(()=>b.filter(r=>a.includes(r.name)),[b,a]),O=r=>{const g=Object.keys(r).filter(v=>r[v]);o(g.length>0?g:null)},x=de({mutationFn:async r=>{await Promise.all(r.map(g=>ie(g)))},onSuccess:()=>{s.invalidateQueries({queryKey:["jobs"]}),X("Jobs deleted",{description:`${f.length} job(s) deleted`}),o(null),u(!1)},onError:r=>{X.error("Failed to delete jobs",{description:r.message}),u(!1)}}),m=()=>{n?x.mutate(f.map(r=>r.name)):u(!0)};return p?i.jsx("div",{className:"container mx-auto py-10",children:i.jsx("div",{className:"text-muted-foreground",children:"Loading..."})}):i.jsxs("div",{className:"container mx-auto py-10",children:[i.jsxs("div",{className:"mb-8",children:[i.jsx(ne,{className:"mb-4",children:i.jsx(ae,{children:i.jsx(oe,{children:i.jsx(le,{children:"Jobs"})})})}),i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{children:[i.jsx("h1",{className:"text-4xl font-medium mb-2",children:"Jobs"}),i.jsx("p",{className:"text-muted-foreground",children:"Browse and inspect Harbor jobs"})]}),f.length>0&&i.jsxs(xe,{variant:n?"destructive":"secondary",onClick:m,onBlur:()=>u(!1),disabled:x.isPending,children:[i.jsx(fe,{className:"h-4 w-4"}),n?`Confirm delete (${f.length})`:`Delete (${f.length})`]})]})]}),i.jsx(ye,{columns:Re,data:b,onRowClick:r=>t(`/jobs/${r.name}`),enableRowSelection:!0,rowSelection:d,onRowSelectionChange:O,getRowId:r=>r.name})]})});export{Ae as default};
