import{x as le,A as oe,v as ie,b as l,t as e,B as ce}from"./index-C6J4Pqq0.js";import{u as _,B as de,a as ue,b as A,j as me,k as he,d as xe,e as I,f as je,s as ge,L as pe,l as ve,m as be,n as ye,o as fe}from"./api-Di6evdbS.js";import{u as U,t as S,l as Ne}from"./index-DDT61vXN.js";import{u as J,E as Ce,a as ke,b as Se,c as _e,d as we}from"./empty-DVWE5J5D.js";import{u as N,a as C,p as w,b as De,T as Te,I as Q,S as Fe,C as D}from"./hooks-C8gAss8f.js";import{C as Pe,B as Me}from"./code-block-CLtCnWW-.js";import{D as Ee,P as Be,a as Ie,b as c,d as Ke,e as k,f as R,g as Le,S as x,C as qe}from"./pagination-mu92niv2.js";import{T as Ae,a as Re,b as O,c as V,F as Oe,D as Ve,d as Ue,e as Je,f as Qe,g as $e,h as ze,L as M,S as Ge,i as He,j as We,k as Ze,l as E}from"./tabs-BIl2Mbyw.js";import"./mutation-CzWEsub0.js";import"./compare-Br3z3FUS-D05ZBVBy.js";function Xe({value:s}){const a=async()=>{await navigator.clipboard.writeText(s),S("Copied to clipboard",{description:s})};return e.jsx("span",{onClick:a,className:"cursor-default hover:text-foreground transition-colors",children:s})}function Ye({jobName:s}){const a=U(),[n,p]=l.useState(!1),[d,j]=l.useState("haiku"),[t,o]=l.useState(32),[v,T]=l.useState(!0),i=J({mutationFn:()=>ge(s,d,t,v),onSuccess:()=>{a.invalidateQueries({queryKey:["job-summary",s]}),p(!1),S.success("Summary generated")},onError:g=>{S.error("Failed to generate summary",{description:g.message})}});return e.jsxs(Ve,{open:n,onOpenChange:p,children:[e.jsx(Ue,{asChild:!0,children:e.jsx(I,{children:"Generate Summary"})}),e.jsxs(Je,{children:[e.jsxs(Qe,{children:[e.jsx($e,{children:"Generate Summary"}),e.jsx(ze,{children:"Use Claude to analyze all failing trials and generate a summary. This can take a couple minutes."})]}),e.jsxs("div",{className:"space-y-4 pt-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{htmlFor:"model",children:"Model"}),e.jsxs(Ge,{value:d,onValueChange:j,children:[e.jsx(He,{id:"model",children:e.jsx(We,{})}),e.jsxs(Ze,{children:[e.jsx(E,{value:"haiku",children:"Haiku (Recommended)"}),e.jsx(E,{value:"sonnet",children:"Sonnet"}),e.jsx(E,{value:"opus",children:"Opus"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{htmlFor:"n-concurrent",children:"Concurrent Claude Codes"}),e.jsx(Q,{id:"n-concurrent",type:"number",min:1,max:100,value:t,onChange:g=>o(parseInt(g.target.value)||1)})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(qe,{id:"only-failed",checked:v,onCheckedChange:g=>T(g===!0)}),e.jsx(M,{htmlFor:"only-failed",className:"font-normal",children:"Only analyze failed trials"})]}),e.jsx(I,{className:"w-full",onClick:()=>i.mutate(),disabled:i.isPending,children:i.isPending?e.jsx(pe,{text:"Generating"}):"Generate"})]})]})]})}function es({reward:s}){const a=Math.max(0,Math.min(1,s)),n=Math.round(a*100);return e.jsx(Me,{variant:"outline",className:"tabular-nums border-transparent rounded-none",style:{backgroundColor:`color-mix(in oklab, var(--foreground) ${n}%, transparent)`,color:a>.5?"var(--background)":void 0},children:s.toFixed(2)})}function ss(s,a){const n=s.source||"_",p=s.agent_name||"_",d=s.model_provider||"_",j=s.model_name||"_";return`/jobs/${encodeURIComponent(a)}/tasks/${encodeURIComponent(n)}/${encodeURIComponent(p)}/${encodeURIComponent(d)}/${encodeURIComponent(j)}/${encodeURIComponent(s.task_name)}`}const as=[{accessorKey:"task_name",header:({column:s})=>e.jsx(x,{column:s,children:"Task"})},{accessorKey:"agent_name",header:({column:s})=>e.jsx(x,{column:s,children:"Agent"}),cell:({row:s})=>s.original.agent_name||"-"},{accessorKey:"model_provider",header:({column:s})=>e.jsx(x,{column:s,children:"Provider"}),cell:({row:s})=>s.original.model_provider||"-"},{accessorKey:"model_name",header:({column:s})=>e.jsx(x,{column:s,children:"Model"}),cell:({row:s})=>s.original.model_name||"-"},{accessorKey:"source",header:({column:s})=>e.jsx(x,{column:s,children:"Dataset"}),cell:({row:s})=>s.original.source||"-"},{accessorKey:"n_trials",header:({column:s})=>e.jsx("div",{className:"text-right",children:e.jsx(x,{column:s,children:"Trials"})}),cell:({row:s})=>{const{n_trials:a,n_completed:n}=s.original;return n<a?e.jsxs("div",{className:"text-right",children:[n,"/",a]}):e.jsx("div",{className:"text-right",children:a})}},{accessorKey:"n_errors",header:({column:s})=>e.jsx("div",{className:"text-right",children:e.jsx(x,{column:s,children:"Errors"})}),cell:({row:s})=>{const a=s.original.n_errors;return e.jsx("div",{className:"text-right",children:a})}},{accessorKey:"avg_reward",header:({column:s})=>e.jsx("div",{className:"text-right",children:e.jsx(x,{column:s,children:"Avg Reward"})}),cell:({row:s})=>{const a=s.original.avg_reward;return a===null?e.jsx("div",{className:"text-right text-muted-foreground",children:"-"}):e.jsx("div",{className:"text-right",children:e.jsx(es,{reward:a})})}}],B=100,hs=le(function(){const{jobName:a}=oe(),n=ie(),p=U(),[d,j]=l.useState(!1),[t,o]=l.useState(1),[v,T]=N("q",C.withDefault("")),[i,g]=N("agent",w(C).withDefault([])),[b,$]=N("provider",w(C).withDefault([])),[y,z]=N("model",w(C).withDefault([])),[f,G]=N("task",w(C).withDefault([])),F=De(v,300);l.useEffect(()=>{o(1)},[F,i,b,y,f]);const{data:u,isLoading:H}=_({queryKey:["job",a],queryFn:()=>ve(a),enabled:!!a}),{data:m}=_({queryKey:["task-filters",a],queryFn:()=>be(a),enabled:!!a,staleTime:6e4}),W=l.useMemo(()=>(m?.agents??[]).map(r=>({value:r.value,label:r.value,count:r.count})),[m?.agents]),Z=l.useMemo(()=>(m?.providers??[]).map(r=>({value:r.value,label:r.value,count:r.count})),[m?.providers]),X=l.useMemo(()=>(m?.models??[]).map(r=>({value:r.value,label:r.value,count:r.count})),[m?.models]),Y=l.useMemo(()=>(m?.tasks??[]).map(r=>({value:r.value,label:r.value,count:r.count})),[m?.tasks]),{data:P,isLoading:ee}=_({queryKey:["tasks",a,t,F,i,b,y,f],queryFn:()=>ye(a,t,B,{search:F||void 0,agents:i.length>0?i:void 0,providers:b.length>0?b:void 0,models:y.length>0?y:void 0,tasks:f.length>0?f:void 0}),enabled:!!a,placeholderData:Ne}),se=P?.items??[],h=P?.total_pages??0,K=P?.total??0,{data:L}=_({queryKey:["job-summary",a],queryFn:()=>fe(a),enabled:!!a}),q=J({mutationFn:()=>je(a),onSuccess:()=>{p.invalidateQueries({queryKey:["jobs"]}),S("Job deleted",{description:a}),n("/")},onError:r=>{S.error("Failed to delete job",{description:r.message}),j(!1)}}),ae=()=>{d?q.mutate():j(!0)};if(!H&&!u)return e.jsx("div",{className:"container mx-auto py-10",children:e.jsx("div",{className:"text-destructive",children:"Failed to load job"})});const re=u?.stats.n_trials??0,te=u?.n_total_trials??0,ne=u?.stats.n_errors??0;return e.jsxs("div",{className:"container mx-auto py-10",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx(de,{className:"mb-4",children:e.jsxs(ue,{children:[e.jsx(A,{children:e.jsx(me,{asChild:!0,children:e.jsx(ce,{to:"/",children:"Jobs"})})}),e.jsx(he,{}),e.jsx(A,{children:e.jsx(xe,{children:a})})]})}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-4xl font-medium",children:a}),e.jsxs(I,{variant:d?"destructive":"secondary",onClick:ae,onBlur:()=>j(!1),disabled:q.isPending,children:[e.jsx(Te,{className:"h-4 w-4"}),d?"Confirm delete":"Delete"]})]}),e.jsxs("div",{className:"flex gap-2 text-sm text-muted-foreground mt-2",children:[e.jsxs("span",{children:[re,"/",te," trials completed"]}),e.jsx("span",{className:"text-border",children:"|"}),e.jsxs("span",{children:[ne," errors"]})]}),u?.job_uri&&e.jsx("div",{className:"text-xs text-muted-foreground mt-3",children:e.jsx(Xe,{value:u.job_uri.startsWith("file://")?u.job_uri.slice(7):u.job_uri})})]}),e.jsxs(Ae,{defaultValue:"results",className:"mt-6",children:[e.jsxs(Re,{className:"bg-card border border-b-0 w-full",children:[e.jsx(O,{value:"results",children:"Results"}),e.jsx(O,{value:"summary",children:"Summary"})]}),e.jsxs(V,{value:"results",children:[e.jsxs("div",{className:"grid grid-cols-6 -mb-px",children:[e.jsxs("div",{className:"col-span-2 relative",children:[e.jsx(Q,{placeholder:"Search for tasks...",value:v,onChange:r=>T(r.target.value||null),size:"lg",variant:"card",className:"peer pl-9 shadow-none"}),e.jsx(Fe,{className:"pointer-events-none absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-border transition-colors peer-focus-visible:text-ring"})]}),e.jsx(D,{options:W,value:i,onValueChange:g,placeholder:"All agents",searchPlaceholder:"Search agents...",emptyText:"No agents found.",variant:"card",className:"w-full border-l-0 shadow-none"}),e.jsx(D,{options:Z,value:b,onValueChange:$,placeholder:"All providers",searchPlaceholder:"Search providers...",emptyText:"No providers found.",variant:"card",className:"w-full border-l-0 shadow-none"}),e.jsx(D,{options:X,value:y,onValueChange:z,placeholder:"All models",searchPlaceholder:"Search models...",emptyText:"No models found.",variant:"card",className:"w-full border-l-0 shadow-none"}),e.jsx(D,{options:Y,value:f,onValueChange:G,placeholder:"All tasks",searchPlaceholder:"Search tasks...",emptyText:"No tasks found.",variant:"card",className:"w-full border-l-0 shadow-none"})]}),e.jsx(Ee,{columns:as,data:se,onRowClick:r=>n(ss(r,a)),isLoading:ee,className:"border-t-0"}),h>1&&e.jsxs("div",{className:"grid grid-cols-3 items-center mt-4",children:[e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Showing ",(t-1)*B+1,"-",Math.min(t*B,K)," of ",K," tasks"]}),e.jsx(Be,{children:e.jsxs(Ie,{children:[e.jsx(c,{children:e.jsx(Ke,{onClick:()=>o(r=>Math.max(1,r-1)),className:t===1?"pointer-events-none opacity-50":"cursor-pointer"})}),t>2&&e.jsx(c,{children:e.jsx(k,{onClick:()=>o(1),className:"cursor-pointer",children:"1"})}),t>3&&e.jsx(c,{children:e.jsx(R,{})}),t>1&&e.jsx(c,{children:e.jsx(k,{onClick:()=>o(t-1),className:"cursor-pointer",children:t-1})}),e.jsx(c,{children:e.jsx(k,{isActive:!0,children:t})}),t<h&&e.jsx(c,{children:e.jsx(k,{onClick:()=>o(t+1),className:"cursor-pointer",children:t+1})}),t<h-2&&e.jsx(c,{children:e.jsx(R,{})}),t<h-1&&e.jsx(c,{children:e.jsx(k,{onClick:()=>o(h),className:"cursor-pointer",children:h})}),e.jsx(c,{children:e.jsx(Le,{onClick:()=>o(r=>Math.min(h,r+1)),className:t===h?"pointer-events-none opacity-50":"cursor-pointer"})})]})}),e.jsx("div",{})]})]}),e.jsx(V,{value:"summary",children:L?.summary?e.jsx(Pe,{code:L.summary,lang:"markdown",wrap:!0}):e.jsxs(Ce,{className:"bg-card border",children:[e.jsxs(ke,{children:[e.jsx(Se,{variant:"icon",children:e.jsx(Oe,{})}),e.jsx(_e,{children:"No summary"}),e.jsx(we,{children:"Generate a summary of all trials in this job using Claude."})]}),e.jsx(Ye,{jobName:a})]})})]})]})});export{hs as default};
