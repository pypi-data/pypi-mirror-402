import{x as te,v as ae,b as d,t as e}from"./index-C6J4Pqq0.js";import{u as re,t as T,l as ne}from"./index-DDT61vXN.js";import{c as oe,u as M,B as le,a as ie,b as ce,d as de,e as ue,f as he,g as me,h as xe,i as ge}from"./api-Di6evdbS.js";import{u as pe,E as K,a as I,b as J,c as q,d as je}from"./empty-DVWE5J5D.js";import{u as b,p as w,a as N,b as fe,T as ve,I as be,S as $,C as P}from"./hooks-C8gAss8f.js";import{D as Ne,c as ye,P as we,a as Se,b as i,d as Ce,e as S,f as B,g as De,S as u}from"./pagination-mu92niv2.js";import"./mutation-CzWEsub0.js";import"./compare-Br3z3FUS-D05ZBVBy.js";const Pe=[["path",{d:"m6 14 1.5-2.9A2 2 0 0 1 9.24 10H20a2 2 0 0 1 1.94 2.5l-1.54 6a2 2 0 0 1-1.95 1.5H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H18a2 2 0 0 1 2 2v2",key:"usdka0"}]],_e=oe("folder-open",Pe),k=100,Fe=[{value:"today",label:"Last 24 hours"},{value:"week",label:"Last 7 days"},{value:"month",label:"Last 30 days"}];function Te(s,t){if(!s)return"-";const n=new Date(s).getTime(),C=(t?new Date(t).getTime():Date.now())-n,h=Math.floor(C/1e3),l=Math.floor(h/60),r=Math.floor(l/60);return r>0?`${r}h ${l%60}m`:l>0?`${l}m ${h%60}s`:`${h}s`}const Me=[ye(),{accessorKey:"name",header:({column:s})=>e.jsx(u,{column:s,children:"Job Name"})},{accessorKey:"agents",header:({column:s})=>e.jsx(u,{column:s,children:"Agents"}),sortingFn:(s,t)=>{const n=s.original.agents[0]??"",o=t.original.agents[0]??"";return n.localeCompare(o)},cell:({row:s})=>{const t=s.original.agents;return t.length===0?e.jsx("span",{className:"text-muted-foreground",children:"-"}):t.length===1?e.jsx("span",{className:"text-sm",children:t[0]}):e.jsxs("span",{className:"text-sm",title:t.join(", "),children:[t[0]," ",e.jsxs("span",{className:"text-muted-foreground",children:["+",t.length-1," more"]})]})}},{accessorKey:"providers",header:({column:s})=>e.jsx(u,{column:s,children:"Providers"}),sortingFn:(s,t)=>{const n=s.original.providers[0]??"",o=t.original.providers[0]??"";return n.localeCompare(o)},cell:({row:s})=>{const t=s.original.providers;return t.length===0?e.jsx("span",{className:"text-muted-foreground",children:"-"}):t.length===1?e.jsx("span",{className:"text-sm",children:t[0]}):e.jsxs("span",{className:"text-sm",title:t.join(", "),children:[t[0]," ",e.jsxs("span",{className:"text-muted-foreground",children:["+",t.length-1," more"]})]})}},{accessorKey:"models",header:({column:s})=>e.jsx(u,{column:s,children:"Models"}),sortingFn:(s,t)=>{const n=s.original.models[0]??"",o=t.original.models[0]??"";return n.localeCompare(o)},cell:({row:s})=>{const t=s.original.models;return t.length===0?e.jsx("span",{className:"text-muted-foreground",children:"-"}):t.length===1?e.jsx("span",{className:"text-sm",children:t[0]}):e.jsxs("span",{className:"text-sm",title:t.join(", "),children:[t[0]," ",e.jsxs("span",{className:"text-muted-foreground",children:["+",t.length-1," more"]})]})}},{accessorKey:"started_at",header:({column:s})=>e.jsx(u,{column:s,children:"Started"}),cell:({row:s})=>{const t=s.original.started_at;return t?new Date(t).toLocaleString(void 0,{dateStyle:"short",timeStyle:"short"}):"-"}},{id:"duration",header:({column:s})=>e.jsx(u,{column:s,children:"Duration"}),accessorFn:s=>!s.started_at||!s.finished_at?0:new Date(s.finished_at).getTime()-new Date(s.started_at).getTime(),cell:({row:s})=>{const{started_at:t,finished_at:n}=s.original;return!t||!n?"-":Te(t,n)}},{accessorKey:"n_total_trials",header:({column:s})=>e.jsx("div",{className:"text-right",children:e.jsx(u,{column:s,children:"Trials"})}),cell:({row:s})=>{const t=s.original.n_total_trials,n=s.original.n_completed_trials;return e.jsxs("div",{className:"text-right",children:[n,"/",t]})}},{accessorKey:"n_errors",header:({column:s})=>e.jsx("div",{className:"text-right",children:e.jsx(u,{column:s,children:"Errors"})}),cell:({row:s})=>{const t=s.original.n_errors;return e.jsx("div",{className:"text-right",children:t})}}],$e=te(function(){const t=ae(),n=re(),[o,C]=b("selected",w(N).withDefault([])),[h,l]=d.useState(!1),[r,m]=d.useState(1),[E,L]=b("q",N.withDefault("")),[x,O]=b("agent",w(N).withDefault([])),[g,H]=b("provider",w(N).withDefault([])),[p,Q]=b("model",w(N).withDefault([])),[j,R]=b("date",w(N).withDefault([])),D=fe(E,300);d.useEffect(()=>{m(1)},[D,x,g,p,j]);const{data:f}=M({queryKey:["jobFilters"],queryFn:me,staleTime:6e4}),{data:z}=M({queryKey:["config"],queryFn:xe,staleTime:1/0}),G=d.useMemo(()=>(f?.agents??[]).map(a=>({value:a.value,label:a.value,count:a.count})),[f?.agents]),Z=d.useMemo(()=>(f?.providers??[]).map(a=>({value:a.value,label:a.value,count:a.count})),[f?.providers]),U=d.useMemo(()=>(f?.models??[]).map(a=>({value:a.value,label:a.value,count:a.count})),[f?.models]),{data:_,isLoading:W}=M({queryKey:["jobs",r,D,x,g,p,j],queryFn:()=>ge(r,k,{search:D||void 0,agents:x.length>0?x:void 0,providers:g.length>0?g:void 0,models:p.length>0?p:void 0,dates:j.length>0?j:void 0}),placeholderData:ne}),F=_?.items??[],c=_?.total_pages??0,V=_?.total??0,X=d.useMemo(()=>{const a={};for(const v of o)a[v]=!0;return a},[o]),y=d.useMemo(()=>F.filter(a=>o.includes(a.name)),[F,o]),Y=a=>{const v=Object.keys(a).filter(se=>a[se]);C(v.length>0?v:null)},A=pe({mutationFn:async a=>{await Promise.all(a.map(v=>he(v)))},onSuccess:()=>{n.invalidateQueries({queryKey:["jobs"]}),T("Jobs deleted",{description:`${y.length} job(s) deleted`}),C(null),l(!1)},onError:a=>{T.error("Failed to delete jobs",{description:a.message}),l(!1)}}),ee=()=>{h?A.mutate(y.map(a=>a.name)):l(!0)};return e.jsxs("div",{className:"container mx-auto py-10",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx(le,{className:"mb-4",children:e.jsx(ie,{children:e.jsx(ce,{children:e.jsx(de,{children:"Jobs"})})})}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-4xl font-medium mb-2",children:"Jobs"}),e.jsx("p",{className:"text-muted-foreground",children:"Browse and inspect Harbor jobs"})]}),y.length>0&&e.jsxs(ue,{variant:h?"destructive":"secondary",onClick:ee,onBlur:()=>l(!1),disabled:A.isPending,children:[e.jsx(ve,{className:"h-4 w-4"}),h?`Confirm delete (${y.length})`:`Delete (${y.length})`]})]})]}),e.jsxs("div",{className:"grid grid-cols-6 -mb-px",children:[e.jsxs("div",{className:"col-span-2 relative",children:[e.jsx(be,{placeholder:"Search for jobs...",value:E,onChange:a=>L(a.target.value||null),size:"lg",variant:"card",className:"peer pl-9 shadow-none"}),e.jsx($,{className:"pointer-events-none absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-border transition-colors peer-focus-visible:text-ring"})]}),e.jsx(P,{options:G,value:x,onValueChange:O,placeholder:"All agents",searchPlaceholder:"Search agents...",emptyText:"No agents found.",variant:"card",className:"w-full border-l-0 shadow-none"}),e.jsx(P,{options:Z,value:g,onValueChange:H,placeholder:"All providers",searchPlaceholder:"Search providers...",emptyText:"No providers found.",variant:"card",className:"w-full border-l-0 shadow-none"}),e.jsx(P,{options:U,value:p,onValueChange:Q,placeholder:"All models",searchPlaceholder:"Search models...",emptyText:"No models found.",variant:"card",className:"w-full border-l-0 shadow-none"}),e.jsx(P,{options:Fe,value:j,onValueChange:R,placeholder:"All time",searchPlaceholder:"Search...",emptyText:"No options.",variant:"card",className:"w-full border-l-0 shadow-none"})]}),e.jsx(Ne,{columns:Me,data:F,onRowClick:a=>t(`/jobs/${a.name}`),enableRowSelection:!0,rowSelection:X,onRowSelectionChange:Y,getRowId:a=>a.name,isLoading:W,className:"border-t-0",emptyState:D||x.length>0||g.length>0||p.length>0||j.length>0?e.jsx(K,{className:"border-0",children:e.jsxs(I,{children:[e.jsx(J,{variant:"icon",children:e.jsx($,{})}),e.jsx(q,{children:"No jobs match those filters"})]})}):e.jsx(K,{className:"border-0",children:e.jsxs(I,{children:[e.jsx(J,{variant:"icon",children:e.jsx(_e,{})}),e.jsxs(q,{children:["No jobs in ",z?.jobs_dir??"jobs directory"]}),e.jsxs(je,{children:["Start a job using"," ",e.jsx("code",{className:"bg-muted px-1 py-0.5 cursor-default hover:bg-ring/20 hover:text-foreground transition-colors",onClick:()=>{navigator.clipboard.writeText("harbor run -d <dataset>"),T("Copied to clipboard")},children:"harbor run -d <dataset>"})]})]})})}),c>1&&e.jsxs("div",{className:"grid grid-cols-3 items-center mt-4",children:[e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Showing ",(r-1)*k+1,"-",Math.min(r*k,V)," of ",V," jobs"]}),e.jsx(we,{children:e.jsxs(Se,{children:[e.jsx(i,{children:e.jsx(Ce,{onClick:()=>m(a=>Math.max(1,a-1)),className:r===1?"pointer-events-none opacity-50":"cursor-pointer"})}),r>2&&e.jsx(i,{children:e.jsx(S,{onClick:()=>m(1),className:"cursor-pointer",children:"1"})}),r>3&&e.jsx(i,{children:e.jsx(B,{})}),r>1&&e.jsx(i,{children:e.jsx(S,{onClick:()=>m(r-1),className:"cursor-pointer",children:r-1})}),e.jsx(i,{children:e.jsx(S,{isActive:!0,children:r})}),r<c&&e.jsx(i,{children:e.jsx(S,{onClick:()=>m(r+1),className:"cursor-pointer",children:r+1})}),r<c-2&&e.jsx(i,{children:e.jsx(B,{})}),r<c-1&&e.jsx(i,{children:e.jsx(S,{onClick:()=>m(c),className:"cursor-pointer",children:c})}),e.jsx(i,{children:e.jsx(De,{onClick:()=>m(a=>Math.min(c,a+1)),className:r===c?"pointer-events-none opacity-50":"cursor-pointer"})})]})}),e.jsx("div",{})]})]})});export{$e as default};
