import{x as z,A as K,w as F,v as q,t as e,B as P}from"./index-C6J4Pqq0.js";import{u as E,B as H,a as J,b as _,j as R,k,d as Q,z as A}from"./api-Di6evdbS.js";import{C as G,B as w}from"./code-block-CLtCnWW-.js";import{D as O,P as V,a as W,b as j,d as X,f as Y,e as Z,g as ee,S as g}from"./pagination-mu92niv2.js";import"./index-DDT61vXN.js";function se({reward:s}){const t=Math.max(0,Math.min(1,s)),a=Math.round(t*100);return e.jsx(w,{variant:"outline",className:"tabular-nums border-transparent rounded-none",style:{backgroundColor:`color-mix(in oklab, var(--foreground) ${a}%, transparent)`,color:t>.5?"var(--background)":void 0},children:s.toFixed(2)})}function te(s,t){if(!s)return"-";const a=new Date(s).getTime(),r=(t?new Date(t).getTime():Date.now())-a,i=Math.floor(r/1e3),c=Math.floor(i/60),d=Math.floor(c/60);return d>0?`${d}h ${c%60}m`:c>0?`${c}m ${i%60}s`:`${i}s`}const ae=[{accessorKey:"name",header:({column:s})=>e.jsx(g,{column:s,children:"Trial"})},{id:"duration",accessorFn:s=>{if(!s.started_at)return null;const t=new Date(s.started_at).getTime();return(s.finished_at?new Date(s.finished_at).getTime():Date.now())-t},header:({column:s})=>e.jsx(g,{column:s,children:"Duration"}),cell:({row:s})=>{const{started_at:t,finished_at:a}=s.original,n=te(t,a);return!a&&t?e.jsxs("span",{className:"text-muted-foreground",children:[n,"..."]}):n}},{accessorKey:"started_at",header:({column:s})=>e.jsx(g,{column:s,children:"Started"}),cell:({row:s})=>{const t=s.original.started_at;return t?new Date(t).toLocaleString():"-"}},{accessorKey:"reward",header:({column:s})=>e.jsx("div",{className:"text-right",children:e.jsx(g,{column:s,children:"Reward"})}),cell:({row:s})=>{const t=s.original.reward,a=s.original.error_type;return a?e.jsx("div",{className:"text-right",children:e.jsx(w,{variant:"destructive",children:a})}):t===null?e.jsx("div",{className:"text-right text-muted-foreground",children:"-"}):e.jsx("div",{className:"text-right",children:e.jsx(se,{reward:t})})}}];function y(s,t){const a=new URLSearchParams(s);return a.set("page",t.toString()),`?${a.toString()}`}function ne(s,t,a,n){const r=["harbor run"];return t&&r.push(`-d ${t}`),r.push(`-t ${s}`),a&&r.push(`-a ${a}`),n&&r.push(`-m ${n}`),r.join(" ")}function re(s,t){const a=[];if(t<=7)for(let n=1;n<=t;n++)a.push(n);else{a.push(1),s>3&&a.push("ellipsis");const n=Math.max(2,s-1),r=Math.min(t-1,s+1);for(let i=n;i<=r;i++)a.push(i);s<t-2&&a.push("ellipsis"),a.push(t)}return a}const me=z(function(){const{jobName:t,taskName:a,source:n,agent:r,modelProvider:i,modelName:c}=K(),[d]=F(),B=q(),b=parseInt(d.get("page")||"1",10),v=parseInt(d.get("pageSize")||"100",10),u=n==="_"?void 0:n,m=r==="_"?void 0:r,$=i==="_"?void 0:i,N=c==="_"?void 0:c,h=$?N?`${$}/${N}`:$:N,{data:x,isLoading:S}=E({queryKey:["trials",t,a,b,v,u,m,h],queryFn:()=>A(t,b,v,{taskName:a,source:u,agentName:m,modelName:h}),enabled:!!t&&!!a}),D=x?.items??[],C=x?.total??0,o=x?.page??b,I=x?.page_size??v,p=x?.total_pages??0,M=C>0?(o-1)*I+1:0,U=Math.min(o*I,C),T=re(o,p),f=[];return m&&f.push(h?`${m} (${h})`:m),u&&f.push(u),e.jsxs("div",{className:"container mx-auto py-10",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx(H,{className:"mb-4",children:e.jsxs(J,{children:[e.jsx(_,{children:e.jsx(R,{asChild:!0,children:e.jsx(P,{to:"/",children:"Jobs"})})}),e.jsx(k,{}),e.jsx(_,{children:e.jsx(R,{asChild:!0,children:e.jsx(P,{to:`/jobs/${encodeURIComponent(t)}`,children:t})})}),e.jsx(k,{}),e.jsx(_,{children:e.jsx(Q,{children:a})})]})}),e.jsx("h1",{className:"text-4xl font-medium mb-2",children:a}),f.length>0&&e.jsx("div",{className:"text-sm text-muted-foreground",children:f.join(" / ")})]}),e.jsx(G,{code:ne(a,u,m,h),lang:"bash",className:"-mb-px"}),e.jsx(O,{columns:ae,data:D,onRowClick:l=>B(`/jobs/${encodeURIComponent(t)}/tasks/${encodeURIComponent(n)}/${encodeURIComponent(r)}/${encodeURIComponent(i)}/${encodeURIComponent(c)}/${encodeURIComponent(a)}/trials/${encodeURIComponent(l.name)}`),isLoading:S}),p>1&&e.jsxs("div",{className:"flex items-center mt-4",children:[e.jsxs("div",{className:"flex-1 text-sm text-muted-foreground",children:["Showing ",M,"-",U," of ",C," trials"]}),e.jsx(V,{className:"flex-1 justify-center",children:e.jsxs(W,{children:[e.jsx(j,{children:e.jsx(X,{href:o>1?y(d,o-1):"#","aria-disabled":o<=1,className:o<=1?"pointer-events-none opacity-50":""})}),T.map((l,L)=>l==="ellipsis"?e.jsx(j,{children:e.jsx(Y,{})},`ellipsis-${L}`):e.jsx(j,{children:e.jsx(Z,{href:y(d,l),isActive:l===o,children:l})},l)),e.jsx(j,{children:e.jsx(ee,{href:o<p?y(d,o+1):"#","aria-disabled":o>=p,className:o>=p?"pointer-events-none opacity-50":""})})]})}),e.jsx("div",{className:"flex-1"})]})]})});export{me as default};
