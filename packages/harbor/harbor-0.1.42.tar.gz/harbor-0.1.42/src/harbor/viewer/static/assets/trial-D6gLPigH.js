import{b as g,t as e,R as _,x as qe,B as Be,v as Ke,A as X}from"./index-CYR-HZan.js";import{c as W,l as ge,k as oe,P as O,m as ve,n as ze,o as be,H as Ue,p as $,d as We,u as P,B as Ge,a as Je,b as K,q as Z,r as ee,e as Qe,L as I,I as Ye,f as he,J as ye,K as Xe,M as Ne,N as Ze,O as et}from"./api-BIjnJNxI.js";import{t as z,u as tt}from"./index-JVv6katd.js";import{g as st,E as F,a as V,b as H,c as q,d as B,u as nt}from"./empty-NX9twF5u.js";import{m as rt,T as ae,a as ie,b as M,c as R,F as ot,D as at,d as it,e as ct,f as lt,g as dt,h as ut,L as xt,S as mt,i as ht,j as pt,k as ft,l as te}from"./tabs-Cl6rAQnG.js";import{u as Ce}from"./index-0vLPmRNj.js";import{b as jt}from"./scroll-area-ROIR1FUv.js";import{C as A,B as pe}from"./code-block-D6lALSLz.js";import"./mutation--h5hHClj.js";const gt=[["circle",{cx:"6",cy:"19",r:"3",key:"1kj8tv"}],["path",{d:"M9 19h8.5a3.5 3.5 0 0 0 0-7h-11a3.5 3.5 0 0 1 0-7H15",key:"1d8sl"}],["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}]],vt=W("route",gt);const bt=[["path",{d:"M15 12h-5",key:"r7krc0"}],["path",{d:"M15 8h-5",key:"1khuty"}],["path",{d:"M19 17V5a2 2 0 0 0-2-2H4",key:"zz82l3"}],["path",{d:"M8 21h12a2 2 0 0 0 2-2v-1a1 1 0 0 0-1-1H11a1 1 0 0 0-1 1v1a2 2 0 1 1-4 0V5a2 2 0 1 0-4 0v2a1 1 0 0 0 1 1h3",key:"1ph1d7"}]],yt=W("scroll-text",bt);const Nt=[["path",{d:"M12 19h8",key:"baeox8"}],["path",{d:"m4 17 6-6-6-6",key:"1yngyt"}]],Ct=W("terminal",Nt);const _t=[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]],wt=W("triangle-alert",_t);var G="Collapsible",[kt,_e]=ge(G),[Tt,ce]=kt(G),we=g.forwardRef((t,n)=>{const{__scopeCollapsible:s,open:o,defaultOpen:a,disabled:r,onOpenChange:i,...u}=t,[m,h]=oe({prop:o,defaultProp:a??!1,onChange:i,caller:G});return e.jsx(Tt,{scope:s,disabled:r,contentId:Ce(),open:m,onOpenToggle:g.useCallback(()=>h(d=>!d),[h]),children:e.jsx(O.div,{"data-state":de(m),"data-disabled":r?"":void 0,...u,ref:n})})});we.displayName=G;var ke="CollapsibleTrigger",Te=g.forwardRef((t,n)=>{const{__scopeCollapsible:s,...o}=t,a=ce(ke,s);return e.jsx(O.button,{type:"button","aria-controls":a.contentId,"aria-expanded":a.open||!1,"data-state":de(a.open),"data-disabled":a.disabled?"":void 0,disabled:a.disabled,...o,ref:n,onClick:ve(t.onClick,a.onOpenToggle)})});Te.displayName=ke;var le="CollapsibleContent",Se=g.forwardRef((t,n)=>{const{forceMount:s,...o}=t,a=ce(le,t.__scopeCollapsible);return e.jsx(ze,{present:s||a.open,children:({present:r})=>e.jsx(St,{...o,ref:n,present:r})})});Se.displayName=le;var St=g.forwardRef((t,n)=>{const{__scopeCollapsible:s,present:o,children:a,...r}=t,i=ce(le,s),[u,m]=g.useState(o),h=g.useRef(null),d=be(n,h),j=g.useRef(0),p=j.current,f=g.useRef(0),v=f.current,b=i.open||u,x=g.useRef(b),c=g.useRef(void 0);return g.useEffect(()=>{const l=requestAnimationFrame(()=>x.current=!1);return()=>cancelAnimationFrame(l)},[]),Ue(()=>{const l=h.current;if(l){c.current=c.current||{transitionDuration:l.style.transitionDuration,animationName:l.style.animationName},l.style.transitionDuration="0s",l.style.animationName="none";const y=l.getBoundingClientRect();j.current=y.height,f.current=y.width,x.current||(l.style.transitionDuration=c.current.transitionDuration,l.style.animationName=c.current.animationName),m(o)}},[i.open,o]),e.jsx(O.div,{"data-state":de(i.open),"data-disabled":i.disabled?"":void 0,id:i.contentId,hidden:!b,...r,ref:d,style:{"--radix-collapsible-content-height":p?`${p}px`:void 0,"--radix-collapsible-content-width":v?`${v}px`:void 0,...t.style},children:b&&a})});function de(t){return t?"open":"closed"}var At=we,It=Te,Mt=Se,T="Accordion",Rt=["Home","End","ArrowDown","ArrowUp","ArrowLeft","ArrowRight"],[ue,$t,Pt]=rt(T),[J]=ge(T,[Pt,_e]),xe=_e(),Ae=_.forwardRef((t,n)=>{const{type:s,...o}=t,a=o,r=o;return e.jsx(ue.Provider,{scope:t.__scopeAccordion,children:s==="multiple"?e.jsx(Ot,{...r,ref:n}):e.jsx(Lt,{...a,ref:n})})});Ae.displayName=T;var[Ie,Dt]=J(T),[Me,Et]=J(T,{collapsible:!1}),Lt=_.forwardRef((t,n)=>{const{value:s,defaultValue:o,onValueChange:a=()=>{},collapsible:r=!1,...i}=t,[u,m]=oe({prop:s,defaultProp:o??"",onChange:a,caller:T});return e.jsx(Ie,{scope:t.__scopeAccordion,value:_.useMemo(()=>u?[u]:[],[u]),onItemOpen:m,onItemClose:_.useCallback(()=>r&&m(""),[r,m]),children:e.jsx(Me,{scope:t.__scopeAccordion,collapsible:r,children:e.jsx(Re,{...i,ref:n})})})}),Ot=_.forwardRef((t,n)=>{const{value:s,defaultValue:o,onValueChange:a=()=>{},...r}=t,[i,u]=oe({prop:s,defaultProp:o??[],onChange:a,caller:T}),m=_.useCallback(d=>u((j=[])=>[...j,d]),[u]),h=_.useCallback(d=>u((j=[])=>j.filter(p=>p!==d)),[u]);return e.jsx(Ie,{scope:t.__scopeAccordion,value:i,onItemOpen:m,onItemClose:h,children:e.jsx(Me,{scope:t.__scopeAccordion,collapsible:!0,children:e.jsx(Re,{...r,ref:n})})})}),[Ft,Q]=J(T),Re=_.forwardRef((t,n)=>{const{__scopeAccordion:s,disabled:o,dir:a,orientation:r="vertical",...i}=t,u=_.useRef(null),m=be(u,n),h=$t(s),j=jt(a)==="ltr",p=ve(t.onKeyDown,f=>{if(!Rt.includes(f.key))return;const v=f.target,b=h().filter(Y=>!Y.ref.current?.disabled),x=b.findIndex(Y=>Y.ref.current===v),c=b.length;if(x===-1)return;f.preventDefault();let l=x;const y=0,S=c-1,D=()=>{l=x+1,l>S&&(l=y)},E=()=>{l=x-1,l<y&&(l=S)};switch(f.key){case"Home":l=y;break;case"End":l=S;break;case"ArrowRight":r==="horizontal"&&(j?D():E());break;case"ArrowDown":r==="vertical"&&D();break;case"ArrowLeft":r==="horizontal"&&(j?E():D());break;case"ArrowUp":r==="vertical"&&E();break}const He=l%c;b[He].ref.current?.focus()});return e.jsx(Ft,{scope:s,disabled:o,direction:a,orientation:r,children:e.jsx(ue.Slot,{scope:s,children:e.jsx(O.div,{...i,"data-orientation":r,ref:m,onKeyDown:o?void 0:p})})})}),U="AccordionItem",[Vt,me]=J(U),$e=_.forwardRef((t,n)=>{const{__scopeAccordion:s,value:o,...a}=t,r=Q(U,s),i=Dt(U,s),u=xe(s),m=Ce(),h=o&&i.value.includes(o)||!1,d=r.disabled||t.disabled;return e.jsx(Vt,{scope:s,open:h,disabled:d,triggerId:m,children:e.jsx(At,{"data-orientation":r.orientation,"data-state":Fe(h),...u,...a,ref:n,disabled:d,open:h,onOpenChange:j=>{j?i.onItemOpen(o):i.onItemClose(o)}})})});$e.displayName=U;var Pe="AccordionHeader",De=_.forwardRef((t,n)=>{const{__scopeAccordion:s,...o}=t,a=Q(T,s),r=me(Pe,s);return e.jsx(O.h3,{"data-orientation":a.orientation,"data-state":Fe(r.open),"data-disabled":r.disabled?"":void 0,...o,ref:n})});De.displayName=Pe;var ne="AccordionTrigger",Ee=_.forwardRef((t,n)=>{const{__scopeAccordion:s,...o}=t,a=Q(T,s),r=me(ne,s),i=Et(ne,s),u=xe(s);return e.jsx(ue.ItemSlot,{scope:s,children:e.jsx(It,{"aria-disabled":r.open&&!i.collapsible||void 0,"data-orientation":a.orientation,id:r.triggerId,...u,...o,ref:n})})});Ee.displayName=ne;var Le="AccordionContent",Oe=_.forwardRef((t,n)=>{const{__scopeAccordion:s,...o}=t,a=Q(T,s),r=me(Le,s),i=xe(s);return e.jsx(Mt,{role:"region","aria-labelledby":r.triggerId,"data-orientation":a.orientation,...i,...o,ref:n,style:{"--radix-accordion-content-height":"var(--radix-collapsible-content-height)","--radix-accordion-content-width":"var(--radix-collapsible-content-width)",...t.style}})});Oe.displayName=Le;function Fe(t){return t?"open":"closed"}var Ht=Ae,qt=$e,Bt=De,Kt=Ee,zt=Oe;function Ut({...t}){return e.jsx(Ht,{"data-slot":"accordion",...t})}function Wt({className:t,...n}){return e.jsx(qt,{"data-slot":"accordion-item",className:$("border-b last:border-b-0",t),...n})}function Gt({className:t,children:n,...s}){return e.jsx(Bt,{className:"flex min-w-0",children:e.jsxs(Kt,{"data-slot":"accordion-trigger",className:$("group focus-visible:border-ring focus-visible:ring-ring/50 flex flex-1 min-w-0 items-start justify-between gap-4 rounded-md py-4 text-left text-sm transition-all outline-none focus-visible:ring-[3px] disabled:pointer-events-none disabled:opacity-50 [&[data-state=open]>svg]:rotate-180",t),...s,children:[n,e.jsx(st,{className:"text-muted-foreground pointer-events-none size-4 shrink-0 translate-y-0.5 transition-transform duration-200"})]})})}function Jt({className:t,children:n,...s}){return e.jsx(zt,{"data-slot":"accordion-content",className:"data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down overflow-hidden text-sm",...s,children:e.jsx("div",{className:$("pt-0 pb-4",t),children:n})})}function N({className:t,...n}){return e.jsx("div",{"data-slot":"card",className:$("bg-card text-card-foreground flex flex-col gap-6 border py-6",t),...n})}function w({className:t,...n}){return e.jsx("div",{"data-slot":"card-header",className:$("flex flex-col gap-1.5 px-6",t),...n})}function k({className:t,...n}){return e.jsx("div",{"data-slot":"card-title",className:$("leading-none font-semibold",t),...n})}function C({className:t,...n}){return e.jsx("div",{"data-slot":"card-content",className:$("px-6",t),...n})}function Qt(t){return t?new Date(t).toLocaleString():"-"}function Ve(t,n){if(!t)return"-";const s=new Date(t).getTime(),a=(n?new Date(n).getTime():Date.now())-s,r=Math.floor(a/1e3),i=Math.floor(r/60),u=Math.floor(i/60);return u>0?`${u}h ${i%60}m ${r%60}s`:i>0?`${i}m ${r%60}s`:`${r}s`}function Yt(t){if(!t?.started_at)return 0;const n=new Date(t.started_at).getTime();return(t.finished_at?new Date(t.finished_at).getTime():Date.now())-n}function Xt({segments:t,totalLabel:n}){const[s,o]=g.useState(null),[a,r]=g.useState(0),i=t.reduce((x,c)=>x+c.value,0);if(i===0)return e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"h-8 bg-muted"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"No token data"})]});const u=1,m=t.map(x=>x.value>0?x.value/i*100:0),h=m.map(x=>x>0&&x<u),d=h.reduce((x,c,l)=>c?x+(u-m[l]):x,0),j=m.reduce((x,c,l)=>!h[l]&&c>0?x+c:x,0),p=j>0?(j-d)/j:1,f=m.map((x,c)=>x===0?0:h[c]?u:x*p),v=[];let b=0;for(let x=0;x<f.length;x++)v.push(b),b+=f[x];return e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"relative",children:[s!==null&&e.jsx("div",{className:"absolute bottom-full mb-2 z-10 -translate-x-1/2 pointer-events-none",style:{left:`${a}%`},children:e.jsxs("div",{className:"bg-popover border border-border rounded-md shadow-md px-3 py-2 whitespace-nowrap",children:[e.jsx("div",{className:"text-sm font-medium",children:t[s].label}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[t[s].value.toLocaleString()," tokens"]})]})}),e.jsx("div",{className:"flex h-8 overflow-hidden",children:t.map((x,c)=>{if(x.value===0)return null;const l=f[c],y=s!==null&&s!==c,S=v[c]+l/2;return e.jsx("div",{className:"transition-opacity duration-150",style:{width:`${l}%`,backgroundColor:x.color,opacity:y?.3:1},onMouseEnter:()=>{o(c),r(S)},onMouseLeave:()=>o(null)},x.label)})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex gap-4",children:t.map((x,c)=>{if(x.value===0)return null;const l=h[c];return e.jsxs("div",{className:"flex items-center gap-1.5 text-xs",children:[e.jsx("div",{className:"w-2.5 h-2.5 rounded-sm",style:{backgroundColor:x.color}}),e.jsxs("span",{className:"text-muted-foreground",children:[x.label,l&&" (scaled)"]})]},x.label)})}),e.jsx("div",{className:"text-xs text-muted-foreground",children:n})]})]})}function Zt({phases:t,totalDuration:n}){const[s,o]=g.useState(null),[a,r]=g.useState(0),i=t.map(c=>Yt(c.timing)),u=i.reduce((c,l)=>c+l,0);if(u===0)return e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"h-8 bg-muted rounded"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"No timing data"})]});const m=1,h=i.map(c=>c>0?c/u*100:0),d=h.map(c=>c>0&&c<m),j=d.reduce((c,l,y)=>l?c+(m-h[y]):c,0),p=h.reduce((c,l,y)=>!d[y]&&l>0?c+l:c,0),f=p>0?(p-j)/p:1,v=h.map((c,l)=>c===0?0:d[l]?m:c*f),b=[];let x=0;for(let c=0;c<v.length;c++)b.push(x),x+=v[c];return e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"relative",children:[s!==null&&e.jsx("div",{className:"absolute bottom-full mb-2 z-10 -translate-x-1/2 pointer-events-none",style:{left:`${a}%`},children:e.jsxs("div",{className:"bg-popover border border-border rounded-md shadow-md px-3 py-2 whitespace-nowrap",children:[e.jsx("div",{className:"text-sm font-medium",children:t[s].label}),e.jsx("div",{className:"text-sm text-muted-foreground",children:Ve(t[s].timing?.started_at??null,t[s].timing?.finished_at??null)})]})}),e.jsx("div",{className:"flex h-8 overflow-hidden",children:t.map((c,l)=>{if(i[l]===0)return null;const S=v[l],D=s!==null&&s!==l,E=b[l]+S/2;return e.jsx("div",{className:"transition-opacity duration-150",style:{width:`${S}%`,backgroundColor:c.color,opacity:D?.3:1},onMouseEnter:()=>{o(l),r(E)},onMouseLeave:()=>o(null)},c.label)})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex gap-4",children:t.map((c,l)=>{if(i[l]===0)return null;const S=d[l];return e.jsxs("div",{className:"flex items-center gap-1.5 text-xs",children:[e.jsx("div",{className:"w-2.5 h-2.5 rounded-sm",style:{backgroundColor:c.color}}),e.jsxs("span",{className:"text-muted-foreground",children:[c.label,S&&" (scaled)"]})]},c.label)})}),e.jsx("div",{className:"text-xs text-muted-foreground",children:n})]})]})}function se({label:t,value:n,className:s,showBorder:o=!0}){return e.jsxs("div",{className:`flex justify-between py-1 text-sm ${o?"border-b border-border last:border-0":""}`,children:[e.jsx("span",{className:"text-muted-foreground",children:t}),e.jsx("span",{className:s,children:n})]})}function fe(t,n){if(!t||!n)return null;const s=new Date(t).getTime(),a=new Date(n).getTime()-s;return a<0?null:re(a)}function re(t){const n=t/1e3;if(n<60)return`${n.toFixed(1)}s`;const s=Math.floor(n/60),o=n%60;return`${s}m ${o.toFixed(0)}s`}function es({step:t}){const s={agent:"text-purple-600 dark:text-purple-300"}.agent;return e.jsxs("div",{className:"space-y-3",children:[t.message&&e.jsx("div",{className:"text-sm whitespace-pre-wrap wrap-break-words",children:t.message}),t.reasoning_content&&e.jsxs("div",{children:[e.jsx("h5",{className:"text-xs font-medium text-muted-foreground mb-1",children:"Reasoning"}),e.jsx("pre",{className:"text-xs bg-muted p-2 overflow-x-auto whitespace-pre-wrap",children:t.reasoning_content})]}),t.tool_calls&&t.tool_calls.length>0&&e.jsxs("div",{children:[e.jsx("h5",{className:"text-xs font-medium text-muted-foreground mb-1",children:"Tool Calls"}),t.tool_calls.map(o=>e.jsxs("div",{className:"mb-2",children:[e.jsx("div",{className:`text-xs font-mono mb-1 ${s}`,children:o.function_name}),e.jsx(A,{code:JSON.stringify(o.arguments,null,2),lang:"json"})]},o.tool_call_id))]}),t.observation&&t.observation.results.length>0&&e.jsxs("div",{children:[e.jsx("h5",{className:"text-xs font-medium text-muted-foreground mb-1",children:"Observations"}),t.observation.results.map((o,a)=>e.jsx("div",{className:"mb-2",children:e.jsx(A,{code:o.content||"(empty)",lang:"text"})},a))]}),t.metrics&&e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Tokens: ",(t.metrics.prompt_tokens??0).toLocaleString()," prompt /"," ",(t.metrics.completion_tokens??0).toLocaleString()," completion",t.metrics.cost_usd&&` / $${t.metrics.cost_usd.toFixed(4)}`]})]})}function ts({step:t,prevTimestamp:n,startTimestamp:s}){const o={system:"text-gray-600 dark:text-gray-300",user:"text-blue-600 dark:text-blue-300",agent:"text-purple-600 dark:text-purple-300"},a=fe(n,t.timestamp),r=fe(s,t.timestamp),i=t.message?.split(`
`)[0]||null;return e.jsxs("div",{className:"flex-1 min-w-0 flex items-center gap-4 overflow-hidden",children:[e.jsxs("div",{className:"flex-1 min-w-0 flex items-center gap-2 overflow-hidden",children:[e.jsxs("span",{className:"text-xs text-muted-foreground shrink-0",children:["#",t.step_id]}),e.jsx("span",{className:`text-xs font-medium shrink-0 ${o[t.source]}`,children:t.source}),t.model_name&&e.jsx("span",{className:"text-xs text-muted-foreground shrink-0",children:t.model_name}),e.jsx("span",{className:"text-xs truncate min-w-0 transition-colors group-data-[state=open]:text-border",children:i||e.jsx("span",{className:"text-muted-foreground italic",children:"No message"})})]}),(r||a)&&e.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground shrink-0",children:[a&&e.jsxs(pe,{variant:"secondary",className:"text-xs font-normal",children:["+",a]}),r&&e.jsx(pe,{variant:"outline",className:"text-xs font-normal",children:r})]})]})}function ss(t){const n=["var(--color-neutral-400)","var(--color-neutral-500)","var(--color-neutral-600)","var(--color-neutral-700)"],s=t%6,o=s<=3?s:6-s;return n[o]}function ns({steps:t,onStepClick:n}){const[s,o]=g.useState(null),[a,r]=g.useState(0);if(t.length===0)return null;const i=t[0].timestamp?new Date(t[0].timestamp).getTime():0,u=t.map((p,f)=>{const v=p.timestamp?new Date(p.timestamp).getTime():0,b=f>0?t[f-1]:null,x=b?.timestamp?new Date(b.timestamp).getTime():v;return{stepId:p.step_id,durationMs:Math.max(0,v-x),elapsedMs:v-i}}),m=u.reduce((p,f)=>p+f.durationMs,0);if(m===0)return e.jsx("div",{className:"mb-4",children:e.jsx("div",{className:"h-6 bg-muted"})});const h=u.map(p=>p.durationMs/m*100),d=[];let j=0;for(const p of h)d.push(j),j+=p;return e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"relative",children:[s!==null&&e.jsx("div",{className:"absolute bottom-full mb-2 z-10 -translate-x-1/2 pointer-events-none",style:{left:`${a}%`},children:e.jsxs("div",{className:"bg-popover border border-border rounded-md shadow-md px-3 py-2 whitespace-nowrap",children:[e.jsxs("div",{className:"text-sm font-medium",children:["Step #",u[s].stepId]}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Duration: ",re(u[s].durationMs)]}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Started at: ",re(u[s].elapsedMs)]})]})}),e.jsx("div",{className:"flex h-6 overflow-hidden",children:u.map((p,f)=>{if(p.durationMs===0)return null;const v=h[f],b=s!==null&&s!==f,x=d[f]+v/2;return e.jsx("div",{className:"transition-opacity duration-150 cursor-pointer",style:{width:`${v}%`,backgroundColor:ss(f),opacity:b?.3:1},onMouseEnter:()=>{o(f),r(x)},onMouseLeave:()=>o(null),onClick:()=>n(f)},p.stepId)})})]})})}function rs({jobName:t,trialName:n}){const{data:s,isLoading:o}=P({queryKey:["trajectory",t,n],queryFn:()=>ye(t,n)}),[a,r]=g.useState([]),i=g.useRef([]);if(o)return e.jsxs(N,{children:[e.jsx(w,{children:e.jsx(k,{children:"Trajectory"})}),e.jsx(C,{children:e.jsx("div",{className:"text-sm text-muted-foreground",children:e.jsx(I,{})})})]});if(!s)return e.jsx(F,{className:"bg-card border",children:e.jsxs(V,{children:[e.jsx(H,{variant:"icon",children:e.jsx(vt,{})}),e.jsx(q,{children:"No trajectory"}),e.jsxs(B,{children:["No ATIF trajectory found at ",n,"/agent/trajectory.json"]})]})});const u=m=>{const h=`step-${m}`;r(d=>d.includes(h)?d:[...d,h]),i.current[m]?.scrollIntoView({behavior:"smooth",block:"start"})};return e.jsxs(N,{children:[e.jsxs(w,{children:[e.jsx(k,{children:"Trajectory"}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[s.steps.length," steps",s.final_metrics?.total_cost_usd&&e.jsxs(e.Fragment,{children:[" / $",s.final_metrics.total_cost_usd.toFixed(4)," total"]})]})]}),e.jsxs(C,{children:[e.jsx(ns,{steps:s.steps,onStepClick:u}),e.jsx(Ut,{type:"multiple",value:a,onValueChange:r,children:s.steps.map((m,h)=>e.jsxs(Wt,{value:`step-${h}`,ref:d=>{i.current[h]=d},children:[e.jsx(Gt,{children:e.jsx(ts,{step:m,prevTimestamp:h>0?s.steps[h-1]?.timestamp??null:null,startTimestamp:s.steps[0]?.timestamp??null})}),e.jsx(Jt,{children:e.jsx(es,{step:m})})]},m.step_id))})]})]})}function os({jobName:t,trialName:n}){const{data:s,isLoading:o}=P({queryKey:["verifier-output",t,n],queryFn:()=>Xe(t,n)});if(o)return e.jsxs(N,{children:[e.jsx(w,{children:e.jsx(k,{children:"Verifier Output"})}),e.jsx(C,{children:e.jsx("div",{className:"text-sm text-muted-foreground",children:e.jsx(I,{})})})]});const a=!!s?.stdout,r=!!s?.ctrf;return!a&&!r?e.jsx(F,{className:"bg-card border",children:e.jsxs(V,{children:[e.jsx(H,{variant:"icon",children:e.jsx(yt,{})}),e.jsx(q,{children:"No verifier logs"}),e.jsx(B,{children:"No test output or CTRF results found"})]})}):a&&r?e.jsx(N,{className:"py-0 gap-0",children:e.jsx(C,{className:"p-0",children:e.jsxs(ae,{defaultValue:"stdout",children:[e.jsxs(ie,{children:[e.jsx(M,{value:"stdout",children:"Output"}),e.jsx(M,{value:"ctrf",children:"CTRF"})]}),e.jsx(R,{value:"stdout",className:"mt-0 -mx-px",children:e.jsx(A,{code:s.stdout,lang:"text"})}),e.jsx(R,{value:"ctrf",className:"mt-0 -mx-px",children:e.jsx(A,{code:s.ctrf,lang:"json"})})]})})}):a?e.jsx(A,{code:s.stdout,lang:"text"}):e.jsx(A,{code:s.ctrf,lang:"json"})}function as({jobName:t,trialName:n}){const s=tt(),[o,a]=g.useState(!1),[r,i]=g.useState("haiku"),u=nt({mutationFn:()=>Ye(t,n,r),onSuccess:()=>{s.invalidateQueries({queryKey:["agent-logs",t,n]}),a(!1),z.success("Summary generated")},onError:m=>{z.error("Failed to generate summary",{description:m.message})}});return e.jsxs(at,{open:o,onOpenChange:a,children:[e.jsx(it,{asChild:!0,children:e.jsx(he,{children:"Generate Summary"})}),e.jsxs(ct,{children:[e.jsxs(lt,{children:[e.jsx(dt,{children:"Generate Summary"}),e.jsx(ut,{children:"Use Claude to analyze this trial and generate a summary."})]}),e.jsxs("div",{className:"space-y-4 pt-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(xt,{htmlFor:"model",children:"Model"}),e.jsxs(mt,{value:r,onValueChange:i,children:[e.jsx(ht,{id:"model",children:e.jsx(pt,{})}),e.jsxs(ft,{children:[e.jsx(te,{value:"haiku",children:"Haiku (Recommended)"}),e.jsx(te,{value:"sonnet",children:"Sonnet"}),e.jsx(te,{value:"opus",children:"Opus"})]})]})]}),e.jsx(he,{className:"w-full",onClick:()=>u.mutate(),disabled:u.isPending,children:u.isPending?e.jsx(I,{text:"Generating"}):"Generate"})]})]})]})}function is({jobName:t,trialName:n}){const{data:s,isLoading:o}=P({queryKey:["agent-logs",t,n],queryFn:()=>Ne(t,n)});return o?e.jsxs(N,{children:[e.jsx(w,{children:e.jsx(k,{children:"Summary"})}),e.jsx(C,{children:e.jsx("div",{className:"text-sm text-muted-foreground",children:e.jsx(I,{})})})]}):s?.summary?e.jsx(A,{code:s.summary,lang:"markdown",wrap:!0}):e.jsxs(F,{className:"bg-card border",children:[e.jsxs(V,{children:[e.jsx(H,{variant:"icon",children:e.jsx(ot,{})}),e.jsx(q,{children:"No summary"}),e.jsx(B,{children:"Generate a summary of this trial using Claude."})]}),e.jsx(as,{jobName:t,trialName:n})]})}function cs({jobName:t,trialName:n}){const{data:s,isLoading:o}=P({queryKey:["exception",t,n],queryFn:()=>Ze(t,n)});return o?e.jsxs(N,{children:[e.jsx(w,{children:e.jsx(k,{children:"Exception"})}),e.jsx(C,{children:e.jsx("div",{className:"text-sm text-muted-foreground",children:e.jsx(I,{})})})]}):s?e.jsx(A,{code:s,lang:"text"}):e.jsx(F,{className:"bg-card border",children:e.jsxs(V,{children:[e.jsx(H,{variant:"icon",children:e.jsx(wt,{})}),e.jsx(q,{children:"No exception"}),e.jsx(B,{children:"No exception.txt file found in this trial."})]})})}function ls({jobName:t,trialName:n}){const{data:s,isLoading:o}=P({queryKey:["agent-logs",t,n],queryFn:()=>Ne(t,n)});if(o)return e.jsxs(N,{children:[e.jsx(w,{children:e.jsx(k,{children:"Agent Logs"})}),e.jsx(C,{children:e.jsx("div",{className:"text-sm text-muted-foreground",children:e.jsx(I,{})})})]});if(!(s&&(s.oracle||s.setup||s.commands.length>0)))return e.jsx(F,{className:"bg-card border",children:e.jsxs(V,{children:[e.jsx(H,{variant:"icon",children:e.jsx(Ct,{})}),e.jsx(q,{children:"No agent logs"}),e.jsx(B,{children:"No oracle, setup, or command logs found"})]})});const r=[];s.oracle&&r.push({id:"oracle",label:"Oracle",content:s.oracle,lang:"text"}),s.setup&&r.push({id:"setup",label:"Setup",content:s.setup,lang:"text"});for(const i of s.commands)r.push({id:`command-${i.index}`,label:`Command ${i.index}`,content:i.content,lang:"text"});return r.length===0?null:e.jsx(N,{className:"py-0 gap-0",children:e.jsx(C,{className:"p-0",children:e.jsxs(ae,{defaultValue:r[0].id,children:[e.jsx(ie,{children:r.map(i=>e.jsx(M,{value:i.id,children:i.label},i.id))}),r.map(i=>e.jsx(R,{value:i.id,className:"mt-0 -mx-px",children:e.jsx(A,{code:i.content,lang:i.lang})},i.id))]})})})}function ds(t){const n=["harbor run"];t.source&&n.push(`-d ${t.source}`),n.push(`-t ${t.task_name}`),n.push(`-a ${t.agent_info.name}`);const s=t.agent_info.model_info;if(s){const o=s.provider?`${s.provider}/${s.name}`:s.name;n.push(`-m ${o}`)}return n.join(" ")}function L({value:t}){const n=async()=>{await navigator.clipboard.writeText(t),z("Copied to clipboard",{description:t})};return e.jsx("span",{onClick:n,className:"cursor-default hover:text-foreground transition-colors",children:t})}function je(t,n){return`/jobs/${encodeURIComponent(t)}/tasks/${encodeURIComponent(n.source)}/${encodeURIComponent(n.agent)}/${encodeURIComponent(n.modelProvider)}/${encodeURIComponent(n.modelName)}/${encodeURIComponent(n.taskName)}`}function us({trial:t,jobName:n,trialName:s}){const{data:o}=P({queryKey:["trajectory",n,s],queryFn:()=>ye(n,s)}),a=t.verifier_result?.rewards?.reward??null,r=o?.final_metrics;return e.jsxs(e.Fragment,{children:[e.jsx(A,{code:ds(t),lang:"bash",className:"-mb-px -mx-px"}),e.jsxs("div",{className:"grid grid-cols-1 -mx-px",children:[e.jsxs(N,{className:"-mb-px gap-3 py-4",children:[e.jsxs(w,{className:"flex flex-row items-center justify-between",children:[e.jsx(k,{children:"Outcome"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:Qt(t.started_at)})]}),e.jsxs(C,{children:[e.jsx(se,{label:"Reward",value:a!==null?a.toFixed(2):"-",showBorder:!1}),r?.total_cost_usd&&e.jsx(se,{label:"Cost",value:`$${r.total_cost_usd.toFixed(4)}`,showBorder:!1}),t.exception_info&&e.jsx(se,{label:"Error",value:t.exception_info.exception_type,className:"text-destructive",showBorder:!1})]})]}),e.jsxs(N,{className:"-mb-px -mt-px gap-3 py-4",children:[e.jsx(w,{children:e.jsx(k,{children:"Tokens"})}),e.jsx(C,{children:e.jsx(Xt,{segments:[{label:"Cached",value:r?.total_cached_tokens??0,color:"var(--color-neutral-400)"},{label:"Prompt",value:Math.max(0,(r?.total_prompt_tokens??0)-(r?.total_cached_tokens??0)),color:"var(--color-neutral-500)"},{label:"Output",value:r?.total_completion_tokens??0,color:"var(--color-neutral-600)"}],totalLabel:`${((r?.total_prompt_tokens??0)+(r?.total_completion_tokens??0)).toLocaleString()} tokens`})})]}),e.jsxs(N,{className:"-mt-px gap-3 py-4",children:[e.jsx(w,{children:e.jsx(k,{children:"Timing"})}),e.jsx(C,{children:e.jsx(Zt,{phases:[{label:"Env Setup",timing:t.environment_setup,color:"var(--color-neutral-400)"},{label:"Agent Setup",timing:t.agent_setup,color:"var(--color-neutral-500)"},{label:"Agent Execution",timing:t.agent_execution,color:"var(--color-neutral-600)"},{label:"Verifier",timing:t.verifier,color:"var(--color-neutral-700)"}],totalDuration:Ve(t.started_at,t.finished_at)})})]})]}),e.jsxs(ae,{defaultValue:"trajectory",className:"mt-6",children:[e.jsxs(ie,{className:"bg-card border border-b-0 w-full",children:[e.jsx(M,{value:"trajectory",children:"Trajectory"}),e.jsx(M,{value:"agent-logs",children:"Agent Logs"}),e.jsx(M,{value:"test-output",children:"Verifier Logs"}),e.jsx(M,{value:"summary",children:"Summary"}),e.jsx(M,{value:"exception",children:"Exception"})]}),e.jsx(R,{value:"trajectory",forceMount:!0,className:"data-[state=inactive]:hidden",children:e.jsx(rs,{jobName:n,trialName:s})}),e.jsx(R,{value:"agent-logs",forceMount:!0,className:"data-[state=inactive]:hidden",children:e.jsx(ls,{jobName:n,trialName:s})}),e.jsx(R,{value:"test-output",forceMount:!0,className:"data-[state=inactive]:hidden",children:e.jsx(os,{jobName:n,trialName:s})}),e.jsx(R,{value:"summary",forceMount:!0,className:"data-[state=inactive]:hidden",children:e.jsx(is,{jobName:n,trialName:s})}),e.jsx(R,{value:"exception",forceMount:!0,className:"data-[state=inactive]:hidden",children:e.jsx(cs,{jobName:n,trialName:s})})]})]})}function xs(){return e.jsxs("div",{className:"grid grid-cols-1 -mx-px",children:[e.jsxs(N,{className:"-mb-px gap-3 py-4",children:[e.jsx(w,{children:e.jsx(k,{children:"Outcome"})}),e.jsx(C,{children:e.jsx("div",{className:"text-sm text-muted-foreground",children:e.jsx(I,{})})})]}),e.jsxs(N,{className:"-mb-px -mt-px gap-3 py-4",children:[e.jsx(w,{children:e.jsx(k,{children:"Tokens"})}),e.jsx(C,{children:e.jsx("div",{className:"text-sm text-muted-foreground",children:e.jsx(I,{})})})]}),e.jsxs(N,{className:"-mt-px gap-3 py-4",children:[e.jsx(w,{children:e.jsx(k,{children:"Timing"})}),e.jsx(C,{children:e.jsx("div",{className:"text-sm text-muted-foreground",children:e.jsx(I,{})})})]})]})}const Ns=qe(function(){const{jobName:n,trialName:s,source:o,agent:a,modelProvider:r,modelName:i,taskName:u}=Be(),m=Ke(),h={source:o,agent:a,modelProvider:r,modelName:i,taskName:u};We("escape",()=>m(je(n,h)),{enableOnFormTags:!1});const{data:d,isLoading:j,error:p}=P({queryKey:["trial",n,s],queryFn:()=>et(n,s),enabled:!!n&&!!s});return e.jsxs("div",{className:"container mx-auto py-10",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx(Ge,{className:"mb-4",children:e.jsxs(Je,{children:[e.jsx(K,{children:e.jsx(Z,{asChild:!0,children:e.jsx(X,{to:"/",children:"Jobs"})})}),e.jsx(ee,{}),e.jsx(K,{children:e.jsx(Z,{asChild:!0,children:e.jsx(X,{to:`/jobs/${encodeURIComponent(n)}`,children:n})})}),e.jsx(ee,{}),e.jsx(K,{children:e.jsx(Z,{asChild:!0,children:e.jsx(X,{to:je(n,h),children:u})})}),e.jsx(ee,{}),e.jsx(K,{children:e.jsx(Qe,{children:s})})]})}),e.jsx("h1",{className:"text-4xl font-medium mb-4 w-fit cursor-default hover:text-foreground/80 transition-colors",onClick:async()=>{await navigator.clipboard.writeText(s),z("Copied to clipboard",{description:s})},children:s}),j?e.jsx("div",{className:"text-sm text-muted-foreground",children:e.jsx(I,{})}):d?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex gap-2 text-sm text-muted-foreground",children:[d.source&&e.jsxs(e.Fragment,{children:[e.jsx(L,{value:d.source}),e.jsx("span",{className:"text-border",children:"|"})]}),e.jsx(L,{value:d.task_name}),e.jsx("span",{className:"text-border",children:"|"}),e.jsx(L,{value:d.agent_info.version&&d.agent_info.version!=="unknown"?`${d.agent_info.name}@${d.agent_info.version}`:d.agent_info.name}),d.agent_info.model_info&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-border",children:"|"}),e.jsx(L,{value:`${d.agent_info.model_info.provider}/${d.agent_info.model_info.name}`})]})]}),e.jsx("div",{className:"text-xs text-muted-foreground mt-3",children:e.jsx(L,{value:d.trial_uri.startsWith("file://")?d.trial_uri.slice(7):d.trial_uri})})]}):null]}),!j&&(p||!d)?e.jsx("div",{className:"text-destructive",children:p instanceof Error?p.message:"Failed to load trial"}):j?e.jsx(xs,{}):d?e.jsx(us,{trial:d,jobName:n,trialName:s}):null]})});export{Ns as default};
