import{x as me,A as he,v as xe,b as o,t as e,B as je}from"./index-C6J4Pqq0.js";import{h as ge,g as T,B as pe,i as ve,j as U,q as be,r as fe,k as ye,l as R,m as Ne,s as Ce,L as ke,t as _e,v as Se,w as we,x as Te}from"./api-BcmuLCHF.js";import{u as G,t as p,l as De}from"./index-DDT61vXN.js";import{d as H,X as Fe,E as Pe,e as Ee,f as Ke,g as Me,h as Ie}from"./index-BvBHXW9B.js";import{u as k,a as _,p as D,T as Re,I as W,S as qe,C as F}from"./input-BxPSwHG2.js";import{C as Ae,B as Be}from"./code-block-DDYuxYAe.js";import{u as Le,a as ze,K as f,D as Oe,P as Ue,b as Ve,d,e as $e,f as S,g as V,h as Je,S as j,C as Qe}from"./hooks-DEbwiSBQ.js";import{T as Ge,a as He,b as $,c as J,F as We,D as Xe,d as Ze,e as Ye,f as es,g as ss,h as as,L as K,S as rs,i as ts,j as ns,k as ls,l as M}from"./tabs-DLoOSzrc.js";import"./mutation-CzWEsub0.js";import"./compare-Br3z3FUS-D05ZBVBy.js";function os({value:s}){const a=async()=>{await navigator.clipboard.writeText(s),p("Copied to clipboard",{description:s})};return e.jsx("span",{onClick:a,className:"cursor-default hover:text-foreground transition-colors",children:s})}function is({jobName:s}){const a=G(),[n,v]=o.useState(!1),[u,g]=o.useState("haiku"),[t,i]=o.useState(32),[b,w]=o.useState(!0),c=H({mutationFn:()=>Ce(s,u,t,b),onSuccess:l=>{a.invalidateQueries({queryKey:["job-summary",s]}),v(!1),l.n_trials_summarized>0&&l.job_summary_created?p.success(`Summarized ${l.n_trials_summarized} trial${l.n_trials_summarized===1?"":"s"}`):l.job_summary_created?p.success("Job summary updated"):p.info("No trials to summarize")},onError:l=>{p.error("Failed to generate summary",{description:l.message})}});return e.jsxs(Xe,{open:n,onOpenChange:v,children:[e.jsx(Ze,{asChild:!0,children:e.jsx(R,{children:"Generate Summary"})}),e.jsxs(Ye,{children:[e.jsxs(es,{children:[e.jsx(ss,{children:"Generate Summary"}),e.jsx(as,{children:"Use Claude to analyze all failing trials and generate a summary. This can take a couple minutes."})]}),e.jsxs("div",{className:"space-y-4 pt-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(K,{htmlFor:"model",children:"Model"}),e.jsxs(rs,{value:u,onValueChange:g,children:[e.jsx(ts,{id:"model",children:e.jsx(ns,{})}),e.jsxs(ls,{children:[e.jsx(M,{value:"haiku",children:"Haiku (Recommended)"}),e.jsx(M,{value:"sonnet",children:"Sonnet"}),e.jsx(M,{value:"opus",children:"Opus"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(K,{htmlFor:"n-concurrent",children:"Concurrent Claude Codes"}),e.jsx(W,{id:"n-concurrent",type:"number",min:1,max:100,value:t,onChange:l=>i(parseInt(l.target.value)||1)})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Qe,{id:"only-failed",checked:b,onCheckedChange:l=>w(l===!0)}),e.jsx(K,{htmlFor:"only-failed",className:"font-normal",children:"Only analyze failed trials"})]}),e.jsx(R,{className:"w-full",onClick:()=>c.mutate(),disabled:c.isPending,children:c.isPending?e.jsx(ke,{text:"Generating"}):"Generate"})]})]})]})}function cs({reward:s}){const a=Math.max(0,Math.min(1,s)),n=Math.round(a*100);return e.jsx(Be,{variant:"outline",className:"tabular-nums border-transparent rounded-none",style:{backgroundColor:`color-mix(in oklab, var(--foreground) ${n}%, transparent)`,color:a>.5?"var(--background)":void 0},children:s.toFixed(2)})}function Q(s,a){const n=s.source||"_",v=s.agent_name||"_",u=s.model_provider||"_",g=s.model_name||"_";return`/jobs/${encodeURIComponent(a)}/tasks/${encodeURIComponent(n)}/${encodeURIComponent(v)}/${encodeURIComponent(u)}/${encodeURIComponent(g)}/${encodeURIComponent(s.task_name)}`}const ds=[{accessorKey:"task_name",header:({column:s})=>e.jsx(j,{column:s,children:"Task"})},{accessorKey:"agent_name",header:({column:s})=>e.jsx(j,{column:s,children:"Agent"}),cell:({row:s})=>s.original.agent_name||"-"},{accessorKey:"model_provider",header:({column:s})=>e.jsx(j,{column:s,children:"Provider"}),cell:({row:s})=>s.original.model_provider||"-"},{accessorKey:"model_name",header:({column:s})=>e.jsx(j,{column:s,children:"Model"}),cell:({row:s})=>s.original.model_name||"-"},{accessorKey:"source",header:({column:s})=>e.jsx(j,{column:s,children:"Dataset"}),cell:({row:s})=>s.original.source||"-"},{accessorKey:"n_trials",header:({column:s})=>e.jsx("div",{className:"text-right",children:e.jsx(j,{column:s,children:"Trials"})}),cell:({row:s})=>{const{n_trials:a,n_completed:n}=s.original;return n<a?e.jsxs("div",{className:"text-right",children:[n,"/",a]}):e.jsx("div",{className:"text-right",children:a})}},{accessorKey:"n_errors",header:({column:s})=>e.jsx("div",{className:"text-right",children:e.jsx(j,{column:s,children:"Errors"})}),cell:({row:s})=>{const a=s.original.n_errors;return e.jsx("div",{className:"text-right",children:a})}},{accessorKey:"avg_reward",header:({column:s})=>e.jsx("div",{className:"text-right",children:e.jsx(j,{column:s,children:"Avg Reward"})}),cell:({row:s})=>{const a=s.original.avg_reward;return a===null?e.jsx("div",{className:"text-right text-muted-foreground",children:"-"}):e.jsx("div",{className:"text-right",children:e.jsx(cs,{reward:a})})}}],I=100,ys=me(function(){const{jobName:a}=he(),n=xe(),v=G(),[u,g]=o.useState(!1),[t,i]=o.useState(1),[b,w]=k("q",_.withDefault("")),[c,l]=k("agent",D(_).withDefault([])),[y,X]=k("provider",D(_).withDefault([])),[N,Z]=k("model",D(_).withDefault([])),[C,Y]=k("task",D(_).withDefault([])),q=o.useRef(null);ge("mod+k",r=>{r.preventDefault(),q.current?.focus()},{enableOnFormTags:!0});const P=Le(b,300);o.useEffect(()=>{i(1)},[P,c,y,N,C]);const{data:m,isLoading:ee}=T({queryKey:["job",a],queryFn:()=>_e(a),enabled:!!a}),{data:h}=T({queryKey:["task-filters",a],queryFn:()=>Se(a),enabled:!!a,staleTime:6e4}),se=o.useMemo(()=>(h?.agents??[]).map(r=>({value:r.value,label:r.value,count:r.count})),[h?.agents]),ae=o.useMemo(()=>(h?.providers??[]).map(r=>({value:r.value,label:r.value,count:r.count})),[h?.providers]),re=o.useMemo(()=>(h?.models??[]).map(r=>({value:r.value,label:r.value,count:r.count})),[h?.models]),te=o.useMemo(()=>(h?.tasks??[]).map(r=>({value:r.value,label:r.value,count:r.count})),[h?.tasks]),{data:E,isLoading:ne}=T({queryKey:["tasks",a,t,P,c,y,N,C],queryFn:()=>we(a,t,I,{search:P||void 0,agents:c.length>0?c:void 0,providers:y.length>0?y:void 0,models:N.length>0?N:void 0,tasks:C.length>0?C:void 0}),enabled:!!a,placeholderData:De}),A=E?.items??[],x=E?.total_pages??0,B=E?.total??0,[L,le]=o.useState("results"),{highlightedIndex:oe}=ze({rows:A,onNavigate:r=>n(Q(r,a)),onEscapeUnhighlighted:()=>n("/"),enabled:L==="results"}),{data:z}=T({queryKey:["job-summary",a],queryFn:()=>Te(a),enabled:!!a}),O=H({mutationFn:()=>Ne(a),onSuccess:()=>{v.invalidateQueries({queryKey:["jobs"]}),p("Job deleted",{description:a}),n("/")},onError:r=>{p.error("Failed to delete job",{description:r.message}),g(!1)}}),ie=()=>{u?O.mutate():g(!0)};if(!ee&&!m)return e.jsx("div",{className:"container mx-auto py-10",children:e.jsx("div",{className:"text-destructive",children:"Failed to load job"})});const ce=m?.stats.n_trials??0,de=m?.n_total_trials??0,ue=m?.stats.n_errors??0;return e.jsxs("div",{className:"container mx-auto py-10",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx(pe,{className:"mb-4",children:e.jsxs(ve,{children:[e.jsx(U,{children:e.jsx(be,{asChild:!0,children:e.jsx(je,{to:"/",children:"Jobs"})})}),e.jsx(fe,{}),e.jsx(U,{children:e.jsx(ye,{children:a})})]})}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-4xl font-medium",children:a}),e.jsxs(R,{variant:u?"destructive":"secondary",onClick:ie,onBlur:()=>g(!1),disabled:O.isPending,children:[e.jsx(Re,{className:"h-4 w-4"}),u?"Confirm delete":"Delete"]})]}),e.jsxs("div",{className:"flex gap-2 text-sm text-muted-foreground mt-2",children:[e.jsxs("span",{children:[ce,"/",de," trials completed"]}),e.jsx("span",{className:"text-border",children:"|"}),e.jsxs("span",{children:[ue," errors"]})]}),m?.job_uri&&e.jsx("div",{className:"text-xs text-muted-foreground mt-3",children:e.jsx(os,{value:m.job_uri.startsWith("file://")?m.job_uri.slice(7):m.job_uri})})]}),e.jsxs(Ge,{value:L,onValueChange:le,className:"mt-6",children:[e.jsxs("div",{className:"flex items-center justify-between bg-card border border-b-0",children:[e.jsxs(He,{className:"border-0",children:[e.jsx($,{value:"results",children:"Results"}),e.jsx($,{value:"summary",children:"Summary"})]}),e.jsxs("div",{className:"flex items-center gap-3 px-3 text-xs text-muted-foreground",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(f,{children:"j"}),e.jsx(f,{children:"k"}),e.jsx("span",{children:"to navigate"})]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(f,{children:"Enter"}),e.jsx("span",{children:"to open"})]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(f,{children:"Esc"}),e.jsx("span",{children:"to deselect"})]})]})]}),e.jsxs(J,{value:"results",children:[e.jsxs("div",{className:"grid grid-cols-6 -mb-px",children:[e.jsxs("div",{className:"col-span-2 relative",children:[e.jsx(W,{ref:q,placeholder:"Search for tasks...",value:b,onChange:r=>w(r.target.value||null),size:"lg",variant:"card",className:"peer pl-9 pr-16 shadow-none"}),e.jsx(qe,{className:"pointer-events-none absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-border transition-colors peer-focus-visible:text-ring"}),b?e.jsx("button",{type:"button",onClick:()=>w(null),className:"absolute right-3 top-1/2 -translate-y-1/2 text-muted-foreground hover:text-foreground transition-colors",children:e.jsx(Fe,{className:"h-4 w-4"})}):e.jsxs("div",{className:"pointer-events-none absolute right-3 top-1/2 -translate-y-1/2 flex items-center gap-0.5",children:[e.jsx(f,{children:"âŒ˜"}),e.jsx(f,{children:"K"})]})]}),e.jsx(F,{options:se,value:c,onValueChange:l,placeholder:"All agents",searchPlaceholder:"Search agents...",emptyText:"No agents found.",variant:"card",className:"w-full border-l-0 shadow-none"}),e.jsx(F,{options:ae,value:y,onValueChange:X,placeholder:"All providers",searchPlaceholder:"Search providers...",emptyText:"No providers found.",variant:"card",className:"w-full border-l-0 shadow-none"}),e.jsx(F,{options:re,value:N,onValueChange:Z,placeholder:"All models",searchPlaceholder:"Search models...",emptyText:"No models found.",variant:"card",className:"w-full border-l-0 shadow-none"}),e.jsx(F,{options:te,value:C,onValueChange:Y,placeholder:"All tasks",searchPlaceholder:"Search tasks...",emptyText:"No tasks found.",variant:"card",className:"w-full border-l-0 shadow-none"})]}),e.jsx(Oe,{columns:ds,data:A,onRowClick:r=>n(Q(r,a)),isLoading:ne,className:"border-t-0",highlightedIndex:oe}),x>1&&e.jsxs("div",{className:"grid grid-cols-3 items-center mt-4",children:[e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Showing ",(t-1)*I+1,"-",Math.min(t*I,B)," of ",B," tasks"]}),e.jsx(Ue,{children:e.jsxs(Ve,{children:[e.jsx(d,{children:e.jsx($e,{onClick:()=>i(r=>Math.max(1,r-1)),className:t===1?"pointer-events-none opacity-50":"cursor-pointer"})}),t>2&&e.jsx(d,{children:e.jsx(S,{onClick:()=>i(1),className:"cursor-pointer",children:"1"})}),t>3&&e.jsx(d,{children:e.jsx(V,{})}),t>1&&e.jsx(d,{children:e.jsx(S,{onClick:()=>i(t-1),className:"cursor-pointer",children:t-1})}),e.jsx(d,{children:e.jsx(S,{isActive:!0,children:t})}),t<x&&e.jsx(d,{children:e.jsx(S,{onClick:()=>i(t+1),className:"cursor-pointer",children:t+1})}),t<x-2&&e.jsx(d,{children:e.jsx(V,{})}),t<x-1&&e.jsx(d,{children:e.jsx(S,{onClick:()=>i(x),className:"cursor-pointer",children:x})}),e.jsx(d,{children:e.jsx(Je,{onClick:()=>i(r=>Math.min(x,r+1)),className:t===x?"pointer-events-none opacity-50":"cursor-pointer"})})]})}),e.jsx("div",{})]})]}),e.jsx(J,{value:"summary",children:z?.summary?e.jsx(Ae,{code:z.summary,lang:"markdown",wrap:!0}):e.jsxs(Pe,{className:"bg-card border",children:[e.jsxs(Ee,{children:[e.jsx(Ke,{variant:"icon",children:e.jsx(We,{})}),e.jsx(Me,{children:"No summary"}),e.jsx(Ie,{children:"Generate a summary of all trials in this job using Claude."})]}),e.jsx(is,{jobName:a})]})})]})]})});export{ys as default};
