import"./CWj6FrbW.js";import{o as Re,g as ze}from"./C1bEftoN.js";import{p as ie,c as M,g as e,b as m,r as y,t as W,a as ae,u as z,d as Z,O as Ee,e as $,f as E,s as N}from"./Yb_TZ_Rf.js";import{s as ee}from"./CGH6oPk7.js";import{s as d,a as ne,i as C}from"./DVJdaASW.js";import{e as Ce,s as x,a as oe,u as We,k as Le,b as Ge}from"./Dcv4bg-q.js";import{b as qe,a as h,c as te,f as L}from"./DnGquTil.js";import{u as Be,_ as se,d as De,e as Ye,f as Je,g as Ue,h as Ke}from"./DcA8i6zt.js";import"./CvGjimpO.js";import{u as Qe}from"./C3A6m4-m.js";import{g as Xe}from"./CNJerZyL.js";import{u as Ze}from"./BztKn-jM.js";import{u as $e}from"./BQhJr0Qw.js";import"./69_IOA4Y.js";import"./CnA6nQDP.js";import{u as et}from"./BG8lOwfA.js";import"./DtWZc_tl.js";import{r as tt}from"./Bz2KBNfb.js";import{p as st}from"./CmJZ_CaC.js";import{S as it}from"./DOL8rH4R.js";import{S as at}from"./CVsKQj9T.js";var nt=qe('<svg style="position: absolute; top: 0; left: 0;"><g></g></svg>');function ot(T,i){ie(i,!0);const S=()=>d(w,"$isHidden",b),[b,g]=ne(),I=st(i,"sampleImageObjectFit",3,"contain"),{isHidden:w}=Be(),F=m(()=>i.sample.annotations.filter(a=>a.annotation_type!=="classification"));var t=nt(),f=M(t);let P;Ce(f,21,()=>e(F),a=>a.sample_id,(a,V)=>{it(a,{get annotation(){return e(V)},get showLabel(){return i.showLabel},get imageWidth(){return i.sample.width}})}),y(f),y(t),W(a=>{x(t,"viewBox",`0 0 ${i.sample.width} ${i.sample.height}`),x(t,"preserveAspectRatio",I()==="contain"?"xMidYMid meet":"xMidYMid slice"),x(t,"width",i.containerWidth),x(t,"height",i.containerHeight),P=oe(f,0,"",null,P,a)},[()=>({invisible:S()})]),h(T,t),ae(),g()}var lt=L('<div><span class="mr-1.5 block h-2 w-2 rounded-full"></span> </div>'),rt=L('<div class="pointer-events-none absolute inset-x-0 bottom-0 z-10 rounded-b-lg bg-black/60 px-2 py-1 text-xs font-medium text-white"><span class="block truncate"> </span></div>'),mt=L("<!> <!> <!> <!>",1);function Tt(T,i){ie(i,!0);const S=()=>d(i.selectedAnnotationFilterIds,"$selectedAnnotationFilterIds",a),b=()=>d(me,"$tagsSelected",a),g=()=>d(de,"$dimensions",a),I=()=>d(ce,"$metadataValues",a),w=()=>d(i.textEmbedding,"$textEmbedding",a),F=()=>d(fe,"$filterParams",a),t=()=>d(e(Se),"$infiniteSamples",a),f=()=>d(le,"$gridViewSampleRenderingStore",a),P=()=>d(re,"$showSampleFilenamesStore",a),[a,V]=ne(),{gridViewSampleRenderingStore:le,showSampleFilenamesStore:re}=We(),{tagsSelected:me}=et({collection_id:i.collection_id,kind:["sample"]}),{dimensionsValues:de}=Ze(),{metadataValues:ce}=$e(i.collection_id),{getCollectionVersion:ue,setfilteredSampleCount:ge}=Qe(),pe=m(()=>{var s,n;return{collection_id:i.collection_id,mode:"normal",filters:{annotation_label_ids:(s=S())!=null&&s.length?S():void 0,tag_ids:b().size>0?Array.from(b()):void 0,dimensions:g()},metadata_values:I(),text_embedding:(n=w())==null?void 0:n.embedding}}),G=s=>({...s,filters:s.filters?se.omit(s.filters,["sample_ids"]):void 0}),{filterParams:fe,updateFilterParams:_e}=De();z(()=>{var l;const s=e(pe),n=F();if(n&&se.isEqual(G(s),G(n)))return;let c=s;const v=(l=n==null?void 0:n.filters)==null?void 0:l.sample_ids;v&&v.length>0&&(c={...c,filters:{...c.filters??{},sample_ids:v}}),_e(c)});const he=m(()=>Je({...F(),collection_id:i.collection_id})),Se=m(()=>e(he).samples),o=m(()=>t()&&t().data?t().data.pages.flatMap(s=>s.data??[]):[]);let q=Z(!1),j=Z(Ee(f()));const{initialize:be,savePosition:ve,getRestoredPosition:xe}=Ye("samples_scroll");Re(async()=>{be(),await ue(i.collection_id),$(q,!0)});const B=m(()=>{var n;return[S().join(","),Array.from(b()).join(","),`${g().min_width}-${g().max_width}`,`${g().min_height}-${g().max_height}`,JSON.stringify(I()),((n=w())==null?void 0:n.queryText)||""].filter(Boolean).join("|")}),ye=m(()=>xe(e(B)));function Ie(s){const n=s.target.scrollTop;ve(n,e(B))}z(()=>{$(j,f(),!0)}),z(()=>{var s;t().isSuccess&&((s=t().data)==null?void 0:s.pages.length)>0&&ge(t().data.pages[0].total_count)});function we(){t().hasNextPage&&!t().isFetchingNextPage&&t().fetchNextPage()}function Fe(s){const n=s.currentTarget.dataset.sampleId,c=s.currentTarget.dataset.index;ze(tt.toSample({sampleId:n,collectionId:i.collection_id,sampleIndex:Number(c)}))}{const s=(v,l)=>{let r=()=>l==null?void 0:l().index,Pe=()=>l==null?void 0:l().style,D=()=>l==null?void 0:l().sampleSize;var Y=te(),ke=E(Y);Le(ke,()=>t().dataUpdatedAt,Ae=>{var J=te(),Ne=E(J);{var Me=H=>{const k=m(()=>{var O,A;return P()?e(o)[r()].file_name:(A=(O=e(o)[r()].captions)==null?void 0:O[0])==null?void 0:A.text});Ue(H,{get style(){return Pe()},get index(){return r()},dataTestId:"sample-grid-item",get collectionId(){return i.collection_id},get sampleId(){return e(o)[r()].sample_id},get dataSampleName(){return e(o)[r()].file_name},ondblclick:Fe,item:A=>{var U=mt(),K=E(U);Ke(K,{get sample(){return e(o)[r()]},get objectFit(){return e(j)}});var Q=N(K,2);ot(Q,{get sample(){return e(o)[r()]},get containerWidth(){return D()},get sampleImageObjectFit(){return e(j)},get containerHeight(){return D()}});var X=N(Q,2);{var Te=p=>{var u=lt(),_=M(u),R=N(_);y(u),W((He,Oe)=>{oe(u,1,`absolute right-1 z-10 flex items-center rounded bg-black/60 px-1.5 py-0.5 text-xs font-medium text-white backdrop-blur-sm ${e(k)?"bottom-8":"bottom-1"}`),Ge(_,`background-color: ${He??""}`),ee(R,` ${Oe??""}`)},[()=>Xe(e(o)[r()].similarity_score),()=>e(o)[r()].similarity_score.toFixed(2)]),h(p,u)};C(X,p=>{e(o)[r()].similarity_score!==void 0&&e(o)[r()].similarity_score!==null&&p(Te)})}var Ve=N(X,2);{var je=p=>{var u=rt(),_=M(u),R=M(_,!0);y(_),y(u),W(()=>{x(_,"title",e(k)),ee(R,e(k))}),h(p,u)};C(Ve,p=>{e(k)&&p(je)})}h(A,U)},$$slots:{item:!0}})};C(Ne,H=>{e(o)[r()]&&H(Me)})}h(Ae,J)}),h(v,Y)};let n=m(()=>({loading:t().isPending,error:t().isError,empty:t().isSuccess&&e(o).length===0,success:e(q)})),c=m(()=>({loadMore:we,disabled:!t().hasNextPage||t().isFetchingNextPage,loading:t().isFetchingNextPage}));at(T,{get itemCount(){return e(o).length},overScan:100,get scrollPosition(){return e(ye)},onScroll:Ie,message:{loading:"Loading samples...",error:"Error loading samples",empty:{title:"No samples found",description:"This collection doesn't contain any samples."}},get status(){return e(n)},get loader(){return e(c)},gridItem:s,$$slots:{gridItem:!0}})}ae(),V()}export{Tt as S};
