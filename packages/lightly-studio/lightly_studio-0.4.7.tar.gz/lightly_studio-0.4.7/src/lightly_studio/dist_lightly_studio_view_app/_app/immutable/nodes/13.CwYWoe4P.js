import{w as R,h as b,p as L,a as M,g as e,b as i,f as D,s as U}from"../chunks/Yb_TZ_Rf.js";import{g as k}from"../chunks/BDOtEUpJ.js";import{u as V}from"../chunks/C3A6m4-m.js";import{u as z,c as K,d as G,a as H,e as J}from"../chunks/BQhJr0Qw.js";import{u as W}from"../chunks/BG8lOwfA.js";import{s as X}from"../chunks/DcA8i6zt.js";import"../chunks/CWj6FrbW.js";import{c as Y,a as N,f as Z}from"../chunks/DnGquTil.js";import{a as $,i as ee,s as C}from"../chunks/DVJdaASW.js";import{a as te}from"../chunks/DtWZc_tl.js";import{S as ae}from"../chunks/AfXAZz1B.js";import{g as j}from"../chunks/C1bEftoN.js";import{r as I}from"../chunks/Bz2KBNfb.js";import{D as re}from"../chunks/Bkoo7fNK.js";import"../chunks/CvGjimpO.js";import{F as oe}from"../chunks/Dkrl7KTO.js";import{S as se}from"../chunks/a1JJegV1.js";import{M as ne}from"../chunks/Dqab5VQB.js";const ie=({video_frame_collection_id:s,sampleIndex:t,filter:a})=>{const r=R({isLoading:!1});return(async()=>{r.update(o=>({...o,isLoading:!0,error:void 0}));try{const{data:o}=await k({path:{video_frame_collection_id:s},query:{cursor:t<1?0:t-1,limit:3},body:{filter:a},throwOnError:!0}),{setfilteredSampleCount:l}=V();l(o==null?void 0:o.total_count);let d;const g=t>0?o.data[0]:void 0;o.data.length>2&&(d=t==0?o.data[1]:o.data[2]),r.update(_=>({..._,isLoading:!1,sampleNext:d,samplePrevious:g,error:void 0}))}catch(o){r.update(l=>({...l,isLoading:!1,error:o.message||"Failed to load adjacent frames"}))}})(),r};function le({tagIds:s,metadata:t,annotationIds:a,bounds:r}){return{sample_filter:{tag_ids:s.size>0?[...s]:void 0,metadata_filters:t?K(t):void 0,annotation_label_ids:[...a]},...r}}const de=async({params:s,url:t})=>{const a=s.collection_id,r=t.searchParams.get("index"),m=r!==null?parseInt(r):null;let o=null;if(m!==null){const{selectedAnnotationFilterIds:l}=V(),{videoFramesBoundsValues:d}=X(),{metadataValues:g}=z(),{tagsSelected:_}=W({collection_id:a,kind:["sample"]}),h=b(_),x=b(g),y=b(l),u=b(d),S=le({tagIds:h,metadata:x,annotationIds:y,bounds:u});o=ie({video_frame_collection_id:a,sampleIndex:m,filter:S})}return{frameAdjacents:o,frameIndex:m,collection_id:s.collection_id,sampleId:s.sample_id}},Le=Object.freeze(Object.defineProperty({__proto__:null,load:de},Symbol.toStringTag,{value:"Module"}));function me(s,t){L(t,!0),re(s,{get rootCollection(){return t.rootCollection},get index(){return t.frameIndex},section:"Frames",subsection:"Frame",get navigateTo(){return I.toFrames}}),M()}const ce=s=>{const t=G({path:{sample_id:s}}),a=H(),r=J(t);return{refetch:()=>{a.invalidateQueries({queryKey:t.queryKey})},videoFrame:r}};var ue=Z("<!> <!>",1);function Me(s,t){L(t,!0);const a=()=>C(e(y),"$videoFrame",m),r=()=>C(e(d),"$frameAdjacents",m),[m,o]=$(),l=i(()=>t.data.frameIndex),d=i(()=>t.data.frameAdjacents),g=i(()=>t.data.collectionId),_=i(()=>t.data.sampleId),h=i(()=>ce(e(_))),x=i(()=>e(h).refetch),y=i(()=>e(h).videoFrame),u=i(()=>a().data);function S(){var p;if(e(l)==null||!e(u)||!e(d))return null;const f=(p=r())==null?void 0:p.sampleNext;if(!f)return null;j(I.toFramesDetails(e(u).sample.collection_id,f.sample_id,e(l)+1))}function w(){var p;if(e(l)==null||!e(u)||!e(d))return null;const f=(p=r())==null?void 0:p.samplePrevious;if(!f)return null;j(I.toFramesDetails(e(u).sample.collection_id,f.sample_id,e(l)-1))}const B=()=>{j(I.toFrames(e(g)))};{const f=(c,n)=>{let v=()=>n==null?void 0:n().collection;me(c,{get rootCollection(){return v()},get frameIndex(){return e(l)}})},p=c=>{var n=ue(),v=D(n);oe(v,{get sample(){return a().data}});var P=U(v,2);ne(P,{get metadata_dict(){return a().data.sample.metadata_dict}}),N(c,n)},E=c=>{var n=Y(),v=D(n);{var P=A=>{{let q=i(()=>{var F;return!!((F=r())!=null&&F.samplePrevious)}),Q=i(()=>{var F;return!!((F=r())!=null&&F.sampleNext)});ae(A,{get hasPrevious(){return e(q)},get hasNext(){return e(Q)},onPrevious:w,onNext:S})}};ee(v,A=>{e(d)&&A(P)})}N(c,n)};let O=i(()=>`${te}/${e(u).sample_id}`),T=i(()=>{var c,n;return(c=a().data)!=null&&c.sample?{...(n=a().data)==null?void 0:n.sample,width:a().data.video.width,height:a().data.video.height}:void 0});se(s,{get collectionId(){return e(g)},get sampleId(){return e(_)},get sampleURL(){return e(O)},get sample(){return e(T)},get refetch(){return e(x)},handleEscape:B,breadcrumb:f,metadataValue:p,children:E,$$slots:{breadcrumb:!0,metadataValue:!0,default:!0}})}M(),o()}export{Me as component,Le as universal};
