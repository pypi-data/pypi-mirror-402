import"./CWj6FrbW.js";import{p as it,g as e,d as $,u as dt,c as X,s as Y,r as F,e as A,t as q,b as D,a as st,aM as gt,f as ft,O as mt,aQ as bt}from"./Yb_TZ_Rf.js";import{b as V,a as G}from"./DnGquTil.js";import{i as J,a as yt,s as xt}from"./DVJdaASW.js";import{s as u}from"./Dcv4bg-q.js";import{p as N,b as ut}from"./CmJZ_CaC.js";import{ai as lt,aj as wt,al as vt,M as Mt,a0 as _t,ab as et,a1 as at,av as zt}from"./DcA8i6zt.js";import"./CvGjimpO.js";import"./C3A6m4-m.js";import"./BztKn-jM.js";import"./69_IOA4Y.js";import"./CnA6nQDP.js";import{o as St}from"./C1bEftoN.js";import"./DtWZc_tl.js";import{s as B}from"./CGH6oPk7.js";function rt(a,t,n=!1){const m={...a};if(n)return m.x=Math.round(Math.max(t.x,Math.min(m.x,t.x+t.width-m.width))),m.y=Math.round(Math.max(t.y,Math.min(m.y,t.y+t.height-m.height))),m;{const _=a.x,i=a.y,y=a.x+a.width,c=a.y+a.height,o=Math.max(t.x,_),s=Math.max(t.y,i),b=Math.min(t.x+t.width,y),l=Math.min(t.y+t.height,c),x={x:Math.round(o),y:Math.round(s),width:Math.round(b-o),height:Math.round(l-s)};return x.width=Math.max(1,x.width),x.height=Math.max(1,x.height),x}}function j(a){return typeof a=="string"?new lt([[document.querySelector(a)]],[document.documentElement]):new lt([[a]],wt)}function kt(a){let t;for(;t=a.sourceEvent;)a=t;return a}function ct(a,t){if(a=kt(a),t===void 0&&(t=a.currentTarget),t){var n=t.ownerSVGElement||t;if(n.createSVGPoint){var h=n.createSVGPoint();return h.x=a.clientX,h.y=a.clientY,h=h.matrixTransform(t.getScreenCTM().inverse()),[h.x,h.y]}if(t.getBoundingClientRect){var m=t.getBoundingClientRect();return[a.clientX-m.left-t.clientLeft,a.clientY-m.top-t.clientTop]}}return[a.pageX,a.pageY]}const Et={passive:!1},U={capture:!0,passive:!1};function nt(a){a.stopImmediatePropagation()}function Z(a){a.preventDefault(),a.stopImmediatePropagation()}function Dt(a){var t=a.document.documentElement,n=j(a).on("dragstart.drag",Z,U);"onselectstart"in t?n.on("selectstart.drag",Z,U):(t.__noselect=t.style.MozUserSelect,t.style.MozUserSelect="none")}function Rt(a,t){var n=a.document.documentElement,h=j(a).on("dragstart.drag",null);t&&(h.on("click.drag",Z,U),setTimeout(function(){h.on("click.drag",null)},0)),"onselectstart"in n?h.on("selectstart.drag",null):(n.style.MozUserSelect=n.__noselect,delete n.__noselect)}const Q=a=>()=>a;function ot(a,{sourceEvent:t,subject:n,target:h,identifier:m,active:_,x:i,y,dx:c,dy:o,dispatch:s}){Object.defineProperties(this,{type:{value:a,enumerable:!0,configurable:!0},sourceEvent:{value:t,enumerable:!0,configurable:!0},subject:{value:n,enumerable:!0,configurable:!0},target:{value:h,enumerable:!0,configurable:!0},identifier:{value:m,enumerable:!0,configurable:!0},active:{value:_,enumerable:!0,configurable:!0},x:{value:i,enumerable:!0,configurable:!0},y:{value:y,enumerable:!0,configurable:!0},dx:{value:c,enumerable:!0,configurable:!0},dy:{value:o,enumerable:!0,configurable:!0},_:{value:s}})}ot.prototype.on=function(){var a=this._.on.apply(this._,arguments);return a===this._?this:a};function Tt(a){return!a.ctrlKey&&!a.button}function Nt(){return this.parentNode}function Ct(a,t){return t??{x:a.x,y:a.y}}function Lt(){return navigator.maxTouchPoints||"ontouchstart"in this}function ht(){var a=Tt,t=Nt,n=Ct,h=Lt,m={},_=vt("start","drag","end"),i=0,y,c,o,s,b=0;function l(r){r.on("mousedown.drag",x).filter(h).on("touchstart.drag",L).on("touchmove.drag",R,Et).on("touchend.drag touchcancel.drag",M).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function x(r,w){if(!(s||!a.call(this,r,w))){var S=I(this,t.call(this,r,w),r,w,"mouse");S&&(j(r.view).on("mousemove.drag",z,U).on("mouseup.drag",C,U),Dt(r.view),nt(r),o=!1,y=r.clientX,c=r.clientY,S("start",r))}}function z(r){if(Z(r),!o){var w=r.clientX-y,S=r.clientY-c;o=w*w+S*S>b}m.mouse("drag",r)}function C(r){j(r.view).on("mousemove.drag mouseup.drag",null),Rt(r.view,o),Z(r),m.mouse("end",r)}function L(r,w){if(a.call(this,r,w)){var S=r.changedTouches,d=t.call(this,r,w),g=S.length,v,O;for(v=0;v<g;++v)(O=I(this,d,r,w,S[v].identifier,S[v]))&&(nt(r),O("start",r,S[v]))}}function R(r){var w=r.changedTouches,S=w.length,d,g;for(d=0;d<S;++d)(g=m[w[d].identifier])&&(Z(r),g("drag",r,w[d]))}function M(r){var w=r.changedTouches,S=w.length,d,g;for(s&&clearTimeout(s),s=setTimeout(function(){s=null},500),d=0;d<S;++d)(g=m[w[d].identifier])&&(nt(r),g("end",r,w[d]))}function I(r,w,S,d,g,v){var O=_.copy(),k=ct(v||S,w),E,W,P;if((P=n.call(r,new ot("beforestart",{sourceEvent:S,target:l,identifier:g,active:i,x:k[0],y:k[1],dx:0,dy:0,dispatch:O}),d))!=null)return E=P.x-k[0]||0,W=P.y-k[1]||0,function K(H,f,T){var p=k,tt;switch(H){case"start":m[g]=K,tt=i++;break;case"end":delete m[g],--i;case"drag":k=ct(T||f,w),tt=i;break}O.call(H,r,new ot(H,{sourceEvent:f,subject:P,target:l,identifier:g,active:tt,x:k[0]+E,y:k[1]+W,dx:k[0]-p[0],dy:k[1]-p[1],dispatch:O}),d)}}return l.filter=function(r){return arguments.length?(a=typeof r=="function"?r:Q(!!r),l):a},l.container=function(r){return arguments.length?(t=typeof r=="function"?r:Q(r),l):t},l.subject=function(r){return arguments.length?(n=typeof r=="function"?r:Q(r),l):n},l.touchable=function(r){return arguments.length?(h=typeof r=="function"?r:Q(!!r),l):h},l.on=function(){var r=_.on.apply(_,arguments);return r===_?l:r},l.clickDistance=function(r){return arguments.length?(b=(r=+r)*r,l):Math.sqrt(b)},l}function Ot({handle:a,getCurrentBbox:t,onResize:n,onDragEnd:h,onInteractionStart:m,onInteractionEnd:_}){let i;return ht().on("start",()=>{i=t(),m==null||m()}).on("drag",y=>{let c=i.x,o=i.y,s=i.width,b=i.height;const l=y.x-y.subject.x,x=y.y-y.subject.y;switch(a){case"nw":c=i.x+l,o=i.y+x,s=i.width-l,b=i.height-x;break;case"ne":o=i.y+x,s=i.width+l,b=i.height-x;break;case"sw":c=i.x+l,s=i.width-l,b=i.height+x;break;case"se":s=i.width+l,b=i.height+x;break;case"n":o=i.y+x,b=i.height-x;break;case"s":b=i.height+x;break;case"w":c=i.x+l,s=i.width-l;break;case"e":s=i.width+l;break}const z=1;s<z&&(s=z,a.includes("w")&&(c=i.x+i.width-z)),b<z&&(b=z,a.includes("n")&&(o=i.y+i.height-z));const C=Math.round(c),L=Math.round(o),R=Math.round(s),M=Math.round(b);n&&n({x:C,y:L,width:R,height:M})}).on("end",()=>{const{x:y,y:c,width:o,height:s}=t();h&&h({x:y,y:c,width:o,height:s}),_==null||_()})}function At({getCurrentBbox:a,onMove:t,onDragEnd:n,onInteractionStart:h,onInteractionEnd:m}){let _;return ht().on("start",()=>{_=a(),h==null||h()}).on("drag",i=>{const y=i.x-i.subject.x,c=i.y-i.subject.y,o=Math.round(_.x+y),s=Math.round(_.y+c);t&&t({x:o,y:s,width:_.width,height:_.height})}).on("end",()=>{const i=a();n&&n(i),m==null||m()})}var Xt=V('<text dominant-baseline="middle" text-anchor="end"> </text><text text-anchor="middle"> </text><text dominant-baseline="middle" text-anchor="end"> </text>',1),Ft=V('<g><rect stroke-width="2" pointer-events="all" vector-effect="non-scaling-stroke" class="movable-rectangle" style="cursor: move;"></rect><!></g>');function jt(a,t){it(t,!0);const n=N(t,"bbox",15),h=N(t,"colorStroke",3,"#007bff"),m=N(t,"colorFill",3,"transparent"),_=N(t,"opacity",3,.3),i=N(t,"handleSize",3,12),y=N(t,"scale",3,1),c=D(()=>n().x),o=D(()=>n().y),s=D(()=>n().width),b=D(()=>n().height);let l=$(void 0),x=$(!1);function z(){if(!e(l))return;const w=i()/y(),g=Math.max(3,Math.min(w,e(s)*.1,e(b)*.1,7)),v=[{id:"nw",x:e(c)-g/2,y:e(o)-g/2,cursor:"nwse-resize",label:"Resize northwest corner"},{id:"ne",x:e(c)+e(s)-g/2,y:e(o)-g/2,cursor:"nesw-resize",label:"Resize northeast corner"},{id:"sw",x:e(c)-g/2,y:e(o)+e(b)-g/2,cursor:"nesw-resize",label:"Resize southwest corner"},{id:"se",x:e(c)+e(s)-g/2,y:e(o)+e(b)-g/2,cursor:"nwse-resize",label:"Resize southeast corner"},{id:"n",x:e(c)+e(s)/2-g/2,y:e(o)-g/2,cursor:"ns-resize",label:"Resize top edge"},{id:"s",x:e(c)+e(s)/2-g/2,y:e(o)+e(b)-g/2,cursor:"ns-resize",label:"Resize bottom edge"},{id:"w",x:e(c)-g/2,y:e(o)+e(b)/2-g/2,cursor:"ew-resize",label:"Resize left edge"},{id:"e",x:e(c)+e(s)-g/2,y:e(o)+e(b)/2-g/2,cursor:"ew-resize",label:"Resize right edge"}],k=j(e(l)).selectAll(".resize-handle").data(v,E=>E.id);k.enter().append("rect").attr("class","resize-handle").attr("width",g).attr("height",g).attr("fill",h()).attr("stroke",h()).attr("stroke-width","1").attr("vector-effect","non-scaling-stroke").attr("role","button").attr("style",E=>`cursor: ${E.cursor};`).attr("data-testid",E=>`resize-handle-${E.id}`).attr("aria-label",E=>E.label).merge(k).attr("x",E=>E.x).attr("y",E=>E.y).attr("width",g).attr("height",g).attr("fill",h()).attr("stroke",h()),k.exit().remove()}function C(){if(!e(l))return;["nw","ne","sw","se","n","s","w","e"].forEach(d=>{if(!e(l))return;const g=e(l).querySelector(`[data-testid="resize-handle-${d}"]`);g&&j(g).call(Ot({handle:d,getCurrentBbox:()=>({x:e(c),y:e(o),width:e(s),height:e(b)}),onResize:v=>{n(n().x=v.x,!0),n(n().y=v.y,!0),n(n().width=v.width,!0),n(n().height=v.height,!0),t.onResize&&t.onResize(v),z()},onDragEnd:v=>{t.onDragEnd&&t.onDragEnd(v)},onInteractionStart:()=>{A(x,!0)},onInteractionEnd:()=>{A(x,!1)}}))});const S=e(l).querySelector(".movable-rectangle");S&&j(S).call(At({getCurrentBbox:()=>({x:e(c),y:e(o),width:e(s),height:e(b)}),onMove:d=>{n(n().x=d.x,!0),n(n().y=d.y,!0),n(n().width=d.width,!0),n(n().height=d.height,!0),t.onMove&&t.onMove(d),z()},onDragEnd:d=>{t.onDragEnd&&t.onDragEnd(d)},onInteractionStart:()=>{A(x,!0)},onInteractionEnd:()=>{A(x,!1)}}))}St(()=>{e(l)&&(z(),C())});const L=async()=>{e(l)&&(await gt(),z(),C())};dt(()=>{z(),L()});var R=Ft(),M=X(R),I=Y(M);{var r=w=>{var S=Xt(),d=ft(S),g=X(d);F(d);var v=Y(d),O=X(v);F(v);var k=Y(v),E=X(k);F(k),q(()=>{u(d,"x",e(c)-10/y()),u(d,"y",e(o)+1/y()),u(d,"fill",h()),u(d,"font-size",14/y()),B(g,`x: ${e(c)??""}, y: ${e(o)??""}`),u(v,"x",e(c)+e(s)/2),u(v,"y",e(o)+e(b)+20/y()),u(v,"fill",h()),u(v,"font-size",14/y()),B(O,`w: ${e(s)??""}px`),u(k,"x",e(c)-10/y()),u(k,"y",e(o)+e(b)/2),u(k,"fill",h()),u(k,"font-size",14/y()),B(E,`h: ${e(b)??""}px`)}),G(w,S)};J(I,w=>{e(x)&&w(r)})}F(R),ut(R,w=>A(l,w),()=>e(l)),q(()=>{u(M,"x",e(c)),u(M,"y",e(o)),u(M,"width",e(s)),u(M,"height",e(b)),u(M,"stroke",h()),u(M,"fill",m()),u(M,"fill-opacity",_())}),G(a,R),st()}var It=V('<g data-testid="sample-annotation"><!><!><!></g>');function ne(a,t){var K,H;it(t,!0);const n=()=>xt(o,"$customLabelColorsStore",h),[h,m]=yt(),_=N(t,"showLabel",3,!1),i=N(t,"isResizable",3,!1),y=N(t,"scale",3,1),c=N(t,"highlight",3,"auto"),{customLabelColorsStore:o}=zt(),s=D(()=>t.annotation.annotation_label.annotation_label_name),b=(H=(K=t.annotation)==null?void 0:K.segmentation_details)==null?void 0:H.segmentation_mask,l=D(()=>t.annotation.sample_id),x=D(()=>et(e(s),1)),z=D(()=>{var T;const f=((T=n()[e(s)])==null?void 0:T.color)??et(e(s),1).color;return c()==="disabled"?at(f,.1):f}),C=D(()=>{var T;const f=((T=n()[e(s)])==null?void 0:T.color)??et(e(s),.4).color;return c()==="disabled"?at(f,.1):c()==="active"?at(f,0):f}),L=D(()=>{var f;return c()==="disabled"?.15:b?.65:((f=n()[e(s)])==null?void 0:f.alpha)*.6}),R=D(()=>{var f;return b?0:((f=n()[e(s)])==null?void 0:f.alpha)*.4});let M=$(mt(Mt(t.annotation)));const I=f=>{A(M,t.constraintBox?rt(f,t.constraintBox,!1):f,!0)},r=f=>{A(M,t.constraintBox?rt(f,t.constraintBox,!0):f,!0)},w=f=>{var p;const T=t.constraintBox?rt(f,t.constraintBox,!0):f;A(M,T,!0),(p=t.onBoundingBoxChanged)==null||p.call(t,T)},S=D(()=>[e(M).x,e(M).y,e(M).width,e(M).height]);var d=It(),g=X(d);{var v=f=>{{let T=D(()=>[e(M).x,e(M).y]);Zt(f,{get coordinates(){return e(T)},get colorText(){return e(x)},get label(){return e(s)}})}};J(g,f=>{_()&&(c()==="auto"||c()==="active")&&f(v)})}var O=Y(g);{var k=f=>{_t(f,{get segmentation(){return b},get width(){return t.imageWidth},get colorFill(){return e(C)},get opacity(){return e(L)}})};J(O,f=>{b&&f(k)})}var E=Y(O);{var W=f=>{jt(f,{get colorStroke(){return e(z)},get colorFill(){return e(C)},get opacity(){return e(R)},get scale(){return y()},onResize:I,onMove:r,onDragEnd:w,get bbox(){return e(M)},set bbox(T){A(M,T,!0)}})},P=f=>{Ht(f,{get bbox(){return e(S)},get annotationId(){return e(l)},get label(){return e(s)},get colorStroke(){return e(z)},get colorFill(){return e(C)},get opacity(){return e(R)}})};J(E,f=>{i()&&t.constraintBox&&!b?f(W):f(P,!1)})}F(d),q(()=>{u(d,"data-annotation-label",e(s)),u(d,"data-annotation-id",e(l))}),G(a,d),st(),m()}var Pt=V('<rect vector-effect="non-scaling-stroke" stroke-width="2" pointer-events="all" data-testid="annotation_box"></rect>');function Ht(a,t){const n=N(t,"isPrediction",3,!1),[h,m,_,i]=t.bbox,y=n()?"5,5":"none",c=n()?.8:1;var o=Pt();q(()=>{u(o,"x",h),u(o,"y",m),u(o,"width",_),u(o,"height",i),u(o,"stroke",t.colorStroke),u(o,"stroke-opacity",c),u(o,"stroke-dasharray",y),u(o,"fill",t.colorFill),u(o,"fill-opacity",t.opacity),u(o,"aria-label",t.label)}),G(a,o)}var Yt=V('<g class="unscaled"><rect></rect><text class="annotation-label-text" data-testid="svg-annotation-text"> </text></g>');function Zt(a,t){it(t,!0);const n=N(t,"fontSize",3,14),h=N(t,"isPrediction",3,!1),m=D(()=>bt(t.coordinates,2)),_=D(()=>e(m)[0]),i=D(()=>e(m)[1]);let y=$(null);const c=D(()=>e(y)?(e(y).textContent=h()?`${t.label} (pred)`:t.label,e(y).getBBox()):{width:0,height:0}),o=5,s=h()?.8:1,b=h()?"italic":"normal";var l=Yt(),x=X(l),z=Y(x);u(z,"x",o),u(z,"y",-5);var C=X(z,!0);F(z),ut(z,L=>A(y,L),()=>e(y)),F(l),q(()=>{var L,R,M;u(l,"transform",`translate(${e(_)}, ${e(i)})`),u(l,"data-label",t.label),u(x,"y",-((L=e(c))==null?void 0:L.height)),u(x,"width",((R=e(c))==null?void 0:R.width)+o*2),u(x,"height",(M=e(c))==null?void 0:M.height),u(x,"fill",t.colorText.color),u(x,"opacity",s),u(z,"fill",t.colorText.contrastColor),u(z,"font-size",n()),u(z,"font-style",b),B(C,h()?`${t.label} (pred)`:t.label)}),G(a,l),st()}export{jt as R,ne as S,Dt as a,ht as d,ct as p,j as s,Rt as y};
