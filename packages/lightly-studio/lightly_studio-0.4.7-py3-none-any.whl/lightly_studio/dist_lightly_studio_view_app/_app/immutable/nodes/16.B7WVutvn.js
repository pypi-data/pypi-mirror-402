import{w as S,h as r,p as $,f as j,a as y,$ as N,g as h,b as v}from"../chunks/Yb_TZ_Rf.js";import{c as P}from"../chunks/BDOtEUpJ.js";import{c as L}from"../chunks/BQhJr0Qw.js";import{u as A}from"../chunks/C3A6m4-m.js";import"../chunks/CWj6FrbW.js";import"../chunks/69_IOA4Y.js";import{e as k}from"../chunks/BwfxcG-Y.js";import{c as E,a as D}from"../chunks/DnGquTil.js";import{i as O,a as T,s as F}from"../chunks/DVJdaASW.js";import{p as x}from"../chunks/CnA6nQDP.js";import{g as b}from"../chunks/C1bEftoN.js";import{r as w}from"../chunks/Bz2KBNfb.js";import{S as M}from"../chunks/AfXAZz1B.js";const z=({collection_id:n,sampleIndex:s,tagIds:a,annotationLabelIds:u,min_width:f,max_width:d,min_height:o,max_height:p,textEmbedding:l,metadataValues:c})=>{const i=S({isLoading:!1});return(async()=>{i.update(e=>({...e,isLoading:!0,error:void 0}));try{const{data:e}=await P({path:{collection_id:n},body:{pagination:{offset:s<1?0:s-1,limit:3},filters:{sample_filter:{annotation_label_ids:u,tag_ids:a,metadata_filters:c?L(c):void 0},width:{min:f,max:d},height:{min:o,max:p}},text_embedding:l},throwOnError:!0}),{setfilteredSampleCount:t}=A();t(e==null?void 0:e.total_count);let m;const g=s>0?e.data[0]:void 0;e.data.length>2&&(m=s==0?e.data[1]:e.data[2]),i.update(I=>({...I,isLoading:!1,sampleNext:m,samplePrevious:g,error:void 0}))}catch(e){i.update(t=>({...t,isLoading:!1,error:e.message||"Failed to load adjacent samples"}))}})(),i},C=async({parent:n,params:{collection_id:s,sampleId:a,sampleIndex:u}})=>{var _,e,t,m,g;const{samplesSelectedTagsIds:f,samplesSelectedAnnotationLabelsIds:d,samplesDimensions:o,samplesTextEmbedding:p}=await n(),l=parseInt(u,10),{metadataValues:c}=A();return{sampleAdjacents:z({collection_id:s,sampleIndex:l,tagIds:Array.from(r(f)),annotationLabelIds:Array.from(r(d)),min_width:(_=r(o))==null?void 0:_.min_width,max_width:(e=r(o))==null?void 0:e.max_width,min_height:(t=r(o))==null?void 0:t.min_height,max_height:(m=r(o))==null?void 0:m.max_height,textEmbedding:(g=r(p))==null?void 0:g.embedding,metadataValues:r(c)}),sampleIndex:l}},ee=Object.freeze(Object.defineProperty({__proto__:null,load:C},Symbol.toStringTag,{value:"Module"}));function G(n,s){$(s,!0);const a=()=>F(h(o),"$sampleAdjacents",u),[u,f]=T(),d=v(()=>x.data.sampleIndex),o=v(()=>x.data.sampleAdjacents),p=()=>{a().sampleNext&&b(w.toSample({sampleId:a().sampleNext.sample_id,collectionId:a().sampleNext.sample.collection_id,sampleIndex:h(d)+1}),{invalidateAll:!0})},l=()=>{a().samplePrevious&&b(w.toSample({sampleId:a().samplePrevious.sample_id,collectionId:a().samplePrevious.sample.collection_id,sampleIndex:h(d)-1}),{invalidateAll:!0})},c=t=>{switch(t.key){case"ArrowRight":p();break;case"ArrowLeft":l();break}};var i=E();k("keydown",N,c);var _=j(i);{var e=t=>{{let m=v(()=>!!a().samplePrevious),g=v(()=>!!a().sampleNext);M(t,{get hasPrevious(){return h(m)},get hasNext(){return h(g)},onPrevious:l,onNext:p})}};O(_,t=>{a()&&t(e)})}D(n,i),y(),f()}function ae(n){G(n,{})}export{ae as component,ee as universal};
