import"../chunks/CWj6FrbW.js";import{w as z,h as C,p as k,c as _,s as h,r as F,t as ae,a as B,u as se,g as t,b as r,f as ie}from"../chunks/Yb_TZ_Rf.js";import{f as E,a as V,c as oe}from"../chunks/DnGquTil.js";import{s as l,a as re,i as de}from"../chunks/DVJdaASW.js";import{r as ne,s as le,g as me}from"../chunks/DcA8i6zt.js";import"../chunks/CvGjimpO.js";import{u as ce}from"../chunks/C3A6m4-m.js";import{b as ue,s as q}from"../chunks/Dcv4bg-q.js";import"../chunks/BztKn-jM.js";import{g as ge,a as ve,u as fe,c as pe}from"../chunks/BQhJr0Qw.js";import"../chunks/69_IOA4Y.js";import"../chunks/CnA6nQDP.js";import{p as _e}from"../chunks/D7RkCIym.js";import{S as he}from"../chunks/xmQHzaB1.js";import{u as Fe}from"../chunks/BG8lOwfA.js";import{a as ye}from"../chunks/DtWZc_tl.js";import{g as xe}from"../chunks/C1bEftoN.js";import{I as be}from"../chunks/7Gu-QONR.js";import{S as Ie}from"../chunks/CVsKQj9T.js";import{d as Se}from"../chunks/BwfxcG-Y.js";import{r as Ce}from"../chunks/Bz2KBNfb.js";import{V as Ve}from"../chunks/CjyESLw3.js";const Me=(m,e)=>{const a=ge({path:{video_frame_collection_id:m},query:{limit:30},body:{filter:e}}),i=ne({...a,getNextPageParam:s=>s.nextCursor||void 0}),c=ve(),y=()=>{c.invalidateQueries({queryKey:a.queryKey})},g=z([]),v=z(0);return i.subscribe(s=>{if(s.isSuccess){const o=s.data.pages.flatMap(x=>x.data);g.set(o),v.set(s.data.pages[0].total_count)}}),{data:g,totalCount:v,loadMore:()=>{C(i).hasNextPage&&!C(i).isFetchingNextPage&&C(i).fetchNextPage()},query:i,refresh:y}};function Pe(m,e){xe(Ce.toFramesDetails(e.videoFrame.sample.collection_id,e.videoFrame.sample_id,e.index))}var Ae=E('<div class="video-frame-container relative overflow-hidden rounded-lg svelte-1y9r35j" role="img"><img class="svelte-1y9r35j"/> <!></div>');function Ne(m,e){k(e,!0);var a=Ae();a.__dblclick=[Pe,e];var i=_(a),c=h(i,2);Ve(c,{get width(){return e.size},get height(){return e.size},get sampleWidth(){return e.videoFrame.video.width},get sampleHeight(){return e.videoFrame.video.height},get sample(){return e.videoFrame}}),F(a),ae(()=>{ue(a,`width: var(${e.videoFrame.video.width}); height: var(${e.videoFrame.video.height});`),q(i,"src",`${ye}/${e.videoFrame.sample_id}?compressed=true`),q(i,"alt",`${e.videoFrame.sample_id}-${e.videoFrame.frame_number}`)}),V(m,a),B()}Se(["dblclick"]);var we=E('<div class="flex flex-1 flex-col space-y-4"><div class="my-2 flex items-center space-x-4"><div class="flex-1"><div class="text-2xl font-semibold">Frames</div></div> <div class="w-4/12"><!></div></div> <!> <!></div>');function tt(m,e){k(e,!0);const a=()=>l(_e,"$page",o),i=()=>l(t(O),"$selectedAnnotationFilterIds",o),c=()=>l(G,"$tagsSelected",o),y=()=>l(P,"$metadataValues",o),g=()=>l(D,"$videoFramesBoundsValues",o),v=()=>l(t(Q),"$data",o),M=()=>l(t(H),"$totalCount",o),s=()=>l(t(T),"$query",o),[o,x]=re(),{metadataValues:P}=fe(a().params.collection_id),{videoFramesBoundsValues:D}=le(),O=r(()=>e.data.selectedAnnotationFilterIds),{tagsSelected:G}=Fe({collection_id:a().params.collection_id,kind:["sample"]}),L=r(()=>{var p;return{sample_filter:{annotation_label_ids:(p=i())!=null&&p.length?i():void 0,tag_ids:c().size>0?Array.from(c()):void 0,metadata_filters:P?pe(y()):void 0},...g()}}),f=r(()=>Me(a().params.collection_id,t(L))),Q=r(()=>t(f).data),T=r(()=>t(f).query),j=r(()=>t(f).loadMore),H=r(()=>t(f).totalCount),{setfilteredSampleCount:K}=ce();let n=r(v);se(()=>{K(M())});var b=we(),I=_(b),A=h(_(I),2),R=_(A);be(R,{}),F(A),F(I);var N=h(I,2);he(N,{class:"mb-4 bg-border-hard"});var U=h(N,2);{const p=(X,d)=>{let u=()=>d==null?void 0:d().index,Y=()=>d==null?void 0:d().style,Z=()=>d==null?void 0:d().sampleSize;var w=oe(),$=ie(w);{var ee=S=>{me(S,{get style(){return Y()},get index(){return u()},dataTestId:"frame-grid-item",get sampleId(){return t(n)[u()].sample_id},get collectionId(){return a().params.collection_id},get dataSampleName(){return t(n)[u()].sample_id},item:te=>{Ne(te,{get videoFrame(){return t(n)[u()]},get index(){return u()},get size(){return Z()}})},$$slots:{item:!0}})};de($,S=>{t(n)[u()]&&S(ee)})}V(X,w)};let W=r(()=>({loading:s().isPending&&t(n).length===0,error:s().isError,empty:s().isSuccess&&t(n).length===0,success:s().isSuccess&&t(n).length>0})),J=r(()=>({loadMore:t(j),disabled:!s().hasNextPage||s().isFetchingNextPage,loading:s().isFetchingNextPage}));Ie(U,{get itemCount(){return t(n).length},overScan:30,testId:"video-frames-grid",message:{loading:"Loading video frames...",error:"Error loading video frames",empty:{title:"No video frames found",description:"This collection doesn't contain any video frames."}},get status(){return t(W)},get loader(){return t(J)},gridItem:p,$$slots:{gridItem:!0}})}F(b),V(m,b),B(),x()}export{tt as component};
