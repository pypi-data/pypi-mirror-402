import"./CWj6FrbW.js";import{o as Yt,a as we,c as ne}from"./C1bEftoN.js";import{p as at,c as W,g as e,b as D,r as Z,a as ot,f as j,d as q,O as Lt,u as mt,e as y,s as F,t as xt,$ as Qt,h as Ae}from"./Yb_TZ_Rf.js";import{e as pt}from"./BwfxcG-Y.js";import{f as ct,a as M,c as et,b as ht}from"./DnGquTil.js";import{a as dt,s as Y,i as X,b as $t,m as te}from"./DVJdaASW.js";import{s as Dt}from"./DTWlVeDn.js";import{K as Se,M as ye,N as xe,O as jt,P as it,Q as ae,R as Pt,T as Mt,U as Nt,V as Ft,W as oe,X as Kt,Y as kt,Z as Bt,$ as ie,a0 as le,a1 as Gt,a2 as se,a3 as re,v as ce,a4 as Ut,a5 as Et,a6 as Ce,a7 as Te,a8 as Re,a9 as Ee,u as de,_ as De,aa as Le,ab as ke,ac as Be,ad as Pe,C as ue,y as ge,a as Me,ae as Ne,S as Fe,af as Ue,z as ze,ag as He,ah as Oe}from"./DcA8i6zt.js";import"./CvGjimpO.js";import{u as nt}from"./C3A6m4-m.js";import"./BztKn-jM.js";import"./69_IOA4Y.js";import"./CnA6nQDP.js";import{S as Xe}from"./xmQHzaB1.js";import"./DtWZc_tl.js";import{u as me,k as Ye,t as Q,s as G,e as he,a as ee,b as Ge,i as je}from"./Dcv4bg-q.js";import{a as Zt,Z as Ke,I as Ze}from"./_l1FkI_E.js";import{u as Ve}from"./BKhhfA14.js";import{A as ut}from"./CI5--nSk.js";import{p as gt}from"./CmJZ_CaC.js";import{S as We,s as fe,d as Je,R as qe}from"./DOL8rH4R.js";var Qe=ct('<div class="absolute right-4 top-2 z-30 flex items-center gap-2"><!></div>');function pe(x,t){at(t,!0);const f=()=>Y(T,"$selectedSampleIds",E),[E,C]=dt(),{getSelectedSampleIds:i,toggleSampleSelection:a}=nt(),T=i(t.collectionId);var s=Qe(),_=W(s);{let w=D(()=>f().has(t.sampleId));Se(_,{onSelect:()=>a(t.sampleId,t.collectionId),get isSelected(){return e(w)}})}Z(s),M(x,s),ot(),C()}function $e(x,t){at(t,!0);const f=()=>Y(e(A),"$annotationResp",C),E=()=>Y(_,"$showAnnotationTextLabelsStore",C),[C,i]=dt(),a=gt(t,"isResizable",3,!1),T=gt(t,"highlight",3,"auto"),{addReversibleAction:s}=nt(),{showAnnotationTextLabelsStore:_}=me(),w=D(()=>jt({collectionId:t.collectionId,annotationId:t.annotationId})),A=D(()=>e(w).annotation),g=D(()=>e(w).updateAnnotation);let r=D(()=>f().data),m=D(()=>e(r)?ye(e(r)):void 0);const v=N=>{(async()=>{try{await e(g)({annotation_id:t.annotationId,collection_id:t.collectionId,bounding_box:N}),e(r)&&Zt({annotation:e(r),collection_id:t.collectionId,addReversibleAction:s,updateAnnotation:e(g)})}catch(l){console.error("Failed to update annotation:",l.message)}})()};var S=et(),R=j(S);{var P=N=>{var o=et(),l=j(o);Ye(l,()=>e(m),c=>{xe(c,{get groupId(){return e(r).sample_id},get onSelect(){return t.toggleAnnotationSelection},get box(){return e(m)},children:(h,n)=>{{let k=D(()=>({x:0,y:0,width:t.sample.width,height:t.sample.height}));We(h,{get annotation(){return e(r)},get showLabel(){return E()},get imageWidth(){return t.sample.width},get constraintBox(){return e(k)},get isResizable(){return a()},onBoundingBoxChanged:v,get highlight(){return T()}})}},$$slots:{default:!0}})}),M(N,o)};X(R,N=>{e(r)&&e(m)&&N(P)})}M(x,S),ot(),i()}function tn({collectionId:x,sample:t,refetch:f}){const{addReversibleAction:E}=nt(),{context:C}=it();return{finishErase:async(a,T,s,_)=>{if(!C.isDrawing||!a||!T){C.isDrawing=!1;return}const w=ae(a,t.width,t.height);if(!w){try{await(_==null?void 0:_()),f()}catch(g){Q.error("Failed to delete annotation. Please try again."),console.error("Error deleting annotation:",g)}return}const A=Pt(a);try{if(!s)return;await s({annotation_id:T==null?void 0:T.sample_id,collection_id:x,bounding_box:w,segmentation_mask:A}),Zt({annotation:T,collection_id:x,addReversibleAction:E,updateAnnotation:s}),f()}catch(g){console.error(g),Q.error("Failed to update segmentation")}}}}var en=ht('<circle fill="rgba(255, 255, 255, 0.15)" stroke="white" stroke-width="1" pointer-events="none"></circle>'),nn=ht("<!><!><!>",1);function an(x,t){at(t,!0);const f=()=>Y(w,"$annotationLabels",E),[E,C]=dt();let i=gt(t,"interactionRect",15);const{context:a,setIsDrawing:T,setAnnotationId:s}=it(),{deleteAnnotation:_}=Mt({collectionId:t.collectionId}),w=Nt({collectionId:t.collectionId}),{addReversibleAction:A}=nt(),{createAnnotation:g}=Ft({collectionId:t.collectionId}),{finishErase:r}=tn({collectionId:t.collectionId,sample:t.sample,refetch:t.refetch}),m=D(()=>a.annotationId?jt({collectionId:t.collectionId,annotationId:a.annotationId}):null);let v=q(null),S=q(Lt([])),R=q(null);mt(()=>{var U;T(!1);const u=a.annotationId;if(!u){y(v,null),y(S,[],!0);return}const d=t.sample.annotations.find(z=>z.sample_id===u),B=(U=d==null?void 0:d.segmentation_details)==null?void 0:U.segmentation_mask;if(!B){Q.error("No segmentation mask to erase"),y(v,null),y(S,[],!0),y(R,null);return}y(v,oe(B,t.sample.width,t.sample.height),!0),y(S,B,!0),y(R,d,!0)});const P=()=>{e(v)&&y(S,Pt(e(v)),!0)},N=async u=>{var d;await((d=e(m))==null?void 0:d.updateAnnotation(u)),t.refetch()};async function o(){const u=f().data,d=t.sample.annotations.find(B=>B.sample_id===a.annotationId);if(d||u)try{ie({annotation:d,labels:u,addReversibleAction:A,createAnnotation:g,refetch:t.refetch}),await _(d.sample_id),Q.success("Annotation deleted successfully"),t.refetch(),s(null)}catch(B){Q.error("Failed to delete annotation. Please try again."),console.error("Error deleting annotation:",B)}}var l=nn(),c=j(l);{var h=u=>{var d=en();xt(()=>{G(d,"cx",t.mousePosition.x),G(d,"cy",t.mousePosition.y),G(d,"r",t.brushRadius)}),M(u,d)};X(c,u=>{t.mousePosition&&u(h)})}var n=F(c);{var k=u=>{{let d=D(()=>Gt(t.drawerStrokeColor,0));le(u,{get segmentation(){return e(S)},get width(){return t.sample.width},get colorFill(){return e(d)},opacity:.85})}};X(n,u=>{e(S).length>0&&a.isDrawing&&u(k)})}var b=F(n);Kt(b,{get sample(){return t.sample},cursor:"crosshair",onpointerdown:u=>{if(!a.annotationId)return Q.error("No annotation selected for erasing");if(!e(v))return;const d=kt(u,i(),t.sample.width,t.sample.height);d&&(T(!0),Bt(e(v),t.sample.width,t.sample.height,[d],t.brushRadius,0),P())},onpointermove:u=>{if(!a.isDrawing||!e(v))return;const d=kt(u,i(),t.sample.width,t.sample.height);d&&(T(!0),Bt(e(v),t.sample.width,t.sample.height,[d],t.brushRadius,0),P())},onpointerup:()=>r(e(v),e(R),N,o),onpointerleave:()=>r(e(v),e(R),N,o),get interactionRect(){return i()},set interactionRect(u){i(u)}}),M(x,l),ot(),C()}function on({collectionId:x,sampleId:t,sample:f,refetch:E}){const{createLabel:C}=se({collectionId:x}),{createAnnotation:i}=Ft({collectionId:x}),{addReversibleAction:a}=nt(),{deleteAnnotation:T}=Mt({collectionId:x}),{context:s,setIsDrawing:_,setAnnotationLabel:w,setLastCreatedAnnotationId:A,setAnnotationId:g}=it();return{finishBrush:async(m,v,S,R)=>{if(!s.isDrawing||!m){_(!1);return}const P=ae(m,f.width,f.height);if(!P){Q.error("Invalid segmentation mask");return}const N=Pt(m);if(v)try{if(!R)return;await R({annotation_id:v.sample_id,collection_id:x,bounding_box:P,segmentation_mask:N}),E(),Zt({annotation:v,collection_id:x,addReversibleAction:a,updateAnnotation:R});return}catch(c){console.error("Failed to update annotation:",c.message);return}let o=(S==null?void 0:S.find(c=>c.annotation_label_name===s.annotationLabel))??(S==null?void 0:S.find(c=>c.annotation_label_name==="DEFAULT"));o||(o=await C({dataset_id:x,annotation_label_name:"DEFAULT"}));const l=await i({parent_sample_id:t,annotation_type:"instance_segmentation",x:P.x,y:P.y,width:P.width,height:P.height,segmentation_mask:N,annotation_label_id:o.annotation_label_id});re({annotation:l,addReversibleAction:a,deleteAnnotation:T,refetch:E}),w(o.annotation_label_name),g(l.sample_id),A(l.sample_id),E()}}}var ln=ht("<circle></circle>"),sn=ht("<!><!><!>",1);function rn(x,t){at(t,!0);const f=()=>Y(a,"$labels",E),[E,C]=dt();let i=gt(t,"interactionRect",15);const a=Nt({collectionId:t.collectionId}),T=D(()=>_.annotationId?jt({collectionId:t.collectionId,annotationId:_.annotationId}):null),{finishBrush:s}=on({collectionId:t.collectionId,sampleId:t.sampleId,sample:t.sample,refetch:t.refetch}),{context:_,setIsDrawing:w}=it();let A=q(Lt([])),g=q(null),r=q(Lt([])),m=q(null);mt(()=>{var k,b;if(w(!1),!_.annotationId){y(r,[],!0),y(m,null),y(g,null),y(A,[],!0);return}const h=(k=t.sample.annotations)==null?void 0:k.find(u=>u.sample_id===_.annotationId),n=(b=h==null?void 0:h.segmentation_details)==null?void 0:b.segmentation_mask;if(!n){y(g,new Uint8Array(t.sample.width*t.sample.height),!0),y(r,[],!0),y(m,null);return}y(g,oe(n,t.sample.width,t.sample.height),!0),y(m,h,!0),y(r,n,!0)});const v=()=>{e(g)&&y(r,Pt(e(g)),!0)},S=async h=>{var n;await((n=e(T))==null?void 0:n.updateAnnotation(h)),t.refetch()};var R=sn(),P=j(R);{var N=h=>{var n=ln();xt(k=>{G(n,"cx",t.mousePosition.x),G(n,"cy",t.mousePosition.y),G(n,"r",t.brushRadius),G(n,"fill",k)},[()=>Gt(t.drawerStrokeColor,.25)]),M(h,n)};X(P,h=>{t.mousePosition&&h(N)})}var o=F(P);{var l=h=>{{let n=D(()=>Gt(t.drawerStrokeColor,0));le(h,{get colorFill(){return e(n)},opacity:.85,get segmentation(){return e(r)},get width(){return t.sample.width}})}};X(o,h=>{e(r).length>0&&_.isDrawing&&h(l)})}var c=F(o);Kt(c,{get sample(){return t.sample},cursor:"crosshair",onpointermove:h=>{if(!_.isDrawing||!e(g))return;const n=kt(h,i(),t.sample.width,t.sample.height);n&&(y(A,[...e(A),n],!0),Bt(e(g),t.sample.width,t.sample.height,[n],t.brushRadius,1),v())},onpointerleave:()=>s(e(g),e(m),f().data??[],S),onpointerup:()=>s(e(g),e(m),f().data??[],S),onpointerdown:h=>{const n=kt(h,i(),t.sample.width,t.sample.height);n&&(w(!0),e(A).push(n),e(g)||y(g,new Uint8Array(t.sample.width*t.sample.height),!0),Bt(e(g),t.sample.width,t.sample.height,[n],t.brushRadius,1),v())},get interactionRect(){return i()},set interactionRect(h){i(h)}}),M(x,R),ot(),C()}var cn=ct("<!> <!>",1);function dn(x,t){at(t,!0);const f=()=>Y(T,"$labels",E),[E,C]=dt();let i=gt(t,"interactionRect",15),a=q(null);const T=Nt({collectionId:t.collectionId}),{createLabel:s}=se({collectionId:t.collectionId}),{createAnnotation:_}=Ft({collectionId:t.collectionId}),{deleteAnnotation:w}=Mt({collectionId:t.collectionId}),{addReversibleAction:A}=nt(),g=()=>{o(!1),y(a,null)},{refetch:r}=ce({collectionId:t.collectionId}),m=4,v=()=>{if(!i())return;const k=fe(i());let b=null;const u=Je().on("start",d=>{N(null),o(!0);const B=i().getBoundingClientRect(),U=d.sourceEvent.clientX,z=d.sourceEvent.clientY,L=(U-B.left)/B.width*t.sample.width,O=(z-B.top)/B.height*t.sample.height;b={x:L,y:O},y(a,{x:L,y:O,width:0,height:0},!0)}).on("drag",d=>{if(!e(a)||!R.isDragging||!b)return;const B=i().getBoundingClientRect(),U=d.sourceEvent.clientX,z=d.sourceEvent.clientY;let L=(U-B.left)/B.width*t.sample.width,O=(z-B.top)/B.height*t.sample.height;const V=t.sample.width,ft=t.sample.height;L=Math.max(0,Math.min(L,V)),O=Math.max(0,Math.min(O,ft));const It=Math.min(b.x,L),wt=Math.min(b.y,O),vt=Math.abs(L-b.x),At=Math.abs(O-b.y);y(a,{x:It,y:wt,width:vt,height:At},!0)}).on("end",()=>{!e(a)||!R.isDragging||(e(a).width>m&&e(a).height>m&&S({x:e(a).x,y:e(a).y,width:e(a).width,height:e(a).height}),g(),b=null)});return k.call(u),()=>{u.on("start",null).on("drag",null).on("end",null)}},S=async({x:k,y:b,width:u,height:d})=>{var U,z;let B=((U=f().data)==null?void 0:U.find(L=>L.annotation_label_name===R.annotationLabel))??((z=f().data)==null?void 0:z.find(L=>L.annotation_label_name==="DEFAULT"));B||(B=await s({dataset_id:t.collectionId,annotation_label_name:"DEFAULT"}));try{const L=await _({parent_sample_id:t.sampleId,annotation_type:"object_detection",x:Math.round(k),y:Math.round(b),width:Math.round(u),height:Math.round(d),annotation_label_id:B.annotation_label_id});return t.sample.annotations.length==0&&r(),re({annotation:L,addReversibleAction:A,deleteAnnotation:w,refetch:t.refetch}),t.refetch(),P(L.sample_id),N(L.sample_id),Q.success("Annotation created successfully"),L}catch(L){Q.error("Failed to create annotation. Please try again."),console.error("Error creating annotation:",L);return}},{context:R,setLastCreatedAnnotationId:P,setAnnotationId:N,setIsDragging:o}=it();mt(()=>{v()});var l=cn(),c=j(l);{var h=k=>{qe(k,{get bbox(){return e(a)},get colorStroke(){return t.drawerStrokeColor},colorFill:"rgba(0, 123, 255, 0.1)",opacity:.8,scale:1})};X(c,k=>{e(a)&&R.isDragging&&k(h)})}var n=F(c,2);Kt(n,{cursor:"crosshair",get sample(){return t.sample},get interactionRect(){return i()},set interactionRect(k){i(k)}}),M(x,l),ot(),C()}var un=ct(`<div class="pointer-events-none absolute left-1 top-1 z-20"><div class="
      pointer-events-auto
      flex
      select-none
      flex-col
      items-stretch
      gap-1
      rounded-lg
      bg-muted
      p-1
      shadow-md
    "><!> <!> <!> <!></div></div>`);function gn(x,t){at(t,!0);const f=l=>{const c=l.target;if(c.tagName==="TEXTAREA"||c.isContentEditable||c.tagName==="INPUT")return;const h=l.key.toLowerCase();h==="s"?(l.preventDefault(),g()):h==="b"?(l.preventDefault(),A()):h==="m"?(l.preventDefault(),m()):h==="d"&&(l.preventDefault(),r())};Yt(()=>{window.addEventListener("keydown",f)}),we(()=>{window.removeEventListener("keydown",f)});const{setAnnotationId:E,setAnnotationType:C,setLastCreatedAnnotationId:i,setIsDrawing:a,setIsErasing:T}=it(),{context:s,setBrushMode:_,setStatus:w}=Ut();Yt(()=>{w("cursor")}),mt(()=>{s.status==="cursor"?(E(null),C(null),i(null),a(!1),T(!1),_("brush")):(s.status==="bounding-box"||s.status==="brush")&&(i(null),_("brush")),s.status==="drag"&&C(null)});const A=()=>{w("bounding-box"),C(ut.OBJECT_DETECTION),E(null),i(null)},g=()=>{w("cursor")},r=()=>{w("drag")},m=()=>{w("brush"),C(ut.INSTANCE_SEGMENTATION),E(null),i(null)};var v=un(),S=W(v),R=W(S);Et(R,{label:"Select",shortcut:"S",children:(l,c)=>{Ce(l,{onclick:g})}});var P=F(R,2);Et(P,{label:"Drag",shortcut:"D",children:(l,c)=>{Te(l,{onclick:r})}});var N=F(P,2);Et(N,{label:"Bounding Box",shortcut:"B",children:(l,c)=>{Re(l,{onclick:A})}});var o=F(N,2);Et(o,{label:"Segmentation Mask Brush",shortcut:"M",children:(l,c)=>{Ee(l,{onclick:m})}}),Z(S),Z(v),M(x,v),ot()}var mn=ht("<g><!></g>"),hn=ht('<line x1="0" stroke-width="1" vector-effect="non-scaling-stroke" stroke-dasharray="5,5" opacity="0.6"></line><line y1="0" stroke-width="1" stroke-dasharray="5,5" opacity="0.6"></line>',1),fn=ht("<image></image><g><!><!></g><!>",1);function vn(x,t){at(t,!0);const f=()=>Y(s,"$isEditingMode",a),E=()=>Y(_,"$imageBrightness",a),C=()=>Y(w,"$imageContrast",a),i=()=>Y(A,"$isHidden",a),[a,T]=dt(),{isEditingMode:s,imageBrightness:_,imageContrast:w}=nt(),{isHidden:A}=de();let g=q(void 0),r=q(null),m=q(null),v=D(()=>t.sample.sampleId);const S=D(()=>t.sample.annotations.filter(b=>!t.hideAnnotationsIds.has(b.sample_id)).sort((b,u)=>b.sample_id===c.annotationId?1:u.sample_id===c.annotationId?-1:0)),R=D(()=>t.annotationLabel!=="default"&&t.annotationLabel?ke(t.annotationLabel,1).color:"rgb(0, 0, 255)");mt(()=>{P(),f()||(h(!1),n(!1))});const P=()=>{if(!e(m))return;fe(e(m)).on("mousemove",o)},N=b=>{if(!e(m))return;const u=e(m).getBoundingClientRect(),d=b.clientX,B=b.clientY,U=(d-u.left)/u.width*t.sample.width,z=(B-u.top)/u.height*t.sample.height;y(r,{x:U,y:z},!0),b.stopPropagation(),b.preventDefault()},o=De.throttle(N,50);ne(()=>{var b;(b=e(g))==null||b()});function l(b){return c.isDrawing||c.isDragging?"disabled":t.selectedAnnotationId?t.selectedAnnotationId===b?"active":"disabled":"auto"}const{context:c,setIsErasing:h,setIsDrawing:n}=it(),{context:k}=Ut();{const b=U=>{var z=et(),L=j(z);{var O=V=>{gn(V,{})};X(L,V=>{f()&&V(O)})}M(U,z)},u=U=>{var z=et(),L=j(z);{var O=V=>{Le(V,{})};X(L,V=>{t.annotationType==ut.INSTANCE_SEGMENTATION&&f()&&V(O)})}M(U,z)},d=U=>{var z=fn(),L=j(z),O=F(L);let V;var ft=W(O);he(ft,17,()=>e(S),K=>K.sample_id,(K,$)=>{var I=mn();let H;var lt=W(I);{let J=D(()=>c.isDragging?"disabled":l(e($).sample_id));$e(lt,{get annotationId(){return e($).sample_id},get sampleId(){return e(v)},get collectionId(){return t.collectionId},get isResizable(){return t.isResizable},get toggleAnnotationSelection(){return t.toggleAnnotationSelection},get sample(){return t.sample},get highlight(){return e(J)}})}Z(I),xt(J=>H=ee(I,0,"svelte-17xkbyc",null,H,J),[()=>({hidden:c.isDrawing&&e($).sample_id===c.annotationId})]),M(K,I)});var It=F(ft);{var wt=K=>{var $=hn(),I=j($),H=F(I);xt(()=>{G(I,"y1",e(r).y),G(I,"x2",t.sample.width),G(I,"y2",e(r).y),G(I,"stroke",e(R)),G(H,"x1",e(r).x),G(H,"x2",e(r).x),G(H,"y2",t.sample.height),G(H,"stroke",e(R))}),M(K,$)};X(It,K=>{e(r)&&f()&&(k.status==="brush"||k.status==="bounding-box")&&K(wt)})}Z(O);var vt=F(O);{var At=K=>{var $=et(),I=j($);{var H=J=>{an(J,{get collectionId(){return t.collectionId},get brushRadius(){return t.brushRadius},get refetch(){return t.refetch},get sample(){return t.sample},get mousePosition(){return e(r)},get drawerStrokeColor(){return e(R)},get interactionRect(){return e(m)},set interactionRect(_t){y(m,_t,!0)}})},lt=J=>{var _t=et(),zt=j(_t);{var Ht=st=>{rn(st,{get mousePosition(){return e(r)},get sampleId(){return e(v)},get collectionId(){return t.collectionId},get brushRadius(){return t.brushRadius},get refetch(){return t.refetch},get drawerStrokeColor(){return e(R)},get annotationLabel(){return t.annotationLabel},get sample(){return t.sample},get interactionRect(){return e(m)},set interactionRect(rt){y(m,rt,!0)}})},Ct=st=>{var rt=et(),Ot=j(rt);{var Tt=St=>{dn(St,{get sample(){return t.sample},get sampleId(){return e(v)},get collectionId(){return t.collectionId},get drawerStrokeColor(){return e(R)},get refetch(){return t.refetch},get interactionRect(){return e(m)},set interactionRect(p){y(m,p,!0)}})};X(Ot,St=>{t.annotationType==ut.OBJECT_DETECTION&&St(Tt)},!0)}M(st,rt)};X(zt,st=>{t.annotationType==ut.INSTANCE_SEGMENTATION?st(Ht):st(Ct,!1)},!0)}M(J,_t)};X(I,J=>{t.isEraser?J(H):J(lt,!1)})}M(K,$)};X(vt,K=>{f()&&K(At)})}xt(K=>{G(L,"href",t.imageUrl),Ge(L,`filter: brightness(${E()}) contrast(${C()})`),V=ee(O,0,"",null,V,K)},[()=>({invisible:i()})]),M(U,z)};let B=D(()=>!(c.isDrawing||c.isErasing));Ke(x,{get width(){return t.sample.width},get height(){return t.sample.height},get panEnabled(){return e(B)},cursor:"grab",registerResetFn:U=>y(g,U,!0),toolbarContent:b,zoomPanelContent:u,zoomableContent:d,$$slots:{toolbarContent:!0,zoomPanelContent:!0,zoomableContent:!0}})}ot(),T()}function ve(){const{context:x,setAnnotationId:t,setAnnotationLabel:f,setAnnotationType:E,setLastCreatedAnnotationId:C}=it(),{setStatus:i}=Ut(),{updateLastAnnotationLabel:a}=nt();function T({annotationId:s,collectionId:_,annotations:w}){var g,r;const A=w.find(m=>m.sample_id===s);A&&(A.annotation_type==="instance_segmentation"?(E(A.annotation_type),f(((g=A.annotation_label)==null?void 0:g.annotation_label_name)??null),i("brush")):i("cursor"),(r=A.annotation_label)!=null&&r.annotation_label_name&&a(_,A.annotation_label.annotation_label_name),C(null),t(x.annotationId===s?null:s))}return{selectAnnotation:T}}var _n=ct('<div class="h-full w-full overflow-hidden"><div class="sample relative h-full w-full"><!> <!> <!></div></div>'),bn=ct('<div class="flex h-full w-full flex-col space-y-4"><div class="flex w-full items-center justify-between"><!> <!></div> <!> <div class="flex min-h-0 flex-1 gap-4"><div class="flex-1"><!></div> <div class="relative w-[375px]"><!></div></div></div>'),In=ct('<div data-testid="sample-details-loading"><!></div>');function Kn(x,t){at(t,!0);const f=()=>Y(P,"$isEditingMode",s),E=()=>Y(g,"$lastAnnotationBrushSize",s),C=()=>Y(N,"$lastAnnotationLabel",s),i=()=>Y(O,"$rootCollection",s),a=()=>Y(r,"$imageBrightness",s),T=()=>Y(m,"$imageContrast",s),[s,_]=dt(),{toggleSampleSelection:w,clearReversibleActions:A,lastAnnotationBrushSize:g,imageBrightness:r,imageContrast:m}=nt(),{handleKeyEvent:v}=de(),{settingsStore:S}=me(),{removeTagFromSample:R}=Ve({collectionId:t.collectionId}),{isEditingMode:P,lastAnnotationLabel:N}=nt(),o=Be({});Pe();const{context:l,setStatus:c}=Ut(),{selectAnnotation:h}=ve();let n=q(!1),k=q(Lt(new Set)),b,u;const d=I=>{switch(I.key){case Ae(S).key_go_back:f()?o.annotationType&&c("cursor"):t.handleEscape();break;case" ":I.preventDefault(),I.stopPropagation(),console.log("space pressed in sample details"),f()?(e(n)||(b=o.annotationType,u=l.status,l.status="drag",o.annotationType=null),y(n,!0)):w(t.sampleId,t.collectionId);break}v(I)},B=I=>{I.key===" "&&(y(n,!1),l.status=u,o.annotationType=b),v(I)};ne(()=>{o.annotationId=void 0,o.lastCreatedAnnotationId=void 0,A()});const U=I=>{e(n)||l.status==="drag"||h({annotationId:I,annotations:t.sample.annotations,collectionId:t.collectionId})};let z=D(()=>{var I;return(I=t.sample)!=null&&I.annotations?Ne(t.sample.annotations):[]});const L=async I=>{try{await R(t.sampleId,I),Q.success("Tag removed successfully"),t.refetch()}catch(H){Q.error("Failed to remove tag. Please try again."),console.error("Error removing tag from sample:",H)}},{rootCollection:O}=ce({collectionId:t.collectionId}),V=D(()=>f()&&!e(n)&&l.status!=="drag");let ft=D(()=>o.annotationType),It=D(()=>l.brush.mode==="eraser"),wt=D(()=>E()[t.collectionId]??l.brush.size);mt(()=>{P||(l.status="cursor",l.brush.mode="brush",o.lastCreatedAnnotationId=void 0)}),Yt(()=>{o.annotationLabel=C()[t.collectionId]});var vt=et();pt("keydown",Qt,d),pt("keyup",Qt,B);var At=j(vt);{var K=I=>{var H=bn(),lt=W(H),J=W(lt);{var _t=p=>{var tt=et(),bt=j(tt);Dt(bt,()=>t.breadcrumb,()=>({collection:i().data})),M(p,tt)};X(J,p=>{i().data&&p(_t)})}var zt=F(J,2);{var Ht=p=>{Ze(p,{get brightness(){return te(),a()},set brightness(tt){$t(r,tt)},get contrast(){return te(),T()},set contrast(tt){$t(m,tt)}})};X(zt,p=>{f()&&p(Ht)})}Z(lt);var Ct=F(lt,2);Xe(Ct,{class:"bg-border-hard"});var st=F(Ct,2),rt=W(st),Ot=W(rt);ue(Ot,{className:"h-full",children:(p,tt)=>{ge(p,{className:"h-full",children:(bt,Vt)=>{var Xt=_n(),Wt=W(Xt),Jt=W(Wt);pe(Jt,{get sampleId(){return t.sampleId},get collectionId(){return t.collectionId}});var qt=F(Jt,2);{var _e=yt=>{var Rt=et(),Ie=j(Rt);Dt(Ie,()=>t.children),M(yt,Rt)};X(qt,yt=>{t.children&&yt(_e)})}var be=F(qt,2);{let yt=D(()=>({...t.sample,sampleId:t.sampleId,annotations:e(z)})),Rt=D(()=>o==null?void 0:o.annotationId);vn(be,{get sample(){return e(yt)},get collectionId(){return t.collectionId},get imageUrl(){return t.sampleURL},get hideAnnotationsIds(){return e(k)},get isResizable(){return e(V)},get isEraser(){return e(It)},get selectedAnnotationId(){return e(Rt)},get annotationLabel(){return o.annotationLabel},get brushRadius(){return e(wt)},get refetch(){return t.refetch},get annotationType(){return e(ft)},toggleAnnotationSelection:U})}Z(Wt),Z(Xt),M(bt,Xt)},$$slots:{default:!0}})},$$slots:{default:!0}}),Z(rt);var Tt=F(rt,2),St=W(Tt);yn(St,{get sample(){return t.sample},onRemoveTag:L,get onUpdate(){return t.refetch},get collectionId(){return t.collectionId},get isPanModeEnabled(){return e(n)},get annotationsIdsToHide(){return e(k)},set annotationsIdsToHide(tt){y(k,tt,!0)},metadataItem:tt=>{var bt=et(),Vt=j(bt);Dt(Vt,()=>t.metadataValue),M(tt,bt)},$$slots:{metadataItem:!0}}),Z(Tt),Z(st),Z(H),M(I,H)},$=I=>{var H=In(),lt=W(H);Me(lt,{}),Z(H),M(I,H)};X(At,I=>{t.sample?I(K):I($,!1)})}M(x,vt),ot(),_()}var wn=ct('<div class="flex flex-col gap-2"></div>');function An(x,t){at(t,!0);const f=()=>Y(g,"$annotationLabels",E),[E,C]=dt();let i=gt(t,"annotationsIdsToHide",15);const{addReversibleAction:a,updateLastAnnotationLabel:T}=nt(),{context:s,setAnnotationId:_,setAnnotationLabel:w,setLastCreatedAnnotationId:A}=it(),g=Nt({collectionId:t.collectionId}),{createAnnotation:r}=Ft({collectionId:t.collectionId}),{deleteAnnotation:m}=Mt({collectionId:t.collectionId}),{selectAnnotation:v}=ve(),S=D(()=>t.annotations?[...t.annotations].filter(o=>o.annotation_type!==ut.CLASSIFICATION).sort((o,l)=>{var c;return o.annotation_label.annotation_label_name.localeCompare((c=l.annotation_label)==null?void 0:c.annotation_label_name)}):[]),R=o=>{t.isPanModeEnabled||v({annotationId:o,annotations:t.annotations,collectionId:t.collectionId})},P=async o=>{var h;if(!f().data)return;const l=(h=t.annotations)==null?void 0:h.find(n=>n.sample_id===o);if(!l)return;(async()=>{try{ie({annotation:l,labels:f().data,addReversibleAction:a,createAnnotation:r,refetch:t.refetch}),await m(o),Q.success("Annotation deleted successfully"),t.refetch(),s.annotationId===o&&_(null)}catch(n){Q.error("Failed to delete annotation. Please try again."),console.error("Error deleting annotation:",n)}})()},N=o=>{i(new Set(i().has(o)?[...i()].filter(l=>l!==o):[...i(),o]))};Fe(x,{title:"Annotations",children:(o,l)=>{var c=wn();he(c,21,()=>e(S),je,(h,n)=>{{let k=D(()=>s.annotationId===e(n).sample_id),b=D(()=>i().has(e(n).sample_id)),u=D(()=>s.lastCreatedAnnotationId===e(n).sample_id);Ue(h,{get annotation(){return e(n)},get isSelected(){return e(k)},onClick:()=>R(e(n).sample_id),onDeleteAnnotation:()=>P(e(n).sample_id),get isHidden(){return e(b)},onToggleShowAnnotation:d=>{d.stopPropagation(),N(e(n).sample_id)},get onUpdate(){return t.refetch},onChangeAnnotationLabel:d=>{w(d),T(t.collectionId,d),A(null),s.annotationType===ut.INSTANCE_SEGMENTATION&&_(e(n).sample_id)},get canHighlight(){return e(u)},onClickSelectList:()=>{_(e(n).sample_id)},onDelete:()=>{_(e(n).sample_id)}})}}),Z(c),M(o,c)}}),ot(),C()}var Sn=ct('<div class="flex h-full min-h-0 flex-col space-y-4 overflow-y-auto dark:[color-scheme:dark]"><!> <!> <!> <!> <!></div>');function yn(x,t){at(t,!0);let f=gt(t,"annotationsIdsToHide",15);const E=D(()=>t.sample.tags.map(i=>({tagId:i.tag_id,name:i.name}))??[]),{context:C}=it();mt(()=>{t.sample.annotations;const i=C.annotationId??C.lastCreatedAnnotationId;if(i){const a=document.querySelector(`button[data-annotation-id="${i}"]`);a&&a.scrollIntoView({behavior:"smooth",block:"nearest",inline:"nearest"})}}),ue(x,{className:"h-full",children:(i,a)=>{ge(i,{className:"h-full flex flex-col",children:(T,s)=>{var _=Sn(),w=W(_);ze(w,{get tags(){return e(E)},get onClick(){return t.onRemoveTag}});var A=F(w,2);An(A,{get collectionId(){return t.collectionId},get isPanModeEnabled(){return t.isPanModeEnabled},get refetch(){return t.onUpdate},get annotations(){return t.sample.annotations},get annotationsIdsToHide(){return f()},set annotationsIdsToHide(v){f(v)}});var g=F(A,2);He(g,{get collectionId(){return t.collectionId},get refetch(){return t.onUpdate},get annotations(){return t.sample.annotations},get sampleId(){return t.sample.sample_id}});var r=F(g,2);{let v=D(()=>{var S;return((S=t.sample)==null?void 0:S.captions)??[]});Oe(r,{get collectionId(){return t.collectionId},get refetch(){return t.onUpdate},get captions(){return e(v)},get sampleId(){return t.sample.sample_id}})}var m=F(r,2);Dt(m,()=>t.metadataItem),Z(_),M(T,_)},$$slots:{default:!0}})},$$slots:{default:!0}}),ot()}export{Kn as S};
