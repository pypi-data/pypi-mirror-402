import{b as P}from"./BDOtEUpJ.js";import{w as s,h as m,x as A}from"./Yb_TZ_Rf.js";function u(o,r){const l=s((()=>{if(typeof sessionStorage>"u")return r;try{const i=sessionStorage.getItem(o);if(i)return JSON.parse(i)}catch(i){console.warn(`Failed to read ${o} from sessionStorage`,i)}return r})());return l.subscribe(i=>{if(!(typeof sessionStorage>"u"))try{sessionStorage.setItem(o,JSON.stringify(i))}catch(h){console.warn(`Failed to write ${o} to sessionStorage`,h)}}),l}const d=s([]),V=()=>({reversibleActions:d,addReversibleAction:o=>{d.update(r=>[o,...r].slice(0,50))},executeReversibleAction:async o=>{const r=m(d),c=r.find(l=>l.id===o);if(c){await c.execute();const l=r.findIndex(i=>i.id===o);d.update(i=>i.slice(l+1))}},clearReversibleActions:()=>{d.set([])},clearReversibleActionsByGroupId:o=>{d.update(r=>r.filter(c=>c.groupId!==o))},hasReversibleActions:()=>m(d).length>0}),b=s("samples"),p=s({}),S=s({}),g=s(new Set),_=s(0),C=s(0),w=s(0),y=s(!1),v=s(void 0),x=u("lightlyStudio_sampleSize",{width:6,height:6}),I=u("lightlyStudio_metadata_bounds",{}),z=u("lightlyStudio_metadata_values",{}),B=u("lightlyStudio_metadata_info",[]),M=u("lightlyStudio_last_annotation_label",{}),R=u("lightlyStudio_last_annotation_brush_size",{}),H=s({}),J=s([]),f=s({}),L=s(!1),N=o=>{L.set(o)},O=s(1),$=s(1),F=s({}),T=s(!1),E=s({}),U=()=>{const o=V();return{tags:H,textEmbedding:v,setTextEmbedding:e=>{v.set(e)},selectedSampleIdsByCollection:p,getSelectedSampleIds:e=>A(p,t=>t[e]??new Set),selectedSampleAnnotationCropIds:S,selectedAnnotationFilterIds:g,filteredAnnotationCount:_,filteredSampleCount:C,collectionVersions:f,hideAnnotations:y,classifiers:J,metadataBounds:I,metadataValues:z,metadataInfo:B,updateMetadataValues:e=>{z.set(e)},updateMetadataBounds:e=>{I.set(e)},updateMetadataInfo:e=>{B.set(e)},filteredFramesCount:w,setHideAnnotations:e=>{y.set(e)},getCollectionVersion:async e=>{const t=m(f);if(t[e])return t[e];const{data:n}=await P({path:{collection_id:e}});if(n!=null&&n.created_at){const a=new Date(n.created_at).getTime().toString();return f.update(G=>({...G,[e]:a})),a}return""},toggleSampleSelection:(e,t)=>{p.update(n=>{const a=n[t]??new Set;return a.has(e)?a.delete(e):a.add(e),{...n,[t]:new Set([...a])}})},clearSelectedSamples:e=>{p.update(t=>({...t,[e]:new Set}))},toggleSampleAnnotationCropSelection:(e,t)=>{S.update(n=>{const a=n[e]??new Set;return a.has(t)?a.delete(t):a.add(t),n[e]=a,n})},clearSelectedSampleAnnotationCrops:e=>{S.update(t=>{const n=t[e];return n&&(n.clear(),t[e]=n),t})},lastGridType:b,setLastGridType:e=>{b.set(e)},setSelectedAnnotationFilterIds:e=>{g.update(t=>(t.has(e)?t.delete(e):t.add(e),t))},clearSelectedAnnotationFilterIds:()=>{g.update(e=>(e.clear(),e))},setfilteredAnnotationCount:e=>{_.set(e)},setfilteredSampleCount:e=>{C.set(e)},setfilteredFramesCount:e=>{w.set(e)},sampleSize:x,updateSampleSize:e=>{x.set({width:e,height:e})},isEditingMode:L,setIsEditingMode:N,showPlot:T,setShowPlot:e=>{T.set(e)},getRangeSelection:e=>A(E,t=>t[e]??null),setRangeSelectionForcollection:(e,t)=>{E.update(n=>({...n,[e]:t}))},imageBrightness:O,imageContrast:$,setCollection:e=>{F.update(t=>({...t,[e.collection_id]:{sampleType:e.sample_type,parentCollectionId:e.parent_collection_id,collectionId:e.collection_id}}))},retrieveParentCollection:(e,t)=>{const n=e[t];return n!=null&&n.parentCollectionId?e[n.parentCollectionId]:null},collections:F,lastAnnotationLabel:M,updateLastAnnotationLabel:(e,t)=>{M.update(n=>(n[e]=t,n))},lastAnnotationBrushSize:R,updateLastAnnotationBrushSize:(e,t)=>{R.update(n=>(n[e]=t,n))},...o}};export{u as a,U as u};
