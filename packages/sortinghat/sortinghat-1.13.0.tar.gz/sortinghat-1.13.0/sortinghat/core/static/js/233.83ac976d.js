"use strict";(self["webpackChunksortinghat_ui"]=self["webpackChunksortinghat_ui"]||[]).push([[233],{88233:(e,t,r)=>{r.r(t),r.d(t,{default:()=>Y});var n=r(20641);function a(e,t,r,a,s,i){var u=(0,n.g2)("tasks-table");return(0,n.uX)(),(0,n.Wv)(u,{"fetch-backends":i.fetchBackends,"fetch-tasks":i.fetchTasks,"create-task":i.createTask,"delete-task":i.deleteTask,"edit-task":i.editTask},null,8,["fetch-backends","fetch-tasks","create-task","delete-task","edit-task"])}var s=r(14048),i=r(30388),u=r(58663),o=r(20595),c=(r(62010),r(90033)),l=r(31969),d=r(13892),f=r(79669),k=r(69915),p=r(57254),m=r(4913),v=r(88249),h=r(19336),b=r(83260),_={class:"section"},y={class:"header"},w={key:0,class:"ma-8"},x={class:"pr-6 py-4 pl-8"},A={class:"subheader mb-0"},g={key:0,class:"v-list-item__subtitle text--secondary mb-0"},F={class:"text-right pr-8"};function T(e,t,r,a,s,i){var u=(0,n.g2)("importer-modal");return(0,n.uX)(),(0,n.CE)("section",_,[(0,n.Lk)("header",y,[t[5]||(t[5]=(0,n.Lk)("h1",{class:"title"},"Synchronization",-1)),(0,n.bF)(v.q,{"offset-y":""},{activator:(0,n.k6)((function(e){var r=e.props;return[(0,n.bF)(d.D,(0,n.v6)({color:"primary",variant:"flat",size:"small"},r),{default:(0,n.k6)((function(){return[t[4]||(t[4]=(0,n.eW)(" Select source ",-1)),(0,n.bF)(f.w,{color:"white",end:""},{default:(0,n.k6)((function(){return t[3]||(t[3]=[(0,n.eW)("mdi-chevron-down",-1)])})),_:1,__:[3]})]})),_:2,__:[4]},1040)]})),default:(0,n.k6)((function(){return[s.importers?((0,n.uX)(),(0,n.Wv)(k.x8,{key:0,density:"compact"},{default:(0,n.k6)((function(){return[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(s.importers,(function(e,t){return(0,n.uX)(),(0,n.Wv)(p.g,{key:t,onClick:function(t){return i.openModal(e)}},{default:(0,n.k6)((function(){return[(0,n.bF)(m.U,null,{default:(0,n.k6)((function(){return[(0,n.eW)((0,c.v_)(e.name),1)]})),_:2},1024)]})),_:2},1032,["onClick"])})),128))]})),_:1})):(0,n.Q3)("",!0)]})),_:1})]),s.error?((0,n.uX)(),(0,n.Wv)(l.l,{key:0,text:"",type:"error"},{default:(0,n.k6)((function(){return[(0,n.eW)((0,c.v_)(s.error),1)]})),_:1})):(0,n.Q3)("",!0),s.isLoading?((0,n.uX)(),(0,n.Wv)(h.Z,{key:1,indeterminate:"",color:"primary"})):((0,n.uX)(),(0,n.Wv)(b.Z,{key:2},{default:(0,n.k6)((function(){return[0===s.tasks.length?((0,n.uX)(),(0,n.CE)("div",w,t[6]||(t[6]=[(0,n.Lk)("h3",{class:"text-subtitle-2"},"No connected sources",-1),(0,n.Lk)("p",{class:"text-body-2"}," You can sync identities data from different data sources automatically and periodically. ",-1)]))):(0,n.Q3)("",!0),(0,n.Lk)("tbody",null,[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(s.tasks,(function(r){return(0,n.uX)(),(0,n.CE)("tr",{key:r.id},[(0,n.Lk)("td",x,[(0,n.Lk)("p",A,(0,c.v_)(r.args.backend_name),1),r.lastExecution?((0,n.uX)(),(0,n.CE)("p",g,[(0,n.bF)(f.w,{color:r.failed?"failed":"finished","aria-label":r.failed?"failed":"finished","aria-hidden":"false",class:"mb-1 mr-1",small:""},{default:(0,n.k6)((function(){return[(0,n.eW)((0,c.v_)(r.failed?"mdi-alert":"mdi-check"),1)]})),_:2},1032,["color","aria-label"]),(0,n.eW)(" Last sync "+(0,c.v_)(e.$formatDate(r.lastExecution)),1)])):(0,n.Q3)("",!0)]),(0,n.Lk)("td",F,[(0,n.bF)(d.D,{class:"mr-2",color:"primary",text:"",small:"",outlined:"",onClick:function(e){return i.openModal(r.args.backend_name,r)}},{default:(0,n.k6)((function(){return[(0,n.bF)(f.w,{small:""},{default:(0,n.k6)((function(){return t[7]||(t[7]=[(0,n.eW)("mdi-pencil",-1)])})),_:1,__:[7]}),t[8]||(t[8]=(0,n.Lk)("span",{class:"d-sr-only"},"Edit task",-1))]})),_:2,__:[8]},1032,["onClick"]),(0,n.bF)(d.D,{color:"primary",text:"",small:"",outlined:"",onClick:function(e){return i.deleteItem(r.id)}},{default:(0,n.k6)((function(){return[(0,n.bF)(f.w,{small:""},{default:(0,n.k6)((function(){return t[9]||(t[9]=[(0,n.eW)("mdi-delete",-1)])})),_:1,__:[9]}),t[10]||(t[10]=(0,n.Lk)("span",{class:"d-sr-only"},"Delete task",-1))]})),_:2,__:[10]},1032,["onClick"])])])})),128))])]})),_:1})),s.modal.isOpen?((0,n.uX)(),(0,n.Wv)(u,{key:3,"is-open":s.modal.isOpen,"onUpdate:isOpen":t[0]||(t[0]=function(e){return s.modal.isOpen=e}),"create-task":r.createTask,"edit-task":r.editTask,task:s.modal.task,importer:s.modal.importer,"onUpdate:open":t[1]||(t[1]=function(e){return s.modal.isOpen=e}),"onUpdate:tasks":t[2]||(t[2]=function(e){return i.getTasks()})},null,8,["is-open","create-task","edit-task","task","importer"])):(0,n.Q3)("",!0)])}r(50113),r(18111),r(20116),r(26099);var C=r(4189),W=r(91606),L=r(30697),E=r(93745),$=r(91772),I=r(56756),X=r(35526),O=r(41720),S=r(20552),q=r(49930),M=r(43948);function V(e,t,r,a,s,i){return(0,n.uX)(),(0,n.Wv)($.p,{"model-value":r.isOpen,"max-width":"450","onClick:outside":t[2]||(t[2]=function(t){return e.$emit("update:open")})},{default:(0,n.k6)((function(){return[(0,n.bF)(C.J,{class:"section"},{default:(0,n.k6)((function(){return[(0,n.bF)(W.r,{class:"header title"},{default:(0,n.k6)((function(){return[(0,n.eW)(" Import identities from "+(0,c.v_)(r.importer.name),1)]})),_:1}),(0,n.bF)(L.O,{class:"mt-3"},{default:(0,n.k6)((function(){return[t[4]||(t[4]=(0,n.Lk)("h3",{class:"subheader mb-2"},"Settings",-1)),((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(s.form.fields,(function(e,t){return(0,n.uX)(),(0,n.Wv)(I.L,{key:t,class:"pa-3"},{default:(0,n.k6)((function(){return[(0,n.bF)(M.W,{modelValue:s.form.fields[t],"onUpdate:modelValue":function(e){return s.form.fields[t]=e},label:t,dense:"","hide-details":"",outlined:""},null,8,["modelValue","onUpdate:modelValue","label"])]})),_:2},1024)})),128)),(0,n.bF)(I.L,null,{default:(0,n.k6)((function(){return[(0,n.bF)(X.B,{cols:"6"},{default:(0,n.k6)((function(){return[(0,n.bF)(q.$,{modelValue:s.form.interval,"onUpdate:modelValue":t[0]||(t[0]=function(e){return s.form.interval=e}),class:"mt-0",dense:""},{label:(0,n.k6)((function(){return t[3]||(t[3]=[(0,n.Lk)("h3",{class:"subheader"},"Run script",-1)])})),default:(0,n.k6)((function(){return[(0,n.bF)(S.i,{value:0,label:"Once"}),(0,n.bF)(S.i,{value:10080,label:"Every week"}),(0,n.bF)(S.i,{value:43800,label:"Every month"}),(0,n.bF)(S.i,{value:"custom",label:"Custom"})]})),_:1},8,["modelValue"]),(0,n.bF)(M.W,{modelValue:s.form.customInterval,"onUpdate:modelValue":t[1]||(t[1]=function(e){return s.form.customInterval=e}),label:"Every",type:"number",suffix:"minutes",class:"ml-8",dense:"","hide-details":"",outlined:""},null,8,["modelValue"])]})),_:1})]})),_:1}),s.error?((0,n.uX)(),(0,n.Wv)(l.l,{key:0,text:"",type:"error",class:"ma-5"},{default:(0,n.k6)((function(){return[(0,n.eW)((0,c.v_)(s.error),1)]})),_:1})):(0,n.Q3)("",!0)]})),_:1,__:[4]}),(0,n.bF)(E.S,null,{default:(0,n.k6)((function(){return[(0,n.bF)(O.h),(0,n.bF)(d.D,{color:"primary",variant:"text",onClick:i.onClose},{default:(0,n.k6)((function(){return t[5]||(t[5]=[(0,n.eW)(" Cancel ",-1)])})),_:1,__:[5]},8,["onClick"]),(0,n.bF)(d.D,{color:"primary",disabled:!s.form.fields.url,variant:"flat",onClick:i.onSave},{default:(0,n.k6)((function(){return t[6]||(t[6]=[(0,n.eW)(" Save ",-1)])})),_:1,__:[6]},8,["disabled","onClick"])]})),_:1})]})),_:1})]})),_:1},8,["model-value"])}var B=r(23772),D=r(41034);r(72712),r(60739),r(18237),r(33110),r(2892);const U={name:"ImporterModal",props:{importer:{type:Object,required:!0},task:{type:Object,required:!0},createTask:{type:Function,required:!0},editTask:{type:Function,required:!0},isOpen:{type:Boolean,default:!1}},data:function(){return{form:{fields:{},interval:this.task.interval||0,customInterval:""},error:null}},methods:{onSave:function(){this.task.id?this.updateTask():this.addTask()},onClose:function(){this.$emit("update:open",!1)},addTask:function(){var e=this;return(0,i.A)((0,s.A)().mark((function t(){var r,n,a;return(0,s.A)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,r="custom"===e.form.interval?e.form.customInterval:e.form.interval,n=JSON.stringify((0,D.A)({backend_name:e.importer.name},e.form.fields)),t.next=5,e.createTask("import_identities",Number(r),n);case 5:a=t.sent,a&&!a.errors&&(e.$emit("update:open",!1),e.$emit("update:tasks")),t.next=12;break;case 9:t.prev=9,t.t0=t["catch"](0),e.error=e.$getErrorMessage(t.t0);case 12:case"end":return t.stop()}}),t,null,[[0,9]])})))()},updateTask:function(){var e=this;return(0,i.A)((0,s.A)().mark((function t(){var r,n,a,i;return(0,s.A)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,r="custom"===e.form.interval?e.form.customInterval:e.form.interval,n=JSON.stringify((0,D.A)({backend_name:e.importer.name},e.form.fields)),a={interval:Number(r),params:n},t.next=6,e.editTask(e.task.id,a);case 6:i=t.sent,i&&!i.errors&&(e.$emit("update:open",!1),e.$emit("update:tasks")),t.next=13;break;case 10:t.prev=10,t.t0=t["catch"](0),e.error=e.$getErrorMessage(t.t0);case 13:case"end":return t.stop()}}),t,null,[[0,10]])})))()},buildForm:function(){var e=this,t=[0,10080,43800],r=this.task.args||{},n=this.importer.args.reduce((function(e,t){return(0,D.A)((0,D.A)({},e),{},(0,B.A)({},t,r[t]))}),{});this.form.fields=n,this.task.interval&&!t.find((function(t){return t===e.task.interval}))&&(this.form.customInterval=this.task.interval,this.form.interval="custom")}},mounted:function(){this.buildForm()}};var Q=r(64621);const N=(0,Q.A)(U,[["render",V]]),K=N,j={name:"TasksTable",components:{ImporterModal:K},props:{fetchBackends:{type:Function,required:!0},fetchTasks:{type:Function,required:!0},createTask:{type:Function,required:!0},deleteTask:{type:Function,required:!0},editTask:{type:Function,required:!0}},data:function(){return{importers:[],tasks:[],error:null,isLoading:!1,modal:{isOpen:!1,task:{},importer:{}}}},methods:{openModal:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};"string"===typeof e&&(e=this.importers.find((function(t){return t.name===e}))),Object.assign(this.modal,{isOpen:!0,importer:e,task:t})},getBackends:function(){var e=this;return(0,i.A)((0,s.A)().mark((function t(){var r;return(0,s.A)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.fetchBackends();case 3:r=t.sent,e.importers=r.data.identitiesImportersTypes,t.next=10;break;case 7:t.prev=7,t.t0=t["catch"](0),e.error=e.$getErrorMessage(t.t0);case 10:case"end":return t.stop()}}),t,null,[[0,7]])})))()},getTasks:function(){var e=this;return(0,i.A)((0,s.A)().mark((function t(){var r;return(0,s.A)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,e.isLoading=!0,t.next=4,e.fetchTasks();case 4:r=t.sent,e.tasks=r.data.scheduledTasks.entities,t.next=11;break;case 8:t.prev=8,t.t0=t["catch"](0),e.error=e.$getErrorMessage(t.t0);case 11:return t.prev=11,e.isLoading=!1,t.finish(11);case 14:case"end":return t.stop()}}),t,null,[[0,8,11,14]])})))()},deleteItem:function(e){var t=this;return(0,i.A)((0,s.A)().mark((function r(){var n;return(0,s.A)().wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,t.deleteTask(e);case 3:n=r.sent,n.data.deleteScheduledTask&&t.getTasks(),r.next=10;break;case 7:r.prev=7,r.t0=r["catch"](0),t.error=t.$getErrorMessage(r.t0);case 10:case"end":return r.stop()}}),r,null,[[0,7]])})))()}},mounted:function(){var e=this;return(0,i.A)((0,s.A)().mark((function t(){return(0,s.A)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.getTasks(),t.next=3,e.getBackends();case 3:case"end":return t.stop()}}),t)})))()}},J=(0,Q.A)(j,[["render",T],["__scopeId","data-v-6f4f35ba"]]),z=J,Z={name:"SettingsSync",components:{TasksTable:z},methods:{fetchBackends:function(){var e=this;return(0,i.A)((0,s.A)().mark((function t(){var r;return(0,s.A)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,(0,u.Kr)(e.$apollo);case 2:return r=t.sent,t.abrupt("return",r);case 4:case"end":return t.stop()}}),t)})))()},fetchTasks:function(){var e=this;return(0,i.A)((0,s.A)().mark((function t(){var r;return(0,s.A)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,(0,u.CF)(e.$apollo);case 2:return r=t.sent,t.abrupt("return",r);case 4:case"end":return t.stop()}}),t)})))()},createTask:function(e,t,r){var n=this;return(0,i.A)((0,s.A)().mark((function a(){var i;return(0,s.A)().wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,(0,o.nD)(n.$apollo,e,t,r);case 2:return i=a.sent,a.abrupt("return",i);case 4:case"end":return a.stop()}}),a)})))()},deleteTask:function(e){var t=this;return(0,i.A)((0,s.A)().mark((function r(){var n;return(0,s.A)().wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.next=2,(0,o.I8)(t.$apollo,e);case 2:return n=r.sent,r.abrupt("return",n);case 4:case"end":return r.stop()}}),r)})))()},editTask:function(e,t){var r=this;return(0,i.A)((0,s.A)().mark((function n(){var a;return(0,s.A)().wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,(0,o.i4)(r.$apollo,e,t);case 2:return a=n.sent,n.abrupt("return",a);case 4:case"end":return n.stop()}}),n)})))()}}},R=(0,Q.A)(Z,[["render",a]]),Y=R}}]);
//# sourceMappingURL=233.83ac976d.js.map