"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[803],{2507:(t,e,a)=>{a.d(e,{$L:()=>L,rL:()=>U,vl:()=>J});var r,o=a(5071),s=a(4876),i=a(6767);a(5704);var l=Object.defineProperty,n=Symbol.for("vercel.ai.error.AI_NoOutputSpecifiedError");s.bD;Symbol.for("vercel.ai.error.AI_InvalidArgumentError");s.bD;Symbol.for("vercel.ai.error.AI_InvalidStreamPartError");s.bD;Symbol.for("vercel.ai.error.AI_InvalidToolInputError");s.bD;Symbol.for("vercel.ai.error.AI_NoImageGeneratedError");s.bD;var p="AI_NoObjectGeneratedError",d=`vercel.ai.error.${p}`,u=Symbol.for(d),c=class extends s.bD{constructor({message:t="No object generated.",cause:e,text:a,response:o,usage:s,finishReason:i}){super({name:p,message:t,cause:e}),this[r]=!0,this.text=a,this.response=o,this.usage=s,this.finishReason=i}static isInstance(t){return s.bD.hasMarker(t,d)}};r=u;Symbol.for("vercel.ai.error.AI_NoOutputGeneratedError");s.bD,s.bD;Symbol.for("vercel.ai.error.AI_NoSuchToolError");s.bD;Symbol.for("vercel.ai.error.AI_ToolCallRepairError");s.bD,s.bD;Symbol.for("vercel.ai.error.AI_InvalidDataContentError");s.bD;Symbol.for("vercel.ai.error.AI_InvalidMessageRoleError");s.bD;Symbol.for("vercel.ai.error.AI_MessageConversionError");s.bD;Symbol.for("vercel.ai.error.AI_DownloadError");s.bD;Symbol.for("vercel.ai.error.AI_RetryError");s.bD;var h="5.0.115",m=i.z.union([i.z.string(),i.z.instanceof(Uint8Array),i.z.instanceof(ArrayBuffer),i.z.custom(t=>{var e,a;return null!=(a=null==(e=globalThis.Buffer)?void 0:e.isBuffer(t))&&a},{message:"Must be a Buffer"})]),g=i.z.lazy(()=>i.z.union([i.z.null(),i.z.string(),i.z.number(),i.z.boolean(),i.z.record(i.z.string(),g),i.z.array(g)])),z=i.z.record(i.z.string(),i.z.record(i.z.string(),g)),v=i.z.object({type:i.z.literal("text"),text:i.z.string(),providerOptions:z.optional()}),b=i.z.object({type:i.z.literal("image"),image:i.z.union([m,i.z.instanceof(URL)]),mediaType:i.z.string().optional(),providerOptions:z.optional()}),y=i.z.object({type:i.z.literal("file"),data:i.z.union([m,i.z.instanceof(URL)]),filename:i.z.string().optional(),mediaType:i.z.string(),providerOptions:z.optional()}),I=i.z.object({type:i.z.literal("reasoning"),text:i.z.string(),providerOptions:z.optional()}),E=i.z.object({type:i.z.literal("tool-call"),toolCallId:i.z.string(),toolName:i.z.string(),input:i.z.unknown(),providerOptions:z.optional(),providerExecuted:i.z.boolean().optional()}),f=i.z.discriminatedUnion("type",[i.z.object({type:i.z.literal("text"),value:i.z.string()}),i.z.object({type:i.z.literal("json"),value:g}),i.z.object({type:i.z.literal("error-text"),value:i.z.string()}),i.z.object({type:i.z.literal("error-json"),value:g}),i.z.object({type:i.z.literal("content"),value:i.z.array(i.z.union([i.z.object({type:i.z.literal("text"),text:i.z.string()}),i.z.object({type:i.z.literal("media"),data:i.z.string(),mediaType:i.z.string()})]))})]),T=i.z.object({type:i.z.literal("tool-result"),toolCallId:i.z.string(),toolName:i.z.string(),output:f,providerOptions:z.optional()}),x=i.z.object({role:i.z.literal("system"),content:i.z.string(),providerOptions:z.optional()}),w=i.z.object({role:i.z.literal("user"),content:i.z.union([i.z.string(),i.z.array(i.z.union([v,b,y]))]),providerOptions:z.optional()}),_=i.z.object({role:i.z.literal("assistant"),content:i.z.union([i.z.string(),i.z.array(i.z.union([v,y,I,E,T]))]),providerOptions:z.optional()}),R=i.z.object({role:i.z.literal("tool"),content:i.z.array(T),providerOptions:z.optional()});i.z.union([x,w,_,R]),(0,o.hK)({prefix:"aitxt",size:24}),TransformStream;var M=(0,o.fE)(()=>(0,o.jN)(i.z.union([i.z.strictObject({type:i.z.literal("text-start"),id:i.z.string(),providerMetadata:z.optional()}),i.z.strictObject({type:i.z.literal("text-delta"),id:i.z.string(),delta:i.z.string(),providerMetadata:z.optional()}),i.z.strictObject({type:i.z.literal("text-end"),id:i.z.string(),providerMetadata:z.optional()}),i.z.strictObject({type:i.z.literal("error"),errorText:i.z.string()}),i.z.strictObject({type:i.z.literal("tool-input-start"),toolCallId:i.z.string(),toolName:i.z.string(),providerExecuted:i.z.boolean().optional(),dynamic:i.z.boolean().optional()}),i.z.strictObject({type:i.z.literal("tool-input-delta"),toolCallId:i.z.string(),inputTextDelta:i.z.string()}),i.z.strictObject({type:i.z.literal("tool-input-available"),toolCallId:i.z.string(),toolName:i.z.string(),input:i.z.unknown(),providerExecuted:i.z.boolean().optional(),providerMetadata:z.optional(),dynamic:i.z.boolean().optional()}),i.z.strictObject({type:i.z.literal("tool-input-error"),toolCallId:i.z.string(),toolName:i.z.string(),input:i.z.unknown(),providerExecuted:i.z.boolean().optional(),providerMetadata:z.optional(),dynamic:i.z.boolean().optional(),errorText:i.z.string()}),i.z.strictObject({type:i.z.literal("tool-output-available"),toolCallId:i.z.string(),output:i.z.unknown(),providerExecuted:i.z.boolean().optional(),dynamic:i.z.boolean().optional(),preliminary:i.z.boolean().optional()}),i.z.strictObject({type:i.z.literal("tool-output-error"),toolCallId:i.z.string(),errorText:i.z.string(),providerExecuted:i.z.boolean().optional(),dynamic:i.z.boolean().optional()}),i.z.strictObject({type:i.z.literal("reasoning-start"),id:i.z.string(),providerMetadata:z.optional()}),i.z.strictObject({type:i.z.literal("reasoning-delta"),id:i.z.string(),delta:i.z.string(),providerMetadata:z.optional()}),i.z.strictObject({type:i.z.literal("reasoning-end"),id:i.z.string(),providerMetadata:z.optional()}),i.z.strictObject({type:i.z.literal("source-url"),sourceId:i.z.string(),url:i.z.string(),title:i.z.string().optional(),providerMetadata:z.optional()}),i.z.strictObject({type:i.z.literal("source-document"),sourceId:i.z.string(),mediaType:i.z.string(),title:i.z.string(),filename:i.z.string().optional(),providerMetadata:z.optional()}),i.z.strictObject({type:i.z.literal("file"),url:i.z.string(),mediaType:i.z.string(),providerMetadata:z.optional()}),i.z.strictObject({type:i.z.custom(t=>"string"==typeof t&&t.startsWith("data-"),{message:'Type must start with "data-"'}),id:i.z.string().optional(),data:i.z.unknown(),transient:i.z.boolean().optional()}),i.z.strictObject({type:i.z.literal("start-step")}),i.z.strictObject({type:i.z.literal("finish-step")}),i.z.strictObject({type:i.z.literal("start"),messageId:i.z.string().optional(),messageMetadata:i.z.unknown().optional()}),i.z.strictObject({type:i.z.literal("finish"),finishReason:i.z.enum(["stop","length","content-filter","tool-calls","error","other","unknown"]).optional(),messageMetadata:i.z.unknown().optional()}),i.z.strictObject({type:i.z.literal("abort")}),i.z.strictObject({type:i.z.literal("message-metadata"),messageMetadata:i.z.unknown()})])));async function A(t){if(void 0===t)return{value:void 0,state:"undefined-input"};let e=await (0,o.N8)({text:t});return e.success?{value:e.value,state:"successful-parse"}:(e=await (0,o.N8)({text:function(t){let e=["ROOT"],a=-1,r=null;function o(t,o,s){switch(t){case'"':a=o,e.pop(),e.push(s),e.push("INSIDE_STRING");break;case"f":case"t":case"n":a=o,r=o,e.pop(),e.push(s),e.push("INSIDE_LITERAL");break;case"-":e.pop(),e.push(s),e.push("INSIDE_NUMBER");break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":a=o,e.pop(),e.push(s),e.push("INSIDE_NUMBER");break;case"{":a=o,e.pop(),e.push(s),e.push("INSIDE_OBJECT_START");break;case"[":a=o,e.pop(),e.push(s),e.push("INSIDE_ARRAY_START")}}function s(t,r){switch(t){case",":e.pop(),e.push("INSIDE_OBJECT_AFTER_COMMA");break;case"}":a=r,e.pop()}}function i(t,r){switch(t){case",":e.pop(),e.push("INSIDE_ARRAY_AFTER_COMMA");break;case"]":a=r,e.pop()}}for(let l=0;l<t.length;l++){let n=t[l];switch(e[e.length-1]){case"ROOT":o(n,l,"FINISH");break;case"INSIDE_OBJECT_START":switch(n){case'"':e.pop(),e.push("INSIDE_OBJECT_KEY");break;case"}":a=l,e.pop()}break;case"INSIDE_OBJECT_AFTER_COMMA":'"'===n&&(e.pop(),e.push("INSIDE_OBJECT_KEY"));break;case"INSIDE_OBJECT_KEY":'"'===n&&(e.pop(),e.push("INSIDE_OBJECT_AFTER_KEY"));break;case"INSIDE_OBJECT_AFTER_KEY":":"===n&&(e.pop(),e.push("INSIDE_OBJECT_BEFORE_VALUE"));break;case"INSIDE_OBJECT_BEFORE_VALUE":o(n,l,"INSIDE_OBJECT_AFTER_VALUE");break;case"INSIDE_OBJECT_AFTER_VALUE":s(n,l);break;case"INSIDE_STRING":switch(n){case'"':e.pop(),a=l;break;case"\\":e.push("INSIDE_STRING_ESCAPE");break;default:a=l}break;case"INSIDE_ARRAY_START":"]"===n?(a=l,e.pop()):(a=l,o(n,l,"INSIDE_ARRAY_AFTER_VALUE"));break;case"INSIDE_ARRAY_AFTER_VALUE":switch(n){case",":e.pop(),e.push("INSIDE_ARRAY_AFTER_COMMA");break;case"]":a=l,e.pop();break;default:a=l}break;case"INSIDE_ARRAY_AFTER_COMMA":o(n,l,"INSIDE_ARRAY_AFTER_VALUE");break;case"INSIDE_STRING_ESCAPE":e.pop(),a=l;break;case"INSIDE_NUMBER":switch(n){case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":a=l;break;case"e":case"E":case"-":case".":break;case",":e.pop(),"INSIDE_ARRAY_AFTER_VALUE"===e[e.length-1]&&i(n,l),"INSIDE_OBJECT_AFTER_VALUE"===e[e.length-1]&&s(n,l);break;case"}":e.pop(),"INSIDE_OBJECT_AFTER_VALUE"===e[e.length-1]&&s(n,l);break;case"]":e.pop(),"INSIDE_ARRAY_AFTER_VALUE"===e[e.length-1]&&i(n,l);break;default:e.pop()}break;case"INSIDE_LITERAL":{let o=t.substring(r,l+1);"false".startsWith(o)||"true".startsWith(o)||"null".startsWith(o)?a=l:(e.pop(),"INSIDE_OBJECT_AFTER_VALUE"===e[e.length-1]?s(n,l):"INSIDE_ARRAY_AFTER_VALUE"===e[e.length-1]&&i(n,l))}}}let l=t.slice(0,a+1);for(let a=e.length-1;a>=0;a--)switch(e[a]){case"INSIDE_STRING":l+='"';break;case"INSIDE_OBJECT_KEY":case"INSIDE_OBJECT_AFTER_KEY":case"INSIDE_OBJECT_AFTER_COMMA":case"INSIDE_OBJECT_START":case"INSIDE_OBJECT_BEFORE_VALUE":case"INSIDE_OBJECT_AFTER_VALUE":l+="}";break;case"INSIDE_ARRAY_START":case"INSIDE_ARRAY_AFTER_COMMA":case"INSIDE_ARRAY_AFTER_VALUE":l+="]";break;case"INSIDE_LITERAL":{let e=t.substring(r,t.length);"true".startsWith(e)?l+="true".slice(e.length):"false".startsWith(e)?l+="false".slice(e.length):"null".startsWith(e)&&(l+="null".slice(e.length))}}return l}(t)})).success?{value:e.value,state:"repaired-parse"}:{value:void 0,state:"failed-parse"}}function C(t){return t.type.startsWith("tool-")}function S(t){return C(t)||"dynamic-tool"===t.type}function N(t){return t.type.split("-").slice(1).join("-")}async function k({stream:t,onError:e}){let a=t.getReader();try{for(;;){let{done:t}=await a.read();if(t)break}}catch(t){null==e||e(t)}finally{a.releaseLock()}}(0,o.hK)({prefix:"aitxt",size:24}),(0,o.hK)({prefix:"aiobj",size:24});var j=class{constructor(){this.queue=[],this.isProcessing=!1}async processQueue(){if(!this.isProcessing){for(this.isProcessing=!0;this.queue.length>0;)await this.queue[0](),this.queue.shift();this.isProcessing=!1}}async run(t){return new Promise((e,a)=>{this.queue.push(async()=>{try{await t(),e()}catch(t){a(t)}}),this.processQueue()})}};(0,o.hK)({prefix:"aiobj",size:24}),((t,e)=>{for(var a in e)l(t,a,{get:e[a],enumerable:!0})})({},{object:()=>D,text:()=>O});var O=()=>({type:"text",responseFormat:{type:"text"},parsePartial:async({text:t})=>({partial:t}),parseOutput:async({text:t})=>t}),D=({schema:t})=>{let e=(0,o.mD)(t);return{type:"object",responseFormat:{type:"json",schema:e.jsonSchema},async parsePartial({text:t}){let e=await A(t);switch(e.state){case"failed-parse":case"undefined-input":return;case"repaired-parse":case"successful-parse":return{partial:e.value};default:{let t=e.state;throw Error(`Unsupported parse state: ${t}`)}}},async parseOutput({text:t},a){let r=await (0,o.N8)({text:t});if(!r.success)throw new c({message:"No object generated: could not parse the response.",cause:r.error,text:t,response:a.response,usage:a.usage,finishReason:a.finishReason});let s=await (0,o.ZZ)({value:r.value,schema:e});if(!s.success)throw new c({message:"No object generated: response did not match schema.",cause:s.error,text:t,response:a.response,usage:a.usage,finishReason:a.finishReason});return s.value}}},P=Symbol.for("vercel.ai.error.AI_NoSuchProviderError");async function F({stream:t,onTextPart:e}){let a=t.pipeThrough(new TextDecoderStream).getReader();for(;;){let{done:t,value:r}=await a.read();if(t)break;await e(r)}}async function L({api:t,prompt:e,credentials:a,headers:r,body:s,streamProtocol:i="data",setCompletion:l,setLoading:n,setError:p,setAbortController:d,onFinish:u,onError:c,fetch:m=fetch}){var g;try{n(!0),p(void 0);let c=new AbortController;d(c),l("");let z=await m(t,{method:"POST",body:JSON.stringify({prompt:e,...s}),credentials:a,headers:(0,o.WZ)({"Content-Type":"application/json",...r},`ai-sdk/${h}`,(0,o.G1)()),signal:c.signal}).catch(t=>{throw t});if(!z.ok)throw Error(null!=(g=await z.text())?g:"Failed to fetch the chat response.");if(!z.body)throw Error("The response body is empty.");let v="";switch(i){case"text":await F({stream:z.body,onTextPart:t=>{v+=t,l(v)}});break;case"data":await k({stream:(0,o._Z)({stream:z.body,schema:M}).pipeThrough(new TransformStream({async transform(t){if(!t.success)throw t.error;let e=t.value;if("text-delta"===e.type)v+=e.delta,l(v);else if("error"===e.type)throw Error(e.errorText)}})),onError:t=>{throw t}});break;default:throw Error(`Unknown stream protocol: ${i}`)}return u&&u(e,v),d(null),v}catch(t){if("AbortError"===t.name)return d(null),null;t instanceof Error&&c&&c(t),p(t)}finally{n(!1)}}async function B(t){if(null==t)return[];if(!globalThis.FileList||!(t instanceof globalThis.FileList))throw Error("FileList is not supported in the current environment");return Promise.all(Array.from(t).map(async t=>{let{name:e,type:a}=t;return{type:"file",mediaType:a,filename:e,url:await new Promise((e,a)=>{let r=new FileReader;r.onload=t=>{var a;e(null==(a=t.target)?void 0:a.result)},r.onerror=t=>a(t),r.readAsDataURL(t)})}}))}s.eM,s.bD;var q=class{constructor({api:t="/api/chat",credentials:e,headers:a,body:r,fetch:o,prepareSendMessagesRequest:s,prepareReconnectToStreamRequest:i}){this.api=t,this.credentials=e,this.headers=a,this.body=r,this.fetch=o,this.prepareSendMessagesRequest=s,this.prepareReconnectToStreamRequest=i}async sendMessages({abortSignal:t,...e}){var a,r,s,i,l;let n=await (0,o.hd)(this.body),p=await (0,o.hd)(this.headers),d=await (0,o.hd)(this.credentials),u={...(0,o.qx)(p),...(0,o.qx)(e.headers)},c=await (null==(a=this.prepareSendMessagesRequest)?void 0:a.call(this,{api:this.api,id:e.chatId,messages:e.messages,body:{...n,...e.body},headers:u,credentials:d,requestMetadata:e.metadata,trigger:e.trigger,messageId:e.messageId})),m=null!=(r=null==c?void 0:c.api)?r:this.api,g=(null==c?void 0:c.headers)!==void 0?(0,o.qx)(c.headers):u,z=(null==c?void 0:c.body)!==void 0?c.body:{...n,...e.body,id:e.chatId,messages:e.messages,trigger:e.trigger,messageId:e.messageId},v=null!=(s=null==c?void 0:c.credentials)?s:d,b=null!=(i=this.fetch)?i:globalThis.fetch,y=await b(m,{method:"POST",headers:(0,o.WZ)({"Content-Type":"application/json",...g},`ai-sdk/${h}`,(0,o.G1)()),body:JSON.stringify(z),credentials:v,signal:t});if(!y.ok)throw Error(null!=(l=await y.text())?l:"Failed to fetch the chat response.");if(!y.body)throw Error("The response body is empty.");return this.processResponseStream(y.body)}async reconnectToStream(t){var e,a,r,s,i;let l=await (0,o.hd)(this.body),n=await (0,o.hd)(this.headers),p=await (0,o.hd)(this.credentials),d={...(0,o.qx)(n),...(0,o.qx)(t.headers)},u=await (null==(e=this.prepareReconnectToStreamRequest)?void 0:e.call(this,{api:this.api,id:t.chatId,body:{...l,...t.body},headers:d,credentials:p,requestMetadata:t.metadata})),c=null!=(a=null==u?void 0:u.api)?a:`${this.api}/${t.chatId}/stream`,m=(null==u?void 0:u.headers)!==void 0?(0,o.qx)(u.headers):d,g=null!=(r=null==u?void 0:u.credentials)?r:p,z=null!=(s=this.fetch)?s:globalThis.fetch,v=await z(c,{method:"GET",headers:(0,o.WZ)(m,`ai-sdk/${h}`,(0,o.G1)()),credentials:g});if(204===v.status)return null;if(!v.ok)throw Error(null!=(i=await v.text())?i:"Failed to fetch the chat response.");if(!v.body)throw Error("The response body is empty.");return this.processResponseStream(v.body)}},U=class extends q{constructor(t={}){super(t)}processResponseStream(t){return(0,o._Z)({stream:t,schema:M}).pipeThrough(new TransformStream({async transform(t,e){if(!t.success)throw t.error;e.enqueue(t.value)}}))}},J=class{constructor({generateId:t=o.$C,id:e=t(),transport:a=new U,messageMetadataSchema:r,dataPartSchemas:s,state:i,onError:l,onToolCall:n,onFinish:p,onData:d,sendAutomaticallyWhen:u}){this.activeResponse=void 0,this.jobExecutor=new j,this.sendMessage=async(t,e)=>{var a,r,o,s;let i;if(null==t)return void await this.makeRequest({trigger:"submit-message",messageId:null==(a=this.lastMessage)?void 0:a.id,...e});if(i="text"in t||"files"in t?{parts:[...Array.isArray(t.files)?t.files:await B(t.files),..."text"in t&&null!=t.text?[{type:"text",text:t.text}]:[]]}:t,null!=t.messageId){let e=this.state.messages.findIndex(e=>e.id===t.messageId);if(-1===e)throw Error(`message with id ${t.messageId} not found`);if("user"!==this.state.messages[e].role)throw Error(`message with id ${t.messageId} is not a user message`);this.state.messages=this.state.messages.slice(0,e+1),this.state.replaceMessage(e,{...i,id:t.messageId,role:null!=(r=i.role)?r:"user",metadata:t.metadata})}else this.state.pushMessage({...i,id:null!=(o=i.id)?o:this.generateId(),role:null!=(s=i.role)?s:"user",metadata:t.metadata});await this.makeRequest({trigger:"submit-message",messageId:t.messageId,...e})},this.regenerate=async({messageId:t,...e}={})=>{let a=null==t?this.state.messages.length-1:this.state.messages.findIndex(e=>e.id===t);if(-1===a)throw Error(`message ${t} not found`);this.state.messages=this.state.messages.slice(0,"assistant"===this.messages[a].role?a:a+1),await this.makeRequest({trigger:"regenerate-message",messageId:t,...e})},this.resumeStream=async(t={})=>{await this.makeRequest({trigger:"resume-stream",...t})},this.clearError=()=>{"error"===this.status&&(this.state.error=void 0,this.setStatus({status:"ready"}))},this.addToolOutput=async({state:t="output-available",tool:e,toolCallId:a,output:r,errorText:o})=>this.jobExecutor.run(async()=>{var e,s;let i=this.state.messages,l=i[i.length-1];this.state.replaceMessage(i.length-1,{...l,parts:l.parts.map(e=>S(e)&&e.toolCallId===a?{...e,state:t,output:r,errorText:o}:e)}),this.activeResponse&&(this.activeResponse.state.message.parts=this.activeResponse.state.message.parts.map(e=>S(e)&&e.toolCallId===a?{...e,state:t,output:r,errorText:o}:e)),"streaming"!==this.status&&"submitted"!==this.status&&(null==(e=this.sendAutomaticallyWhen)?void 0:e.call(this,{messages:this.state.messages}))&&this.makeRequest({trigger:"submit-message",messageId:null==(s=this.lastMessage)?void 0:s.id})}),this.addToolResult=this.addToolOutput,this.stop=async()=>{var t;("streaming"===this.status||"submitted"===this.status)&&(null==(t=this.activeResponse)?void 0:t.abortController)&&this.activeResponse.abortController.abort()},this.id=e,this.transport=a,this.generateId=t,this.messageMetadataSchema=r,this.dataPartSchemas=s,this.state=i,this.onError=l,this.onToolCall=n,this.onFinish=p,this.onData=d,this.sendAutomaticallyWhen=u}get status(){return this.state.status}setStatus({status:t,error:e}){this.status!==t&&(this.state.status=t,this.state.error=e)}get error(){return this.state.error}get messages(){return this.state.messages}get lastMessage(){return this.state.messages[this.state.messages.length-1]}set messages(t){this.state.messages=t}async makeRequest({trigger:t,metadata:e,headers:a,body:r,messageId:s}){var i,l,n,p;this.setStatus({status:"submitted",error:void 0});let d=this.lastMessage,u=!1,c=!1,h=!1;try{let i,l={state:function({lastMessage:t,messageId:e}){return{message:(null==t?void 0:t.role)==="assistant"?t:{id:e,metadata:void 0,role:"assistant",parts:[]},activeTextParts:{},activeReasoningParts:{},partialToolCalls:{}}}({lastMessage:this.state.snapshot(d),messageId:this.generateId()}),abortController:new AbortController};if(l.abortController.signal.addEventListener("abort",()=>{u=!0}),this.activeResponse=l,"resume-stream"===t){let t=await this.transport.reconnectToStream({chatId:this.id,metadata:e,headers:a,body:r});if(null==t)return void this.setStatus({status:"ready"});i=t}else i=await this.transport.sendMessages({chatId:this.id,messages:this.state.messages,abortSignal:l.abortController.signal,metadata:e,headers:a,body:r,trigger:t,messageId:s});let n=t=>this.jobExecutor.run(()=>t({state:l.state,write:()=>{var t;this.setStatus({status:"streaming"}),l.state.message.id===(null==(t=this.lastMessage)?void 0:t.id)?this.state.replaceMessage(this.state.messages.length-1,l.state.message):this.state.pushMessage(l.state.message)}}));await k({stream:function({stream:t,messageMetadataSchema:e,dataPartSchemas:a,runUpdateMessageJob:r,onError:s,onToolCall:i,onData:l}){return t.pipeThrough(new TransformStream({async transform(t,n){await r(async({state:r,write:p})=>{var d,u,c,h;function m(t){let e=r.message.parts.filter(C).find(e=>e.toolCallId===t);if(null==e)throw Error("tool-output-error must be preceded by a tool-input-available");return e}function g(t){let e=r.message.parts.filter(t=>"dynamic-tool"===t.type).find(e=>e.toolCallId===t);if(null==e)throw Error("tool-output-error must be preceded by a tool-input-available");return e}function z(t){var e;let a=r.message.parts.find(e=>C(e)&&e.toolCallId===t.toolCallId);null!=a?(a.state=t.state,a.input=t.input,a.output=t.output,a.errorText=t.errorText,a.rawInput=t.rawInput,a.preliminary=t.preliminary,a.providerExecuted=null!=(e=t.providerExecuted)?e:a.providerExecuted,null!=t.providerMetadata&&"input-available"===a.state&&(a.callProviderMetadata=t.providerMetadata)):r.message.parts.push({type:`tool-${t.toolName}`,toolCallId:t.toolCallId,state:t.state,input:t.input,output:t.output,rawInput:t.rawInput,errorText:t.errorText,providerExecuted:t.providerExecuted,preliminary:t.preliminary,...null!=t.providerMetadata?{callProviderMetadata:t.providerMetadata}:{}})}function v(t){var e,a;let o=r.message.parts.find(e=>"dynamic-tool"===e.type&&e.toolCallId===t.toolCallId);null!=o?(o.state=t.state,o.toolName=t.toolName,o.input=t.input,o.output=t.output,o.errorText=t.errorText,o.rawInput=null!=(e=t.rawInput)?e:o.rawInput,o.preliminary=t.preliminary,o.providerExecuted=null!=(a=t.providerExecuted)?a:o.providerExecuted,null!=t.providerMetadata&&"input-available"===o.state&&(o.callProviderMetadata=t.providerMetadata)):r.message.parts.push({type:"dynamic-tool",toolName:t.toolName,toolCallId:t.toolCallId,state:t.state,input:t.input,output:t.output,errorText:t.errorText,preliminary:t.preliminary,providerExecuted:t.providerExecuted,...null!=t.providerMetadata?{callProviderMetadata:t.providerMetadata}:{}})}async function b(t){if(null!=t){let a=null!=r.message.metadata?function t(e,a){if(void 0===e&&void 0===a)return;if(void 0===e)return a;if(void 0===a)return e;let r={...e};for(let o in a)if(Object.prototype.hasOwnProperty.call(a,o)){let s=a[o];if(void 0===s)continue;let i=o in e?e[o]:void 0,l=null!==s&&"object"==typeof s&&!Array.isArray(s)&&!(s instanceof Date)&&!(s instanceof RegExp),n=null!=i&&"object"==typeof i&&!Array.isArray(i)&&!(i instanceof Date)&&!(i instanceof RegExp);l&&n?r[o]=t(i,s):r[o]=s}return r}(r.message.metadata,t):t;null!=e&&await (0,o.k5)({value:a,schema:e}),r.message.metadata=a}}switch(t.type){case"text-start":{let e={type:"text",text:"",providerMetadata:t.providerMetadata,state:"streaming"};r.activeTextParts[t.id]=e,r.message.parts.push(e),p();break}case"text-delta":{let e=r.activeTextParts[t.id];e.text+=t.delta,e.providerMetadata=null!=(d=t.providerMetadata)?d:e.providerMetadata,p();break}case"text-end":{let e=r.activeTextParts[t.id];e.state="done",e.providerMetadata=null!=(u=t.providerMetadata)?u:e.providerMetadata,delete r.activeTextParts[t.id],p();break}case"reasoning-start":{let e={type:"reasoning",text:"",providerMetadata:t.providerMetadata,state:"streaming"};r.activeReasoningParts[t.id]=e,r.message.parts.push(e),p();break}case"reasoning-delta":{let e=r.activeReasoningParts[t.id];e.text+=t.delta,e.providerMetadata=null!=(c=t.providerMetadata)?c:e.providerMetadata,p();break}case"reasoning-end":{let e=r.activeReasoningParts[t.id];e.providerMetadata=null!=(h=t.providerMetadata)?h:e.providerMetadata,e.state="done",delete r.activeReasoningParts[t.id],p();break}case"file":r.message.parts.push({type:"file",mediaType:t.mediaType,url:t.url}),p();break;case"source-url":r.message.parts.push({type:"source-url",sourceId:t.sourceId,url:t.url,title:t.title,providerMetadata:t.providerMetadata}),p();break;case"source-document":r.message.parts.push({type:"source-document",sourceId:t.sourceId,mediaType:t.mediaType,title:t.title,filename:t.filename,providerMetadata:t.providerMetadata}),p();break;case"tool-input-start":{let e=r.message.parts.filter(C);r.partialToolCalls[t.toolCallId]={text:"",toolName:t.toolName,index:e.length,dynamic:t.dynamic},t.dynamic?v({toolCallId:t.toolCallId,toolName:t.toolName,state:"input-streaming",input:void 0,providerExecuted:t.providerExecuted}):z({toolCallId:t.toolCallId,toolName:t.toolName,state:"input-streaming",input:void 0,providerExecuted:t.providerExecuted}),p();break}case"tool-input-delta":{let e=r.partialToolCalls[t.toolCallId];e.text+=t.inputTextDelta;let{value:a}=await A(e.text);e.dynamic?v({toolCallId:t.toolCallId,toolName:e.toolName,state:"input-streaming",input:a}):z({toolCallId:t.toolCallId,toolName:e.toolName,state:"input-streaming",input:a}),p();break}case"tool-input-available":t.dynamic?v({toolCallId:t.toolCallId,toolName:t.toolName,state:"input-available",input:t.input,providerExecuted:t.providerExecuted,providerMetadata:t.providerMetadata}):z({toolCallId:t.toolCallId,toolName:t.toolName,state:"input-available",input:t.input,providerExecuted:t.providerExecuted,providerMetadata:t.providerMetadata}),p(),i&&!t.providerExecuted&&await i({toolCall:t});break;case"tool-input-error":t.dynamic?v({toolCallId:t.toolCallId,toolName:t.toolName,state:"output-error",input:t.input,errorText:t.errorText,providerExecuted:t.providerExecuted,providerMetadata:t.providerMetadata}):z({toolCallId:t.toolCallId,toolName:t.toolName,state:"output-error",input:void 0,rawInput:t.input,errorText:t.errorText,providerExecuted:t.providerExecuted,providerMetadata:t.providerMetadata}),p();break;case"tool-output-available":if(t.dynamic){let e=g(t.toolCallId);v({toolCallId:t.toolCallId,toolName:e.toolName,state:"output-available",input:e.input,output:t.output,preliminary:t.preliminary})}else{let e=m(t.toolCallId);z({toolCallId:t.toolCallId,toolName:N(e),state:"output-available",input:e.input,output:t.output,providerExecuted:t.providerExecuted,preliminary:t.preliminary})}p();break;case"tool-output-error":if(t.dynamic){let e=g(t.toolCallId);v({toolCallId:t.toolCallId,toolName:e.toolName,state:"output-error",input:e.input,errorText:t.errorText,providerExecuted:t.providerExecuted})}else{let e=m(t.toolCallId);z({toolCallId:t.toolCallId,toolName:N(e),state:"output-error",input:e.input,rawInput:e.rawInput,errorText:t.errorText,providerExecuted:t.providerExecuted})}p();break;case"start-step":r.message.parts.push({type:"step-start"});break;case"finish-step":r.activeTextParts={},r.activeReasoningParts={};break;case"start":null!=t.messageId&&(r.message.id=t.messageId),await b(t.messageMetadata),(null!=t.messageId||null!=t.messageMetadata)&&p();break;case"finish":null!=t.finishReason&&(r.finishReason=t.finishReason),await b(t.messageMetadata),null!=t.messageMetadata&&p();break;case"message-metadata":await b(t.messageMetadata),null!=t.messageMetadata&&p();break;case"error":null==s||s(Error(t.errorText));break;default:if(t.type.startsWith("data-")){if((null==a?void 0:a[t.type])!=null&&await (0,o.k5)({value:t.data,schema:a[t.type]}),t.transient){null==l||l(t);break}let e=null!=t.id?r.message.parts.find(e=>t.type===e.type&&t.id===e.id):void 0;null!=e?e.data=t.data:r.message.parts.push(t),null==l||l(t),p()}}n.enqueue(t)})}}))}({stream:i,onToolCall:this.onToolCall,onData:this.onData,messageMetadataSchema:this.messageMetadataSchema,dataPartSchemas:this.dataPartSchemas,runUpdateMessageJob:n,onError:t=>{throw t}}),onError:t=>{throw t}}),this.setStatus({status:"ready"})}catch(t){if(u||"AbortError"===t.name)return u=!0,this.setStatus({status:"ready"}),null;h=!0,t instanceof TypeError&&(t.message.toLowerCase().includes("fetch")||t.message.toLowerCase().includes("network"))&&(c=!0),this.onError&&t instanceof Error&&this.onError(t),this.setStatus({status:"error",error:t})}finally{try{null==(l=this.onFinish)||l.call(this,{message:this.activeResponse.state.message,messages:this.state.messages,isAbort:u,isDisconnect:c,isError:h,finishReason:null==(i=this.activeResponse)?void 0:i.state.finishReason})}catch(t){console.error(t)}this.activeResponse=void 0}(null==(n=this.sendAutomaticallyWhen)?void 0:n.call(this,{messages:this.state.messages}))&&!h&&await this.makeRequest({trigger:"submit-message",messageId:null==(p=this.lastMessage)?void 0:p.id,metadata:e,headers:a,body:r})}};(0,o.fE)(()=>(0,o.jN)(i.z.array(i.z.object({id:i.z.string(),role:i.z.enum(["system","user","assistant"]),metadata:i.z.unknown().optional(),parts:i.z.array(i.z.union([i.z.object({type:i.z.literal("text"),text:i.z.string(),state:i.z.enum(["streaming","done"]).optional(),providerMetadata:z.optional()}),i.z.object({type:i.z.literal("reasoning"),text:i.z.string(),state:i.z.enum(["streaming","done"]).optional(),providerMetadata:z.optional()}),i.z.object({type:i.z.literal("source-url"),sourceId:i.z.string(),url:i.z.string(),title:i.z.string().optional(),providerMetadata:z.optional()}),i.z.object({type:i.z.literal("source-document"),sourceId:i.z.string(),mediaType:i.z.string(),title:i.z.string(),filename:i.z.string().optional(),providerMetadata:z.optional()}),i.z.object({type:i.z.literal("file"),mediaType:i.z.string(),filename:i.z.string().optional(),url:i.z.string(),providerMetadata:z.optional()}),i.z.object({type:i.z.literal("step-start")}),i.z.object({type:i.z.string().startsWith("data-"),id:i.z.string().optional(),data:i.z.unknown()}),i.z.object({type:i.z.literal("dynamic-tool"),toolName:i.z.string(),toolCallId:i.z.string(),state:i.z.literal("input-streaming"),input:i.z.unknown().optional(),providerExecuted:i.z.boolean().optional(),output:i.z.never().optional(),errorText:i.z.never().optional()}),i.z.object({type:i.z.literal("dynamic-tool"),toolName:i.z.string(),toolCallId:i.z.string(),state:i.z.literal("input-available"),input:i.z.unknown(),providerExecuted:i.z.boolean().optional(),output:i.z.never().optional(),errorText:i.z.never().optional(),callProviderMetadata:z.optional()}),i.z.object({type:i.z.literal("dynamic-tool"),toolName:i.z.string(),toolCallId:i.z.string(),state:i.z.literal("output-available"),input:i.z.unknown(),providerExecuted:i.z.boolean().optional(),output:i.z.unknown(),errorText:i.z.never().optional(),callProviderMetadata:z.optional(),preliminary:i.z.boolean().optional()}),i.z.object({type:i.z.literal("dynamic-tool"),toolName:i.z.string(),toolCallId:i.z.string(),state:i.z.literal("output-error"),input:i.z.unknown(),providerExecuted:i.z.boolean().optional(),output:i.z.never().optional(),errorText:i.z.string(),callProviderMetadata:z.optional()}),i.z.object({type:i.z.string().startsWith("tool-"),toolCallId:i.z.string(),state:i.z.literal("input-streaming"),providerExecuted:i.z.boolean().optional(),input:i.z.unknown().optional(),output:i.z.never().optional(),errorText:i.z.never().optional(),approval:i.z.never().optional()}),i.z.object({type:i.z.string().startsWith("tool-"),toolCallId:i.z.string(),state:i.z.literal("input-available"),providerExecuted:i.z.boolean().optional(),input:i.z.unknown(),output:i.z.never().optional(),errorText:i.z.never().optional(),callProviderMetadata:z.optional(),approval:i.z.never().optional()}),i.z.object({type:i.z.string().startsWith("tool-"),toolCallId:i.z.string(),state:i.z.literal("approval-requested"),input:i.z.unknown(),providerExecuted:i.z.boolean().optional(),output:i.z.never().optional(),errorText:i.z.never().optional(),callProviderMetadata:z.optional(),approval:i.z.object({id:i.z.string(),approved:i.z.never().optional(),reason:i.z.never().optional()})}),i.z.object({type:i.z.string().startsWith("tool-"),toolCallId:i.z.string(),state:i.z.literal("approval-responded"),input:i.z.unknown(),providerExecuted:i.z.boolean().optional(),output:i.z.never().optional(),errorText:i.z.never().optional(),callProviderMetadata:z.optional(),approval:i.z.object({id:i.z.string(),approved:i.z.boolean(),reason:i.z.string().optional()})}),i.z.object({type:i.z.string().startsWith("tool-"),toolCallId:i.z.string(),state:i.z.literal("output-available"),providerExecuted:i.z.boolean().optional(),input:i.z.unknown(),output:i.z.unknown(),errorText:i.z.never().optional(),callProviderMetadata:z.optional(),preliminary:i.z.boolean().optional(),approval:i.z.object({id:i.z.string(),approved:i.z.literal(!0),reason:i.z.string().optional()}).optional()}),i.z.object({type:i.z.string().startsWith("tool-"),toolCallId:i.z.string(),state:i.z.literal("output-error"),providerExecuted:i.z.boolean().optional(),input:i.z.unknown(),output:i.z.never().optional(),errorText:i.z.string(),callProviderMetadata:z.optional(),approval:i.z.object({id:i.z.string(),approved:i.z.literal(!0),reason:i.z.string().optional()}).optional()}),i.z.object({type:i.z.string().startsWith("tool-"),toolCallId:i.z.string(),state:i.z.literal("output-denied"),providerExecuted:i.z.boolean().optional(),input:i.z.unknown(),output:i.z.never().optional(),errorText:i.z.never().optional(),callProviderMetadata:z.optional(),approval:i.z.object({id:i.z.string(),approved:i.z.literal(!1),reason:i.z.string().optional()})})])).nonempty("Message must contain at least one part")})).nonempty("Messages array must not be empty")))}}]);