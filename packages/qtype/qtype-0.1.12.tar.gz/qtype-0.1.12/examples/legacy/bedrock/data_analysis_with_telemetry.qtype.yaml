id: data_analysis_pipeline
description: A multi-step data analysis pipeline with AWS Bedrock and telemetry tracking

models:
  - type: Model
    id: nova_lite
    provider: aws-bedrock
    model_id: amazon.nova-lite-v1:0
    inference_params:
      temperature: 0.7
      max_tokens: 1024

flows:
  - type: Flow
    id: analyze_data_flow
    description: Load sales data, analyze it with LLM, generate insights
    variables:
      - id: raw_data
        type: text
      - id: analysis_prompt
        type: text
      - id: analysis_result
        type: text
      - id: insights_prompt
        type: text
      - id: key_insights
        type: text
      - id: summary_prompt
        type: text
      - id: executive_summary
        type: text
      - id: final_report
        type: text
      - id: output_file
        type: text
    inputs:
      - output_file
    outputs:
      - executive_summary
      - final_report
    steps:
      # Step 1: Load sales data from file
      - id: load_sales_data
        type: PromptTemplate
        template: !include_raw sample_data.txt
        outputs:
          - raw_data
          
      # Step 2: Create analysis prompt
      - id: create_analysis_prompt
        type: PromptTemplate
        template: |
          You are a data analyst. Analyze the following sales data and provide:
          1. A summary of what the data contains
          2. Key patterns or trends you observe
          3. Any notable observations or anomalies
          
          Sales Data:
          {raw_data}
          
          Provide your analysis in a clear, structured format.
        inputs:
          - raw_data
        outputs:
          - analysis_prompt
          
      # Step 3: Generate initial analysis
      - id: analyze_with_llm
        type: LLMInference
        model: nova_lite
        system_message: You are an expert data analyst with strong analytical and critical thinking skills.
        inputs:
          - analysis_prompt
        outputs:
          - analysis_result
          
      # Step 4: Create insights extraction prompt
      - id: create_insights_prompt
        type: PromptTemplate
        template: |
          Based on this analysis, extract the 3-5 most important insights or takeaways:
          
          {analysis_result}
          
          Format as a bullet list with clear, actionable insights.
        inputs:
          - analysis_result
        outputs:
          - insights_prompt
          
      # Step 5: Extract key insights
      - id: extract_insights
        type: LLMInference
        model: nova_lite
        system_message: You are an expert at distilling complex analysis into clear, actionable insights.
        inputs:
          - insights_prompt
        outputs:
          - key_insights
          
      # Step 6: Create executive summary prompt
      - id: create_summary_prompt
        type: PromptTemplate
        template: |
          Create a concise executive summary (2-3 paragraphs) that combines:
          
          Original Analysis:
          {analysis_result}
          
          Key Insights:
          {key_insights}
          
          Make it suitable for C-level executives - clear, impactful, and action-oriented.
        inputs:
          - analysis_result
          - key_insights
        outputs:
          - summary_prompt
          
      # Step 7: Generate executive summary
      - id: generate_summary
        type: LLMInference
        model: nova_lite
        system_message: You are an expert at writing executive summaries for business leaders.
        inputs:
          - summary_prompt
        outputs:
          - executive_summary
          
      # Step 8: Create final report
      - id: create_final_report
        type: PromptTemplate
        template: |
          ================================================================================
          DATA ANALYSIS REPORT
          ================================================================================
          
          EXECUTIVE SUMMARY
          -----------------
          {executive_summary}
          
          KEY INSIGHTS
          ------------
          {key_insights}
          
          DETAILED ANALYSIS
          -----------------
          {analysis_result}
          
          ================================================================================
          Report generated by QType Data Analysis Pipeline
          ================================================================================
        inputs:
          - executive_summary
          - key_insights
          - analysis_result
        outputs:
          - final_report
          
      # Step 9: Write results to file
      - id: save_report
        type: FileWriter
        path: output_file
        inputs:
          - final_report

telemetry:
  id: data_analysis_telemetry
  endpoint: http://localhost:6006/v1/traces
