Metadata-Version: 2.4
Name: chewy-attachment
Version: 0.4.2
Summary: é€šç”¨å›¾ç‰‡/é™„ä»¶ç®¡ç†æ’ä»¶ï¼Œæ”¯æŒ Django å’Œ FastAPI
Project-URL: Homepage, https://github.com/cone387/ChewyAttachment
Project-URL: Repository, https://github.com/cone387/ChewyAttachment
Project-URL: Issues, https://github.com/cone387/ChewyAttachment/issues
Project-URL: Documentation, https://github.com/cone387/ChewyAttachment#readme
Author-email: cone387 <cone387@gmail.com>
Maintainer-email: cone387 <cone387@gmail.com>
License: MIT
License-File: LICENSE
Keywords: attachment,django,fastapi,file-management,file-upload,image-upload
Classifier: Development Status :: 4 - Beta
Classifier: Framework :: Django
Classifier: Framework :: Django :: 4.0
Classifier: Framework :: Django :: 5.0
Classifier: Framework :: FastAPI
Classifier: Intended Audience :: Developers
Classifier: License :: OSI Approved :: MIT License
Classifier: Programming Language :: Python :: 3
Classifier: Programming Language :: Python :: 3.9
Classifier: Programming Language :: Python :: 3.10
Classifier: Programming Language :: Python :: 3.11
Classifier: Programming Language :: Python :: 3.12
Classifier: Programming Language :: Python :: 3.13
Classifier: Topic :: Internet :: WWW/HTTP
Classifier: Topic :: Software Development :: Libraries :: Python Modules
Requires-Python: >=3.9
Requires-Dist: python-magic>=0.4.27
Provides-Extra: dev
Requires-Dist: django>=4.2.0; extra == 'dev'
Requires-Dist: djangorestframework>=3.14.0; extra == 'dev'
Requires-Dist: fastapi>=0.109.0; extra == 'dev'
Requires-Dist: httpx>=0.26.0; extra == 'dev'
Requires-Dist: pytest-asyncio>=0.23.0; extra == 'dev'
Requires-Dist: pytest-cov>=4.1.0; extra == 'dev'
Requires-Dist: pytest-django>=4.7.0; extra == 'dev'
Requires-Dist: pytest>=8.0.0; extra == 'dev'
Requires-Dist: python-multipart>=0.0.6; extra == 'dev'
Requires-Dist: ruff>=0.1.0; extra == 'dev'
Requires-Dist: sqlmodel>=0.0.14; extra == 'dev'
Requires-Dist: uvicorn>=0.27.0; extra == 'dev'
Provides-Extra: django
Requires-Dist: django>=4.2.0; extra == 'django'
Requires-Dist: djangorestframework>=3.14.0; extra == 'django'
Provides-Extra: fastapi
Requires-Dist: fastapi>=0.109.0; extra == 'fastapi'
Requires-Dist: python-multipart>=0.0.6; extra == 'fastapi'
Requires-Dist: sqlmodel>=0.0.14; extra == 'fastapi'
Requires-Dist: uvicorn>=0.27.0; extra == 'fastapi'
Provides-Extra: test
Requires-Dist: httpx>=0.26.0; extra == 'test'
Requires-Dist: pytest-asyncio>=0.23.0; extra == 'test'
Requires-Dist: pytest-cov>=4.1.0; extra == 'test'
Requires-Dist: pytest>=8.0.0; extra == 'test'
Provides-Extra: test-django
Requires-Dist: django>=4.2.0; extra == 'test-django'
Requires-Dist: djangorestframework>=3.14.0; extra == 'test-django'
Requires-Dist: httpx>=0.26.0; extra == 'test-django'
Requires-Dist: pytest-asyncio>=0.23.0; extra == 'test-django'
Requires-Dist: pytest-cov>=4.1.0; extra == 'test-django'
Requires-Dist: pytest-django>=4.7.0; extra == 'test-django'
Requires-Dist: pytest>=8.0.0; extra == 'test-django'
Provides-Extra: test-fastapi
Requires-Dist: fastapi>=0.109.0; extra == 'test-fastapi'
Requires-Dist: httpx>=0.26.0; extra == 'test-fastapi'
Requires-Dist: pytest-asyncio>=0.23.0; extra == 'test-fastapi'
Requires-Dist: pytest-cov>=4.1.0; extra == 'test-fastapi'
Requires-Dist: pytest>=8.0.0; extra == 'test-fastapi'
Requires-Dist: python-multipart>=0.0.6; extra == 'test-fastapi'
Requires-Dist: sqlmodel>=0.0.14; extra == 'test-fastapi'
Requires-Dist: uvicorn>=0.27.0; extra == 'test-fastapi'
Description-Content-Type: text/markdown

# ChewyAttachment

[![PyPI version](https://badge.fury.io/py/chewy-attachment.svg)](https://badge.fury.io/py/chewy-attachment)
[![Python Versions](https://img.shields.io/pypi/pyversions/chewy-attachment.svg)](https://pypi.org/project/chewy-attachment/)
[![License](https://img.shields.io/pypi/l/chewy-attachment.svg)](https://github.com/cone387/ChewyAttachment/blob/master/LICENSE)
[![Downloads](https://pepy.tech/badge/chewy-attachment)](https://pepy.tech/project/chewy-attachment)

ğŸš€ é€šç”¨æ–‡ä»¶/é™„ä»¶ç®¡ç†æœåŠ¡ - æ”¯æŒ Django & FastAPI åŒæ¡†æ¶

## ğŸ“– ç®€ä»‹

ChewyAttachment æ˜¯ä¸€ä¸ªé€šç”¨çš„æ–‡ä»¶/é™„ä»¶ç®¡ç†æ’ä»¶ï¼Œæä¾›å¼€ç®±å³ç”¨çš„æ–‡ä»¶ä¸Šä¼ ã€ä¸‹è½½ã€åˆ é™¤åŠŸèƒ½ã€‚æ”¯æŒä½œä¸ºç‹¬ç«‹çš„ Django åº”ç”¨æˆ– FastAPI å¯æ’æ‹”æ¨¡å—è¿è¡Œï¼Œé€‚åˆä¸ªäººè‡ªæ‰˜ç®¡åœºæ™¯ï¼Œå¯è¢«å¤šä¸ªä¸šåŠ¡ç³»ç»Ÿå¤ç”¨ã€‚

## âœ¨ æ ¸å¿ƒç‰¹æ€§

- ğŸ”„ **åŒæ¡†æ¶æ”¯æŒ**: åŒæ—¶æ”¯æŒ Django å’Œ FastAPI
- ğŸ—„ï¸ **æ•°æ®åº“çµæ´»**: Django è‡ªåŠ¨ä½¿ç”¨é¡¹ç›®é»˜è®¤æ•°æ®åº“ï¼ŒFastAPI æ”¯æŒä»»æ„ SQLAlchemy å…¼å®¹æ•°æ®åº“
- ğŸ“ **å­˜å‚¨çµæ´»**: é»˜è®¤å­˜å‚¨åœ¨ media/attachments ç›®å½•ï¼Œå¯è‡ªå®šä¹‰è·¯å¾„
- ğŸ“ **å®Œæ•´åŠŸèƒ½**: æ–‡ä»¶ä¸Šä¼ ã€ä¸‹è½½ã€åˆ é™¤ã€åˆ—è¡¨æŸ¥è¯¢
- ğŸ” **ç®€åŒ–æƒé™**: åŸºäº owner_id çš„æƒé™æ¨¡å‹ï¼Œæ”¯æŒ public/private è®¿é—®çº§åˆ«
- ğŸ¯ **è®¤è¯è§£è€¦**: é€šè¿‡å¤–éƒ¨æ³¨å…¥ user_id å®ç°è®¤è¯è§£è€¦
- ğŸ“ **Markdown å‹å¥½**: è¿”å› Markdown æ ¼å¼çš„æ–‡ä»¶å¼•ç”¨é“¾æ¥
- ğŸ—„ï¸ **è½»é‡å­˜å‚¨**: æ•°æ®åº“ä»…å­˜å…ƒä¿¡æ¯ï¼Œæ–‡ä»¶å­˜å‚¨äºæœ¬åœ°æ–‡ä»¶ç³»ç»Ÿ
- ğŸ”Œ **å³æ’å³ç”¨**: ç‹¬ç«‹äºå…·ä½“ä¸šåŠ¡è¡¨çš„é€šç”¨æ•°æ®æ¨¡å‹
- ğŸ¨ **RESTful API**: æ ‡å‡†åŒ–çš„ API è®¾è®¡

## ğŸ“¦ å®‰è£…

```bash
# ä½¿ç”¨ pip å®‰è£…
pip install chewy-attachment

# å®‰è£… Django æ”¯æŒ
pip install chewy-attachment[django]

# å®‰è£… FastAPI æ”¯æŒ
pip install chewy-attachment[fastapi]

# å®‰è£…å…¨éƒ¨åŠŸèƒ½(å¼€å‘)
pip install chewy-attachment[dev]

# æˆ–ä»æºç å®‰è£…
git clone https://github.com/cone387/ChewyAttachment.git
cd ChewyAttachment
pip install -e .
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### Django é›†æˆ

1. **æ·»åŠ åˆ° INSTALLED_APPS**

```python
# settings.py
INSTALLED_APPS = [
    # ...
    'chewy_attachment.django_app',
]

# ChewyAttachment é…ç½®ï¼ˆå¯é€‰ï¼‰
# å¦‚æœä¸é…ç½®ï¼Œå°†ä½¿ç”¨é»˜è®¤å€¼
CHEWY_ATTACHMENT = {
    "STORAGE_ROOT": BASE_DIR / "media" / "attachments",  # é»˜è®¤å€¼
}
```

> **è¯´æ˜**ï¼š
> - **æ•°æ®åº“**ï¼šè‡ªåŠ¨ä½¿ç”¨ Django é¡¹ç›®çš„é»˜è®¤æ•°æ®åº“é…ç½®ï¼ˆ`DATABASES['default']`ï¼‰ï¼Œæ— éœ€å•ç‹¬é…ç½®
> - **å­˜å‚¨è·¯å¾„**ï¼šé»˜è®¤ä¸º `BASE_DIR / "media" / "attachments"`ï¼Œæ–‡ä»¶å­˜å‚¨åœ¨é¡¹ç›®ç›®å½•çš„ media/attachments æ–‡ä»¶å¤¹ä¸­

2. **é…ç½® URL**

```python
# urls.py
from django.urls import path, include

urlpatterns = [
    # ...
    path('api/attachments/', include('chewy_attachment.django_app.urls')),
]
```

3. **è¿è¡Œè¿ç§»**

```bash
python manage.py migrate
```

### FastAPI é›†æˆ

```python
from pathlib import Path
from fastapi import FastAPI, Request
from chewy_attachment.fastapi_app import dependencies, router

app = FastAPI()

# é…ç½®æ•°æ®åº“å’Œå­˜å‚¨ï¼ˆä½¿ç”¨é¡¹ç›®è‡ªå·±çš„æ•°æ®åº“é…ç½®ï¼‰
BASE_DIR = Path(__file__).resolve().parent
DATABASE_URL = "sqlite:///./your_app.db"  # æˆ–ä½¿ç”¨ PostgreSQL/MySQL ç­‰
STORAGE_ROOT = BASE_DIR / "media" / "attachments"  # é»˜è®¤å­˜å‚¨è·¯å¾„

# åˆå§‹åŒ– ChewyAttachment
dependencies.configure(DATABASE_URL, STORAGE_ROOT)

# æŒ‚è½½è·¯ç”±
app.include_router(router, prefix="/api/attachments")

# æ·»åŠ ç”¨æˆ·è®¤è¯ä¸­é—´ä»¶ï¼ˆç¤ºä¾‹ï¼‰
@app.middleware("http")
async def add_user_context(request: Request, call_next):
    # ä»ä½ çš„è®¤è¯ç³»ç»Ÿè·å–ç”¨æˆ· ID
    request.state.user_id = "your-user-id"  # æ›¿æ¢ä¸ºå®é™…çš„ç”¨æˆ·è®¤è¯é€»è¾‘
    response = await call_next(request)
    return response
```

> **è¯´æ˜**ï¼š
> - **æ•°æ®åº“**ï¼šé€šè¿‡ `configure()` æ–¹æ³•ä¼ å…¥æ•°æ®åº“è¿æ¥ï¼Œæ”¯æŒä»»æ„ SQLAlchemy å…¼å®¹çš„æ•°æ®åº“
> - **å­˜å‚¨è·¯å¾„**ï¼šé»˜è®¤ä¸º `BASE_DIR / "media" / "attachments"`ï¼Œæ–‡ä»¶å­˜å‚¨åœ¨é¡¹ç›®ç›®å½•çš„ media/attachments æ–‡ä»¶å¤¹ä¸­
> - **ç”¨æˆ·è®¤è¯**ï¼šé€šè¿‡ä¸­é—´ä»¶è®¾ç½® `request.state.user_id` å®ç°è®¤è¯è§£è€¦

## ğŸ“š API æ–‡æ¡£

### Django API

#### ä¸Šä¼ æ–‡ä»¶

```bash
POST /api/attachments/files/
Content-Type: multipart/form-data

å‚æ•°:
- file: æ–‡ä»¶å¯¹è±¡ (å¿…é¡»)
- is_public: boolean (å¯é€‰, é»˜è®¤: false)
- owner_id: string (å¯é€‰, ç”±è®¤è¯ç³»ç»Ÿè‡ªåŠ¨å¡«å……)
```

**è¿”å›ç¤ºä¾‹:**
```json
{
  "id": "550e8400-e29b-41d4-a716-446655440000",
  "original_name": "example.jpg",
  "mime_type": "image/jpeg",
  "size": 102400,
  "owner_id": "123",
  "is_public": false,
  "created_at": "2026-01-14 10:30:00",
  "preview_url": "/api/attachments/files/550e8400-e29b-41d4-a716-446655440000/preview/"
}
```

> **æ³¨æ„**: `preview_url` è¿”å›ç›¸å¯¹è·¯å¾„ï¼Œæ ¹æ®å®é™…è·¯ç”±é…ç½®åŠ¨æ€ç”Ÿæˆã€‚

#### è·å–æ–‡ä»¶åˆ—è¡¨

```bash
GET /api/attachments/files/

æŸ¥è¯¢å‚æ•°:
- page: é¡µç  (é»˜è®¤: 1)
- page_size: æ¯é¡µæ•°é‡ (é»˜è®¤: 20, æœ€å¤§: 100)
```

**è¿”å›ç¤ºä¾‹:**
```json
{
  "count": 100,
  "next": "http://localhost:8000/api/attachments/files/?page=2",
  "previous": null,
  "results": [
    {
      "id": "550e8400-e29b-41d4-a716-446655440000",
      "original_name": "example.jpg",
      "mime_type": "image/jpeg",
      "size": 102400,
      "owner_id": "123",
      "is_public": true,
      "created_at": "2026-01-14 10:30:00",
      "preview_url": "/api/attachments/files/550e8400-e29b-41d4-a716-446655440000/preview/"
    }
  ]
}
```

#### è·å–æ–‡ä»¶è¯¦æƒ…

```bash
GET /api/attachments/files/{attachment_id}/
```

**è¿”å›ç¤ºä¾‹:**
```json
{
  "id": "550e8400-e29b-41d4-a716-446655440000",
  "original_name": "example.jpg",
  "mime_type": "image/jpeg",
  "size": 102400,
  "owner_id": "123",
  "is_public": true,
  "created_at": "2026-01-14 10:30:00",
  "preview_url": "/api/attachments/files/550e8400-e29b-41d4-a716-446655440000/preview/"
}
```

#### é¢„è§ˆæ–‡ä»¶

```bash
GET /api/attachments/files/{attachment_id}/preview/
```

åœ¨æµè§ˆå™¨ä¸­ç›´æ¥é¢„è§ˆæ–‡ä»¶ï¼ˆinline æ¨¡å¼ï¼‰ï¼Œå›¾ç‰‡ä¼šç›´æ¥æ˜¾ç¤ºã€‚

#### ä¸‹è½½æ–‡ä»¶

```bash
GET /api/attachments/files/{attachment_id}/content/
```

å¼ºåˆ¶ä¸‹è½½æ–‡ä»¶ï¼ˆattachment æ¨¡å¼ï¼‰ã€‚

#### åˆ é™¤æ–‡ä»¶

```bash
DELETE /api/attachments/files/{attachment_id}/
```

### FastAPI API

#### ä¸Šä¼ æ–‡ä»¶

```bash
POST /api/attachments/files/
Content-Type: multipart/form-data

å‚æ•°:
- file: æ–‡ä»¶å¯¹è±¡ (å¿…é¡»)
- is_public: boolean (å¯é€‰, é»˜è®¤: false)
```

#### è·å–æ–‡ä»¶åˆ—è¡¨

```bash
GET /api/attachments/files/

æŸ¥è¯¢å‚æ•°:
- page: é¡µç  (é»˜è®¤: 1)
- page_size: æ¯é¡µæ•°é‡ (é»˜è®¤: 20, æœ€å¤§: 100)
```

**è¿”å›ç¤ºä¾‹:**
```json
{
  "total": 100,
  "page": 1,
  "page_size": 20,
  "items": [
    {
      "id": "550e8400-e29b-41d4-a716-446655440000",
      "original_name": "example.jpg",
      "mime_type": "image/jpeg",
      "size": 102400,
      "owner_id": "123",
      "is_public": true,
      "created_at": "2026-01-14T10:30:00",
      "preview_url": "/api/attachments/files/550e8400-e29b-41d4-a716-446655440000/preview"
    }
  ]
}
```

#### è·å–æ–‡ä»¶è¯¦æƒ…

```bash
GET /api/attachments/files/{attachment_id}
```

#### é¢„è§ˆæ–‡ä»¶

```bash
GET /api/attachments/files/{attachment_id}/preview
```

#### ä¸‹è½½æ–‡ä»¶

```bash
GET /api/attachments/files/{attachment_id}/content
```

#### åˆ é™¤æ–‡ä»¶

```bash
DELETE /api/attachments/files/{attachment_id}
```

## ğŸ” æƒé™æ¨¡å‹

- **Public æ–‡ä»¶**: æ‰€æœ‰äººå¯è¯»ï¼Œä»…æ‰€æœ‰è€…å¯åˆ é™¤
- **Private æ–‡ä»¶**: ä»…æ‰€æœ‰è€…å¯è¯»å¯åˆ é™¤
- **Owner ID**: é€šè¿‡å¤–éƒ¨è®¤è¯ç³»ç»Ÿæ³¨å…¥ï¼Œå®ç°è®¤è¯è§£è€¦

## ğŸ“ æ•°æ®æ¨¡å‹

```python
class Attachment:
    id: str                # UUID ä¸»é”®
    original_name: str     # åŸå§‹æ–‡ä»¶å
    storage_path: str      # ç‰©ç†å­˜å‚¨è·¯å¾„
    mime_type: str         # MIME ç±»å‹
    size: int              # æ–‡ä»¶å¤§å°(å­—èŠ‚)
    owner_id: str          # æ‰€æœ‰è€… ID
    is_public: bool        # è®¿é—®çº§åˆ«
    created_at: datetime   # åˆ›å»ºæ—¶é—´
```

> **æ•°æ®åº“è¡¨å**: é»˜è®¤ä¸º `chewy_attachments`ï¼Œå¯é€šè¿‡è‡ªå®šä¹‰æ¨¡å‹ä¿®æ”¹

## ğŸ› ï¸ é…ç½®é€‰é¡¹

### Django é…ç½®

```python
# settings.py

# ChewyAttachment é…ç½®
CHEWY_ATTACHMENT = {
    # å­˜å‚¨æ ¹ç›®å½• (å¯é€‰, é»˜è®¤: BASE_DIR / "media" / "attachments")
    "STORAGE_ROOT": BASE_DIR / "media" / "attachments",
    
    # æ—¶é—´æ ¼å¼ (å¯é€‰, é»˜è®¤: "%Y-%m-%d %H:%M:%S")
    # "DATETIME_FORMAT": "%Y-%m-%d %H:%M:%S",
    
    # è‡ªå®šä¹‰æƒé™ç±» (å¯é€‰)
    # "PERMISSION_CLASSES": [
    #     "chewy_attachment.django_app.permissions.IsAuthenticatedForUpload",
    #     "chewy_attachment.django_app.permissions.IsOwnerOrPublicReadOnly",
    # ],
}

# è‡ªå®šä¹‰æ¨¡å‹ (å¯é€‰, ç±»ä¼¼ AUTH_USER_MODEL)
# CHEWY_ATTACHMENT_MODEL = 'myapp.MyAttachment'
```

**é…ç½®è¯´æ˜ï¼š**

- `STORAGE_ROOT`: æ–‡ä»¶å­˜å‚¨çš„ç‰©ç†è·¯å¾„ï¼ˆå¯é€‰ï¼Œé»˜è®¤ä¸º `BASE_DIR / "media" / "attachments"`ï¼‰
- `DATETIME_FORMAT`: API è¿”å›çš„æ—¶é—´å­—æ®µæ ¼å¼
- `PERMISSION_CLASSES`: è‡ªå®šä¹‰ DRF æƒé™ç±»åˆ—è¡¨
- `CHEWY_ATTACHMENT_MODEL`: è‡ªå®šä¹‰é™„ä»¶æ¨¡å‹ï¼ˆç±»ä¼¼ Django çš„ `AUTH_USER_MODEL`ï¼‰

#### è‡ªå®šä¹‰è¡¨åå’Œæ¨¡å‹

ChewyAttachment æ”¯æŒæ¨¡å‹äº¤æ¢æœºåˆ¶ï¼Œç±»ä¼¼äº Django çš„ `AUTH_USER_MODEL`ï¼š

```python
# myapp/models.py
from chewy_attachment.django_app.models import AttachmentBase

class MyAttachment(AttachmentBase):
    """è‡ªå®šä¹‰é™„ä»¶æ¨¡å‹"""
    
    # å¯ä»¥æ·»åŠ é¢å¤–å­—æ®µ
    category = models.CharField(max_length=50, blank=True, verbose_name="åˆ†ç±»")
    
    class Meta(AttachmentBase.Meta):
        db_table = "my_custom_attachments"  # è‡ªå®šä¹‰è¡¨å
        abstract = False
        app_label = 'myapp'

# settings.py
CHEWY_ATTACHMENT_MODEL = 'myapp.MyAttachment'
```

**ä½¿ç”¨æ­¥éª¤ï¼š**

1. åˆ›å»ºè‡ªå®šä¹‰æ¨¡å‹ï¼ˆç»§æ‰¿ `AttachmentBase`ï¼‰
2. åœ¨ settings.py ä¸­è®¾ç½® `CHEWY_ATTACHMENT_MODEL`
3. è¿è¡Œ `python manage.py makemigrations myapp`
4. è¿è¡Œ `python manage.py migrate`

**ä¼˜åŠ¿ï¼š**

- âœ… **æ ‡å‡†Djangoæœºåˆ¶**ï¼šä½¿ç”¨Djangoå®˜æ–¹æ¨èçš„æ¨¡å‹äº¤æ¢æ–¹å¼
- âœ… **é¿å…å†²çª**ï¼šæ¯ä¸ªé¡¹ç›®ä½¿ç”¨è‡ªå·±çš„æ¨¡å‹ï¼Œä¸ä¼šæœ‰å¤šé¡¹ç›®å†²çª
- âœ… **è‡ªåŠ¨é€‚é…**ï¼šåº“çš„è§†å›¾å’Œåºåˆ—åŒ–å™¨è‡ªåŠ¨ä½¿ç”¨æŒ‡å®šæ¨¡å‹
- âœ… **çµæ´»æ‰©å±•**ï¼šå¯ä»¥æ·»åŠ ä»»æ„è‡ªå®šä¹‰å­—æ®µå’Œæ–¹æ³•

#### è‡ªå®šä¹‰æƒé™ç±»ç¤ºä¾‹

```python
# myapp/permissions.py
from rest_framework import permissions
from chewy_attachment.django_app.models import Attachment
from chewy_attachment.core.permissions import PermissionChecker

class CustomAttachmentPermission(permissions.BasePermission):
    """
    è‡ªå®šä¹‰é™„ä»¶æƒé™ç±»
    
    ç¤ºä¾‹: ç®¡ç†å‘˜å¯ä»¥è®¿é—®æ‰€æœ‰æ–‡ä»¶,æ™®é€šç”¨æˆ·åªèƒ½è®¿é—®è‡ªå·±çš„æ–‡ä»¶
    """
    
    def has_object_permission(self, request, view, obj: Attachment):
        # ç®¡ç†å‘˜æ‹¥æœ‰æ‰€æœ‰æƒé™
        if request.user and request.user.is_staff:
            return True
        
        # ä½¿ç”¨æ ¸å¿ƒæƒé™æ£€æŸ¥å™¨
        user_context = Attachment.get_user_context(request)
        file_metadata = obj.to_file_metadata()
        
        if request.method in permissions.SAFE_METHODS:
            return PermissionChecker.can_view(file_metadata, user_context)
        
        if request.method == "DELETE":
            return PermissionChecker.can_delete(file_metadata, user_context)
        
        return False

# settings.py
CHEWY_ATTACHMENT = {
    "STORAGE_ROOT": BASE_DIR / "media" / "attachments",
    "PERMISSION_CLASSES": [
        "chewy_attachment.django_app.permissions.IsAuthenticatedForUpload",
        "myapp.permissions.CustomAttachmentPermission",
    ],
}
```

### FastAPI é…ç½®

```python
from chewy_attachment.core.storage import FileStorage

# è‡ªå®šä¹‰å­˜å‚¨è·¯å¾„
storage = FileStorage(base_path="/custom/path/media")
```

## ğŸ“‚ é¡¹ç›®ç»“æ„

```
ChewyAttachment/
â”œâ”€â”€ chewy_attachment/
â”‚   â”œâ”€â”€ core/                 # æ ¸å¿ƒåŠŸèƒ½æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ schemas.py        # æ•°æ®æ¨¡å¼
â”‚   â”‚   â”œâ”€â”€ storage.py        # æ–‡ä»¶å­˜å‚¨
â”‚   â”‚   â”œâ”€â”€ permissions.py    # æƒé™æ§åˆ¶
â”‚   â”‚   â””â”€â”€ utils.py          # å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ django_app/           # Django åº”ç”¨
â”‚   â”‚   â”œâ”€â”€ models.py         # Django æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ views.py          # Django è§†å›¾
â”‚   â”‚   â”œâ”€â”€ serializers.py    # DRF åºåˆ—åŒ–å™¨
â”‚   â”‚   â””â”€â”€ urls.py           # URL é…ç½®
â”‚   â””â”€â”€ fastapi_app/          # FastAPI åº”ç”¨
â”‚       â”œâ”€â”€ models.py         # SQLAlchemy æ¨¡å‹
â”‚       â”œâ”€â”€ router.py         # API è·¯ç”±
â”‚       â”œâ”€â”€ crud.py           # CRUD æ“ä½œ
â”‚       â””â”€â”€ dependencies.py   # ä¾èµ–æ³¨å…¥
â”œâ”€â”€ examples/                 # ç¤ºä¾‹é¡¹ç›®
â”‚   â”œâ”€â”€ django_example/       # Django ç¤ºä¾‹
â”‚   â””â”€â”€ fastapi_example/      # FastAPI ç¤ºä¾‹
â””â”€â”€ pyproject.toml            # é¡¹ç›®é…ç½®
```

## ğŸ§ª è¿è¡Œæµ‹è¯•

```bash
# å®‰è£…æµ‹è¯•ä¾èµ–
pip install pytest pytest-django pytest-asyncio

# è¿è¡Œ Django æµ‹è¯•
pytest chewy_attachment/django_app/tests/

# è¿è¡Œ FastAPI æµ‹è¯•
pytest chewy_attachment/fastapi_app/tests/
```

## ğŸ“ ç¤ºä¾‹ä»£ç 

æŸ¥çœ‹ `examples/` ç›®å½•è·å–å®Œæ•´çš„ç¤ºä¾‹é¡¹ç›®ï¼š

- [Django ç¤ºä¾‹](examples/django_example/)
- [FastAPI ç¤ºä¾‹](examples/fastapi_example/)

### è¿è¡Œ Django ç¤ºä¾‹

```bash
# å…‹éš†é¡¹ç›®ï¼ˆå¦‚æœè¿˜æ²¡æœ‰ï¼‰
git clone https://github.com/cone387/ChewyAttachment.git
cd ChewyAttachment

# ä½¿ç”¨ uv å®‰è£…ä¾èµ–ï¼ˆä¼šè‡ªåŠ¨åˆ›å»º .venv è™šæ‹Ÿç¯å¢ƒï¼‰
uv sync

# è¿›å…¥ Django ç¤ºä¾‹ç›®å½•
cd examples/django_example

# è¿è¡Œè¿ç§»
uv run python manage.py migrate

# åˆ›å»ºè¶…çº§ç”¨æˆ·ï¼ˆå¯é€‰ï¼‰
uv run python manage.py createsuperuser

# å¯åŠ¨å¼€å‘æœåŠ¡å™¨
uv run python manage.py runserver

# è®¿é—®
# - API: http://localhost:8000/api/attachments/
# - Admin: http://localhost:8000/admin/
```

### è¿è¡Œ FastAPI ç¤ºä¾‹

```bash
# å…‹éš†é¡¹ç›®ï¼ˆå¦‚æœè¿˜æ²¡æœ‰ï¼‰
git clone https://github.com/cone387/ChewyAttachment.git
cd ChewyAttachment

# ä½¿ç”¨ uv å®‰è£…ä¾èµ–ï¼ˆä¼šè‡ªåŠ¨åˆ›å»º .venv è™šæ‹Ÿç¯å¢ƒï¼‰
uv sync

# å¯åŠ¨ FastAPI åº”ç”¨
uv run python examples/fastapi_example/main.py

# è®¿é—®
# - API: http://localhost:8000/api/attachments/
# - Docs: http://localhost:8000/docs
# - ReDoc: http://localhost:8000/redoc
```

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼

## ğŸ“„ License

MIT License

## ğŸ‘¤ ä½œè€…

- GitHub: [@cone387](https://github.com/cone387)

## ğŸ”— ç›¸å…³é“¾æ¥

- [é¡¹ç›®ä¸»é¡µ](https://github.com/cone387/ChewyAttachment)
- [é—®é¢˜åé¦ˆ](https://github.com/cone387/ChewyAttachment/issues)
