version: "3"

vars:
  OS:
    sh: echo {{OS}}

  UV_BIN:  # Dynamically detect uv binary location
    sh: |
      if command -v uv >/dev/null 2>&1; then
        command -v uv
      elif [ -x "/root/.local/bin/uv" ]; then
        echo "/root/.local/bin/uv"
      elif [ -x "$HOME/.local/bin/uv" ]; then
        echo "$HOME/.local/bin/uv"
      else
        echo "/root/.local/bin/uv"
      fi

  VENV_PYTHON_PATH:
      sh: |
        find "$VIRTUAL_ENV/lib" -maxdepth 1 -type d -name "python*" | head -n1
  DOT_VENV_PYTHON_PATH:
    sh: |
      find "$VIRTUAL_ENV/lib" -maxdepth 1 -type d -name "python*" | head -n1 | sed 's|^.*/\.venv/|.venv/|'
  VENV_SITE_PACKAGES:
    sh: "python -c 'import os, site; print(os.path.abspath(site.getsitepackages()[0]))'"

  GIT_BRANCH:
      sh: git branch --show-current
  GIT_COMMIT_HASH:
      sh: git rev-parse --short HEAD

tasks:
  print-vars:
    desc: "Print all task variables - command: task print-vars --verbose"
    cmds:
      - |
        echo {{.OS}}
