import csp_lib.equipment.device.base
import csp_lib.equipment.device.events
import csp_lib.manager.alarm.repository
import csp_lib.manager.alarm.schema
import datetime
from csp_lib.core import get_logger as get_logger
from csp_lib.equipment.alarm.definition import AlarmLevel as AlarmLevel
from csp_lib.equipment.device.base import AsyncModbusDevice as AsyncModbusDevice
from csp_lib.equipment.device.events import ConnectedPayload as ConnectedPayload, DeviceAlarmPayload as DeviceAlarmPayload, DisconnectPayload as DisconnectPayload
from csp_lib.manager.alarm.repository import AlarmRepository as AlarmRepository
from csp_lib.manager.alarm.schema import AlarmRecord as AlarmRecord, AlarmType as AlarmType
from typing import ClassVar

EVENT_ALARM_CLEARED: str
EVENT_ALARM_TRIGGERED: str
EVENT_CONNECTED: str
EVENT_DISCONNECTED: str

class AlarmPersistenceManager:
    DISCONNECT_CODE: ClassVar[str] = ...
    DISCONNECT_NAME: ClassVar[str] = ...
    def __init__(self, repository: csp_lib.manager.alarm.repository.AlarmRepository) -> None: ...
    def subscribe(self, device: csp_lib.equipment.device.base.AsyncModbusDevice) -> None: ...
    def unsubscribe(self, device: csp_lib.equipment.device.base.AsyncModbusDevice) -> None: ...
    def _on_disconnected(self, payload: csp_lib.equipment.device.events.DisconnectPayload) -> None: ...
    def _on_connected(self, payload: csp_lib.equipment.device.events.ConnectedPayload) -> None: ...
    def _on_alarm_triggered(self, payload: csp_lib.equipment.device.events.DeviceAlarmPayload) -> None: ...
    def _on_alarm_cleared(self, payload: csp_lib.equipment.device.events.DeviceAlarmPayload) -> None: ...
    def _create_alarm(self, record: csp_lib.manager.alarm.schema.AlarmRecord) -> None: ...
    def _resolve_alarm(self, alarm_key: str, resolved_at: datetime.datetime) -> None: ...
