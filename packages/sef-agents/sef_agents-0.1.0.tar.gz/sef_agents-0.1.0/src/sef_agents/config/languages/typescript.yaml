# TypeScript Language Configuration for SEF Agents

language: typescript
extensions: [".ts", ".tsx", ".mts", ".cts"]
parser: ast  # Production-grade: AST parsing for accurate per-function complexity

# Debt detection patterns
debt_patterns:
  todo_fixme:
    description: "TODO/FIXME comments indicate incomplete work"
    severity: medium
    pattern: "//\\s*(TODO|FIXME|XXX|HACK|BUG)[\\s:]+(.+)"
    suggestion: "Address the TODO or create a tracked issue"

  any_type:
    description: "Using 'any' defeats TypeScript's type safety"
    severity: high
    pattern: ":\\s*any\\b"
    suggestion: "Use specific types, unknown, or generics"

  ts_ignore:
    description: "@ts-ignore suppresses type errors"
    severity: high
    pattern: "@ts-ignore|@ts-nocheck"
    suggestion: "Fix the type error instead of ignoring"

  console_log:
    description: "console.log leaks to production, use structured logging"
    severity: high
    pattern: "console\\.(log|debug|info|warn|error)\\("
    suggestion: "Use structured logging library (e.g., pino, winston)"

  empty_catch:
    description: "Empty catch blocks swallow errors"
    severity: high
    pattern: "catch\\s*\\([^)]*\\)\\s*\\{\\s*\\}"
    suggestion: "Handle or log the error"

  magic_numbers:
    description: "Magic numbers violate DRY and hurt maintainability"
    severity: medium
    pattern: "(?<!\\d)[0-9]{2,}(?!\\d)"
    suggestion: "Extract to named constants (e.g., const MAX_RETRIES = 3)"

  long_function:
    description: "Function exceeds line limit"
    severity: medium
    pattern: "function|=>|async"
    suggestion: "Break into smaller focused functions"

  missing_return_type:
    description: "Functions should have explicit return types"
    severity: medium
    pattern: "function\\s+\\w+\\s*\\([^)]*\\)\\s*\\{"
    suggestion: "Add return type annotation"

  # Code Quality Patterns
  unused_import:
    description: "Unused imports increase bundle size and reduce clarity"
    severity: low
    pattern: "^import\\s+.*from"
    suggestion: "Remove unused imports (use ESLint rule: @typescript-eslint/no-unused-vars)"

  implicit_any:
    description: "Implicit any defeats TypeScript's type safety"
    severity: high
    pattern: "function\\s+\\w+\\s*\\([^)]*\\)\\s*:\\s*any|const\\s+\\w+\\s*:\\s*any"
    suggestion: "Add explicit types or use unknown"

  non_null_assertion:
    description: "Non-null assertion (!) bypasses type safety"
    severity: medium
    pattern: "!\\s*[a-zA-Z_$]|\\w+\\s*!"
    suggestion: "Use optional chaining or proper null checks"

  any_in_generic:
    description: "Generic with 'any' loses type safety"
    severity: high
    pattern: "<\\s*any\\s*>|Array\\s*<\\s*any\\s*>"
    suggestion: "Use specific types or unknown"

  missing_async_await:
    description: "Promise not awaited"
    severity: high
    pattern: "Promise\\s*\\.(then|catch)\\s*\\("
    suggestion: "Use async/await for better error handling"

  direct_mutation:
    description: "Direct state mutation in React/Redux"
    severity: critical
    pattern: "\\.(push|pop|shift|unshift|splice|sort|reverse)\\s*\\(|\\w+\\s*=\\s*\\w+\\["
    suggestion: "Use immutable patterns (spread, map, filter)"

# Deprecated patterns
deprecated_imports:
  "tslint": "Use ESLint instead"
  "mocha": "Consider using Jest or Vitest"
  "jasmine": "Consider using Jest or Vitest"

# Naming conventions
naming:
  generic_names:
    - data
    - result
    - temp
    - handler
    - manager
    - helper
    - utils
    - item
    - elem
    - val
    - obj
    - x
    - y
    - z

  conventions:
    functions: camelCase
    classes: PascalCase
    interfaces: PascalCase (I-prefix optional)
    constants: UPPER_SNAKE_CASE
    variables: camelCase
    types: PascalCase

# Quality thresholds (production-grade, industry-standard)
thresholds:
  # Dual-threshold system: Function-level (algorithm complexity) + File-level (module size)
  function_complexity_warn: 15   # Per-function cognitive complexity (warning)
  function_complexity_block: 25  # Per-function cognitive complexity (blocker)
  file_complexity_warn: 80       # Aggregate file complexity (warning)
  file_complexity_block: 150     # Aggregate file complexity (blocker)
  # Legacy single threshold (deprecated, use function_complexity_block)
  complexity: 25                 # Fallback for backward compatibility
  function_length: 50            # Testable functions
  nesting_depth: 3               # Readable code
  file_length: 300               # Single responsibility
  comment_ratio: 0.3
  class_ratio: 0.5

# File exclusions
exclusions:
  # Skip entire analysis (autogenerated, vendor, coverage, hidden dirs)
  skip_analysis:
    - "**/node_modules/**"
    - "**/.next/**"
    - "**/.nuxt/**"
    - "**/.cache/**"
    - "**/.git/**"
    - "**/coverage/**"
    - "**/dist/**"
    - "**/build/**"
    - "**/.dist/**"
    - "**/.build/**"
    - "**/.*/**"  # Hidden directories (e.g., .vscode, .idea)
    - "**/*.generated.ts"
    - "**/*.generated.tsx"
    - "**/*.auto.ts"
    - "**/*.auto.tsx"
    - "**/*.json"  # JSON files excluded from complexity checks
    - "**/vendor/**"
    - "**/vendors/**"
    - "**/third-party/**"
    - "**/third_party/**"

  # Skip file-level complexity check only (still analyze per-function)
  file_complexity:
    - "*.test.ts"
    - "*.test.tsx"
    - "*.spec.ts"
    - "*.spec.tsx"
    - "*dto.ts"
    - "*dto.tsx"
    - "*model.ts"
    - "*model.tsx"
    - "*types.ts"
    - "*types.tsx"
    - "*interface.ts"
    - "*interface.tsx"

# AI anti-patterns
anti_patterns:
  over_abstraction:
    description: "Too many classes/interfaces"
    threshold: 0.5

  copy_paste:
    description: "Duplicated code blocks"
    min_block_size: 5

  prop_drilling:
    description: "Props passed through many levels"
    max_levels: 2
