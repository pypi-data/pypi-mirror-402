.. image:: https://odoo-community.org/readme-banner-image
   :target: https://odoo-community.org/get-involved?utm_source=readme
   :alt: Odoo Community Association

============
Delivery CBL
============

.. 
   !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
   !! This file is generated by oca-gen-addon-readme !!
   !! changes will be overwritten.                   !!
   !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
   !! source digest: sha256:6bca093be4f075879b5cb9b83e8c5bbed59a2f8cc40e714cc433c0981ffd017e
   !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!

.. |badge1| image:: https://img.shields.io/badge/maturity-Beta-yellow.png
    :target: https://odoo-community.org/page/development-status
    :alt: Beta
.. |badge2| image:: https://img.shields.io/badge/license-AGPL--3-blue.png
    :target: http://www.gnu.org/licenses/agpl-3.0-standalone.html
    :alt: License: AGPL-3
.. |badge3| image:: https://img.shields.io/badge/github-OCA%2Fdelivery--carrier-lightgray.png?logo=github
    :target: https://github.com/OCA/delivery-carrier/tree/17.0/delivery_cbl
    :alt: OCA/delivery-carrier
.. |badge4| image:: https://img.shields.io/badge/weblate-Translate%20me-F47D42.png
    :target: https://translation.odoo-community.org/projects/delivery-carrier-17-0/delivery-carrier-17-0-delivery_cbl
    :alt: Translate me on Weblate
.. |badge5| image:: https://img.shields.io/badge/runboat-Try%20me-875A7B.png
    :target: https://runboat.odoo-community.org/builds?repo=OCA/delivery-carrier&target_branch=17.0
    :alt: Try me on Runboat

|badge1| |badge2| |badge3| |badge4| |badge5|

This module adds `CBL <https://https://www.cbl-logistica.com/>`__ to the
available carriers.

The following operations are supported:

- Register shippings
- Generate shipping labels when shippings are registered. The PDF is
  generated using the labelary API (http://api.labelary.com/).
- Validate shippings (both manually and automatically)
- Cancel shippings
- Generate the CBL Manifest

**Table of contents**

.. contents::
   :local:

Configuration
=============

To configure this module, you need to:

1. Add a Shipping Method with Provider ``CBL`` and introduce the User,
   Password, Client Code and Client Token.
2. Choose the "Collect" "Freight Type" if the delivery needs to be paid
   by the receiver, or the "Prepaid" type if it needs to be paid by the
   shipper.
3. Activate the "Cash On Delivery" option if shippings are paid by cash,
   assuming that the picking has a related sales order.
4. Activate the "Needs Confirmation" option if shippings need to be
   confirmed after the tracking number is created in order to be
   oficially included in the CBL pending shippings database. It is
   crucial to have the same configuration both in Odoo and in your CBL
   account. Contact CBL for more information on how they can configure
   this feature.

**NOTE** Contact CBL to get testing credentials.

Usage
=====

To carry out the shipment, the shipping method previously created must
be set on the delivery order:

- Once the outgoing delivery is “Validated (Done)", the shipping
  information is automatically transmitted to CBL. If everything is
  correct, a tracking number and the corresponding labels are generated.
- Shipments can be cancelled by clicking the "Cancel" button located
  next to the picking's tracking number. Keep in mind that using a
  carrier with the "Needs Confirmation" option unchecked, while having
  the opposite configuration set in CBL, may cause issues when
  attempting to cancel a shipment. In such cases, contact CBL so they
  can adjust the confirmation policy accordingly.
- If a shipment could not be generated or has been cancelled, a new one
  can be created by clicking the "Send to Shipper" button at the top of
  the stock picking.
- Shipments that require confirmation after the tracking number has been
  assigned can be confirmed as follows:

  - Individually: By clicking the "Confirm" button in the "Tracking
    Number" field, located under the "Additional Info" tab within the
    "Shipping Information" section.
  - [Improved] Bulk method: In the list view of outgoing deliveries,
    select all deliveries for the carrier whose status is “Validated
    (Done)", click the "Actions" gear icon → "Confirm CBL pickings". A
    wizard will appear listing the deliveries to be confirmed. Verify
    that all required pickings are included, then click the "Confirm
    Shipments" button.
  - Additionally, there is a scheduled action ("CBL: Confirm Shipments")
    that automatically validates pending CBL shipments once per day by
    default.

- To generate the manifest, you need to Inventory > Operation >
  Manifest, select a CBL carrier and set the date range to select the
  picking.

Known issues / Roadmap
======================

- During the development of the shipping label generation feature, we
  initially evaluated the use of the Zebrafy library to convert ZPL
  labels into PDF format. However, Zebrafy is based on the presence of
  graphic fields (^GF) in the ZPL source, which are not always included
  in the labels generated by CBL.
- To ensure broader compatibility, it's opted to use the external
  service Labelary.com, returns the corresponding label in PDF format
  via an HTTP request.
- To provide flexibility, a new field cbl_label_format has been added to
  the delivery.carrier model, allowing the user to select between ZPL
  (default) and PDF formats. The method cdl_generate_labels will only
  invoke the external Labelary service if the selected format is PDF.
  Otherwise, the label is stored directly in ZPL format without any
  transformation.

Bug Tracker
===========

Bugs are tracked on `GitHub Issues <https://github.com/OCA/delivery-carrier/issues>`_.
In case of trouble, please check there if your issue has already been reported.
If you spotted it first, help us to smash it by providing a detailed and welcomed
`feedback <https://github.com/OCA/delivery-carrier/issues/new?body=module:%20delivery_cbl%0Aversion:%2017.0%0A%0A**Steps%20to%20reproduce**%0A-%20...%0A%0A**Current%20behavior**%0A%0A**Expected%20behavior**>`_.

Do not contact contributors directly about support or help with technical issues.

Credits
=======

Authors
-------

* Sygel

Contributors
------------

- Manuel Regidor manuel.regidor@sygel.es
- Valentín Vinagre valentin.vinagre@sygel.es
- Ángel Rivas angel.rivas@sygel.es

Maintainers
-----------

This module is maintained by the OCA.

.. image:: https://odoo-community.org/logo.png
   :alt: Odoo Community Association
   :target: https://odoo-community.org

OCA, or the Odoo Community Association, is a nonprofit organization whose
mission is to support the collaborative development of Odoo features and
promote its widespread use.

This module is part of the `OCA/delivery-carrier <https://github.com/OCA/delivery-carrier/tree/17.0/delivery_cbl>`_ project on GitHub.

You are welcome to contribute. To learn how please visit https://odoo-community.org/page/Contribute.
