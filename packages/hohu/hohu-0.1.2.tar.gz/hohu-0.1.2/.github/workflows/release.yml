name: Release

on:
  release:
    types: [published] # 仅在您手动点击“Publish Release”按钮后触发

jobs:
  deploy:
    name: Build and Publish to PyPI
    runs-on: ubuntu-latest
    permissions:
      contents: write  # 允许修改 Release 内容并上传附件
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0 # 获取完整历史以生成详细日志

      - name: Install uv
        uses: astral-sh/setup-uv@v5
        with:
          version: "0.9.18"
          enable-cache: true

      - name: Set up Python
        # uv 会根据 pyproject.toml 自动安装正确的 Python 版本
        run: uv python install

      - name: Build project
        # uv 会自动生成 .tar.gz (sdist) 和 .whl (wheel)
        run: uv build

    #   - name: Publish to PyPI
    #     env:
    #       # 必须在 GitHub Repo Settings -> Secrets 中配置此 Token
    #       UV_PUBLISH_TOKEN: ${{ secrets.PYPI_API_TOKEN }}
    #     run: |
    #       uv publish

      - name: Upload artifacts to GitHub Release
        # 将构建好的包也作为附件挂载到 GitHub Release 页面上
        uses: softprops/action-gh-release@v2
        with:
          files: dist/*
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}