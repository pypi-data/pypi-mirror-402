[build-system]
requires = [
    "setuptools >= 61.0",
    "wheel",
    "setuptools-scm[toml]>=6.0"
   ]
build-backend = "setuptools.build_meta"

[tool.setuptools]
packages = ["tubular"]

[tool.setuptools_scm]
# can be empty if no extra settings are needed, presence enables setuptools_scm

[project]
name = "tubular"
dynamic = ["version"]
dependencies = [
    "pandas>=1.5.0",
    "scikit-learn>=1.2.0",
    "narwhals >= 2.11.0",
    "polars >= 1.9.0",
    "beartype >= 0.19.0",
    "typing-extensions>=4.5.0",
]
requires-python = ">=3.9"
authors = [{ name = "Allianz UK Data Science Team", email="datasciencepackages@allianz.co.uk"}]
description = "Python package implementing ML feature engineering and pre-processing for polars or pandas dataframes."
readme = {file = "README.md", content-type = "text/markdown"}
license = {file = "LICENSE"}
keywords = ["polars", "pandas", "feature engineering", "pre-processing", "machine learning", "ML", "data science", "data transforms", "pipeline", "sklearn", "DS"]
classifiers=[
    "Programming Language :: Python",
    "Programming Language :: Python :: 3.9",
    "Programming Language :: Python :: 3.10",
    "Programming Language :: Python :: 3.11",
    "Programming Language :: Python :: 3.12",
    "Operating System :: OS Independent",
    "License :: OSI Approved :: BSD License",
]

[project.optional-dependencies]
dev = [
    "test-aide>=0.1.0",
    "pytest>=5.4.1",
    "pytest-mock>=3.5.1",
    "pyarrow>=17.0.0",
    "pytest-cov<=2.10.1",
    "prek",
    "ruff>=0.2.2",
    "auto-walrus==0.3.4",
    "tabulate>=0.9.0",
    "codespell",
    "typos",
    "blacken-docs",
    ]

[project.urls]
Documentation = "https://tubular.readthedocs.io/en/latest/index.html"
Repository = "https://github.com/azukds/tubular"
Issues = "https://github.com/azukds/tubular/issues"
Changelog = "https://github.com/azukds/tubular/CHANGELOG.md"

[tool.codespell]
skip = "_typos.toml"
ignore-words-list = [
    "ser", # codespell:ignore
    "Ned", # codespell:ignore
 ]

[tool.ruff]
# Same as Black.
line-length = 88

# Assume Python 3.9.
target-version = "py39"

[tool.ruff.lint]
# Enable the pycodestyle (`E`) and Pyflakes (`F`) rules by default.
# Unlike Flake8, Ruff doesn't enable pycodestyle warnings (`W`) or
# McCabe complexity (`C901`) by default.
select = [
    "A",
    "AIR",
    "ANN",
    "ARG",
    "ASYNC",
    "B", # bugbear 
    "C4",
    "COM",
    "D",
    "DOC",
    "DTZ",
    "E", # pycodestyle
    "EM",
    "EXE",
    "F", # Pyflakes
    "FA",
    "FAST",
    "FURB",
    "FLY",
    "G",
    "I",
    "INT",
    "ISC",
    "ICN",
    "LOG",
    "NPY",
    "PD",
    "PERF",
    "PGH",
    "PIE",
    "PLC",
    "PLE",
    "PLR",
    "PLW",
    "PT",
    "PYI",
    "Q",
    "RET",
    "RSE",
    "RUF",
    "S", # Bandit
    "SIM",
    "SLOT",
    "T10",
    "TCH",
    "TID",
    "UP",
    "W", # pycodestyle warnings
    "YTT",
]

# Enabled to allow direct type comparisons using is and is not under E721 (see https://docs.astral.sh/ruff/rules/type-comparison/)
preview = true

ignore = [
    "B905", # this rule makes changes that error for python3.9, as the strict argument for zip() was introduced in python3.10
    "PYI041", # clashes with beartype
    "TC001", # clashes with beartype, was previously "TCH001"
    "D203", # clashes with D211
    "D213", # clashes with D212
    "COM812", # conflicts with ruff formatter, which enforces this rule by default, produces a warning if used
    ]

# Allow autofix for all enabled rules (when `--fix`) is provided.
fixable = ["ALL"]
unfixable = []

# Exclude a variety of commonly ignored directories.
exclude = [".git", "__pycache__", "build", "dist", "source"]

# Allow unused variables when underscore-prefixed.
dummy-variable-rgx = "^(_+|(_+[a-zA-Z0-9_]*[a-zA-Z0-9]+?))$"

# Ignore `E402` (import violations) in all `__init__.py` file.
[tool.ruff.lint.per-file-ignores]
"__init__.py" = ["E402", "F401"]
"tests/*" = [
    "ANN",
    "S101",
    "PLC2701", # complains about private imports, which we test
    "E501",
    "D",
    "DOC",
    # below two complain about n arguments, with fixtures our tests
    # often have many args and am less concerned about this than in 
    # main code
    "PLR0917",
    "PLR0913",
    "PLR0914",
    "PLR6301", # converting to e.g. staticmethod can interfere with pytest detecting tests
    ]
"profiling/*"=["D", "DOC", "E501"]
# too much to turn on D/DOC and E501 lints in one go,
# will tackle individual modules at a time
"numeric.py"=["E501"]
"nominal.py"=["D", "DOC","E501"]
"mixins.py"=["E501"]
"mapping.py"=["E501"]
"imputers.py"=["E501"]
"dates.py"=["E501"]
"strings.py"=["E501"]
"capping.py"=["E501"]
"_utils.py"=["E501"]

[tool.ruff.lint.pyupgrade]
keep-runtime-typing=true

[tool.coverage.run]
branch = true

include = ["tubular/*"]

omit = [
      "tests/*",
]

[tool.coverage.report]

show_missing = true

fail_under = 80

# Pytest Configs
# Allows users to pass arguments in to pytest without needing to provide them as cmd options every time
# https://docs.pytest.org/en/7.1.x/reference/customize.html
[tool.pytest.ini_options]

# Additional Options (AddOpts) for pytest
addopts = '--doctest-modules'
filterwarnings = [
    "ignore::DeprecationWarning",
]
