"use strict";(self.webpackChunkjupyterlab_kernel_terminal_workspace_culler_extension=self.webpackChunkjupyterlab_kernel_terminal_workspace_culler_extension||[]).push([[750],{750(e,n,t){t.r(n),t.d(n,{default:()=>y});var l=t(490),o=t(167),s=t(469),r=t(830);async function a(e="",n={}){const t=r.ServerConnection.makeSettings(),l=s.URLExt.join(t.baseUrl,"jupyterlab-kernel-terminal-workspace-culler-extension",e);let o;try{o=await r.ServerConnection.makeRequest(l,n,t)}catch(e){throw new r.ServerConnection.NetworkError(e)}let a=await o.text();if(a.length>0)try{a=JSON.parse(a)}catch(e){console.log("Not a JSON response body.",o)}if(!o.ok)throw new r.ServerConnection.ResponseError(o,a.message||a);return a}let i=!0,c=5,u=null,d=null;async function v(e,n,t){var l,o;const s=e.composite;i=null===(l=s.showNotifications)||void 0===l||l;const r=null!==(o=s.cullCheckInterval)&&void 0!==o?o:5,u=r!==c;c=r;try{await a("settings",{method:"POST",body:JSON.stringify(s)})}catch(e){console.error("[Culler] Failed to sync settings to backend:",e)}u&&(console.log(`[Culler] Cull check interval changed to ${c} minutes`),p(n,t))}function p(e,n){const t=60*c*1e3;null!==u&&clearInterval(u),null!==d&&clearInterval(d),u=setInterval(()=>async function(e){var n,t,l,o,s,r;try{const c=await a("cull-result"),u=null!==(t=null===(n=c.kernels_culled)||void 0===n?void 0:n.length)&&void 0!==t?t:0,d=null!==(o=null===(l=c.terminals_culled)||void 0===l?void 0:l.length)&&void 0!==o?o:0,v=null!==(r=null===(s=c.sessions_culled)||void 0===s?void 0:s.length)&&void 0!==r?r:0;if(i&&(u>0||d>0||v>0)){const n=["Idle resources culled:"];u>0&&n.push(`Kernels: ${u}`),d>0&&n.push(`Terminals: ${d}`),v>0&&n.push(`Sessions: ${v}`),e.commands.hasCommand("jupyterlab-notifications:send")?await e.commands.execute("jupyterlab-notifications:send",{message:n.join("\n"),type:"info",autoClose:5e3}):console.info("[Culler]",n.join(" | "))}}catch(e){}}(e),t),n&&(d=setInterval(()=>h(n),t)),console.log(`[Culler] Intervals set to ${c} minutes (${t}ms)`)}async function h(e){const n=[];e.forEach(e=>{var t;const l=null===(t=e.content.session)||void 0===t?void 0:t.name;l&&e.isAttached&&!e.isDisposed&&n.push(l)});try{await a("active-terminals",{method:"POST",body:JSON.stringify({terminals:n})})}catch(e){console.debug("[Culler] Failed to report active terminals:",e)}}const m={id:"jupyterlab_kernel_terminal_workspace_culler_extension:plugin",description:"JupyterLab extension to automatically cull idle kernels, terminals, and sessions.",autoStart:!0,optional:[l.ISettingRegistry,o.ITerminalTracker],activate:(e,n,t)=>{console.log("JupyterLab extension jupyterlab_kernel_terminal_workspace_culler_extension is activated!"),n?n.load(m.id).then(n=>{var l;console.log("[Culler] Settings loaded:",n.composite);const o=n.composite;c=null!==(l=o.cullCheckInterval)&&void 0!==l?l:5,v(n,e,t),p(e,t),n.changed.connect(()=>v(n,e,t))}).catch(n=>{console.error("[Culler] Failed to load settings:",n),p(e,t)}):p(e,t),t&&(t.currentChanged.connect(()=>{h(t)}),t.widgetAdded.connect(()=>{h(t)}),h(t))}},y=m}}]);