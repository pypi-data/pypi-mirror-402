"use strict";(self.webpackChunkjupyterlab_kernel_terminal_workspace_culler_extension=self.webpackChunkjupyterlab_kernel_terminal_workspace_culler_extension||[]).push([[750],{750(e,n,t){t.r(n),t.d(n,{default:()=>k});var l=t(490),o=t(167),r=t(469),s=t(830);async function a(e="",n={}){const t=s.ServerConnection.makeSettings(),l=r.URLExt.join(t.baseUrl,"jupyterlab-kernel-terminal-workspace-culler-extension",e);let o;try{o=await s.ServerConnection.makeRequest(l,n,t)}catch(e){throw new s.ServerConnection.NetworkError(e)}let a=await o.text();if(a.length>0)try{a=JSON.parse(a)}catch(e){console.log("Not a JSON response body.",o)}if(!o.ok)throw new s.ServerConnection.ResponseError(o,a.message||a);return a}let c=!0,i=5,u=null,d=null;async function p(e,n,t){var l,o;const r=e.composite;c=null===(l=r.showNotifications)||void 0===l||l;const s=null!==(o=r.cullCheckInterval)&&void 0!==o?o:5,u=s!==i;i=s;try{await a("settings",{method:"POST",body:JSON.stringify(r)})}catch(e){console.error("[Culler] Failed to sync settings to backend:",e)}u&&(console.log(`[Culler] Cull check interval changed to ${i} minutes`),v(n,t))}function v(e,n){const t=60*i*1e3;null!==u&&clearInterval(u),null!==d&&clearInterval(d),u=setInterval(()=>async function(e){var n,t,l,o,r,s;try{const i=await a("cull-result"),u=null!==(t=null===(n=i.kernels_culled)||void 0===n?void 0:n.length)&&void 0!==t?t:0,d=null!==(o=null===(l=i.terminals_culled)||void 0===l?void 0:l.length)&&void 0!==o?o:0,p=null!==(s=null===(r=i.workspaces_culled)||void 0===r?void 0:r.length)&&void 0!==s?s:0;if(c&&(u>0||d>0||p>0)){const n=["Idle resources culled:"];u>0&&n.push(`Kernels: ${u}`),d>0&&n.push(`Terminals: ${d}`),p>0&&n.push(`Workspaces: ${p}`),e.commands.hasCommand("jupyterlab-notifications:send")?await e.commands.execute("jupyterlab-notifications:send",{message:n.join("\n"),type:"info",autoClose:5e3}):console.info("[Culler]",n.join(" | "))}}catch(e){}}(e),t),n&&(d=setInterval(()=>h(n),t)),console.log(`[Culler] Intervals set to ${i} minutes (${t}ms)`)}async function h(e){const n=[];e.forEach(e=>{var t;const l=null===(t=e.content.session)||void 0===t?void 0:t.name;l&&e.isAttached&&!e.isDisposed&&n.push(l)});try{await a("active-terminals",{method:"POST",body:JSON.stringify({terminals:n})})}catch(e){console.debug("[Culler] Failed to report active terminals:",e)}}const m={id:"jupyterlab_kernel_terminal_workspace_culler_extension:plugin",description:"JupyterLab extension to automatically cull idle kernels, terminals, and workspaces.",autoStart:!0,optional:[l.ISettingRegistry,o.ITerminalTracker],activate:(e,n,t)=>{console.log("JupyterLab extension jupyterlab_kernel_terminal_workspace_culler_extension is activated!"),n?n.load(m.id).then(n=>{var l;console.log("[Culler] Settings loaded:",n.composite);const o=n.composite;i=null!==(l=o.cullCheckInterval)&&void 0!==l?l:5,p(n,e,t),v(e,t),n.changed.connect(()=>p(n,e,t))}).catch(n=>{console.error("[Culler] Failed to load settings:",n),v(e,t)}):v(e,t),t&&(t.currentChanged.connect(()=>{h(t)}),t.widgetAdded.connect(()=>{h(t)}),h(t))}},k=m}}]);