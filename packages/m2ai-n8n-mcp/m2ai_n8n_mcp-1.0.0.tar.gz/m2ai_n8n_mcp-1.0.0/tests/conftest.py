"""Pytest configuration and shared fixtures for n8n-mcp.

Generated by GRIMLOCK MCP Factory
"""

import os
from typing import Generator
from unittest.mock import patch

import pytest
import respx


@pytest.fixture
def mock_env() -> Generator[None, None, None]:
    """Mock environment variables for testing.

    Yields:
        None (environment is mocked for duration of test)
    """
    env_vars = {
        "N8N_BASE_URL": "https://test-n8n.app.n8n.cloud",
        "N8N_API_KEY": "test-api-key-12345",
    }

    with patch.dict(os.environ, env_vars, clear=False):
        yield


@pytest.fixture
def mock_httpx_client() -> Generator[respx.MockRouter, None, None]:
    """Mock httpx client for external API calls.

    Yields:
        respx.MockRouter for configuring mock responses
    """
    with respx.mock(assert_all_called=False) as respx_mock:
        yield respx_mock


@pytest.fixture
def sample_workflows_response() -> dict:
    """Sample n8n workflows list response."""
    return {
        "data": [
            {
                "id": "1",
                "name": "Email Notification Workflow",
                "active": True,
                "createdAt": "2024-01-01T00:00:00.000Z",
                "updatedAt": "2024-01-02T00:00:00.000Z",
            },
            {
                "id": "2",
                "name": "Data Sync Workflow",
                "active": True,
                "createdAt": "2024-01-01T00:00:00.000Z",
                "updatedAt": "2024-01-02T00:00:00.000Z",
            },
            {
                "id": "3",
                "name": "Backup Workflow",
                "active": False,
                "createdAt": "2024-01-01T00:00:00.000Z",
                "updatedAt": "2024-01-02T00:00:00.000Z",
            },
        ]
    }


@pytest.fixture
def sample_workflow_detail_response() -> dict:
    """Sample n8n single workflow response."""
    return {
        "id": "1",
        "name": "Email Notification Workflow",
        "active": True,
        "nodes": [
            {"name": "Start", "type": "n8n-nodes-base.start"},
            {"name": "Send Email", "type": "n8n-nodes-base.emailSend"},
        ],
        "connections": {},
        "createdAt": "2024-01-01T00:00:00.000Z",
        "updatedAt": "2024-01-02T00:00:00.000Z",
    }


@pytest.fixture
def sample_executions_response() -> dict:
    """Sample n8n executions list response."""
    return {
        "data": [
            {
                "id": "101",
                "workflowId": "1",
                "status": "success",
                "startedAt": "2024-01-02T10:00:00.000Z",
                "stoppedAt": "2024-01-02T10:00:05.000Z",
            },
            {
                "id": "102",
                "workflowId": "1",
                "status": "success",
                "startedAt": "2024-01-02T11:00:00.000Z",
                "stoppedAt": "2024-01-02T11:00:03.000Z",
            },
            {
                "id": "103",
                "workflowId": "2",
                "status": "error",
                "startedAt": "2024-01-02T12:00:00.000Z",
                "stoppedAt": "2024-01-02T12:00:01.000Z",
            },
            {
                "id": "104",
                "workflowId": "2",
                "status": "success",
                "startedAt": "2024-01-02T13:00:00.000Z",
                "stoppedAt": "2024-01-02T13:00:02.000Z",
            },
            {
                "id": "105",
                "workflowId": "2",
                "status": "error",
                "startedAt": "2024-01-02T14:00:00.000Z",
                "stoppedAt": "2024-01-02T14:00:01.000Z",
            },
        ]
    }


@pytest.fixture
def sample_empty_workflows_response() -> dict:
    """Sample empty workflows response."""
    return {"data": []}


@pytest.fixture
def sample_empty_executions_response() -> dict:
    """Sample empty executions response."""
    return {"data": []}
