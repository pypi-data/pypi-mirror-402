{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://ecp.amcrypto.org/ecp/schemas/ecp-policy.schema.json",
  "title": "Expert Context Pack (ECP) Maintenance Policy v1.0",
  "type": "object",
  "required": [
    "policy_version",
    "budgets",
    "refresh_triggers",
    "update_strategy",
    "validation",
    "publishing"
  ],
  "properties": {
    "policy_version": {
      "type": "string",
      "const": "1.0"
    },
    "retention": {
      "type": "object",
      "properties": {
        "max_backups_per_index": {
          "type": "integer",
          "minimum": 0
        },
        "max_backup_age_days": {
          "type": "integer",
          "minimum": 0
        },
        "prune_logs_after_days": {
          "type": "integer",
          "minimum": 0
        }
      },
      "additionalProperties": true
    },
    "budgets": {
      "type": "object",
      "minProperties": 1,
      "properties": {
        "max_update_duration_seconds": {
          "type": "integer",
          "minimum": 0
        },
        "max_update_cost_usd": {
          "type": "number",
          "minimum": 0
        },
        "max_tokens": {
          "type": "integer",
          "minimum": 0
        },
        "max_changed_files": {
          "type": "integer",
          "minimum": 0
        }
      },
      "additionalProperties": true
    },
    "refresh_triggers": {
      "type": "array",
      "minItems": 1,
      "items": {
        "type": "object",
        "required": [
          "type",
          "spec"
        ],
        "properties": {
          "type": {
            "type": "string",
            "enum": [
              "schedule",
              "event",
              "manual"
            ]
          },
          "spec": {
            "type": "string"
          }
        },
        "additionalProperties": true
      }
    },
    "update_strategy": {
      "type": "object",
      "required": [
        "default",
        "incremental",
        "rebuild",
        "rebuild_thresholds"
      ],
      "properties": {
        "default": {
          "type": "string",
          "enum": [
            "incremental",
            "rebuild"
          ]
        },
        "incremental": {
          "type": "object",
          "additionalProperties": true
        },
        "rebuild": {
          "type": "object",
          "additionalProperties": true
        },
        "rebuild_thresholds": {
          "type": "object",
          "additionalProperties": true
        }
      },
      "additionalProperties": true
    },
    "validation": {
      "type": "object",
      "required": [
        "eval_suites",
        "fail_action"
      ],
      "properties": {
        "eval_suites": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "minItems": 1
        },
        "fail_action": {
          "type": "string",
          "enum": [
            "block",
            "warn",
            "rollback"
          ]
        }
      },
      "additionalProperties": true
    },
    "publishing": {
      "type": "object",
      "required": [
        "on_pass",
        "rollback_on_fail"
      ],
      "properties": {
        "on_pass": {
          "type": "string",
          "enum": [
            "auto_publish",
            "require_approval"
          ]
        },
        "rollback_on_fail": {
          "type": "boolean"
        }
      },
      "additionalProperties": true
    }
  },
  "additionalProperties": true
}
