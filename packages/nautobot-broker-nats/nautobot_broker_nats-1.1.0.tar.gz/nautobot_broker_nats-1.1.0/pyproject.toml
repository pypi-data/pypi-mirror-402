[tool.poetry]
authors     = ["Eric Busto <ebusto@nvidia.com>"]
description = "Publish changes to NATS"
name        = "nautobot-broker-nats"
packages    = [{include = "nautobot_broker_nats"}]
readme      = "README.md"
version     = "1.1.0"

[tool.poetry.dependencies]
dictdiffer = "^0.9.0"
nats-py    = "^2.10.0"
nkeys      = "^0.2.1"
orjson     = "^3.10.15"
python     = ">=3.11,<4.0"

[tool.poetry.group.dev.dependencies]
pylint        = "^3.3"
pylint-django = "^2.6"
ruff          = "^0.9"

[build-system]
build-backend = "poetry.core.masonry.api"
requires      = ["poetry-core"]

[tool.pylint.main]
analyse-fallback-blocks = "no"
ignore=".venv"
jobs = 0
# Include the pylint_django plugin to avoid spurious warnings about Django patterns
# Include pylint_nautobot to prep for Nautobot v2 migration
load-plugins="pylint_django"
django-settings-module="nautobot_consumables.config"
py-version = "3.11"


[tool.pylint.basic]
class-attribute-naming-style = "snake_case"
good-names = ["i", "j", "k", "q", "v", "ex", "id", "pk", "Run", "logger", "_"]
# No docstrings required for private methods (Pylint default), or for test_ functions, or for inner Meta classes.
no-docstring-rgx="^(_|test_|Meta$)"
property-classes = ["abc.abstractproperty", "property"]
# Maintain the default behavior, disallowing TypeAliases that start or end with "T" or "Type",
# but allow CONSTANT names in addition to PascalCase.
# https://pylint.readthedocs.io/en/stable/user_guide/messages/convention/invalid-name.html#predefined-naming-patterns
typealias-rgx="^(?!T)[A-Z][A-Za-z]{2,}(?<!Type)(?<!T)$"

[tool.pylint.format]
ignore-long-lines = "^\\s*(# )?(from \\S+)?\\s?(import\\s)?(.+)?<?(http)?s?(://\\S+)?>?"

[tool.pylint.imports]
allow-wildcard-with-all = "no"

[tool.pylint.messages_control]
# Line length is checked by flake8 with flake8-bugbear
disable = [
    "raw-checker-failed",
    "bad-inline-option",
    "locally-disabled",
    "file-ignored",
    "suppressed-message",
    "useless-suppression",
    "deprecated-pragma",
    "use-symbolic-message-instead",
    "line-too-long",
    "duplicate-code",
    "too-many-ancestors",
    "fixme",
]

[tool.ruff]
line-length = 100
target-version = "py310"

[tool.ruff.lint]
select = [
    "B",  # flake8-bugbear
    "D",  # pydocstyle
    "E",  # pycodestyle error
    "F",  # pyflakes
    "I",  # isort
    "PL", # pylint
    "S",  # bandit
    "W",  # pycodestyle warning
]
ignore = [
    # D105 enforces docstrings for magic methods, e.g. __str__(). It seems unnecessary.
    "D105",

    # warning: `one-blank-line-before-class` (D203) and `no-blank-line-before-class` (D211) are incompatible.
    "D203", # 1 blank line required before class docstring

    # D212 is enabled by default in google convention, and complains if we have a docstring like:
    # """
    # My docstring is on the line after the opening quotes instead of on the same line as them.
    # """
    # We've discussed and concluded that we consider this to be a valid style choice.
    "D212", # Multi-line docstring summary should start at the first line
]

[tool.ruff.lint.isort]
force-sort-within-sections = true

[tool.ruff.lint.pycodestyle]
# Combine line-length and max-line-length to emulate flake8-bugbear's B950 rule.
# The formatter uses line-length, but rule E501 won't complain until a line hits 111.
max-line-length = 110

[tool.ruff.lint.pydocstyle]
convention = "google"

[tool.ruff.lint.per-file-ignores]
"nautobot_consumables/**/__init__.py" = [
    "D",
]
"nautobot_consumables/migrations/*" = [
    "D",
]
"nautobot_consumables/tests/*" = [
    "D",
    "S"
]
