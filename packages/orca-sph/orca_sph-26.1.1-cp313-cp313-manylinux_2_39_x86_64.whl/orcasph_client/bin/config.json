{
    "orcalink_client": {
        "enabled": true,
        "server_address": "localhost:50351",
        "session_id": 1,
        "client_name": "SPlisHSPlasH",
        "update_rate_hz": 50,
        "encoding": {
            "i_frame_interval": 30,
            "change_threshold": 0.001
        },
        "session": {
            "control_mode": "sync",
            "expected_clients": 2,
            "ready_timeout_sec": 30.0,
            "grpc_call_timeout_sec": 5.0,
            "async_params": {
                "flow_control_enabled": true,
                "flow_control_window_size": 10,
                "speed_ratio_threshold": 2.0,
                "comment": "异步模式参数：服务端中央流控。flow_control_enabled=禁用流控以避免干扰(测试模式), flow_control_window_size=判定触发窗口大小, speed_ratio_threshold=允许的速度比(1.2表示严格模式)"
            },
            "sync_params": {
                "sync_window_size": 1,
                "comment": "同步模式参数：客户端本地窗口大小（1~3）。window=1表示严格同步，window=2/3允许一定异步性"
            },
            "comment": "control_mode: 'sync'=同步模式(客户端本地窗口控制), 'async'=异步模式(服务端中央流控)。expected_clients=预期客户端数, ready_timeout_sec=会话就绪超时, grpc_call_timeout_sec=单次gRPC调用超时（秒）"
        }
    },
    "orcalink_bridge": {
        "coupling_mode": "multi_point_force",
        "force_position": {
            "channels": {
                "force": {
                    "channel_id": 1,
                    "publish": true,
                    "subscribe": false,
                    "comment": "SPH发送力给MuJoCo"
                },
                "position": {
                    "channel_id": 2,
                    "publish": false,
                    "subscribe": true,
                    "comment": "SPH接收位置来自MuJoCo"
                }
            },
            "rigid_body_dynamics": {
                "mode": "auto",
                "force_smoothing_alpha": 0.3,
                "comment": "刚体动力学模式: auto=根据OrcaLink启用自动选择(推荐), internal=强制PBD内部动力学, external=强制外部(MuJoCo)动力学",
                "force_smoothing_comment": "force_smoothing_alpha: EMA平滑因子[0-1], 0=无平滑, 0.3≈3周期平滑(推荐高速碰撞), 1.0=完全跟随(无平滑)"
            },
            "position_update": {
                "mode": "smooth",
                "velocity_smoothing": 0.3,
                "position_threshold": 0.001,
                "rotation_threshold": 0.01,
                "timeout_sec": 0.1,
                "comment": "smooth=手动推进+速度滤波(推荐), instant=瞬移(旧行为)",
                "velocity_smoothing_comment": "速度低通滤波系数[0-1]: 0=不滤波(直接应用新速度), 0.3=中等平滑(推荐), 1.0=完全保留旧速度(无跟随). 用于平滑刚体速度变化, 避免突变.",
                "position_threshold_comment": "位置到达阈值(米): 刚体到达目标位置的判断距离. 当位置误差<此值时认为已到达, 停止手动推进. 典型值0.001m(1mm)",
                "rotation_threshold_comment": "旋转到达阈值(弧度): 刚体旋转到达目标的判断误差. 当旋转误差<此值时认为已到达. 典型值0.01rad(~0.57°)",
                "timeout_comment": "超时阈值(秒): 如果超过此时间未收到新位置更新, 则停止推进并清零速度, 防止刚体失控运动. 建议100ms"
            }
        },
        "spring_constraint": {
            "channels": {
                "position": {
                    "channel_id": 2,
                    "publish": true,
                    "subscribe": true,
                    "comment": "双向位置交换：SPH发送和接收位置"
                }
            },
            "rigid_body_dynamics": {
                "mode": "internal",
                "force_smoothing_alpha": 0.3,
                "comment": "弹簧约束模式必须使用内部PBD动力学，不能使用外部(MuJoCo)动力学"
            }
        },
        "multi_point_force": {
            "channels": {
                "force": {
                    "channel_id": 3,
                    "publish": true,
                    "subscribe": false,
                    "comment": "SPH发送多点力给MuJoCo"
                },
                "position": {
                    "channel_id": 2,
                    "publish": false,
                    "subscribe": true,
                    "comment": "双向位置交换"
                }
            },
            "force_decomposition": {
                "precompute_inverse": true,
                "regularization": 0.001,
                "comment": "预计算(AAᵀ)⁻¹以提高效率"
            },
            "rigid_body_dynamics": {
                "mode": "external",
                "comment": "刚体动力学由MuJoCo主导"
            }
        },
        "shared_modules": {
            "spring_force": {
                "apply_spring_forces": true,
                "auto_tune": true,
                "natural_frequency_hz": 0.2,
                "damping_ratio": 0.7,
                "linear_spring_stiffness": 1000.0,
                "linear_damping_coefficient": 50.0,
                "angular_spring_stiffness": 40.0,
                "angular_damping_coefficient": 2.0,
                "max_spring_force": 5000.0,
                "max_spring_torque": 200.0,
                "position_deadzone": 0.0001,
                "rotation_deadzone": 0.001,
                "estimate_remote_velocity": true,
                "velocity_filter_alpha": 0.3,
                "comment": "SpringForceModule 配置：可被 SpringConstraintMode 和 MultiPointForceMode 共享使用",
                "apply_spring_forces_comment": "[弹簧力开关] 是否应用弹簧力到刚体。true=应用弹簧力(正常耦合模式); false=不应用弹簧力(仅测试浮力)",
                "usage_scenarios_comment": "===== 使用场景 ===== (1)正常多物理场耦合: apply_spring_forces=true (2)测试SPH浮力: apply_spring_forces=false"
            },
            "gravity": {
                "enable_rigid_body_gravity": false,
                "enable_rigid_body_collision": false,
                "anchor_particle_mass_ratio": 1.0,
                "comment": "GravityModule 配置：可被 SpringConstraintMode 和 MultiPointForceMode 共享使用",
                "enable_rigid_body_gravity_comment": "[重力开关] true=SPH处理刚体重力; false=移除重力交给MuJoCo处理。正常多物理场耦合使用false",
                "enable_rigid_body_collision_comment": "[碰撞开关] true=SPH处理刚体碰撞; false=禁用碰撞交给MuJoCo处理。推荐false避免双重碰撞",
                "anchor_particle_mass_ratio_comment": "[质量分配] 锚点粒子总质量与等效刚体质量的比例。系统保持总质量守恒：M_total = M_rb_effective + M_particles。ratio=1.0时刚体和锚点各占50%"
            },
            "force_clamping": {
                "enabled": true,
                "rigid_body": {
                    "enabled": true,
                    "max_acceleration_g": 10.0,
                    "discard_on_clamp": true,
                    "comment": "刚体总力截断：超过10G的力将被丢弃（不传输）"
                },
                "debug": {
                    "log_clamped_forces": true,
                    "log_threshold_n": 1000.0,
                    "comment": "调试选项：记录被截断丢弃的力"
                },
                "comment": "ForceCollectionModule 配置：可被 ForcePositionMode 和其他模式共享使用",
                "comment_deprecated": "单粒子力截断已废弃，现在仅对刚体总力进行截断和丢弃处理"
            }
        }
    },
    "physics": {
        "gravity": [0, 0, -9.81],
        "linear_damping": 0.01,
        "angular_damping": 0.01,
        "enable_debug_output": false,
        "physics_dt": 0.001
    },
    "particle_render": {
        "grpc": {
            "server_address": "localhost:50251",
            "enabled": false,
            "update_rate_hz": 20,
            "realtime_sync": true,
            "compression": {
                "enabled": false,
                "show_stats": false
            },
            "quantization": {
                "enabled": true
            },
            "transmission_mode": "particle_frame"
        },
        "voxel_grid": {
            "width": 128,
            "height": 128,
            "depth": 128,
            "voxel_size_ratio": 1.0,
            "origin": {
                "x": 0.0,
                "y": 0.0,
                "z": 0.0
            },
            "data_mode": "density_velocity",
            "velocity": {
                "max_speed": 5.0,
                "enabled": true
            },
            "statistics": {
                "enabled": false
            }
        },
        "particle_frame": {
            "grid_resolution": {
                "x": 512,
                "y": 512,
                "z": 512
            },
            "voxel_size_ratio": 1.0,
            "ip_frame": {
                "i_frame_interval": 30,
                "position_threshold": 2,
                "velocity_threshold": 5,
                "change_ratio_threshold": 0.5
            }
        }
    },
    "statistics": {
        "print_interval_sec": 1,
        "window_size_sec": 1,
        "print_physics_state": true
    },
    "debug": {
        "verbose_logging": true,
        "enable_spring_force_stats": true,
        "visualize_anchor_particles": true,
        "visualize_target_positions": true,
        "visualize_spring_connections": true,
        "anchor_particle_size": 0.02,
        "target_position_size": 0.015,
        "comment": "可视化选项：verbose_logging 启用/禁用详细日志输出；enable_spring_force_stats 启用/禁用弹簧力统计和打印（每1秒）；visualize_* 控制锚点粒子可视化"
    }
}
