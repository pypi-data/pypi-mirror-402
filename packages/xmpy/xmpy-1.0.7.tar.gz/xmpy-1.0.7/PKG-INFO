Metadata-Version: 2.4
Name: xmpy
Version: 1.0.7
Summary: ä¸“ä¸ºä¸­æ–‡æ¯è¯­å¼€å‘è€…æ‰“é€ çš„é‡åŒ–äº¤æ˜“ç ”å‘æ¡†æ¶ã€‚
Project-URL: Homepage, https://github.com/InkAbyss/xmpy
Project-URL: Issues, https://github.com/InkAbyss/xmpy/issues
Author-email: bhzy <2024305928@qq.com>
License: MIT
License-File: LICENSE
Keywords: algotrading,investment,quant,quantitative,trading
Classifier: Development Status :: 5 - Production/Stable
Classifier: License :: OSI Approved :: MIT License
Classifier: Natural Language :: Chinese (Simplified)
Classifier: Operating System :: MacOS
Classifier: Operating System :: Microsoft :: Windows
Classifier: Operating System :: POSIX :: Linux
Classifier: Programming Language :: Python :: 3
Classifier: Programming Language :: Python :: 3.10
Classifier: Programming Language :: Python :: 3.11
Classifier: Programming Language :: Python :: 3.12
Classifier: Programming Language :: Python :: 3.13
Classifier: Programming Language :: Python :: Implementation :: CPython
Classifier: Topic :: Office/Business :: Financial :: Investment
Classifier: Typing :: Typed
Requires-Python: >=3.10
Requires-Dist: bs4>=0.0.2
Requires-Dist: deap>=1.4.3
Requires-Dist: numpy>=2.2.3
Requires-Dist: pandas>=2.2.2
Requires-Dist: plotly>=6.2.0
Requires-Dist: requests>=2.32.5
Requires-Dist: ta-lib>=0.6.0
Requires-Dist: tqdm>=4.67.1
Requires-Dist: tzlocal>=5.3
Requires-Dist: xmpy-ctastrategy>=1.0.0
Requires-Dist: xmpy-ctp>=1.0.0
Requires-Dist: xmpy-datarecorder>=1.0.0
Requires-Dist: xmpy-sqlite>=1.0.0
Description-Content-Type: text/markdown

# xmpyé‡åŒ–æ¡†æ¶

xmpyâ€”â€” ä¸“ä¸ºä¸­æ–‡æ¯è¯­å¼€å‘è€…æ‰“é€ çš„é‡åŒ–äº¤æ˜“ç ”å‘æ¡†æ¶ã€‚

## ğŸ“– é¡¹ç›®èƒŒæ™¯

åˆè¡·ï¼šæœ€åˆæ˜¯ä¸ºäº†ç¼–å†™ä¸€ä¸ªäº¤æ˜“ç­–ç•¥ï¼Œåœ¨å¯¹æ¯”å¤šä¸ªæ¡†æ¶åé€‰æ‹©äº†[vnpy](https://github.com/vnpy/vnpy)ã€‚å…¶æ–‡æ¡£è¯¦å°½ï¼Œä½†å…¥é—¨ä»éœ€è¾ƒé•¿æ—¶é—´é˜…è¯»æ–‡æ¡£å’Œæºç ã€‚è€ƒè™‘åˆ°æˆ‘æ— éœ€å›¾å½¢åŒ–ç•Œé¢ï¼Œå¹¶å¸Œæœ›ä»¥ä¸­æ–‡æå‡åç»­ç­–ç•¥å¼€å‘ä¸ç»´æŠ¤çš„å‹å¥½æ€§ï¼Œå†³å®šåŸºäºexamples/no_ui/run.pyè¿›è¡Œå…¨é¢ä¸­æ–‡é‡æ„ã€‚

ä¸ºæ»¡è¶³ä¸­æ–‡å¼€å‘è€…å¯¹ä»£ç å¯è¯»æ€§ä¸å¯ç»´æŠ¤æ€§çš„éœ€æ±‚ï¼Œæœ¬é¡¹ç›®ä»¥[vnpy-3.9.4](https://github.com/vnpy/vnpy/tree/3.9.4)ä¸ºåŸºç¡€ï¼Œè¿›è¡Œäº†å…¨é¢ä¼˜åŒ–ä¸é‡æ„ã€‚

## æ¥å£
* [CTPï¼ˆctpï¼‰](https://github.com/InkAbyss/xmpy_ctp)ï¼šå›½å†…æœŸè´§ã€æœŸæƒ

* TTS_CTPï¼šopenctpï¼Œæä¾›å›½å†…æœŸè´§ï¼ˆä»¿çœŸï¼‰ï¼Œ7*24å°æ—¶æ•°æ®ï¼ˆæš‚æœªä¸Šä¼ ï¼‰

## åº”ç”¨
* [xmpy_ctastrategy](https://github.com/InkAbyss/xmpy_ctastrategy)ï¼šCTAç­–ç•¥å¼•æ“æ¨¡å—

* [xmpy_datarecorder](https://github.com/InkAbyss/xmpy_datarecorder)ï¼šè¡Œæƒ…è®°å½•æ¨¡å—
* [æ¨¡å—_å›æµ‹å¼•æ“](https://github.com/InkAbyss/xmpy_ctastrategy/blob/main/xmpy_ctastrategy/æ¨¡å—_å›æµ‹å¼•æ“.py)ï¼šå›æµ‹æ¨¡å—

## æ•°æ®åº“æ¥å£
* [xmpy_sqlite](https://github.com/InkAbyss/xmpy_sqlite)ï¼šè½»é‡çº§å•æ–‡ä»¶æ•°æ®åº“ï¼Œæ— éœ€å®‰è£…å’Œé…ç½®æ•°æ®æœåŠ¡ç¨‹åº

## å®‰è£…
```
1ï¼Œéœ€è¦å…ˆå®‰è£…ta-lib
pip install TA-Lib

å®‰è£…å¤±è´¥ï¼Œå¯ä¸‹è½½ta-libå®‰è£…åŒ…æ–‡ä»¶å¤¹ä¸­çš„whlæ–‡ä»¶
pip install .\ta_lib-0.6.0-cp312-cp312-win_amd64.whl

2ï¼Œå®‰è£…xmpy
pip install xmpy
```
## ä½¿ç”¨
1ï¼Œåœ¨[SimNow](https://www.simnow.com.cn)æ³¨å†ŒCTPä»¿çœŸè´¦å·ï¼Œå¹¶åœ¨è¯¥é¡µé¢è·å–ç»çºªå•†ä»£ç ä»¥åŠäº¤æ˜“è¡Œæƒ…æœåŠ¡å™¨åœ°å€ã€‚

2ï¼Œåœ¨ä»»æ„ç›®å½•ä¸‹åˆ›å»ºrun.pyï¼Œå†™å…¥ä»¥ä¸‹ç¤ºä¾‹ä»£ç ï¼š
```
# è¿è¡Œå•ä¸ªç­–ç•¥
# è¿è¡Œæ‰€æœ‰ç­–ç•¥çš„ç¤ºä¾‹ä»£ç åœ¨æœ¬é¡¹ç›®githubä¸‹ï¼šè¿è¡Œç¤ºä¾‹ æ–‡ä»¶å¤¹

import multiprocessing
import sys
from time import sleep
from datetime import datetime, time
from logging import INFO

from xmpy.åŒ…_äº‹ä»¶å¼•æ“ import ç±»_äº‹ä»¶å¼•æ“
from xmpy.åŒ…_äº¤æ˜“æ ¸å¿ƒ.æ¨¡å—_è®¾ç½® import å…¨å±€è®¾ç½®
from xmpy.åŒ…_äº¤æ˜“æ ¸å¿ƒ.æ¨¡å—_ä¸»å¼•æ“ import ç±»_ä¸»å¼•æ“
from xmpy_ctp import ç±»_CTPç½‘å…³

from xmpy_ctastrategy import ç±»_CTAç­–ç•¥åº”ç”¨
from xmpy_ctastrategy.æ¨¡å—_åŸºç¡€ import äº‹ä»¶ç±»å‹_CTAæ—¥å¿—


å…¨å±€è®¾ç½®["æ—¥å¿—.å¯ç”¨"] = True
å…¨å±€è®¾ç½®["æ—¥å¿—.çº§åˆ«"] = INFO
å…¨å±€è®¾ç½®["æ—¥å¿—.æ§åˆ¶å°"] = True

ctp_è®¾ç½® = {
    "ç”¨æˆ·å": "",
    "å¯†ç ": "",
    "ç»çºªå•†ä»£ç ": "",
    "äº¤æ˜“æœåŠ¡å™¨": "",
    "è¡Œæƒ…æœåŠ¡å™¨": "",
    "äº§å“åç§°": "",
    "æˆæƒç¼–ç ": "",
    "äº§å“ä¿¡æ¯": ""
}

# ç­–ç•¥é…ç½®åˆ—è¡¨ï¼ˆå¯æ‰©å±•æ·»åŠ å¤šä¸ªç­–ç•¥ï¼‰
ç­–ç•¥é…ç½®åˆ—è¡¨ = [
    {
        "ç­–ç•¥ç±»å": "ç­–ç•¥_1_åŸºç¡€æ•™ç¨‹",
        "ç­–ç•¥åç§°": "ç¤ºä¾‹ç­–ç•¥",
        "åˆçº¦æ ‡è¯†": "c2509.å¤§å•†æ‰€",
        "å‚æ•°è®¾ç½®": {
            "åˆå§‹æ‰‹æ•°": 1
        }
    }
]

# ä¸­å›½æœŸè´§å¸‚åœºäº¤æ˜“æ—¶æ®µï¼ˆæ—¥ç›˜/å¤œç›˜ï¼‰
æ—¥ç›˜å¼€å§‹æ—¶é—´ = time(8, 45)
æ—¥ç›˜ç»“æŸæ—¶é—´ = time(15, 0)

å¤œç›˜å¼€å§‹æ—¶é—´ = time(20, 45)
å¤œç›˜ç»“æŸæ—¶é—´ = time(2, 45)


def æ£€æŸ¥äº¤æ˜“æ—¶æ®µ():
    """æ£€æŸ¥æ˜¯å¦åœ¨äº¤æ˜“æ—¶æ®µå†…"""
    å½“å‰æ—¶é—´ = datetime.now().time()

    æ˜¯å¦äº¤æ˜“æ—¶æ®µ = False
    if (
            (å½“å‰æ—¶é—´ >= æ—¥ç›˜å¼€å§‹æ—¶é—´ and å½“å‰æ—¶é—´ <= æ—¥ç›˜ç»“æŸæ—¶é—´)
            or (å½“å‰æ—¶é—´ >= å¤œç›˜å¼€å§‹æ—¶é—´)
            or (å½“å‰æ—¶é—´ <= å¤œç›˜ç»“æŸæ—¶é—´)
    ):
        æ˜¯å¦äº¤æ˜“æ—¶æ®µ = True

    return æ˜¯å¦äº¤æ˜“æ—¶æ®µ


def è¿è¡Œå­è¿›ç¨‹():
    """åœ¨å­è¿›ç¨‹ä¸­è¿è¡Œçš„ä¸šåŠ¡é€»è¾‘"""
    å…¨å±€è®¾ç½®["æ—¥å¿—.æ–‡ä»¶"] = True

    # åˆ›å»ºäº‹ä»¶å¼•æ“
    äº‹ä»¶å¼•æ“ = ç±»_äº‹ä»¶å¼•æ“()

    # åˆ›å»ºä¸»å¼•æ“
    ä¸»å¼•æ“ = ç±»_ä¸»å¼•æ“(äº‹ä»¶å¼•æ“)
    ç½‘å…³ = ä¸»å¼•æ“.æ·»åŠ ç½‘å…³(ç±»_CTPç½‘å…³)

    # æ·»åŠ CTAåº”ç”¨
    CTAå¼•æ“ = ä¸»å¼•æ“.æ·»åŠ åº”ç”¨(ç±»_CTAç­–ç•¥åº”ç”¨)
    ä¸»å¼•æ“.è®°å½•æ—¥å¿—("ä¸»å¼•æ“åˆ›å»ºæˆåŠŸ")

    # è¿æ¥CTPæ¥å£
    ä¸»å¼•æ“.è¿æ¥ç½‘å…³(ctp_è®¾ç½®, "CTP")
    ä¸»å¼•æ“.è®°å½•æ—¥å¿—("è¿æ¥CTPæ¥å£")
    
    while not ç½‘å…³.äº¤æ˜“æ¥å£.åˆçº¦å°±ç»ª:
        sleep(1)

    # åˆå§‹åŒ–CTAå¼•æ“
    CTAå¼•æ“.åˆå§‹åŒ–å¼•æ“()
    ä¸»å¼•æ“.è®°å½•æ—¥å¿—("CTAç­–ç•¥å¼•æ“åˆå§‹åŒ–å®Œæˆ")

    # å¾ªç¯å¤„ç†æ‰€æœ‰ç­–ç•¥é…ç½®
    for ç­–ç•¥é…ç½® in ç­–ç•¥é…ç½®åˆ—è¡¨:
        ç­–ç•¥åç§° = ç­–ç•¥é…ç½®["ç­–ç•¥åç§°"]

        if ç­–ç•¥åç§° not in CTAå¼•æ“.æ‰€æœ‰ç­–ç•¥:
            ä¸»å¼•æ“.è®°å½•æ—¥å¿—(f"åˆ›å»ºç­–ç•¥ï¼š{ç­–ç•¥åç§°}")
            CTAå¼•æ“.æ·»åŠ ç­–ç•¥(
                ç±»å=ç­–ç•¥é…ç½®["ç­–ç•¥ç±»å"],
                ç­–ç•¥åç§°=ç­–ç•¥åç§°,
                åˆçº¦æ ‡è¯†=ç­–ç•¥é…ç½®["åˆçº¦æ ‡è¯†"],
                é…ç½®å­—å…¸=ç­–ç•¥é…ç½®["å‚æ•°è®¾ç½®"]
            )
            # åˆå§‹åŒ–ç­–ç•¥
            CTAå¼•æ“.åˆå§‹åŒ–ç­–ç•¥(ç­–ç•¥åç§°)
            sleep(5)
            CTAå¼•æ“.å¯åŠ¨ç­–ç•¥(ç­–ç•¥åç§°)
        else:
            ä¸»å¼•æ“.è®°å½•æ—¥å¿—(f"æ›´æ–°ç­–ç•¥å‚æ•°ï¼š{ç­–ç•¥åç§°}")
            CTAå¼•æ“.æ›´æ–°ç­–ç•¥é…ç½®(ç­–ç•¥åç§°=ç­–ç•¥åç§°,é…ç½®å­—å…¸=ç­–ç•¥é…ç½®["å‚æ•°è®¾ç½®"])
            # åˆå§‹åŒ–ç­–ç•¥
            CTAå¼•æ“.åˆå§‹åŒ–ç­–ç•¥(ç­–ç•¥åç§°)
            sleep(5)
            CTAå¼•æ“.å¯åŠ¨ç­–ç•¥(ç­–ç•¥åç§°)

    # æŒç»­è¿è¡Œæ£€æŸ¥
    while True:
        sleep(10)

        # æ£€æŸ¥äº¤æ˜“æ—¶æ®µ
        æ˜¯å¦äº¤æ˜“æ—¶æ®µ = æ£€æŸ¥äº¤æ˜“æ—¶æ®µ()
        if not æ˜¯å¦äº¤æ˜“æ—¶æ®µ:
            print("å…³é—­å­è¿›ç¨‹")
            ä¸»å¼•æ“.å…³é—­()
            sys.exit(0)


def è¿è¡Œçˆ¶è¿›ç¨‹():
    """åœ¨çˆ¶è¿›ç¨‹ä¸­è¿è¡Œçš„å®ˆæŠ¤é€»è¾‘"""
    print("å¯åŠ¨CTAç­–ç•¥å®ˆæŠ¤çˆ¶è¿›ç¨‹")

    å­è¿›ç¨‹ = None

    while True:
        # æŒç»­æ£€æŸ¥äº¤æ˜“æ—¶æ®µ
        æ˜¯å¦äº¤æ˜“æ—¶æ®µ = æ£€æŸ¥äº¤æ˜“æ—¶æ®µ()

        # äº¤æ˜“æ—¶æ®µå¯åŠ¨å­è¿›ç¨‹
        if æ˜¯å¦äº¤æ˜“æ—¶æ®µ and å­è¿›ç¨‹ is None:
            print("å¯åŠ¨å­è¿›ç¨‹")
            å­è¿›ç¨‹ = multiprocessing.Process(target=è¿è¡Œå­è¿›ç¨‹)
            å­è¿›ç¨‹.start()
            print("å­è¿›ç¨‹å¯åŠ¨æˆåŠŸ")

        # éäº¤æ˜“æ—¶æ®µå…³é—­å­è¿›ç¨‹
        if not æ˜¯å¦äº¤æ˜“æ—¶æ®µ and å­è¿›ç¨‹ is not None:
            if not å­è¿›ç¨‹.is_alive():
                å­è¿›ç¨‹ = None
                print("å­è¿›ç¨‹å…³é—­æˆåŠŸ")

        sleep(5)


if __name__ == "__main__":
    è¿è¡Œçˆ¶è¿›ç¨‹()
```

### å¼€å‘è¿›åº¦çœ‹æ¿

| æ¨¡å—        | è¿›åº¦   | é¢„è®¡å®Œæˆæ—¶é—´ |
|:----------| :----- | :----------- |
| äº‹ä»¶å¼•æ“      | âœ… 100% | å·²å‘å¸ƒ       |
| ä¸»å¼•æ“       | âœ… 100% | å·²å‘å¸ƒ       |
| CTAè‡ªåŠ¨äº¤æ˜“æ¨¡å— | âœ… 100% | å·²å‘å¸ƒ       |
| CTPæ¥å£     | âœ… 100% | å·²å‘å¸ƒ       |
| å›æµ‹å¼•æ“      | âœ… 100% | å·²å‘å¸ƒ       |
| æ•°æ®è®°å½•      | âœ… 100% | å·²å‘å¸ƒ       |

## ğŸ¤ è´¡çŒ®æŒ‡å—

æ¬¢è¿æäº¤ä¸­æ–‡å‘½åçš„ï¼š

- ğŸ“ æ–‡æ¡£ç¿»è¯‘
- ğŸ› Bugä¿®å¤
- ğŸ¯ åŠŸèƒ½å¢å¼º
