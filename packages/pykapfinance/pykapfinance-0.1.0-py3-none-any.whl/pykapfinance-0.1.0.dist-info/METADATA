Metadata-Version: 2.4
Name: pykapfinance
Version: 0.1.0
Summary: Python client library for KAP (Kamuyu AydÄ±nlatma Platformu) API
Home-page: https://github.com/cagrigungor/pykap
Author: Ã‡aÄŸrÄ± GÃ¼ngÃ¶r
Author-email: Ã‡aÄŸrÄ± GÃ¼ngÃ¶r <iletisim@cagrigor.com>
Project-URL: Homepage, https://github.com/cagrigungor/pykap
Project-URL: Bug Reports, https://github.com/cagrigungor/pykap/issues
Project-URL: Documentation, https://github.com/cagrigungor/pykap/blob/main/README.md
Project-URL: Source, https://github.com/cagrigungor/pykap
Classifier: Development Status :: 4 - Beta
Classifier: Intended Audience :: Developers
Classifier: Intended Audience :: Financial and Insurance Industry
Classifier: Topic :: Office/Business :: Financial
Classifier: Topic :: Software Development :: Libraries :: Python Modules
Classifier: License :: OSI Approved :: MIT License
Classifier: Programming Language :: Python :: 3
Classifier: Programming Language :: Python :: 3.7
Classifier: Programming Language :: Python :: 3.8
Classifier: Programming Language :: Python :: 3.9
Classifier: Programming Language :: Python :: 3.10
Classifier: Programming Language :: Python :: 3.11
Requires-Python: >=3.7
Description-Content-Type: text/markdown
License-File: LICENSE
Requires-Dist: requests>=2.28.0
Dynamic: author
Dynamic: home-page
Dynamic: license-file
Dynamic: requires-python

# PyKAP - Python KAP API KÃ¼tÃ¼phanesi

PyKAP, TÃ¼rkiye'nin Kamuyu AydÄ±nlatma Platformu (KAP) API'si iÃ§in kapsamlÄ± bir Python istemci kÃ¼tÃ¼phanesidir.

## ğŸš€ Ã–zellikler

PyKAP, KAP API'sinin tÃ¼m servislerini destekler:

- âœ… **Token YÃ¶netimi**: Otomatik token oluÅŸturma ve yenileme
- ğŸ“° **Bildirim Servisleri**: Bildirimleri listeleme, detay gÃ¶rÃ¼ntÃ¼leme, ek dosya indirme
- ğŸ¢ **Åirket Bilgileri**: Åirket listesi, detaylarÄ± ve menkul kÄ±ymet bilgileri
- ğŸ’° **Fon Bilgileri**: Fon listesi ve detaylÄ± fon bilgileri
- ğŸ”’ **BloklanmÄ±ÅŸ Bildirimler**: EriÅŸime kapatÄ±lmÄ±ÅŸ bildirimleri gÃ¶rÃ¼ntÃ¼leme
- ğŸ“Š **Hak KullanÄ±m**: Kurumsal iÅŸlem sÃ¼reÃ§ durumlarÄ±
- ğŸ” **GeliÅŸmiÅŸ Arama**: Åirket koduna gÃ¶re arama ve filtreleme

## ğŸ“¦ Kurulum

```bash
pip install -r requirements.txt
```

GeliÅŸtirme kurulumu iÃ§in:

```bash
pip install -e .
```

## ğŸ¯ HÄ±zlÄ± BaÅŸlangÄ±Ã§

### Temel KullanÄ±m

```python
from pykap import KAPClient

# Test ortamÄ± iÃ§in istemci oluÅŸturma (varsayÄ±lan API key ile)
client = KAPClient(test_mode=True)

# Åirket listesini alma
companies = client.get_members()
print(f"Toplam {len(companies)} ÅŸirket bulundu")

# Son bildirim indeksini Ã¶ÄŸrenme
last_index = client.get_last_disclosure_index()
print(f"Son bildirim indeksi: {last_index}")

# Bildirimleri listeleme
disclosures = client.get_disclosures(
    disclosure_index=last_index - 50,
    disclosure_type="ODA"  # Ã–zel Durum AÃ§Ä±klamalarÄ±
)

for disclosure in disclosures:
    print(f"{disclosure.title} - {disclosure.disclosure_index}")
```

### Kendi API AnahtarlarÄ±nÄ±zÄ± Kullanma

Kendi API key ve secret bilgilerinizle:

```python
from pykap import KAPClient

# Ã–zel API anahtarlarÄ± ile
client = KAPClient(
    test_mode=True,
    api_key="your-api-key-here",
    api_secret="your-api-secret-here"
)

# Ya da config dosyasÄ±ndan
from config import API_KEY, API_SECRET

client = KAPClient(
    test_mode=True,
    api_key=API_KEY,
    api_secret=API_SECRET
)
```

### Ãœretim OrtamÄ± KullanÄ±mÄ±

Ãœretim ortamÄ±nda token gereklidir:

```python
# Ãœretim ortamÄ± iÃ§in istemci
client = KAPClient(
    test_mode=False,
    api_key="your-api-key",
    api_secret="your-api-secret",
    auto_refresh_token=True
)

# Token otomatik olarak oluÅŸturulur ve yenilenir
# Manuel token oluÅŸturmak iÃ§in:
token = client.generate_token()
print(f"Token: {token}")
```

### Bildirim DetayÄ± ve Ek Ä°ndirme

```python
# Bildirim detayÄ±nÄ± alma
detail = client.get_disclosure_detail(
    disclosure_index=1211180,
    file_type="data"  # 'html' veya 'data'
)

print(f"Konu: {detail.subject.tr}")
print(f"Ã–zet: {detail.summary.tr}")
print(f"YayÄ±n ZamanÄ±: {detail.time}")

# Ek dosyalarÄ± indirme
if detail.attachment_urls:
    for attachment in detail.attachment_urls:
        print(f"Ä°ndiriliyor: {attachment.file_name}")
        
        # URL'den attachment ID'yi Ã§Ä±kar
        attachment_id = attachment.url.split('/')[-1]
        file_content = client.download_attachment(attachment_id)
        
        # DosyayÄ± kaydet
        with open(attachment.file_name, 'wb') as f:
            f.write(file_content)
```

### Åirket Bilgileri

```python
# Hisse koduna gÃ¶re ÅŸirket bulma
company = client.get_company_by_stock_code("THYAO")
if company:
    print(f"Åirket: {company.title}")
    print(f"ID: {company.id}")
    print(f"Tip: {company.member_type}")

# Åirket detaylarÄ±nÄ± alma
detail = client.get_member_detail(company.id)
print(detail)

# Åirketlerin menkul kÄ±ymet bilgileri
securities = client.get_member_securities()
for item in securities[:5]:
    print(f"{item.member.sirket_unvan}:")
    for security in item.securities:
        print(f"  - {security.isin_desc} ({security.borsa_kodu})")
```

### Belirli Bir Åirkete Ait Bildirimleri Arama

```python
# Åirket bildirimlerini arama
company = client.get_company_by_stock_code("THYAO")
if company:
    disclosures = client.search_disclosures_by_company(
        company_id=company.id,
        disclosure_type="ODA"
    )
    
    for disclosure in disclosures[:10]:
        print(f"{disclosure.title}")
```

### Fon Bilgileri

```python
# Aktif fonlarÄ± listeleme
funds = client.get_funds(fund_state=["Y"])  # Y=Aktif

for fund in funds[:10]:
    print(f"{fund.fund_name} ({fund.fund_code})")
    print(f"  Tip: {fund.fund_type}")
    print(f"  Durum: {fund.fund_state}")

# Fon detayÄ±
fund_detail = client.get_fund_detail(fund_id=4282)
print(fund_detail)
```

### BloklanmÄ±ÅŸ Bildirimler

```python
# EriÅŸime kapatÄ±lmÄ±ÅŸ bildirimleri listeleme
blocked = client.get_blocked_disclosures()

for item in blocked:
    print(f"Bildirim ID: {item.disclosure_index}")
    print(f"Tip: {item.blocked_type}")
    print(f"Neden: {item.is_blocked_description_tr}")
```

### Hak KullanÄ±m SÃ¼reÃ§ Durumu

```python
# Kurumsal iÅŸlem durumlarÄ±nÄ± sorgulama
statuses = client.get_ca_event_status(process_ref_ids=[12941, 13214])

for status in statuses:
    print(f"SÃ¼reÃ§ ID: {status.ref_id}")
    print(f"Durum: {status.status_text}")
    if status.complete_date:
        print(f"Tamamlanma: {status.complete_date}")
```

### Context Manager KullanÄ±mÄ±

```python
# Otomatik kaynak yÃ¶netimi
with KAPClient(test_mode=True) as client:
    companies = client.get_members()
    print(f"{len(companies)} ÅŸirket bulundu")
    # Client otomatik olarak kapatÄ±lÄ±r
```

## ğŸ“š Bildirim Tipleri ve SÄ±nÄ±flarÄ±

### Bildirim SÄ±nÄ±flarÄ± (DisclosureClass)

```python
from pykap.models import DisclosureClass

# FR - Finansal Rapor Bildirimi
# ODA - Ã–zel Durum AÃ§Ä±klamasÄ± Bildirimi
# DG - DiÄŸer Bildirim
# DUY - DÃ¼zenleyici Kurum Bildirimi

disclosures = client.get_disclosures(
    disclosure_index=1000000,
    disclosure_class=DisclosureClass.FR
)
```

### Bildirim Tipleri (DisclosureType)

```python
from pykap.models import DisclosureType

# FR - Finansal Rapor
# ODA - Ã–zel Durum AÃ§Ä±klamasÄ±
# DG - DiÄŸer
# DUY - DÃ¼zenleyici Kurum
# FON - Fon Bildirimi
# CA - Hak KullanÄ±m Bildirimi

disclosures = client.get_disclosures(
    disclosure_index=1000000,
    disclosure_type=DisclosureType.ODA
)
```

### Åirket Tipleri (MemberType)

```python
from pykap.models import MemberType

# IGS - Ä°ÅŸlem GÃ¶ren Åirket
# IGMS - Ä°ÅŸlem GÃ¶rmeyen Åirket
# YK - YatÄ±rÄ±m KuruluÅŸu
# PYS - PortfÃ¶y YÃ¶netim Åirketi
# FK - Fon Kurucu
# Ve daha fazlasÄ±...
```

## ğŸ”§ GeliÅŸmiÅŸ KullanÄ±m

### Ã–zel Filtreleme

```python
# Belirli bir dÃ¶nem iÃ§in bildirimleri alma
start_index = 1200000
end_index = 1200100

all_disclosures = []
current_index = start_index

while current_index < end_index:
    batch = client.get_disclosures(
        disclosure_index=current_index,
        disclosure_class="FR"
    )
    all_disclosures.extend(batch)
    
    if batch:
        # Sonraki batch iÃ§in index gÃ¼ncelle
        current_index = int(batch[-1].disclosure_index) + 1
    else:
        break

print(f"Toplam {len(all_disclosures)} bildirim bulundu")
```

### Hata YÃ¶netimi

```python
from pykap.exceptions import (
    KAPAuthenticationError,
    KAPAPIError,
    KAPValidationError
)

try:
    # GeÃ§ersiz index
    disclosures = client.get_disclosures(disclosure_index=100)
    
except KAPValidationError as e:
    print(f"GeÃ§ersiz parametre: {e}")
    
except KAPAuthenticationError as e:
    print(f"Kimlik doÄŸrulama hatasÄ±: {e}")
    
except KAPAPIError as e:
    print(f"API HatasÄ±: {e}")
    print(f"Hata Kodu: {e.error_code}")
    print(f"HTTP Durum: {e.status_code}")
```

## ğŸ“– API ReferansÄ±

### KAPClient MetodlarÄ±

#### Token YÃ¶netimi
- `generate_token()` - Yeni token oluÅŸtur (Ã¼retim ortamÄ±)

#### Bildirim Servisleri
- `get_disclosures(disclosure_index, disclosure_type, disclosure_class, company_id)` - Bildirim listesi
- `get_disclosure_detail(disclosure_index, file_type, sub_report_list)` - Bildirim detayÄ±
- `download_attachment(attachment_id)` - Ek dosya indir
- `get_last_disclosure_index()` - Son bildirim indeksi

#### Åirket Servisleri
- `get_members()` - TÃ¼m ÅŸirketler
- `get_member_detail(member_id)` - Åirket detayÄ±
- `get_member_securities()` - Menkul kÄ±ymet bilgileri
- `get_company_by_stock_code(stock_code)` - Hisse koduna gÃ¶re ÅŸirket bul

#### Fon Servisleri
- `get_funds(fund_state, fund_class, fund_type)` - Fon listesi
- `get_fund_detail(fund_id)` - Fon detayÄ±

#### DiÄŸer Servisler
- `get_blocked_disclosures()` - BloklanmÄ±ÅŸ bildirimler
- `get_ca_event_status(process_ref_ids)` - Hak kullanÄ±m durumu
- `search_disclosures_by_company(company_id, start_index, disclosure_type)` - Åirket bildirimlerini ara

## ğŸ—ï¸ Proje YapÄ±sÄ±

```
pykap/
â”œâ”€â”€ pykap/
â”‚   â”œâ”€â”€ __init__.py          # Paket baÅŸlatma
â”‚   â”œâ”€â”€ client.py            # Ana API istemcisi
â”‚   â”œâ”€â”€ models.py            # Veri modelleri
â”‚   â””â”€â”€ exceptions.py        # Ã–zel hatalar
â”œâ”€â”€ examples/
â”‚   â””â”€â”€ basic_usage.py       # KullanÄ±m Ã¶rnekleri
â”œâ”€â”€ setup.py                 # Kurulum dosyasÄ±
â”œâ”€â”€ requirements.txt         # BaÄŸÄ±mlÄ±lÄ±klar
â”œâ”€â”€ README.md               # Bu dosya
â””â”€â”€ LICENSE                 # Lisans
```

## ğŸ” Kimlik DoÄŸrulama

### API AnahtarlarÄ±

Kendi API anahtarlarÄ±nÄ±zÄ± kullanmak iÃ§in:

1. **config.py dosyasÄ±nÄ± dÃ¼zenleyin:**
```python
API_KEY = "sizin-api-key-buraya"
API_SECRET = "sizin-api-secret-buraya"
TEST_MODE = True
```

2. **DoÄŸrudan kod iÃ§inde kullanÄ±n:**
```python
client = KAPClient(
    test_mode=True,
    api_key="your-api-key",
    api_secret="your-api-secret"
)
```

### Test OrtamÄ±
Test ortamÄ±nda kimlik doÄŸrulama gerekmez (API key ile):

```python
client = KAPClient(
    test_mode=True,
    api_key="your-test-api-key"
)
```

### Ãœretim OrtamÄ±
Ãœretim ortamÄ±nda API Key ile token alÄ±nmalÄ±dÄ±r:

```python
client = KAPClient(
    test_mode=False,
    api_key="your-production-api-key",
    auto_refresh_token=True
)
# Token otomatik olarak yÃ¶netilir (24 saat geÃ§erli)
```

### VarsayÄ±lan API Key

API Key belirtilmezse, kÃ¼tÃ¼phane varsayÄ±lan deÄŸeri kullanÄ±r:
- VarsayÄ±lan: `29223dec-32bc-49fb-919f-51405d110ab2`

## âš ï¸ Ã–nemli Notlar

1. **Bildirim Ä°ndeksi**: disclosureIndex 538004'ten baÅŸlar. 84196-538004 arasÄ± KAP 4.0 Ã¶ncesi verilerdir.

2. **Token SÃ¼resi**: Ãœretim ortamÄ±nda token 24 saat geÃ§erlidir. `auto_refresh_token=True` ile otomatik yenilenir.

3. **EriÅŸime KapatÄ±lmÄ±ÅŸ Bildirimler**: KVKK nedeniyle bazÄ± bildirimler eriÅŸime kapatÄ±lmÄ±ÅŸtÄ±r. `get_blocked_disclosures()` ile listelenebilir.

4. **Rate Limiting**: API'ye aÅŸÄ±rÄ± istek gÃ¶ndermekten kaÃ§Ä±nÄ±n.

5. **Veri GÃ¼ncelliÄŸi**: API Ã¼zerinden alÄ±nan veriler geÃ§miÅŸ tarihli canlÄ± ortam verileridir ve gÃ¼ncel durumdan farklÄ±lÄ±k gÃ¶sterebilir.

## ğŸ¤ KatkÄ±da Bulunma

KatkÄ±lar memnuniyetle karÅŸÄ±lanÄ±r! LÃ¼tfen:

1. Fork yapÄ±n
2. Feature branch oluÅŸturun (`git checkout -b feature/amazing-feature`)
3. DeÄŸiÅŸikliklerinizi commit edin (`git commit -m 'Add amazing feature'`)
4. Branch'inizi push edin (`git push origin feature/amazing-feature`)
5. Pull Request oluÅŸturun

## ğŸ“ Lisans

Bu proje MIT lisansÄ± altÄ±nda lisanslanmÄ±ÅŸtÄ±r - detaylar iÃ§in [LICENSE](LICENSE) dosyasÄ±na bakÄ±n.

## ğŸ“ Ä°letiÅŸim

- **KAP Destek**: kapdestek@mkk.com.tr
- **KAP Ä°letiÅŸim**: https://www.mkk.com.tr/iletisim-formu
- **Sorumlu Kurum**: Kamuyu AydÄ±nlatma Hizmetleri DirektÃ¶rlÃ¼ÄŸÃ¼

## ğŸ”— FaydalÄ± BaÄŸlantÄ±lar

- [KAP Resmi Sitesi](https://www.kap.org.tr)
- [KAP API DokÃ¼mantasyonu](https://apigwdev.mkk.com.tr)
- [MKK Resmi Sitesi](https://www.mkk.com.tr)

## ğŸ“Š Hata KodlarÄ±

| Kod | AÃ§Ä±klama |
|-----|----------|
| ER001 | Servis eriÅŸim yetkiniz bulunmamaktadÄ±r |
| ER002 | Unauthorized request |
| ER003 | TanÄ±mlÄ± olmayan IP adresinden eriÅŸim |
| ER004 | Token geÃ§ersiz |
| ER005 | IP bilgisi doÄŸrulanamadÄ± |
| ER006 | GeÃ§ersiz token |
| ER007 | Token bilgisi doÄŸrulanamadÄ± |
| ER008 | Authorization token is not valid |

## ğŸ“ Ã–rnekler

Daha fazla Ã¶rnek iÃ§in [examples](examples/) klasÃ¶rÃ¼ne bakÄ±n.

## âš¡ Performans Ä°puÃ§larÄ±

1. Test ortamÄ±nÄ± geliÅŸtirme iÃ§in kullanÄ±n
2. Toplu sorgularda sayfalama kullanÄ±n
3. Token'Ä± Ã¶nbelleÄŸe alÄ±n (Ã¼retimde)
4. Context manager kullanÄ±n
5. Gereksiz detay sorgularÄ±ndan kaÃ§Ä±nÄ±n

## ğŸ”„ SÃ¼rÃ¼m GeÃ§miÅŸi

### v1.0.0 (2026-01-22)
- Ä°lk sÃ¼rÃ¼m
- TÃ¼m KAP API servisleri destekleniyor
- Test ve Ã¼retim ortamÄ± desteÄŸi
- Otomatik token yÃ¶netimi
- KapsamlÄ± hata yÃ¶netimi

---

**Not**: Bu kÃ¼tÃ¼phane resmi bir KAP/MKK Ã¼rÃ¼nÃ¼ deÄŸildir. BaÄŸÄ±msÄ±z bir aÃ§Ä±k kaynak projesidir.
