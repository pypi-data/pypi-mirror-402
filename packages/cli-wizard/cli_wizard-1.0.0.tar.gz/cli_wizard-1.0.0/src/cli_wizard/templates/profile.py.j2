# AUTO-GENERATED FILE - DO NOT EDIT
# Generated from OpenAPI specification by cli-wizard

"""Profile management for the generated CLI."""

from pathlib import Path
from typing import Any

import yaml

from .constants import PROFILE_FILE
from .logging import log_error, log_info, log_warning, log_debug


_current_profile: dict[str, Any] = {}
_profile_name: str = "default"


def load_profile(profile_name: str = "default") -> dict[str, Any]:
    """Load a profile from the profiles file.

    Args:
        profile_name: Name of the profile to load (default: "default")

    Returns:
        Profile settings as a dictionary, empty dict if profile not found
    """
    global _current_profile, _profile_name
    _profile_name = profile_name

    if not PROFILE_FILE.exists():
        log_warning(f"Profile file not found: {PROFILE_FILE}. Creating default profile file.")
        _create_default_profile_file()
        _current_profile = {}
        return _current_profile

    try:
        with open(PROFILE_FILE) as f:
            profiles = yaml.safe_load(f) or {}
    except (yaml.YAMLError, IOError) as e:
        log_error(f"Failed to load profile file: {e}")
        _current_profile = {}
        return _current_profile

    if profile_name not in profiles:
        log_error(f"Profile '{profile_name}' not found in {PROFILE_FILE}")
        _current_profile = {}
        return _current_profile

    _current_profile = profiles[profile_name] or {}
    log_debug(f"Loaded profile '{profile_name}'")
    return _current_profile


def _create_default_profile_file() -> None:
    """Create a default profile file with empty settings."""
    try:
        PROFILE_FILE.parent.mkdir(parents=True, exist_ok=True)
        default_content = {"default": {}}
        with open(PROFILE_FILE, "w") as f:
            yaml.safe_dump(default_content, f, default_flow_style=False)
        log_info(f"Created default profile file: {PROFILE_FILE}")
    except (IOError, OSError) as e:
        log_error(f"Failed to create default profile file: {e}")


def get_profile() -> dict[str, Any]:
    """Get the currently loaded profile settings."""
    return _current_profile


def get_profile_name() -> str:
    """Get the name of the currently loaded profile."""
    return _profile_name


def get_profile_value(key: str, default: Any = None) -> Any:
    """Get a value from the current profile.

    Args:
        key: The key to look up
        default: Default value if key not found

    Returns:
        The value from the profile, or default if not found
    """
    return _current_profile.get(key, default)
