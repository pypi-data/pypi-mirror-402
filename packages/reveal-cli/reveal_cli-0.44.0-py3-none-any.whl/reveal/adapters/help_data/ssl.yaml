# SSL Adapter Help Data
# SSL certificate inspection - progressive disclosure of cert health, chain, SANs

name: ssl
description: 'SSL certificate inspection - progressive disclosure of cert health, chain, and domains'
syntax: 'ssl://host[:port][/element]'

examples:
  # Single domain inspection
  - uri: 'ssl://example.com'
    description: 'Certificate overview (issuer, expiry, health status)'
  - uri: 'ssl://example.com:8443'
    description: 'Non-standard port'
  - uri: 'ssl://example.com/san'
    description: 'Subject Alternative Names (all domains covered)'
  - uri: 'ssl://example.com/chain'
    description: 'Certificate chain details'
  - uri: 'ssl://example.com/issuer'
    description: 'Issuer organization details'
  - uri: 'ssl://example.com --check'
    description: 'Run health checks (expiry, chain, hostname)'

  # Nginx SSL audit (composable pipeline - preferred)
  - uri: 'reveal nginx.conf --extract domains'
    description: 'Extract SSL domains from nginx config as ssl:// URIs'
  - uri: 'reveal nginx.conf --extract domains | reveal --stdin --check'
    description: 'Full SSL audit pipeline: extract → check'
  - uri: 'reveal nginx.conf --extract domains | reveal --stdin --check --only-failures'
    description: 'Show only failing/warning certs'
  - uri: 'reveal nginx.conf --extract domains | reveal --stdin --check --summary'
    description: 'Aggregate summary (counts only)'

  # Batch filtering
  - uri: 'reveal @domains.txt --check'
    description: 'Read ssl:// URIs from file (one per line)'
  - uri: 'echo -e "ssl://a.com\nssl://b.com" | reveal --stdin --check'
    description: 'Batch health check via stdin'
  - uri: 'reveal --stdin --check --expiring-within=30'
    description: 'Filter to certs expiring within 30 days'

  # Legacy nginx syntax (deprecated - prefer composable pipeline above)
  - uri: 'ssl://nginx:///etc/nginx/*.conf --check'
    description: 'DEPRECATED: Use composable pipeline instead (see examples above)'

elements:
  san: 'Subject Alternative Names (all domains covered by cert)'
  chain: 'Certificate chain information'
  issuer: 'Certificate issuer details'
  subject: 'Certificate subject details'
  dates: 'Certificate validity dates'
  full: 'Full certificate details (JSON)'

flags:
  --check: 'Run health checks (expiry, chain validity, hostname match)'
  --only-failures: 'Hide healthy certs, show only warnings and failures (batch mode)'
  --summary: 'Show aggregated counts instead of per-domain details (batch mode)'
  --expiring-within: 'Filter to certs expiring within N days (e.g., --expiring-within=30)'

features:
  - 'Zero dependencies (uses Python ssl module)'
  - 'Progressive disclosure (overview → element → detail)'
  - 'Health checks with exit codes (0=pass, 1=warning, 2=critical)'
  - 'Expiry thresholds: warning at 30 days, critical at 7 days'
  - 'Chain verification against system trust store'
  - 'Hostname match validation'
  - 'Token-efficient for AI agent consumption'
  - 'Batch processing via --stdin or @file (check multiple domains at once)'
  - 'Composable nginx pipeline: reveal nginx.conf --extract domains | reveal --stdin --check'
  - 'Filtering options for batch checks (--only-failures, --summary, --expiring-within)'

try_now:
  - "reveal ssl://google.com"
  - "reveal ssl://google.com/san"
  - "reveal ssl://google.com --check"

workflows:
  - name: 'Certificate Health Check'
    scenario: 'Need to quickly verify SSL certificate status'
    steps:
      - "reveal ssl://example.com            # Overview"
      - "reveal ssl://example.com --check    # Full health check"
      - "reveal ssl://example.com/san        # If checking domain coverage"
  - name: 'Debug SSL Issues'
    scenario: 'Certificate warnings in browser or app'
    steps:
      - "reveal ssl://example.com --check    # Identify the issue"
      - "reveal ssl://example.com/chain      # Check chain validity"
      - "reveal ssl://example.com/issuer     # Verify issuer"
  - name: 'Nginx SSL Audit'
    scenario: 'Audit all SSL certificates from nginx configuration'
    steps:
      - "reveal nginx.conf                   # See servers with SSL status"
      - "reveal nginx.conf --extract domains # List SSL domains as URIs"
      - "reveal nginx.conf --extract domains | reveal --stdin --check  # Full audit"
      - "reveal nginx.conf --extract domains | reveal --stdin --check --only-failures  # Problems only"
      - "reveal nginx.conf --extract domains | reveal --stdin --check --summary  # Quick summary"
  - name: 'Batch Certificate Audit'
    scenario: 'Check multiple domains from a file or stdin'
    steps:
      - "reveal @domains.txt --check                                 # Read ssl:// URIs from file"
      - "echo -e 'ssl://a.com\\nssl://b.com' | reveal --stdin --check  # From stdin"
      - "reveal --stdin --check --expiring-within=30 < domains.txt   # Expiring soon"

anti_patterns:
  - bad: "openssl s_client -connect example.com:443 | openssl x509 -text"
    good: "reveal ssl://example.com"
    why: "10x fewer tokens, structured output, health status at a glance"
  - bad: "curl -vvv https://example.com 2>&1 | grep -i ssl"
    good: "reveal ssl://example.com --check"
    why: "Clear pass/fail status, actionable exit codes for scripts"
  - bad: "ssl://nginx:///etc/nginx/*.conf --check"
    good: "reveal nginx.conf --extract domains | reveal --stdin --check"
    why: "Composable pipeline - can filter, transform, or redirect between steps"

notes:
  - 'Uses Python ssl module (no external dependencies)'
  - 'Connects with verification disabled for diagnostics, then verifies separately'
  - 'Chain information limited without PyOpenSSL (leaf cert only)'
  - 'Default connection timeout is 10 seconds'
  - 'Exit codes: 0=healthy, 1=warning (<30 days), 2=critical (<7 days or error)'

output_formats:
  - text
  - json

see_also:
  - 'reveal help://mysql - Database inspection'
  - 'reveal /etc/nginx/nginx.conf --check - N004 ACME path rule'
