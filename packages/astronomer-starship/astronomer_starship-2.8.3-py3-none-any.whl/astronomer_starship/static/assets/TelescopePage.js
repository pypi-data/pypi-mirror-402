import{G as v,j as e,B as d,K as O,H as P,b as R,a as j,d as l,an as T,R as y,V as E,p as f,q as b,w as z,s as U,t as w,v as L,T as I,a0 as D,L as A}from"./chakra.js";import{r}from"./react-core.js";import{q as F,c as G,l as B,e as H,G as $,r as M}from"./index.js";import{a as _}from"./http.js";import{F as q}from"./index.esm.js";import{a as V}from"./router.js";import"./icons.js";function Z(){const{telescopeOrganizationId:t,telescopePresignedUrl:a}=F(),o=G(),[i,m]=r.useState(!1),[n,h]=r.useState(!1),[u,c]=r.useState(null),g=v(),p=r.useMemo(()=>{const s=B(H.TELESCOPE_ROUTE);if(t){const x=new URLSearchParams({organization:t});return a&&x.set("presigned_url",a),`${s}?${x.toString()}`}return s},[t,a]),S=r.useMemo(()=>`${t}.${new Date().toISOString().slice(0,10)}.data.json`,[t]),C=r.useCallback(async()=>{m(!0),c(null);try{await _.get(p),h(!0)}catch(s){g({title:s.response?.data?.error||s.response?.data||s.message,status:"error",isClosable:!0,variant:"outline",duration:4e3}),c(s)}finally{m(!1)}},[p,g]),k=r.useCallback(()=>{o({type:"set-telescope-org",telescopeOrganizationId:""}),o({type:"set-telescope-presigned-url",telescopePresignedUrl:""}),h(!1),c(null)},[o]);return e.jsxs(d,{children:[e.jsxs(O,{direction:{base:"column",md:"row"},justify:"space-between",align:{base:"flex-start",md:"center"},mb:3,children:[e.jsxs(d,{children:[e.jsx(P,{size:"md",mb:.5,children:"Telescope"}),e.jsx(R,{fontSize:"xs",color:"gray.600",children:"Gather metadata from an Airflow instance to collect insights."})]}),e.jsxs(j,{children:[e.jsx(l,{size:"sm",leftIcon:e.jsx(T,{}),as:V,to:"/setup",variant:"outline",children:"Back to Setup"}),e.jsx(l,{size:"sm",leftIcon:e.jsx(y,{}),onClick:k,variant:"outline",children:"Reset"})]})]}),e.jsx(E,{spacing:3,align:"stretch",w:"100%",children:e.jsxs(d,{maxW:"xl",children:[e.jsxs(f,{marginY:"2%",children:[e.jsx(b,{htmlFor:"telescopeOrg",mb:1,children:"Organization"}),e.jsx(z,{size:"sm",children:e.jsx(U,{id:"telescopeOrg",placeholder:"Astronomer, LLC",value:t,onChange:s=>o({type:"set-telescope-org",telescopeOrganizationId:s.target.value})})}),e.jsx(w,{fontSize:"xs",children:"The ID of the Astronomer Organization to associate with this report."})]}),e.jsxs(f,{mb:2,children:[e.jsx(b,{htmlFor:"telescopePresignedUrl",mb:1,children:"Pre-signed URL"}),e.jsx(z,{size:"sm",children:e.jsx(U,{id:"telescopePresignedUrl",placeholder:"https://storage.googleapis.com/astronomer-telescope/...",value:a,onChange:s=>o({type:"set-telescope-presigned-url",telescopePresignedUrl:s.target.value})})}),e.jsx(w,{fontSize:"xs",children:"(Optional) Enter a pre-signed URL to submit the report."}),e.jsx(L,{children:"Please fill both parts."})]}),e.jsxs(j,{spacing:2,children:[e.jsx(I,{hasArrow:!0,label:"Upload the report via pre-signed url to Astronomer",children:e.jsx(l,{size:"sm",variant:"outline",leftIcon:i?e.jsx("span",{}):n?e.jsx(q,{}):e.jsx($,{}),isDisabled:i||n||!a||!t,colorScheme:n?"green":u?"red":"gray",onClick:C,children:i?e.jsx(D,{thickness:"20px",size:"30px",isIndeterminate:!0}):n?"Done":u?"Error!":"Upload"})}),e.jsx(I,{hasArrow:!0,label:"Download the report",children:e.jsx(l,{size:"sm",leftIcon:e.jsx(M,{}),isDisabled:!t,href:p,as:A,download:S,target:"_blank",children:"Download"})})]})]})})]})}export{Z as default};
