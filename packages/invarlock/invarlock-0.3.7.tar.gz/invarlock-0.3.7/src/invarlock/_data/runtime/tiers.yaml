# Tier policy defaults (metrics gates + guard knobs) used at runtime.
#
# Balanced and Conservative values are calibrated/validated against pilot/null
# runs (Nov/Dec 2025) where applicable; Aggressive is research-oriented (not in
# the safety case).
#
# Rationale by key: docs/reference/tier-policy-catalog.md
# Calibration method: docs/assurance/09-tier-v1-calibration.md
# Provenance/digest: docs/assurance/11-policy-provenance.md

balanced:
  metrics:
    pm_ratio:
      ratio_limit_base: 1.10
      min_tokens: 50000
      hysteresis_ratio: 0.002
      min_token_fraction: 0.01
    pm_tail:
      mode: warn
      min_windows: 50
      quantile: 0.95
      quantile_max: 0.20
      epsilon: 0.0001
      mass_max: 1.0
    accuracy:
      delta_min_pp: -1.0
      min_examples: 200
      hysteresis_delta_pp: 0.1
      min_examples_fraction: 0.01
  variance_guard:
    deadband: 0.02
    min_abs_adjust: 0.012
    max_scale_step: 0.03
    min_effect_lognll: 0.0
    predictive_one_sided: true
    topk_backstop: 1
    max_adjusted_modules: 1
    tap: "transformer.h.*.mlp.c_proj"
    predictive_gate: true
  spectral_guard:
    sigma_quantile: 0.95
    deadband: 0.10
    scope: all
    max_caps: 5
    max_spectral_norm: null
    family_caps:
      ffn: 3.849
      attn: 3.018
      embed: 1.05
      other: 0.0
    multiple_testing:
      method: bh
      alpha: 0.05
      m: 4
  rmt_guard:
    deadband: 0.10
    margin: 1.5
    epsilon_default: 0.01
    epsilon_by_family:
      ffn: 0.01
      attn: 0.01
      embed: 0.01
      other: 0.01

conservative:
  metrics:
    pm_ratio:
      ratio_limit_base: 1.05
      min_tokens: 20000
      hysteresis_ratio: 0.002
      min_token_fraction: 0.01
    pm_tail:
      mode: warn
      min_windows: 50
      quantile: 0.95
      quantile_max: 0.12
      epsilon: 0.0001
      mass_max: 1.0
    accuracy:
      delta_min_pp: -0.5
      min_examples: 200
      hysteresis_delta_pp: 0.1
      min_examples_fraction: 0.01
  variance_guard:
    deadband: 0.03
    min_abs_adjust: 0.02
    max_scale_step: 0.015
    min_effect_lognll: 0.016
    predictive_one_sided: false
    topk_backstop: 0
    max_adjusted_modules: 0
    tap: "transformer.h.*.mlp.c_proj"
    predictive_gate: true
  spectral_guard:
    sigma_quantile: 0.90
    deadband: 0.05
    scope: ffn
    max_caps: 3
    max_spectral_norm: null
    family_caps:
      ffn: 3.849
      attn: 2.6
      embed: 2.8
      other: 2.8
    multiple_testing:
      method: bonferroni
      alpha: 0.000625
      m: 4
  rmt_guard:
    deadband: 0.05
    margin: 1.3
    epsilon_default: 0.01
    epsilon_by_family:
      ffn: 0.01
      attn: 0.01
      embed: 0.01
      other: 0.01

aggressive:
  metrics:
    pm_ratio:
      ratio_limit_base: 1.20
      min_tokens: 50000
      hysteresis_ratio: 0.002
      min_token_fraction: 0.01
    pm_tail:
      mode: warn
      min_windows: 50
      quantile: 0.95
      quantile_max: 0.30
      epsilon: 0.0001
      mass_max: 1.0
    accuracy:
      delta_min_pp: -2.0
      min_examples: 200
      hysteresis_delta_pp: 0.1
      min_examples_fraction: 0.01
  variance_guard:
    deadband: 0.12
    min_effect_lognll: 0.033
  spectral_guard:
    sigma_quantile: 0.98
    deadband: 0.15
    scope: ffn
    max_caps: 8
    max_spectral_norm: null
    family_caps:
      ffn: 3.849
      attn: 3.5
      embed: 2.5
      other: 3.5
    multiple_testing:
      method: bh
      alpha: 0.00078125
      m: 4
  rmt_guard:
    deadband: 0.15
    margin: 1.8
    epsilon_default: 0.01
    epsilon_by_family:
      ffn: 0.01
      attn: 0.01
      embed: 0.01
      other: 0.01
