import"../chunks/DsnmJJEf.js";import{o as rt}from"../chunks/C5bljJzU.js";import{p as lt,s as o,b as oe,u as T,g as e,c as t,e as q,f as n,t as Ae,v as ot,a as nt,h as G,i as u,j as W,k as g,l as E,n as $e,m as Re}from"../chunks/sdSGCPHU.js";import{i as w}from"../chunks/Bd4R2z4r.js";import{b as Be}from"../chunks/DmunbBOX.js";import{S as st,T as it}from"../chunks/CV6bMm65.js";import{d as gt,D as ut,n as dt,e as Me,r as ft,F as ve,S as ct,b as _e,c as mt,W as Oe}from"../chunks/DKPKy7OQ.js";import{M as We}from"../chunks/fPtezLJ0.js";import{C as pt,a as Ee}from"../chunks/DF54-rwi.js";import{u as vt,g as he}from"../chunks/-F0PAPFx.js";import{E as ne}from"../chunks/4ePiaj3E.js";var _t=G("<!> <!>",1),ht=G("<!> <!>",1),bt=G("<!> <!> <!>",1),wt=G("<!> <!>",1),yt=G("<!> <!>",1),St=G("<!> <!>",1);function $t(je,Ue){lt(Ue,!0);let N=null,se=null,ie=null,ge=null,ue=null,de=o(0),be=o(oe({})),P=o(oe([]));const Ve=["Hourly","Daily","Weekly","Monthly"];let a=o(null),s=o(null),m=o(""),F=o("Hourly"),L=o(!0),j=o(oe([])),U=o(oe([])),_=o(!1),p=o(!1),J=o(void 0),Q=o(void 0),we=n(()=>e(V).length>0?e(be)[e(V)[0]]:""),ye=n(()=>{if(!e(a)||!e(a).solution_name)return"";let r=e(a).solution_name.split(".");return[r[r.length-1],e(a).scenario_name,"storage_level",e(s)].join("_")}),Ye=n(()=>e(ye)+"_flows"),He=n(()=>xe("Storage Level")),Ie=n(()=>xe("Storage Flow")),X=o(null),Se=o(0);T(()=>{e(a)?.detail?.system.unaggregated_time_steps_per_year!==void 0&&t(Se,e(a).detail.system.unaggregated_time_steps_per_year,!0)}),T(()=>{e(Se),q(()=>{t(X,null)})});function xe(r){return{animation:!1,normalized:!0,parsing:!1,elements:{point:{radius:0},line:{borderWidth:1}},maintainAspectRatio:!1,scales:{x:{type:"linear",stacked:!0,title:{display:!0,text:"Time"},ticks:{maxRotation:0,autoSkip:!0,callback:l=>Number(l).toFixed(0)},min:0,max:(e(a)?.detail?.system.unaggregated_time_steps_per_year||0)-1},y:{stacked:!0,beginAtZero:!0,title:{display:!0,text:`${r} [${e(we)}]`}}},interaction:{intersect:!1,mode:"nearest",axis:"x"}}}const Ce={zoom:{pan:{enabled:!0,modifierKey:"ctrl",mode:"x"},zoom:{drag:{enabled:!0},wheel:{enabled:!0},mode:"x"},limits:{x:{minRange:10,min:"original",max:"original"}}},tooltip:{callbacks:{label:r=>`${r.dataset.label}: ${r.formattedValue} ${e(we)}`}}};let re=n(()=>(e(de),N?Me(N.entries.map(r=>r.index.node)).sort():[])),ee=n(()=>{if(!e(a))return[];const r=new st;return e(a).detail.system.set_storage_technologies.forEach(l=>{const y=e(a).detail.reference_carrier[l];y&&r.add(y)}),Array.from(r).sort()}),V=n(()=>(e(de),!N||!e(a)||e(ee).length===0?[]:Me(N.entries.map(l=>l.index.technology)).filter(l=>e(a).detail.reference_carrier[l]==e(s))));T(()=>{e(V),q(()=>{t(j,e(V),!0)})}),T(()=>{e(re),q(()=>{t(U,e(re),!0)})}),T(()=>{e(ee),q(()=>{e(a)!==null&&e(s)!==null&&!e(ee).includes(e(s))&&t(s,null)})}),T(()=>{e(P),q(()=>{e(P).length>0&&(!e(m)||!e(P).includes(Number(e(m))))&&(t(m,e(P)[0].toString(),!0),ce())})}),T(()=>{e(s),e(L),e(j),e(U),q(ce)}),rt(()=>{t(s,he("car")||e(s),!0),t(m,he("year")||e(m),!0),t(F,he("window")||e(F),!0)}),T(()=>{e(m),e(s),e(F),Ae().then(()=>{vt({year:e(m),car:e(s),window:e(F)})})}),T(()=>{Ke()});async function Ke(){if(e(a)===null||!e(m)||e(s)===null)return;t(p,!0);let r={Daily:24,Weekly:168,Monthly:720}[e(F)]||1;const l=await gt(e(a).solution_name,["storage_level","flow_storage_charge","flow_storage_discharge","flow_storage_spillage","flow_storage_inflow"],e(a).scenario_name,"storage_level",Number(e(m)),r,e(s));N=l.components.storage_level||null,se=l.components.flow_storage_charge||null,ie=l.components.flow_storage_discharge||null,ge=l.components.flow_storage_spillage||null,ue=l.components.flow_storage_inflow||null,ot(de),l.unit?.data&&t(be,Object.fromEntries(l.unit.data.map(y=>[y.technology,y[0]||y.units])),!0),t(p,!1),ce()}let Te=n(()=>Array.from({length:e(ze)},(r,l)=>l.toString())),le=[],ke=[],fe=o(0),ze=o(0);function Ze(){if(e(a)===null||e(p)||e(U).length==0||e(j).length==0||!N||!se||!ie||!ue||!ge)return[[],[]];const r=[{data:se,labelSuffix:"_charge",labelAggregated:"Flow Storage Charge",negate:!1,aggregatedColor:"rgb(54, 162, 235)",aggregatedBackgroundColor:void 0},{data:ie,labelSuffix:"_discharge",labelAggregated:"Flow Storage Discharge",negate:!0,aggregatedColor:"rgb(255, 99, 132)",aggregatedBackgroundColor:void 0},{data:ue,labelSuffix:"_inflow",labelAggregated:"Flow Storage Inflow",negate:!1,aggregatedColor:"rgb(75, 192, 192)",aggregatedBackgroundColor:void 0},{data:ge,labelSuffix:"_spillage",labelAggregated:"Flow Storage Spillage",negate:!0,aggregatedColor:"rgb(255, 99, 132)",aggregatedBackgroundColor:void 0}];return[De({data:N,labelSuffix:"",labelAggregated:"Storage Level",negate:!1,aggregatedColor:"rgb(0, 0, 0)",aggregatedBackgroundColor:"rgba(0, 0, 0, 0.2)"}),r.flatMap(De)]}function De({data:r,labelSuffix:l,labelAggregated:y,negate:A,aggregatedColor:S,aggregatedBackgroundColor:$}){let R=r.filterByCriteria({technology:e(j),node:e(U)}).groupBy(e(L)?["technology"]:[]);return A&&(R=R.mapData(k=>-k)),R.toArray().map(k=>{const i=e(L)?dt():S;return{data:k.data.map((z,D)=>({x:D,y:z})),label:e(L)?k.index.technology+l:y,type:"line",fill:"origin",stepped:!0,borderColor:i,backgroundColor:e(L)||!$?i:$}})}async function ce(){ft(),[le,ke]=Ze(),t(fe,le.length,!0),t(ze,e(fe)>0?le[0].data.length:0,!0),await Ae(),e(J)&&e(J).updateChart(le),e(Q)&&e(Q).updateChart(ke)}ut(je,{parentTitle:"The Energy Balance",pageTitle:"Storage",subtitle:"Charging and discharging flows and storage levels",filters:A=>{var S=yt(),$=u(S);ve($,{title:"Solution Selection",children:(i,z)=>{{let D=n(()=>e(p)||e(_));ct(i,{get disabled(){return e(D)},get selected_solution(){return e(a)},set selected_solution(x){t(a,x,!0)},get loading(){return e(_)},set loading(x){t(_,x,!0)},get years(){return e(P)},set years(x){t(P,x,!0)}})}}});var R=W($,2);{var k=i=>{var z=wt(),D=u(z);ve(D,{title:"Variable Selection",children:(d,te)=>{var ae=ht(),B=u(ae);{let h=n(()=>e(p)||e(_));_e(B,{get options(){return e(ee)},label:"Carrier",get disabled(){return e(h)},get value(){return e(s)},set value(f){t(s,f,!0)}})}var Y=W(B,2);{var v=h=>{var f=_t(),b=u(f);{let c=n(()=>e(P).map(C=>C.toString())),H=n(()=>e(p)||e(_));_e(b,{get options(){return e(c)},label:"Year",get disabled(){return e(H)},get value(){return e(m)},set value(C){t(m,C,!0)}})}var M=W(b,2);{const c=C=>{$e();var pe=Re("Visualize the rolling average of hourly values over a longer time period.");g(C,pe)};let H=n(()=>e(p)||e(_));_e(M,{get options(){return Ve},label:"Smoothing Window Size",get disabled(){return e(H)},get value(){return e(F)},set value(C){t(F,C,!0)},helpText:c,$$slots:{helpText:!0}})}g(h,f)};w(Y,h=>{e(s)!==null&&h(v)})}g(d,ae)}});var x=W(D,2);{var me=d=>{ve(d,{title:"Data Selection",children:(te,ae)=>{var B=bt(),Y=u(B);{const f=M=>{$e();var c=Re("Aggregate or disaggregate all the storage technologies.");g(M,c)};let b=n(()=>e(p)||e(_));it(Y,{label:"Technology Subdivision",get disabled(){return e(b)},get value(){return e(L)},set value(M){t(L,M,!0)},helpText:f,$$slots:{helpText:!0}})}var v=W(Y,2);{let f=n(()=>e(p)||e(_));We(v,{get options(){return e(V)},label:"Technologies",get disabled(){return e(f)},get value(){return e(j)},set value(b){t(j,b,!0)}})}var h=W(v,2);{let f=n(()=>e(p)||e(_));We(h,{get options(){return e(re)},label:"Nodes",get disabled(){return e(f)},get value(){return e(U)},set value(b){t(U,b,!0)}})}g(te,B)}})};w(x,d=>{e(a)!==null&&e(s)!==null&&d(me)})}g(i,z)};w(R,i=>{e(a)!==null&&i(k)})}g(A,S)},buttons:A=>{{let S=n(()=>[e(J),e(Q)]);pt(A,{get charts(){return e(S)},downloadable:!0,zoomable:!0})}},mainContent:A=>{var S=E(),$=u(S);{var R=i=>{mt(i)},k=i=>{var z=E(),D=u(z);{var x=d=>{Oe(d,{message:"Please select a solution"})},me=d=>{var te=E(),ae=u(te);{var B=v=>{ne(v,{message:"No carriers with this selection"})},Y=v=>{var h=E(),f=u(h);{var b=c=>{Oe(c,{message:"Please select a carrier"})},M=c=>{var H=E(),C=u(H);{var pe=I=>{ne(I,{message:"No technologies with this selection"})},qe=I=>{var Ne=E(),Ge=u(Ne);{var Je=K=>{ne(K,{message:"No locations with this selection"})},Qe=K=>{var Pe=E(),Xe=u(Pe);{var et=Z=>{ne(Z,{message:"No data available for this selection"})},tt=Z=>{var Fe=St(),Le=u(Fe);Be(Ee(Le,{id:"level_chart",type:"line",get labels(){return e(Te)},datasets:[],get options(){return e(He)},get pluginOptions(){return Ce},get plotName(){return e(ye)},zoom:!0,get zoomLevel(){return e(X)},set zoomLevel(O){t(X,O,!0)}}),O=>t(J,O,!0),()=>e(J));var at=W(Le,2);Be(Ee(at,{id:"flow_chart",type:"line",get labels(){return e(Te)},datasets:[],get options(){return e(Ie)},get pluginOptions(){return Ce},get plotName(){return e(Ye)},zoom:!0,get zoomLevel(){return e(X)},set zoomLevel(O){t(X,O,!0)}}),O=>t(Q,O,!0),()=>e(Q)),g(Z,Fe)};w(Xe,Z=>{e(fe)==0?Z(et):Z(tt,!1)},!0)}g(K,Pe)};w(Ge,K=>{e(re).length==0?K(Je):K(Qe,!1)},!0)}g(I,Ne)};w(C,I=>{e(V).length==0?I(pe):I(qe,!1)},!0)}g(c,H)};w(f,c=>{e(s)==null?c(b):c(M,!1)},!0)}g(v,h)};w(ae,v=>{e(ee).length==0?v(B):v(Y,!1)},!0)}g(d,te)};w(D,d=>{e(a)==null?d(x):d(me,!1)},!0)}g(i,z)};w($,i=>{e(_)||e(p)?i(R):i(k,!1)})}g(A,S)}}),nt()}export{$t as component};
