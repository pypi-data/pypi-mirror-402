import"../chunks/DsnmJJEf.js";import{o as qe}from"../chunks/C5bljJzU.js";import{p as Ge,s as l,b as _,u as X,c as n,g as e,f as o,t as He,a as Je,h as ee,i as D,j as U,k as O,l as Z,C as Ke}from"../chunks/sdSGCPHU.js";import{i as E}from"../chunks/Bd4R2z4r.js";import{b as Qe}from"../chunks/DmunbBOX.js";import{M as Xe,g as xe,r as Ze,n as Ie,c as et,p as tt,o as at,a as rt}from"../chunks/B4Wp5zRC.js";import{M as ne}from"../chunks/fPtezLJ0.js";import{R as De}from"../chunks/0FxLp1lC.js";import{C as nt,a as ot}from"../chunks/DF54-rwi.js";import{D as lt,F as be,a as st,g as it,c as ut,W as he,n as Oe,h as ye,r as ct,E as I}from"../chunks/DKPKy7OQ.js";import{S as Ce,T as ke}from"../chunks/CV6bMm65.js";import{g as k}from"../chunks/D_ns0G0z.js";import{u as gt,a as mt,g as ft}from"../chunks/-F0PAPFx.js";import{E as dt}from"../chunks/4ePiaj3E.js";var vt=ee("<!> <!>",1),pt=ee("<!> <!>",1),_t=ee("<!> <!> <!>",1),bt=ee("<!> <!>",1),ht=ee("<!> <!> <!>",1);function Mt(Te,we){Ge(we,!0);let q=l(_([])),G=l(_([])),oe=l(_([])),le=l(_([])),se=l(_([])),ie=l(_([])),Se=l(_({})),Ee=l(_({})),v=l(!1),C=l(!1),H=l(_([]));const Me=[{label:"Location",value:"location"},{label:"Technology & Carrier",value:"technology_carrier"}],Ne=["Annual","Cumulative"];let i=l(_([null])),f=l(!0),L=l("Annual"),F=l(_([])),z=l(_([])),R=l("location"),ue=l(!1),j=l(_([])),B=l(_([])),ce=l(void 0),T=o(()=>e(i).some(t=>t===null)),V=o(()=>e(ue)&&e(f)),Re=o(()=>{if(!e(i)[0]?.solution_name)return"";let t=e(i)[0].solution_name.split(".");return[t[t.length-1],e(i)[0].scenario_name,e(Ae)].join("_")}),$e=o(()=>e(f)?Object.values(e(Se))[0]||"":Object.values(e(Ee))[0]||""),je=o(()=>({maintainAspectRatio:!1,scales:{x:{stacked:!0,title:{display:!0,text:"Year"}},y:{stacked:!0,title:{display:!0,text:"Emissions"+(e(V)?"":` [${e($e)}]`)},max:e(V)?1:void 0,suggestedMin:e(V)?-1:void 0}},interaction:{intersect:!1,mode:"nearest",axis:"x"}}));const Be={tooltip:{callbacks:{label:t=>`${t.dataset.label}: ${t.formattedValue}`+(e(V)?"":` ${e($e)}`),title:t=>{if(t.length>0)return`${t[0].label} - ${t[0].dataset.stack}`}}}};let Ae=o(()=>e(f)?k("carbon_emissions_carrier",e(i)[0]?.version):e(L)=="Annual"?k("carbon_emissions_annual",e(i)[0]?.version):k("carbon_emissions_cumulative",e(i)[0]?.version)),te=o(()=>{if(e(T))return[];const t=new Ce;return e(q).forEach(r=>{r.forEach(u=>t.add(u.technology))}),Array.from(t).sort()}),ae=o(()=>{if(e(T))return[];const t=new Ce;return e(G).forEach(r=>{r.forEach(u=>t.add(u.carrier))}),Array.from(t).sort()}),ge=o(()=>{if(e(T))return[];const t=new Ce;return e(q).forEach(r=>{r.forEach(u=>t.add(u.location))}),e(G).forEach(r=>{r.forEach(u=>t.add(u.node))}),Array.from(t).sort()});X(()=>{n(z,e(te),!0)}),X(()=>{n(F,e(ae),!0)}),X(()=>{n(j,e(ge),!0)}),X(()=>{n(B,e(H).map(t=>t.toString()),!0)}),qe(()=>{n(f,mt("subdiv",e(f)),!0),n(L,ft("cumul")||e(L),!0)}),X(()=>{e(f),e(L),He().then(()=>{gt({subdiv:e(f)?"1":"0",cumul:e(L)})})});function Ue(){Fe()}async function Fe(){if(e(i).length===0||e(i).some(a=>a==null))return;n(C,!0);const t=e(i),r={technology:k("carbon_emissions_technology",t[0].version),carrier:k("carbon_emissions_carrier",t[0].version),annual_limit:k("carbon_emissions_annual_limit",t[0].version),budget:k("carbon_emissions_budget",t[0].version),annual:k("carbon_emissions_annual",t[0].version),cumulative:k("carbon_emissions_cumulative",t[0].version)};let[u,...g]=await Promise.all([st(t[0].solution_name,r.annual),...t.flatMap(a=>[it(a.solution_name,Object.values(r),a.scenario_name,"",r.carrier)])]);n(q,g.map(a=>a[r.technology]?.data||[]),!0),n(G,g.map(a=>a[r.carrier]?.data||[]),!0),n(se,g.map(a=>a[r.annual_limit]?.data||[]),!0),n(ie,g.map(a=>a[r.budget]?.data||[]),!0),n(oe,g.map(a=>a[r.annual]?.data||[]),!0),n(le,g.map(a=>a[r.cumulative]?.data||[]),!0),g[0].unit?.data&&n(Se,Object.fromEntries(g[0].unit.data.map(a=>[a.carrier,a[0]||a.units])),!0),u.data&&n(Ee,Object.fromEntries(u.data.map(a=>[a.carrier,a[0]||a.units])),!0),n(C,!1)}let ze=o(()=>{if(e(i).length===0||e(T)||!e(oe).length||!e(le).length||!e(G).length||!e(q).length)return[[],[]];let t,r;e(f)?e(R)=="location"?(t={technology_carrier:e(z).concat(e(F)),location:e(j)},r=["technology_carrier"]):(t={technology_carrier:e(z).concat(e(F)),location:e(j)},r=["location"]):(t={},r=[]),ct(),Ze();const u=[];return[e(i).flatMap((a,b)=>{if(!a)return[];let s;e(f)?s=I.concatenate([I.fromRows(e(G)[b]).mapIndex(m=>({...m,technology_carrier:m.carrier,location:m.node})),I.fromRows(e(q)[b]).mapIndex(m=>({...m,technology_carrier:m.technology}))]):e(L)=="Annual"?s=I.fromRows(e(oe)[b]):s=I.fromRows(e(le)[b]),s=s.filterByCriteria(t).groupBy(r).filterDataByIndex(e(B).map(m=>e(H).indexOf(Number(m)))),e(V)&&(s=s.normalize());const Y=xe(a.solution_name,a.scenario_name),S=b>0?Ie():void 0;return u.push(et(Y,S)),s.toArray().map(m=>{const p=s.length===1?e(Ae):e(R)==="location"?m.index.technology_carrier:m.index.location,P=Oe(p);return{label:p,data:m.data,borderColor:P,backgroundColor:S!==void 0?tt.draw(S,ye(P)):ye(P),stack:Y}})}),u]}),Le=o(()=>Ke(e(ze),2)),Ve=o(()=>e(Le)[0]),Ye=o(()=>e(Le)[1]),We=o(()=>e(i).length===0||e(T)||e(V)||e(R)==="location"&&e(j).length!==e(ge).length||e(R)==="technology_carrier"&&(e(F).length!==e(ae).length||e(z).length!==e(te).length)?[]:e(i).flatMap((t,r)=>{if(!t)return[];let u;if(e(f)||e(L)=="Annual"){if((e(se)[r]??[]).length===0)return[];u=Object.entries(e(se)[r][0]).map(([,s])=>s==="inf"?1/0:Number(s))}else{if((e(ie)[r]??[]).length===0)return[];const s=Number(Object.values(e(ie)[r][0])[0]);u=e(B).map(()=>s)}const g=xe(t.solution_name,t.scenario_name),a=(e(f)||e(L)=="Annual"?"Annual Emissions Limit":"Carbon Emissions Budget")+(e(i).length>1?` (${g})`:""),b=Oe(a);return[{label:a,data:u,borderColor:b,backgroundColor:ye(b),type:"line"}]})),Pe=o(()=>e(Ve).concat(e(We)));lt(Te,{parentTitle:"The Transition Pathway",pageTitle:"Emissions",subtitle:"Annual or cumulative emissions",filters:g=>{var a=ht(),b=D(a);be(b,{title:"Solution Selection",children:(p,P)=>{{let J=o(()=>e(C)||e(v));Xe(p,{get disabled(){return e(J)},onSelected:Ue,get solutions(){return e(i)},set solutions(c){n(i,c,!0)},get years(){return e(H)},set years(c){n(H,c,!0)},get loading(){return e(v)},set loading(c){n(v,c,!0)}})}}});var s=U(b,2);{var Y=p=>{be(p,{title:"Variable Selection",children:(P,J)=>{var c=vt(),w=D(c);{let h=o(()=>e(C)||e(v));ke(w,{label:"Subdivision",get disabled(){return e(h)},get value(){return e(f)},set value(d){n(f,d,!0)}})}var K=U(w,2);{var Q=h=>{{let d=o(()=>e(C)||e(v));De(h,{get options(){return Ne},label:"Cumulation",get disabled(){return e(d)},get value(){return e(L)},set value($){n(L,$,!0)}})}};E(K,h=>{e(f)||h(Q)})}O(P,c)}})};E(s,p=>{!e(v)&&!e(T)&&p(Y)})}var S=U(s,2);{var m=p=>{be(p,{title:"Data Selection",children:(P,J)=>{var c=bt(),w=D(c);{var K=h=>{var d=_t(),$=D(d);{let y=o(()=>e(C)||e(v));De($,{get options(){return Me},label:"Aggregation",get disabled(){return e(y)},get value(){return e(R)},set value(x){n(R,x,!0)}})}var re=U($,2);{let y=o(()=>e(C)||e(v));ke(re,{label:"Normalization",get disabled(){return e(y)},get value(){return e(ue)},set value(x){n(ue,x,!0)}})}var me=U(re,2);{var fe=y=>{{let x=o(()=>e(C)||e(v));ne(y,{get options(){return e(ge)},label:"Locations",get disabled(){return e(x)},get value(){return e(j)},set value(W){n(j,W,!0)}})}},M=y=>{var x=pt(),W=D(x);{var de=A=>{{let pe=o(()=>e(C)||e(v));ne(A,{get options(){return e(te)},label:"Technologies",get disabled(){return e(pe)},get value(){return e(z)},set value(_e){n(z,_e,!0)}})}};E(W,A=>{e(te).length>0&&A(de)})}var N=U(W,2);{var ve=A=>{{let pe=o(()=>e(C)||e(v));ne(A,{get options(){return e(ae)},label:"Carriers",get disabled(){return e(pe)},get value(){return e(F)},set value(_e){n(F,_e,!0)}})}};E(N,A=>{e(ae).length>0&&A(ve)})}O(y,x)};E(me,y=>{e(R)=="location"?y(fe):y(M,!1)})}O(h,d)};E(w,h=>{e(f)&&h(K)})}var Q=U(w,2);{let h=o(()=>e(H).map($=>$.toString())),d=o(()=>e(C)||e(v));ne(Q,{get options(){return e(h)},label:"Years",get disabled(){return e(d)},get value(){return e(B)},set value($){n(B,$,!0)}})}O(P,c)}})};E(S,p=>{!e(v)&&!e(T)&&p(m)})}O(g,a)},buttons:g=>{{let a=o(()=>[e(ce)]);nt(g,{get charts(){return e(a)},downloadable:!0})}},mainContent:g=>{var a=Z(),b=D(a);{var s=S=>{ut(S)},Y=S=>{var m=Z(),p=D(m);{var P=c=>{he(c,{message:"Please select a solution"})},J=c=>{var w=Z(),K=D(w);{var Q=d=>{he(d,{message:"Please select at least one location"})},h=d=>{var $=Z(),re=D($);{var me=M=>{he(M,{message:"Please select at least one year"})},fe=M=>{var y=Z(),x=D(y);{var W=N=>{dt(N,{message:"No data available for the selected filters"})},de=N=>{{let ve=o(()=>e(B).map(A=>A.toString()));Qe(ot(N,{type:"bar",get labels(){return e(ve)},get datasets(){return e(Pe)},get options(){return e(je)},get pluginOptions(){return Be},get plotName(){return e(Re)},get patterns(){return e(Ye)},get generateLabels(){return rt},get onClickLegend(){return at}}),A=>n(ce,A,!0),()=>e(ce))}};E(x,N=>{e(Pe).length==0?N(W):N(de,!1)},!0)}O(M,y)};E(re,M=>{e(B).length==0?M(me):M(fe,!1)},!0)}O(d,$)};E(K,d=>{e(j).length==0?d(Q):d(h,!1)},!0)}O(c,w)};E(p,c=>{e(i).length==0||e(T)?c(P):c(J,!1)},!0)}O(S,m)};E(b,S=>{e(v)||e(C)?S(s):S(Y,!1)})}O(g,a)}}),Je()}export{Mt as component};
