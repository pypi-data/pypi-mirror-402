import"../chunks/DsnmJJEf.js";import{s as Ie,o as pt}from"../chunks/C5bljJzU.js";import{p as Ze,l as le,i as w,k as c,a as et,h as D,o as ue,r as de,j as P,g as e,f as a,q as Re,s as m,b as M,u as He,e as ht,t as mt,c as s,C as bt}from"../chunks/sdSGCPHU.js";import{i as j}from"../chunks/Bd4R2z4r.js";import{u as yt,g as wt,a as Je,b as Me,e as xt}from"../chunks/-F0PAPFx.js";import{b as Ct}from"../chunks/DmunbBOX.js";import{M as St,r as Tt,g as Pt,n as kt,c as Et,p as Dt,o as Lt,a as Nt}from"../chunks/B4Wp5zRC.js";import{M as be}from"../chunks/fPtezLJ0.js";import{a as Ye,C as Bt}from"../chunks/DF54-rwi.js";import{C as Ae,D as $t,F as ye,g as Mt,b as At,c as Ot,i as Ft,W as Ke,r as It,E as ke,l as Oe,n as Rt,h as Qe}from"../chunks/DKPKy7OQ.js";import{S as Ee,T as Fe}from"../chunks/CV6bMm65.js";import{g as Xe,h as Yt,a as jt}from"../chunks/DYZFhhTc.js";import{u as we}from"../chunks/D5O2KZmu.js";import{E as Ut}from"../chunks/4ePiaj3E.js";var Wt=D('<div class="text-center text-xl text-muted my-2">Click on a bar to see a production and consumption breakdown.</div>'),zt=D('<h3 class="font-semibold text-lg mb-4"> </h3> <!>',1),Vt=D('<h3 class="font-semibold text-lg mb-4"> </h3> <!>',1),qt=D('<div class="grid grid-cols-2 gap-4"><!> <!></div>');function Gt(De,f){Ze(f,!0);let U=a(()=>jt(f.datasets,f.year,f.solution,f.labels)),Q=a(()=>Yt(f.datasets));function ae(i,b){if(f.year==null)return[];const I=e(U).filter(N=>N.data&&i(Number(N.data))),V=I.map(N=>N.data),te=I.map(N=>N.color);return[{label:b,data:V,backgroundColor:te}]}function W(i){return f.year==null?[]:e(U).filter(b=>b.data&&i(Number(b.data))).map(b=>b.label||"")}let d=a(()=>ae(i=>i>1e-6,"Production")),n=a(()=>W(i=>i>1e-6)),X=a(()=>Xe(f.tooltipSuffix)),Z=a(()=>ae(i=>i<-1e-6,"Consumption")),A=a(()=>W(i=>i<-1e-6)),Le=a(()=>Xe(f.tooltipSuffix));var O=le(),F=w(O);{var ee=i=>{Ae(i,{children:(b,I)=>{var V=Wt();c(b,V)},$$slots:{default:!0}})},z=i=>{var b=qt(),I=ue(b);Ae(I,{children:(te,N)=>{var re=zt(),R=w(re),ce=ue(R);de(R);var v=P(R,2);Ye(v,{type:"pie",get datasets(){return e(d)},get labels(){return e(n)},get options(){return e(X)},boxed:!1}),Re(()=>Ie(ce,`Breakdown of Production for ${f.year??""}
				${e(Q)?` (${f.solution})`:""}`)),c(te,re)},$$slots:{default:!0}});var V=P(I,2);Ae(V,{children:(te,N)=>{var re=Vt(),R=w(re),ce=ue(R);de(R);var v=P(R,2);Ye(v,{type:"pie",get datasets(){return e(Z)},get labels(){return e(A)},get options(){return e(Le)},boxed:!1}),Re(()=>Ie(ce,`Breakdown of Consumption for ${f.year??""}
				${e(Q)?` (${f.solution})`:""}`)),c(te,re)},$$slots:{default:!0}}),de(b),c(i,b)};j(F,i=>{f.year==null||f.solution==null?i(ee):i(z,!1)})}c(De,O),et()}var Ht=D('<!> <div class="text-gray-500 italic text-sm mb-2"> </div>',1),Jt=D("<div><!></div>"),Kt=D('<div class="grid grid-cols-2"><div><!></div> <!></div>'),Qt=D("<!> <!> <!>",1),Xt=D("<!> <!> <!>",1),Zt=D("<!> <!> <!>",1),er=D("<!> <!>",1),tr=D("<!> <!>",1),rr=D("<!> <!>",1);function hr(De,f){Ze(f,!0);let U=m(M([])),Q=m(M([])),ae=m(M([])),W=M([{id:"conversion",short_id:"conv",title:"Conversion",show:!0,subdivision:!0,show_subdivision:!0,filter_by_technologies:!0,positive:"flow_conversion_output",positive_label:"Conversion output",negative:"flow_conversion_input",negative_label:"Conversion input"},{id:"storage",short_id:"stor",title:"Storage",show:!0,subdivision:!0,show_subdivision:!0,filter_by_technologies:!0,positive:"flow_storage_discharge",positive_label:"Storage discharge",positive_suffix:" (discharge)",negative:"flow_storage_charge",negative_label:"Storage charge",negative_suffix:" (charge)"},{id:"transport",short_id:"tran",title:"Transport",show:!0,subdivision:!0,show_subdivision:!0,filter_by_technologies:!0,positive:"flow_transport",positive_label:"Transport in",positive_suffix:" (transport in)",negative:"flow_transport_loss",negative_label:"Transport out",negative_suffix:" (transport out)"},{id:"import_export",short_id:"imp_exp",title:"Import/Export",show:!0,subdivision:!1,show_subdivision:!1,filter_by_technologies:!1,positive:"flow_import",positive_label:"Import",negative:"flow_export",negative_label:"Export"},{id:"demand_shed_demand",short_id:"dem_shed",title:"Demand/Shed Demand",show:!0,subdivision:!1,show_subdivision:!1,filter_by_technologies:!1,positive:"shed_demand",positive_label:"Shed Demand",negative:"demand",negative_label:"Demand"}]),d=m(M([null])),n=m(null),X=m(M([])),Z=m(M([])),A=m(M([])),Le=a(()=>[...e(X),...e(Z),...e(A)]),O=m(!1),F=m(M([])),ee=m(M([])),z=m(null),i=m(null),b=null,I=null,V=null,te="",N="",re="",R="",ce="",v=m(!1),k=m(!1),tt=a(()=>{if(!e(d)[0]?.solution_name||!e(n))return"";let t=e(d)[0].solution_name.split(".");return[t[t?.length-1],e(d)[0].scenario_name,e(n)].join("_")}),ne=a(()=>e(d).some(t=>t===null)),je=m(M([])),Ue=a(()=>{let t=null;return!t&&e(n)&&(t=e(je).find(o=>o.carrier==e(n))),t&&(t[0]||t.units)||""}),Ne=m(void 0),We=a(()=>e(ee)),ze=a(()=>e(O)?"":` ${e(Ue)}`),rt=a(()=>({datasets:{bar:{borderColor:"rgb(255, 0, 0)",borderWidth:t=>!e(z)||!e(i)||t.chart.data.labels?.[t.dataIndex]!==e(z)||t.chart.data.datasets?.[t.datasetIndex].stack!==e(i)?0:5,borderRadius:2,borderSkipped:"middle"}},animation:{duration:0},maintainAspectRatio:!1,scales:{x:{stacked:!0,title:{display:!0,text:"Year"}},y:{stacked:!0,title:{display:!0,text:"Production"+(e(O)?"":` [${e(Ue)}]`)},max:e(O)?1:void 0,suggestedMin:e(O)?-1:void 0}},interaction:{intersect:!1,mode:"nearest",axis:"x"}}));const ot={tooltip:{callbacks:{label:t=>`${t.dataset.label}: ${t.formattedValue}${e(ze)}`,title:t=>{if(t.length>0)return`${t[0].label} - ${t[0].dataset.stack}`},labelColor:t=>({borderColor:t.dataset.backgroundColor,backgroundColor:t.dataset.backgroundColor,borderWidth:0})},filter:t=>Math.abs(t.parsed.y||0)>1e-6,borderWidth:0}};function at(t){return Nt(t).map(o=>({...o,lineWidth:0}))}let Be=a(()=>{if(e(ne))return[];const t=new Ee;return e(d).forEach(r=>{r.detail.system.set_carriers.forEach(l=>t.add(l))}),Array.from(t).sort()}),xe=a(()=>{if(e(ne)||e(n)===null)return[];const t=new Ee;return e(d).forEach(r=>{Object.entries(r.detail.carriers_input).concat(Object.entries(r.detail.carriers_output)).filter(l=>e(n)&&l[1].includes(e(n))).forEach(l=>t.add(l[0]))}),Array.from(t).sort()}),Ce=a(()=>{if(e(ne)||e(n)===null)return[];const t=new Ee;return e(d).forEach(r=>{r.detail.system.set_storage_technologies.forEach(l=>{r.detail.reference_carrier[l]===e(n)&&t.add(l)})}),Array.from(t).sort()}),Se=a(()=>{if(e(ne)||e(n)===null)return[];const t=new Ee;return e(d).forEach(r=>{r.detail.system.set_transport_technologies.forEach(l=>{r.detail.reference_carrier[l]===e(n)&&t.add(l)})}),Array.from(t).sort()});function nt(t){switch(t.id){case"conversion":return e(xe).length>0;case"storage":return e(Ce).length>0;case"transport":return e(Se).length>0;case"import_export":return e(U).some(o=>o[6].some(r=>r.carrier===e(n))||o[7].some(r=>r.carrier===e(n)));case"demand_shed_demand":return e(U).some(o=>o[8].some(r=>r.carrier===e(n))||o[9].some(r=>r.carrier===e(n)))}return!0}He(()=>{e(Be),ht(()=>{e(d)&&e(n)!==null&&!e(Be).includes(e(n))&&s(n,null)})}),we(()=>e(xe),()=>!!e(d),()=>te,()=>b,t=>s(X,t,!0),t=>te=t,t=>b=t),we(()=>e(Ce),()=>!!e(d),()=>N,()=>I,t=>s(Z,t,!0),t=>N=t,t=>I=t),we(()=>e(Se),()=>!!e(d),()=>re,()=>V,t=>s(A,t,!0),t=>re=t,t=>V=t),we(()=>e(ae),()=>!!e(d),()=>R,()=>null,t=>s(F,t,!0),t=>R=t,()=>{}),we(()=>e(Q).map(t=>t.toString()),()=>!!e(d),()=>ce,()=>null,t=>s(ee,t,!0),t=>ce=t,()=>{}),pt(()=>{s(n,wt("car")||null,!0),W.forEach(t=>{t.show=Je(t.short_id,t.show),t.subdivision=Je(t.short_id+"_sub",t.subdivision)}),b=Me("conv_tech"),I=Me("stor_tech"),V=Me("tran_tech")}),He(()=>{e(n),W.forEach(t=>{t.show,t.subdivision}),e(X),e(Z),mt().then(()=>{let t={car:e(n),conv_tech:e(X).map(o=>e(xe).indexOf(o)).join("~"),stor_tech:e(Z).map(o=>e(Ce).indexOf(o)).join("~"),tran_tech:e(A).map(o=>e(Se).indexOf(o)).join("~")};W.forEach(o=>{t[o.short_id]=o.show?"1":"0",t[o.short_id+"_sub"]=o.subdivision?"1":"0"}),yt(t)})});function st(){s(z,null),s(i,null),Ve()}function it(){Ve()}function lt(t,o){if(!t)return;const r=e(Te)[o].stack;!r||e(z)===t&&e(i)===r?(s(z,null),s(i,null)):(s(z,t,!0),s(i,r||null,!0))}async function Ve(){if(e(ne)||e(n)===null)return;s(k,!0),s(U,[],!0);const t=e(d),o=await Promise.all(t.map(r=>Mt(r.solution_name,["flow_conversion_output","flow_conversion_input","flow_storage_discharge","flow_storage_charge","flow_import","flow_export","flow_transport","flow_transport_loss","shed_demand","demand"],r.scenario_name,e(n),"demand")));s(U,o.map(r=>W.flatMap(l=>[r[l.positive]?.data||[],r[l.negative]?.data||[]])),!0),o.length>0&&o[0].unit?.data&&s(je,o[0].unit.data,!0),s(k,!1)}function qe(t,o,r,l,x){if(!e(n))return ke.empty();const q={carrier:[e(n)],node:e(F)};o.filter_by_technologies&&(q.technology=e(Le));const G=o.subdivision?["technology"]:[];let Y=t.filterByCriteria(q).filterDataByIndex(e(ee).map(u=>e(Q).indexOf(Number(u)))).groupBy(G).mapIndex(u=>({...u,label:o.subdivision?u.technology+(l||""):r}));return x!==void 0&&(Y=Y.mapData(x)),Y}let ut=a(()=>{if(e(F).length==0||e(ee).length==0||e(U).length==0)return[[],[]];It(),Tt();const t=[];return[e(d).flatMap((r,l)=>{const x=e(U)[l];if(!r||!x.length)return[];let q=W.flatMap((_,L)=>{if(!_.show)return[];let g=ke.fromRows(x[2*L]),se=ke.fromRows(x[2*L+1]);if(_.id==="transport"){const B=g,_e=se.filterByCriteria({technology:e(A),edge:Oe(r.detail.edges,e(F),!0)});g=B.filterByCriteria({technology:e(A),edge:Oe(r.detail.edges,e(F),!0)}).mapEntries((E,S)=>{const H=_e.find(T=>T.index.technology===E.technology&&T.index.edge===E.edge)?.data;return!H||H.length!==S.length?{index:E,data:S}:{data:S.map((T,p)=>T-H[p]),index:E}}),se=B.filterByCriteria({technology:e(A),edge:Oe(r.detail.edges,e(F),!1)})}let C=qe(g,_,_.positive_label,_.positive_suffix),oe=qe(se,_,_.negative_label,_.negative_suffix,B=>-B);return[C,oe]}),G=ke.concatenate(q);e(O)&&(G=G.normalize());let Y=Pt(r.solution_name,r.scenario_name),u=l>0?kt():void 0;return t.push(Et(Y,u)),G.toArray().map(_=>{const L=_.index.label,g=Rt(L);return{label:L,data:_.data,borderColor:g,backgroundColor:u!==void 0?Dt.draw(u,Qe(g)):Qe(g),stack:Y}})}),t]}),Ge=a(()=>bt(e(ut),2)),Te=a(()=>e(Ge)[0]),dt=a(()=>e(Ge)[1]);$t(De,{parentTitle:"The Transition Pathway",pageTitle:"Production",subtitle:"Annual production and consumption of a carrier",filters:l=>{var x=tr(),q=w(x);ye(q,{title:"Solution Selection",children:(u,_)=>{{let L=a(()=>e(k)||e(v));St(u,{onSelected:st,get disabled(){return e(L)},get solutions(){return e(d)},set solutions(g){s(d,g,!0)},get years(){return e(Q)},set years(g){s(Q,g,!0)},get nodes(){return e(ae)},set nodes(g){s(ae,g,!0)},get loading(){return e(v)},set loading(g){s(v,g,!0)}})}}});var G=P(q,2);{var Y=u=>{var _=er(),L=w(_);ye(L,{title:"Carrier Selection",children:(C,oe)=>{{let B=a(()=>e(v)||e(k));At(C,{label:"Carrier",get options(){return e(Be)},get disabled(){return e(B)},onUpdate:it,get value(){return e(n)},set value(ie){s(n,ie,!0)}})}}});var g=P(L,2);{var se=C=>{var oe=Zt(),B=w(oe);ye(B,{title:"Production Component Selection",children:(S,H)=>{var J=le(),T=w(J);xt(T,17,()=>W,p=>p.id,(p,h,$)=>{var y=le(),K=w(y);{var pe=ge=>{var fe=Ht(),ve=w(fe);Ft(ve,{get label(){return e(h).title}});var Pe=P(ve,2),$e=ue(Pe);de(Pe),Re(()=>Ie($e,`No data available for ${e(h).title??""}.`)),c(ge,fe)},ct=ge=>{var fe=Kt(),ve=ue(fe),Pe=ue(ve);{let he=a(()=>e(v)||e(k));Fe(Pe,{get label(){return e(h).title},get disabled(){return e(he)},get value(){return e(h).show},set value(me){e(h).show=me}})}de(ve);var $e=P(ve,2);{var gt=he=>{var me=Jt(),ft=ue(me);{let vt=a(()=>e(v)||e(k));Fe(ft,{label:"with Subdivision",get disabled(){return e(vt)},get value(){return e(h).subdivision},set value(_t){e(h).subdivision=_t}})}de(me),c(he,me)};j($e,he=>{e(h).show&&e(h).show_subdivision&&he(gt)})}de(fe),c(ge,fe)};j(K,ge=>{nt(e(h))?ge(ct,!1):ge(pe)})}c(p,y)}),c(S,J)}});var ie=P(B,2);ye(ie,{title:"Technology Selection",children:(S,H)=>{var J=Qt(),T=w(J);{let $=a(()=>e(v)||e(k));be(T,{get options(){return e(xe)},label:"Conversion",emptyText:"No conversion technologies available.",get disabled(){return e($)},get value(){return e(X)},set value(y){s(X,y,!0)}})}var p=P(T,2);{let $=a(()=>e(v)||e(k));be(p,{get options(){return e(Ce)},label:"Storage",emptyText:"No storage technologies available.",get disabled(){return e($)},get value(){return e(Z)},set value(y){s(Z,y,!0)}})}var h=P(p,2);{let $=a(()=>e(v)||e(k));be(h,{get options(){return e(Se)},label:"Transport",emptyText:"No transport technologies available.",get disabled(){return e($)},get value(){return e(A)},set value(y){s(A,y,!0)}})}c(S,J)}});var _e=P(ie,2);{var E=S=>{ye(S,{title:"Data Selection",children:(H,J)=>{var T=Xt(),p=w(T);{let y=a(()=>e(v)||e(k));Fe(p,{label:"Normalization",get disabled(){return e(y)},get value(){return e(O)},set value(K){s(O,K,!0)}})}var h=P(p,2);{let y=a(()=>e(v)||e(k));be(h,{get options(){return e(ae)},label:"Nodes",get disabled(){return e(y)},get value(){return e(F)},set value(K){s(F,K,!0)}})}var $=P(h,2);{let y=a(()=>e(Q).map(pe=>pe.toString())),K=a(()=>e(v)||e(k));be($,{get options(){return e(y)},label:"Years",get disabled(){return e(K)},get value(){return e(ee)},set value(pe){s(ee,pe,!0)}})}c(H,T)}})};j(_e,S=>{e(n)!==null&&S(E)})}c(C,oe)};j(g,C=>{e(n)!==null&&C(se)})}c(u,_)};j(G,u=>{!e(v)&&!e(ne)&&u(Y)})}c(l,x)},buttons:l=>{{let x=a(()=>[e(Ne)]);Bt(l,{get charts(){return e(x)},downloadable:!0})}},mainContent:l=>{var x=le(),q=w(x);{var G=u=>{Ot(u)},Y=u=>{var _=le(),L=w(_);{var g=C=>{Ke(C,{message:"Please select all solutions"})},se=C=>{var oe=le(),B=w(oe);{var ie=E=>{Ke(E,{message:"Please select a carrier"})},_e=E=>{var S=le(),H=w(S);{var J=p=>{Ut(p,{message:"No data with this selection"})},T=p=>{var h=rr(),$=w(h);Ct(Ye($,{type:"bar",get datasets(){return e(Te)},get labels(){return e(We)},get options(){return e(rt)},get pluginOptions(){return ot},get plotName(){return e(tt)},get patterns(){return e(dt)},generateLabels:at,get onClickLegend(){return Lt},onClickBar:lt}),K=>s(Ne,K,!0),()=>e(Ne));var y=P($,2);Gt(y,{get datasets(){return e(Te)},get labels(){return e(We)},get year(){return e(z)},get solution(){return e(i)},get tooltipSuffix(){return e(ze)}}),c(p,h)};j(H,p=>{e(Te).length==0?p(J):p(T,!1)},!0)}c(E,S)};j(B,E=>{e(n)==null?E(ie):E(_e,!1)},!0)}c(C,oe)};j(L,C=>{e(ne)?C(g):C(se,!1)},!0)}c(u,_)};j(q,u=>{e(v)||e(k)?u(G):u(Y,!1)})}c(l,x)}}),et()}export{hr as component};
