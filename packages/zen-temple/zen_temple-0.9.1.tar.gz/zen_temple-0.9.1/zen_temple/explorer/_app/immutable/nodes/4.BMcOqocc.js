import"../chunks/DsnmJJEf.js";import{o as Qe,s as Xe}from"../chunks/jKWSmWmB.js";import{p as et,k as n,q as pe,v as M,g as e,i as a,w as Z,j as Se,a as tt,u as o,f as I,m as y,s as W,h as p,l as le,n as Ce,x as De,c as at,t as rt,r as lt}from"../chunks/DAlzfk79.js";import{i as R}from"../chunks/CuNXTB5A.js";import{b as Pe}from"../chunks/gxe5upM2.js";import{D as nt,f as ot,a as Oe,r as st,n as it,F as ke,S as ut,b as ne,c as dt,W as ct,C as ze,H as gt}from"../chunks/CrYqV5xP.js";import{C as mt,a as Ne}from"../chunks/DHyauUYK.js";import{g as v}from"../chunks/D_ns0G0z.js";import{u as pt,g as oe}from"../chunks/B5O290y9.js";import{E as Le}from"../chunks/D74ROtS8.js";var ft=I("<!> <!> <!>",1),vt=I("<!> <!>",1),_t=I("<!> <!>",1),bt=I('<h2 class="font-bold text-lg"><span class="me-2">Shadow Prices</span> <!></h2> <!>',1),ht=I('<div class="text-center text-xl text-muted my-2">No shadow prices available.</div>'),yt=I("<!> <!>",1);function Nt(je,Me){et(Me,!0);let T=null,U=n(null),se=n(null),_=n(!1),x=n(!1),V=n(void 0),Y=n(void 0),P=n(pe([])),B=n(pe([])),O=n(pe([]));const We=["Hourly","Daily","Weekly","Monthly"];let r=n(null),s=n(null),l=n(null),u=n(null),w=n("Hourly"),fe=o(()=>{if(!e(r)||!e(r).solution_name)return"";let t=e(r).solution_name.split(".");return[t[t.length-1],e(r).scenario_name,"balance",e(l),e(s),e(u)].join("_")}),Re=o(()=>e(fe)+"_duals"),K=o(()=>{if(e(U)===null)return"";let t=e(U).find(m=>m.carrier===e(l));return t?t[0]||t.units||"":e(U)[0][0]||e(U)[0].units||""}),ve=o(()=>{let t=e(K);return(e(K).includes("*")||e(K).includes("/"))&&(t=`(${t})`),`${e(se)?.[0][0]||e(se)?.[0].units||""} / ${t}`}),q=n(null),ie=n(0);M(()=>{e(r)?.detail?.system.unaggregated_time_steps_per_year!==void 0&&a(ie,e(r).detail.system.unaggregated_time_steps_per_year,!0)}),M(()=>{e(ie),Z(()=>{a(q,null)})});let Te=o(()=>_e(`Energy [${e(K)}]`)),Be=o(()=>_e(`Shadow Price [${e(ve)}]`,5,!1));function _e(t,m=2,i=!0){return{animation:!1,normalized:!0,parsing:!1,maintainAspectRatio:!1,borderWidth:1,aspectRatio:m,elements:{point:{radius:0}},scales:{x:{type:"linear",stacked:!0,title:{display:!0,text:"Time"},ticks:{maxRotation:0,autoSkip:!0,callback:d=>Number(d).toFixed(0)},min:0,max:e(ie)-1},y:{stacked:!0,beginAtZero:i,title:{display:!0,text:t}}},interaction:{intersect:!1,mode:"nearest",axis:"x"}}}const Ee=o(()=>be(e(K))),He=o(()=>be(e(ve)));function be(t){return{zoom:{pan:{enabled:!0,modifierKey:"ctrl",mode:"x"},zoom:{drag:{enabled:!0},wheel:{enabled:!0},mode:"x"},limits:{x:{minRange:10,min:"original",max:"original"}}},tooltip:{callbacks:{label:m=>`${m.dataset.label}: ${m.formattedValue} ${t}`}}}}M(()=>{e(O),Z(()=>{e(O).length>0&&(e(u)==null||!e(O).includes(Number(e(u))))&&a(u,e(O)[0].toString(),!0)})}),M(()=>{e(P),Z(()=>{e(P).length>0&&(e(s)==null||!e(P).includes(e(s)))&&a(s,e(P)[0],!0)})}),M(()=>{e(B),Z(()=>{e(r)!==null&&e(l)!==null&&!e(B).includes(e(l))&&a(l,null)})}),M(()=>{e(r),e(u),e(s),e(l),e(w),Z(Fe)}),Qe(()=>{a(u,oe("year")||e(u),!0),a(s,oe("node")||e(s),!0),a(l,oe("car")||e(l),!0),a(w,oe("window")||e(w),!0)}),M(()=>{e(u),e(s),e(l),e(w),Se().then(()=>{pt({year:e(u),node:e(s),car:e(l),window:e(w)})})});let Ae=o(()=>({Daily:24,Weekly:168,Monthly:720})[e(w)]||1);async function Fe(){if(e(s)==null||e(l)==null||e(u)==null||e(r)==null)return;a(x,!0);const t=await Promise.all([ot(e(r).solution_name,e(s),e(l),e(r).scenario_name,Number(e(u)),e(Ae)),Oe(e(r).solution_name,v("flow_export",e(r).version)),Oe(e(r).solution_name,e(r).objective==="total_cost"?v("net_present_cost",e(r).version):v("carbon_emissions_cumulative",e(r).version))]);T=t[0],a(U,t[1].data,!0),a(se,t[2].data,!0),a(x,!1),Ve()}let he=o(()=>Array.from({length:e(J)},(t,m)=>m.toString())),G=[],ue=[],de=n(0),ye=n(0),J=n(0);const ce="constraint_nodal_energy_balance";function Ie(){if(!e(r)||!e(s)||!e(l)||!e(u)||!T)return[];const t=e(r).version,m={[v("flow_storage_discharge",t)]:i=>i+" (discharge)",[v("flow_transport_in",t)]:i=>i+" (transport in)",[v("flow_import",t)]:()=>"Import",[v("shed_demand",t)]:()=>"Shed Demand",[v("flow_storage_charge",t)]:i=>i+" (charge)",[v("flow_transport_out",t)]:i=>i+" (transport out)",[v("flow_export",t)]:()=>"Export"};return Object.entries(T).flatMap(([i,d])=>!d||d.length===0||i===ce?[]:(d=d.filterByCriteria({node:[e(s)]}).groupBy(["technology","node","label"]),d.toArray().map(({data:f,index:$})=>{const E=$.technology||$.node||$.label||"",H=it(),c=Object.values(f).map((k,A)=>({x:A,y:k}));return i=="demand"?{data:c,label:"Demand",type:"line",stack:"ownCustomStack",fill:!1,borderColor:"black",backgroundColor:"white",borderWidth:2,stepped:!0,pointRadius:Object.keys(f).length==1?2:0}:{data:c,label:m[i]?.(E)||E,fill:"origin",borderColor:H,backgroundColor:H,stepped:!0,cubicInterpolationMode:"monotone",pointRadius:Object.keys(f).length==1?2:0}})))}function Ue(){return!e(r)||!e(s)||!e(l)||!e(u)||!T||!T[ce]?.length?[]:T[ce].toArray().map(t=>t.data.length==0?null:{data:t.data.map((i,d)=>({x:d,y:i})),label:`shadow_price_${t.index.carrier}_${t.index.node}`,fill:!1,borderColor:"rgb(0, 0, 0)",backgroundColor:"rgb(0, 0, 0)",borderWidth:2,stepped:!0,cubicInterpolationMode:"monotone",pointRadius:t.data.length==1?2:0}).filter(t=>t!==null)}async function Ve(){st(),G=Ie(),a(de,G.length,!0),a(J,e(de)>0?G[0].data.length:0,!0),ue=Ue(),a(ye,ue.length,!0),await Se(),e(V)&&e(V).updateChart(G),e(Y)&&e(Y).updateChart(ue)}nt(je,{parentTitle:"The Energy Balance",pageTitle:"Nodal",subtitle:"Hourly production and consumption of a carrier",filters:d=>{var f=_t(),$=y(f);ke($,{title:"Solution Selection",children:(c,k)=>{{let A=o(()=>e(x)||e(_));ut(c,{get disabled(){return e(A)},get selected_solution(){return e(r)},set selected_solution(g){a(r,g,!0)},get carriers(){return e(B)},set carriers(g){a(B,g,!0)},get nodes(){return e(P)},set nodes(g){a(P,g,!0)},get years(){return e(O)},set years(g){a(O,g,!0)},get loading(){return e(_)},set loading(g){a(_,g,!0)}})}}});var E=W($,2);{var H=c=>{ke(c,{title:"Data Selection",children:(k,A)=>{var g=vt(),Q=y(g);{let z=o(()=>e(x)||e(_));ne(Q,{get options(){return e(B)},label:"Carrier",get disabled(){return e(z)},get value(){return e(l)},set value(F){a(l,F,!0)}})}var S=W(Q,2);{var X=z=>{var F=ft(),ee=y(F);{let N=o(()=>e(O).map(h=>h.toString())),L=o(()=>e(x)||e(_));ne(ee,{get options(){return e(N)},label:"Year",get disabled(){return e(L)},get value(){return e(u)},set value(h){a(u,h,!0)}})}var b=W(ee,2);{let N=o(()=>e(x)||e(_));ne(b,{get options(){return e(P)},label:"Node",get disabled(){return e(N)},get value(){return e(s)},set value(L){a(s,L,!0)}})}var te=W(b,2);{const N=h=>{Ce();var C=De("Visualize the rolling average of hourly values over a longer time period");p(h,C)};let L=o(()=>e(x)||e(_));ne(te,{get options(){return We},label:"Smoothing Window Size",get disabled(){return e(L)},get value(){return e(w)},set value(h){a(w,h,!0)},helpText:N,$$slots:{helpText:!0}})}p(z,F)};R(S,z=>{e(l)!==null&&z(X)})}p(k,g)}})};R(E,c=>{!e(_)&&e(r)!==null&&c(H)})}p(d,f)},buttons:d=>{{let f=o(()=>[e(V),e(Y)]);mt(d,{get charts(){return e(f)},downloadable:!0,zoomable:!0})}},mainContent:d=>{var f=le(),$=y(f);{var E=c=>{dt(c)},H=c=>{var k=le(),A=y(k);{var g=S=>{Le(S,{message:"No carriers available for the selected solution"})},Q=S=>{var X=le(),z=y(X);{var F=b=>{ct(b,{message:"Please select a carrier"})},ee=b=>{var te=le(),N=y(te);{var L=C=>{Le(C,{message:"No data with this selection"})},h=C=>{var xe=yt(),we=y(xe);{let D=o(()=>e(J)==1?"bar":"line");Pe(Ne(we,{get type(){return e(D)},get labels(){return e(he)},datasets:[],get options(){return e(Te)},get pluginOptions(){return e(Ee)},get plotName(){return e(fe)},zoom:!0,get zoomLevel(){return e(q)},set zoomLevel(j){a(q,j,!0)}}),j=>a(V,j,!0),()=>e(V))}var Ye=W(we,2);{var Ke=D=>{ze(D,{children:(j,Ze)=>{var ae=bt(),ge=y(ae),Ge=W(at(ge),2);gt(Ge,{children:(me,re)=>{Ce();var $e=De();rt(()=>Xe($e,`Shadow price of the nodal energy balance of carrier ${e(l)??""}. Indicates the
							change in total cost for the next marginal unit of demand.`)),p(me,$e)},$$slots:{default:!0}}),lt(ge);var Je=W(ge,2);{let me=o(()=>e(J)==1?"bar":"line");Pe(Ne(Je,{id:"chart-duals",get type(){return e(me)},get labels(){return e(he)},datasets:[],get options(){return e(Be)},get pluginOptions(){return e(He)},get plotName(){return e(Re)},zoom:!0,initialHeight:300,generateLabels:()=>[],boxed:!1,get zoomLevel(){return e(q)},set zoomLevel(re){a(q,re,!0)}}),re=>a(Y,re,!0),()=>e(Y))}p(j,ae)},$$slots:{default:!0}})},qe=D=>{ze(D,{children:(j,Ze)=>{var ae=ht();p(j,ae)},$$slots:{default:!0}})};R(Ye,D=>{e(ye)>0?D(Ke):D(qe,!1)})}p(C,xe)};R(N,C=>{e(de)==0||e(r)==null?C(L):C(h,!1)},!0)}p(b,te)};R(z,b=>{e(l)==null?b(F):b(ee,!1)},!0)}p(S,X)};R(A,S=>{e(B).length==0?S(g):S(Q,!1)},!0)}p(c,k)};R($,c=>{e(_)||e(x)?c(E):c(H,!1)})}p(d,f)}}),tt()}export{Nt as component};
