import"../chunks/DsnmJJEf.js";import{s as st,o as Ct}from"../chunks/jKWSmWmB.js";import{p as nt,l as me,m as L,h as v,a as lt,f as H,c as _e,r as xe,s as A,g as e,u as s,t as it,k as c,q as p,v as Ee,i as o,j as yt,n as St,x as Tt,F as wt}from"../chunks/DAlzfk79.js";import{i as S}from"../chunks/CuNXTB5A.js";import{u as Ot,a as Ze,b as be,e as kt}from"../chunks/B5O290y9.js";import{b as Et}from"../chunks/gxe5upM2.js";import{M as At,g as Lt,c as Pt,p as et,n as Dt,r as jt,o as Mt,a as $t}from"../chunks/CyjJS2ok.js";import{M as se}from"../chunks/Btt3Sv-I.js";import{R as Bt}from"../chunks/DnfI2MPE.js";import{S as ge,T as tt}from"../chunks/BHsOWwkz.js";import{a as ut,C as Rt}from"../chunks/DHyauUYK.js";import{C as rt,D as Ft,F as Ae,g as Yt,c as zt,W as at,r as It,E as fe,n as ot,h as Le}from"../chunks/CrYqV5xP.js";import{g as Nt}from"../chunks/D_ns0G0z.js";import{u as ne}from"../chunks/Cg8MRuhV.js";import{d as Ut}from"../chunks/CgsLtv0Y.js";import{E as Wt}from"../chunks/D74ROtS8.js";import{g as Vt,h as qt,a as Gt}from"../chunks/DYZFhhTc.js";import{g as Ht}from"../chunks/Dl-79ILA.js";var Jt=H('<div class="text-center text-xl text-muted my-2">Click on a bar to see a costs breakdown.</div>'),Kt=H('<h3 class="font-semibold text-lg mb-4"> </h3> <div class="grid grid-cols-2 items-start gap-4"><!></div>',1);function Qt(Pe,b){nt(b,!0);let _=s(()=>Gt(b.datasets,b.year,b.solution,b.labels)),Ce=s(()=>qt(b.datasets)),ye=s(()=>{if(b.year==null)return[];const m=e(_).map(F=>F.data),w=e(_).map(F=>F.color);return[{label:"Costs",data:m,backgroundColor:w}]}),De=s(()=>b.year==null?[]:e(_).map(m=>m.label||"")),je=s(()=>Vt(b.tooltipSuffix));var Se=me(),Me=L(Se);{var R=m=>{rt(m,{children:(w,F)=>{var Y=Jt();v(w,Y)},$$slots:{default:!0}})},Te=m=>{rt(m,{children:(w,F)=>{var Y=Kt(),J=L(Y),le=_e(J);xe(J);var u=A(J,2),z=_e(u);ut(z,{type:"pie",get datasets(){return e(ye)},get labels(){return e(De)},get options(){return e(je)},boxed:!1}),xe(u),it(()=>st(le,`Breakdown of Costs for ${b.year??""}
			${e(Ce)?` (${b.solution})`:""}`)),v(w,Y)},$$slots:{default:!0}})};S(Me,m=>{b.year==null||b.solution==null?m(R):m(Te,!1)})}v(Pe,Se),lt()}var Xt=H("<div><!></div>"),Zt=H('<div class="grid grid-cols-2"><div><!></div> <!></div>'),er=H("<!> <!> <!> <!> <!>",1),tr=H("<!> <!> <!>",1),rr=H("<!> <!> <!>",1),ar=H("<!> <!>",1),or=H("<!> <!>",1);function Sr(Pe,b){nt(b,!0);const _="Technology / Carrier",Ce=" (Capex)",ye=" (Opex)",De="Capex",je="Opex",Se="Carrier",Me="Shed Demand";let R=c(p([]));const Te=["Location",_];let m=c(p([])),w=c(p([])),F=c(p([])),Y=c(p([])),J=c(p([])),le=c(p({})),u=c(p([null])),z=c(p([])),X=c(p([])),Z=c(p([])),K=c(p([])),Q=c(p([])),he=c("Location"),pe=c(p([])),I=c(p([])),ee=c(null),te=c(null),$e=null,Be=null,Re=null,Fe=null,Ye=null,We="",Ve="",qe="",Ge="",He="",Je="",Ke="",T=c(!1),O=c(!1),ze=c(void 0),N=s(()=>e(u).some(t=>t===null)),U=p({capex:{title:"Capex",show:!0,subdivision:!1,showSubdivision:!0,label:De,helpText:"Annualized investment cost to expand technology capacity."},opex:{title:"Opex",show:!0,subdivision:!1,showSubdivision:!0,label:je,helpText:"Annual (fixed and variable) operational cost of technologies."},carrier:{title:"Carrier",show:!0,subdivision:!1,showSubdivision:!0,label:Se,helpText:"Annual cost of importing and exporting carriers."},shed_demand:{title:"Shed Demand",show:!0,subdivision:!1,showSubdivision:!0,label:Me,helpText:"Annual cost of shed demand of carriers."},carbon_emission:{title:"Carbon Emissions",show:!0,subdivision:!1,showSubdivision:!1,helpText:"Annual cost associated with carbon dioxide emissions."}}),ct=s(()=>{if(!e(u)[0])return"";let t=e(u)[0].solution_name.split(".");return[t[t.length-1],e(u)[0].scenario_name,"costs"].join("_")}),Ie=s(()=>e(ce).length>0?e(le)[e(ce)[0]]||"":e(ue).length>0?e(le)[e(ue)[0]]||"":e(de).length>0&&e(le)[e(de)[0]]||""),dt=s(()=>({datasets:{bar:{borderColor:Ht()==="dark"?"rgba(255, 255, 255, 1)":"rgba(0, 0, 0, 1)",borderWidth:t=>!e(ee)||!e(te)||t.chart.data.labels?.[t.dataIndex]!==e(ee)||t.chart.data.datasets[t.datasetIndex].stack!==e(te)?0:7,borderRadius:0,borderSkipped:"middle"}},maintainAspectRatio:!1,scales:{x:{stacked:!0,title:{display:!0,text:"Year"}},y:{stacked:!0,title:{display:!0,text:`Costs [${e(Ie)}]`}}},interaction:{intersect:!1,mode:"nearest",axis:"x"}})),gt={tooltip:{callbacks:{label:t=>`${t.dataset.label}: ${t.formattedValue} ${e(Ie)}`,title:t=>{if(t.length>0)return`${t[0].label} - ${t[0].dataset.stack}`},labelColor:t=>({borderColor:t.dataset.backgroundColor,backgroundColor:t.dataset.backgroundColor,borderWidth:0})},filter:t=>Math.abs(t.parsed.y||0)>1e-6,borderWidth:0}},Qe=s(()=>e(I)),ie=s(()=>e(N)?new Set:new Set([...e(m).flatMap(t=>t.map(r=>r.technology))||[],...e(w).flatMap(t=>t.map(r=>r.technology))||[]])),ue=s(()=>{if(e(N)||e(ie).size==0)return[];const t=e(u),r=new ge;return t.forEach(a=>{a.detail.system.set_transport_technologies.forEach(i=>{e(ie).has(i)&&r.add(i)})}),Array.from(r).sort()}),ce=s(()=>{if(e(N)||e(ie).size==0)return[];const t=e(u),r=new ge;return t.forEach(a=>{a.detail.system.set_conversion_technologies.forEach(i=>{e(ie).has(i)&&r.add(i)})}),Array.from(r).sort()}),de=s(()=>{if(e(N)||e(ie).size==0)return[];const t=e(u),r=new ge;return t.forEach(a=>{a.detail.system.set_storage_technologies.forEach(i=>{e(ie).has(i)&&r.add(i)})}),Array.from(r).sort()}),we=s(()=>{if(e(N))return[];const t=new ge;return e(Y).forEach(r=>{r.forEach(a=>{t.add(a.carrier)})}),Array.from(t).sort()}),Oe=s(()=>{if(e(N))return[];const t=new ge;return e(J).forEach(r=>{r.forEach(a=>{t.add(a.carrier)})}),Array.from(t).sort()}),Ne=s(()=>{if(e(N))return[];const t=e(u),r=new ge;return t.forEach(a=>{Object.keys(a.detail.edges).forEach(i=>{r.add(i)}),a.detail.system.set_nodes.forEach(i=>{r.add(i)})}),Array.from(r).sort()});Ee(()=>{o(pe,e(Ne),!0)}),Ee(()=>{o(I,e(R).map(t=>t.toString()),!0)}),ne(()=>e(ue),()=>!!e(u)[0]&&!!e(m)&&!!e(w),()=>qe,()=>Re,t=>o(Z,t,!0),t=>qe=t,t=>Re=t),ne(()=>e(ce),()=>!!e(u)[0]&&e(m).length>0&&e(w).length>0,()=>We,()=>$e,t=>o(z,t,!0),t=>We=t,t=>$e=t),ne(()=>e(de),()=>!!e(u)[0]&&e(m).length>0&&e(w).length>0,()=>Ve,()=>Be,t=>o(X,t,!0),t=>Ve=t,t=>Be=t),ne(()=>e(we),()=>!!e(u)[0]&&e(Y).length>0,()=>Ge,()=>Fe,t=>o(K,t,!0),t=>Ge=t,t=>Fe=t),ne(()=>e(Oe),()=>!!e(u)[0]&&e(J).length>0,()=>He,()=>Ye,t=>o(Q,t,!0),t=>He=t,t=>Ye=t),ne(()=>e(Ne),()=>!!e(u)[0],()=>Je,()=>null,t=>o(pe,t,!0),t=>Je=t,()=>{}),ne(()=>e(R).map(t=>t.toString()),()=>!!e(u)[0],()=>Ke,()=>null,t=>o(I,t,!0),t=>Ke=t,()=>{}),Ct(()=>{Object.entries(U).forEach(([t,r])=>{r.show=Ze(t,r.show),r.subdivision=Ze(t+"_sub",r.subdivision)}),Re=be("tran"),$e=be("conv"),Be=be("stor"),Fe=be("cost"),Ye=be("demand")}),Ee(()=>{e(Z),e(z),e(X),e(K),e(Q),Object.values(U).forEach(t=>{t.show,t.subdivision}),yt().then(()=>{let t={tran:e(Z).map(r=>e(ue).indexOf(r)).join("~"),conv:e(z).map(r=>e(ce).indexOf(r)).join("~"),stor:e(X).map(r=>e(de).indexOf(r)).join("~"),cost:e(K).map(r=>e(we).indexOf(r)).join("~"),demand:e(Q).map(r=>e(Oe).indexOf(r)).join("~")};Object.entries(U).forEach(([r,a])=>{t[r]=a.show?"1":"0",t[r+"_sub"]=a.subdivision?"1":"0"}),Ot(t)})});function ft(){o(ee,null),o(te,null),ht()}function mt(t,r){if(!t)return;const a=e(ke)[r].stack;!a||e(ee)===t&&e(te)===a?(o(ee,null),o(te,null)):(o(ee,t,!0),o(te,a,!0))}async function ht(){if(e(u).some(a=>a===null))return;o(O,!0);const t=e(u),r=await Promise.all(t.map(a=>Yt(a.solution_name,["cost_capex_yearly","cost_opex_yearly","cost_carbon_emissions_total","cost_carrier","cost_shed_demand"].map(i=>Nt(i,a?.version)),a.scenario_name)));o(m,r.map(a=>a.cost_capex_yearly?.data||[]),!0),o(w,r.map(a=>a.cost_opex_yearly?.data||[]),!0),o(F,r.map(a=>a.cost_carbon_emissions_total?.data||[]),!0),o(Y,r.map(a=>a.cost_carrier?.data||[]),!0),o(J,r.map(a=>a.cost_shed_demand?.data||[]),!0),r[0].unit?.data&&o(le,Object.fromEntries(r[0].unit.data.map(a=>[a.technology,a[0]||a.units])),!0),o(O,!1)}let Ue=c(p([]));function pt(){o(Ue,[...e(z).concat(e(X)).concat(e(Z)).flatMap(t=>[t+Ce,t+ye]),...e(K),...e(Q)],!0)}const vt=Object.values(U).filter(t=>t.label).map(t=>t.label);let bt=Ut(pt,100);Ee(()=>{e(z),e(X),e(Z),e(K),e(Q),bt()});let _t=s(()=>{if(e(Ue).length==0)return[[],[]];It(),jt();const t=[];return[e(u).flatMap((a,i)=>{if(a===null)return[];const W={capex:fe.fromRows(e(m)[i]).mapIndex(n=>({location:n.location,[_]:n.technology+Ce})),opex:fe.fromRows(e(w)[i]).mapIndex(n=>({location:n.location,[_]:n.technology+ye})),carrier:fe.fromRows(e(Y)[i]).filter(n=>e(K).includes(n.index.carrier)).mapIndex(n=>({location:n.node,[_]:n.carrier})),shed_demand:fe.fromRows(e(J)[i]).filter(n=>e(Q).includes(n.index.carrier)).mapIndex(n=>({location:n.node,[_]:n.carrier}))};let D=fe.concatenate(Object.entries(W).map(([n,C])=>{if(!U[n].show)return null;const g=C.filterByCriteria({location:e(pe),[_]:e(Ue).concat(vt)}).filterDataByIndex(e(I).map(ae=>e(R).indexOf(Number(ae))));return U[n].subdivision?g:g.groupBy(["location"]).mapIndex(ae=>({location:ae.location,[_]:U[n].label||""}))}));e(he)==_?D=D.groupBy(["location"]):D=D.groupBy([_]);const V=i>0?Dt():void 0,re=Lt(a.solution_name,a.scenario_name);t.push(Pt(re,V));const x=D.toArray().map(n=>{const C=e(he)==_?n.index.location:n.index[_],g=ot(C);return{label:C,data:n.data,backgroundColor:V!==void 0?et.draw(V,Le(g)):Le(g),stack:re}});if(e(F)[i].length===1&&U.carbon_emission.show){const n=fe.fromRows(e(F)[i]).filterDataByIndex(e(I).map(g=>e(R).indexOf(Number(g)))),C=ot("Total Carbon Costs");x.push({data:n.get(0).data,label:"Total Carbon Costs",backgroundColor:V!==void 0?et.draw(V,Le(C)):Le(C),stack:re})}return x}),t]}),Xe=s(()=>wt(e(_t),2)),ke=s(()=>e(Xe)[0]),xt=s(()=>e(Xe)[1]);Ft(Pe,{parentTitle:"The Transition Pathway",pageTitle:"Costs",subtitle:"Total annualized system costs by capex, opex, carrier cost, and carbon cost",filters:i=>{var W=ar(),D=L(W);Ae(D,{title:"Solution Selection",children:(x,n)=>{{let C=s(()=>e(O)||e(T));At(x,{onSelected:ft,get disabled(){return e(C)},get solutions(){return e(u)},set solutions(g){o(u,g,!0)},get years(){return e(R)},set years(g){o(R,g,!0)},get loading(){return e(T)},set loading(g){o(T,g,!0)}})}}});var V=A(D,2);{var re=x=>{var n=rr(),C=L(n);Ae(C,{title:"Cost Selection",children:(k,ve)=>{var j=me(),q=L(j);kt(q,17,()=>Object.values(U),M=>M.title,(M,d,oe)=>{var $=Zt(),h=_e($),E=_e(h);tt(E,{get label(){return e(d).title},get value(){return e(d).show},set value(l){e(d).show=l},helpText:l=>{St();var f=Tt();it(()=>st(f,e(d).helpText)),v(l,f)},$$slots:{helpText:!0}}),xe(h);var y=A(h,2);{var B=G=>{var l=Xt(),f=_e(l);tt(f,{label:"with Subdivision",get value(){return e(d).subdivision},set value(P){e(d).subdivision=P}}),xe(l),v(G,l)};S(y,G=>{e(d).show&&e(d).showSubdivision&&G(B)})}xe($),v(M,$)}),v(k,j)}});var g=A(C,2);Ae(g,{title:"Technology Selection",children:(k,ve)=>{var j=er(),q=L(j);{var M=l=>{{let f=s(()=>e(O)||e(T));se(l,{get options(){return e(ue)},label:"Transport",get disabled(){return e(f)},get value(){return e(Z)},set value(P){o(Z,P,!0)}})}};S(q,l=>{e(ue).length>0&&l(M)})}var d=A(q,2);{var oe=l=>{{let f=s(()=>e(O)||e(T));se(l,{get options(){return e(de)},label:"Storage",get disabled(){return e(f)},get value(){return e(X)},set value(P){o(X,P,!0)}})}};S(d,l=>{e(de).length>0&&l(oe)})}var $=A(d,2);{var h=l=>{{let f=s(()=>e(O)||e(T));se(l,{get options(){return e(ce)},label:"Conversion",get disabled(){return e(f)},get value(){return e(z)},set value(P){o(z,P,!0)}})}};S($,l=>{e(ce).length>0&&l(h)})}var E=A($,2);{var y=l=>{{let f=s(()=>e(O)||e(T));se(l,{get options(){return e(we)},label:"Cost of Carrier",get disabled(){return e(f)},get value(){return e(K)},set value(P){o(K,P,!0)}})}};S(E,l=>{e(we).length>0&&l(y)})}var B=A(E,2);{var G=l=>{{let f=s(()=>e(O)||e(T));se(l,{get options(){return e(Oe)},label:"Shed Demand",get disabled(){return e(f)},get value(){return e(Q)},set value(P){o(Q,P,!0)}})}};S(B,l=>{e(Oe).length>0&&l(G)})}v(k,j)}});var ae=A(g,2);Ae(ae,{title:"Data Selection",children:(k,ve)=>{var j=tr(),q=L(j);{let h=s(()=>e(O)||e(T));Bt(q,{get options(){return Te},label:"Aggregation",get disabled(){return e(h)},get value(){return e(he)},set value(E){o(he,E,!0)}})}var M=A(q,2);{var d=h=>{{let E=s(()=>e(O)||e(T));se(h,{get options(){return e(Ne)},label:"Locations",get disabled(){return e(E)},get value(){return e(pe)},set value(y){o(pe,y,!0)}})}};S(M,h=>{e(he)==Te[1]&&h(d)})}var oe=A(M,2);{var $=h=>{{let E=s(()=>e(R).map(B=>B.toString())),y=s(()=>e(O)||e(T));se(h,{get options(){return e(E)},label:"Years",get disabled(){return e(y)},get value(){return e(I)},set value(B){o(I,B,!0)}})}};S(oe,h=>{e(I)&&h($)})}v(k,j)}}),v(x,n)};S(V,x=>{!e(T)&&!e(N)&&x(re)})}v(i,W)},buttons:i=>{{let W=s(()=>[e(ze)]);Rt(i,{get charts(){return e(W)},downloadable:!0})}},mainContent:i=>{var W=me(),D=L(W);{var V=x=>{zt(x)},re=x=>{var n=me(),C=L(n);{var g=k=>{at(k,{message:"Please select a solution"})},ae=k=>{var ve=me(),j=L(ve);{var q=d=>{at(d,{message:"Please select at least one year"})},M=d=>{var oe=me(),$=L(oe);{var h=y=>{Wt(y,{message:"No data available for the selected filters"})},E=y=>{var B=or(),G=L(B);Et(ut(G,{type:"bar",get labels(){return e(Qe)},get datasets(){return e(ke)},get options(){return e(dt)},get pluginOptions(){return gt},get plotName(){return e(ct)},get patterns(){return e(xt)},get generateLabels(){return $t},get onClickLegend(){return Mt},onClickBar:mt}),f=>o(ze,f,!0),()=>e(ze));var l=A(G,2);{let f=s(()=>` ${e(Ie)}`);Qt(l,{get datasets(){return e(ke)},get labels(){return e(Qe)},get year(){return e(ee)},get solution(){return e(te)},get tooltipSuffix(){return e(f)}})}v(y,B)};S($,y=>{e(ke).length==0?y(h):y(E,!1)},!0)}v(d,oe)};S(j,d=>{e(I).length==0?d(q):d(M,!1)},!0)}v(k,ve)};S(C,k=>{e(N)?k(g):k(ae,!1)},!0)}v(x,n)};S(D,x=>{e(T)||e(O)?x(V):x(re,!1)})}v(i,W)}}),lt()}export{Sr as component};
