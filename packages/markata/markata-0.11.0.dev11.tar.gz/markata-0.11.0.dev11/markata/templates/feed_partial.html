<article>
    <header class='sticky top-0 pt-4 bg-neutral-800'>
        <h1 class='p-0 m-0'>{{ title }}</h1>
        {% if pagination_enabled %}
        <div class="pagination-info text-neutral-400 text-sm mb-4">
            <span>Page <span id="current-page">{{ page }}</span> of {{ total_pages }}</span>
            <span class="ml-4">Showing <span id="items-shown">{{ posts|length }}</span> of {{ total_posts }} items</span>
        </div>
        {% endif %}

        {% if pagination_enabled and pagination_context.pagination_type == 'js' %}
        <script>
        window.paginationData = {
            "enabled": true,
            "type": "js",
            "page": {{ page | tojson }},
            "totalPages": {{ total_pages | tojson }},
            "totalPosts": {{ total_posts | tojson }},
            "itemsShown": {{ posts|length | tojson }},
            "feedName": {{ feed_name | tojson }},
            "hasNext": {{ has_next | tojson }}
        };
        </script>
        <script src="/static/js/pagination.js"></script>
        {% endif %}
    </header>
    <div>
        <ul id='feed' class='px-0 mx-0 list-none'>
            {% for post in posts %}
            {% include card_template or feed.config.card_template or config.feeds.card_template %}
            {% endfor %}
        </ul>
        
        {% if pagination_enabled %}
        
        {# Manual pagination controls - shown for all types as fallback #}
        {% include "pagination_controls.html" %}
        
        {% if pagination_context.pagination_type == 'htmx' %}
        <!-- HTMX infinite scroll (progressive enhancement over manual) -->
        {% if has_next %}
        <div id="load-more-trigger" 
             hx-get="/{{ feed_name }}/{{ next_page }}/partial/"
             hx-target="#feed"
             hx-swap="beforeend"
             hx-trigger="revealed"
             hx-indicator=".loading-indicator">
        </div>
        {% endif %}

        <div class="loading-indicator htmx-indicator" style="display: none;">
          <div class="spinner"></div>
          <span>Loading more...</span>
        </div>
        
        <script src="/static/js/htmx.min.js"></script>
        <script>
        function updatePaginationInfoForHTMX(currentPage, totalPages) {
            const currentPageEl = document.getElementById('current-page');
            if (currentPageEl) {
                currentPageEl.textContent = currentPage;
            }
        }
        // Hide manual controls when HTMX is active
        (function() {
            var manualPagination = document.getElementById('manual-pagination');
            if (manualPagination) {
                manualPagination.style.display = 'none';
            }
        })();
        </script>
        {% endif %}
        
        {% if pagination_context.pagination_type == 'js' %}
        <!-- JS infinite scroll (progressive enhancement over manual) -->
        <div id="scroll-trigger" style="height: 1px;"></div>

        <div class="loading-indicator" style="display: none;">
          <div class="spinner"></div>
          <span>Loading more...</span>
        </div>
        
        <script>
        // Hide manual controls when JS infinite scroll is active
        (function() {
            var manualPagination = document.getElementById('manual-pagination');
            if (manualPagination) {
                manualPagination.style.display = 'none';
            }
        })();
        </script>
        {% endif %}
        
        {% endif %}
    </div>
</article>
