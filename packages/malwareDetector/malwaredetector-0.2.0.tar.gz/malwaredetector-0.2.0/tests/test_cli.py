"""Tests for CLI module."""

from pathlib import Path

from typer.testing import CliRunner

from malware_detector.cli import create_cli
from malware_detector.detector import BaseDetector

runner = CliRunner()


class MockDetector(BaseDetector):
    """Mock detector for CLI testing."""

    def stage_extract(self) -> str:
        return "extracted"

    def stage_vectorize(self) -> str:
        return "vectorized"

    def stage_train(self) -> str:
        return "trained"

    def stage_predict(self) -> str:
        return "predicted"


class TestCreateCli:
    """Tests for create_cli function."""

    def test_cli_creation(self) -> None:
        """Test that CLI is created successfully."""
        app = create_cli(MockDetector)
        assert app is not None

    def test_cli_help(self) -> None:
        """Test that --help works."""
        app = create_cli(MockDetector)
        result = runner.invoke(app, ["--help"])
        assert result.exit_code == 0
        assert "MockDetector" in result.stdout or "CLI" in result.stdout

    def test_cli_init_command(self, tmp_path: Path) -> None:
        """Test init command creates config file."""
        app = create_cli(MockDetector)
        config_file = tmp_path / "test_config.toml"
        result = runner.invoke(app, ["init", "--output", str(config_file)])
        assert result.exit_code == 0
        assert config_file.exists()

    def test_cli_run_command_help(self) -> None:
        """Test run command help."""
        app = create_cli(MockDetector)
        result = runner.invoke(app, ["run", "--help"])
        assert result.exit_code == 0
        assert "--config" in result.stdout or "-c" in result.stdout
