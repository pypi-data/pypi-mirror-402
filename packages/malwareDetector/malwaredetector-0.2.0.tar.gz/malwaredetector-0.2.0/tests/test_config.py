"""Tests for config module."""

from pathlib import Path

from malware_detector.config import (
    BaseDetectorConfig,
    FolderConfig,
    PathConfig,
)


class TestPathConfig:
    """Tests for PathConfig."""

    def test_default_values(self) -> None:
        """Test default path values."""
        config = PathConfig()
        assert config.input == Path("./Dataset/program")
        assert config.output == Path("./Predict/predict.json")
        assert config.config == Path("./config.toml")

    def test_custom_values(self) -> None:
        """Test custom path values."""
        config = PathConfig(input=Path("/custom/input"))
        assert config.input == Path("/custom/input")


class TestFolderConfig:
    """Tests for FolderConfig."""

    def test_default_values(self) -> None:
        """Test default folder values."""
        config = FolderConfig()
        assert config.dataset == Path("./Dataset/")
        assert config.feature == Path("./Feature/")

    def test_all_folders_property(self) -> None:
        """Test all_folders returns all Path fields."""
        config = FolderConfig()
        folders = config.all_folders
        assert len(folders) == 5
        assert Path("./Dataset/") in folders
        assert Path("./Feature/") in folders


class TestBaseDetectorConfig:
    """Tests for BaseDetectorConfig."""

    def test_default_values(self) -> None:
        """Test default config values."""
        config = BaseDetectorConfig()
        assert config.classify is False
        assert isinstance(config.path, PathConfig)
        assert isinstance(config.folder, FolderConfig)

    def test_save_and_load(self, tmp_path: Path) -> None:
        """Test config serialization and deserialization."""
        config = BaseDetectorConfig()
        config_file = tmp_path / "test_config.json"
        config.save(config_file)

        loaded = BaseDetectorConfig.load(config_file)
        assert loaded.classify == config.classify

    def test_extra_fields_allowed(self) -> None:
        """Test that extra fields are allowed."""
        config = BaseDetectorConfig(custom_field="value")
        assert config.custom_field == "value"  # type: ignore[attr-defined]


def test_public_api_imports() -> None:
    """Test that all public API is importable from package root."""
    from malware_detector import (
        BaseDetector,
        BaseDetectorConfig,
        FolderConfig,
        PathConfig,
        configure_logging,
        create_cli,
        get_logger,
    )

    assert BaseDetector is not None
    assert BaseDetectorConfig is not None
    assert FolderConfig is not None
    assert PathConfig is not None
    assert configure_logging is not None
    assert create_cli is not None
    assert get_logger is not None
