"""Pytest fixtures for malware_detector tests."""

from pathlib import Path

import pytest

from malware_detector import BaseDetector, BaseDetectorConfig


@pytest.fixture
def tmp_config(tmp_path: Path) -> BaseDetectorConfig:
    """Create a config using temporary directories.

    Args:
        tmp_path: Pytest temporary path fixture.

    Returns:
        BaseDetectorConfig with paths set to temporary directories.
    """
    config = BaseDetectorConfig()
    config.path.input = tmp_path / "input"
    config.path.output = tmp_path / "output" / "result.json"
    config.path.config = tmp_path / "config.toml"
    config.folder.dataset = tmp_path / "dataset"
    config.folder.feature = tmp_path / "feature"
    config.folder.vectorize = tmp_path / "vectorize"
    config.folder.model = tmp_path / "model"
    config.folder.predict = tmp_path / "predict"
    return config


@pytest.fixture
def sample_detector_class() -> type[BaseDetector]:
    """Create a minimal detector class for testing.

    Returns:
        A concrete BaseDetector subclass.
    """

    class SampleDetector(BaseDetector):
        """Sample detector implementation for testing."""

        def stage_extract(self) -> str:
            return "extracted"

        def stage_vectorize(self) -> str:
            return "vectorized"

        def stage_train(self) -> str:
            return "trained"

        def stage_predict(self) -> str:
            return "predicted"

    return SampleDetector


@pytest.fixture
def sample_detector(
    sample_detector_class: type[BaseDetector],
    tmp_config: BaseDetectorConfig,
) -> BaseDetector:
    """Create a configured detector instance for testing.

    Args:
        sample_detector_class: The sample detector class fixture.
        tmp_config: The temporary config fixture.

    Returns:
        A configured detector instance with setup() called.
    """
    detector = sample_detector_class(tmp_config)
    detector.setup()
    return detector
