---

name: 'CI'


on:
  push:
    branches:
      - '**'
    tags:
      - '*'

env:
  GIT_SYNC_URL: "https://${{ secrets.GITLAB_USERNAME_ROBOT }}:${{ secrets.GITLAB_TOKEN_ROBOT }}@gitlab.com/nofusscomputing/projects/centurion_erp.git"

jobs:


  python-build:
    name: 'Python Build'
    uses: nofusscomputing/action_python/.github/workflows/python-package.yaml@development

  #
  # See: https://github.com/pypa/gh-action-pypi-publish/issues/166
  # See: https://github.com/pypi/warehouse/issues/11096
  # python-publish:
  #   name: 'Python Build'
  #   uses: nofusscomputing/action_python/.github/workflows/python-publish.yaml@development
  #   if: startsWith(github.ref, 'refs/tags/')
  #   needs:
  #     - python-build
  #   with:
  #     PYTHON_PROJECT_NAME: 
  #   secrets:
  #     password: ${{ secrets.NFC_PYPI_TOKEN }}


  python-publish:
    name: 'Python Publish'
    if: startsWith(github.ref, 'refs/tags/')
    runs-on: ubuntu-latest
    environment:
      name: pypi
      url: https://pypi.org/p/pytest-simplified/
    permissions:
      id-token: write
    needs:
      - python-build
    
    steps:

      - name: Download built artifact to dist/
        uses: actions/download-artifact@v4
        with:
          name: Packages
          path: dist


      - name: Publish package distributions to PyPI
        uses: pypa/gh-action-pypi-publish@release/v1
