<?xml version="1.0" encoding="UTF-8"?>
<odoo>
  <record id="action_liquidacion_ventas_editorial" model="ir.actions.act_window">
      <field name="name">Archivo de liquidaciones de ventas</field>
      <field name="res_model">account.move</field>
      <field name="view_mode">tree,kanban,form</field>
      <field name="view_id" ref="account.view_invoice_tree"/>
      <field name="search_view_id" ref="account.view_account_invoice_filter"/>
      <field name="domain">[
        ('is_liquidacion', '=', True),
        ('move_type', 'in', ['out_invoice', 'out_refund']),
        ('is_sales_deposit_return', '!=', 'True')]
      </field>
      <field name="context">{'default_move_type': 'out_invoice', 'invoice_type': 'LIQ', 'create': False}</field>
  </record>

  <record id="action_liquidacion_compras_editorial" model="ir.actions.act_window">
      <field name="name">Liquidaciones de compras</field>
      <field name="res_model">account.move</field>
      <field name="view_mode">tree,kanban,form</field>
      <field name="view_id" ref="account.view_invoice_tree"/>
      <field name="search_view_id" ref="account.view_account_invoice_filter"/>
      <field name="domain">[('move_type', '=', 'in_invoice'), ('is_liquidacion', '=', True)]</field>
      <field name="context">{'default_move_type': 'in_invoice', 'invoice_type': 'LIQ'}</field>
      <field name="help" type="html">
        <p class="o_view_nocontent_smiling_face">
          Crear una liquidación
        </p><p>
          Crea una liquidación nueva.
        </p>
      </field>
  </record>

  <record id="action_liquidacion_devolucion_ventas_editorial" model="ir.actions.act_window">
    <field name="name">Archivo de devoluciones de depósito (venta)</field>
    <field name="res_model">account.move</field>
    <field name="view_mode">tree,kanban,form</field>
    <field name="view_id" ref="account.view_invoice_tree"/>
    <field name="search_view_id" ref="account.view_account_invoice_filter"/>
    <field name="domain">[('is_sales_deposit_return', '=', 'True')]</field>
    <field name="context">{'default_move_type': 'out_refund', 'invoice_type': 'LIQ', 'create': False}</field>
  </record>

  <record id="action_liquidacion_devolucion_compras_editorial" model="ir.actions.act_window">
    <field name="name">Devoluciones de Depósito (compras)</field>
    <field name="res_model">account.move</field>
    <field name="view_mode">tree,kanban,form</field>
    <field name="view_id" ref="account.view_invoice_tree"/>
    <field name="search_view_id" ref="account.view_account_invoice_filter"/>
    <field name="domain">[('move_type', '=', 'in_refund'), ('is_liquidacion', '=', True)]</field>
    <field name="context">{'default_move_type': 'in_refund', 'invoice_type': 'LIQ'}</field>
    <field name="help" type="html">
      <p class="o_view_nocontent_smiling_face">
        Crear una devolución de depósito (compras)
      </p><p>
        Crea una liquidación de devolución de compras nueva.
      </p>
    </field>
  </record>

  <menuitem
    id="sales_liq_archive_menu"
    name="Archivo"
    parent="sale.sale_menu_root"
    sequence="100"
  />

  <menuitem
    id="purchases_liq_archive_menu"
    name="Archivo"
    parent="purchase.menu_purchase_root"
    sequence="100"
  />

  <menuitem
    id="submenu_liquidacion_sales_archive"
    name="Archivo de liquidaciones de ventas"
    parent="sales_liq_archive_menu"
    sequence="10"
    action="action_liquidacion_ventas_editorial"
    groups="sales_team.group_sale_manager"
    />
  <menuitem
    id="submenu_liquidacion_devolucion_sales"
    name="Archivo de devoluciones de depósito"
    parent="sales_liq_archive_menu"
    sequence="11"
    action="action_liquidacion_devolucion_ventas_editorial"
    groups="sales_team.group_sale_manager"
    />

  <menuitem
    id="submenu_liquidacion_purchase"
    name="Archivo de liquidaciones de compras"
    parent="purchases_liq_archive_menu"
    sequence="10"
    action="action_liquidacion_compras_editorial"
    groups="purchase.group_purchase_manager"
    />
  <menuitem
    id="submenu_liquidacion_devolucion_purchase"
    name="Archivo de devoluciones de depósito"
    parent="purchases_liq_archive_menu"
    sequence="11"
    action="action_liquidacion_devolucion_compras_editorial"
    groups="purchase.group_purchase_manager"
    />

  <!-- HIDE RETURNS OF SALES DEPOSIT FROM RECTIFICATIVE INVOICES VIEW-->
  <record id="account.action_move_out_refund_type" model="ir.actions.act_window">
    <field name="name">Credit Notes</field>
    <field name="res_model">account.move</field>
    <field name="view_mode">tree,kanban,form</field>
    <field name="view_id" ref="account.view_invoice_tree"/>
    <field name="search_view_id" ref="account.view_account_invoice_filter"/>
    <field name="domain">[('move_type', '=', 'out_refund'), ('is_sales_deposit_return', '!=', True)]</field>
    <field name="context">{'default_move_type': 'out_refund'}</field>
    <field name="help" type="html">
      <p class="o_view_nocontent_smiling_face">
        Create a credit note
      </p><p>
        Note that the easiest way to create a credit note is to do it directly
        from the customer invoice.
      </p>
    </field>
  </record>

  <record id="account_move_form_editorial_view" model="ir.ui.view">
    <field name="name">account.move.editorial.form.view</field>
    <field name="model">account.move</field>
    <field name="inherit_id" ref="account.view_move_form"/>
    <field name="arch" type="xml">

      <xpath expr="//field[@name='pricelist_id'][2]" position="attributes">
        <attribute name="invisible">(move_type not in ('out_invoice', 'out_refund') and (is_liquidacion and move_type != 'in_invoice')) or is_sales_deposit_return</attribute>
      </xpath>
      <xpath expr="//span[hasclass('o_form_label')]/field[@name='move_type']" position="attributes">
        <attribute name="invisible">move_type == 'entry' or state == 'draft' or is_sales_deposit_return == True</attribute>
      </xpath>
      <xpath expr="//h1" position="replace">
        <field name="name" invisible="1" readonly="1"/>
        <h1>
          <span invisible="move_type != 'out_invoice' or state != 'draft' or name != '/'">Draft Invoice</span>
          <span invisible="move_type != 'out_refund' or state != 'draft' or name != '/' or is_sales_deposit_return == True">Draft Credit Note</span>
          <span invisible="move_type != 'in_invoice' or state != 'draft' or name != '/'">Draft Bill</span>
          <span invisible="move_type != 'in_refund' or state != 'draft' or name != '/'">Draft Refund</span>
          <span invisible="move_type != 'out_receipt' or state != 'draft' or name != '/'">Draft Sales Receipt</span>
          <span invisible="move_type != 'in_receipt' or state != 'draft' or name != '/'">Draft Purchase Receipt</span>
          <span invisible="state == 'draft' or is_sales_deposit_return == False">Albarán de devolución</span>
          <span invisible="state != 'draft' or is_sales_deposit_return == False">Borrador de Albarán de devolución</span>
        </h1>
      </xpath>

      <xpath expr="//field[@name='journal_id']" position="after">
        <field name="is_liquidacion" invisible="1" readonly="1"/>
        <field name="is_sales_deposit_return" invisible="1" readonly="1"/>
      </xpath>

      <!-- ADD "Barcode / ISBN" in invoice view-->
      <xpath expr="//field[@name='invoice_line_ids']//field[@name='product_id']" position="after">
        <field name="product_barcode"/>
      </xpath>
      <!-- Hide "Etiquetas" in invoice view-->
      <xpath expr="//field[@name='invoice_line_ids']//field[@name='name']" position="attributes">
        <attribute name="optional">hide</attribute>
      </xpath>          

    </field>
  </record>
</odoo>
