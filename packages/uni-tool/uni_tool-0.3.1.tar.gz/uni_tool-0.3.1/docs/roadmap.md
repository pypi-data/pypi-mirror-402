
## 1. ToolExpression 增强

1. 实现 TagSet(ToolExpression) 类，接受一组 Tag 作为参数，用于表示一组 Tag 的组合，与 `Tag("a") | Tag("b") | Tag("c")` 等价。
   - 输入校验：空列表、重复 Tag、非法 Tag
   - 求值语义：短路 OR，保持与手写表达式一致
   - 表达能力：稳定的字符串表示与可读输出
   - 序列化：to_dict/from_dict 支持配置化加载
2. 实现 TagNotSet(ToolExpression) 类，接受一组 Tag 作为参数，用于表示一组 Tag 的 Not 组合，与 `~(Tag("a") | Tag("b") | Tag("c"))` 等价。
   - 输入校验：空列表、重复 Tag、非法 Tag
   - 求值语义：短路 AND，保持与手写表达式一致
   - 表达能力：稳定的字符串表示与可读输出
   - 序列化：to_dict/from_dict 支持配置化加载
3. 表达式规范化与简化：扁平化、去重、德摩根转换、常量折叠
4. 表达式解析器与 DSL：支持括号、优先级、Tag 集合语法
5. 诊断信息：输出命中路径与拒绝原因，便于调试过滤逻辑
6. 编译与缓存：注册阶段编译谓词并缓存，避免重复解析
7. 批量评估接口：一条表达式对多工具的高效匹配
8. 标签匹配扩展：命名空间、前缀匹配、别名与正则匹配

## 2. driver 增强

1. 实现 anthropic_driver.py 文件，实现 AnthropicDriver 类，用于实现 Anthropic 的协议驱动。
   - 请求与响应结构映射
   - 工具调用与工具结果映射
   - 流式增量输出与中断处理
   - 错误映射、重试与超时策略
   - token 统计与使用量回传
2. 实现 gemini_driver.py 文件，实现 GeminiDriver 类，用于实现 Gemini 的协议驱动。
   - 请求与响应结构映射
   - 工具调用与工具结果映射
   - 流式增量输出与中断处理
   - 错误映射、重试与超时策略
   - token 统计与使用量回传
3. 实现 markdown_driver.py 文件，实现 MarkdownDriver 类，用于实现 Markdown 的协议驱动。
   - 输入解析：从 Markdown 中抽取角色与内容
   - 输出渲染：将执行结果与工具调用渲染为 Markdown
   - 代码块约定：明确工具调用与参数的格式
4. 实现 xml_driver.py 文件，实现 XMLDriver 类，用于实现 XML 的协议驱动。
   - 输入解析：基于 XML 标签抽取角色与内容
   - 输出渲染：将执行结果与工具调用渲染为 XML
   - Schema 校验与安全解析（禁用外部实体）
5. Driver 公共能力增强：统一超时/重试/幂等、统一错误码映射、统一能力描述

## 3. middleware 增强
1. 鉴权中间件：基于用户、租户、Tag 与工具的策略控制
2. 速率限制中间件：按用户/租户/工具粒度限制 QPS 与并发
3. 超时与熔断中间件：保护下游服务稳定性
4. 缓存中间件：幂等工具调用结果缓存，支持 TTL 与键规则
5. 审计与脱敏中间件：敏感字段遮蔽与结构化审计日志
6. 观测性中间件：指标、追踪与日志关联
7. 输入校验中间件：schema 校验、体积上限、非法字段拦截
8. 输出过滤中间件：敏感内容过滤与安全重写
9. 并发隔离中间件：按标签或工具隔离资源池
