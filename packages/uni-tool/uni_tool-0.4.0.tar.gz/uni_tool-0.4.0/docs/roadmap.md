
## 1. ToolExpression 增强

[x] 1. 表达式规范化与简化：扁平化、去重、德摩根转换、常量折叠
[x] 2. 表达式解析器与 DSL：支持括号、优先级、Tag 表达式语法, 支持 DSL 字符串直接解析为表达式，包含 `^tool_.*` 与 `` `tool_name` `` 的简写形式。使用 Lark 库实现 DSL 解析。
[x] 3. 诊断信息：输出命中路径与拒绝原因，便于调试过滤逻辑
[ ] 4. 编译与缓存：注册阶段编译谓词并缓存，避免重复解析
[ ] 5. 批量评估接口：一条表达式对多工具的高效匹配
[x] 6. 标签匹配扩展：前缀匹配
[ ] 7. 标签匹配扩展：命名空间、别名与正则匹配

## 2. driver 增强

[x] 1. 实现 anthropic_driver.py 文件，实现 AnthropicDriver 类，用于实现 Anthropic 的协议驱动。
   - [x] 请求与响应结构映射
   - [x] 工具调用与工具结果映射
   - [ ] 流式增量输出与中断处理
   - [ ] 错误映射、重试与超时策略
   - [ ] token 统计与使用量回传
[x] 2. 实现 gemini_driver.py 文件，实现 GeminiDriver 类，用于实现 Gemini 的协议驱动。
   - [x] 请求与响应结构映射
   - [x] 工具调用与工具结果映射
   - [ ] 流式增量输出与中断处理
   - [ ] 错误映射、重试与超时策略
   - [ ] token 统计与使用量回传
[x] 3. 实现 markdown_driver.py 文件，实现 MarkdownDriver 类，用于实现 Markdown 的协议驱动。
   - [x] 输入解析：从 Markdown 中抽取角色与内容
   - [x] 输出渲染：将执行结果与工具调用渲染为 Markdown
   - [x] 代码块约定：明确工具调用与参数的格式
[x] 4. 实现 xml_driver.py 文件，实现 XMLDriver 类，用于实现 XML 的协议驱动。
   - [x] 输入解析：基于 XML 标签抽取角色与内容
   - [x] 输出渲染：将执行结果与工具调用渲染为 XML
   - [ ] Schema 校验与安全解析（禁用外部实体）
[ ] 5. Driver 公共能力增强：统一超时/重试/幂等、统一错误码映射、统一能力描述

## 3. middleware 增强
[ ] 1. 鉴权中间件：基于用户、租户、Tag 与工具的策略控制
[ ] 2. 速率限制中间件：按用户/租户/工具粒度限制 QPS 与并发
[ ] 3. 超时与熔断中间件：保护下游服务稳定性
[ ] 4. 缓存中间件：幂等工具调用结果缓存，支持 TTL 与键规则
[x] 5. 审计与脱敏中间件：敏感字段遮蔽与结构化审计日志
[x] 6. 观测性中间件：指标、追踪与日志关联
[ ] 7. 输入校验中间件：schema 校验、体积上限、非法字段拦截
[ ] 8. 输出过滤中间件：敏感内容过滤与安全重写
[ ] 9. 并发隔离中间件：按标签或工具隔离资源池
