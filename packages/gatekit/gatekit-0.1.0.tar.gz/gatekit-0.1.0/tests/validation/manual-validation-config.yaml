# Manual Validation Configuration
# This config includes all 8 plugin types for comprehensive manual testing
#
# Plugins configured:
# 1. basic_pii_filter - PII detection and redaction
# 2. basic_secrets_filter - Secrets detection and redaction
# 3. basic_prompt_injection_defense - Prompt injection protection
# 4. tool_manager - Tool filtering and blocking
# 5. call_trace - Request/response tracing middleware
# 6. audit_jsonl - JSONL audit logging
# 7. audit_csv - CSV audit logging
# 8. audit_human_readable - Human-readable console logging

logging:
  level: DEBUG
  handlers: ["stderr", "file"]
  file_path: "logs/validation.log"

proxy:
  transport: stdio

  upstreams:
    - name: filesystem
      transport: stdio
      command:
        - npx
        - -y
        - "@modelcontextprotocol/server-filesystem"
        - "/Users/dbright/mcp/gatekit"

plugins:
  security:
    _global:
      - handler: basic_pii_filter
        config:
          enabled: true
          priority: 10
          action: redact
          pii_types:
            email: {enabled: true}
            phone: {enabled: true}
            national_id: {enabled: true}
            credit_card: {enabled: true}
            ip_address: {enabled: true}
          scan_base64: true

      - handler: basic_secrets_filter
        config:
          enabled: true
          priority: 15
          action: redact
          secret_types:
            aws_access_keys: {enabled: true}
            github_tokens: {enabled: true}
            google_api_keys: {enabled: true}
            jwt_tokens: {enabled: true}
            slack_tokens: {enabled: true}
            ssh_private_keys: {enabled: true}
          entropy_detection:
            enabled: true
            threshold: 4.5
            min_length: 20
          scan_base64: true  # Enable for validation - disabled by default due to false positives

      - handler: basic_prompt_injection_defense
        config:
          enabled: true
          priority: 20
          action: redact
          sensitivity: standard
          detection_methods:
            delimiter_injection: {enabled: true}
            role_manipulation: {enabled: true}
            context_hijacking: {enabled: true}

  middleware:
    filesystem:  # tool_manager is server-aware, cannot be in _global
      - handler: tool_manager
        config:
          enabled: true
          priority: 30
          tools:
            - tool: read_file
            - tool: read_text_file
            - tool: read_multiple_files
            - tool: list_directory
            - tool: get_file_info
            - tool: search_files

      - handler: call_trace
        config:
          enabled: true
          priority: 40
          max_param_length: 200
          trace_fields:
            server: true
            tool: true
            params: true
            response_size: true
            duration: true
            request_id: true
            timestamp: true

  auditing:
    _global:
      - handler: audit_jsonl
        config:
          enabled: true
          output_file: /tmp/gatekit-validation/audit.jsonl
          include_request_body: false
          include_response_body: false
          include_notification_body: false
          max_body_size: 10240

      - handler: audit_csv
        config:
          enabled: true
          output_file: /tmp/gatekit-validation/audit.csv
          csv_config:
            delimiter: ","
            quote_style: minimal

      - handler: audit_human_readable
        config:
          enabled: true
          output_file: /tmp/gatekit-validation/audit.log
