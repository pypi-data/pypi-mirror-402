(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3680],{95372:function(e){e.exports=function(e,a,t,i){for(var s=e.length,n=t+(i?1:-1);i?n--:++n<s;)if(a(e[n],n,e))return n;return -1}},97181:function(e,a,t){"use strict";t.d(a,{d:function(){return o}});var i=t(24246),s=t(10034),n=t(34090),r=t(27378),l=t(46238),d=t(40324);let o=e=>{let{name:a,label:t,labelProps:o,tooltip:c,isRequired:u,layout:m="inline",helperText:h,...p}=e,[y,x,{setValue:j}]=(0,n.U$)(a),f=!!(x.touched&&x.error),[g,v]=(0,r.useState)("");y.value||"tags"!==p.mode&&"multiple"!==p.mode||(y.value=[]),"tags"===p.mode&&"string"==typeof y.value&&(y.value=[y.value]);let b="tags"===p.mode?(e,a)=>e?e.value!==g||y.value.includes(g)?p.optionRender?p.optionRender(e,a):e.label:'Create "'.concat(g,'"'):void 0:p.optionRender||void 0,_=e=>{v(e),p.onSearch&&p.onSearch(e)},D=(e,a)=>{j(e),p.onChange&&p.onChange(e,a)};return"inline"===m?(0,i.jsx)(s.DTt,{isInvalid:f,isRequired:u,children:(0,i.jsxs)(s.MoG,{templateColumns:t?"1fr 3fr":"1fr",children:[t?(0,i.jsx)(d.__,{htmlFor:p.id||a,...o,children:t}):null,(0,i.jsxs)(s.kCb,{align:"center",children:[(0,i.jsxs)(s.kCb,{vertical:!0,flex:1,className:"mr-2",children:[(0,i.jsx)(s.PhF,{...y,id:p.id||a,"data-testid":"controlled-select-".concat(y.name),...p,optionRender:b,onSearch:"tags"===p.mode?_:void 0,onChange:D,value:y.value||void 0,status:f?"error":void 0}),h&&(0,i.jsx)(s.Kug,{children:h}),(0,i.jsx)(d.Bc,{isInvalid:f,message:x.error,fieldName:y.name})]}),(0,i.jsx)(l.b,{label:c,className:f?"mt-2 self-start":void 0})]})]})}):(0,i.jsx)(s.DTt,{isInvalid:f,isRequired:u,children:(0,i.jsxs)(s.s_g,{alignItems:"start",children:[(0,i.jsxs)(s.kCb,{align:"center",children:[t?(0,i.jsx)(d.__,{htmlFor:p.id||a,fontSize:"xs",my:0,mr:1,...o,children:t}):null,(0,i.jsx)(l.b,{label:c})]}),(0,i.jsx)(s.PhF,{...y,id:p.id||a,"data-testid":"controlled-select-".concat(y.name),...p,optionRender:b,onSearch:"tags"===p.mode?_:void 0,onChange:D,value:y.value||void 0,status:f?"error":void 0}),h&&(0,i.jsx)(s.Kug,{style:{marginTop:0},children:h}),(0,i.jsx)(d.Bc,{isInvalid:f,message:x.error,fieldName:y.name})]})})}},35258:function(e,a,t){"use strict";t.d(a,{Z:function(){return J}});var i=t(24246),s=t(10034),n=t(27378),r=t(84720),l=t(52368),d=t(812),o=t(46628),c=t(65450),u=t(31883),m=t(34090),h=t(45938),p=t(33162),y=t(55484),x=t(20987),j=t(97181),f=t(40324);let g=y.Ry().shape({data_categories:y.IX(y.Z_()).min(1,"Must assign at least one data category").label("Data categories"),data_use:y.Z_().required().label("Data use"),data_subjects:y.IX(y.Z_()).min(1,"Must assign at least one data subject").label("Data subjects")}),v={data_categories:[],data_subjects:[],data_use:"",dataset_references:[],customFieldValues:{},id:""},b=e=>{var a;let{customFieldValues:t,...i}=e;return{...i,name:null!==(a=e.name)&&void 0!==a?a:""}},_=e=>{let{allDataUses:a,allDataCategories:t,allDataSubjects:n,allDatasets:r,privacyDeclarationId:l,includeCustomFields:d}=e,o=r?r.map(e=>{var a;return{label:null!==(a=e.name)&&void 0!==a?a:e.fides_key,value:e.fides_key}}):[];return(0,i.jsxs)(s.EO$,{spacing:4,children:[(0,i.jsx)(j.d,{id:"data_use",label:"Data use",name:"data_use",options:a.map(e=>({value:e.fides_key,label:e.fides_key})),tooltip:"What is the system using the data for. For example, is it for third party advertising or perhaps simply providing system operations.",layout:"stacked",disabled:!!l}),(0,i.jsx)(f.j0,{id:"name",label:"Processing Activity",name:"name",variant:"stacked",tooltip:"The personal data processing activity or activities associated with this data use.",disabled:!!l}),(0,i.jsx)(j.d,{name:"data_categories",label:"Data categories",options:t.map(e=>({value:e.fides_key,label:e.fides_key})),tooltip:"What type of data is your system processing? This could be various types of user or system data.",mode:"multiple",layout:"stacked",disabled:!0}),(0,i.jsx)(j.d,{name:"data_subjects",label:"Data subjects",options:n.map(e=>({value:e.fides_key,label:e.fides_key})),tooltip:"Whose data are you processing? This could be customers, employees or any other type of user in your system.",mode:"multiple",layout:"stacked",disabled:!0}),r?(0,i.jsx)(j.d,{name:"dataset_references",label:"Dataset references",options:o,tooltip:"Referenced Dataset fides keys used by the system.",mode:"multiple",layout:"stacked"}):null,d?(0,i.jsx)(p.uc,{resourceType:x.J.PRIVACY_DECLARATION,resourceFidesKey:l}):null]})},D=(e,a)=>e?{...e,customFieldValues:a||{}}:v,S=e=>{let{onSubmit:a,initialValues:t,allDataUses:r,privacyDeclarationId:l}=e,{customFieldValues:d,upsertCustomFields:o}=(0,p.mZ)({resourceType:x.J.PRIVACY_DECLARATION,resourceFidesKey:l}),c=(0,n.useMemo)(()=>D(t,d),[t,d]),[u,m]=(0,n.useState)(!1),h=(0,n.useMemo)(()=>{let e=r.filter(e=>e.fides_key===c.data_use)[0];if(e)return c.name?"".concat(e.name," - ").concat(c.name):e.name},[r,c]);return{handleSubmit:async(e,t)=>{let{customFieldValues:i}=e,s=b(e),n=await a(s,t);if(n){let a=n.filter(a=>a.data_use===e.data_use&&(!a.name||a.name===e.name));a.length>0&&await o({customFieldValues:i,fides_key:a[0].id}),t.resetForm({values:e}),m(!0)}},renderHeader:e=>{let{dirty:a,boxProps:t,hideSaved:n}=e;return(0,i.jsxs)(s.TJV,{display:"flex",alignItems:"center",justifyContent:"space-between",...t,children:[h?(0,i.jsx)(s.y_b,{as:"h4",size:"xs",fontWeight:"medium",mr:4,children:h}):null,!n&&u&&!a&&c.data_use?(0,i.jsxs)(s.Bjg,{fontSize:"sm","data-testid":"saved-indicator",children:[(0,i.jsx)(s.StI,{})," Saved"]}):null]})},initialValues:c}},k=e=>{let{onSubmit:a,initialValues:t,onDelete:n,...r}=e,{handleSubmit:l,renderHeader:d,initialValues:o}=S({onSubmit:a,initialValues:t,allDataUses:r.allDataUses,privacyDeclarationId:null==t?void 0:t.id});return(0,i.jsx)(m.J9,{enableReinitialize:!0,initialValues:o,onSubmit:l,validationSchema:g,children:e=>{let{dirty:a}=e;return(0,i.jsxs)(m.l0,{children:[(0,i.jsx)(h.Gt,{id:"PrivacyDeclaration",name:"New Privacy Declaration"}),(0,i.jsxs)(s.EO$,{spacing:4,children:[(0,i.jsx)(s.TJV,{"data-testid":"header",children:d({dirty:a})}),(0,i.jsx)(_,{onDelete:n,...r})]})]})}})},C=e=>{let{privacyDeclaration:a,onEdit:t,onDelete:n,includeCustomFields:r,...l}=e,{initialValues:d,renderHeader:o,handleSubmit:c}=S({initialValues:a,onSubmit:e=>t(a,e),privacyDeclarationId:a.id,...l});return(0,i.jsx)(s.nCC,{children:e=>{let{isExpanded:t}=e;return(0,i.jsx)(m.J9,{enableReinitialize:!0,initialValues:d,onSubmit:c,validationSchema:g,children:e=>{let{dirty:d}=e;return(0,i.jsxs)(m.l0,{"data-testid":"".concat(a.data_use,"-form"),children:[(0,i.jsx)(h.Gt,{id:"".concat(a.id,"-form"),name:a.id}),(0,i.jsxs)(s.rKS,{py:4,borderBottomWidth:t?"0px":"1px",backgroundColor:t?"gray.50":void 0,"data-testid":"accordion-header-".concat(a.data_use),children:[o({dirty:d,boxProps:{flex:"1",textAlign:"left"},hideSaved:!t}),(0,i.jsx)(s.UhW,{})]}),(0,i.jsx)(s.rnb,{backgroundColor:"gray.50",pt:0,children:(0,i.jsx)(s.EO$,{spacing:4,children:(0,i.jsx)(_,{privacyDeclarationId:a.id,onDelete:n,includeCustomFields:r,...l})})})]})}})}})};var V=e=>{let{privacyDeclarations:a,...t}=e;return(0,i.jsx)(s.NvE,{allowToggle:!0,border:"transparent","data-testid":"privacy-declaration-accordion",children:a.map(e=>(0,i.jsx)(C,{privacyDeclaration:e,...t},e.id))})},T=e=>{let{system:a,includeCustomFields:t,onSave:r,...l}=e,m=(0,s.p8r)(),[h]=(0,c.qQ)(),[p,y]=(0,n.useState)(!1),[x,j]=(0,n.useState)(void 0),f=(0,n.useMemo)(()=>x?a.privacy_declarations.filter(e=>e.id!==x.id):a.privacy_declarations,[x,a]),g=e=>f.filter(a=>a.data_use===e.data_use&&a.name===e.name).length>0&&(m((0,o.Vo)("A declaration already exists with that data use in this system. Please supply a different data use.")),!0),v=async(e,t)=>{let i=e.map(e=>{var a;return{...e,name:null!==(a=e.name)&&void 0!==a?a:""}}),s={...a,privacy_declarations:i};return(e=>{if((0,u.D4)(e)){let a=(0,d.e$)(e.error,"An unexpected error occurred while updating the system. Please try again.");m((0,o.Vo)(a));return}return m.closeAll(),m((0,o.t5)(t?"Data use deleted":"Data use saved")),r&&r(e.data),e.data.privacy_declarations})(await h(s))},b=async(e,t)=>{if(!(t.id!==e.id&&g(t)))return v(a.privacy_declarations.map(a=>a.id===e.id?t:a))},_=async e=>{if(g(e))return;m.closeAll();let a=[...f,e],t=await v(a);return t&&j(t.filter(a=>(!a.name||a.name===e.name)&&a.data_use===e.data_use)[0]),t},D=async e=>v(a.privacy_declarations.filter(a=>a.id!==e.id),!0),S=async e=>{let a=await D(e);return a&&(y(!1),j(void 0)),a};return(0,n.useEffect)(()=>{y(!1)},[a.fides_key]),(0,i.jsxs)(s.EO$,{spacing:3,children:[(0,i.jsx)(V,{privacyDeclarations:f,onEdit:b,onDelete:D,includeCustomFields:t,...l}),p?(0,i.jsx)(s.TJV,{backgroundColor:"gray.50",p:4,"data-testid":"new-declaration-form",children:(0,i.jsx)(k,{initialValues:x,onSubmit:_,onDelete:S,includeCustomFields:t,...l})}):null,0===a.privacy_declarations.length?(0,i.jsx)(s.Bjg,{fontSize:"sm",lineHeight:5,fontWeight:"medium",pl:2,children:"No data uses"}):null]})},w=t(19043);let I=e=>{let[a]=(0,c.dB)(),t=(0,s.p8r)();return{handleUpsertSystem:async(i,s)=>{let n=[{...e,name:i.name,description:i.description}],r=await a(n);(0,w.D4)(r)?t((0,o.Vo)((0,d.e$)(r.error))):(t((0,o.t5)("Successfully saved system info")),s.resetForm({values:i}))},validationSchema:y.Ry().shape({name:y.Z_().required().label("Name"),description:y.Z_().required().label("Description")})}},R={name:"",description:""};var F=e=>{let{system:a}=e,t="/systems/configure/".concat(a.fides_key),{handleUpsertSystem:n,validationSchema:r}=I(a);return(0,i.jsxs)(s.TJV,{children:[(0,i.jsxs)(s.ad9,{alignItems:"center",children:[(0,i.jsx)(s.Bjg,{color:"gray.600",size:"md",lineHeight:6,fontWeight:"semibold",marginBottom:2,children:"System details"}),(0,i.jsx)(s.s3C,{}),(0,i.jsxs)(s._pl,{color:"complimentary.500",href:t,children:["View more",(0,i.jsx)(s.Cgm,{ml:2})]})]}),(0,i.jsx)(s.TJV,{width:"100%",padding:4,borderTop:"1px solid",borderColor:"gray.200",children:(0,i.jsx)(m.J9,{enableReinitialize:!0,initialValues:null!=a?a:R,validationSchema:r,onSubmit:n,children:()=>(0,i.jsxs)(m.l0,{children:[(0,i.jsx)(h.Gt,{id:"SystemInfoDrawer",name:"System Info"}),(0,i.jsx)(s.TJV,{marginTop:3,children:(0,i.jsx)(f.j0,{label:"System name",name:"name",variant:"stacked",disabled:!0})}),(0,i.jsx)(s.TJV,{marginTop:3,children:(0,i.jsx)(f.Ks,{label:"System description",name:"description",variant:"stacked",disabled:!0})})]})})})]})},J=e=>{var a;let{selectedSystemId:t,resetSelectedSystemId:d}=e,o=(0,n.useMemo)(()=>!!t,[t]),{...u}=(0,l.f)({includeDatasets:!1,includeDisabled:!1}),{data:m,isLoading:h}=(0,c.rn)(t,{skip:!t});return(0,i.jsx)(s.dys,{open:o,onClose:d,placement:"right",width:480,title:null!==(a=null==m?void 0:m.name)&&void 0!==a?a:"System Information",loading:h,children:m?(0,i.jsxs)("div",{"data-testid":"datamap-drawer",children:[(0,i.jsx)(F,{system:m}),(0,i.jsx)(s.Bjg,{size:"md",color:"gray.600",lineHeight:6,fontWeight:"semibold",mt:"10px",mb:2,children:"Data uses"}),(0,i.jsx)(s.TJV,{borderTop:"1px solid",borderColor:"gray.200",children:(0,i.jsx)(s.TJV,{pb:3,children:(0,i.jsx)(T,{system:m,...u})})}),(0,i.jsx)(s.Bjg,{size:"md",color:"gray.600",lineHeight:6,fontWeight:"semibold",mt:"10px",mb:2,paddingBottom:2,children:"Data flow"}),(0,i.jsx)(r.q,{system:m})]}):null})}},57072:function(e,a,t){"use strict";t.d(a,{Bd:function(){return i.Bd},L5:function(){return i.L5},MO:function(){return i.MO},qb:function(){return i.qb}});var i=t(5785)}}]);