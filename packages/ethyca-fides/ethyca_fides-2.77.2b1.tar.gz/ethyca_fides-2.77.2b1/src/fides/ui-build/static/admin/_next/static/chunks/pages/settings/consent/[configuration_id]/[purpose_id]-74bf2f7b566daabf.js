(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5135],{77713:function(e,t,i){(window.__NEXT_P=window.__NEXT_P||[]).push(["/settings/consent/[configuration_id]/[purpose_id]",function(){return i(25805)}])},35287:function(e,t,i){"use strict";var r=i(24246),n=i(10034),s=i(88038),o=i.n(s);i(27378),t.Z=e=>{let{children:t,title:i,fullHeight:s,fullWidth:d,mainProps:l}=e;return(0,r.jsxs)(n.ad9,{"data-testid":i,direction:"column",height:s?"100vh":"calc(100vh - 48px)",width:d?"100vw":"calc(100vw - 240px)",children:[(0,r.jsxs)(o(),{children:[(0,r.jsxs)("title",{children:["Fides Admin UI - ",i]}),(0,r.jsx)("meta",{name:"description",content:"Privacy Engineering Platform"}),(0,r.jsx)("link",{rel:"icon",href:"/favicon.ico"})]}),(0,r.jsx)(n.ad9,{px:10,py:6,as:"main",overflow:"auto",direction:"column",flex:1,minWidth:0,...l,children:t})]})}},97181:function(e,t,i){"use strict";i.d(t,{d:function(){return a}});var r=i(24246),n=i(10034),s=i(34090),o=i(27378),d=i(46238),l=i(40324);let a=e=>{let{name:t,label:i,labelProps:a,tooltip:c,isRequired:u,layout:p="inline",helperText:v,...h}=e,[_,m,{setValue:x}]=(0,s.U$)(t),f=!!(m.touched&&m.error),[I,E]=(0,o.useState)("");_.value||"tags"!==h.mode&&"multiple"!==h.mode||(_.value=[]),"tags"===h.mode&&"string"==typeof _.value&&(_.value=[_.value]);let R="tags"===h.mode?(e,t)=>e?e.value!==I||_.value.includes(I)?h.optionRender?h.optionRender(e,t):e.label:'Create "'.concat(I,'"'):void 0:h.optionRender||void 0,g=e=>{E(e),h.onSearch&&h.onSearch(e)},y=(e,t)=>{x(e),h.onChange&&h.onChange(e,t)};return"inline"===p?(0,r.jsx)(n.DTt,{isInvalid:f,isRequired:u,children:(0,r.jsxs)(n.MoG,{templateColumns:i?"1fr 3fr":"1fr",children:[i?(0,r.jsx)(l.__,{htmlFor:h.id||t,...a,children:i}):null,(0,r.jsxs)(n.kCb,{align:"center",children:[(0,r.jsxs)(n.kCb,{vertical:!0,flex:1,className:"mr-2",children:[(0,r.jsx)(n.PhF,{..._,id:h.id||t,"data-testid":"controlled-select-".concat(_.name),...h,optionRender:R,onSearch:"tags"===h.mode?g:void 0,onChange:y,value:_.value||void 0,status:f?"error":void 0}),v&&(0,r.jsx)(n.Kug,{children:v}),(0,r.jsx)(l.Bc,{isInvalid:f,message:m.error,fieldName:_.name})]}),(0,r.jsx)(d.b,{label:c,className:f?"mt-2 self-start":void 0})]})]})}):(0,r.jsx)(n.DTt,{isInvalid:f,isRequired:u,children:(0,r.jsxs)(n.s_g,{alignItems:"start",children:[(0,r.jsxs)(n.kCb,{align:"center",children:[i?(0,r.jsx)(l.__,{htmlFor:h.id||t,fontSize:"xs",my:0,mr:1,...a,children:i}):null,(0,r.jsx)(d.b,{label:c})]}),(0,r.jsx)(n.PhF,{..._,id:h.id||t,"data-testid":"controlled-select-".concat(_.name),...h,optionRender:R,onSearch:"tags"===h.mode?g:void 0,onChange:y,value:_.value||void 0,status:f?"error":void 0}),v&&(0,r.jsx)(n.Kug,{style:{marginTop:0},children:v}),(0,r.jsx)(l.Bc,{isInvalid:f,message:m.error,fieldName:_.name})]})})}},25805:function(e,t,i){"use strict";i.r(t),i.d(t,{default:function(){return A}});var r=i(24246),n=i(10034),s=i(86677),o=i(27378),d=i(59301),l=i(35287),a=i(58754),c=i(6675),u=i(51263),p=i(59512),v=i(24813),h=i(60240),_=i(812),m=i(46628),x=i(58452),f=i(34090),I=i(55484),E=i(97181),R=i(8133),g=i(52955);let y=e=>{if(/^\d+$/.test(e))return!0;let t=e.match(/^(\d+)-(\d+)$/);return!!t&&parseInt(t[1],10)<parseInt(t[2],10)},C=e=>{if(/^\d+$/.test(e)){let t=parseInt(e,10);return{start:t,end:t}}let t=e.match(/^(\d+)-(\d+)$/);return t?{start:parseInt(t[1],10),end:parseInt(t[2],10)}:null},j=(e,t)=>e.end===e.start?e.start>=t.start&&(null===t.end||e.start<=t.end):t.end===t.start?t.start>=e.start&&(null===e.end||t.start<=e.end):null===e.end&&null!==t.end?e.start<=t.end:null===t.end&&null!==e.end?t.start<=e.end:null===e.end&&null===t.end||e.start<=t.end&&e.end>=t.start||t.start<=e.end&&t.end>=e.start,S=(e,t)=>e.end===e.start?e.start>=t.start&&(null===t.end||e.start<=t.end):null===t.end?e.start>=t.start:null!==e.end&&e.start>=t.start&&e.end<=t.end,T=(e,t,i,r)=>{var n;let s=t.filter(e=>e.purpose_id===i&&e.id!==r);if(!(null===(n=e.vendor_ids)||void 0===n?void 0:n.length))return!1;let o=e.vendor_ids.map(C).filter(e=>null!==e);return 0!==o.length&&s.some(t=>{let i=e.vendor_restriction===h.PY.RESTRICT_SPECIFIC_VENDORS&&t.vendor_restriction===h.PY.ALLOW_SPECIFIC_VENDORS||e.vendor_restriction===h.PY.ALLOW_SPECIFIC_VENDORS&&t.vendor_restriction===h.PY.RESTRICT_SPECIFIC_VENDORS,r=t.vendor_ids.map(C).filter(e=>null!==e);return i?e.vendor_restriction===h.PY.ALLOW_SPECIFIC_VENDORS?r.some(e=>o.some(t=>!S(e,t))):o.some(e=>r.some(t=>!S(e,t))):t.vendor_restriction===e.vendor_restriction&&o.some(e=>r.some(t=>j(e,t)))})},b=e=>{if(/^\d+$/.test(e))return{start_vendor_id:parseInt(e,10),end_vendor_id:null};let t=e.match(/^(\d+)-(\d+)$/);if(t){let e=parseInt(t[1],10),i=parseInt(t[2],10);if(e<i)return{start_vendor_id:e,end_vendor_id:i}}return null},N=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return e.map(b).filter(e=>null!==e)},F="This restriction type is already in use for this purpose",P={restriction_type:"",vendor_restriction:"",vendor_ids:[]},O=e=>{let{isOpen:t,onClose:i,initialValues:s=P,existingRestrictions:o=[],purposeId:d,restrictionId:l,configurationId:a}=e,c=(0,n.p8r)(),[u]=(0,g.a_)(),[v]=(0,g.h3)(),x=!(d&&p.Py.includes(+d)),C=o.filter(e=>e.id!==l).map(e=>e.restriction_type),j=[{value:h.FF.PURPOSE_RESTRICTION,label:p.fj[h.FF.PURPOSE_RESTRICTION],disabled:C.includes(h.FF.PURPOSE_RESTRICTION),title:C.includes(h.FF.PURPOSE_RESTRICTION)?F:void 0},{value:h.FF.REQUIRE_CONSENT,label:p.fj[h.FF.REQUIRE_CONSENT],disabled:C.includes(h.FF.REQUIRE_CONSENT),title:C.includes(h.FF.REQUIRE_CONSENT)?F:void 0},{value:h.FF.REQUIRE_LEGITIMATE_INTEREST,label:p.fj[h.FF.REQUIRE_LEGITIMATE_INTEREST],disabled:C.includes(h.FF.REQUIRE_LEGITIMATE_INTEREST),title:C.includes(h.FF.REQUIRE_LEGITIMATE_INTEREST)?F:void 0}],S=[{value:h.PY.RESTRICT_ALL_VENDORS,label:p.Cu[h.PY.RESTRICT_ALL_VENDORS],disabled:C.length>0,title:C.length>0?"Cannot restrict all vendors when other restrictions exist":void 0},{value:h.PY.RESTRICT_SPECIFIC_VENDORS,label:p.Cu[h.PY.RESTRICT_SPECIFIC_VENDORS]},{value:h.PY.ALLOW_SPECIFIC_VENDORS,label:p.Cu[h.PY.ALLOW_SPECIFIC_VENDORS]}],b=I.Ry().shape({restriction_type:I.Z_().required("Restriction type is required"),vendor_restriction:I.Z_().required("Vendor restriction is required"),vendor_ids:I.IX().when("vendor_restriction",{is:e=>e!==h.PY.RESTRICT_ALL_VENDORS,then:e=>e.required("At least one vendor ID is required").min(1,"At least one vendor ID is required").test("valid-format","Vendor IDs must be numbers or ranges (e.g., 10 or 15-300)",e=>{var t;return null===(t=null==e?void 0:e.every(e=>y(e)))||void 0===t||t}).test("no-conflicts","One or more of these vendors already have a restriction for this purpose. Please update the existing restriction or remove duplicates.",(e,t)=>!T({...t.parent,vendor_ids:e},o,d,l))})}),O=async e=>{try{let t={restriction_type:e.restriction_type,vendor_restriction:e.vendor_restriction,range_entries:e.vendor_restriction!==h.PY.RESTRICT_ALL_VENDORS?N(e.vendor_ids):[]},r={...t,purpose_id:null!=d?d:0};if(l){let e=await v({configuration_id:a,restriction_id:l,restriction:t});if((0,_.D4)(e)){c((0,m.Vo)("Failed to update restriction"));return}c((0,m.t5)("Restriction updated successfully"))}else{let e=await u({configuration_id:a,restriction:r});if((0,_.D4)(e)){c((0,m.Vo)("Failed to create restriction"));return}c((0,m.t5)("Restriction created successfully"))}i()}catch(e){c((0,m.Vo)("Failed to save restriction"))}};return(0,r.jsx)(R.Z,{isOpen:t,onClose:i,title:"Edit restriction",children:(0,r.jsx)(f.J9,{initialValues:{...s,restriction_type:x?s.restriction_type:h.FF.PURPOSE_RESTRICTION},onSubmit:O,validationSchema:b,children:e=>{let{values:t,validateField:s,setTouched:o}=e;return(0,r.jsx)(f.l0,{children:(0,r.jsxs)(n.kCb,{vertical:!0,className:"gap-6",children:[(0,r.jsx)(n.Bjg,{className:"text-sm",children:"Define how specific vendors are restricted from processing data for this purpose. Select a restriction type, set whether the listed vendors are restricted or allowed, and specify which vendor IDs the restriction applies to."}),(0,r.jsx)(n.ua7,{title:x?void 0:"Non-flexible purposes only support Purpose restrictions and cannot be restricted by consent or legitimate interest settings.",children:(0,r.jsx)(E.d,{name:"restriction_type",label:"Restriction type",options:j,layout:"stacked",tooltip:"Choose how vendors are permitted to process data for this purpose. This setting overrides the vendor's declared legal basis in the Global Vendor List.",isRequired:!0,disabled:!x,className:"w-full"})}),(0,r.jsx)(E.d,{name:"vendor_restriction",label:"Vendor restriction",options:S,layout:"stacked",tooltip:"Decide if the restriction applies to all vendors, specific vendors, or if only certain vendors are allowed.",isRequired:!0}),(0,r.jsx)(n.$cs,{in:!!t.restriction_type&&!!t.vendor_restriction&&t.vendor_restriction!==h.PY.RESTRICT_ALL_VENDORS,animateOpacity:!0,children:(0,r.jsx)(E.d,{name:"vendor_ids",label:"Vendor IDs",mode:"tags",options:[],layout:"stacked",placeholder:"Enter vendor IDs",open:!1,suffixIcon:(0,r.jsx)("span",{}),tooltip:"List the specific vendors that are restricted or allowed from processing data for this purpose.",disabled:t.vendor_restriction===h.PY.RESTRICT_ALL_VENDORS,tokenSeparators:[","," "],onBlur:()=>{setTimeout(()=>{o({vendor_ids:!0}),s("vendor_ids")},100)},helperText:"Enter IDs (e.g. 123) or ranges (e.g. 1-10) and press enter",isRequired:!0})}),(0,r.jsxs)(n.kCb,{justify:"flex-end",className:"gap-3 pt-4",children:[(0,r.jsx)(n.zxk,{onClick:i,"data-testid":"cancel-restriction-button",children:"Cancel"}),(0,r.jsx)(n.zxk,{type:"primary",htmlType:"submit","data-testid":"save-restriction-button",children:"Save"})]})]})})}})})},w=e=>{let{currentValues:t,existingRestrictions:i}=e,[d,l]=(0,o.useState)(!1),[a,c]=(0,o.useState)(!1),u=(0,s.useRouter)(),p=(0,n.p8r)(),[v]=(0,g.FC)(),h=u.query.purpose_id?parseInt(u.query.purpose_id,10):void 0,f=u.query.configuration_id,I=async()=>{try{if(!(null==t?void 0:t.id))return;let e=await v({configuration_id:f,restriction_id:t.id});if((0,_.D4)(e)){p((0,m.Vo)("Failed to delete publisher restriction"));return}l(!1),p((0,m.t5)("Publisher restriction deleted successfully"))}catch(e){p((0,m.Vo)("Failed to delete publisher restriction"))}};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(n.TaI,{children:[(0,r.jsx)(n.zxk,{size:"small",onClick:()=>c(!0),"data-testid":"edit-restriction-button",children:"Edit"}),(0,r.jsx)(n.zxk,{size:"small",onClick:()=>l(!0),"data-testid":"delete-restriction-button",children:"Delete"})]}),(0,r.jsx)(O,{isOpen:a,onClose:()=>c(!1),initialValues:t,existingRestrictions:i,purposeId:h,restrictionId:null==t?void 0:t.id,configurationId:f}),(0,r.jsx)(x.Z,{isOpen:d,onClose:()=>l(!1),onConfirm:I,title:"Confirm deletion",message:"Are you sure you want to delete this publisher restriction? This action cannot be undone.",cancelButtonText:"Cancel",continueButtonText:"Delete"})]})},{Text:D,Title:k}=n.Typography,L=e=>{let{onAdd:t}=e;return(0,r.jsx)(n.HYy,{image:n.HYy.PRESENTED_IMAGE_SIMPLE,description:(0,r.jsxs)(n.kCb,{vertical:!0,align:"center",gap:"small",children:[(0,r.jsx)(k,{level:5,children:"Add a restriction"}),(0,r.jsx)(D,{className:"max-w-lg",type:"secondary",children:"No restrictions have been added. By default, all vendors follow their declared legal basis unless a restriction is applied—add a restriction to override this behavior."})]}),"data-testid":"empty-table-notice",children:(0,r.jsx)(n.zxk,{type:"primary",onClick:t,children:"Add +"})})},V=()=>{let[e,t]=(0,o.useState)(!1),i=(0,s.useRouter)(),d=i.query.purpose_id?parseInt(i.query.purpose_id,10):void 0,l=i.query.configuration_id,{data:a,isFetching:c}=(0,g.a9)({configuration_id:l,purpose_id:null!=d?d:0},{skip:!l||!d}),u=(0,o.useMemo)(()=>{var e;return(null!==(e=null==a?void 0:a.items)&&void 0!==e?e:[]).map(e=>{var t,i;return{id:e.id,restriction_type:e.restriction_type,vendor_restriction:e.vendor_restriction,vendor_ids:null!==(i=null===(t=e.range_entries)||void 0===t?void 0:t.map(e=>e.end_vendor_id?"".concat(e.start_vendor_id,"-").concat(e.end_vendor_id):e.start_vendor_id.toString()))&&void 0!==i?i:[],purpose_id:e.purpose_id}})},[null==a?void 0:a.items]),_=u.some(e=>e.vendor_restriction===h.PY.RESTRICT_ALL_VENDORS),m=Object.values(h.FF).every(e=>u.some(t=>t.restriction_type===e)),x=(0,o.useMemo)(()=>[{title:"Restriction type",key:"restriction_type",dataIndex:"restriction_type",render:e=>p.fj[e]},{title:"Vendor restriction",key:"vendor_restriction",dataIndex:"vendor_restriction",render:e=>p.Cu[e]},{title:(0,r.jsx)(v.ED,{value:"Vendors",tooltip:"Specify which vendors the restriction applies to. You can apply restrictions to all vendors, specific vendors by their IDs, or allow only certain vendors while restricting the rest."}),key:"vendor_ids",dataIndex:"vendor_ids",render:e=>e.join(", ")||"All vendors"},{title:"Actions",key:"actions",width:154,render:(e,t)=>(0,r.jsx)(w,{currentValues:t,existingRestrictions:u})}],[u]),f=()=>{t(!0)};return(0,r.jsxs)(n.kCb,{vertical:!0,gap:"middle",children:[(0,r.jsx)(n.kCb,{justify:"flex-end",children:(0,r.jsx)(n.ua7,{title:_?'Each vendor must have a unique restriction type. When "Restrict all vendors" is active for any restriction type, no other restrictions can be added.':m?"Each purpose must have a unique restriction type. When all restriction types are active, no other restrictions can be added. Use the 'Edit' button to change the vendor restrictions on each type.":void 0,children:(0,r.jsx)(n.zxk,{type:"primary",onClick:f,disabled:_||m,"data-testid":"add-restriction-button",children:"Add restriction +"})})}),(0,r.jsx)(n.iA_,{dataSource:u,columns:x,rowKey:"id",pagination:!1,size:"small",bordered:!0,loading:c,locale:{emptyText:(0,r.jsx)(L,{onAdd:f})},"data-testid":"purpose-restrictions-table"}),(0,r.jsx)(O,{isOpen:e,onClose:()=>{t(!1)},existingRestrictions:u,purposeId:d,configurationId:l})]})};var A=()=>{let e=(0,s.useRouter)(),t=decodeURIComponent(e.query.configuration_id),i=decodeURIComponent(e.query.purpose_id),{data:v,isLoading:h}=(0,c.a4)(),{data:_}=(0,g.NZ)(t),m=(0,o.useMemo)(()=>null==v?void 0:v.purposes[i],[v,i]);return(0,r.jsxs)(l.Z,{title:"Consent Configuration",children:[(0,r.jsx)(a.Z,{heading:"Consent configuration",breadcrumbItems:[{title:"Consent settings",href:"/settings/consent"},{title:(null==_?void 0:_.name)||"Configuration"},{title:"TCF purpose ".concat(i)}]}),(0,r.jsxs)(n.TaI,{direction:"vertical",size:"middle",children:[(0,r.jsxs)(n.TaI,{direction:"vertical",size:"middle",children:[(0,r.jsx)(u.Z,{title:"TCF purpose ".concat(i).concat((null==m?void 0:m.name)?": ".concat(null==m?void 0:m.name):""),children:h?(0,r.jsxs)(n.kCb,{vertical:!0,className:"gap-1.5",children:[(0,r.jsx)(n.ug1,{height:"16px",width:"100%"}),(0,r.jsx)(n.ug1,{height:"16px",width:"100%"}),(0,r.jsx)(n.ug1,{height:"16px",width:"30%"})]}):!!m&&(0,r.jsx)(n.Bjg,{fontSize:"sm",children:null==m?void 0:m.description})}),(0,r.jsx)(u.Z,{title:(null==_?void 0:_.name)||"Configuration",children:(0,r.jsx)(n.TaI,{direction:"vertical",className:"gap-3",children:(0,r.jsxs)(n.Bjg,{fontSize:"sm",children:["Add restrictions to control how vendors process data for specific purposes. For each restriction, choose a restriction type. Then, decide whether the restriction applies to all vendors, specific vendors, or only to a limited set of allowed vendors. You can add multiple restrictions—they'll appear in the table below."," ",(0,r.jsx)(d.Z,{href:p.uh,children:"Learn more about publisher restrictions"})," ","in our docs."]})})})]}),(0,r.jsx)(V,{})]})]})}}},function(e){e.O(0,[494,2888,9774,179],function(){return e(e.s=77713)}),_N_E=e.O()}]);