(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7093],{16207:function(e,t,l){(window.__NEXT_P=window.__NEXT_P||[]).push(["/sandbox/privacy-notices",function(){return l(52640)}])},58754:function(e,t,l){"use strict";var a=l(24246),n=l(10034),i=l(70788);t.Z=e=>{let{heading:t,breadcrumbItems:l,isSticky:r=!0,children:s,rightContent:c,style:o,...d}=e;return(0,a.jsxs)("div",{...d,style:r?{position:"sticky",top:"-24px",paddingTop:"24px",paddingBottom:"24px",paddingLeft:"40px",marginLeft:"-40px",paddingRight:"40px",marginRight:"-40px",marginTop:"-24px",left:0,zIndex:20,backgroundColor:"white",...o}:{paddingBottom:"24px",...o},children:[(0,a.jsxs)(n.kCb,{justify:"space-between",children:["string"==typeof t?(0,a.jsx)(n.Dxz,{className:l||s?"pb-4":void 0,level:1,"data-testid":"page-heading",children:t}):t,c&&(0,a.jsx)("div",{"data-testid":"page-header-right-content",children:c})]}),!!l&&(0,a.jsx)(i.m,{className:s?"pb-4":void 0,items:l,"data-testid":"page-breadcrumb"}),s]})}},70788:function(e,t,l){"use strict";l.d(t,{m:function(){return o}});var a=l(24246),n=l(10034),i=l(79894),r=l.n(i),s=l(27378);let{Text:c}=n.Typography,o=e=>{let{items:t,...l}=e,i=(0,s.useMemo)(()=>null==t?void 0:t.map((e,l)=>{let i=l===t.length-1,s={...e},o=s.onClick&&!s.href;return("string"==typeof s.title&&(s.title=(0,a.jsx)(c,{style:{color:"inherit",maxWidth:i?void 0:400},ellipsis:!i,id:i?"breadcrumb-current-page":void 0,children:s.title})),o)?s.title=(0,a.jsx)(n.zxk,{type:"text",size:"small",icon:s.icon,onClick:s.onClick,className:"ant-breadcrumb-link -mt-px px-1 text-inherit",children:s.title}):(s.icon&&(s.title=(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("span",{className:"anticon align-text-bottom",children:s.icon}),s.title]})),s.href&&s.title&&(s.title=(0,a.jsx)(r(),{href:s.href,className:"ant-breadcrumb-link",children:s.title}),delete s.href)),s}),[t]);return(0,a.jsx)(n.aGc,{items:i,...l})}},52640:function(e,t,l){"use strict";l.r(t),l.d(t,{default:function(){return k}});var a,n,i=l(24246),r=l(10034),s=l(58754),c=l(27378),o=l(812),d=l(18850),p=l(64705),h=l(3124),y=l.n(h),u=e=>{let{title:t,height:l="400px",header:a,headerColor:n,body:s,emptyMessage:c,children:o}=e;return(0,i.jsxs)("div",{children:[(0,i.jsx)(r.Typography.Text,{strong:!0,className:"mb-4 block",children:t}),(0,i.jsx)(r.Zbd,{className:"bg-gray-50 font-mono text-xs",styles:{body:{padding:"18px"}},children:(0,i.jsxs)("div",{className:"overflow-auto",style:{height:l},children:[a&&(0,i.jsx)(r.Typography.Text,{strong:!0,size:"sm",className:"mb-2 block",style:{color:n},children:a}),o||(null!=s?(0,i.jsx)("pre",{className:"m-0 whitespace-pre-wrap",children:JSON.stringify(s,null,2)}):c?(0,i.jsx)(r.kCb,{vertical:!0,align:"center",justify:"center",className:"h-full",children:(0,i.jsx)(r.Typography.Text,{type:"secondary",children:c})}):null)]})})]})};let x=e=>{let{privacyNotices:t}=e;return 0===t.length?null:(0,i.jsx)("div",{className:"max-h-60 overflow-y-auto",children:(0,i.jsx)("ul",{className:"m-0 list-inside list-disc pl-2",children:t.map(e=>(0,i.jsx)("li",{className:"list-none",children:(0,i.jsxs)("ul",{className:"m-0 list-inside list-disc",children:[(0,i.jsx)("li",{className:"py-1",children:e.name}),e.children&&e.children.length>0&&e.children.map(e=>(0,i.jsx)("li",{className:"py-1 pl-5",children:e.name},e.id))]})},e.id))})})};var g=e=>{let{region:t,onRegionChange:l,propertyId:a,onPropertyIdChange:n,onFetchExperience:s,isLoading:c,errorMessage:o,privacyNotices:d}=e;return(0,i.jsxs)(r.kCb,{vertical:!0,gap:"small",children:[(0,i.jsx)(r.Typography.Title,{level:3,children:"Configuration"}),(0,i.jsxs)(r.kCb,{gap:"large",children:[(0,i.jsxs)(r.kCb,{vertical:!0,flex:1,style:{minWidth:0},children:[(0,i.jsx)(r.Typography.Text,{strong:!0,className:"mb-2 block",children:"Experience region"}),(0,i.jsxs)(r.kCb,{gap:"small",className:"mb-4",children:[(0,i.jsx)(r.IIB,{placeholder:"Enter region (e.g., us_ca)",value:t,onChange:e=>l(e.target.value),className:"w-64"}),(0,i.jsx)(r.zxk,{type:"primary",onClick:s,loading:c,disabled:!t,children:"Fetch experience"})]}),(0,i.jsx)(r.Typography.Text,{strong:!0,className:"mb-2 block",children:"Property ID (optional)"}),(0,i.jsx)(r.Typography.Text,{type:"secondary",className:"mb-2 block",children:"Leave empty to retrieve experience with no property"}),(0,i.jsx)(r.kCb,{gap:"small",className:"mb-4",children:(0,i.jsx)(r.IIB,{placeholder:"Property ID (e.g. FDS-1234)",value:a,onChange:e=>n(e.target.value),className:"w-64"})}),o&&(0,i.jsx)(r.Typography.Text,{type:"danger",className:"mb-4 block",children:o})]}),(0,i.jsx)(r.kCb,{vertical:!0,flex:1,children:(0,i.jsx)(u,{title:"Available notices",height:"200px",headerColor:y().FIDESUI_MINOS,emptyMessage:"Available notices will appear here after fetching experience",children:d.length>0?(0,i.jsx)(x,{privacyNotices:d}):null})})]})]})},m=e=>{let{email:t,onEmailChange:l,selectedNoticeKeys:a,onSelectedNoticeKeysChange:n,parentNoticeKeys:s,onFetchCurrentPreferences:c,isLoading:o,isError:d,error:p,getCurrentResponse:h}=e;return(0,i.jsxs)(r.kCb,{gap:"large",children:[(0,i.jsx)(r.kCb,{vertical:!0,flex:1,children:(0,i.jsxs)(r.kCb,{vertical:!0,className:"pr-24",children:[(0,i.jsx)(r.Typography.Text,{strong:!0,className:"mb-2 block",children:"User email (identity)"}),(0,i.jsx)(r.IIB,{placeholder:"Enter email address",value:t,onChange:e=>l(e.target.value),className:"mb-4"}),(0,i.jsx)(r.Typography.Text,{strong:!0,className:"mb-2 block",children:"Notice keys"}),(0,i.jsx)(r.PhF,{mode:"multiple",placeholder:"All notices",value:a,onChange:n,options:s,className:"mb-4 w-full",allowClear:!0,"aria-label":"Notice keys"}),(0,i.jsx)(r.zxk,{type:"primary",onClick:c,loading:o,disabled:!t,className:"mb-4 self-start",children:"Fetch current preferences"}),d&&(0,i.jsxs)(r.Typography.Text,{type:"danger",className:"mb-4 block",children:["Error fetching current preferences: ",p||"Unknown error"]})]})}),(0,i.jsx)(r.kCb,{vertical:!0,flex:1,className:"min-w-0",children:(0,i.jsx)(u,{title:"GET response",header:h?"GET /api/v3/privacy-preferences/current?identity.email=".concat(t).concat(a.length>0?"&notice_keys=".concat(a.join(","),"&include_descendants=true"):""):null,headerColor:y().FIDESUI_SUCCESS,body:h,emptyMessage:"GET response will appear here after fetching preferences"})})]})};let v=e=>{let t=[],l=e=>e.map(e=>{var a,n;let i=(null===(n=e.translations)||void 0===n?void 0:null===(a=n[0])||void 0===a?void 0:a.privacy_notice_history_id)||e.id,r={title:e.name,key:e.notice_key,noticeHistoryId:i,noticeKey:e.notice_key};return t.push(r.key),e.children&&e.children.length>0&&(r.children=l(e.children)),r});return{treeData:l(e),allKeys:t}};var b=e=>{let{privacyNotices:t,checkedKeys:l,onCheckedKeysChange:a,onExplicitChange:n}=e,{treeData:s,allKeys:o}=(0,c.useMemo)(()=>v(t),[t]),[d,p]=(0,c.useState)(o),[h,y]=(0,c.useState)(!0);(0,c.useEffect)(()=>{p(o)},[o]);let u=(0,c.useCallback)(e=>{p(e),y(!1)},[]),x=(0,c.useCallback)(e=>{let t=Array.isArray(e)?e:e.checked,i=t.filter(e=>!l.includes(e)),r=l.filter(e=>!t.includes(e)),s=i.length>0?i[0]:r[0];void 0!==s&&n&&n(s),a(t)},[l,a,n]);return(0,i.jsx)("div",{className:"max-w-lg",children:(0,i.jsx)(r.mpN,{checkable:!0,checkStrictly:!0,onExpand:u,expandedKeys:d,autoExpandParent:h,onCheck:x,checkedKeys:l,selectable:!1,treeData:s})})};(a=n||(n={})).SYSTEM_ENFORCED="system_enforced",a.CASCADE_DOWN="cascade_down",a.CASCADE_UP="cascade_up",a.CASCADE_UP_AND_DOWN="cascade_up_and_down",a.PREFER_OPT_IN="prefer_opt_in";var f=e=>{let{value:t,onChange:l}=e,a=[{value:n.SYSTEM_ENFORCED,label:"System enforced"},{value:n.CASCADE_DOWN,label:"Cascade down"},{value:n.CASCADE_UP,label:"Cascade up"},{value:n.CASCADE_UP_AND_DOWN,label:"Cascade up and down"},{value:n.PREFER_OPT_IN,label:"Prefer opt in"}];return(0,i.jsxs)(r.kCb,{align:"center",gap:3,className:"mb-4",children:[(0,i.jsx)("label",{htmlFor:"policy-select",id:"policy-select-label",children:(0,i.jsx)(r.Typography.Text,{strong:!0,style:{whiteSpace:"nowrap"},children:"Propagation policy:"})}),(0,i.jsx)(r.PhF,{id:"policy-select",value:null!=t?t:void 0,onChange:e=>{l(void 0===e?null:e)},style:{width:200},placeholder:"System enforced",allowClear:!0,options:a,"aria-labelledby":"policy-select-label"})]})},j=e=>{let{policy:t,onPolicyChange:l,privacyNotices:a,preferenceState:n,noticeMappings:s,experienceConfigHistoryId:h,email:x,hasCurrentResponse:g,explicitlyChangedKeys:m,onExplicitlyChangedKeysChange:v}=e,{checkedKeys:j,fetchedCheckedKeys:_,onCheckedKeysChange:C,onFetchedKeysChange:N}=n,{noticeKeyToHistoryMap:k}=s,[S,T]=(0,c.useState)(null),[E,{isLoading:w,isError:I,error:P}]=(0,d.ZR)(),A=(0,c.useCallback)(()=>({fetchedSet:new Set(_.map(e=>e.toString())),currentSet:new Set(j.map(e=>e.toString()))}),[_,j]),D=(0,c.useMemo)(()=>{let{fetchedSet:e,currentSet:t}=A();return Array.from(k.keys()).some(l=>e.has(l)!==t.has(l))},[A,k]),O=(0,c.useCallback)(async()=>{let{fetchedSet:e,currentSet:l}=A(),a=Array.from(k.keys()).filter(t=>e.has(t)!==l.has(t));if(0===a.length)return;let n=m.filter(e=>a.includes(String(e))).map(e=>{let t=String(e),a=k.get(t)||"",n=l.has(t);return{notice_key:t,notice_history_id:a,value:n?p.p.OPT_IN:p.p.OPT_OUT,collected_at:new Date().toISOString(),meta:{fides:{experience_config_history_id:h}}}});try{let e=await E({body:{identity:{email:{value:x}},preferences:n},policy:t}).unwrap();T(e);let l=e.preferences.filter(e=>e.value===p.p.OPT_IN).map(e=>e.notice_key);C(l),N(l),v([])}catch(e){}},[A,k,t,h,x,E,C,N,m,v]);return(0,i.jsxs)(r.kCb,{gap:"large",children:[(0,i.jsxs)(r.kCb,{vertical:!0,flex:1,children:[(0,i.jsx)(r.Typography.Title,{level:4,style:{fontSize:14,marginBottom:8},children:"Current preferences"}),g?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(f,{value:t,onChange:l}),(0,i.jsx)(b,{privacyNotices:a,checkedKeys:j,onCheckedKeysChange:C,onExplicitChange:e=>{v([...m.filter(t=>t!==e),e])}}),(0,i.jsx)(r.zxk,{type:"primary",onClick:O,loading:w,disabled:!D,className:"mt-4 self-start",children:"Save preferences"}),I&&P&&(0,i.jsxs)(r.Typography.Text,{type:"danger",className:"mt-2 block",children:["Error saving preferences: ",(0,o.e$)(P)]})]}):(0,i.jsx)(r.kCb,{vertical:!0,align:"center",justify:"center",flex:1,children:(0,i.jsx)(r.HYy,{description:"Fetch current preferences to manage user consent"})})]}),(0,i.jsx)(r.kCb,{vertical:!0,flex:1,className:"min-w-0",children:(0,i.jsx)(u,{title:"POST response",header:S?"POST /api/v3/privacy-preferences".concat(t?"?policy=".concat(t):""):null,headerColor:y().FIDESUI_ALERT,body:S,emptyMessage:"POST response will appear here after saving preferences"})})]})};let _={REGION:"us_ca",SHOW_DISABLED:!1};var C=()=>{let[e,t]=(0,c.useState)(_.REGION),[l,a]=(0,c.useState)(""),[n,s]=(0,c.useState)(""),[h,y]=(0,c.useState)(null),[u,x]=(0,c.useState)([]),[v,b]=(0,c.useState)([]),[f,C]=(0,c.useState)([]),[N,k]=(0,c.useState)([]),[S,T]=(0,c.useState)([]),[E,w]=(0,c.useState)(null),[I,P]=(0,c.useState)(null),[A,D]=(0,c.useState)(""),[O,{isLoading:F}]=(0,d.nU)(),[L,{isLoading:R,isError:M,error:K}]=(0,d.Lg)(),{noticeKeyToHistoryMap:U,parentNoticeKeys:z}=(0,c.useMemo)(()=>{let e=new Map,t=[],l=(a,n)=>{a.forEach(a=>{var i,r,s;let c=(null===(r=a.translations)||void 0===r?void 0:null===(i=r[0])||void 0===i?void 0:i.privacy_notice_history_id)||a.id;e.set(a.notice_key,c),n||t.push({label:a.name,value:a.notice_key}),(null===(s=a.children)||void 0===s?void 0:s.length)&&l(a.children,a.notice_key)})};return l(S),{noticeKeyToHistoryMap:e,parentNoticeKeys:t}},[S]),B=(0,c.useCallback)(async()=>{if(D(""),!e){D("Please enter a region");return}try{let i=await O({region:e,show_disabled:_.SHOW_DISABLED,...l&&{property_id:l}}).unwrap();if(i.items&&i.items.length>0){let e=i.items[0];if("privacy_notices"in e&&e.privacy_notices&&e.privacy_notices.length>0){var t,a,n;T(e.privacy_notices);let l=(null===(n=e.experience_config)||void 0===n?void 0:null===(a=n.translations)||void 0===a?void 0:null===(t=a[0])||void 0===t?void 0:t.privacy_experience_config_history_id)||null;w(l),x([]),b([]),k([])}}}catch(e){D("Failed to fetch privacy experience")}},[O,e,l]),W=(0,c.useCallback)(async()=>{try{let e={"identity.email":n};N.length>0&&(e.notice_keys=N);let t=await L(e).unwrap();P(t);let l=t.filter(e=>e.value===p.p.OPT_IN).map(e=>e.notice_key);x(l),b(l),C([])}catch(e){}},[n,N,L]);return(0,i.jsxs)("div",{className:"mt-5 space-y-8",children:[(0,i.jsx)(r.bZj,{type:"info",message:"This page makes real API calls to the Consent V3 API.",description:(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(r.Typography.Paragraph,{className:"mb-0 mt-3",children:"Before using this sandbox, ensure you have:"}),(0,i.jsxs)("ul",{className:"mb-0 ml-6 mt-2 space-y-1",children:[(0,i.jsxs)("li",{children:["The consent v3 API enabled via the env var"," ",(0,i.jsx)(r.Typography.Text,{code:!0,children:"FIDESPLUS__EXPERIMENTAL__CONSENT_V3_ENABLED=true"})]}),(0,i.jsx)("li",{children:"An email identity definition configured in your system"}),(0,i.jsx)("li",{children:"A privacy experience set up with at least one privacy notice in the selected region"})]})]}),showIcon:!0}),(0,i.jsx)(g,{region:e,onRegionChange:t,propertyId:l,onPropertyIdChange:a,onFetchExperience:B,isLoading:F,errorMessage:A,privacyNotices:S}),(0,i.jsx)(r.izJ,{}),(0,i.jsxs)(r.kCb,{vertical:!0,gap:"small",children:[(0,i.jsx)(r.Typography.Title,{level:3,children:"User preferences"}),0===S.length&&(0,i.jsx)(r.HYy,{description:"Load an experience in order to manage user preferences"}),S.length>0&&(0,i.jsxs)("div",{className:"space-y-6",children:[(0,i.jsx)(m,{email:n,onEmailChange:s,selectedNoticeKeys:N,onSelectedNoticeKeysChange:k,parentNoticeKeys:z,onFetchCurrentPreferences:W,isLoading:R,isError:M,error:K?(0,o.e$)(K):null,getCurrentResponse:I}),(0,i.jsx)(j,{policy:h,onPolicyChange:y,privacyNotices:S,preferenceState:{checkedKeys:u,fetchedCheckedKeys:v,onCheckedKeysChange:x,onFetchedKeysChange:b},noticeMappings:{noticeKeyToHistoryMap:U},experienceConfigHistoryId:E,email:n,hasCurrentResponse:null!==I,explicitlyChangedKeys:f,onExplicitlyChangedKeysChange:C})]})]})]})};let{Content:N}=r.Layout;var k=()=>(0,i.jsx)(r.Layout,{children:(0,i.jsxs)(N,{className:"overflow-auto px-10 py-6",children:[(0,i.jsx)(s.Z,{heading:"Privacy Notices Sandbox"}),(0,i.jsx)(C,{})]})})}},function(e){e.O(0,[2888,9774,179],function(){return e(e.s=16207)}),_N_E=e.O()}]);