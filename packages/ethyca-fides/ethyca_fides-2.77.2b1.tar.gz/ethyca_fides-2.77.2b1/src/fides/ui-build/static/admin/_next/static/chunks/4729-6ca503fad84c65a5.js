"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4729],{24729:function(e,s,n){n.d(s,{D:function(){return C}});var i=n(24246),l=n(10034),a=n(27378),t=n(16394),c=n(30952),o=n(17245),r=n(9270),d=n(67359),u=n(37059);let p=e=>{var s;let{filters:n}=e,{resetPagination:t,pageIndex:c,pageSize:p,paginationProps:m}=(0,r.S)(),{searchQuery:x,updateSearch:g}=(0,o.Rx)(),y=(0,a.useMemo)(()=>[d.n.PENDING,d.n.IN_PROCESSING,d.n.PAUSED,d.n.RETRYING,d.n.ERROR],[]),[h,v]=(0,a.useState)(y),[k,j]=(0,a.useState)(!1),[_,f]=(0,a.useState)(y),[C,N]=(0,a.useState)(!1),S=(0,a.useCallback)(e=>{g(e),t()},[g,t]),I=(0,a.useCallback)(e=>{f(e)},[]),E=(0,a.useCallback)(e=>{N(e)},[]),w=(0,a.useCallback)(()=>{v(_),j(C),t()},[_,C,t]),b=(0,a.useCallback)(()=>{f(y),N(!1),v(y),j(!1),t()},[y,t]),z=[d.n.PENDING,d.n.IN_PROCESSING,d.n.COMPLETE,d.n.ERROR,d.n.PAUSED,d.n.RETRYING,d.n.SKIPPED],{data:P,isLoading:R,isFetching:A}=(0,u.$h)({page:c,size:p,search:null!==(s=null==n?void 0:n.monitorId)&&void 0!==s?s:x,statuses:h.length>0?h:void 0,return_dismissed:k},{pollingInterval:3e3,refetchOnFocus:!0,refetchOnReconnect:!0});return{searchQuery:x,updateSearch:S,statusFilters:_,updateStatusFilters:I,showDismissed:C,updateShowDismissed:E,applyFilters:w,resetAndApplyFilters:b,availableStatuses:z,listProps:(0,a.useMemo)(()=>({dataSource:(null==P?void 0:P.items)||[],loading:R,locale:{emptyText:(0,i.jsx)(l.HYy,{image:l.HYy.PRESENTED_IMAGE_SIMPLE,description:"No tasks in progress"})}}),[null==P?void 0:P.items,R]),paginationProps:{...m,total:null==P?void 0:P.total},isLoading:R,isFetching:A}};var m=n(40262),x=n(88340),g=n(41337),y=n(60240);let{Paragraph:h,Text:v,Title:k}=l.Typography,j=e=>"paused"===e?"Awaiting Processing":e.split("_").map(t.kC).join(" "),_=e=>{var s,n,a,c,o,r,d,p,_,f;let{task:C,...N}=e,S=(0,l.p8r)(),[I,{isLoading:E}]=(0,u.mL)(),[w,{isLoading:b}]=(0,u.QC)(),z=!!C.dismissed,P="error"===C.status&&C.action_type!==y.K8.DETECTION,{data:R}=(0,u.Ud)({page:1,size:1e3}),A=C.monitor_config_id?null==R?void 0:null===(s=R.items)||void 0===s?void 0:s.find(e=>e.key===C.monitor_config_id):void 0,T=A?(0,g.AZ)({connection_type:A.connection_type,name:null!==(c=A.name)&&void 0!==c?c:null,key:null!==(o=A.key)&&void 0!==o?o:null,saas_config:A.saas_config?{type:null!==(r=A.saas_config.type)&&void 0!==r?r:null,name:null!==(d=A.saas_config.name)&&void 0!==d?d:null,fides_key:null!==(p=A.saas_config.fides_key)&&void 0!==p?p:null}:null,secrets:(null===(a=A.secrets)||void 0===a?void 0:a.url)?{url:A.secrets.url}:null}):C.connection_type?(0,g.AZ)({connection_type:C.connection_type,name:null!==(_=C.connection_name)&&void 0!==_?_:C.connection_type?C.connection_type.toString():null,key:null,saas_config:null,secrets:null}):void 0,O=(null===(n=C.staged_resource_urns)||void 0===n?void 0:n.length)||0,D=["pending","in_processing","paused","retrying"].includes((C.status||"").toLowerCase()),J=C.field_count||O,L=(()=>{if(C.action_type===y.K8.CLASSIFICATION||C.action_type===y.K8.LLM_CLASSIFICATION){let e="complete"===C.status?"Classified":"Classifying";return"".concat(e," ").concat(J," ").concat((0,t._6)(J,"field","fields"))}if(C.action_type===y.K8.DETECTION)return"complete"===C.status?"Monitor scanned":"Monitor scanning";if(C.action_type===y.K8.PROMOTION){let e="complete"===C.status?"Approved":"Approving";return"".concat(e," ").concat(J," ").concat((0,t._6)(J,"field","fields"))}return C.action_type?C.action_type.replace(/_/g," "):"Task"})(),M=C.monitor_name||"Unknown monitor",F=async()=>{try{await I({taskId:C.id}).unwrap(),S({status:"success",description:"Task retry initiated successfully"})}catch(n){var e;let s=(null==n?void 0:null===(e=n.data)||void 0===e?void 0:e.detail)||(null==n?void 0:n.message)||"Unknown error occurred";S({status:"error",description:"Failed to retry task: ".concat(s)})}},U=async()=>{try{await w({taskId:C.id}).unwrap(),S({status:"success",description:"Task dismissed successfully"})}catch(n){var e;let s=(null==n?void 0:null===(e=n.data)||void 0===e?void 0:e.detail)||(null==n?void 0:n.message)||"Unknown error occurred";S({status:"error",description:"Failed to dismiss task: ".concat(s)})}};return(0,i.jsx)("div",{...N,className:"w-full",children:(0,i.jsxs)(l.X2j,{gutter:12,className:"w-full",children:[(0,i.jsx)(l.JXS,{span:14,className:"align-middle",children:(0,i.jsxs)(l.TaI,{direction:"vertical",size:4,children:[(0,i.jsxs)(l.TaI,{align:"center",size:8,wrap:!0,children:[T&&(0,i.jsx)(g.ZP,{data:T,size:24}),(0,i.jsx)(k,{level:5,className:"m-0",children:L}),!D&&(0,i.jsx)(l.Vp9,{color:(e=>{switch(e){case"pending":case"retrying":case"skipped":default:return l.tAb.DEFAULT;case"in_processing":return l.tAb.INFO;case"complete":return l.tAb.SUCCESS;case"error":return l.tAb.ERROR;case"paused":return l.tAb.MARBLE}})(C.status),children:(f=C.status)?j(f):"Unknown"})]}),"error"===C.status&&(0,i.jsxs)(l.TaI,{children:[(0,i.jsx)(h,{type:"secondary",size:"sm",ellipsis:{rows:1,expandable:!0,symbol:"more",tooltip:!0},children:C.message||"Unknown error"}),C.message&&(0,i.jsx)(x.Z,{copyText:C.message,size:"small",className:"ml-1"})]})]})}),(0,i.jsx)(l.JXS,{span:4,className:"flex items-center justify-end",children:(0,i.jsx)(v,{type:"secondary",size:"sm",children:M})}),(0,i.jsx)(l.JXS,{span:3,className:"flex items-center justify-end",children:D?(0,i.jsx)(l.yCA,{size:"small"}):(0,i.jsx)(v,{type:"secondary",size:"sm",children:(0,m.H)(new Date(C.updated_at),new Date,{addSuffix:!0})})}),(0,i.jsx)(l.JXS,{span:3,className:"flex items-center justify-end",children:"error"===C.status&&(0,i.jsxs)(l.TaI,{size:0,split:(0,i.jsx)(l.izJ,{type:"vertical"}),children:[P&&(0,i.jsx)(l.zxk,{type:"link",size:"small",loading:E,onClick:F,className:"p-0",children:"Retry"}),!z&&(0,i.jsx)(l.zxk,{type:"link",size:"small",loading:b,onClick:U,className:"p-0",children:"Dismiss"})]})})]})})},f=e=>"paused"===e?"Awaiting Processing":e.split("_").map(t.kC).join(" "),C=e=>{var s,n,t,o;let{filters:r}=e,[d,u]=(0,a.useState)(!1),{searchQuery:m,updateSearch:x,statusFilters:g,updateStatusFilters:y,showDismissed:h,updateShowDismissed:v,applyFilters:k,resetAndApplyFilters:j,availableStatuses:C,listProps:N,paginationProps:S}=p({filters:r}),I=(0,a.useCallback)(e=>{y(e)},[y]),E=(0,a.useCallback)(()=>{k(),u(!1)},[k]),w=(0,a.useCallback)(()=>{j(),u(!1)},[j]),b=(0,i.jsxs)(l.kCb,{vertical:!0,className:"min-w-[220px]",children:[(0,i.jsxs)(l.kCb,{vertical:!0,className:"gap-1.5 px-4 py-2",children:[(0,i.jsx)(l.XZJ.Group,{value:g,onChange:I,className:"flex flex-col gap-1.5",children:C.map(e=>(0,i.jsx)(l.XZJ,{value:e,children:f(e)},e))}),(0,i.jsx)(l.XZJ,{checked:h,onChange:e=>v(e.target.checked),children:"Dismissed"})]}),(0,i.jsx)(l.izJ,{className:"m-0"}),(0,i.jsxs)(l.kCb,{justify:"space-between",className:"px-4 py-2",children:[(0,i.jsx)(l.zxk,{size:"small",type:"text",onClick:w,className:"-ml-2",children:"Reset"}),(0,i.jsx)(l.zxk,{size:"small",type:"primary",onClick:E,children:"Apply"})]})]});return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(l.kCb,{justify:"space-between",align:"center",children:[(0,i.jsx)("div",{className:"min-w-[300px]",children:(0,i.jsx)(c.f,{hidden:!!(null==r?void 0:r.monitorId),value:null!==(o=null!==(t=null==r?void 0:r.monitorId)&&void 0!==t?t:m)&&void 0!==o?o:"",onChange:x,placeholder:"Search by monitor name..."})}),(0,i.jsx)(l.J2e,{content:b,trigger:"click",placement:"bottomRight",open:d,onOpenChange:u,children:(0,i.jsx)(l.zxk,{icon:(0,i.jsx)(l.PJP._ME,{}),iconPosition:"end",children:"Filter"})})]}),(0,i.jsx)(l.aVo,{...N,className:"h-full overflow-y-auto overflow-x-clip",renderItem:e=>(0,i.jsx)(l.aVo.Item,{children:(0,i.jsx)(_,{task:e})})}),(0,i.jsx)(l.tlE,{...S,showSizeChanger:{suffixIcon:(0,i.jsx)(l.PJP._ME,{})},hideOnSinglePage:(null===(s=S.pageSize)||void 0===s?void 0:s.toString())===(null===(n=S.pageSizeOptions)||void 0===n?void 0:n[0])})]})}}}]);