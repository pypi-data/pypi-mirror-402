[build-system]
requires = ["hatchling"]
build-backend = "hatchling.build"

[project]
name = "cognite-function-apps"
dynamic = ["version"]
description = "FastAPI-style framework for building composable Function Apps for Cognite Functions with automatic OpenAPI schema generation and MCP integration"
readme = "README.md"
requires-python = ">=3.10"

# Important: Dependency versions are constrained by the Fusion Jupyter Notebook environment to prevent installation errors.
dependencies = [
    "cognite-sdk>=7.87.0",
    "pydantic>=2.10.5",
    "typing-extensions>=4.11.0",
]

[project.optional-dependencies]
cli = [
    "uvicorn>=0.37.0",
    "typer>=0.9.0",
]

tracing = [
    "opentelemetry-api>=1.20.0",
    "opentelemetry-sdk>=1.20.0",
    "opentelemetry-exporter-otlp>=1.20.0",
]

[tool.hatch.version]
path = "src/cognite_function_apps/_version.py"

[project.scripts]
cognite-function-apps = "cognite_function_apps.cli:main"
fun = "cognite_function_apps.cli:main"


[dependency-groups]
dev = [
    "pytest>=7.0.0",
    "pytest-asyncio>=0.21.0",
    "pytest-cov>=4.0.0",
    "openapi-spec-validator>=0.7.0",
    "pre-commit>=4.3.0",
    "pyright>=1.1.406",
    "ruff>=0.14.1",
    "hypothesis>=6.138.15",
    "uvicorn>=0.37.0",
    "pydantic-settings>=2.0.0",
    "httpx>=0.27.0",
    "jinja2>=3.0.0",
    "jupytext>=1.16.0",
    "mkdocs-material>=9.5.0",
    "mkdocstrings[python]>=0.24.0",
    "mike>=2.0.0",
    "mkdocs-include-markdown-plugin>=6.0.0",
    "opentelemetry-api>=1.20.0",
    "opentelemetry-sdk>=1.20.0",
    "opentelemetry-exporter-otlp>=1.20.0",
    "typer>=0.9.0",
]

client = [
    "httpx>=0.27.0",
    "jinja2>=3.0.0",
]

[tool.pytest.ini_options]
testpaths = ["tests"]
python_files = "test_*.py"
python_classes = "Test*"
python_functions = "test_*"
filterwarnings = [
    # Ignore TracerProvider warning in tests where TracingApp is instantiated
    # after session fixture has already configured the provider
    "ignore:TracerProvider is already configured:UserWarning:cognite_function_apps.tracer",
]

[tool.pyright]
# Ignore unused function warnings for decorator-registered functions
reportUnusedFunction = "none"
typeCheckingMode = "strict"
pythonVersion = "3.10"
executionEnvironments = [
    { "root" = "docs-src", "reportUnusedExpression" = "none", "reportRedeclaration" = "none", "reportDuplicateImport" = "none" },
    { "root" = "."}
]

[tool.ruff]
line-length = 120
lint.select = [
    "D", # Pydocstyle conventions
    "E", # Pycodestyle errors
    "W", # Pycodestyle warnings
    "F", # Pyflakes codes
    "I", # Isort codes
    "N", # PEP8 Naming convention codes
    "T", # Type checkings
    "RUF", # Ruff-specific codes
    "TID", # Type inference details
    "UP", # Pyupgrade codes
    "PLC", # Pylint codes
]

[tool.ruff.lint.per-file-ignores]
# Documentation source files contain markdown in docstrings and non-standard structure
"docs-src/*.py" = [
    "D", # Ignore all pydocstyle rules
    "E402", # Module level import not at top of file (cells have imports mid-file)
]

[tool.ruff.lint.pydocstyle]
convention = "google"
