{"version":3,"file":"1850.8cacf3fe4291c9b0.js","sources":["webpack://insteon-frontend/./homeassistant-frontend/src/components/ha-selector/ha-selector-selector.ts"],"sourcesContent":["import type { PropertyValues } from \"lit\";\nimport { css, html, LitElement } from \"lit\";\nimport { customElement, property } from \"lit/decorators\";\nimport memoizeOne from \"memoize-one\";\nimport { fireEvent } from \"../../common/dom/fire_event\";\nimport type {\n  LocalizeFunc,\n  LocalizeKeys,\n} from \"../../common/translations/localize\";\nimport type { HomeAssistant } from \"../../types\";\nimport \"../ha-form/ha-form\";\n\nconst SELECTOR_DEFAULTS = {\n  number: {\n    min: 1,\n    max: 100,\n  },\n};\n\nconst SELECTOR_SCHEMAS = {\n  action: [] as const,\n  area: [\n    {\n      name: \"multiple\",\n      selector: { boolean: {} },\n    },\n  ] as const,\n  attribute: [\n    {\n      name: \"entity_id\",\n      selector: { entity: {} },\n    },\n  ] as const,\n  boolean: [] as const,\n  color_temp: [\n    {\n      name: \"unit\",\n      selector: { select: { options: [\"kelvin\", \"mired\"] } },\n    },\n    {\n      name: \"min\",\n      selector: { number: { mode: \"box\" } },\n    },\n    {\n      name: \"max\",\n      selector: { number: { mode: \"box\" } },\n    },\n  ] as const,\n  condition: [] as const,\n  date: [] as const,\n  datetime: [] as const,\n  device: [\n    {\n      name: \"multiple\",\n      selector: { boolean: {} },\n    },\n  ] as const,\n  duration: [\n    {\n      name: \"enable_day\",\n      selector: { boolean: {} },\n    },\n    {\n      name: \"enable_millisecond\",\n      selector: { boolean: {} },\n    },\n  ] as const,\n  entity: [\n    {\n      name: \"multiple\",\n      selector: { boolean: {} },\n    },\n  ] as const,\n  floor: [\n    {\n      name: \"multiple\",\n      selector: { boolean: {} },\n    },\n  ] as const,\n  icon: [] as const,\n  location: [] as const,\n  media: [\n    {\n      name: \"accept\",\n      selector: {\n        text: {\n          multiple: true,\n        },\n      },\n    },\n  ] as const,\n  number: [\n    {\n      name: \"min\",\n      selector: { number: { mode: \"box\", step: \"any\" } },\n    },\n    {\n      name: \"max\",\n      selector: { number: { mode: \"box\", step: \"any\" } },\n    },\n    {\n      name: \"step\",\n      selector: { number: { mode: \"box\", step: \"any\" } },\n    },\n  ] as const,\n  object: [] as const,\n  color_rgb: [] as const,\n  select: [\n    {\n      name: \"options\",\n      selector: { object: {} },\n    },\n    {\n      name: \"multiple\",\n      selector: { boolean: {} },\n    },\n  ] as const,\n  state: [\n    {\n      name: \"entity_id\",\n      selector: { entity: {} },\n    },\n    {\n      name: \"multiple\",\n      selector: { boolean: {} },\n    },\n  ] as const,\n  target: [] as const,\n  template: [] as const,\n  text: [\n    {\n      name: \"multiple\",\n      selector: { boolean: {} },\n    },\n    {\n      name: \"multiline\",\n      selector: { boolean: {} },\n    },\n    { name: \"prefix\", selector: { text: {} } },\n    { name: \"suffix\", selector: { text: {} } },\n  ] as const,\n  theme: [] as const,\n  time: [] as const,\n};\n\n@customElement(\"ha-selector-selector\")\nexport class HaSelectorSelector extends LitElement {\n  @property({ attribute: false }) public hass!: HomeAssistant;\n\n  @property({ attribute: false }) public value?: any;\n\n  @property() public label?: string;\n\n  @property() public helper?: string;\n\n  @property({ type: Boolean, reflect: true }) public disabled = false;\n\n  @property({ type: Boolean }) public narrow = false;\n\n  @property({ type: Boolean, reflect: true }) public required = true;\n\n  private _yamlMode = false;\n\n  protected shouldUpdate(changedProps: PropertyValues) {\n    if (changedProps.size === 1 && changedProps.has(\"hass\")) {\n      return false;\n    }\n    return true;\n  }\n\n  private _schema = memoizeOne(\n    (choice: string, localize: LocalizeFunc) =>\n      [\n        {\n          name: \"type\",\n          required: true,\n          selector: {\n            select: {\n              mode: \"dropdown\",\n              options: Object.keys(SELECTOR_SCHEMAS)\n                .concat(\"manual\")\n                .map((key) => ({\n                  label:\n                    localize(\n                      `ui.components.selectors.selector.types.${key}` as LocalizeKeys\n                    ) || key,\n                  value: key,\n                })),\n            },\n          },\n        },\n        ...(choice === \"manual\"\n          ? ([\n              {\n                name: \"manual\",\n                selector: { object: {} },\n              },\n            ] as const)\n          : []),\n        ...(SELECTOR_SCHEMAS[choice]\n          ? SELECTOR_SCHEMAS[choice].length > 1\n            ? [\n                {\n                  name: \"\",\n                  type: \"expandable\",\n                  title: localize(\"ui.components.selectors.selector.options\"),\n                  schema: SELECTOR_SCHEMAS[choice],\n                },\n              ]\n            : SELECTOR_SCHEMAS[choice]\n          : []),\n      ] as const\n  );\n\n  protected render() {\n    let data;\n    let type;\n    if (this._yamlMode) {\n      type = \"manual\";\n      data = { type, manual: this.value };\n    } else {\n      type = Object.keys(this.value)[0];\n      const value0 = Object.values(this.value)[0];\n      data = {\n        type,\n        ...(typeof value0 === \"object\" ? value0 : []),\n      };\n    }\n\n    const schema = this._schema(type, this.hass.localize);\n\n    return html`<div>\n      <p>${this.label ? this.label : \"\"}</p>\n      <ha-form\n        .hass=${this.hass}\n        .data=${data}\n        .schema=${schema}\n        .computeLabel=${this._computeLabelCallback}\n        @value-changed=${this._valueChanged}\n        .narrow=${this.narrow}\n      ></ha-form>\n    </div>`;\n  }\n\n  private _valueChanged(ev: CustomEvent) {\n    ev.stopPropagation();\n    const value = ev.detail.value;\n\n    const type = value.type;\n    if (!type || typeof value !== \"object\" || Object.keys(value).length === 0) {\n      // not sure how this happens, but reject it\n      return;\n    }\n\n    const oldType = Object.keys(this.value)[0];\n    if (type === \"manual\" && !this._yamlMode) {\n      this._yamlMode = true;\n      this.requestUpdate();\n      return;\n    }\n    if (type === \"manual\" && value.manual === undefined) {\n      return;\n    }\n    if (type !== \"manual\") {\n      this._yamlMode = false;\n    }\n    delete value.type;\n\n    let newValue;\n    if (type === \"manual\") {\n      newValue = value.manual;\n    } else if (type === oldType) {\n      newValue = {\n        [type]: { ...(value.manual ? value.manual[oldType] : value) },\n      };\n    } else {\n      newValue = { [type]: { ...SELECTOR_DEFAULTS[type] } };\n    }\n\n    fireEvent(this, \"value-changed\", { value: newValue });\n  }\n\n  private _computeLabelCallback = (schema: any): string =>\n    this.hass.localize(\n      `ui.components.selectors.selector.${schema.name}` as LocalizeKeys\n    ) || schema.name;\n\n  static styles = css`\n    .title {\n      font-size: var(--ha-font-size-l);\n      padding-top: 16px;\n      overflow: hidden;\n      text-overflow: ellipsis;\n      margin-bottom: 16px;\n      padding-left: 16px;\n      padding-right: 4px;\n      padding-inline-start: 16px;\n      padding-inline-end: 4px;\n      white-space: nowrap;\n    }\n  `;\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    \"ha-selector-selector\": HaSelectorSelector;\n  }\n}\n"],"names":["SELECTOR_DEFAULTS","number","min","max","SELECTOR_SCHEMAS","action","area","name","selector","boolean","attribute","entity","color_temp","select","options","mode","condition","date","datetime","device","duration","floor","icon","location","media","text","multiple","step","object","color_rgb","state","target","template","theme","time","HaSelectorSelector","LitElement","shouldUpdate","changedProps","size","has","render","data","type","this","_yamlMode","manual","value","Object","keys","value0","values","schema","_schema","hass","localize","html","label","_computeLabelCallback","_valueChanged","narrow","ev","stopPropagation","detail","length","oldType","requestUpdate","undefined","newValue","fireEvent","args","disabled","required","memoizeOne","choice","concat","map","key","title","styles","css","Boolean","reflect"],"mappings":"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"}