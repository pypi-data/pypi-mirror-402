{"version":3,"file":"1794.afb9da50cba7c1b7.js","sources":["webpack://insteon-frontend/./homeassistant-frontend/src/dialogs/config-flow/previews/flow-preview-generic.ts"],"sourcesContent":["import type { HassEntity, UnsubscribeFunc } from \"home-assistant-js-websocket\";\nimport { LitElement, html } from \"lit\";\nimport type { nothing, TemplateResult } from \"lit\";\nimport { customElement, property, state } from \"lit/decorators\";\nimport type { FlowType } from \"../../../data/data_entry_flow\";\nimport type { GenericPreview } from \"../../../data/preview\";\nimport { subscribePreviewGeneric } from \"../../../data/preview\";\nimport type { HomeAssistant } from \"../../../types\";\nimport \"./entity-preview-row\";\nimport { debounce } from \"../../../common/util/debounce\";\nimport { fireEvent } from \"../../../common/dom/fire_event\";\nimport \"../../../components/ha-alert\";\n\n@customElement(\"flow-preview-generic\")\nexport class FlowPreviewGeneric extends LitElement {\n  @property({ attribute: false }) public hass!: HomeAssistant;\n\n  @property({ attribute: false }) public flowType!: FlowType;\n\n  public handler!: string;\n\n  @property() public domain!: string;\n\n  @property({ attribute: false }) public stepId!: string;\n\n  @property({ attribute: false }) public flowId!: string;\n\n  @property({ attribute: false }) public stepData!: Record<string, any>;\n\n  @state() protected _preview?: HassEntity;\n\n  @state() protected _error?: string;\n\n  private _unsub?: Promise<UnsubscribeFunc>;\n\n  disconnectedCallback(): void {\n    super.disconnectedCallback();\n    if (this._unsub) {\n      this._unsub.then((unsub) => unsub());\n      this._unsub = undefined;\n    }\n  }\n\n  willUpdate(changedProps) {\n    if (changedProps.has(\"stepData\")) {\n      this._debouncedSubscribePreview();\n    }\n  }\n\n  protected render(): TemplateResult | typeof nothing {\n    if (this._error) {\n      return html`<ha-alert alert-type=\"error\">${this._error}</ha-alert>`;\n    }\n    return html`<entity-preview-row\n      .hass=${this.hass}\n      .stateObj=${this._preview}\n    ></entity-preview-row>`;\n  }\n\n  private _setPreview = (preview: GenericPreview) => {\n    if (preview.error) {\n      this._error = preview.error;\n      this._preview = undefined;\n      return;\n    }\n    const now = new Date().toISOString();\n    this._preview = {\n      entity_id: `${this.stepId}.___flow_preview___`,\n      last_changed: now,\n      last_updated: now,\n      context: { id: \"\", parent_id: null, user_id: null },\n      ...preview,\n    };\n  };\n\n  private _debouncedSubscribePreview = debounce(() => {\n    this._subscribePreview();\n  }, 250);\n\n  private async _subscribePreview() {\n    if (this._unsub) {\n      (await this._unsub)();\n      this._unsub = undefined;\n    }\n    if (\n      this.flowType !== \"config_flow\" &&\n      this.flowType !== \"options_flow\" &&\n      this.flowType !== \"config_subentries_flow\"\n    ) {\n      return;\n    }\n    this._error = undefined;\n    try {\n      this._unsub = subscribePreviewGeneric(\n        this.hass,\n        this.domain,\n        this.flowId,\n        this.flowType,\n        this.stepData,\n        this._setPreview\n      );\n      await this._unsub;\n      fireEvent(this, \"set-flow-errors\", { errors: {} });\n    } catch (err: any) {\n      if (typeof err.message === \"string\") {\n        this._error = err.message;\n      } else {\n        this._error = undefined;\n        fireEvent(this, \"set-flow-errors\", err.message);\n      }\n      this._unsub = undefined;\n      this._preview = undefined;\n    }\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    \"flow-preview-generic\": FlowPreviewGeneric;\n  }\n}\n"],"names":["FlowPreviewGeneric","LitElement","disconnectedCallback","super","this","_unsub","then","unsub","undefined","willUpdate","changedProps","has","_debouncedSubscribePreview","render","_error","html","hass","_preview","_subscribePreview","flowType","subscribePreviewGeneric","domain","flowId","stepData","_setPreview","fireEvent","errors","err","message","args","preview","error","now","Date","toISOString","entity_id","stepId","last_changed","last_updated","context","id","parent_id","user_id","debounce","attribute"],"mappings":"wUAcO,MAAPA,UAAAC,EAAAA,GAqBEC,oBAAAA,GACEC,MAAAD,uBACIE,KAAJC,SACED,KAAAC,OAAAC,KAAAC,GAAAA,KACAH,KAAAC,YAAAG,EAEJ,CAEAC,UAAAA,CAAAC,GACEA,EAAAC,IAAA,aACEP,KAAAQ,4BAEJ,CAEUC,MAAAA,GACR,OAAIT,KAAJU,OACEC,EAAAA,EAAA,qCAAAD,oBAEFC,EAAAA,EAAA;cACQ,KAAAC;kBACI,KAAAC;2BAEd,CAsBA,uBAAAC,GAKE,GAJId,KAAJC,gBACG,KAAAA,UACDD,KAAAC,YAAAG,GAEF,gBAAI,KAAJW,UAAA,sBAAAA,UAAA,gCAAAA,SAAA,CAOAf,KAAAU,YAAAN,EACA,IACEJ,KAAAC,QAAAe,EAAAA,EAAAA,GAAAhB,KAAAY,KAAAZ,KAAAiB,OAAAjB,KAAAkB,OAAAlB,KAAAe,SAAAf,KAAAmB,SAAAnB,KAAAoB,mBAQMpB,KAANC,QACAoB,EAAAA,EAAAA,GAAA,wBAAqCC,OAAA,IACvC,CAAE,MAAFC,GACE,iBAAAA,EAAAC,QACExB,KAAAU,OAAAa,EAAAC,SAEAxB,KAAAU,YAAAN,GACAiB,EAAAA,EAAAA,GAAA,uBAAAE,EAAAC,UAEFxB,KAAAC,YAAAG,EACAJ,KAAAa,cAAAT,CACF,CAtBA,CAuBF,C,kBAnGK,SAAAqB,GAAA,KAAAL,YAAAM,IA8CH,GAAAA,EAAAC,MAGE,OAFA3B,KAAAU,OAAAgB,EAAAC,WACA3B,KAAAa,cAAAT,GAGF,MAAAwB,GAAA,IAAAC,MAAAC,cACA9B,KAAAa,SAAA,CACEkB,UAAA,QAAAC,4BACAC,aAAAL,EACAM,aAAAN,EACAO,QAAA,CAAWC,GAAA,GAAQC,UAAA,KAAiBC,QAAA,SACpCZ,IAEJ,KAAAlB,4BAAA+B,EAAAA,EAAAA,GAAA,KAGEvC,KAAAc,qBACC,I,8BA9DS0B,WAAA,K,uDAEAA,WAAA,K,sHAMAA,WAAA,K,yDAEAA,WAAA,K,yDAEAA,WAAA,K"}