{"version":3,"file":"2542.57a7d51f6a3387a0.js","sources":["webpack://insteon-frontend/./homeassistant-frontend/src/common/entity/context/get_area_context.ts","webpack://insteon-frontend/./homeassistant-frontend/src/components/ha-area-picker.ts","webpack://insteon-frontend/./homeassistant-frontend/src/panels/config/areas/dialog-floor-registry-detail.ts","webpack://insteon-frontend/./homeassistant-frontend/src/panels/config/areas/show-dialog-area-registry-detail.ts"],"sourcesContent":["import type { AreaRegistryEntry } from \"../../../data/area_registry\";\nimport type { FloorRegistryEntry } from \"../../../data/floor_registry\";\nimport type { HomeAssistant } from \"../../../types\";\n\ninterface AreaContext {\n  area: AreaRegistryEntry | null;\n  floor: FloorRegistryEntry | null;\n}\nexport const getAreaContext = (\n  area: AreaRegistryEntry,\n  hassFloors: HomeAssistant[\"floors\"]\n): AreaContext => {\n  const floorId = area.floor_id;\n  const floor = floorId ? hassFloors[floorId] : undefined;\n\n  return {\n    area: area,\n    floor: floor || null,\n  };\n};\n","import { mdiPlus, mdiTextureBox } from \"@mdi/js\";\nimport type { HassEntity } from \"home-assistant-js-websocket\";\nimport type { TemplateResult } from \"lit\";\nimport { LitElement, html, nothing } from \"lit\";\nimport { customElement, property, query } from \"lit/decorators\";\nimport memoizeOne from \"memoize-one\";\nimport { fireEvent } from \"../common/dom/fire_event\";\nimport { computeAreaName } from \"../common/entity/compute_area_name\";\nimport { computeDomain } from \"../common/entity/compute_domain\";\nimport { computeFloorName } from \"../common/entity/compute_floor_name\";\nimport { getAreaContext } from \"../common/entity/context/get_area_context\";\nimport { createAreaRegistryEntry } from \"../data/area_registry\";\nimport type {\n  DeviceEntityDisplayLookup,\n  DeviceRegistryEntry,\n} from \"../data/device_registry\";\nimport { getDeviceEntityDisplayLookup } from \"../data/device_registry\";\nimport type { EntityRegistryDisplayEntry } from \"../data/entity_registry\";\nimport { showAlertDialog } from \"../dialogs/generic/show-dialog-box\";\nimport { showAreaRegistryDetailDialog } from \"../panels/config/areas/show-dialog-area-registry-detail\";\nimport type { HomeAssistant, ValueChangedEvent } from \"../types\";\nimport type { HaDevicePickerDeviceFilterFunc } from \"./device/ha-device-picker\";\nimport \"./ha-combo-box-item\";\nimport \"./ha-generic-picker\";\nimport type { HaGenericPicker } from \"./ha-generic-picker\";\nimport \"./ha-icon-button\";\nimport type { PickerComboBoxItem } from \"./ha-picker-combo-box\";\nimport type { PickerValueRenderer } from \"./ha-picker-field\";\nimport \"./ha-svg-icon\";\n\nconst ADD_NEW_ID = \"___ADD_NEW___\";\n\n@customElement(\"ha-area-picker\")\nexport class HaAreaPicker extends LitElement {\n  @property({ attribute: false }) public hass!: HomeAssistant;\n\n  @property() public label?: string;\n\n  @property() public value?: string;\n\n  @property() public helper?: string;\n\n  @property() public placeholder?: string;\n\n  @property({ type: Boolean, attribute: \"no-add\" })\n  public noAdd = false;\n\n  /**\n   * Show only areas with entities from specific domains.\n   * @type {Array}\n   * @attr include-domains\n   */\n  @property({ type: Array, attribute: \"include-domains\" })\n  public includeDomains?: string[];\n\n  /**\n   * Show no areas with entities of these domains.\n   * @type {Array}\n   * @attr exclude-domains\n   */\n  @property({ type: Array, attribute: \"exclude-domains\" })\n  public excludeDomains?: string[];\n\n  /**\n   * Show only areas with entities of these device classes.\n   * @type {Array}\n   * @attr include-device-classes\n   */\n  @property({ type: Array, attribute: \"include-device-classes\" })\n  public includeDeviceClasses?: string[];\n\n  /**\n   * List of areas to be excluded.\n   * @type {Array}\n   * @attr exclude-areas\n   */\n  @property({ type: Array, attribute: \"exclude-areas\" })\n  public excludeAreas?: string[];\n\n  @property({ attribute: false })\n  public deviceFilter?: HaDevicePickerDeviceFilterFunc;\n\n  @property({ attribute: false })\n  public entityFilter?: (entity: HassEntity) => boolean;\n\n  @property({ type: Boolean }) public disabled = false;\n\n  @property({ type: Boolean }) public required = false;\n\n  @property({ attribute: \"add-button-label\" }) public addButtonLabel?: string;\n\n  @query(\"ha-generic-picker\") private _picker?: HaGenericPicker;\n\n  public async open() {\n    await this.updateComplete;\n    await this._picker?.open();\n  }\n\n  // Recompute value renderer when the areas change\n  private _computeValueRenderer = memoizeOne(\n    (_haAreas: HomeAssistant[\"areas\"]): PickerValueRenderer =>\n      (value) => {\n        const area = this.hass.areas[value];\n\n        if (!area) {\n          return html`\n            <ha-svg-icon slot=\"start\" .path=${mdiTextureBox}></ha-svg-icon>\n            <span slot=\"headline\">${area}</span>\n          `;\n        }\n\n        const { floor } = getAreaContext(area, this.hass.floors);\n\n        const areaName = area ? computeAreaName(area) : undefined;\n        const floorName = floor ? computeFloorName(floor) : undefined;\n\n        const icon = area.icon;\n\n        return html`\n          ${icon\n            ? html`<ha-icon slot=\"start\" .icon=${icon}></ha-icon>`\n            : html`<ha-svg-icon\n                slot=\"start\"\n                .path=${mdiTextureBox}\n              ></ha-svg-icon>`}\n          <span slot=\"headline\">${areaName}</span>\n          ${floorName\n            ? html`<span slot=\"supporting-text\">${floorName}</span>`\n            : nothing}\n        `;\n      }\n  );\n\n  private _getAreas = memoizeOne(\n    (\n      haAreas: HomeAssistant[\"areas\"],\n      haDevices: HomeAssistant[\"devices\"],\n      haEntities: HomeAssistant[\"entities\"],\n      includeDomains: this[\"includeDomains\"],\n      excludeDomains: this[\"excludeDomains\"],\n      includeDeviceClasses: this[\"includeDeviceClasses\"],\n      deviceFilter: this[\"deviceFilter\"],\n      entityFilter: this[\"entityFilter\"],\n      excludeAreas: this[\"excludeAreas\"]\n    ): PickerComboBoxItem[] => {\n      let deviceEntityLookup: DeviceEntityDisplayLookup = {};\n      let inputDevices: DeviceRegistryEntry[] | undefined;\n      let inputEntities: EntityRegistryDisplayEntry[] | undefined;\n\n      const areas = Object.values(haAreas);\n      const devices = Object.values(haDevices);\n      const entities = Object.values(haEntities);\n\n      if (\n        includeDomains ||\n        excludeDomains ||\n        includeDeviceClasses ||\n        deviceFilter ||\n        entityFilter\n      ) {\n        deviceEntityLookup = getDeviceEntityDisplayLookup(entities);\n        inputDevices = devices;\n        inputEntities = entities.filter((entity) => entity.area_id);\n\n        if (includeDomains) {\n          inputDevices = inputDevices!.filter((device) => {\n            const devEntities = deviceEntityLookup[device.id];\n            if (!devEntities || !devEntities.length) {\n              return false;\n            }\n            return deviceEntityLookup[device.id].some((entity) =>\n              includeDomains.includes(computeDomain(entity.entity_id))\n            );\n          });\n          inputEntities = inputEntities!.filter((entity) =>\n            includeDomains.includes(computeDomain(entity.entity_id))\n          );\n        }\n\n        if (excludeDomains) {\n          inputDevices = inputDevices!.filter((device) => {\n            const devEntities = deviceEntityLookup[device.id];\n            if (!devEntities || !devEntities.length) {\n              return true;\n            }\n            return entities.every(\n              (entity) =>\n                !excludeDomains.includes(computeDomain(entity.entity_id))\n            );\n          });\n          inputEntities = inputEntities!.filter(\n            (entity) =>\n              !excludeDomains.includes(computeDomain(entity.entity_id))\n          );\n        }\n\n        if (includeDeviceClasses) {\n          inputDevices = inputDevices!.filter((device) => {\n            const devEntities = deviceEntityLookup[device.id];\n            if (!devEntities || !devEntities.length) {\n              return false;\n            }\n            return deviceEntityLookup[device.id].some((entity) => {\n              const stateObj = this.hass.states[entity.entity_id];\n              if (!stateObj) {\n                return false;\n              }\n              return (\n                stateObj.attributes.device_class &&\n                includeDeviceClasses.includes(stateObj.attributes.device_class)\n              );\n            });\n          });\n          inputEntities = inputEntities!.filter((entity) => {\n            const stateObj = this.hass.states[entity.entity_id];\n            return (\n              stateObj.attributes.device_class &&\n              includeDeviceClasses.includes(stateObj.attributes.device_class)\n            );\n          });\n        }\n\n        if (deviceFilter) {\n          inputDevices = inputDevices!.filter((device) =>\n            deviceFilter!(device)\n          );\n        }\n\n        if (entityFilter) {\n          inputDevices = inputDevices!.filter((device) => {\n            const devEntities = deviceEntityLookup[device.id];\n            if (!devEntities || !devEntities.length) {\n              return false;\n            }\n            return deviceEntityLookup[device.id].some((entity) => {\n              const stateObj = this.hass.states[entity.entity_id];\n              if (!stateObj) {\n                return false;\n              }\n              return entityFilter(stateObj);\n            });\n          });\n          inputEntities = inputEntities!.filter((entity) => {\n            const stateObj = this.hass.states[entity.entity_id];\n            if (!stateObj) {\n              return false;\n            }\n            return entityFilter!(stateObj);\n          });\n        }\n      }\n\n      let outputAreas = areas;\n\n      let areaIds: string[] | undefined;\n\n      if (inputDevices) {\n        areaIds = inputDevices\n          .filter((device) => device.area_id)\n          .map((device) => device.area_id!);\n      }\n\n      if (inputEntities) {\n        areaIds = (areaIds ?? []).concat(\n          inputEntities\n            .filter((entity) => entity.area_id)\n            .map((entity) => entity.area_id!)\n        );\n      }\n\n      if (areaIds) {\n        outputAreas = outputAreas.filter((area) =>\n          areaIds!.includes(area.area_id)\n        );\n      }\n\n      if (excludeAreas) {\n        outputAreas = outputAreas.filter(\n          (area) => !excludeAreas!.includes(area.area_id)\n        );\n      }\n\n      const items = outputAreas.map<PickerComboBoxItem>((area) => {\n        const { floor } = getAreaContext(area, this.hass.floors);\n        const floorName = floor ? computeFloorName(floor) : undefined;\n        const areaName = computeAreaName(area);\n        return {\n          id: area.area_id,\n          primary: areaName || area.area_id,\n          secondary: floorName,\n          icon: area.icon || undefined,\n          icon_path: area.icon ? undefined : mdiTextureBox,\n          sorting_label: areaName,\n          search_labels: [\n            areaName,\n            floorName,\n            area.area_id,\n            ...area.aliases,\n          ].filter((v): v is string => Boolean(v)),\n        };\n      });\n\n      return items;\n    }\n  );\n\n  private _getItems = () =>\n    this._getAreas(\n      this.hass.areas,\n      this.hass.devices,\n      this.hass.entities,\n      this.includeDomains,\n      this.excludeDomains,\n      this.includeDeviceClasses,\n      this.deviceFilter,\n      this.entityFilter,\n      this.excludeAreas\n    );\n\n  private _allAreaNames = memoizeOne(\n    (areas: HomeAssistant[\"areas\"]) =>\n      Object.values(areas)\n        .map((area) => computeAreaName(area)?.toLowerCase())\n        .filter(Boolean) as string[]\n  );\n\n  private _getAdditionalItems = (\n    searchString?: string\n  ): PickerComboBoxItem[] => {\n    if (this.noAdd) {\n      return [];\n    }\n\n    const allAreas = this._allAreaNames(this.hass.areas);\n\n    if (searchString && !allAreas.includes(searchString.toLowerCase())) {\n      return [\n        {\n          id: ADD_NEW_ID + searchString,\n          primary: this.hass.localize(\n            \"ui.components.area-picker.add_new_sugestion\",\n            {\n              name: searchString,\n            }\n          ),\n          icon_path: mdiPlus,\n        },\n      ];\n    }\n\n    return [\n      {\n        id: ADD_NEW_ID,\n        primary: this.hass.localize(\"ui.components.area-picker.add_new\"),\n        icon_path: mdiPlus,\n      },\n    ];\n  };\n\n  protected render(): TemplateResult {\n    const placeholder =\n      this.placeholder ?? this.hass.localize(\"ui.components.area-picker.area\");\n\n    const valueRenderer = this._computeValueRenderer(this.hass.areas);\n\n    return html`\n      <ha-generic-picker\n        .hass=${this.hass}\n        .autofocus=${this.autofocus}\n        .label=${this.label}\n        .helper=${this.helper}\n        .notFoundLabel=${this._notFoundLabel}\n        .emptyLabel=${this.hass.localize(\"ui.components.area-picker.no_areas\")}\n        .disabled=${this.disabled}\n        .required=${this.required}\n        .placeholder=${placeholder}\n        .value=${this.value}\n        .getItems=${this._getItems}\n        .getAdditionalItems=${this._getAdditionalItems}\n        .valueRenderer=${valueRenderer}\n        .addButtonLabel=${this.addButtonLabel}\n        @value-changed=${this._valueChanged}\n      >\n      </ha-generic-picker>\n    `;\n  }\n\n  private _valueChanged(ev: ValueChangedEvent<string>) {\n    ev.stopPropagation();\n    const value = ev.detail.value;\n\n    if (!value) {\n      this._setValue(undefined);\n      return;\n    }\n\n    if (value.startsWith(ADD_NEW_ID)) {\n      this.hass.loadFragmentTranslation(\"config\");\n\n      const suggestedName = value.substring(ADD_NEW_ID.length);\n\n      showAreaRegistryDetailDialog(this, {\n        suggestedName: suggestedName,\n        createEntry: async (values) => {\n          try {\n            const area = await createAreaRegistryEntry(this.hass, values);\n            this._setValue(area.area_id);\n          } catch (err: any) {\n            showAlertDialog(this, {\n              title: this.hass.localize(\n                \"ui.components.area-picker.failed_create_area\"\n              ),\n              text: err.message,\n            });\n          }\n        },\n      });\n      return;\n    }\n\n    this._setValue(value);\n  }\n\n  private _setValue(value?: string) {\n    this.value = value;\n    fireEvent(this, \"value-changed\", { value });\n    fireEvent(this, \"change\");\n  }\n\n  private _notFoundLabel = (search: string) =>\n    this.hass.localize(\"ui.components.area-picker.no_match\", {\n      term: html`<b>‘${search}’</b>`,\n    });\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    \"ha-area-picker\": HaAreaPicker;\n  }\n}\n","import { mdiTextureBox } from \"@mdi/js\";\nimport type { CSSResultGroup } from \"lit\";\nimport { css, html, LitElement, nothing } from \"lit\";\nimport { property, state } from \"lit/decorators\";\nimport { repeat } from \"lit/directives/repeat\";\nimport memoizeOne from \"memoize-one\";\nimport { fireEvent } from \"../../../common/dom/fire_event\";\nimport \"../../../components/chips/ha-chip-set\";\nimport \"../../../components/chips/ha-input-chip\";\nimport \"../../../components/ha-alert\";\nimport \"../../../components/ha-aliases-editor\";\nimport \"../../../components/ha-area-picker\";\nimport \"../../../components/ha-button\";\nimport { createCloseHeading } from \"../../../components/ha-dialog\";\nimport \"../../../components/ha-icon-picker\";\nimport \"../../../components/ha-picture-upload\";\nimport \"../../../components/ha-settings-row\";\nimport \"../../../components/ha-svg-icon\";\nimport \"../../../components/ha-textfield\";\nimport { updateAreaRegistryEntry } from \"../../../data/area_registry\";\nimport type {\n  FloorRegistryEntry,\n  FloorRegistryEntryMutableParams,\n} from \"../../../data/floor_registry\";\nimport { haStyle, haStyleDialog } from \"../../../resources/styles\";\nimport type { HomeAssistant } from \"../../../types\";\nimport { showAreaRegistryDetailDialog } from \"./show-dialog-area-registry-detail\";\nimport type { FloorRegistryDetailDialogParams } from \"./show-dialog-floor-registry-detail\";\n\nclass DialogFloorDetail extends LitElement {\n  @property({ attribute: false }) public hass!: HomeAssistant;\n\n  @state() private _name!: string;\n\n  @state() private _aliases!: string[];\n\n  @state() private _icon!: string | null;\n\n  @state() private _level!: number | null;\n\n  @state() private _error?: string;\n\n  @state() private _params?: FloorRegistryDetailDialogParams;\n\n  @state() private _submitting?: boolean;\n\n  @state() private _addedAreas = new Set<string>();\n\n  @state() private _removedAreas = new Set<string>();\n\n  public showDialog(params: FloorRegistryDetailDialogParams): void {\n    this._params = params;\n    this._error = undefined;\n    this._name = this._params.entry\n      ? this._params.entry.name\n      : this._params.suggestedName || \"\";\n    this._aliases = this._params.entry?.aliases || [];\n    this._icon = this._params.entry?.icon || null;\n    this._level = this._params.entry?.level ?? null;\n    this._addedAreas.clear();\n    this._removedAreas.clear();\n  }\n\n  public closeDialog(): void {\n    this._error = \"\";\n    this._params = undefined;\n    this._addedAreas.clear();\n    this._removedAreas.clear();\n    fireEvent(this, \"dialog-closed\", { dialog: this.localName });\n  }\n\n  private _floorAreas = memoizeOne(\n    (\n      entry: FloorRegistryEntry | undefined,\n      areas: HomeAssistant[\"areas\"],\n      added: Set<string>,\n      removed: Set<string>\n    ) =>\n      Object.values(areas).filter(\n        (area) =>\n          (area.floor_id === entry?.floor_id || added.has(area.area_id)) &&\n          !removed.has(area.area_id)\n      )\n  );\n\n  protected render() {\n    const areas = this._floorAreas(\n      this._params?.entry,\n      this.hass.areas,\n      this._addedAreas,\n      this._removedAreas\n    );\n\n    if (!this._params) {\n      return nothing;\n    }\n    const entry = this._params.entry;\n    const nameInvalid = !this._isNameValid();\n\n    return html`\n      <ha-dialog\n        open\n        @closed=${this.closeDialog}\n        .heading=${createCloseHeading(\n          this.hass,\n          entry\n            ? this.hass.localize(\"ui.panel.config.floors.editor.update_floor\")\n            : this.hass.localize(\"ui.panel.config.floors.editor.create_floor\")\n        )}\n      >\n        <div>\n          ${this._error\n            ? html`<ha-alert alert-type=\"error\">${this._error}</ha-alert>`\n            : \"\"}\n          <div class=\"form\">\n            ${entry\n              ? html`\n                  <ha-settings-row>\n                    <span slot=\"heading\">\n                      ${this.hass.localize(\n                        \"ui.panel.config.floors.editor.floor_id\"\n                      )}\n                    </span>\n                    <span slot=\"description\">${entry.floor_id}</span>\n                  </ha-settings-row>\n                `\n              : nothing}\n\n            <ha-textfield\n              .value=${this._name}\n              @input=${this._nameChanged}\n              .label=${this.hass.localize(\"ui.panel.config.floors.editor.name\")}\n              .validationMessage=${this.hass.localize(\n                \"ui.panel.config.floors.editor.name_required\"\n              )}\n              required\n              dialogInitialFocus\n            ></ha-textfield>\n\n            <ha-textfield\n              .value=${this._level}\n              @input=${this._levelChanged}\n              .label=${this.hass.localize(\n                \"ui.panel.config.floors.editor.level\"\n              )}\n              type=\"number\"\n              .helper=${this.hass.localize(\n                \"ui.panel.config.floors.editor.level_helper\"\n              )}\n              helperPersistent\n            ></ha-textfield>\n\n            <ha-icon-picker\n              .hass=${this.hass}\n              .value=${this._icon}\n              @value-changed=${this._iconChanged}\n              .label=${this.hass.localize(\"ui.panel.config.areas.editor.icon\")}\n            >\n              ${!this._icon\n                ? html`\n                    <ha-floor-icon\n                      slot=\"fallback\"\n                      .floor=${{ level: this._level }}\n                    ></ha-floor-icon>\n                  `\n                : nothing}\n            </ha-icon-picker>\n\n            <h3 class=\"header\">\n              ${this.hass.localize(\n                \"ui.panel.config.floors.editor.areas_section\"\n              )}\n            </h3>\n\n            ${areas.length\n              ? html`<ha-chip-set>\n                  ${repeat(\n                    areas,\n                    (area) => area.area_id,\n                    (area) =>\n                      html`<ha-input-chip\n                        .area=${area}\n                        @click=${this._openArea}\n                        @remove=${this._removeArea}\n                        .label=${area?.name}\n                      >\n                        ${area.icon\n                          ? html`<ha-icon\n                              slot=\"icon\"\n                              .icon=${area.icon}\n                            ></ha-icon>`\n                          : html`<ha-svg-icon\n                              slot=\"icon\"\n                              .path=${mdiTextureBox}\n                            ></ha-svg-icon>`}\n                      </ha-input-chip>`\n                  )}\n                </ha-chip-set>`\n              : html`<p class=\"description\">\n                  ${this.hass.localize(\n                    \"ui.panel.config.floors.editor.areas_description\"\n                  )}\n                </p>`}\n            <ha-area-picker\n              no-add\n              .hass=${this.hass}\n              @value-changed=${this._addArea}\n              .excludeAreas=${areas.map((a) => a.area_id)}\n              .addButtonLabel=${this.hass.localize(\n                \"ui.panel.config.floors.editor.add_area\"\n              )}\n            ></ha-area-picker>\n\n            <h3 class=\"header\">\n              ${this.hass.localize(\n                \"ui.panel.config.floors.editor.aliases_section\"\n              )}\n            </h3>\n\n            <p class=\"description\">\n              ${this.hass.localize(\n                \"ui.panel.config.floors.editor.aliases_description\"\n              )}\n            </p>\n            <ha-aliases-editor\n              .hass=${this.hass}\n              .aliases=${this._aliases}\n              @value-changed=${this._aliasesChanged}\n            ></ha-aliases-editor>\n          </div>\n        </div>\n        <ha-button\n          appearance=\"plain\"\n          slot=\"secondaryAction\"\n          @click=${this.closeDialog}\n        >\n          ${this.hass.localize(\"ui.common.cancel\")}\n        </ha-button>\n        <ha-button\n          slot=\"primaryAction\"\n          @click=${this._updateEntry}\n          .disabled=${nameInvalid || !!this._submitting}\n        >\n          ${entry\n            ? this.hass.localize(\"ui.common.save\")\n            : this.hass.localize(\"ui.common.create\")}\n        </ha-button>\n      </ha-dialog>\n    `;\n  }\n\n  private _openArea(ev) {\n    const area = ev.target.area;\n    showAreaRegistryDetailDialog(this, {\n      entry: area,\n      updateEntry: (values) =>\n        updateAreaRegistryEntry(this.hass!, area.area_id, values),\n    });\n  }\n\n  private _removeArea(ev) {\n    const areaId = ev.target.area.area_id;\n    if (this._addedAreas.has(areaId)) {\n      this._addedAreas.delete(areaId);\n      this._addedAreas = new Set(this._addedAreas);\n      return;\n    }\n    this._removedAreas.add(areaId);\n    this._removedAreas = new Set(this._removedAreas);\n  }\n\n  private _addArea(ev) {\n    const areaId = ev.detail.value;\n    if (!areaId) {\n      return;\n    }\n    ev.target.value = \"\";\n    if (this._removedAreas.has(areaId)) {\n      this._removedAreas.delete(areaId);\n      this._removedAreas = new Set(this._removedAreas);\n      return;\n    }\n    this._addedAreas.add(areaId);\n    this._addedAreas = new Set(this._addedAreas);\n  }\n\n  private _isNameValid() {\n    return this._name.trim() !== \"\";\n  }\n\n  private _nameChanged(ev) {\n    this._error = undefined;\n    this._name = ev.target.value;\n  }\n\n  private _levelChanged(ev) {\n    this._error = undefined;\n    this._level = ev.target.value === \"\" ? null : Number(ev.target.value);\n  }\n\n  private _iconChanged(ev) {\n    this._error = undefined;\n    this._icon = ev.detail.value;\n  }\n\n  private async _updateEntry() {\n    this._submitting = true;\n    const create = !this._params!.entry;\n    try {\n      const values: FloorRegistryEntryMutableParams = {\n        name: this._name.trim(),\n        icon: this._icon || (create ? undefined : null),\n        level: this._level,\n        aliases: this._aliases,\n      };\n      if (create) {\n        await this._params!.createEntry!(values, this._addedAreas);\n      } else {\n        await this._params!.updateEntry!(\n          values,\n          this._addedAreas,\n          this._removedAreas\n        );\n      }\n      this.closeDialog();\n    } catch (err: any) {\n      this._error =\n        err.message ||\n        this.hass.localize(\"ui.panel.config.floors.editor.unknown_error\");\n    } finally {\n      this._submitting = false;\n    }\n  }\n\n  private _aliasesChanged(ev: CustomEvent): void {\n    this._aliases = ev.detail.value;\n  }\n\n  static get styles(): CSSResultGroup {\n    return [\n      haStyle,\n      haStyleDialog,\n      css`\n        ha-textfield {\n          display: block;\n          margin-bottom: 16px;\n        }\n        ha-floor-icon {\n          color: var(--secondary-text-color);\n        }\n        ha-chip-set {\n          margin-bottom: 8px;\n        }\n      `,\n    ];\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    \"dialog-floor-registry-detail\": DialogFloorDetail;\n  }\n}\n\ncustomElements.define(\"dialog-floor-registry-detail\", DialogFloorDetail);\n","import { fireEvent } from \"../../../common/dom/fire_event\";\nimport type {\n  AreaRegistryEntry,\n  AreaRegistryEntryMutableParams,\n} from \"../../../data/area_registry\";\n\nexport interface AreaRegistryDetailDialogParams {\n  entry?: AreaRegistryEntry;\n  suggestedName?: string;\n  createEntry?: (values: AreaRegistryEntryMutableParams) => Promise<unknown>;\n  updateEntry?: (\n    updates: Partial<AreaRegistryEntryMutableParams>\n  ) => Promise<unknown>;\n}\n\nexport const loadAreaRegistryDetailDialog = () =>\n  import(\"./dialog-area-registry-detail\");\n\nexport const showAreaRegistryDetailDialog = (\n  element: HTMLElement,\n  systemLogDetailParams: AreaRegistryDetailDialogParams\n): void => {\n  fireEvent(element, \"show-dialog\", {\n    dialogTag: \"dialog-area-registry-detail\",\n    dialogImport: loadAreaRegistryDetailDialog,\n    dialogParams: systemLogDetailParams,\n  });\n};\n"],"names":["getAreaContext","area","hassFloors","floorId","floor_id","floor","undefined","ADD_NEW_ID","HaAreaPicker","LitElement","open","this","updateComplete","_picker","render","placeholder","hass","localize","valueRenderer","_computeValueRenderer","areas","html","autofocus","label","helper","_notFoundLabel","disabled","required","value","_getItems","_getAdditionalItems","addButtonLabel","_valueChanged","ev","stopPropagation","detail","startsWith","loadFragmentTranslation","suggestedName","substring","length","showAreaRegistryDetailDialog","createEntry","createAreaRegistryEntry","values","_setValue","area_id","err","showAlertDialog","title","text","message","fireEvent","args","noAdd","memoizeOne","_haAreas","mdiTextureBox","floors","areaName","computeAreaName","floorName","computeFloorName","icon","nothing","_getAreas","haAreas","haDevices","haEntities","includeDomains","excludeDomains","includeDeviceClasses","deviceFilter","entityFilter","excludeAreas","inputDevices","inputEntities","deviceEntityLookup","Object","devices","entities","getDeviceEntityDisplayLookup","filter","entity","device","devEntities","id","some","includes","computeDomain","entity_id","every","stateObj","states","attributes","device_class","areaIds","outputAreas","map","concat","primary","secondary","icon_path","sorting_label","search_labels","aliases","v","Boolean","_allAreaNames","toLowerCase","searchString","allAreas","name","mdiPlus","search","term","attribute","type","Array","DialogFloorDetail","showDialog","params","_params","_error","_name","entry","_aliases","_icon","_level","level","_addedAreas","clear","_removedAreas","closeDialog","dialog","localName","_floorAreas","nameInvalid","_isNameValid","createCloseHeading","_nameChanged","_levelChanged","_iconChanged","repeat","_openArea","_removeArea","_addArea","a","_aliasesChanged","_updateEntry","_submitting","target","updateEntry","updateAreaRegistryEntry","areaId","has","delete","Set","add","trim","Number","create","styles","haStyle","haStyleDialog","css","added","removed","customElements","define","loadAreaRegistryDetailDialog","e","element","systemLogDetailParams","dialogTag","dialogImport","dialogParams"],"mappings":"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"}