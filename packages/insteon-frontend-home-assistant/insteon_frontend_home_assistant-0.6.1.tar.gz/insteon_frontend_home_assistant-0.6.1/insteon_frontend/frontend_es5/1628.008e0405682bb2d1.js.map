{"version":3,"file":"1628.008e0405682bb2d1.js","sources":["webpack://insteon-frontend/./homeassistant-frontend/src/components/ha-hls-player.ts","webpack://insteon-frontend/./homeassistant-frontend/src/dialogs/config-flow/previews/flow-preview-generic.ts","webpack://insteon-frontend/./homeassistant-frontend/src/dialogs/config-flow/previews/flow-preview-generic_camera.ts"],"sourcesContent":["import type HlsType from \"hls.js\";\nimport type { PropertyValues, TemplateResult } from \"lit\";\nimport { css, html, LitElement } from \"lit\";\nimport { customElement, property, query, state } from \"lit/decorators\";\nimport { styleMap } from \"lit/directives/style-map\";\nimport { isComponentLoaded } from \"../common/config/is_component_loaded\";\nimport { fireEvent } from \"../common/dom/fire_event\";\nimport { nextRender } from \"../common/util/render-status\";\nimport { fetchStreamUrl } from \"../data/camera\";\nimport type { HomeAssistant } from \"../types\";\nimport \"./ha-alert\";\n\ntype HlsLite = Omit<\n  HlsType,\n  \"subtitleTrackController\" | \"audioTrackController\" | \"emeController\"\n>;\n\n@customElement(\"ha-hls-player\")\nclass HaHLSPlayer extends LitElement {\n  @property({ attribute: false }) public hass!: HomeAssistant;\n\n  @property() public entityid?: string;\n\n  @property() public url?: string;\n\n  @property({ attribute: \"poster-url\" }) public posterUrl?: string;\n\n  @property({ attribute: false }) public aspectRatio?: number;\n\n  @property({ attribute: false }) public fitMode?: \"cover\" | \"contain\" | \"fill\";\n\n  @property({ type: Boolean, attribute: \"controls\" })\n  public controls = false;\n\n  @property({ type: Boolean, attribute: \"muted\" })\n  public muted = false;\n\n  @property({ type: Boolean, attribute: \"autoplay\" })\n  public autoPlay = false;\n\n  @property({ type: Boolean, attribute: \"playsinline\" })\n  public playsInline = false;\n\n  @property({ type: Boolean, attribute: \"allow-exoplayer\" })\n  public allowExoPlayer = false;\n\n  // don't cache this, as we remove it on disconnects\n  @query(\"video\") private _videoEl!: HTMLVideoElement;\n\n  @state() private _error?: string;\n\n  @state() private _errorIsFatal = false;\n\n  @state() private _url!: string;\n\n  private _hlsPolyfillInstance?: HlsLite;\n\n  private _exoPlayer = false;\n\n  private static streamCount = 0;\n\n  private _handleVisibilityChange = () => {\n    if (document.pictureInPictureElement) {\n      // video is playing in picture-in-picture mode, don't do anything\n      return;\n    }\n    if (document.hidden) {\n      this._cleanUp();\n    } else {\n      this._resetError();\n      this._startHls();\n    }\n  };\n\n  public connectedCallback() {\n    super.connectedCallback();\n    HaHLSPlayer.streamCount += 1;\n    if (this.hasUpdated) {\n      this._resetError();\n      this._startHls();\n    }\n    document.addEventListener(\"visibilitychange\", this._handleVisibilityChange);\n  }\n\n  public disconnectedCallback() {\n    super.disconnectedCallback();\n    document.removeEventListener(\n      \"visibilitychange\",\n      this._handleVisibilityChange\n    );\n    HaHLSPlayer.streamCount -= 1;\n    this._cleanUp();\n  }\n\n  protected render(): TemplateResult {\n    return html`\n      ${this._error\n        ? html`<ha-alert\n            alert-type=\"error\"\n            class=${this._errorIsFatal ? \"fatal\" : \"retry\"}\n          >\n            ${this._error}\n          </ha-alert>`\n        : \"\"}\n      ${!this._errorIsFatal\n        ? html`<video\n            .poster=${this.posterUrl}\n            ?autoplay=${this.autoPlay}\n            .muted=${this.muted}\n            ?playsinline=${this.playsInline}\n            ?controls=${this.controls}\n            @loadeddata=${this._loadedData}\n            style=${styleMap({\n              height: this.aspectRatio == null ? \"100%\" : \"auto\",\n              aspectRatio: this.aspectRatio,\n              objectFit: this.fitMode,\n            })}\n          ></video>`\n        : \"\"}\n    `;\n  }\n\n  protected updated(changedProps: PropertyValues) {\n    super.updated(changedProps);\n\n    const entityChanged = changedProps.has(\"entityid\");\n    const urlChanged = changedProps.has(\"url\");\n\n    if (entityChanged) {\n      this._getStreamUrlFromEntityId();\n    } else if (urlChanged && this.url) {\n      this._cleanUp();\n      this._resetError();\n      this._url = this.url;\n      this._startHls();\n    }\n  }\n\n  private async _getStreamUrlFromEntityId(): Promise<void> {\n    this._cleanUp();\n    this._resetError();\n\n    if (!isComponentLoaded(this.hass!, \"stream\")) {\n      this._setFatalError(\"Streaming component is not loaded.\");\n      return;\n    }\n\n    if (!this.entityid) {\n      return;\n    }\n    try {\n      const { url } = await fetchStreamUrl(this.hass!, this.entityid);\n\n      this._url = this.hass.hassUrl(url);\n      this._cleanUp();\n      this._resetError();\n      this._startHls();\n    } catch (err: any) {\n      // Fails if we were unable to get a stream\n      // eslint-disable-next-line\n      console.error(err);\n\n      fireEvent(this, \"streams\", { hasAudio: false, hasVideo: false });\n    }\n  }\n\n  private async _startHls(): Promise<void> {\n    const masterPlaylistPromise = fetch(this._url);\n\n    // eslint-disable-next-line @typescript-eslint/naming-convention\n    const Hls: typeof HlsType = (await import(\"hls.js/dist/hls.light.mjs\"))\n      .default;\n\n    if (!this.isConnected) {\n      return;\n    }\n\n    let hlsSupported = Hls.isSupported();\n\n    if (!hlsSupported) {\n      hlsSupported =\n        this._videoEl.canPlayType(\"application/vnd.apple.mpegurl\") !== \"\";\n    }\n\n    if (!hlsSupported) {\n      this._setFatalError(\n        this.hass.localize(\"ui.components.media-browser.video_not_supported\")\n      );\n      return;\n    }\n\n    const useExoPlayer =\n      this.allowExoPlayer && this.hass.auth.external?.config.hasExoPlayer;\n    const masterPlaylist = await (await masterPlaylistPromise).text();\n\n    if (!this.isConnected) {\n      return;\n    }\n\n    // Parse playlist assuming it is a master playlist. Match group 1 and 2 are codec, match group 3 is regular playlist url\n    // See https://tools.ietf.org/html/rfc8216 for HLS spec details\n    const playlistRegexp =\n      /#EXT-X-STREAM-INF:.*?(?:CODECS=\".*?([^.]*)?\\..*?,([^.]*)?\\..*?\".*?)?(?:\\n|\\r\\n)(.+)/g;\n    const match = playlistRegexp.exec(masterPlaylist);\n    const matchTwice = playlistRegexp.exec(masterPlaylist);\n\n    // Get the regular playlist url from the input (master) playlist, falling back to the input playlist if necessary\n    // This avoids the player having to load and parse the master playlist again before loading the regular playlist\n    let playlist_url: string;\n    if (match !== null && matchTwice === null) {\n      // Only send the regular playlist url if we match exactly once\n      playlist_url = new URL(match[3], this._url).href;\n    } else {\n      playlist_url = this._url;\n    }\n\n    const codecs = match ? `${match[1]},${match[2]}` : undefined;\n\n    this._reportStreams(codecs);\n\n    // If codec is HEVC and ExoPlayer is supported, use ExoPlayer.\n    if (\n      useExoPlayer &&\n      (codecs?.includes(\"hevc\") || codecs?.includes(\"hev1\"))\n    ) {\n      this._renderHLSExoPlayer(playlist_url);\n    } else if (Hls.isSupported()) {\n      this._renderHLSPolyfill(this._videoEl, Hls, playlist_url);\n    } else {\n      this._renderHLSNative(this._videoEl, playlist_url);\n    }\n  }\n\n  private async _renderHLSExoPlayer(url: string) {\n    this._exoPlayer = true;\n    window.addEventListener(\"resize\", this._resizeExoPlayer);\n    this.updateComplete.then(() => nextRender()).then(this._resizeExoPlayer);\n    this._videoEl.style.visibility = \"hidden\";\n    await this.hass!.auth.external!.fireMessage({\n      type: \"exoplayer/play_hls\",\n      payload: {\n        url,\n        muted: this.muted,\n      },\n    });\n  }\n\n  private _resizeExoPlayer = () => {\n    if (!this._videoEl) {\n      return;\n    }\n    const rect = this._videoEl.getBoundingClientRect();\n    this.hass!.auth.external!.fireMessage({\n      type: \"exoplayer/resize\",\n      payload: {\n        left: rect.left,\n        top: rect.top,\n        right: rect.right,\n        bottom: rect.bottom,\n      },\n    });\n  };\n\n  private _isLLHLSSupported(): boolean {\n    // LL-HLS keeps multiple requests in flight, which can run into browser limitations without\n    // an http/2 proxy to pipeline requests. However, a small number of streams active at\n    // once should be OK.\n    // The stream count may be incremented multiple times before this function is called to check\n    // the count e.g. when loading a page with many streams on it. The race can work in our favor\n    // so we now have a better idea on if we'll use too many browser connections later.\n    if (HaHLSPlayer.streamCount <= 2) {\n      return true;\n    }\n    if (\n      !(\"performance\" in window) ||\n      performance.getEntriesByType(\"resource\").length === 0\n    ) {\n      return false;\n    }\n    const perfEntry = performance.getEntriesByType(\n      \"resource\"\n    )[0] as PerformanceResourceTiming;\n    return \"nextHopProtocol\" in perfEntry && perfEntry.nextHopProtocol === \"h2\";\n  }\n\n  private async _renderHLSPolyfill(\n    videoEl: HTMLVideoElement,\n    Hls: typeof HlsType,\n    url: string\n  ) {\n    const hls = new Hls({\n      backBufferLength: 60,\n      fragLoadingTimeOut: 30000,\n      manifestLoadingTimeOut: 30000,\n      levelLoadingTimeOut: 30000,\n      maxLiveSyncPlaybackRate: 2,\n      lowLatencyMode: this._isLLHLSSupported(),\n    });\n    this._hlsPolyfillInstance = hls;\n    hls.attachMedia(videoEl);\n    hls.on(Hls.Events.MEDIA_ATTACHED, () => {\n      this._resetError();\n      hls.loadSource(url);\n    });\n    hls.on(Hls.Events.FRAG_LOADED, (_event, _data: any) => {\n      this._resetError();\n    });\n    hls.on(Hls.Events.ERROR, (_event, data: any) => {\n      // Some errors are recovered automatically by the hls player itself, and the others handled\n      // in this function require special actions to recover. Errors retried in this function\n      // are done with backoff to not cause unnecessary failures.\n      if (!data.fatal) {\n        return;\n      }\n      if (data.type === Hls.ErrorTypes.NETWORK_ERROR) {\n        switch (data.details) {\n          case Hls.ErrorDetails.MANIFEST_LOAD_ERROR: {\n            let error = \"Error starting stream, see logs for details\";\n            if (\n              data.response !== undefined &&\n              data.response.code !== undefined\n            ) {\n              if (data.response.code >= 500) {\n                error += \" (Server failure)\";\n              } else if (data.response.code >= 400) {\n                error += \" (Stream never started)\";\n              } else {\n                error += ` (${data.response.code})`;\n              }\n            }\n            this._setRetryableError(error);\n            break;\n          }\n          case Hls.ErrorDetails.MANIFEST_LOAD_TIMEOUT:\n            this._setRetryableError(\"Timeout while starting stream\");\n            break;\n          default:\n            this._setRetryableError(\"Stream network error\");\n            break;\n        }\n        hls.startLoad();\n      } else if (data.type === Hls.ErrorTypes.MEDIA_ERROR) {\n        this._setRetryableError(\"Error with media stream contents\");\n        hls.recoverMediaError();\n      } else {\n        this._setFatalError(\"Error playing stream\");\n      }\n    });\n  }\n\n  private async _renderHLSNative(videoEl: HTMLVideoElement, url: string) {\n    videoEl.src = url;\n    videoEl.addEventListener(\"loadedmetadata\", () => {\n      videoEl.play();\n    });\n  }\n\n  private _cleanUp() {\n    if (this._hlsPolyfillInstance) {\n      this._hlsPolyfillInstance.destroy();\n      this._hlsPolyfillInstance = undefined;\n    }\n    if (this._exoPlayer) {\n      window.removeEventListener(\"resize\", this._resizeExoPlayer);\n      this.hass!.auth.external!.fireMessage({ type: \"exoplayer/stop\" });\n      this._exoPlayer = false;\n    }\n    if (this._videoEl) {\n      this._videoEl.removeAttribute(\"src\");\n      this._videoEl.load();\n    }\n  }\n\n  private _resetError() {\n    this._error = undefined;\n    this._errorIsFatal = false;\n  }\n\n  private _setFatalError(errorMessage: string) {\n    this._error = errorMessage;\n    this._errorIsFatal = true;\n    fireEvent(this, \"streams\", { hasAudio: false, hasVideo: false });\n  }\n\n  private _setRetryableError(errorMessage: string) {\n    this._error = errorMessage;\n    this._errorIsFatal = false;\n    fireEvent(this, \"streams\", { hasAudio: false, hasVideo: false });\n  }\n\n  private _reportStreams(codecs?: string) {\n    const codec = codecs?.split(\",\");\n    fireEvent(this, \"streams\", {\n      hasAudio: codec?.includes(\"mp4a\") ?? false,\n      hasVideo: codec?.includes(\"mp4a\")\n        ? codec?.length > 1\n        : Boolean(codec?.length),\n    });\n  }\n\n  private _loadedData() {\n    fireEvent(this, \"load\");\n  }\n\n  static styles = css`\n    :host,\n    video {\n      display: block;\n    }\n\n    video {\n      width: 100%;\n      max-height: var(--video-max-height, calc(100vh - 97px));\n    }\n\n    .fatal {\n      display: block;\n      padding: 100px 16px;\n    }\n\n    .retry {\n      display: block;\n    }\n  `;\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    \"ha-hls-player\": HaHLSPlayer;\n  }\n}\n","import type { HassEntity, UnsubscribeFunc } from \"home-assistant-js-websocket\";\nimport { LitElement, html } from \"lit\";\nimport type { nothing, TemplateResult } from \"lit\";\nimport { customElement, property, state } from \"lit/decorators\";\nimport type { FlowType } from \"../../../data/data_entry_flow\";\nimport type { GenericPreview } from \"../../../data/preview\";\nimport { subscribePreviewGeneric } from \"../../../data/preview\";\nimport type { HomeAssistant } from \"../../../types\";\nimport \"./entity-preview-row\";\nimport { debounce } from \"../../../common/util/debounce\";\nimport { fireEvent } from \"../../../common/dom/fire_event\";\nimport \"../../../components/ha-alert\";\n\n@customElement(\"flow-preview-generic\")\nexport class FlowPreviewGeneric extends LitElement {\n  @property({ attribute: false }) public hass!: HomeAssistant;\n\n  @property({ attribute: false }) public flowType!: FlowType;\n\n  public handler!: string;\n\n  @property() public domain!: string;\n\n  @property({ attribute: false }) public stepId!: string;\n\n  @property({ attribute: false }) public flowId!: string;\n\n  @property({ attribute: false }) public stepData!: Record<string, any>;\n\n  @state() protected _preview?: HassEntity;\n\n  @state() protected _error?: string;\n\n  private _unsub?: Promise<UnsubscribeFunc>;\n\n  disconnectedCallback(): void {\n    super.disconnectedCallback();\n    if (this._unsub) {\n      this._unsub.then((unsub) => unsub());\n      this._unsub = undefined;\n    }\n  }\n\n  willUpdate(changedProps) {\n    if (changedProps.has(\"stepData\")) {\n      this._debouncedSubscribePreview();\n    }\n  }\n\n  protected render(): TemplateResult | typeof nothing {\n    if (this._error) {\n      return html`<ha-alert alert-type=\"error\">${this._error}</ha-alert>`;\n    }\n    return html`<entity-preview-row\n      .hass=${this.hass}\n      .stateObj=${this._preview}\n    ></entity-preview-row>`;\n  }\n\n  private _setPreview = (preview: GenericPreview) => {\n    if (preview.error) {\n      this._error = preview.error;\n      this._preview = undefined;\n      return;\n    }\n    const now = new Date().toISOString();\n    this._preview = {\n      entity_id: `${this.stepId}.___flow_preview___`,\n      last_changed: now,\n      last_updated: now,\n      context: { id: \"\", parent_id: null, user_id: null },\n      ...preview,\n    };\n  };\n\n  private _debouncedSubscribePreview = debounce(() => {\n    this._subscribePreview();\n  }, 250);\n\n  private async _subscribePreview() {\n    if (this._unsub) {\n      (await this._unsub)();\n      this._unsub = undefined;\n    }\n    if (\n      this.flowType !== \"config_flow\" &&\n      this.flowType !== \"options_flow\" &&\n      this.flowType !== \"config_subentries_flow\"\n    ) {\n      return;\n    }\n    this._error = undefined;\n    try {\n      this._unsub = subscribePreviewGeneric(\n        this.hass,\n        this.domain,\n        this.flowId,\n        this.flowType,\n        this.stepData,\n        this._setPreview\n      );\n      await this._unsub;\n      fireEvent(this, \"set-flow-errors\", { errors: {} });\n    } catch (err: any) {\n      if (typeof err.message === \"string\") {\n        this._error = err.message;\n      } else {\n        this._error = undefined;\n        fireEvent(this, \"set-flow-errors\", err.message);\n      }\n      this._unsub = undefined;\n      this._preview = undefined;\n    }\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    \"flow-preview-generic\": FlowPreviewGeneric;\n  }\n}\n","import { html, nothing } from \"lit\";\nimport { customElement } from \"lit/decorators\";\nimport { FlowPreviewGeneric } from \"./flow-preview-generic\";\nimport \"../../../components/ha-hls-player\";\nimport \"../../../components/ha-spinner\";\n\n@customElement(\"flow-preview-generic_camera\")\nclass FlowPreviewGenericCamera extends FlowPreviewGeneric {\n  protected override render() {\n    if (!this._preview) {\n      return nothing;\n    }\n    if (this._error) {\n      return html`<ha-alert alert-type=\"error\">${this._error}</ha-alert>`;\n    }\n\n    const stillUrl = this._preview.attributes.still_url;\n    const streamUrl = this._preview.attributes.stream_url;\n\n    return html` ${stillUrl\n      ? html`<p>Still image:</p>\n          <p>\n            <img src=${stillUrl} alt=\"Still preview\" />\n          </p>`\n      : \"\"}\n    ${streamUrl\n      ? html`<p>Stream:</p>\n          <ha-spinner\n            class=\"render-spinner\"\n            id=\"hls-load-spinner\"\n            size=\"large\"\n          ></ha-spinner>\n          <ha-hls-player\n            autoplay\n            playsinline\n            .hass=${this.hass}\n            .url=${streamUrl}\n            @load=${this._videoLoaded}\n          ></ha-hls-player>`\n      : \"\"}`;\n  }\n\n  private _videoLoaded() {\n    this.shadowRoot!.getElementById(\"hls-load-spinner\")?.remove();\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    \"flow-preview-generic_camera\": FlowPreviewGenericCamera;\n  }\n}\n"],"names":["HaHLSPlayer","_LitElement","_this","_callSuper","concat","args","controls","muted","autoPlay","playsInline","allowExoPlayer","_errorIsFatal","_exoPlayer","_handleVisibilityChange","document","pictureInPictureElement","hidden","_cleanUp","_resetError","_startHls","_resizeExoPlayer","_videoEl","rect","getBoundingClientRect","hass","auth","external","fireMessage","type","payload","left","top","right","bottom","_superPropGet","streamCount","this","hasUpdated","addEventListener","key","value","removeEventListener","html","_templateObject","_taggedTemplateLiteral","_error","_templateObject2","_templateObject3","posterUrl","_loadedData","styleMap","height","aspectRatio","objectFit","fitMode","changedProps","entityChanged","has","urlChanged","_getStreamUrlFromEntityId","url","_url","_getStreamUrlFromEntityId2","_asyncToGenerator","_regenerator","m","_callee","_yield$fetchStreamUrl","_t","w","_context","p","n","isComponentLoaded","_setFatalError","a","entityid","fetchStreamUrl","v","hassUrl","console","error","fireEvent","hasAudio","hasVideo","apply","arguments","_startHls2","_callee2","_this$hass$auth$exter","masterPlaylistPromise","Hls","hlsSupported","useExoPlayer","masterPlaylist","playlistRegexp","match","matchTwice","playlist_url","codecs","_context2","fetch","default","isConnected","isSupported","canPlayType","localize","config","hasExoPlayer","text","exec","URL","href","undefined","_reportStreams","includes","_renderHLSExoPlayer","_renderHLSPolyfill","_renderHLSNative","_renderHLSExoPlayer2","_callee3","_context3","window","updateComplete","then","nextRender","style","visibility","_x","performance","getEntriesByType","length","perfEntry","nextHopProtocol","_renderHLSPolyfill2","_callee4","videoEl","hls","_this2","_context4","backBufferLength","fragLoadingTimeOut","manifestLoadingTimeOut","levelLoadingTimeOut","maxLiveSyncPlaybackRate","lowLatencyMode","_isLLHLSSupported","_hlsPolyfillInstance","attachMedia","on","Events","MEDIA_ATTACHED","loadSource","FRAG_LOADED","_event","_data","ERROR","data","fatal","ErrorTypes","NETWORK_ERROR","details","ErrorDetails","MANIFEST_LOAD_ERROR","response","code","_setRetryableError","MANIFEST_LOAD_TIMEOUT","startLoad","MEDIA_ERROR","recoverMediaError","_x2","_x3","_x4","_renderHLSNative2","_callee5","_context5","src","play","_x5","_x6","destroy","removeAttribute","load","errorMessage","_codec$includes","codec","split","Boolean","LitElement","styles","css","_templateObject4","attribute","FlowPreviewGeneric","_setPreview","preview","_preview","now","Date","toISOString","Object","assign","entity_id","stepId","last_changed","last_updated","context","id","parent_id","user_id","_debouncedSubscribePreview","debounce","_subscribePreview","_unsub","unsub","_subscribePreview2","_t2","flowType","subscribePreviewGeneric","domain","flowId","stepData","errors","message","FlowPreviewGenericCamera","_FlowPreviewGeneric","_classCallCheck","_inherits","_createClass","nothing","stillUrl","attributes","still_url","streamUrl","stream_url","_videoLoaded","_this$shadowRoot$getE","shadowRoot","getElementById","remove"],"mappings":"8bAiBAA,G,SAAA,SAAAC,G,2GAoPE,OApPFC,GAAAC,EAAAA,EAAAA,GAAA,KAAAH,EAAA,GAAAI,OAAAC,KAAAC,UAAA,EAAAJ,EAAAK,OAAA,EAAAL,EAAAM,UAAA,EAAAN,EAAAO,aAAA,EAAAP,EAAAQ,gBAAA,EAAAR,EAAAS,eAAA,EAAAT,EAAAU,YAAA,EAAAV,EAAAW,wBAAA,WA6CIC,SAAAC,0BAIAD,SAAAE,OACEd,EAAAe,YAEAf,EAAAgB,cACAhB,EAAAiB,aAEJ,EAAAjB,EAAAkB,iBAAA,WAgLE,GAAAlB,EAAAmB,SAAA,CAGA,IAAAC,EAAApB,EAAAmB,SAAAE,wBACArB,EAAAsB,KAAAC,KAAAC,SAAAC,YAAA,CACEC,KAAA,mBACAC,QAAA,CACEC,KAAAR,EAAAQ,KACAC,IAAAT,EAAAS,IACAC,MAAAV,EAAAU,MACAC,OAAAX,EAAAW,SARJ,CAWF,EAAA/B,C,8DA3LO,YACLgC,EAAAA,EAAAA,GAAAlC,EAAA,2BAAAkC,CAAA,IACAlC,EAAAmC,aAAA,EACIC,KAAJC,aACED,KAAAlB,cACAkB,KAAAjB,aAEFL,SAAAwB,iBAAA,wBAAAzB,wBACF,IAAA0B,IAAA,uBAAAC,MAEO,YACLN,EAAAA,EAAAA,GAAAlC,EAAA,8BAAAkC,CAAA,IACApB,SAAA2B,oBAAA,wBAAA5B,yBAIAb,EAAAmC,aAAA,EACAC,KAAAnB,UACF,IAAAsB,IAAA,SAAAC,MAEU,WACR,OAAAE,EAAAA,EAAAA,IAAAC,IAAAA,GAAAC,EAAAA,EAAAA,GAAA,mCACE,KAAAC,QAAAH,EAAAA,EAAAA,IAAAI,IAAAA,GAAAF,EAAAA,EAAAA,GAAA,4HAGY,KAAAjC,cAAA,gBAEN,KAAAkC,QACS,GAEf,KAAAlC,cAaa,IAbb+B,EAAAA,EAAAA,IAAAK,IAAAA,GAAAH,EAAAA,EAAAA,GAAA,2NAEc,KAAAI,UACE,KAAAxC,SACH,KAAAD,MACM,KAAAE,YACH,KAAAH,SACE,KAAA2C,aACNC,EAAAA,EAAAA,GAAA,CACJC,OAAA,WAAAC,YAAA,cACAA,YAAA,KAAAA,YACAC,UAAA,KAAAC,WAKZ,IAAAf,IAAA,UAAAC,MAEU,SAAAe,IACRrB,EAAAA,EAAAA,GAAAlC,EAAA,iBAAAkC,CAAA,CAAAqB,IAEA,IAAAC,EAAAD,EAAAE,IAAA,YACAC,EAAAH,EAAAE,IAAA,OAEAD,EACEpB,KAAAuB,4BACFD,GAAA,KAAAE,MACExB,KAAAnB,WACAmB,KAAAlB,cACAkB,KAAAyB,KAAAzB,KAAAwB,IACAxB,KAAAjB,YAEJ,IAAAoB,IAAA,4BAAAC,OAAAsB,GAAAC,EAAAA,EAAAA,IAAAC,EAAAA,EAAAA,KAAAC,EAEA,SAAAC,IAAA,IAAAC,EAAAP,EAAAQ,EAAA,OAAAJ,EAAAA,EAAAA,KAAAK,EAAA,SAAAC,GAAA,cAAAA,EAAAC,EAAAD,EAAAE,GAAA,OAEE,GADApC,KAAAnB,WACAmB,KAAAlB,eAEAuD,EAAAA,EAAAA,GAAA,KAAAjD,KAAA,WAAA8C,EAAAE,EAAA,QACE,OAAApC,KAAAsC,eAAA,sCAAAJ,EAAAK,EAAA,aAIF,KAAAC,SAAA,CAAAN,EAAAE,EAAA,eAAAF,EAAAK,EAAA,iBAAAL,EAAAC,EAAA,EAAAD,EAAAE,EAAA,GAIEK,EAAAA,EAAAA,IAAA,KAAArD,KAAA,KAAAoD,UAAA,OAAAT,EAAAG,EAAAQ,EAAAlB,EAAAO,EAAAP,IAEAxB,KAAAyB,KAAAzB,KAAAZ,KAAAuD,QAAAnB,GACAxB,KAAAnB,WACAmB,KAAAlB,cACAkB,KAAAjB,YAAAmD,EAAAE,EAAA,eAAAF,EAAAC,EAAA,EAAAH,EAAAE,EAAAQ,EAIAE,QAAAC,MAAAb,IAEAc,EAAAA,EAAAA,GAAA,gBAA6BC,UAAA,EAAiBC,UAAA,IAAgB,cAAAd,EAAAK,EAAA,KAAAT,EAAA,iBAElE,WA1BA,OAAAJ,EAAAuB,MAAA,KAAAC,UAAA,KAAA/C,IAAA,YAAAC,OAAA+C,GAAAxB,EAAAA,EAAAA,IAAAC,EAAAA,EAAAA,KAAAC,EA4BA,SAAAuB,IAAA,IAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAA,OAAAnC,EAAAA,EAAAA,KAAAK,EAAA,SAAA+B,GAAA,cAAAA,EAAA5B,GAAA,OAGE,OAFAkB,EAAAW,MAAA,KAAAxC,MAEAuC,EAAA5B,EAAA,EACA,2CAAAmB,EAAAS,EAAAtB,EAAAwB,QAGA,KAAAC,YAAA,CAAAH,EAAA5B,EAAA,eAAA4B,EAAAzB,EAAA,UASA,IALAiB,EAAAD,EAAAa,iBAGEZ,EAAA,UAAAvE,SAAAoF,YAAA,kCAIFb,EAAA,CAAAQ,EAAA5B,EAAA,QACE,OAAApC,KAAAsC,eAAAtC,KAAAZ,KAAAkF,SAAA,oDAAAN,EAAAzB,EAAA,UAMF,OAAAkB,EAAA,KAAAnF,iBAAA,QAAA+E,EAAA,KAAAjE,KAAAC,KAAAC,gBAAA,IAAA+D,OAAA,EAAAA,EAAAkB,OAAAC,cAAAR,EAAA5B,EAAA,EAEAkB,EAAA,cAAAU,EAAA5B,EAAA,EAAA4B,EAAAtB,EAAA+B,OAAA,UAAAf,EAAAM,EAAAtB,EAEA,KAAAyB,YAAA,CAAAH,EAAA5B,EAAA,eAAA4B,EAAAzB,EAAA,UAQAqB,GAFAD,EAAA,wFAEAe,KAAAhB,GACAG,EAAAF,EAAAe,KAAAhB,GAOEI,EAFF,OAAAF,GAAA,OAAAC,EAEE,IAAAc,IAAAf,EAAA,QAAAnC,MAAAmD,KAEA,KAAAnD,KAGFsC,EAAAH,EAAA,GAAA5F,OAAA4F,EAAA,QAAA5F,OAAA4F,EAAA,SAAAiB,EAEA7E,KAAA8E,eAAAf,GAGAN,IAAAM,SAAAA,EAAAgB,SAAA,SAAAhB,SAAAA,EAAAgB,SAAA,SAIE/E,KAAAgF,oBAAAlB,GACFP,EAAAa,cACEpE,KAAAiF,mBAAAjF,KAAAf,SAAAsE,EAAAO,GAEA9D,KAAAkF,iBAAAlF,KAAAf,SAAA6E,GACF,cAAAE,EAAAzB,EAAA,KAAAa,EAAA,SACF,WAjEA,OAAAD,EAAAF,MAAA,KAAAC,UAAA,KAAA/C,IAAA,sBAAAC,OAAA+E,GAAAxD,EAAAA,EAAAA,IAAAC,EAAAA,EAAAA,KAAAC,EAmEA,SAAAuD,EAAA5D,GAAA,OAAAI,EAAAA,EAAAA,KAAAK,EAAA,SAAAoD,GAAA,cAAAA,EAAAjD,GAAA,OAIE,OAHApC,KAAAxB,YAAA,EACA8G,OAAApF,iBAAA,cAAAlB,kBACAgB,KAAAuF,eAAAC,KAAA,kBAAAC,EAAAA,EAAAA,IAAA,GAAAD,KAAAxF,KAAAhB,kBACAgB,KAAAf,SAAAyG,MAAAC,WAAA,SAAAN,EAAAjD,EAAA,EACA,KAAAhD,KAAAC,KAAAC,SAAAC,YAAA,CACEC,KAAA,qBACAC,QAAA,CACE+B,IAAAA,EACArD,MAAA,KAAAA,SAEJ,cAAAkH,EAAA9C,EAAA,KAAA6C,EAAA,SACF,SAZAQ,GAAA,OAAAT,EAAAlC,MAAA,KAAAC,UAAA,KAAA/C,IAAA,oBAAAC,MA8BQ,WAON,GAAAxC,EAAAmC,aAAA,EACE,OAAO,EAET,qBAAAuF,SAAA,IAAAO,YAAAC,iBAAA,YAAAC,OAIE,OAAO,EAET,IAAAC,EAAAH,YAAAC,iBAAA,eAGA,MAAO,oBAAPE,GAAA,OAAAA,EAAAC,eACF,IAAA9F,IAAA,qBAAAC,OAAA8F,GAAAvE,EAAAA,EAAAA,IAAAC,EAAAA,EAAAA,KAAAC,EAEA,SAAAsE,EAAAC,EAAA7C,EAAA/B,GAAA,IAAA6E,EAAAC,EAAA,YAAA1E,EAAAA,EAAAA,KAAAK,EAAA,SAAAsE,GAAA,cAAAA,EAAAnE,GAAA,OAKEiE,EAAA,IAAA9C,EAAA,CACEiD,iBAAA,GACAC,mBAAA,IACAC,uBAAA,IACAC,oBAAA,IACAC,wBAAA,EACAC,eAAA,KAAAC,sBAEF9G,KAAA+G,qBAAAV,EACAA,EAAAW,YAAAZ,GACAC,EAAAY,GAAA1D,EAAA2D,OAAAC,eAAA,WACEb,EAAAxH,cACAuH,EAAAe,WAAA5F,EACF,GACA6E,EAAAY,GAAA1D,EAAA2D,OAAAG,YAAA,SAAAC,EAAAC,GACEjB,EAAAxH,aACF,GACAuH,EAAAY,GAAA1D,EAAA2D,OAAAM,MAAA,SAAAF,EAAAG,GAIE,GAAAA,EAAAC,MAGA,GAAAD,EAAAjI,OAAA+D,EAAAoE,WAAAC,cAAA,CACE,OAAAH,EAAAI,SACE,KAAAtE,EAAAuE,aAAAC,oBACE,IAAAlF,EAAA,mDACAgC,IAAA4C,EAAAO,eAAAnD,IAAA4C,EAAAO,SAAAC,OAIER,EAAAO,SAAAC,MAAA,IACEpF,GAAA,oBACF4E,EAAAO,SAAAC,MAAA,IACEpF,GAAA,0BAEAA,GAAA,KAAA7E,OAAAyJ,EAAAO,SAAAC,KAAA,MAGJ3B,EAAA4B,mBAAArF,GACA,MAEF,KAAAU,EAAAuE,aAAAK,sBACE7B,EAAA4B,mBAAA,iCACA,MACF,QACE5B,EAAA4B,mBAAA,wBAGJ7B,EAAA+B,WACF,MAAAX,EAAAjI,OAAA+D,EAAAoE,WAAAU,aACE/B,EAAA4B,mBAAA,oCACA7B,EAAAiC,qBAEAhC,EAAAhE,eAAA,uBAEJ,iBAAAiE,EAAAhE,EAAA,KAAA4D,EAAA,SACF,SA/DAoC,EAAAC,EAAAC,GAAA,OAAAvC,EAAAjD,MAAA,KAAAC,UAAA,KAAA/C,IAAA,mBAAAC,OAAAsI,GAAA/G,EAAAA,EAAAA,IAAAC,EAAAA,EAAAA,KAAAC,EAiEA,SAAA8G,EAAAvC,EAAA5E,GAAA,OAAAI,EAAAA,EAAAA,KAAAK,EAAA,SAAA2G,GAAA,cAAAA,EAAAxG,GAAA,OACEgE,EAAAyC,IAAArH,EACA4E,EAAAlG,iBAAA,4BACEkG,EAAA0C,MACF,iBAAAF,EAAArG,EAAA,KAAAoG,EAAA,IACF,SALAI,EAAAC,GAAA,OAAAN,EAAAzF,MAAA,KAAAC,UAAA,KAAA/C,IAAA,WAAAC,MAOQ,WACFJ,KAAJ+G,uBACE/G,KAAA+G,qBAAAkC,UACAjJ,KAAA+G,0BAAAlC,GAEE7E,KAAJxB,aACE8G,OAAAjF,oBAAA,cAAArB,kBACAgB,KAAAZ,KAAAC,KAAAC,SAAAC,YAAA,CAAwCC,KAAA,mBACxCQ,KAAAxB,YAAA,GAEEwB,KAAJf,WACEe,KAAAf,SAAAiK,gBAAA,OACAlJ,KAAAf,SAAAkK,OAEJ,IAAAhJ,IAAA,cAAAC,MAEQ,WACNJ,KAAAS,YAAAoE,EACA7E,KAAAzB,eAAA,CACF,IAAA4B,IAAA,iBAAAC,MAEQ,SAAAgJ,GACNpJ,KAAAS,OAAA2I,EACApJ,KAAAzB,eAAA,GACAuE,EAAAA,EAAAA,GAAA,gBAA6BC,UAAA,EAAiBC,UAAA,GAChD,IAAA7C,IAAA,qBAAAC,MAEQ,SAAAgJ,GACNpJ,KAAAS,OAAA2I,EACApJ,KAAAzB,eAAA,GACAuE,EAAAA,EAAAA,GAAA,gBAA6BC,UAAA,EAAiBC,UAAA,GAChD,IAAA7C,IAAA,iBAAAC,MAEQ,SAAA2D,GAAA,IAAAsF,EACNC,EAAAvF,aAAA,EAAAA,EAAAwF,MAAA,MACAzG,EAAAA,EAAAA,GAAA,gBACEC,SAAA,QAAAsG,EAAAC,aAAA,EAAAA,EAAAvE,SAAA,mBAAAsE,GAAAA,EACArG,SAAAsG,SAAAA,EAAAvE,SAAA,SAAAuE,aAAA,EAAAA,EAAAvD,QAAA,EAAAyD,QAAAF,aAAA,EAAAA,EAAAvD,SAIJ,IAAA5F,IAAA,cAAAC,MAEQ,YACN0C,EAAAA,EAAAA,GAAA,YACF,KArHA,IAAA4F,EAFAxC,EArHAf,EA5BAhC,EAFAzB,CA0QA,CAjYF,CAAA+H,EAAAA,KACM7L,EAAAmC,YAAA,EAAAnC,EAAA8L,QAAAC,EAAAA,EAAAA,IAAAC,IAAAA,GAAApJ,EAAAA,EAAAA,GAAA,sS,2BACQqJ,WAAA,K,4KAMAA,UAAA,gB,4DAEAA,WAAA,K,8DAEAA,WAAA,K,0DAEArK,KAAAgK,QAAeK,UAAA,c,2DAGfrK,KAAAgK,QAAeK,UAAA,W,wDAGfrK,KAAAgK,QAAeK,UAAA,c,2DAGfrK,KAAAgK,QAAeK,UAAA,iB,8DAGfrK,KAAAgK,QAAeK,UAAA,qB,4qBC7BtB,IAAPC,EAAA,SAAAjM,G,2GA+DE,OA/DKC,GAAAC,EAAAA,EAAAA,GAAA,KAAA+L,EAAA,GAAA9L,OAAAC,KAAA8L,YAAA,SAAAC,GA8CH,GAAAA,EAAAnH,MAGE,OAFA/E,EAAA2C,OAAAuJ,EAAAnH,WACA/E,EAAAmM,cAAApF,GAGF,IAAAqF,GAAA,IAAAC,MAAAC,cACAtM,EAAAmM,SAAAI,OAAAC,OAAA,CACEC,UAAA,GAAAvM,OAAAF,EAAA0M,OAAA,uBACAC,aAAAP,EACAQ,aAAAR,EACAS,QAAA,CAAWC,GAAA,GAAQC,UAAA,KAAiBC,QAAA,OACpCd,EAEJ,EAAAlM,EAAAiN,4BAAAC,EAAAA,EAAAA,GAAA,WAGElN,EAAAmN,mBACF,EAAG,KAAHnN,C,iEA1CA,YACEgC,EAAAA,EAAAA,GAAAgK,EAAA,8BAAAhK,CAAA,IACIE,KAAJkL,SACElL,KAAAkL,OAAA1F,KAAA,SAAA2F,GAAA,OAAAA,GAAA,GACAnL,KAAAkL,YAAArG,EAEJ,IAAA1E,IAAA,aAAAC,MAEA,SAAAe,GACEA,EAAAE,IAAA,aACErB,KAAA+K,4BAEJ,IAAA5K,IAAA,SAAAC,MAEU,WACR,OAAIJ,KAAJS,QACEH,EAAAA,EAAAA,IAAAC,IAAAA,GAAAC,EAAAA,EAAAA,GAAA,uDAAAC,SAEFH,EAAAA,EAAAA,IAAAI,IAAAA,GAAAF,EAAAA,EAAAA,GAAA,4FACQ,KAAApB,KACI,KAAA6K,SAEd,IAAA9J,IAAA,oBAAAC,OAAAgL,GAAAzJ,EAAAA,EAAAA,IAAAC,EAAAA,EAAAA,KAAAC,EAsBA,SAAAC,IAAA,IAAAuJ,EAAA,OAAAzJ,EAAAA,EAAAA,KAAAK,EAAA,SAAAC,GAAA,cAAAA,EAAAC,EAAAD,EAAAE,GAAA,WACE,KAAA8I,OAAA,CAAAhJ,EAAAE,EAAA,eAAAF,EAAAE,EAAA,EACG,KAAA8I,OAAA,QAAAlJ,EAAAE,EAAAQ,KACD1C,KAAAkL,YAAArG,EAAA,UAEF,qBAAAyG,UAAA,sBAAAA,UAAA,gCAAAA,SAAA,CAAApJ,EAAAE,EAAA,eAAAF,EAAAK,EAAA,UASE,OAFFvC,KAAAS,YAAAoE,EAAA3C,EAAAC,EAAA,EAEEnC,KAAAkL,QAAAK,EAAAA,EAAAA,GAAAvL,KAAAZ,KAAAY,KAAAwL,OAAAxL,KAAAyL,OAAAzL,KAAAsL,SAAAtL,KAAA0L,SAAA1L,KAAA+J,aAAA7H,EAAAE,EAAA,EAQA,KAAA8I,OAAA,QACApI,EAAAA,EAAAA,GAAA,wBAAqC6I,OAAA,KAAWzJ,EAAAE,EAAA,eAAAF,EAAAC,EAAA,EAEhD,iBAFgDkJ,EAAAnJ,EAAAQ,GAEhDkJ,QACE5L,KAAAS,OAAA4K,EAAAO,SAEA5L,KAAAS,YAAAoE,GACA/B,EAAAA,EAAAA,GAAA,uBAAAuI,EAAAO,UAEF5L,KAAAkL,YAAArG,EACA7E,KAAAiK,cAAApF,EAAA,cAAA3C,EAAAK,EAAA,KAAAT,EAAA9B,KAAA,YAEJ,WAlCA,OAAAoL,EAAAnI,MAAA,KAAAC,UAAA,MAtBA,IAAAkI,CAsBA,CAjEF,CAAA3B,EAAAA,K,2BACcI,WAAA,K,uDAEAA,WAAA,K,sHAMAA,WAAA,K,yDAEAA,WAAA,K,yDAEAA,WAAA,K,0cCvBd,IAEAgC,EAAA,SAAAC,GAAA,SAAAD,IAAA,OAAAE,EAAAA,EAAAA,GAAA,KAAAF,IAAA9N,EAAAA,EAAAA,GAAA,KAAA8N,EAAA3I,UAAA,QAAA8I,EAAAA,EAAAA,GAAAH,EAAAC,IAAAG,EAAAA,EAAAA,GAAAJ,EAAA,EAAA1L,IAAA,SAAAC,MAEqB,WACjB,IAAKJ,KAALiK,SACE,OAAAiC,EAAAA,GAEF,GAAIlM,KAAJS,OACE,OAAAH,EAAAA,EAAAA,IAAAC,IAAAA,GAAAC,EAAAA,EAAAA,GAAA,uDAAAC,QAGF,IAAA0L,EAAA,KAAAlC,SAAAmC,WAAAC,UACAC,EAAA,KAAArC,SAAAmC,WAAAG,WAEA,OAAAjM,EAAAA,EAAAA,IAAAI,IAAAA,GAAAF,EAAAA,EAAAA,GAAA,oBAAA2L,GAAA7L,EAAAA,EAAAA,IAAAK,IAAAA,GAAAH,EAAAA,EAAAA,GAAA,0GAGiB2L,GACP,GAEVG,GAAAhM,EAAAA,EAAAA,IAAAsJ,IAAAA,GAAApJ,EAAAA,EAAAA,GAAA,iVAUc,KAAApB,KACDkN,EACC,KAAAE,cACS,GAEzB,IAAArM,IAAA,eAAAC,MAEQ,eAAAqM,EACN,QAAAA,EAAAzM,KAAA0M,WAAAC,eAAA,+BAAAF,GAAAA,EAAAG,QACF,KAtCF,CAAA9C,EAAAA,oB"}