{"version":3,"file":"2553.afbe97374f85e3e8.js","sources":["webpack://insteon-frontend/./homeassistant-frontend/src/common/language/format_language.ts","webpack://insteon-frontend/./homeassistant-frontend/src/components/ha-assist-pipeline-picker.ts","webpack://insteon-frontend/./homeassistant-frontend/src/components/ha-list-item.ts","webpack://insteon-frontend/./homeassistant-frontend/src/components/ha-menu.ts","webpack://insteon-frontend/./homeassistant-frontend/src/components/ha-select.ts","webpack://insteon-frontend/./homeassistant-frontend/src/data/assist_pipeline.ts"],"sourcesContent":["import memoizeOne from \"memoize-one\";\nimport type { FrontendLocaleData } from \"../../data/translation\";\n\nexport const formatLanguageCode = (\n  languageCode: string,\n  locale: FrontendLocaleData\n) => {\n  try {\n    return formatLanguageCodeMem(locale)?.of(languageCode) ?? languageCode;\n  } catch {\n    return languageCode;\n  }\n};\n\nconst formatLanguageCodeMem = memoizeOne(\n  (locale: FrontendLocaleData) =>\n    new Intl.DisplayNames(locale.language, {\n      type: \"language\",\n      fallback: \"code\",\n    })\n);\n","import type { PropertyValueMap } from \"lit\";\nimport { css, html, LitElement, nothing } from \"lit\";\nimport { customElement, property, state } from \"lit/decorators\";\nimport { fireEvent } from \"../common/dom/fire_event\";\nimport { stopPropagation } from \"../common/dom/stop_propagation\";\nimport { formatLanguageCode } from \"../common/language/format_language\";\nimport type { AssistPipeline } from \"../data/assist_pipeline\";\nimport { listAssistPipelines } from \"../data/assist_pipeline\";\nimport type { HomeAssistant } from \"../types\";\nimport \"./ha-list-item\";\nimport \"./ha-select\";\nimport type { HaSelect } from \"./ha-select\";\n\nconst PREFERRED = \"preferred\";\nconst LAST_USED = \"last_used\";\n\n@customElement(\"ha-assist-pipeline-picker\")\nexport class HaAssistPipelinePicker extends LitElement {\n  @property() public value?: string;\n\n  @property() public label?: string;\n\n  @property({ attribute: false }) public hass!: HomeAssistant;\n\n  @property({ type: Boolean, reflect: true }) public disabled = false;\n\n  @property({ type: Boolean }) public required = false;\n\n  @property({ attribute: false }) public includeLastUsed = false;\n\n  @state() _pipelines?: AssistPipeline[];\n\n  @state() _preferredPipeline: string | null = null;\n\n  private get _default() {\n    return this.includeLastUsed ? LAST_USED : PREFERRED;\n  }\n\n  protected render() {\n    if (!this._pipelines) {\n      return nothing;\n    }\n    const value = this.value ?? this._default;\n    return html`\n      <ha-select\n        .label=${this.label ||\n        this.hass!.localize(\"ui.components.pipeline-picker.pipeline\")}\n        .value=${value}\n        .required=${this.required}\n        .disabled=${this.disabled}\n        @selected=${this._changed}\n        @closed=${stopPropagation}\n        fixedMenuPosition\n        naturalMenuWidth\n      >\n        ${this.includeLastUsed\n          ? html`\n              <ha-list-item .value=${LAST_USED}>\n                ${this.hass!.localize(\n                  \"ui.components.pipeline-picker.last_used\"\n                )}\n              </ha-list-item>\n            `\n          : null}\n        <ha-list-item .value=${PREFERRED}>\n          ${this.hass!.localize(\"ui.components.pipeline-picker.preferred\", {\n            preferred: this._pipelines.find(\n              (pipeline) => pipeline.id === this._preferredPipeline\n            )?.name,\n          })}\n        </ha-list-item>\n        ${this._pipelines.map(\n          (pipeline) =>\n            html`<ha-list-item .value=${pipeline.id}>\n              ${pipeline.name}\n              (${formatLanguageCode(pipeline.language, this.hass.locale)})\n            </ha-list-item>`\n        )}\n      </ha-select>\n    `;\n  }\n\n  protected firstUpdated(\n    changedProperties: PropertyValueMap<any> | Map<PropertyKey, unknown>\n  ): void {\n    super.firstUpdated(changedProperties);\n    listAssistPipelines(this.hass).then((pipelines) => {\n      this._pipelines = pipelines.pipelines;\n      this._preferredPipeline = pipelines.preferred_pipeline;\n    });\n  }\n\n  static styles = css`\n    ha-select {\n      width: 100%;\n    }\n  `;\n\n  private _changed(ev): void {\n    const target = ev.target as HaSelect;\n    if (\n      !this.hass ||\n      target.value === \"\" ||\n      target.value === this.value ||\n      (this.value === undefined && target.value === this._default)\n    ) {\n      return;\n    }\n    this.value = target.value === this._default ? undefined : target.value;\n    fireEvent(this, \"value-changed\", { value: this.value });\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    \"ha-assist-pipeline-picker\": HaAssistPipelinePicker;\n  }\n}\n","import { ListItemBase } from \"@material/mwc-list/mwc-list-item-base\";\nimport { styles } from \"@material/mwc-list/mwc-list-item.css\";\nimport type { CSSResultGroup } from \"lit\";\nimport { css } from \"lit\";\nimport { customElement } from \"lit/decorators\";\n\n@customElement(\"ha-list-item\")\nexport class HaListItem extends ListItemBase {\n  protected renderRipple() {\n    if (this.noninteractive) {\n      return \"\";\n    }\n    return super.renderRipple();\n  }\n\n  static get styles(): CSSResultGroup {\n    return [\n      styles,\n      css`\n        :host {\n          padding-left: var(\n            --mdc-list-side-padding-left,\n            var(--mdc-list-side-padding, 20px)\n          );\n          padding-inline-start: var(\n            --mdc-list-side-padding-left,\n            var(--mdc-list-side-padding, 20px)\n          );\n          padding-right: var(\n            --mdc-list-side-padding-right,\n            var(--mdc-list-side-padding, 20px)\n          );\n          padding-inline-end: var(\n            --mdc-list-side-padding-right,\n            var(--mdc-list-side-padding, 20px)\n          );\n        }\n        :host([graphic=\"avatar\"]:not([twoLine])),\n        :host([graphic=\"icon\"]:not([twoLine])) {\n          height: 48px;\n        }\n        span.material-icons:first-of-type {\n          margin-inline-start: 0px !important;\n          margin-inline-end: var(\n            --mdc-list-item-graphic-margin,\n            16px\n          ) !important;\n          direction: var(--direction) !important;\n        }\n        span.material-icons:last-of-type {\n          margin-inline-start: auto !important;\n          margin-inline-end: 0px !important;\n          direction: var(--direction) !important;\n        }\n        .mdc-deprecated-list-item__meta {\n          display: var(--mdc-list-item-meta-display);\n          align-items: center;\n          flex-shrink: 0;\n        }\n        :host([graphic=\"icon\"]:not([twoline]))\n          .mdc-deprecated-list-item__graphic {\n          margin-inline-end: var(\n            --mdc-list-item-graphic-margin,\n            20px\n          ) !important;\n        }\n        :host([multiline-secondary]) {\n          height: auto;\n        }\n        :host([multiline-secondary]) .mdc-deprecated-list-item__text {\n          padding: 8px 0;\n        }\n        :host([multiline-secondary]) .mdc-deprecated-list-item__secondary-text {\n          text-overflow: initial;\n          white-space: normal;\n          overflow: auto;\n          display: inline-block;\n          margin-top: 10px;\n        }\n        :host([multiline-secondary]) .mdc-deprecated-list-item__primary-text {\n          margin-top: 10px;\n        }\n        :host([multiline-secondary])\n          .mdc-deprecated-list-item__secondary-text::before {\n          display: none;\n        }\n        :host([multiline-secondary])\n          .mdc-deprecated-list-item__primary-text::before {\n          display: none;\n        }\n        :host([disabled]) {\n          color: var(--disabled-text-color);\n        }\n        :host([noninteractive]) {\n          pointer-events: unset;\n        }\n      `,\n      // safari workaround - must be explicit\n      document.dir === \"rtl\"\n        ? css`\n            span.material-icons:first-of-type,\n            span.material-icons:last-of-type {\n              direction: rtl !important;\n              --direction: rtl;\n            }\n          `\n        : css``,\n    ];\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    \"ha-list-item\": HaListItem;\n  }\n}\n","import { MenuBase } from \"@material/mwc-menu/mwc-menu-base\";\nimport { styles } from \"@material/mwc-menu/mwc-menu.css\";\nimport { html } from \"lit\";\nimport { customElement } from \"lit/decorators\";\nimport { classMap } from \"lit/directives/class-map\";\nimport \"./ha-list\";\n\n@customElement(\"ha-menu\")\nexport class HaMenu extends MenuBase {\n  protected get listElement() {\n    if (!this.listElement_) {\n      this.listElement_ = this.renderRoot.querySelector(\"ha-list\");\n      return this.listElement_;\n    }\n\n    return this.listElement_;\n  }\n\n  protected renderList() {\n    const itemRoles = this.innerRole === \"menu\" ? \"menuitem\" : \"option\";\n    const classes = this.renderListClasses();\n\n    return html`<ha-list\n      rootTabbable\n      .innerAriaLabel=${this.innerAriaLabel}\n      .innerRole=${this.innerRole}\n      .multi=${this.multi}\n      class=${classMap(classes)}\n      .itemRoles=${itemRoles}\n      .wrapFocus=${this.wrapFocus}\n      .activatable=${this.activatable}\n      @action=${this.onAction}\n    >\n      <slot></slot>\n    </ha-list>`;\n  }\n\n  static styles = styles;\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    \"ha-menu\": HaMenu;\n  }\n}\n","import { SelectBase } from \"@material/mwc-select/mwc-select-base\";\nimport { styles } from \"@material/mwc-select/mwc-select.css\";\nimport { mdiClose } from \"@mdi/js\";\nimport { css, html, nothing } from \"lit\";\nimport { customElement, property } from \"lit/decorators\";\nimport { classMap } from \"lit/directives/class-map\";\nimport { debounce } from \"../common/util/debounce\";\nimport { nextRender } from \"../common/util/render-status\";\nimport \"./ha-icon-button\";\nimport \"./ha-menu\";\n\n@customElement(\"ha-select\")\nexport class HaSelect extends SelectBase {\n  // @ts-ignore\n  @property({ type: Boolean }) public icon = false;\n\n  @property({ type: Boolean, reflect: true }) public clearable = false;\n\n  @property({ attribute: \"inline-arrow\", type: Boolean })\n  public inlineArrow = false;\n\n  @property() public options;\n\n  protected override render() {\n    return html`\n      ${super.render()}\n      ${this.clearable && !this.required && !this.disabled && this.value\n        ? html`<ha-icon-button\n            label=\"clear\"\n            @click=${this._clearValue}\n            .path=${mdiClose}\n          ></ha-icon-button>`\n        : nothing}\n    `;\n  }\n\n  protected override renderMenu() {\n    const classes = this.getMenuClasses();\n    return html`<ha-menu\n      innerRole=\"listbox\"\n      wrapFocus\n      class=${classMap(classes)}\n      activatable\n      .fullwidth=${this.fixedMenuPosition ? false : !this.naturalMenuWidth}\n      .open=${this.menuOpen}\n      .anchor=${this.anchorElement}\n      .fixed=${this.fixedMenuPosition}\n      @selected=${this.onSelected}\n      @opened=${this.onOpened}\n      @closed=${this.onClosed}\n      @items-updated=${this.onItemsUpdated}\n      @keydown=${this.handleTypeahead}\n    >\n      ${this.renderMenuContent()}\n    </ha-menu>`;\n  }\n\n  protected override renderLeadingIcon() {\n    if (!this.icon) {\n      return nothing;\n    }\n\n    return html`<span class=\"mdc-select__icon\"\n      ><slot name=\"icon\"></slot\n    ></span>`;\n  }\n\n  connectedCallback() {\n    super.connectedCallback();\n    window.addEventListener(\"translations-updated\", this._translationsUpdated);\n  }\n\n  protected async firstUpdated() {\n    super.firstUpdated();\n\n    if (this.inlineArrow) {\n      this.shadowRoot\n        ?.querySelector(\".mdc-select__selected-text-container\")\n        ?.classList.add(\"inline-arrow\");\n    }\n  }\n\n  protected updated(changedProperties) {\n    super.updated(changedProperties);\n\n    if (changedProperties.has(\"inlineArrow\")) {\n      const textContainerElement = this.shadowRoot?.querySelector(\n        \".mdc-select__selected-text-container\"\n      );\n      if (this.inlineArrow) {\n        textContainerElement?.classList.add(\"inline-arrow\");\n      } else {\n        textContainerElement?.classList.remove(\"inline-arrow\");\n      }\n    }\n    if (changedProperties.get(\"options\")) {\n      this.layoutOptions();\n      this.selectByValue(this.value);\n    }\n  }\n\n  disconnectedCallback() {\n    super.disconnectedCallback();\n    window.removeEventListener(\n      \"translations-updated\",\n      this._translationsUpdated\n    );\n  }\n\n  private _clearValue(): void {\n    if (this.disabled || !this.value) {\n      return;\n    }\n    this.valueSetDirectly = true;\n    this.select(-1);\n    this.mdcFoundation.handleChange();\n  }\n\n  private _translationsUpdated = debounce(async () => {\n    await nextRender();\n    this.layoutOptions();\n  }, 500);\n\n  static override styles = [\n    styles,\n    css`\n      :host([clearable]) {\n        position: relative;\n      }\n      .mdc-select:not(.mdc-select--disabled) .mdc-select__icon {\n        color: var(--secondary-text-color);\n      }\n      .mdc-select__anchor {\n        width: var(--ha-select-min-width, 200px);\n      }\n      .mdc-select--filled .mdc-select__anchor {\n        height: var(--ha-select-height, 56px);\n      }\n      .mdc-select--filled .mdc-floating-label {\n        inset-inline-start: var(--ha-space-4);\n        inset-inline-end: initial;\n        direction: var(--direction);\n      }\n      .mdc-select--filled.mdc-select--with-leading-icon .mdc-floating-label {\n        inset-inline-start: 48px;\n        inset-inline-end: initial;\n        direction: var(--direction);\n      }\n      .mdc-select .mdc-select__anchor {\n        padding-inline-start: var(--ha-space-4);\n        padding-inline-end: 0px;\n        direction: var(--direction);\n      }\n      .mdc-select__anchor .mdc-floating-label--float-above {\n        transform-origin: var(--float-start);\n      }\n      .mdc-select__selected-text-container {\n        padding-inline-end: var(--select-selected-text-padding-end, 0px);\n      }\n      :host([clearable]) .mdc-select__selected-text-container {\n        padding-inline-end: var(\n          --select-selected-text-padding-end,\n          var(--ha-space-4)\n        );\n      }\n      ha-icon-button {\n        position: absolute;\n        top: 10px;\n        right: 28px;\n        --mdc-icon-button-size: 36px;\n        --mdc-icon-size: 20px;\n        color: var(--secondary-text-color);\n        inset-inline-start: initial;\n        inset-inline-end: 28px;\n        direction: var(--direction);\n      }\n      .inline-arrow {\n        flex-grow: 0;\n      }\n    `,\n  ];\n}\ndeclare global {\n  interface HTMLElementTagNameMap {\n    \"ha-select\": HaSelect;\n  }\n}\n","import type { HomeAssistant } from \"../types\";\nimport type { ConversationResult } from \"./conversation\";\nimport type { SpeechMetadata } from \"./stt\";\n\nexport interface AssistPipeline {\n  id: string;\n  name: string;\n  language: string;\n  conversation_engine: string;\n  conversation_language: string | null;\n  prefer_local_intents?: boolean;\n  stt_engine: string | null;\n  stt_language: string | null;\n  tts_engine: string | null;\n  tts_language: string | null;\n  tts_voice: string | null;\n  wake_word_entity: string | null;\n  wake_word_id: string | null;\n}\n\nexport interface AssistDevice {\n  device_id: string;\n  pipeline_entity: string;\n}\n\nexport interface AssistPipelineMutableParams {\n  name: string;\n  language: string;\n  conversation_engine: string;\n  conversation_language: string | null;\n  prefer_local_intents?: boolean;\n  stt_engine: string | null;\n  stt_language: string | null;\n  tts_engine: string | null;\n  tts_language: string | null;\n  tts_voice: string | null;\n  wake_word_entity: string | null;\n  wake_word_id: string | null;\n}\n\nexport interface AssistRunListing {\n  pipeline_run_id: string;\n  timestamp: string;\n}\n\ninterface PipelineEventBase {\n  timestamp: string;\n}\n\ninterface PipelineRunStartEvent extends PipelineEventBase {\n  type: \"run-start\";\n  data: {\n    pipeline: string;\n    language: string;\n    conversation_id: string;\n    runner_data: {\n      stt_binary_handler_id: number | null;\n      timeout: number;\n    };\n    tts_output?: {\n      token: string;\n      url: string;\n      mime_type: string;\n    };\n  };\n}\ninterface PipelineRunEndEvent extends PipelineEventBase {\n  type: \"run-end\";\n  data: Record<string, never>;\n}\n\ninterface PipelineErrorEvent extends PipelineEventBase {\n  type: \"error\";\n  data: {\n    code: string;\n    message: string;\n  };\n}\n\ninterface PipelineWakeWordStartEvent extends PipelineEventBase {\n  type: \"wake_word-start\";\n  data: {\n    engine: string;\n    metadata: SpeechMetadata;\n  };\n}\n\ninterface PipelineWakeWordEndEvent extends PipelineEventBase {\n  type: \"wake_word-end\";\n  data: { wake_word_output: { ww_id: string; timestamp: number } };\n}\n\ninterface PipelineSTTStartEvent extends PipelineEventBase {\n  type: \"stt-start\";\n  data: {\n    engine: string;\n    metadata: SpeechMetadata;\n  };\n}\ninterface PipelineSTTEndEvent extends PipelineEventBase {\n  type: \"stt-end\";\n  data: {\n    stt_output: { text: string };\n  };\n}\n\ninterface PipelineIntentStartEvent extends PipelineEventBase {\n  type: \"intent-start\";\n  data: {\n    engine: string;\n    language: string;\n    prefer_local_intents: boolean;\n    intent_input: string;\n  };\n}\n\nexport interface ConversationChatLogAssistantDelta {\n  role: \"assistant\";\n  content: string;\n  tool_calls: {\n    id: string;\n    tool_name: string;\n    tool_args: Record<string, unknown>;\n  }[];\n}\n\nexport interface ConversationChatLogToolResultDelta {\n  role: \"tool_result\";\n  agent_id: string;\n  tool_call_id: string;\n  tool_name: string;\n  tool_result: unknown;\n}\ninterface PipelineIntentProgressEvent extends PipelineEventBase {\n  type: \"intent-progress\";\n  data: {\n    tts_start_streaming?: boolean;\n    chat_log_delta?:\n      | Partial<ConversationChatLogAssistantDelta>\n      // These always come in 1 chunk\n      | ConversationChatLogToolResultDelta;\n  };\n}\n\ninterface PipelineIntentEndEvent extends PipelineEventBase {\n  type: \"intent-end\";\n  data: {\n    processed_locally: boolean;\n    intent_output: ConversationResult;\n  };\n}\n\ninterface PipelineTTSStartEvent extends PipelineEventBase {\n  type: \"tts-start\";\n  data: {\n    engine: string;\n    language: string;\n    voice: string;\n    tts_input: string;\n  };\n}\ninterface PipelineTTSEndEvent extends PipelineEventBase {\n  type: \"tts-end\";\n  data: {\n    tts_output: {\n      media_id: string;\n      token: string;\n      url: string;\n      mime_type: string;\n    };\n  };\n}\n\nexport type PipelineRunEvent =\n  | PipelineRunStartEvent\n  | PipelineRunEndEvent\n  | PipelineErrorEvent\n  | PipelineWakeWordStartEvent\n  | PipelineWakeWordEndEvent\n  | PipelineSTTStartEvent\n  | PipelineSTTEndEvent\n  | PipelineIntentStartEvent\n  | PipelineIntentProgressEvent\n  | PipelineIntentEndEvent\n  | PipelineTTSStartEvent\n  | PipelineTTSEndEvent;\n\nexport type PipelineRunOptions = (\n  | {\n      start_stage: \"intent\" | \"tts\";\n      input: { text: string };\n    }\n  | {\n      start_stage: \"stt\";\n      input: { sample_rate: number };\n    }\n  | {\n      start_stage: \"wake_word\";\n      input: {\n        sample_rate: number;\n        timeout?: number;\n        audio_seconds_to_buffer?: number;\n      };\n    }\n) & {\n  end_stage: \"stt\" | \"intent\" | \"tts\";\n  pipeline?: string;\n  conversation_id?: string | null;\n};\n\nexport interface PipelineRun {\n  init_options?: PipelineRunOptions;\n  events: PipelineRunEvent[];\n  stage: \"ready\" | \"wake_word\" | \"stt\" | \"intent\" | \"tts\" | \"done\" | \"error\";\n  run: PipelineRunStartEvent[\"data\"];\n  error?: PipelineErrorEvent[\"data\"];\n  started: Date;\n  finished?: Date;\n  wake_word?: PipelineWakeWordStartEvent[\"data\"] &\n    Partial<PipelineWakeWordEndEvent[\"data\"]> & { done: boolean };\n  stt?: PipelineSTTStartEvent[\"data\"] &\n    Partial<PipelineSTTEndEvent[\"data\"]> & { done: boolean };\n  intent?: PipelineIntentStartEvent[\"data\"] &\n    Partial<PipelineIntentEndEvent[\"data\"]> & { done: boolean };\n  tts?: PipelineTTSStartEvent[\"data\"] &\n    Partial<PipelineTTSEndEvent[\"data\"]> & { done: boolean };\n}\n\nexport const processEvent = (\n  run: PipelineRun | undefined,\n  event: PipelineRunEvent,\n  options?: PipelineRunOptions\n): PipelineRun | undefined => {\n  if (event.type === \"run-start\") {\n    run = {\n      init_options: options,\n      stage: \"ready\",\n      run: event.data,\n      events: [event],\n      started: new Date(event.timestamp),\n    };\n    return run;\n  }\n\n  if (!run) {\n    // eslint-disable-next-line no-console\n    console.warn(\"Received unexpected event before receiving session\", event);\n    return undefined;\n  }\n\n  if (event.type === \"wake_word-start\") {\n    run = {\n      ...run,\n      stage: \"wake_word\",\n      wake_word: { ...event.data, done: false },\n    };\n  } else if (event.type === \"wake_word-end\") {\n    run = {\n      ...run,\n      wake_word: { ...run.wake_word!, ...event.data, done: true },\n    };\n  } else if (event.type === \"stt-start\") {\n    run = {\n      ...run,\n      stage: \"stt\",\n      stt: { ...event.data, done: false },\n    };\n  } else if (event.type === \"stt-end\") {\n    run = {\n      ...run,\n      stt: { ...run.stt!, ...event.data, done: true },\n    };\n  } else if (event.type === \"intent-start\") {\n    run = {\n      ...run,\n      stage: \"intent\",\n      intent: { ...event.data, done: false },\n    };\n  } else if (event.type === \"intent-end\") {\n    run = {\n      ...run,\n      intent: { ...run.intent!, ...event.data, done: true },\n    };\n  } else if (event.type === \"tts-start\") {\n    run = {\n      ...run,\n      stage: \"tts\",\n      tts: { ...event.data, done: false },\n    };\n  } else if (event.type === \"tts-end\") {\n    run = {\n      ...run,\n      tts: { ...run.tts!, ...event.data, done: true },\n    };\n  } else if (event.type === \"run-end\") {\n    run = { ...run, finished: new Date(event.timestamp), stage: \"done\" };\n  } else if (event.type === \"error\") {\n    run = {\n      ...run,\n      finished: new Date(event.timestamp),\n      stage: \"error\",\n      error: event.data,\n    };\n  } else {\n    run = { ...run };\n  }\n\n  run.events = [...run.events, event];\n\n  return run;\n};\n\nexport const runDebugAssistPipeline = (\n  hass: HomeAssistant,\n  callback: (run: PipelineRun) => void,\n  options: PipelineRunOptions\n) => {\n  let run: PipelineRun | undefined;\n\n  const unsubProm = runAssistPipeline(\n    hass,\n    (updateEvent) => {\n      run = processEvent(run, updateEvent, options);\n\n      if (updateEvent.type === \"run-end\" || updateEvent.type === \"error\") {\n        unsubProm.then((unsub) => unsub());\n      }\n\n      if (run) {\n        callback(run);\n      }\n    },\n    options\n  );\n\n  return unsubProm;\n};\n\nexport const runAssistPipeline = (\n  hass: HomeAssistant,\n  callback: (event: PipelineRunEvent) => void,\n  options: PipelineRunOptions\n) =>\n  hass.connection.subscribeMessage<PipelineRunEvent>(callback, {\n    ...options,\n    type: \"assist_pipeline/run\",\n  });\n\nexport const listAssistPipelineRuns = (\n  hass: HomeAssistant,\n  pipeline_id: string\n) =>\n  hass.callWS<{\n    pipeline_runs: AssistRunListing[];\n  }>({\n    type: \"assist_pipeline/pipeline_debug/list\",\n    pipeline_id,\n  });\n\nexport const getAssistPipelineRun = (\n  hass: HomeAssistant,\n  pipeline_id: string,\n  pipeline_run_id: string\n) =>\n  hass.callWS<{\n    events: PipelineRunEvent[];\n  }>({\n    type: \"assist_pipeline/pipeline_debug/get\",\n    pipeline_id,\n    pipeline_run_id,\n  });\n\nexport const listAssistPipelines = (hass: HomeAssistant) =>\n  hass.callWS<{\n    pipelines: AssistPipeline[];\n    preferred_pipeline: string | null;\n  }>({\n    type: \"assist_pipeline/pipeline/list\",\n  });\n\nexport const getAssistPipeline = (hass: HomeAssistant, pipeline_id?: string) =>\n  hass.callWS<AssistPipeline>({\n    type: \"assist_pipeline/pipeline/get\",\n    pipeline_id,\n  });\n\nexport const createAssistPipeline = (\n  hass: HomeAssistant,\n  pipeline: AssistPipelineMutableParams\n) =>\n  hass.callWS<AssistPipeline>({\n    type: \"assist_pipeline/pipeline/create\",\n    ...pipeline,\n  });\n\nexport const updateAssistPipeline = (\n  hass: HomeAssistant,\n  pipeline_id: string,\n  pipeline: AssistPipelineMutableParams\n) =>\n  hass.callWS<AssistPipeline>({\n    type: \"assist_pipeline/pipeline/update\",\n    pipeline_id,\n    ...pipeline,\n  });\n\nexport const setAssistPipelinePreferred = (\n  hass: HomeAssistant,\n  pipeline_id: string\n) =>\n  hass.callWS({\n    type: \"assist_pipeline/pipeline/set_preferred\",\n    pipeline_id,\n  });\n\nexport const deleteAssistPipeline = (hass: HomeAssistant, pipelineId: string) =>\n  hass.callWS<undefined>({\n    type: \"assist_pipeline/pipeline/delete\",\n    pipeline_id: pipelineId,\n  });\n\nexport const fetchAssistPipelineLanguages = (hass: HomeAssistant) =>\n  hass.callWS<{ languages: string[] }>({\n    type: \"assist_pipeline/language/list\",\n  });\n\nexport const listAssistDevices = (hass: HomeAssistant) =>\n  hass.callWS<AssistDevice[]>({\n    type: \"assist_pipeline/device/list\",\n  });\n"],"names":["formatLanguageCode","languageCode","locale","_formatLanguageCodeMe","_formatLanguageCodeMe2","formatLanguageCodeMem","of","_unused","memoizeOne","Intl","DisplayNames","language","type","fallback","PREFERRED","LAST_USED","HaAssistPipelinePicker","_LitElement","_this","_callSuper","concat","args","disabled","required","includeLastUsed","_preferredPipeline","this","key","value","_this$value","_this$_pipelines$find","_this2","_pipelines","nothing","_default","html","_templateObject","_taggedTemplateLiteral","label","hass","localize","_changed","stopPropagation","_templateObject2","preferred","find","pipeline","id","name","map","_templateObject3","changedProperties","_this3","_superPropGet","listAssistPipelines","then","pipelines","preferred_pipeline","ev","target","undefined","fireEvent","LitElement","styles","css","_templateObject4","attribute","Boolean","reflect","HaListItem","_ListItemBase","_classCallCheck","arguments","_inherits","_createClass","noninteractive","get","document","dir","ListItemBase","HaMenu","_MenuBase","listElement_","renderRoot","querySelector","itemRoles","innerRole","classes","renderListClasses","innerAriaLabel","multi","classMap","wrapFocus","activatable","onAction","MenuBase","HaSelect","_SelectBase","icon","clearable","inlineArrow","_translationsUpdated","debounce","_asyncToGenerator","_regenerator","m","_callee","w","_context","n","nextRender","layoutOptions","a","_clearValue","getMenuClasses","fixedMenuPosition","naturalMenuWidth","menuOpen","anchorElement","onSelected","onOpened","onClosed","onItemsUpdated","handleTypeahead","renderMenuContent","window","addEventListener","_firstUpdated","_callee2","_this$shadowRoot","_context2","shadowRoot","classList","add","apply","has","_this$shadowRoot2","textContainerElement","remove","selectByValue","removeEventListener","valueSetDirectly","select","mdcFoundation","handleChange","SelectBase","_templateObject5","processEvent","run","event","options","init_options","stage","data","events","started","Date","timestamp","Object","assign","wake_word","done","stt","intent","tts","finished","error","_toConsumableArray","console","warn","runAssistPipeline","callback","connection","subscribeMessage","callWS","getAssistPipeline","pipeline_id","createAssistPipeline","updateAssistPipeline","fetchAssistPipelineLanguages"],"mappings":"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"}