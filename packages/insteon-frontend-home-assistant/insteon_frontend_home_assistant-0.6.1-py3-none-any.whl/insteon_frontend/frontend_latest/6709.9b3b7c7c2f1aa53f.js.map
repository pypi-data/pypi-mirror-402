{"version":3,"file":"6709.9b3b7c7c2f1aa53f.js","sources":["webpack://insteon-frontend/./src/data/scene.ts","webpack://insteon-frontend/./src/insteon-scenes-panel.ts"],"sourcesContent":["import type { HomeAssistant } from \"@ha/types\";\nimport type { HaFormSchema } from \"@ha/components/ha-form/types\";\n\nexport interface InsteonScene {\n  name: string;\n  group: number;\n  devices: { [address: string]: InsteonSceneDeviceData[] };\n}\n\nexport interface InsteonScenes {\n  [scene: number]: InsteonScene;\n}\n\nexport interface SceneSaveResult {\n  scene_id: number;\n  result: boolean;\n}\n\nexport interface InsteonSceneDeviceData {\n  data1: number;\n  data2: number;\n  data3: number;\n  has_controller: boolean;\n  has_responder: boolean;\n}\n\nexport interface InsteonSceneLinkData {\n  address: string;\n  data1: number;\n  data2: number;\n  data3: number;\n}\n\nexport const fetchInsteonScenes = (hass: HomeAssistant): Promise<InsteonScenes> =>\n  hass.callWS({\n    type: \"insteon/scenes/get\",\n  });\n\nexport const fetchInsteonScene = (hass: HomeAssistant, id: number): Promise<InsteonScene> =>\n  hass.callWS({\n    type: \"insteon/scene/get\",\n    scene_id: id,\n  });\n\nexport const saveInsteonScene = (\n  hass: HomeAssistant,\n  scene_id: number,\n  links: InsteonSceneLinkData[],\n  scene_name: string,\n): Promise<SceneSaveResult> =>\n  hass.callWS({\n    type: \"insteon/scene/save\",\n    name: scene_name,\n    scene_id: scene_id,\n    links: links,\n  });\n\nexport const deleteInsteonScene = (\n  hass: HomeAssistant,\n  scene_id: number,\n): Promise<SceneSaveResult> =>\n  hass.callWS({\n    type: \"insteon/scene/delete\",\n    scene_id: scene_id,\n  });\n\nexport const sceneDataSchema: HaFormSchema[] = [\n  {\n    name: \"data1\",\n    required: true,\n    type: \"integer\",\n  },\n  {\n    name: \"data2\",\n    required: true,\n    type: \"integer\",\n  },\n  {\n    name: \"data3\",\n    required: true,\n    type: \"integer\",\n  },\n];\n","import { mdiPlus, mdiLightbulbGroup, mdiLightbulbGroupOff } from \"@mdi/js\";\nimport type { TemplateResult } from \"lit\";\nimport { html, LitElement } from \"lit\";\nimport { customElement, property } from \"lit/decorators\";\nimport memoizeOne from \"memoize-one\";\nimport type {\n  DataTableColumnContainer,\n  DataTableRowData,\n  RowClickedEvent,\n  SelectionChangedEvent,\n  SortingChangedEvent,\n} from \"@ha/components/data-table/ha-data-table\";\nimport \"@ha/layouts/hass-tabs-subpage-data-table\";\nimport type { HomeAssistant, Route } from \"@ha/types\";\nimport type { Insteon } from \"./data/insteon\";\nimport type { InsteonScene, InsteonScenes } from \"./data/scene\";\nimport { fetchInsteonScenes } from \"./data/scene\";\nimport { navigate } from \"@ha/common/navigate\";\nimport type { HASSDomEvent } from \"@ha/common/dom/fire_event\";\nimport { insteonMainTabs } from \"./insteon-router\";\nimport \"@ha/components/ha-fab\";\n\ndeclare global {\n  // for fire event\n  interface HASSDomEvents {\n    \"selection-changed\": SelectionChangedEvent;\n    \"row-click\": RowClickedEvent;\n    \"sorting-changed\": SortingChangedEvent;\n    \"scene-trigger\": InsteonSceneTriggeredEvent;\n  }\n}\n\ninterface SceneRowData extends InsteonScene {\n  record?: InsteonScene;\n  num_devices?: number;\n  ha_scene?: boolean;\n  ha_script?: boolean;\n  actions?: string;\n}\n\nexport interface InsteonSceneTriggeredEvent {\n  scene: {\n    group: number;\n  };\n}\n\n@customElement(\"insteon-scenes-panel\")\nexport class InsteonScenesPanel extends LitElement {\n  @property({ attribute: false }) public hass!: HomeAssistant;\n\n  @property({ type: Object }) public insteon!: Insteon;\n\n  @property({ type: Object }) public route!: Route;\n\n  @property({ type: Boolean }) public narrow = false;\n\n  @property({ type: Object }) private _scenes: InsteonScenes = {};\n\n  public firstUpdated(changedProperties) {\n    super.firstUpdated(changedProperties);\n\n    if (!this.hass || !this.insteon) {\n      return;\n    }\n    fetchInsteonScenes(this.hass).then((scenes) => {\n      this._scenes = scenes;\n    });\n  }\n\n  private _columns = memoizeOne(\n    (): DataTableColumnContainer => ({\n      group: {\n        title: this.insteon.localize(\"scenes.fields.group\"),\n        sortable: true,\n        filterable: true,\n        direction: \"asc\",\n        showNarrow: true,\n      },\n      name: {\n        title: this.insteon.localize(\"scenes.fields.name\"),\n        sortable: true,\n        filterable: true,\n        direction: \"asc\",\n        showNarrow: true,\n      },\n      num_devices: {\n        title: this.insteon.localize(\"scenes.fields.num_devices\"),\n        sortable: true,\n        filterable: true,\n        direction: \"asc\",\n        showNarrow: true,\n      },\n      actions: {\n        title: this.insteon.localize(\"scenes.fields.actions\"),\n        type: \"flex\",\n        template: (scene) => html`\n          <ha-icon-button\n            .scene=${scene}\n            .hass=${this.hass}\n            .label=${this.insteon.localize(\"scenes.scene.activate\")}\n            .path=${mdiLightbulbGroup}\n            @click=${this._activateScene}\n          ></ha-icon-button>\n          <ha-icon-button\n            .scene=${scene}\n            .hass=${this.hass}\n            .label=${this.insteon.localize(\"scenes.scene.deactivate\")}\n            .path=${mdiLightbulbGroupOff}\n            @click=${this._deactivateScene}\n          ></ha-icon-button>\n        `,\n        showNarrow: true,\n      },\n    }),\n  );\n\n  private async _activateScene(ev): Promise<void> {\n    ev.stopPropagation();\n    const scene = ev.currentTarget.scene as InsteonScene;\n    const hass = ev.currentTarget.hass as HomeAssistant;\n    // eslint-disable-next-line no-console\n    console.info(\"Scene activate clicked received: \" + scene.group);\n    hass.callService(\"insteon\", \"scene_on\", { group: scene.group });\n  }\n\n  private async _deactivateScene(ev): Promise<void> {\n    ev.stopPropagation();\n    const hass = ev.currentTarget.hass as HomeAssistant;\n    const scene = ev.currentTarget.scene as InsteonScene;\n    // eslint-disable-next-line no-console\n    console.info(\"Scene activate clicked received: \" + scene.group);\n    hass.callService(\"insteon\", \"scene_off\", { group: scene.group });\n  }\n\n  private _records = memoizeOne((scenes: InsteonScenes): DataTableRowData[] => {\n    if (Object.keys(scenes).length === 0) {\n      return [];\n    }\n    const outputScenes: SceneRowData[] = [];\n    for (const [_, scene] of Object.entries(scenes)) {\n      const scene_data = {\n        ...scene,\n        num_devices: Object.keys(scene.devices).length,\n        ha_scene: true, // to be replace later\n        ha_script: false, // to be replace later\n        actions: \"\",\n      };\n      outputScenes.push(scene_data);\n    }\n    return outputScenes;\n  });\n\n  protected render(): TemplateResult | void {\n    return html`\n      <hass-tabs-subpage-data-table\n        .hass=${this.hass}\n        .narrow=${this.narrow}\n        .tabs=${insteonMainTabs}\n        .route=${this.route}\n        id=\"group\"\n        .data=${this._records(this._scenes)}\n        .columns=${this._columns()}\n        @row-click=${this._handleRowClicked}\n        clickable\n        .localizeFunc=${this.hass.localize}\n        .mainPage=${true}\n        .hasFab=${true}\n      >\n        <ha-fab\n          slot=\"fab\"\n          .label=${this.insteon.localize(\"scenes.add_scene\")}\n          extended\n          @click=${this._addScene}\n        >\n          <ha-svg-icon slot=\"icon\" .path=${mdiPlus}></ha-svg-icon>\n        </ha-fab>\n      </hass-tabs-subpage-data-table>\n    `;\n  }\n\n  private async _addScene(): Promise<void> {\n    navigate(\"/insteon/scene/\");\n  }\n\n  private async _handleRowClicked(ev: HASSDomEvent<RowClickedEvent>): Promise<void> {\n    const id = ev.detail.id;\n    // eslint-disable-next-line no-console\n    console.info(\"Row clicked received: \" + id);\n    navigate(\"/insteon/scene/\" + id);\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    \"insteon-scenes-panel\": InsteonScenesPanel;\n  }\n}\n"],"names":["fetchInsteonScenes","hass","callWS","type","fetchInsteonScene","id","scene_id","saveInsteonScene","links","scene_name","name","deleteInsteonScene","sceneDataSchema","required","InsteonScenesPanel","LitElement","firstUpdated","changedProperties","super","this","insteon","then","scenes","_scenes","_activateScene","ev","stopPropagation","scene","currentTarget","console","info","group","callService","_deactivateScene","render","html","narrow","insteonMainTabs","route","_records","_columns","_handleRowClicked","localize","_addScene","navigate","detail","args","memoizeOne","title","sortable","filterable","direction","showNarrow","num_devices","actions","template","Object","keys","length","outputScenes","_","entries","scene_data","devices","ha_scene","ha_script","push","attribute","Boolean"],"mappings":"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"}