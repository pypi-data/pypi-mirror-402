{"version":3,"file":"1794.0b4e32bbe1157ef4.js","sources":["webpack://insteon-frontend/./homeassistant-frontend/src/dialogs/config-flow/previews/flow-preview-generic.ts"],"sourcesContent":["import type { HassEntity, UnsubscribeFunc } from \"home-assistant-js-websocket\";\nimport { LitElement, html } from \"lit\";\nimport type { nothing, TemplateResult } from \"lit\";\nimport { customElement, property, state } from \"lit/decorators\";\nimport type { FlowType } from \"../../../data/data_entry_flow\";\nimport type { GenericPreview } from \"../../../data/preview\";\nimport { subscribePreviewGeneric } from \"../../../data/preview\";\nimport type { HomeAssistant } from \"../../../types\";\nimport \"./entity-preview-row\";\nimport { debounce } from \"../../../common/util/debounce\";\nimport { fireEvent } from \"../../../common/dom/fire_event\";\nimport \"../../../components/ha-alert\";\n\n@customElement(\"flow-preview-generic\")\nexport class FlowPreviewGeneric extends LitElement {\n  @property({ attribute: false }) public hass!: HomeAssistant;\n\n  @property({ attribute: false }) public flowType!: FlowType;\n\n  public handler!: string;\n\n  @property() public domain!: string;\n\n  @property({ attribute: false }) public stepId!: string;\n\n  @property({ attribute: false }) public flowId!: string;\n\n  @property({ attribute: false }) public stepData!: Record<string, any>;\n\n  @state() protected _preview?: HassEntity;\n\n  @state() protected _error?: string;\n\n  private _unsub?: Promise<UnsubscribeFunc>;\n\n  disconnectedCallback(): void {\n    super.disconnectedCallback();\n    if (this._unsub) {\n      this._unsub.then((unsub) => unsub());\n      this._unsub = undefined;\n    }\n  }\n\n  willUpdate(changedProps) {\n    if (changedProps.has(\"stepData\")) {\n      this._debouncedSubscribePreview();\n    }\n  }\n\n  protected render(): TemplateResult | typeof nothing {\n    if (this._error) {\n      return html`<ha-alert alert-type=\"error\">${this._error}</ha-alert>`;\n    }\n    return html`<entity-preview-row\n      .hass=${this.hass}\n      .stateObj=${this._preview}\n    ></entity-preview-row>`;\n  }\n\n  private _setPreview = (preview: GenericPreview) => {\n    if (preview.error) {\n      this._error = preview.error;\n      this._preview = undefined;\n      return;\n    }\n    const now = new Date().toISOString();\n    this._preview = {\n      entity_id: `${this.stepId}.___flow_preview___`,\n      last_changed: now,\n      last_updated: now,\n      context: { id: \"\", parent_id: null, user_id: null },\n      ...preview,\n    };\n  };\n\n  private _debouncedSubscribePreview = debounce(() => {\n    this._subscribePreview();\n  }, 250);\n\n  private async _subscribePreview() {\n    if (this._unsub) {\n      (await this._unsub)();\n      this._unsub = undefined;\n    }\n    if (\n      this.flowType !== \"config_flow\" &&\n      this.flowType !== \"options_flow\" &&\n      this.flowType !== \"config_subentries_flow\"\n    ) {\n      return;\n    }\n    this._error = undefined;\n    try {\n      this._unsub = subscribePreviewGeneric(\n        this.hass,\n        this.domain,\n        this.flowId,\n        this.flowType,\n        this.stepData,\n        this._setPreview\n      );\n      await this._unsub;\n      fireEvent(this, \"set-flow-errors\", { errors: {} });\n    } catch (err: any) {\n      if (typeof err.message === \"string\") {\n        this._error = err.message;\n      } else {\n        this._error = undefined;\n        fireEvent(this, \"set-flow-errors\", err.message);\n      }\n      this._unsub = undefined;\n      this._preview = undefined;\n    }\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    \"flow-preview-generic\": FlowPreviewGeneric;\n  }\n}\n"],"names":["FlowPreviewGeneric","_LitElement","_this","_callSuper","concat","args","_setPreview","preview","error","_error","_preview","undefined","now","Date","toISOString","Object","assign","entity_id","stepId","last_changed","last_updated","context","id","parent_id","user_id","_debouncedSubscribePreview","debounce","_subscribePreview","_superPropGet","this","_unsub","then","unsub","key","value","changedProps","has","html","_templateObject","_taggedTemplateLiteral","_templateObject2","hass","_subscribePreview2","_asyncToGenerator","_regenerator","m","_callee","_t2","w","_context","p","n","_t","v","flowType","a","subscribePreviewGeneric","domain","flowId","stepData","fireEvent","errors","message","apply","arguments","LitElement","attribute"],"mappings":"kcAcO,IAAPA,EAAA,SAAAC,G,2GA+DE,OA/DKC,GAAAC,EAAAA,EAAAA,GAAA,KAAAH,EAAA,GAAAI,OAAAC,KAAAC,YAAA,SAAAC,GA8CH,GAAAA,EAAAC,MAGE,OAFAN,EAAAO,OAAAF,EAAAC,WACAN,EAAAQ,cAAAC,GAGF,IAAAC,GAAA,IAAAC,MAAAC,cACAZ,EAAAQ,SAAAK,OAAAC,OAAA,CACEC,UAAA,GAAAb,OAAAF,EAAAgB,OAAA,uBACAC,aAAAP,EACAQ,aAAAR,EACAS,QAAA,CAAWC,GAAA,GAAQC,UAAA,KAAiBC,QAAA,OACpCjB,EAEJ,EAAAL,EAAAuB,4BAAAC,EAAAA,EAAAA,GAAA,WAGExB,EAAAyB,mBACF,EAAG,KAAHzB,C,iEA1CA,YACE0B,EAAAA,EAAAA,GAAA5B,EAAA,8BAAA4B,CAAA,IACIC,KAAJC,SACED,KAAAC,OAAAC,KAAA,SAAAC,GAAA,OAAAA,GAAA,GACAH,KAAAC,YAAAnB,EAEJ,IAAAsB,IAAA,aAAAC,MAEA,SAAAC,GACEA,EAAAC,IAAA,aACEP,KAAAJ,4BAEJ,IAAAQ,IAAA,SAAAC,MAEU,WACR,OAAIL,KAAJpB,QACE4B,EAAAA,EAAAA,IAAAC,IAAAA,GAAAC,EAAAA,EAAAA,GAAA,uDAAA9B,SAEF4B,EAAAA,EAAAA,IAAAG,IAAAA,GAAAD,EAAAA,EAAAA,GAAA,4FACQ,KAAAE,KACI,KAAA/B,SAEd,IAAAuB,IAAA,oBAAAC,OAAAQ,GAAAC,EAAAA,EAAAA,IAAAC,EAAAA,EAAAA,KAAAC,EAsBA,SAAAC,IAAA,IAAAC,EAAA,OAAAH,EAAAA,EAAAA,KAAAI,EAAA,SAAAC,GAAA,cAAAA,EAAAC,EAAAD,EAAAE,GAAA,WACE,KAAArB,OAAA,CAAAmB,EAAAE,EAAA,eAAAF,EAAAE,EAAA,EACG,KAAArB,OAAA,QAAAsB,EAAAH,EAAAI,KACDxB,KAAAC,YAAAnB,EAAA,UAEF,qBAAA2C,UAAA,sBAAAA,UAAA,gCAAAA,SAAA,CAAAL,EAAAE,EAAA,eAAAF,EAAAM,EAAA,UASE,OAFF1B,KAAApB,YAAAE,EAAAsC,EAAAC,EAAA,EAEErB,KAAAC,QAAA0B,EAAAA,EAAAA,GAAA3B,KAAAY,KAAAZ,KAAA4B,OAAA5B,KAAA6B,OAAA7B,KAAAyB,SAAAzB,KAAA8B,SAAA9B,KAAAvB,aAAA2C,EAAAE,EAAA,EAQA,KAAArB,OAAA,QACA8B,EAAAA,EAAAA,GAAA,wBAAqCC,OAAA,KAAWZ,EAAAE,EAAA,eAAAF,EAAAC,EAAA,EAEhD,iBAFgDH,EAAAE,EAAAI,GAEhDS,QACEjC,KAAApB,OAAAsC,EAAAe,SAEAjC,KAAApB,YAAAE,GACAiD,EAAAA,EAAAA,GAAA,uBAAAb,EAAAe,UAEFjC,KAAAC,YAAAnB,EACAkB,KAAAnB,cAAAC,EAAA,cAAAsC,EAAAM,EAAA,KAAAT,EAAAjB,KAAA,YAEJ,WAlCA,OAAAa,EAAAqB,MAAA,KAAAC,UAAA,MAtBA,IAAAtB,CAsBA,CAjEF,CAAAuB,EAAAA,K,2BACcC,WAAA,K,uDAEAA,WAAA,K,sHAMAA,WAAA,K,yDAEAA,WAAA,K,yDAEAA,WAAA,K"}