{"version":3,"file":"1850.d0c82a68aebf51b8.js","sources":["webpack://insteon-frontend/./homeassistant-frontend/src/components/ha-selector/ha-selector-selector.ts"],"sourcesContent":["import type { PropertyValues } from \"lit\";\nimport { css, html, LitElement } from \"lit\";\nimport { customElement, property } from \"lit/decorators\";\nimport memoizeOne from \"memoize-one\";\nimport { fireEvent } from \"../../common/dom/fire_event\";\nimport type {\n  LocalizeFunc,\n  LocalizeKeys,\n} from \"../../common/translations/localize\";\nimport type { HomeAssistant } from \"../../types\";\nimport \"../ha-form/ha-form\";\n\nconst SELECTOR_DEFAULTS = {\n  number: {\n    min: 1,\n    max: 100,\n  },\n};\n\nconst SELECTOR_SCHEMAS = {\n  action: [] as const,\n  area: [\n    {\n      name: \"multiple\",\n      selector: { boolean: {} },\n    },\n  ] as const,\n  attribute: [\n    {\n      name: \"entity_id\",\n      selector: { entity: {} },\n    },\n  ] as const,\n  boolean: [] as const,\n  color_temp: [\n    {\n      name: \"unit\",\n      selector: { select: { options: [\"kelvin\", \"mired\"] } },\n    },\n    {\n      name: \"min\",\n      selector: { number: { mode: \"box\" } },\n    },\n    {\n      name: \"max\",\n      selector: { number: { mode: \"box\" } },\n    },\n  ] as const,\n  condition: [] as const,\n  date: [] as const,\n  datetime: [] as const,\n  device: [\n    {\n      name: \"multiple\",\n      selector: { boolean: {} },\n    },\n  ] as const,\n  duration: [\n    {\n      name: \"enable_day\",\n      selector: { boolean: {} },\n    },\n    {\n      name: \"enable_millisecond\",\n      selector: { boolean: {} },\n    },\n  ] as const,\n  entity: [\n    {\n      name: \"multiple\",\n      selector: { boolean: {} },\n    },\n  ] as const,\n  floor: [\n    {\n      name: \"multiple\",\n      selector: { boolean: {} },\n    },\n  ] as const,\n  icon: [] as const,\n  location: [] as const,\n  media: [\n    {\n      name: \"accept\",\n      selector: {\n        text: {\n          multiple: true,\n        },\n      },\n    },\n  ] as const,\n  number: [\n    {\n      name: \"min\",\n      selector: { number: { mode: \"box\", step: \"any\" } },\n    },\n    {\n      name: \"max\",\n      selector: { number: { mode: \"box\", step: \"any\" } },\n    },\n    {\n      name: \"step\",\n      selector: { number: { mode: \"box\", step: \"any\" } },\n    },\n  ] as const,\n  object: [] as const,\n  color_rgb: [] as const,\n  select: [\n    {\n      name: \"options\",\n      selector: { object: {} },\n    },\n    {\n      name: \"multiple\",\n      selector: { boolean: {} },\n    },\n  ] as const,\n  state: [\n    {\n      name: \"entity_id\",\n      selector: { entity: {} },\n    },\n    {\n      name: \"multiple\",\n      selector: { boolean: {} },\n    },\n  ] as const,\n  target: [] as const,\n  template: [] as const,\n  text: [\n    {\n      name: \"multiple\",\n      selector: { boolean: {} },\n    },\n    {\n      name: \"multiline\",\n      selector: { boolean: {} },\n    },\n    { name: \"prefix\", selector: { text: {} } },\n    { name: \"suffix\", selector: { text: {} } },\n  ] as const,\n  theme: [] as const,\n  time: [] as const,\n};\n\n@customElement(\"ha-selector-selector\")\nexport class HaSelectorSelector extends LitElement {\n  @property({ attribute: false }) public hass!: HomeAssistant;\n\n  @property({ attribute: false }) public value?: any;\n\n  @property() public label?: string;\n\n  @property() public helper?: string;\n\n  @property({ type: Boolean, reflect: true }) public disabled = false;\n\n  @property({ type: Boolean }) public narrow = false;\n\n  @property({ type: Boolean, reflect: true }) public required = true;\n\n  private _yamlMode = false;\n\n  protected shouldUpdate(changedProps: PropertyValues) {\n    if (changedProps.size === 1 && changedProps.has(\"hass\")) {\n      return false;\n    }\n    return true;\n  }\n\n  private _schema = memoizeOne(\n    (choice: string, localize: LocalizeFunc) =>\n      [\n        {\n          name: \"type\",\n          required: true,\n          selector: {\n            select: {\n              mode: \"dropdown\",\n              options: Object.keys(SELECTOR_SCHEMAS)\n                .concat(\"manual\")\n                .map((key) => ({\n                  label:\n                    localize(\n                      `ui.components.selectors.selector.types.${key}` as LocalizeKeys\n                    ) || key,\n                  value: key,\n                })),\n            },\n          },\n        },\n        ...(choice === \"manual\"\n          ? ([\n              {\n                name: \"manual\",\n                selector: { object: {} },\n              },\n            ] as const)\n          : []),\n        ...(SELECTOR_SCHEMAS[choice]\n          ? SELECTOR_SCHEMAS[choice].length > 1\n            ? [\n                {\n                  name: \"\",\n                  type: \"expandable\",\n                  title: localize(\"ui.components.selectors.selector.options\"),\n                  schema: SELECTOR_SCHEMAS[choice],\n                },\n              ]\n            : SELECTOR_SCHEMAS[choice]\n          : []),\n      ] as const\n  );\n\n  protected render() {\n    let data;\n    let type;\n    if (this._yamlMode) {\n      type = \"manual\";\n      data = { type, manual: this.value };\n    } else {\n      type = Object.keys(this.value)[0];\n      const value0 = Object.values(this.value)[0];\n      data = {\n        type,\n        ...(typeof value0 === \"object\" ? value0 : []),\n      };\n    }\n\n    const schema = this._schema(type, this.hass.localize);\n\n    return html`<div>\n      <p>${this.label ? this.label : \"\"}</p>\n      <ha-form\n        .hass=${this.hass}\n        .data=${data}\n        .schema=${schema}\n        .computeLabel=${this._computeLabelCallback}\n        @value-changed=${this._valueChanged}\n        .narrow=${this.narrow}\n      ></ha-form>\n    </div>`;\n  }\n\n  private _valueChanged(ev: CustomEvent) {\n    ev.stopPropagation();\n    const value = ev.detail.value;\n\n    const type = value.type;\n    if (!type || typeof value !== \"object\" || Object.keys(value).length === 0) {\n      // not sure how this happens, but reject it\n      return;\n    }\n\n    const oldType = Object.keys(this.value)[0];\n    if (type === \"manual\" && !this._yamlMode) {\n      this._yamlMode = true;\n      this.requestUpdate();\n      return;\n    }\n    if (type === \"manual\" && value.manual === undefined) {\n      return;\n    }\n    if (type !== \"manual\") {\n      this._yamlMode = false;\n    }\n    delete value.type;\n\n    let newValue;\n    if (type === \"manual\") {\n      newValue = value.manual;\n    } else if (type === oldType) {\n      newValue = {\n        [type]: { ...(value.manual ? value.manual[oldType] : value) },\n      };\n    } else {\n      newValue = { [type]: { ...SELECTOR_DEFAULTS[type] } };\n    }\n\n    fireEvent(this, \"value-changed\", { value: newValue });\n  }\n\n  private _computeLabelCallback = (schema: any): string =>\n    this.hass.localize(\n      `ui.components.selectors.selector.${schema.name}` as LocalizeKeys\n    ) || schema.name;\n\n  static styles = css`\n    .title {\n      font-size: var(--ha-font-size-l);\n      padding-top: 16px;\n      overflow: hidden;\n      text-overflow: ellipsis;\n      margin-bottom: 16px;\n      padding-left: 16px;\n      padding-right: 4px;\n      padding-inline-start: 16px;\n      padding-inline-end: 4px;\n      white-space: nowrap;\n    }\n  `;\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    \"ha-selector-selector\": HaSelectorSelector;\n  }\n}\n"],"names":["SELECTOR_DEFAULTS","number","min","max","SELECTOR_SCHEMAS","action","area","name","selector","boolean","attribute","entity","color_temp","select","options","mode","condition","date","datetime","device","duration","floor","icon","location","media","text","multiple","step","object","color_rgb","state","target","template","theme","time","HaSelectorSelector","_LitElement","_this","_callSuper","concat","args","disabled","narrow","required","_yamlMode","_schema","memoizeOne","choice","localize","Object","keys","map","key","label","value","_toConsumableArray","length","type","title","schema","_computeLabelCallback","hass","changedProps","size","has","data","this","manual","value0","values","assign","_typeof","html","_templateObject","_taggedTemplateLiteral","_valueChanged","ev","stopPropagation","detail","newValue","oldType","requestUpdate","undefined","_defineProperty","fireEvent","LitElement","styles","css","_templateObject2","Boolean","reflect"],"mappings":"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"}