{"version":3,"file":"6709.36020fa0724694f3.js","sources":["webpack://insteon-frontend/./src/data/scene.ts","webpack://insteon-frontend/./src/insteon-scenes-panel.ts"],"sourcesContent":["import type { HomeAssistant } from \"@ha/types\";\nimport type { HaFormSchema } from \"@ha/components/ha-form/types\";\n\nexport interface InsteonScene {\n  name: string;\n  group: number;\n  devices: { [address: string]: InsteonSceneDeviceData[] };\n}\n\nexport interface InsteonScenes {\n  [scene: number]: InsteonScene;\n}\n\nexport interface SceneSaveResult {\n  scene_id: number;\n  result: boolean;\n}\n\nexport interface InsteonSceneDeviceData {\n  data1: number;\n  data2: number;\n  data3: number;\n  has_controller: boolean;\n  has_responder: boolean;\n}\n\nexport interface InsteonSceneLinkData {\n  address: string;\n  data1: number;\n  data2: number;\n  data3: number;\n}\n\nexport const fetchInsteonScenes = (hass: HomeAssistant): Promise<InsteonScenes> =>\n  hass.callWS({\n    type: \"insteon/scenes/get\",\n  });\n\nexport const fetchInsteonScene = (hass: HomeAssistant, id: number): Promise<InsteonScene> =>\n  hass.callWS({\n    type: \"insteon/scene/get\",\n    scene_id: id,\n  });\n\nexport const saveInsteonScene = (\n  hass: HomeAssistant,\n  scene_id: number,\n  links: InsteonSceneLinkData[],\n  scene_name: string,\n): Promise<SceneSaveResult> =>\n  hass.callWS({\n    type: \"insteon/scene/save\",\n    name: scene_name,\n    scene_id: scene_id,\n    links: links,\n  });\n\nexport const deleteInsteonScene = (\n  hass: HomeAssistant,\n  scene_id: number,\n): Promise<SceneSaveResult> =>\n  hass.callWS({\n    type: \"insteon/scene/delete\",\n    scene_id: scene_id,\n  });\n\nexport const sceneDataSchema: HaFormSchema[] = [\n  {\n    name: \"data1\",\n    required: true,\n    type: \"integer\",\n  },\n  {\n    name: \"data2\",\n    required: true,\n    type: \"integer\",\n  },\n  {\n    name: \"data3\",\n    required: true,\n    type: \"integer\",\n  },\n];\n","import { mdiPlus, mdiLightbulbGroup, mdiLightbulbGroupOff } from \"@mdi/js\";\nimport type { TemplateResult } from \"lit\";\nimport { html, LitElement } from \"lit\";\nimport { customElement, property } from \"lit/decorators\";\nimport memoizeOne from \"memoize-one\";\nimport type {\n  DataTableColumnContainer,\n  DataTableRowData,\n  RowClickedEvent,\n  SelectionChangedEvent,\n  SortingChangedEvent,\n} from \"@ha/components/data-table/ha-data-table\";\nimport \"@ha/layouts/hass-tabs-subpage-data-table\";\nimport type { HomeAssistant, Route } from \"@ha/types\";\nimport type { Insteon } from \"./data/insteon\";\nimport type { InsteonScene, InsteonScenes } from \"./data/scene\";\nimport { fetchInsteonScenes } from \"./data/scene\";\nimport { navigate } from \"@ha/common/navigate\";\nimport type { HASSDomEvent } from \"@ha/common/dom/fire_event\";\nimport { insteonMainTabs } from \"./insteon-router\";\nimport \"@ha/components/ha-fab\";\n\ndeclare global {\n  // for fire event\n  interface HASSDomEvents {\n    \"selection-changed\": SelectionChangedEvent;\n    \"row-click\": RowClickedEvent;\n    \"sorting-changed\": SortingChangedEvent;\n    \"scene-trigger\": InsteonSceneTriggeredEvent;\n  }\n}\n\ninterface SceneRowData extends InsteonScene {\n  record?: InsteonScene;\n  num_devices?: number;\n  ha_scene?: boolean;\n  ha_script?: boolean;\n  actions?: string;\n}\n\nexport interface InsteonSceneTriggeredEvent {\n  scene: {\n    group: number;\n  };\n}\n\n@customElement(\"insteon-scenes-panel\")\nexport class InsteonScenesPanel extends LitElement {\n  @property({ attribute: false }) public hass!: HomeAssistant;\n\n  @property({ type: Object }) public insteon!: Insteon;\n\n  @property({ type: Object }) public route!: Route;\n\n  @property({ type: Boolean }) public narrow = false;\n\n  @property({ type: Object }) private _scenes: InsteonScenes = {};\n\n  public firstUpdated(changedProperties) {\n    super.firstUpdated(changedProperties);\n\n    if (!this.hass || !this.insteon) {\n      return;\n    }\n    fetchInsteonScenes(this.hass).then((scenes) => {\n      this._scenes = scenes;\n    });\n  }\n\n  private _columns = memoizeOne(\n    (): DataTableColumnContainer => ({\n      group: {\n        title: this.insteon.localize(\"scenes.fields.group\"),\n        sortable: true,\n        filterable: true,\n        direction: \"asc\",\n        showNarrow: true,\n      },\n      name: {\n        title: this.insteon.localize(\"scenes.fields.name\"),\n        sortable: true,\n        filterable: true,\n        direction: \"asc\",\n        showNarrow: true,\n      },\n      num_devices: {\n        title: this.insteon.localize(\"scenes.fields.num_devices\"),\n        sortable: true,\n        filterable: true,\n        direction: \"asc\",\n        showNarrow: true,\n      },\n      actions: {\n        title: this.insteon.localize(\"scenes.fields.actions\"),\n        type: \"flex\",\n        template: (scene) => html`\n          <ha-icon-button\n            .scene=${scene}\n            .hass=${this.hass}\n            .label=${this.insteon.localize(\"scenes.scene.activate\")}\n            .path=${mdiLightbulbGroup}\n            @click=${this._activateScene}\n          ></ha-icon-button>\n          <ha-icon-button\n            .scene=${scene}\n            .hass=${this.hass}\n            .label=${this.insteon.localize(\"scenes.scene.deactivate\")}\n            .path=${mdiLightbulbGroupOff}\n            @click=${this._deactivateScene}\n          ></ha-icon-button>\n        `,\n        showNarrow: true,\n      },\n    }),\n  );\n\n  private async _activateScene(ev): Promise<void> {\n    ev.stopPropagation();\n    const scene = ev.currentTarget.scene as InsteonScene;\n    const hass = ev.currentTarget.hass as HomeAssistant;\n    // eslint-disable-next-line no-console\n    console.info(\"Scene activate clicked received: \" + scene.group);\n    hass.callService(\"insteon\", \"scene_on\", { group: scene.group });\n  }\n\n  private async _deactivateScene(ev): Promise<void> {\n    ev.stopPropagation();\n    const hass = ev.currentTarget.hass as HomeAssistant;\n    const scene = ev.currentTarget.scene as InsteonScene;\n    // eslint-disable-next-line no-console\n    console.info(\"Scene activate clicked received: \" + scene.group);\n    hass.callService(\"insteon\", \"scene_off\", { group: scene.group });\n  }\n\n  private _records = memoizeOne((scenes: InsteonScenes): DataTableRowData[] => {\n    if (Object.keys(scenes).length === 0) {\n      return [];\n    }\n    const outputScenes: SceneRowData[] = [];\n    for (const [_, scene] of Object.entries(scenes)) {\n      const scene_data = {\n        ...scene,\n        num_devices: Object.keys(scene.devices).length,\n        ha_scene: true, // to be replace later\n        ha_script: false, // to be replace later\n        actions: \"\",\n      };\n      outputScenes.push(scene_data);\n    }\n    return outputScenes;\n  });\n\n  protected render(): TemplateResult | void {\n    return html`\n      <hass-tabs-subpage-data-table\n        .hass=${this.hass}\n        .narrow=${this.narrow}\n        .tabs=${insteonMainTabs}\n        .route=${this.route}\n        id=\"group\"\n        .data=${this._records(this._scenes)}\n        .columns=${this._columns()}\n        @row-click=${this._handleRowClicked}\n        clickable\n        .localizeFunc=${this.hass.localize}\n        .mainPage=${true}\n        .hasFab=${true}\n      >\n        <ha-fab\n          slot=\"fab\"\n          .label=${this.insteon.localize(\"scenes.add_scene\")}\n          extended\n          @click=${this._addScene}\n        >\n          <ha-svg-icon slot=\"icon\" .path=${mdiPlus}></ha-svg-icon>\n        </ha-fab>\n      </hass-tabs-subpage-data-table>\n    `;\n  }\n\n  private async _addScene(): Promise<void> {\n    navigate(\"/insteon/scene/\");\n  }\n\n  private async _handleRowClicked(ev: HASSDomEvent<RowClickedEvent>): Promise<void> {\n    const id = ev.detail.id;\n    // eslint-disable-next-line no-console\n    console.info(\"Row clicked received: \" + id);\n    navigate(\"/insteon/scene/\" + id);\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    \"insteon-scenes-panel\": InsteonScenesPanel;\n  }\n}\n"],"names":["fetchInsteonScenes","hass","callWS","type","fetchInsteonScene","id","scene_id","saveInsteonScene","links","scene_name","name","deleteInsteonScene","sceneDataSchema","required","InsteonScenesPanel","_LitElement","_this","_callSuper","concat","args","narrow","_scenes","_columns","memoizeOne","group","title","insteon","localize","sortable","filterable","direction","showNarrow","num_devices","actions","template","scene","html","_templateObject","_taggedTemplateLiteral","_activateScene","_deactivateScene","_records","scenes","Object","keys","length","outputScenes","_i","_Object$entries","entries","_Object$entries$_i","_slicedToArray","scene_data","assign","devices","ha_scene","ha_script","push","changedProperties","_this2","_superPropGet","this","then","key","value","_activateScene2","_asyncToGenerator","_regenerator","m","_callee","ev","w","_context","n","stopPropagation","currentTarget","console","info","callService","a","_x","apply","arguments","_deactivateScene2","_callee2","_context2","_x2","_templateObject2","insteonMainTabs","route","_handleRowClicked","_addScene","_addScene2","_callee3","_context3","navigate","_handleRowClicked2","_callee4","_context4","detail","_x3","LitElement","attribute","Boolean"],"mappings":"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"}