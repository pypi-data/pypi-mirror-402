[project]
name = "caf"
version = "0.2.0"
description = "Create content addressable files"
readme = "README.md"
authors = [
    {name = "James Saryerwinnie", email = "js@jamesls.com"}
]
license = {text = "BSD"}
keywords = ["caf"]
classifiers = [
    "Development Status :: 2 - Pre-Alpha",
    "Intended Audience :: Developers",
    "License :: OSI Approved :: Apache Software License",
    "Natural Language :: English",
    "Programming Language :: Python :: 3",
    "Programming Language :: Python :: 3.12",
    "Programming Language :: Python :: Implementation :: CPython",
]
dependencies = [
    "click",
    "rich>=14.1.0",
]
requires-python = ">=3.12"

[build-system]
requires = ["hatchling"]
build-backend = "hatchling.build"

[dependency-groups]
dev = [
    "pyinstrument",
    "ast-grep-cli",
    "pytest",
    "pytest-cov",
    "ruff>=0.6.0",
    "pyright[nodejs]",
    "poethepoet>=0.28.0",
]

[project.urls]
Homepage = "https://github.com/jamesls/caf"

[project.scripts]
caf = "caf.cli:main"

[tool.hatch.build.targets.wheel]
packages = ["caf"]

[tool.hatch.version]
path = "caf/__init__.py"

[tool.ruff]
line-length = 79

[tool.ruff.lint]
extend-select = [
  "C901",
  "PLR0915",
  "E501",
  "UP006",
  "UP008",
  "SLF001",
]

[tool.ruff.format]
quote-style = "preserve"
preview = true

[tool.pytest.ini_options]
addopts = """\
    --cov caf \
    --cov-report term-missing \
    --no-cov-on-fail \
"""
testpaths = ["tests"]
filterwarnings = [
    "ignore::DeprecationWarning",
]

[tool.coverage.run]
branch = true

[tool.coverage.report]
exclude_lines = [
    'if TYPE_CHECKING:',
    'pragma: no cover',
    'raise NotImplementedError',
]

[tool.pyright]
include = ["caf"]
exclude = ["**/__pycache__"]

reportMissingImports = true
reportMissingTypeStubs = false

pythonVersion = "3.12"
pythonPlatform = "All"

[tool.poe.tasks]
check = [
  { cmd = "uv run ruff check ." },
  { cmd = "uv run ruff format --diff ." },
  { cmd = "uv run pyright" },
  { cmd = "uv run ast-grep scan ." },
]
test = "uv run pytest tests/"
format-code = [
  { cmd = "uv run ruff format ." },
]
# Similar to check, but also auto fixes issues.
auto-check = [
  { cmd = "uv run ruff check --fix ." },
  { cmd = "uv run ruff format ." },
  { cmd = "uv run pyright" },
  { cmd = "uv run ast-grep scan ." },
]
prcheck = ["check", "test"]
