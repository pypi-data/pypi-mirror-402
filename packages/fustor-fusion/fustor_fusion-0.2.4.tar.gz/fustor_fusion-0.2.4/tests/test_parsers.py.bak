"""
Simple test for the parsers module
"""
import asyncio
from datetime import datetime
from fustor_fusion.parsers.manager import process_event, get_directory_tree, get_file_info, search_files, get_all_files, get_directory_stats


async def test_parsers():
    print("Testing parsers module...")
    
    # Test 1: Process a file creation event
    print("\n1. Testing file creation event...")
    create_event = {
        "event_type": "create",
        "payload": {
            "path": "/home/user/documents/report.txt",
            "name": "report.txt",
            "size": 1024,
            "modified_time": datetime.now().isoformat(),
            "created_time": datetime.now().isoformat(),
            "content_type": "file",
            "metadata": {"owner": "user", "permissions": "rw-r--r--"}
        }
    }
    
    result = await process_event(create_event)
    print(f"Event processing result: {result}")
    
    # Test 2: Process a directory creation event
    print("\n2. Testing directory creation event...")
    dir_event = {
        "event_type": "create",
        "payload": {
            "path": "/home/user/pictures",
            "name": "pictures",
            "modified_time": datetime.now().isoformat(),
            "created_time": datetime.now().isoformat(),
            "content_type": "directory",
            "metadata": {"owner": "user"}
        }
    }
    
    result = await process_event(dir_event)
    print(f"Event processing result: {result}")
    
    # Test 3: Get the directory tree
    print("\n3. Getting directory tree...")
    tree = await get_directory_tree("/")
    print(f"Directory tree: {tree}")
    
    # Test 4: Get file info
    print("\n4. Getting file info...")
    file_info = await get_file_info("/home/user/documents/report.txt")
    print(f"File info: {file_info}")
    
    # Test 5: Search for files
    print("\n5. Searching for files with 'report' pattern...")
    search_results = await search_files("report")
    print(f"Search results: {search_results}")
    
    # Test 6: Get all files
    print("\n6. Getting all files...")
    all_files = await get_all_files()
    print(f"All files: {all_files}")
    
    # Test 7: Get directory stats
    print("\n7. Getting directory stats...")
    stats = await get_directory_stats()
    print(f"Stats: {stats}")
    
    # Test 8: Process an update event
    print("\n8. Testing file update event...")
    update_event = {
        "event_type": "update",
        "payload": {
            "path": "/home/user/documents/report.txt",
            "name": "report.txt",
            "size": 2048,  # Updated size
            "modified_time": datetime.now().isoformat(),
            "created_time": datetime.now().isoformat(),
            "content_type": "file",
            "metadata": {"owner": "user", "permissions": "rw-r--r--", "updated": True}
        }
    }
    
    result = await process_event(update_event)
    print(f"Update event processing result: {result}")
    
    # Check updated file info
    updated_file_info = await get_file_info("/home/user/documents/report.txt")
    print(f"Updated file info: {updated_file_info}")
    
    # Test 9: Process a delete event
    print("\n9. Testing file delete event...")
    delete_event = {
        "event_type": "delete",
        "payload": {
            "path": "/home/user/documents/report.txt",
            "name": "report.txt"
        }
    }
    
    result = await process_event(delete_event)
    print(f"Delete event processing result: {result}")
    
    # Check that file is gone
    file_info = await get_file_info("/home/user/documents/report.txt")
    print(f"File info after deletion (should be None): {file_info}")
    
    # Check directory stats after deletion
    stats_after = await get_directory_stats()
    print(f"Stats after deletion: {stats_after}")
    
    print("\nAll tests completed!")


if __name__ == "__main__":
    asyncio.run(test_parsers())