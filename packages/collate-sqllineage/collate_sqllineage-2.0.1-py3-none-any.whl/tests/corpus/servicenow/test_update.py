"""Tests for update."""

from tests.helpers import assert_table_lineage_equal


def test_update_query_q1138():
    """update - Query 1138"""
    sql = """ UPDATE NOC.CONFIG.ETL_RDS_CONFIG_RECON                                     SET ETL_UPDATE_DATE = CURRENT_TIMESTAMP, LAST_RDS_JOB_RUN_ID = '2025-01-01 00:00:00',                                     TOTAL_TARGET_COUNT = 2 WHERE TARGET_SCHEMA = 'placeholder_3' AND                                     TARGET_TABLE_NAME = 'placeholder_4'"""
    # SqlParse: Cannot extract source tables from subqueries/complex queries
    assert_table_lineage_equal(
        sql,
        set(),  # source_tables
        {"noc.config.etl_rds_config_recon"},  # target_tables
        dialect="snowflake",
        test_sqlparse=False,
    )


def test_update_rds__q1343():
    """update - Query 1343"""
    sql = """ insert into RDS."STAGING"."INSTANCE_TABLES_DELETED_SYS_ID" ("SCHEMA" ,  "STORED_PROCEDURE" ,  "SOURCE_TABLE_NAME" ,  "SYS_ID" ,  "TIME_STAMP")
    SELECT 'placeholder_1', 'placeholder_2', 'placeholder_3', SYS_ID,  CURRENT_TIMESTAMP
    FROM RDS."LXP"."SN_LXP_M2M_CATALOG_SKILL" where sys_id IN (SELECT DISTINCT D.DOCUMENTKEY
    FROM "RDS"."LXP"."SYS_AUDIT_DELETE" D
    WHERE D.TABLENAME LIKE LOWER('placeholder_4')  AND CAST( D.SYS_UPDATED_ON AS DATE )  >= DATEADD(DAY, 'placeholder_5', CURRENT_DATE ))"""
    # SqlParse: Includes target table as source in INSERT INTO...SELECT
    # Graph: Parsers create different graph structures (table lineage is correct)
    assert_table_lineage_equal(
        sql,
        {
            "rds.lxp.sn_lxp_m2m_catalog_skill",
            "rds.lxp.sys_audit_delete",
        },  # source_tables
        {"rds.staging.instance_tables_deleted_sys_id"},  # target_tables
        dialect="snowflake",
        test_sqlparse=False,
        skip_graph_check=True,
    )


def test_update_query_q1669():
    """update - Query 1669"""
    sql = """ update "NOC"."LOGGING"."ETL_RDS_JOB_RUN_AUDIT"
set
job_status='2025-01-01 00:00:00',
JOB_END_TS=current_timestamp(),
-- job_run_duration='8404',
SOURCE_RECORD_COUNT=2,
PROCESSED_RECORD_COUNT=3,
ERROR_RECORD_COUNT = 4-'placeholder_5',
ETL_UPDATE_DATE= current_timestamp()
-- LAST_RUN_TIMESTAMP= current_timestamp()
where RDS_CONFIG_ID='2025-01-01 00:00:00'
and INTEG_JOB_ID = 7
and INTEG_TOOL_JOB_RUN_ID = 8 ;"""
    # SqlParse: Cannot extract source tables from subqueries/complex queries
    assert_table_lineage_equal(
        sql,
        set(),  # source_tables
        {"noc.logging.etl_rds_job_run_audit"},  # target_tables
        dialect="snowflake",
        test_sqlparse=False,
    )


def test_update_rds_dynamics365_contacts_q1920():
    """update - Query 1920"""
    sql = """ insert into RDS.DYNAMICS365.TABLES_DELETED_RECORDS_ID ( SCHEMA ,  STORED_PROCEDURE ,  SOURCE_TABLE_NAME ,  OBJECT_ID ,  TIME_STAMP )
    select 'placeholder_1' , 'placeholder_2' , 'placeholder_3' , "CONTACTID" ,  CURRENT_TIMESTAMP
    FROM RDS.DYNAMICS365.CONTACTS
    where "CONTACTID" IN (select distinct OBJECTID FROM "RDS"."DYNAMICS365"."AUDITS" WHERE "ACTION"='placeholder_4' and "OPERATION" = 'placeholder_5' AND LOWER( "OBJECTTYPECODE" ) = 'placeholder_6' AND CAST( "CREATEDON" AS DATE ) >=DATEADD(DAY, 'placeholder_7', CURRENT_DATE ))"""
    # SqlParse: Includes target table as source in INSERT INTO...SELECT
    # Graph: Parsers create different graph structures (table lineage is correct)
    assert_table_lineage_equal(
        sql,
        {"rds.dynamics365.audits", "rds.dynamics365.contacts"},  # source_tables
        {"rds.dynamics365.tables_deleted_records_id"},  # target_tables
        dialect="snowflake",
        test_sqlparse=False,
        skip_graph_check=True,
    )


def test_update_rds_dynamics365_sn_proposalrequests_q3851():
    """update - Query 3851"""
    sql = """ insert into RDS.DYNAMICS365.TABLES_DELETED_RECORDS_ID ( SCHEMA ,  STORED_PROCEDURE ,  SOURCE_TABLE_NAME ,  OBJECT_ID ,  TIME_STAMP )
    select 'placeholder_1' , 'placeholder_2' , 'placeholder_3' , "SN_PROPOSALREQUESTID" ,  CURRENT_TIMESTAMP
    FROM RDS.DYNAMICS365.SN_PROPOSALREQUESTS
    where "SN_PROPOSALREQUESTID" IN (select distinct OBJECTID FROM "RDS"."DYNAMICS365"."AUDITS" WHERE "ACTION"='placeholder_4' and "OPERATION" = 'placeholder_5' AND LOWER( "OBJECTTYPECODE" ) = 'placeholder_6' AND CAST( "CREATEDON" AS DATE ) >=DATEADD(DAY, 'placeholder_7', CURRENT_DATE ))"""
    # SqlParse: Includes target table as source in INSERT INTO...SELECT
    # Graph: Parsers create different graph structures (table lineage is correct)
    assert_table_lineage_equal(
        sql,
        {
            "rds.dynamics365.audits",
            "rds.dynamics365.sn_proposalrequests",
        },  # source_tables
        {"rds.dynamics365.tables_deleted_records_id"},  # target_tables
        dialect="snowflake",
        test_sqlparse=False,
        skip_graph_check=True,
    )


def test_update_rule_engine_table_q4609():
    """update - Query 4609"""
    sql = """ MERGE  INTO RULE_ENGINE_TABLE USING ( SELECT "OpportunityParentNumber" AS "r_ec5m_OpportunityParentNumber", "LineItemNumber_CRM" AS "r_ec5m_LineItemNumber_CRM", "ALLOCATION_SEQ_NUM" AS "r_ec5m_ALLOCATION_SEQ_NUM", "CONCAT_RESULT" AS "CONCAT_RESULT" FROM (SELECT RULE_ENGINE_TABLE."OpportunityParentNumber", RULE_ENGINE_TABLE."LineItemNumber_CRM", RULE_ENGINE_TABLE."ALLOCATION_SEQ_NUM", CONCAT(RULE_ENGINE_TABLE."PARENT_OPTY_ALLOCATION_TYPE", RULE_ENGINE_TABLE."LINE_ALLOCATION_TYPE") AS CONCAT_RESULT FROM RULE_ENGINE_TABLE WHERE  "LINE_ALLOCATION_TYPE" NOT IN ('placeholder_1'))) ON ((("OpportunityParentNumber" = "r_ec5m_OpportunityParentNumber") AND ("LineItemNumber_CRM" = "r_ec5m_LineItemNumber_CRM")) AND ("ALLOCATION_SEQ_NUM" = "r_ec5m_ALLOCATION_SEQ_NUM")) WHEN  MATCHED  THEN  UPDATE  SET "PARENT_OPTY_ALLOCATION_TYPE" = "CONCAT_RESULT" """
    # SqlParse: Cannot extract source tables from subqueries/complex queries
    # Graph: Parsers create different graph structures (table lineage is correct)
    assert_table_lineage_equal(
        sql,
        {"<default>.rule_engine_table"},  # source_tables
        {"<default>.rule_engine_table"},  # target_tables
        dialect="snowflake",
        test_sqlparse=False,
        skip_graph_check=True,
    )


def test_update_sales_opportunity_item_q4900():
    """update - Query 4900"""
    sql = """ Merge into sales_opportunity_item using sales_opportunity_item_6956895 on sales_opportunity_item."SYS_ID" = sales_opportunity_item_6956895."SYS_ID"  when matched then update set  sales_opportunity_item."BASE_PRICE" =  sales_opportunity_item_6956895."BASE_PRICE", sales_opportunity_item."DV_U_REV_REC_TYPE" =  sales_opportunity_item_6956895."DV_U_REV_REC_TYPE", sales_opportunity_item."U_ANNUAL_CONTRACT_VALUE_STRING" =  sales_opportunity_item_6956895."U_ANNUAL_CONTRACT_VALUE_STRING", sales_opportunity_item."U_ALLOWED_DISCOUNT" =  sales_opportunity_item_6956895."U_ALLOWED_DISCOUNT", sales_opportunity_item."U_PRODUCT_PRICE" =  sales_opportunity_item_6956895."U_PRODUCT_PRICE", sales_opportunity_item."U_HAS_PRICES" =  sales_opportunity_item_6956895."U_HAS_PRICES", sales_opportunity_item."U_PRODUCT_UNIT" =  sales_opportunity_item_6956895."U_PRODUCT_UNIT", sales_opportunity_item."DV_U_PRICE_BAND" =  sales_opportunity_item_6956895."DV_U_PRICE_BAND", sales_opportunity_item."U_SALES_AMOUNT_USD" =  sales_opportunity_item_6956895."U_SALES_AMOUNT_USD", sales_opportunity_item."QUANTITY" =  sales_opportunity_item_6956895."QUANTITY", sales_opportunity_item."DV_U_SOW_REQUEST" =  sales_opportunity_item_6956895."DV_U_SOW_REQUEST", sales_opportunity_item."U_TERM_MONTHS_AND_DAYS" =  sales_opportunity_item_6956895."U_TERM_MONTHS_AND_DAYS", sales_opportunity_item."U_TERM" =  sales_opportunity_item_6956895."U_TERM", sales_opportunity_item."U_NET_NEW_ACV_AMOUNT_USD" =  sales_opportunity_item_6956895."U_NET_NEW_ACV_AMOUNT_USD", sales_opportunity_item."U_BASE_AMOUNT_USD" =  sales_opportunity_item_6956895."U_BASE_AMOUNT_USD", sales_opportunity_item."LINE_ORIGIN" =  sales_opportunity_item_6956895."LINE_ORIGIN", sales_opportunity_item."CONTRACT_LINE_QUANTITY" =  sales_opportunity_item_6956895."CONTRACT_LINE_QUANTITY", sales_opportunity_item."U_UNADJUSTED_PRICE_USD_STRING" =  sales_opportunity_item_6956895."U_UNADJUSTED_PRICE_USD_STRING", sales_opportunity_item."DV_U_PARENT_REPLACEMENT_LINE" =  sales_opportunity_item_6956895."DV_U_PARENT_REPLACEMENT_LINE", sales_opportunity_item."U_UNADJUSTED_PRICE_STRING" =  sales_opportunity_item_6956895."U_UNADJUSTED_PRICE_STRING", sales_opportunity_item."U_ANNUAL_LIST_PRICE_STRING" =  sales_opportunity_item_6956895."U_ANNUAL_LIST_PRICE_STRING", sales_opportunity_item."NUMBER" =  sales_opportunity_item_6956895."NUMBER", sales_opportunity_item."U_TOTAL_VALUE_AMOUNT_USD" =  sales_opportunity_item_6956895."U_TOTAL_VALUE_AMOUNT_USD", sales_opportunity_item."TOTAL_PRICE" =  sales_opportunity_item_6956895."TOTAL_PRICE", sales_opportunity_item."DISCOUNT_PERCENT" =  sales_opportunity_item_6956895."DISCOUNT_PERCENT", sales_opportunity_item."U_CURRENCY_CODE" =  sales_opportunity_item_6956895."U_CURRENCY_CODE", sales_opportunity_item."U_AUDITING_NOTES" =  sales_opportunity_item_6956895."U_AUDITING_NOTES", sales_opportunity_item."U_NET_NEW_QUANTITY" =  sales_opportunity_item_6956895."U_NET_NEW_QUANTITY", sales_opportunity_item."U_APPSTORE_SN_MONTHLY_TAX" =  sales_opportunity_item_6956895."U_APPSTORE_SN_MONTHLY_TAX", sales_opportunity_item."U_PRODUCT_ATTRIBUTE_1" =  sales_opportunity_item_6956895."U_PRODUCT_ATTRIBUTE_1", sales_opportunity_item."U_UNADJUSTED_AMOUNT" =  sales_opportunity_item_6956895."U_UNADJUSTED_AMOUNT", sales_opportunity_item."DV_U_PRICE_BOOK" =  sales_opportunity_item_6956895."DV_U_PRICE_BOOK", sales_opportunity_item."U_SOW_REQUEST" =  sales_opportunity_item_6956895."U_SOW_REQUEST", sales_opportunity_item."U_NOTES" =  sales_opportunity_item_6956895."U_NOTES", sales_opportunity_item."ESTIMATED_TAX" =  sales_opportunity_item_6956895."ESTIMATED_TAX", sales_opportunity_item."U_ADJUSTMENT_S" =  sales_opportunity_item_6956895."U_ADJUSTMENT_S", sales_opportunity_item."CONTRACT_LINE_ACV" =  sales_opportunity_item_6956895."CONTRACT_LINE_ACV", sales_opportunity_item."DV_CONTRACT_LINE_REF" =  sales_opportunity_item_6956895."DV_CONTRACT_LINE_REF", sales_opportunity_item."U_CREDIT_CARD_FEES_YEARLY" =  sales_opportunity_item_6956895."U_CREDIT_CARD_FEES_YEARLY", sales_opportunity_item."U_ANNUAL_CONTRACT_VALUE_AMOUNT" =  sales_opportunity_item_6956895."U_ANNUAL_CONTRACT_VALUE_AMOUNT", sales_opportunity_item."FLAGS" =  sales_opportunity_item_6956895."FLAGS", sales_opportunity_item."U_APPSTORE_APP_MONTHLY_PRICE" =  sales_opportunity_item_6956895."U_APPSTORE_APP_MONTHLY_PRICE", sales_opportunity_item."U_ADJUSTMENT_A" =  sales_opportunity_item_6956895."U_ADJUSTMENT_A", sales_opportunity_item."U_TOGGLE_PRODUCT_PRICE" =  sales_opportunity_item_6956895."U_TOGGLE_PRODUCT_PRICE", sales_opportunity_item."SYS_ID" =  sales_opportunity_item_6956895."SYS_ID", sales_opportunity_item."U_DELETED_REASON_CODE" =  sales_opportunity_item_6956895."U_DELETED_REASON_CODE", sales_opportunity_item."U_LIST_PRICE_USD_STRING" =  sales_opportunity_item_6956895."U_LIST_PRICE_USD_STRING", sales_opportunity_item."U_REV_REC_TYPE" =  sales_opportunity_item_6956895."U_REV_REC_TYPE", sales_opportunity_item."CONTRACT_LINE_ACV_USD" =  sales_opportunity_item_6956895."CONTRACT_LINE_ACV_USD", sales_opportunity_item."U_PARTNER_DISCOUNT" =  sales_opportunity_item_6956895."U_PARTNER_DISCOUNT", sales_opportunity_item."DV_U_PRICE_RESET_PRIMARY_LINE" =  sales_opportunity_item_6956895."DV_U_PRICE_RESET_PRIMARY_LINE", sales_opportunity_item."U_ANNUAL_LIST_AMOUNT" =  sales_opportunity_item_6956895."U_ANNUAL_LIST_AMOUNT", sales_opportunity_item."SYS_CREATED_BY" =  sales_opportunity_item_6956895."SYS_CREATED_BY", sales_opportunity_item."PRODUCT" =  sales_opportunity_item_6956895."PRODUCT", sales_opportunity_item."U_NET_NEW_ACV_AMOUNT" =  sales_opportunity_item_6956895."U_NET_NEW_ACV_AMOUNT", sales_opportunity_item."U_ROLE_BASED_RATES" =  sales_opportunity_item_6956895."U_ROLE_BASED_RATES", sales_opportunity_item."U_TOTAL_VALUE_STRING" =  sales_opportunity_item_6956895."U_TOTAL_VALUE_STRING", sales_opportunity_item."SYS_DOMAIN_PATH" =  sales_opportunity_item_6956895."SYS_DOMAIN_PATH", sales_opportunity_item."U_PRICE_RESET_PRIMARY_LINE" =  sales_opportunity_item_6956895."U_PRICE_RESET_PRIMARY_LINE", sales_opportunity_item."U_ANNUAL_LIST_USD_STRING" =  sales_opportunity_item_6956895."U_ANNUAL_LIST_USD_STRING", sales_opportunity_item."U_TOTAL_VALUE_USD_STRING" =  sales_opportunity_item_6956895."U_TOTAL_VALUE_USD_STRING", sales_opportunity_item."U_VENDOR_NET_PRICE_MONTHLY" =  sales_opportunity_item_6956895."U_VENDOR_NET_PRICE_MONTHLY", sales_opportunity_item."U_APPSTORE_APP_TOTAL_PRICE" =  sales_opportunity_item_6956895."U_APPSTORE_APP_TOTAL_PRICE", sales_opportunity_item."DV_U_QUOTE" =  sales_opportunity_item_6956895."DV_U_QUOTE", sales_opportunity_item."U_PARENT_REPLACEMENT_LINE" =  sales_opportunity_item_6956895."U_PARENT_REPLACEMENT_LINE", sales_opportunity_item."U_VARIABLE_PRICE_ACV_CALC" =  sales_opportunity_item_6956895."U_VARIABLE_PRICE_ACV_CALC", sales_opportunity_item."U_FX_RATE_DAILY" =  sales_opportunity_item_6956895."U_FX_RATE_DAILY", sales_opportunity_item."U_USD_VARIABLE_PRICE_ACV_CALC" =  sales_opportunity_item_6956895."U_USD_VARIABLE_PRICE_ACV_CALC", sales_opportunity_item."U_USD_ADJUSTMENT_S" =  sales_opportunity_item_6956895."U_USD_ADJUSTMENT_S", sales_opportunity_item."U_PRODUCT_CATEGORY" =  sales_opportunity_item_6956895."U_PRODUCT_CATEGORY", sales_opportunity_item."U_TERM_END_DATE" =  sales_opportunity_item_6956895."U_TERM_END_DATE", sales_opportunity_item."DESCRIPTION" =  sales_opportunity_item_6956895."DESCRIPTION", sales_opportunity_item."SYS_DOMAIN" =  sales_opportunity_item_6956895."SYS_DOMAIN", sales_opportunity_item."U_PRODUCT_HOURS" =  sales_opportunity_item_6956895."U_PRODUCT_HOURS", sales_opportunity_item."SYS_TAGS" =  sales_opportunity_item_6956895."SYS_TAGS", sales_opportunity_item."U_LIST_PRICE_STRING" =  sales_opportunity_item_6956895."U_LIST_PRICE_STRING", sales_opportunity_item."U_QUOTE" =  sales_opportunity_item_6956895."U_QUOTE", sales_opportunity_item."U_CC_TOKEN__" =  sales_opportunity_item_6956895."U_CC_TOKEN__", sales_opportunity_item."SYS_MOD_COUNT" =  sales_opportunity_item_6956895."SYS_MOD_COUNT", sales_opportunity_item."U_ESTIMATED_TOTAL" =  sales_opportunity_item_6956895."U_ESTIMATED_TOTAL", sales_opportunity_item."U_APPSTORE_APP_TOTAL_TAX" =  sales_opportunity_item_6956895."U_APPSTORE_APP_TOTAL_TAX", sales_opportunity_item."U_PRODUCT_TERM_TYPE" =  sales_opportunity_item_6956895."U_PRODUCT_TERM_TYPE", sales_opportunity_item."U_PRODUCT_PRICE_FULL_NAME" =  sales_opportunity_item_6956895."U_PRODUCT_PRICE_FULL_NAME", sales_opportunity_item."U_NET_NEW_ACV_STRING_USD" =  sales_opportunity_item_6956895."U_NET_NEW_ACV_STRING_USD", sales_opportunity_item."SYS_UPDATED_ON" =  sales_opportunity_item_6956895."SYS_UPDATED_ON", sales_opportunity_item."U_VALIDATIONABORT" =  sales_opportunity_item_6956895."U_VALIDATIONABORT", sales_opportunity_item."DV_U_PRODUCT_PRICE" =  sales_opportunity_item_6956895."DV_U_PRODUCT_PRICE", sales_opportunity_item."U_APPSTORE_APP_MONTHLY_TAX" =  sales_opportunity_item_6956895."U_APPSTORE_APP_MONTHLY_TAX", sales_opportunity_item."U_TERM_START_DATE" =  sales_opportunity_item_6956895."U_TERM_START_DATE", sales_opportunity_item."U_INACTIVE_PRODUCT" =  sales_opportunity_item_6956895."U_INACTIVE_PRODUCT", sales_opportunity_item."U_SALES_PRICE_USD_STRING" =  sales_opportunity_item_6956895."U_SALES_PRICE_USD_STRING", sales_opportunity_item."DV_U_DELETED_REASON_CODE" =  sales_opportunity_item_6956895."DV_U_DELETED_REASON_CODE", sales_opportunity_item."U_SALES_PRICE_STRING" =  sales_opportunity_item_6956895."U_SALES_PRICE_STRING", sales_opportunity_item."U_UNADJUSTED_AMOUNT_USD" =  sales_opportunity_item_6956895."U_UNADJUSTED_AMOUNT_USD", sales_opportunity_item."U_PREVIOUS_PRICE_RESET_LINE" =  sales_opportunity_item_6956895."U_PREVIOUS_PRICE_RESET_LINE", sales_opportunity_item."U_TOTAL_VALUE_AMOUNT" =  sales_opportunity_item_6956895."U_TOTAL_VALUE_AMOUNT", sales_opportunity_item."U_CREDIT_CARD_FEES_MONTHLY" =  sales_opportunity_item_6956895."U_CREDIT_CARD_FEES_MONTHLY", sales_opportunity_item."U_PRODUCT_FAMILY" =  sales_opportunity_item_6956895."U_PRODUCT_FAMILY", sales_opportunity_item."U_SALES_TAX" =  sales_opportunity_item_6956895."U_SALES_TAX", sales_opportunity_item."U_ACV_USD_STRING" =  sales_opportunity_item_6956895."U_ACV_USD_STRING", sales_opportunity_item."U_CURRENCY_SYMBOL" =  sales_opportunity_item_6956895."U_CURRENCY_SYMBOL", sales_opportunity_item."U_BASE_AMOUNT" =  sales_opportunity_item_6956895."U_BASE_AMOUNT", sales_opportunity_item."U_ANNUAL_CONTRACT_AMOUNT_USD" =  sales_opportunity_item_6956895."U_ANNUAL_CONTRACT_AMOUNT_USD", sales_opportunity_item."SYS_CREATED_ON" =  sales_opportunity_item_6956895."SYS_CREATED_ON", sales_opportunity_item."U_PRICE_BAND" =  sales_opportunity_item_6956895."U_PRICE_BAND", sales_opportunity_item."U_DISCOUNTED_BASE_PRICE" =  sales_opportunity_item_6956895."U_DISCOUNTED_BASE_PRICE", sales_opportunity_item."U_ANNUAL_LIST_AMOUNT_USD" =  sales_opportunity_item_6956895."U_ANNUAL_LIST_AMOUNT_USD", sales_opportunity_item."DV_SYS_DOMAIN" =  sales_opportunity_item_6956895."DV_SYS_DOMAIN", sales_opportunity_item."U_SALES_AMOUNT" =  sales_opportunity_item_6956895."U_SALES_AMOUNT", sales_opportunity_item."DV_U_PREVIOUS_PRICE_RESET_LINE" =  sales_opportunity_item_6956895."DV_U_PREVIOUS_PRICE_RESET_LINE", sales_opportunity_item."SYS_UPDATED_BY" =  sales_opportunity_item_6956895."SYS_UPDATED_BY", sales_opportunity_item."NAME" =  sales_opportunity_item_6956895."NAME", sales_opportunity_item."CONTRACT_LINE_REF" =  sales_opportunity_item_6956895."CONTRACT_LINE_REF", sales_opportunity_item."U_APPSTORE_SN_TOTAL_TAX" =  sales_opportunity_item_6956895."U_APPSTORE_SN_TOTAL_TAX", sales_opportunity_item."U_ORDER" =  sales_opportunity_item_6956895."U_ORDER", sales_opportunity_item."DV_OPPORTUNITY" =  sales_opportunity_item_6956895."DV_OPPORTUNITY", sales_opportunity_item."U_USD_ADJUSTMENT_A" =  sales_opportunity_item_6956895."U_USD_ADJUSTMENT_A", sales_opportunity_item."U_PARTNER_FEE_1" =  sales_opportunity_item_6956895."U_PARTNER_FEE_1", sales_opportunity_item."U_SUPERSEDED" =  sales_opportunity_item_6956895."U_SUPERSEDED", sales_opportunity_item."U_VENDOR_NET_PRICE_YEARLY" =  sales_opportunity_item_6956895."U_VENDOR_NET_PRICE_YEARLY", sales_opportunity_item."U_PARTNER_FEE_2" =  sales_opportunity_item_6956895."U_PARTNER_FEE_2", sales_opportunity_item."U_PARTNER_FEE_3" =  sales_opportunity_item_6956895."U_PARTNER_FEE_3", sales_opportunity_item."U_NEW_TERM" =  sales_opportunity_item_6956895."U_NEW_TERM", sales_opportunity_item."U_PRICE_BOOK" =  sales_opportunity_item_6956895."U_PRICE_BOOK", sales_opportunity_item."U_FX_RATE" =  sales_opportunity_item_6956895."U_FX_RATE", sales_opportunity_item."OPPORTUNITY" =  sales_opportunity_item_6956895."OPPORTUNITY", sales_opportunity_item."DV_PRODUCT" =  sales_opportunity_item_6956895."DV_PRODUCT", sales_opportunity_item."DV_FLAGS" =  sales_opportunity_item_6956895."DV_FLAGS", sales_opportunity_item."U_FX_RATE_DAILY_USD" =  sales_opportunity_item_6956895."U_FX_RATE_DAILY_USD", sales_opportunity_item."TAX_RATE" =  sales_opportunity_item_6956895."TAX_RATE", sales_opportunity_item."U_NET_NEW_ACV_STRING" =  sales_opportunity_item_6956895."U_NET_NEW_ACV_STRING", sales_opportunity_item."PSP_PER_INSERT_DT" =  sales_opportunity_item."PSP_PER_INSERT_DT", sales_opportunity_item."PSP_PER_UPDATE_DT" =  '2025-01-01 00:00:00', sales_opportunity_item."PSP_PER_DELETE_DT" =  sales_opportunity_item_6956895."PSP_PER_DELETE_DT", sales_opportunity_item."U_APPSTORE_VENDOR_MONTHLY_TAX" =  sales_opportunity_item_6956895."U_APPSTORE_VENDOR_MONTHLY_TAX", sales_opportunity_item."U_APPSTORE_VENDOR_TOTAL_TAX" =  sales_opportunity_item_6956895."U_APPSTORE_VENDOR_TOTAL_TAX", sales_opportunity_item."U_CUSTOM_CODE" =  sales_opportunity_item_6956895."U_CUSTOM_CODE", sales_opportunity_item."U_DO_NOT_CALCULATE_NET_NEW_ACV" =  sales_opportunity_item_6956895."U_DO_NOT_CALCULATE_NET_NEW_ACV", sales_opportunity_item."U_SPLIT_COMMISSION_EXCEPTION" =  sales_opportunity_item_6956895."U_SPLIT_COMMISSION_EXCEPTION", sales_opportunity_item."DV_U_CUSTOM_CODE" =  sales_opportunity_item_6956895."DV_U_CUSTOM_CODE", sales_opportunity_item."U_ANNUAL_CONTRACT_AMT_USD_LI_CONST" =  sales_opportunity_item_6956895."U_ANNUAL_CONTRACT_AMT_USD_LI_CONST", sales_opportunity_item."U_ANNUAL_LIST_AMOUNT_USD_LI_CONST" =  sales_opportunity_item_6956895."U_ANNUAL_LIST_AMOUNT_USD_LI_CONST", sales_opportunity_item."U_BASE_AMOUNT_USD_LI_CONST" =  sales_opportunity_item_6956895."U_BASE_AMOUNT_USD_LI_CONST", sales_opportunity_item."U_CONSTANT_FISCAL_YEAR" =  sales_opportunity_item_6956895."U_CONSTANT_FISCAL_YEAR", sales_opportunity_item."U_CONSTANT_FX_RATE" =  sales_opportunity_item_6956895."U_CONSTANT_FX_RATE", sales_opportunity_item."U_CONTRACT_LINE_ACV_CONST" =  sales_opportunity_item_6956895."U_CONTRACT_LINE_ACV_CONST", sales_opportunity_item."U_NET_NEW_ACV_AMT_USD_LI_CONST" =  sales_opportunity_item_6956895."U_NET_NEW_ACV_AMT_USD_LI_CONST", sales_opportunity_item."U_SALES_AMOUNT_USD_LI_CONST" =  sales_opportunity_item_6956895."U_SALES_AMOUNT_USD_LI_CONST", sales_opportunity_item."U_TOTAL_VALUE_AMOUNT_USD_LI_CONST" =  sales_opportunity_item_6956895."U_TOTAL_VALUE_AMOUNT_USD_LI_CONST", sales_opportunity_item."U_UNADJUSTED_AMOUNT_USD_LI_CONST" =  sales_opportunity_item_6956895."U_UNADJUSTED_AMOUNT_USD_LI_CONST", sales_opportunity_item."U_USD_ADJUSTMENT_A_LI_CONST" =  sales_opportunity_item_6956895."U_USD_ADJUSTMENT_A_LI_CONST", sales_opportunity_item."U_PRODUCT_CODE_IN_LINE" =  sales_opportunity_item_6956895."U_PRODUCT_CODE_IN_LINE", sales_opportunity_item."U_INVOICE_UNPAID" =  sales_opportunity_item_6956895."U_INVOICE_UNPAID", sales_opportunity_item."U_MINIMUM_DEAL_THRESHOLD_APPROVALS" =  sales_opportunity_item_6956895."U_MINIMUM_DEAL_THRESHOLD_APPROVALS", sales_opportunity_item."DV_U_MINIMUM_DEAL_THRESHOLD_APPROVALS" =  sales_opportunity_item_6956895."DV_U_MINIMUM_DEAL_THRESHOLD_APPROVALS", sales_opportunity_item."DV_U_PRODUCT_UNIT" =  sales_opportunity_item_6956895."DV_U_PRODUCT_UNIT", sales_opportunity_item."U_DELIVERY_TYPE" =  sales_opportunity_item_6956895."U_DELIVERY_TYPE", sales_opportunity_item."U_LIADD_INFO_JSON" =  sales_opportunity_item_6956895."U_LIADD_INFO_JSON", sales_opportunity_item."U_USD_WEIGHTED_NNACV" =  sales_opportunity_item_6956895."U_USD_WEIGHTED_NNACV", sales_opportunity_item."U_PRODUCT_ATTRIBUTE_2" =  sales_opportunity_item_6956895."U_PRODUCT_ATTRIBUTE_2", sales_opportunity_item."U_NUMBER_OF_PRODUCTION_INSTANCES" =  sales_opportunity_item_6956895."U_NUMBER_OF_PRODUCTION_INSTANCES", sales_opportunity_item."U_NUMBER_OF_NON_PRODUCTION_INSTANCES" =  sales_opportunity_item_6956895."U_NUMBER_OF_NON_PRODUCTION_INSTANCES", sales_opportunity_item."U_ALLOW_CUSTOM_SKU" =  sales_opportunity_item_6956895."U_ALLOW_CUSTOM_SKU", sales_opportunity_item."U_IS_INSTANCE_PROVISIONING_REQUIRED" =  sales_opportunity_item_6956895."U_IS_INSTANCE_PROVISIONING_REQUIRED", sales_opportunity_item."DV_U_IS_INSTANCE_PROVISIONING_REQUIRED" =  sales_opportunity_item_6956895."DV_U_IS_INSTANCE_PROVISIONING_REQUIRED", sales_opportunity_item."U_INSTANCE_TYPE" =  sales_opportunity_item_6956895."U_INSTANCE_TYPE", sales_opportunity_item."DV_U_INSTANCE_TYPE" =  sales_opportunity_item_6956895."DV_U_INSTANCE_TYPE", sales_opportunity_item."U_CUSTOMER_SUCCESS_PACKAGE_DISCOUNT" =  sales_opportunity_item_6956895."U_CUSTOMER_SUCCESS_PACKAGE_DISCOUNT", sales_opportunity_item."U_PROMO_CODE" =  sales_opportunity_item_6956895."U_PROMO_CODE", sales_opportunity_item."DV_U_PROMO_CODE" =  sales_opportunity_item_6956895."DV_U_PROMO_CODE", sales_opportunity_item."U_DG_ERROR_MESSAGE" =  sales_opportunity_item_6956895."U_DG_ERROR_MESSAGE", sales_opportunity_item."U_DG_ERROR_CODE" =  sales_opportunity_item_6956895."U_DG_ERROR_CODE", sales_opportunity_item."U_DISCOUNT_GUIDELINE" =  sales_opportunity_item_6956895."U_DISCOUNT_GUIDELINE", sales_opportunity_item."U_DISCRETION" =  sales_opportunity_item_6956895."U_DISCRETION", sales_opportunity_item."U_DISCRETION_ERROR_MESSAGE" =  sales_opportunity_item_6956895."U_DISCRETION_ERROR_MESSAGE", sales_opportunity_item."U_DISCRETION_ERROR_CODE" =  sales_opportunity_item_6956895."U_DISCRETION_ERROR_CODE", sales_opportunity_item."U_REASON_FOR_100_PERCENT_DISCOUNT" =  sales_opportunity_item_6956895."U_REASON_FOR_100_PERCENT_DISCOUNT", sales_opportunity_item."DV_U_REASON_FOR_100_PERCENT_DISCOUNT" =  sales_opportunity_item_6956895."DV_U_REASON_FOR_100_PERCENT_DISCOUNT", sales_opportunity_item."U_APPLY_DG" =  sales_opportunity_item_6956895."U_APPLY_DG", sales_opportunity_item."U_CUSTOM_TRAINING_AMOUNT" =  sales_opportunity_item_6956895."U_CUSTOM_TRAINING_AMOUNT", sales_opportunity_item."U_OCTANE_ACCOUNT_TOTAL_ACV" =  sales_opportunity_item_6956895."U_OCTANE_ACCOUNT_TOTAL_ACV", sales_opportunity_item."U_PD_DEAL_REG" =  sales_opportunity_item_6956895."U_PD_DEAL_REG", sales_opportunity_item."U_PD_PARTNER_CACV" =  sales_opportunity_item_6956895."U_PD_PARTNER_CACV", sales_opportunity_item."U_PD_RESELLER" =  sales_opportunity_item_6956895."U_PD_RESELLER", sales_opportunity_item."U_TOTAL_DISCOUNT" =  sales_opportunity_item_6956895."U_TOTAL_DISCOUNT", sales_opportunity_item."IS_QUOTED_IN_CALLIDUS" =  sales_opportunity_item_6956895."IS_QUOTED_IN_CALLIDUS", sales_opportunity_item."U_USD_VARIABLE_LIST_PRICE_ACV_CALC" =  sales_opportunity_item_6956895."U_USD_VARIABLE_LIST_PRICE_ACV_CALC", sales_opportunity_item."U_VARIABLE_PRICE_LIST_ACV_CALC" =  sales_opportunity_item_6956895."U_VARIABLE_PRICE_LIST_ACV_CALC", sales_opportunity_item."U_OVERRIDE_OCTANE_FLAG" =  sales_opportunity_item_6956895."U_OVERRIDE_OCTANE_FLAG", sales_opportunity_item."U_OCTANE_OVERRIDE_REASON" =  sales_opportunity_item_6956895."U_OCTANE_OVERRIDE_REASON", sales_opportunity_item."DV_U_FED_MULTI_YEAR" =  sales_opportunity_item_6956895."DV_U_FED_MULTI_YEAR", sales_opportunity_item."U_FED_MULTI_YEAR" =  sales_opportunity_item_6956895."U_FED_MULTI_YEAR", sales_opportunity_item."U_CPQ_NNACV" =  sales_opportunity_item_6956895."U_CPQ_NNACV", sales_opportunity_item."U_EMS_ENTITLEMENT_ID" =  sales_opportunity_item_6956895."U_EMS_ENTITLEMENT_ID", sales_opportunity_item."U_ACCOUNT_TOTAL_IMPACT_ACV" =  sales_opportunity_item_6956895."U_ACCOUNT_TOTAL_IMPACT_ACV", sales_opportunity_item."U_IMPACT_HAS_FLOOR_CEILING_PRICE" =  sales_opportunity_item_6956895."U_IMPACT_HAS_FLOOR_CEILING_PRICE", sales_opportunity_item."DV_U_IMPACT_HAS_FLOOR_CEILING_PRICE" =  sales_opportunity_item_6956895."DV_U_IMPACT_HAS_FLOOR_CEILING_PRICE", sales_opportunity_item."U_IMPACT_FLOOR_CEILING_ACV" =  sales_opportunity_item_6956895."U_IMPACT_FLOOR_CEILING_ACV", sales_opportunity_item."U_IMPACT_UPSELL_REFERENCE" =  sales_opportunity_item_6956895."U_IMPACT_UPSELL_REFERENCE", sales_opportunity_item."DV_U_IMPACT_UPSELL_REFERENCE" =  sales_opportunity_item_6956895."DV_U_IMPACT_UPSELL_REFERENCE", sales_opportunity_item."U_CONTRACT_REFERENCE" =  sales_opportunity_item_6956895."U_CONTRACT_REFERENCE", sales_opportunity_item."DV_U_CONTRACT_REFERENCE" =  sales_opportunity_item_6956895."DV_U_CONTRACT_REFERENCE", sales_opportunity_item."U_CEILING_ACV" =  sales_opportunity_item_6956895."U_CEILING_ACV", sales_opportunity_item."U_FLOOR_ACV" =  sales_opportunity_item_6956895."U_FLOOR_ACV", sales_opportunity_item."PSP_DELTA_UPDATE_DT" =  sales_opportunity_item_6956895."PSP_DELTA_UPDATE_DT", sales_opportunity_item."DV_LINE_ORIGIN" =  sales_opportunity_item_6956895."DV_LINE_ORIGIN" when not matched then insert ( sales_opportunity_item."BASE_PRICE", sales_opportunity_item."DV_U_REV_REC_TYPE", sales_opportunity_item."U_ANNUAL_CONTRACT_VALUE_STRING", sales_opportunity_item."U_ALLOWED_DISCOUNT", sales_opportunity_item."U_PRODUCT_PRICE", sales_opportunity_item."U_HAS_PRICES", sales_opportunity_item."U_PRODUCT_UNIT", sales_opportunity_item."DV_U_PRICE_BAND", sales_opportunity_item."U_SALES_AMOUNT_USD", sales_opportunity_item."QUANTITY", sales_opportunity_item."DV_U_SOW_REQUEST", sales_opportunity_item."U_TERM_MONTHS_AND_DAYS", sales_opportunity_item."U_TERM", sales_opportunity_item."U_NET_NEW_ACV_AMOUNT_USD", sales_opportunity_item."U_BASE_AMOUNT_USD", sales_opportunity_item."LINE_ORIGIN", sales_opportunity_item."CONTRACT_LINE_QUANTITY", sales_opportunity_item."U_UNADJUSTED_PRICE_USD_STRING", sales_opportunity_item."DV_U_PARENT_REPLACEMENT_LINE", sales_opportunity_item."U_UNADJUSTED_PRICE_STRING", sales_opportunity_item."U_ANNUAL_LIST_PRICE_STRING", sales_opportunity_item."NUMBER", sales_opportunity_item."U_TOTAL_VALUE_AMOUNT_USD", sales_opportunity_item."TOTAL_PRICE", sales_opportunity_item."DISCOUNT_PERCENT", sales_opportunity_item."U_CURRENCY_CODE", sales_opportunity_item."U_AUDITING_NOTES", sales_opportunity_item."U_NET_NEW_QUANTITY", sales_opportunity_item."U_APPSTORE_SN_MONTHLY_TAX", sales_opportunity_item."U_PRODUCT_ATTRIBUTE_1", sales_opportunity_item."U_UNADJUSTED_AMOUNT", sales_opportunity_item."DV_U_PRICE_BOOK", sales_opportunity_item."U_SOW_REQUEST", sales_opportunity_item."U_NOTES", sales_opportunity_item."ESTIMATED_TAX", sales_opportunity_item."U_ADJUSTMENT_S", sales_opportunity_item."CONTRACT_LINE_ACV", sales_opportunity_item."DV_CONTRACT_LINE_REF", sales_opportunity_item."U_CREDIT_CARD_FEES_YEARLY", sales_opportunity_item."U_ANNUAL_CONTRACT_VALUE_AMOUNT", sales_opportunity_item."FLAGS", sales_opportunity_item."U_APPSTORE_APP_MONTHLY_PRICE", sales_opportunity_item."U_ADJUSTMENT_A", sales_opportunity_item."U_TOGGLE_PRODUCT_PRICE", sales_opportunity_item."SYS_ID", sales_opportunity_item."U_DELETED_REASON_CODE", sales_opportunity_item."U_LIST_PRICE_USD_STRING", sales_opportunity_item."U_REV_REC_TYPE", sales_opportunity_item."CONTRACT_LINE_ACV_USD", sales_opportunity_item."U_PARTNER_DISCOUNT", sales_opportunity_item."DV_U_PRICE_RESET_PRIMARY_LINE", sales_opportunity_item."U_ANNUAL_LIST_AMOUNT", sales_opportunity_item."SYS_CREATED_BY", sales_opportunity_item."PRODUCT", sales_opportunity_item."U_NET_NEW_ACV_AMOUNT", sales_opportunity_item."U_ROLE_BASED_RATES", sales_opportunity_item."U_TOTAL_VALUE_STRING", sales_opportunity_item."SYS_DOMAIN_PATH", sales_opportunity_item."U_PRICE_RESET_PRIMARY_LINE", sales_opportunity_item."U_ANNUAL_LIST_USD_STRING", sales_opportunity_item."U_TOTAL_VALUE_USD_STRING", sales_opportunity_item."U_VENDOR_NET_PRICE_MONTHLY", sales_opportunity_item."U_APPSTORE_APP_TOTAL_PRICE", sales_opportunity_item."DV_U_QUOTE", sales_opportunity_item."U_PARENT_REPLACEMENT_LINE", sales_opportunity_item."U_VARIABLE_PRICE_ACV_CALC", sales_opportunity_item."U_FX_RATE_DAILY", sales_opportunity_item."U_USD_VARIABLE_PRICE_ACV_CALC", sales_opportunity_item."U_USD_ADJUSTMENT_S", sales_opportunity_item."U_PRODUCT_CATEGORY", sales_opportunity_item."U_TERM_END_DATE", sales_opportunity_item."DESCRIPTION", sales_opportunity_item."SYS_DOMAIN", sales_opportunity_item."U_PRODUCT_HOURS", sales_opportunity_item."SYS_TAGS", sales_opportunity_item."U_LIST_PRICE_STRING", sales_opportunity_item."U_QUOTE", sales_opportunity_item."U_CC_TOKEN__", sales_opportunity_item."SYS_MOD_COUNT", sales_opportunity_item."U_ESTIMATED_TOTAL", sales_opportunity_item."U_APPSTORE_APP_TOTAL_TAX", sales_opportunity_item."U_PRODUCT_TERM_TYPE", sales_opportunity_item."U_PRODUCT_PRICE_FULL_NAME", sales_opportunity_item."U_NET_NEW_ACV_STRING_USD", sales_opportunity_item."SYS_UPDATED_ON", sales_opportunity_item."U_VALIDATIONABORT", sales_opportunity_item."DV_U_PRODUCT_PRICE", sales_opportunity_item."U_APPSTORE_APP_MONTHLY_TAX", sales_opportunity_item."U_TERM_START_DATE", sales_opportunity_item."U_INACTIVE_PRODUCT", sales_opportunity_item."U_SALES_PRICE_USD_STRING", sales_opportunity_item."DV_U_DELETED_REASON_CODE", sales_opportunity_item."U_SALES_PRICE_STRING", sales_opportunity_item."U_UNADJUSTED_AMOUNT_USD", sales_opportunity_item."U_PREVIOUS_PRICE_RESET_LINE", sales_opportunity_item."U_TOTAL_VALUE_AMOUNT", sales_opportunity_item."U_CREDIT_CARD_FEES_MONTHLY", sales_opportunity_item."U_PRODUCT_FAMILY", sales_opportunity_item."U_SALES_TAX", sales_opportunity_item."U_ACV_USD_STRING", sales_opportunity_item."U_CURRENCY_SYMBOL", sales_opportunity_item."U_BASE_AMOUNT", sales_opportunity_item."U_ANNUAL_CONTRACT_AMOUNT_USD", sales_opportunity_item."SYS_CREATED_ON", sales_opportunity_item."U_PRICE_BAND", sales_opportunity_item."U_DISCOUNTED_BASE_PRICE", sales_opportunity_item."U_ANNUAL_LIST_AMOUNT_USD", sales_opportunity_item."DV_SYS_DOMAIN", sales_opportunity_item."U_SALES_AMOUNT", sales_opportunity_item."DV_U_PREVIOUS_PRICE_RESET_LINE", sales_opportunity_item."SYS_UPDATED_BY", sales_opportunity_item."NAME", sales_opportunity_item."CONTRACT_LINE_REF", sales_opportunity_item."U_APPSTORE_SN_TOTAL_TAX", sales_opportunity_item."U_ORDER", sales_opportunity_item."DV_OPPORTUNITY", sales_opportunity_item."U_USD_ADJUSTMENT_A", sales_opportunity_item."U_PARTNER_FEE_1", sales_opportunity_item."U_SUPERSEDED", sales_opportunity_item."U_VENDOR_NET_PRICE_YEARLY", sales_opportunity_item."U_PARTNER_FEE_2", sales_opportunity_item."U_PARTNER_FEE_3", sales_opportunity_item."U_NEW_TERM", sales_opportunity_item."U_PRICE_BOOK", sales_opportunity_item."U_FX_RATE", sales_opportunity_item."OPPORTUNITY", sales_opportunity_item."DV_PRODUCT", sales_opportunity_item."DV_FLAGS", sales_opportunity_item."U_FX_RATE_DAILY_USD", sales_opportunity_item."TAX_RATE", sales_opportunity_item."U_NET_NEW_ACV_STRING", sales_opportunity_item."PSP_PER_INSERT_DT", sales_opportunity_item."PSP_PER_UPDATE_DT", sales_opportunity_item."PSP_PER_DELETE_DT", sales_opportunity_item."U_APPSTORE_VENDOR_MONTHLY_TAX", sales_opportunity_item."U_APPSTORE_VENDOR_TOTAL_TAX", sales_opportunity_item."U_CUSTOM_CODE", sales_opportunity_item."U_DO_NOT_CALCULATE_NET_NEW_ACV", sales_opportunity_item."U_SPLIT_COMMISSION_EXCEPTION", sales_opportunity_item."DV_U_CUSTOM_CODE", sales_opportunity_item."U_ANNUAL_CONTRACT_AMT_USD_LI_CONST", sales_opportunity_item."U_ANNUAL_LIST_AMOUNT_USD_LI_CONST", sales_opportunity_item."U_BASE_AMOUNT_USD_LI_CONST", sales_opportunity_item."U_CONSTANT_FISCAL_YEAR", sales_opportunity_item."U_CONSTANT_FX_RATE", sales_opportunity_item."U_CONTRACT_LINE_ACV_CONST", sales_opportunity_item."U_NET_NEW_ACV_AMT_USD_LI_CONST", sales_opportunity_item."U_SALES_AMOUNT_USD_LI_CONST", sales_opportunity_item."U_TOTAL_VALUE_AMOUNT_USD_LI_CONST", sales_opportunity_item."U_UNADJUSTED_AMOUNT_USD_LI_CONST", sales_opportunity_item."U_USD_ADJUSTMENT_A_LI_CONST", sales_opportunity_item."U_PRODUCT_CODE_IN_LINE", sales_opportunity_item."U_INVOICE_UNPAID", sales_opportunity_item."U_MINIMUM_DEAL_THRESHOLD_APPROVALS", sales_opportunity_item."DV_U_MINIMUM_DEAL_THRESHOLD_APPROVALS", sales_opportunity_item."DV_U_PRODUCT_UNIT", sales_opportunity_item."U_DELIVERY_TYPE", sales_opportunity_item."U_LIADD_INFO_JSON", sales_opportunity_item."U_USD_WEIGHTED_NNACV", sales_opportunity_item."U_PRODUCT_ATTRIBUTE_2", sales_opportunity_item."U_NUMBER_OF_PRODUCTION_INSTANCES", sales_opportunity_item."U_NUMBER_OF_NON_PRODUCTION_INSTANCES", sales_opportunity_item."U_ALLOW_CUSTOM_SKU", sales_opportunity_item."U_IS_INSTANCE_PROVISIONING_REQUIRED", sales_opportunity_item."DV_U_IS_INSTANCE_PROVISIONING_REQUIRED", sales_opportunity_item."U_INSTANCE_TYPE", sales_opportunity_item."DV_U_INSTANCE_TYPE", sales_opportunity_item."U_CUSTOMER_SUCCESS_PACKAGE_DISCOUNT", sales_opportunity_item."U_PROMO_CODE", sales_opportunity_item."DV_U_PROMO_CODE", sales_opportunity_item."U_DG_ERROR_MESSAGE", sales_opportunity_item."U_DG_ERROR_CODE", sales_opportunity_item."U_DISCOUNT_GUIDELINE", sales_opportunity_item."U_DISCRETION", sales_opportunity_item."U_DISCRETION_ERROR_MESSAGE", sales_opportunity_item."U_DISCRETION_ERROR_CODE", sales_opportunity_item."U_REASON_FOR_100_PERCENT_DISCOUNT", sales_opportunity_item."DV_U_REASON_FOR_100_PERCENT_DISCOUNT", sales_opportunity_item."U_APPLY_DG", sales_opportunity_item."U_CUSTOM_TRAINING_AMOUNT", sales_opportunity_item."U_OCTANE_ACCOUNT_TOTAL_ACV", sales_opportunity_item."U_PD_DEAL_REG", sales_opportunity_item."U_PD_PARTNER_CACV", sales_opportunity_item."U_PD_RESELLER", sales_opportunity_item."U_TOTAL_DISCOUNT", sales_opportunity_item."IS_QUOTED_IN_CALLIDUS", sales_opportunity_item."U_USD_VARIABLE_LIST_PRICE_ACV_CALC", sales_opportunity_item."U_VARIABLE_PRICE_LIST_ACV_CALC", sales_opportunity_item."U_OVERRIDE_OCTANE_FLAG", sales_opportunity_item."U_OCTANE_OVERRIDE_REASON", sales_opportunity_item."DV_U_FED_MULTI_YEAR", sales_opportunity_item."U_FED_MULTI_YEAR", sales_opportunity_item."U_CPQ_NNACV", sales_opportunity_item."U_EMS_ENTITLEMENT_ID", sales_opportunity_item."U_ACCOUNT_TOTAL_IMPACT_ACV", sales_opportunity_item."U_IMPACT_HAS_FLOOR_CEILING_PRICE", sales_opportunity_item."DV_U_IMPACT_HAS_FLOOR_CEILING_PRICE", sales_opportunity_item."U_IMPACT_FLOOR_CEILING_ACV", sales_opportunity_item."U_IMPACT_UPSELL_REFERENCE", sales_opportunity_item."DV_U_IMPACT_UPSELL_REFERENCE", sales_opportunity_item."U_CONTRACT_REFERENCE", sales_opportunity_item."DV_U_CONTRACT_REFERENCE", sales_opportunity_item."U_CEILING_ACV", sales_opportunity_item."U_FLOOR_ACV", sales_opportunity_item."PSP_DELTA_UPDATE_DT", sales_opportunity_item."DV_LINE_ORIGIN") values ( sales_opportunity_item_6956895."BASE_PRICE", sales_opportunity_item_6956895."DV_U_REV_REC_TYPE", sales_opportunity_item_6956895."U_ANNUAL_CONTRACT_VALUE_STRING", sales_opportunity_item_6956895."U_ALLOWED_DISCOUNT", sales_opportunity_item_6956895."U_PRODUCT_PRICE", sales_opportunity_item_6956895."U_HAS_PRICES", sales_opportunity_item_6956895."U_PRODUCT_UNIT", sales_opportunity_item_6956895."DV_U_PRICE_BAND", sales_opportunity_item_6956895."U_SALES_AMOUNT_USD", sales_opportunity_item_6956895."QUANTITY", sales_opportunity_item_6956895."DV_U_SOW_REQUEST", sales_opportunity_item_6956895."U_TERM_MONTHS_AND_DAYS", sales_opportunity_item_6956895."U_TERM", sales_opportunity_item_6956895."U_NET_NEW_ACV_AMOUNT_USD", sales_opportunity_item_6956895."U_BASE_AMOUNT_USD", sales_opportunity_item_6956895."LINE_ORIGIN", sales_opportunity_item_6956895."CONTRACT_LINE_QUANTITY", sales_opportunity_item_6956895."U_UNADJUSTED_PRICE_USD_STRING", sales_opportunity_item_6956895."DV_U_PARENT_REPLACEMENT_LINE", sales_opportunity_item_6956895."U_UNADJUSTED_PRICE_STRING", sales_opportunity_item_6956895."U_ANNUAL_LIST_PRICE_STRING", sales_opportunity_item_6956895."NUMBER", sales_opportunity_item_6956895."U_TOTAL_VALUE_AMOUNT_USD", sales_opportunity_item_6956895."TOTAL_PRICE", sales_opportunity_item_6956895."DISCOUNT_PERCENT", sales_opportunity_item_6956895."U_CURRENCY_CODE", sales_opportunity_item_6956895."U_AUDITING_NOTES", sales_opportunity_item_6956895."U_NET_NEW_QUANTITY", sales_opportunity_item_6956895."U_APPSTORE_SN_MONTHLY_TAX", sales_opportunity_item_6956895."U_PRODUCT_ATTRIBUTE_1", sales_opportunity_item_6956895."U_UNADJUSTED_AMOUNT", sales_opportunity_item_6956895."DV_U_PRICE_BOOK", sales_opportunity_item_6956895."U_SOW_REQUEST", sales_opportunity_item_6956895."U_NOTES", sales_opportunity_item_6956895."ESTIMATED_TAX", sales_opportunity_item_6956895."U_ADJUSTMENT_S", sales_opportunity_item_6956895."CONTRACT_LINE_ACV", sales_opportunity_item_6956895."DV_CONTRACT_LINE_REF", sales_opportunity_item_6956895."U_CREDIT_CARD_FEES_YEARLY", sales_opportunity_item_6956895."U_ANNUAL_CONTRACT_VALUE_AMOUNT", sales_opportunity_item_6956895."FLAGS", sales_opportunity_item_6956895."U_APPSTORE_APP_MONTHLY_PRICE", sales_opportunity_item_6956895."U_ADJUSTMENT_A", sales_opportunity_item_6956895."U_TOGGLE_PRODUCT_PRICE", sales_opportunity_item_6956895."SYS_ID", sales_opportunity_item_6956895."U_DELETED_REASON_CODE", sales_opportunity_item_6956895."U_LIST_PRICE_USD_STRING", sales_opportunity_item_6956895."U_REV_REC_TYPE", sales_opportunity_item_6956895."CONTRACT_LINE_ACV_USD", sales_opportunity_item_6956895."U_PARTNER_DISCOUNT", sales_opportunity_item_6956895."DV_U_PRICE_RESET_PRIMARY_LINE", sales_opportunity_item_6956895."U_ANNUAL_LIST_AMOUNT", sales_opportunity_item_6956895."SYS_CREATED_BY", sales_opportunity_item_6956895."PRODUCT", sales_opportunity_item_6956895."U_NET_NEW_ACV_AMOUNT", sales_opportunity_item_6956895."U_ROLE_BASED_RATES", sales_opportunity_item_6956895."U_TOTAL_VALUE_STRING", sales_opportunity_item_6956895."SYS_DOMAIN_PATH", sales_opportunity_item_6956895."U_PRICE_RESET_PRIMARY_LINE", sales_opportunity_item_6956895."U_ANNUAL_LIST_USD_STRING", sales_opportunity_item_6956895."U_TOTAL_VALUE_USD_STRING", sales_opportunity_item_6956895."U_VENDOR_NET_PRICE_MONTHLY", sales_opportunity_item_6956895."U_APPSTORE_APP_TOTAL_PRICE", sales_opportunity_item_6956895."DV_U_QUOTE", sales_opportunity_item_6956895."U_PARENT_REPLACEMENT_LINE", sales_opportunity_item_6956895."U_VARIABLE_PRICE_ACV_CALC", sales_opportunity_item_6956895."U_FX_RATE_DAILY", sales_opportunity_item_6956895."U_USD_VARIABLE_PRICE_ACV_CALC", sales_opportunity_item_6956895."U_USD_ADJUSTMENT_S", sales_opportunity_item_6956895."U_PRODUCT_CATEGORY", sales_opportunity_item_6956895."U_TERM_END_DATE", sales_opportunity_item_6956895."DESCRIPTION", sales_opportunity_item_6956895."SYS_DOMAIN", sales_opportunity_item_6956895."U_PRODUCT_HOURS", sales_opportunity_item_6956895."SYS_TAGS", sales_opportunity_item_6956895."U_LIST_PRICE_STRING", sales_opportunity_item_6956895."U_QUOTE", sales_opportunity_item_6956895."U_CC_TOKEN__", sales_opportunity_item_6956895."SYS_MOD_COUNT", sales_opportunity_item_6956895."U_ESTIMATED_TOTAL", sales_opportunity_item_6956895."U_APPSTORE_APP_TOTAL_TAX", sales_opportunity_item_6956895."U_PRODUCT_TERM_TYPE", sales_opportunity_item_6956895."U_PRODUCT_PRICE_FULL_NAME", sales_opportunity_item_6956895."U_NET_NEW_ACV_STRING_USD", sales_opportunity_item_6956895."SYS_UPDATED_ON", sales_opportunity_item_6956895."U_VALIDATIONABORT", sales_opportunity_item_6956895."DV_U_PRODUCT_PRICE", sales_opportunity_item_6956895."U_APPSTORE_APP_MONTHLY_TAX", sales_opportunity_item_6956895."U_TERM_START_DATE", sales_opportunity_item_6956895."U_INACTIVE_PRODUCT", sales_opportunity_item_6956895."U_SALES_PRICE_USD_STRING", sales_opportunity_item_6956895."DV_U_DELETED_REASON_CODE", sales_opportunity_item_6956895."U_SALES_PRICE_STRING", sales_opportunity_item_6956895."U_UNADJUSTED_AMOUNT_USD", sales_opportunity_item_6956895."U_PREVIOUS_PRICE_RESET_LINE", sales_opportunity_item_6956895."U_TOTAL_VALUE_AMOUNT", sales_opportunity_item_6956895."U_CREDIT_CARD_FEES_MONTHLY", sales_opportunity_item_6956895."U_PRODUCT_FAMILY", sales_opportunity_item_6956895."U_SALES_TAX", sales_opportunity_item_6956895."U_ACV_USD_STRING", sales_opportunity_item_6956895."U_CURRENCY_SYMBOL", sales_opportunity_item_6956895."U_BASE_AMOUNT", sales_opportunity_item_6956895."U_ANNUAL_CONTRACT_AMOUNT_USD", sales_opportunity_item_6956895."SYS_CREATED_ON", sales_opportunity_item_6956895."U_PRICE_BAND", sales_opportunity_item_6956895."U_DISCOUNTED_BASE_PRICE", sales_opportunity_item_6956895."U_ANNUAL_LIST_AMOUNT_USD", sales_opportunity_item_6956895."DV_SYS_DOMAIN", sales_opportunity_item_6956895."U_SALES_AMOUNT", sales_opportunity_item_6956895."DV_U_PREVIOUS_PRICE_RESET_LINE", sales_opportunity_item_6956895."SYS_UPDATED_BY", sales_opportunity_item_6956895."NAME", sales_opportunity_item_6956895."CONTRACT_LINE_REF", sales_opportunity_item_6956895."U_APPSTORE_SN_TOTAL_TAX", sales_opportunity_item_6956895."U_ORDER", sales_opportunity_item_6956895."DV_OPPORTUNITY", sales_opportunity_item_6956895."U_USD_ADJUSTMENT_A", sales_opportunity_item_6956895."U_PARTNER_FEE_1", sales_opportunity_item_6956895."U_SUPERSEDED", sales_opportunity_item_6956895."U_VENDOR_NET_PRICE_YEARLY", sales_opportunity_item_6956895."U_PARTNER_FEE_2", sales_opportunity_item_6956895."U_PARTNER_FEE_3", sales_opportunity_item_6956895."U_NEW_TERM", sales_opportunity_item_6956895."U_PRICE_BOOK", sales_opportunity_item_6956895."U_FX_RATE", sales_opportunity_item_6956895."OPPORTUNITY", sales_opportunity_item_6956895."DV_PRODUCT", sales_opportunity_item_6956895."DV_FLAGS", sales_opportunity_item_6956895."U_FX_RATE_DAILY_USD", sales_opportunity_item_6956895."TAX_RATE", sales_opportunity_item_6956895."U_NET_NEW_ACV_STRING", 'placeholder_2', 'placeholder_3', sales_opportunity_item_6956895."PSP_PER_DELETE_DT", sales_opportunity_item_6956895."U_APPSTORE_VENDOR_MONTHLY_TAX", sales_opportunity_item_6956895."U_APPSTORE_VENDOR_TOTAL_TAX", sales_opportunity_item_6956895."U_CUSTOM_CODE", sales_opportunity_item_6956895."U_DO_NOT_CALCULATE_NET_NEW_ACV", sales_opportunity_item_6956895."U_SPLIT_COMMISSION_EXCEPTION", sales_opportunity_item_6956895."DV_U_CUSTOM_CODE", sales_opportunity_item_6956895."U_ANNUAL_CONTRACT_AMT_USD_LI_CONST", sales_opportunity_item_6956895."U_ANNUAL_LIST_AMOUNT_USD_LI_CONST", sales_opportunity_item_6956895."U_BASE_AMOUNT_USD_LI_CONST", sales_opportunity_item_6956895."U_CONSTANT_FISCAL_YEAR", sales_opportunity_item_6956895."U_CONSTANT_FX_RATE", sales_opportunity_item_6956895."U_CONTRACT_LINE_ACV_CONST", sales_opportunity_item_6956895."U_NET_NEW_ACV_AMT_USD_LI_CONST", sales_opportunity_item_6956895."U_SALES_AMOUNT_USD_LI_CONST", sales_opportunity_item_6956895."U_TOTAL_VALUE_AMOUNT_USD_LI_CONST", sales_opportunity_item_6956895."U_UNADJUSTED_AMOUNT_USD_LI_CONST", sales_opportunity_item_6956895."U_USD_ADJUSTMENT_A_LI_CONST", sales_opportunity_item_6956895."U_PRODUCT_CODE_IN_LINE", sales_opportunity_item_6956895."U_INVOICE_UNPAID", sales_opportunity_item_6956895."U_MINIMUM_DEAL_THRESHOLD_APPROVALS", sales_opportunity_item_6956895."DV_U_MINIMUM_DEAL_THRESHOLD_APPROVALS", sales_opportunity_item_6956895."DV_U_PRODUCT_UNIT", sales_opportunity_item_6956895."U_DELIVERY_TYPE", sales_opportunity_item_6956895."U_LIADD_INFO_JSON", sales_opportunity_item_6956895."U_USD_WEIGHTED_NNACV", sales_opportunity_item_6956895."U_PRODUCT_ATTRIBUTE_2", sales_opportunity_item_6956895."U_NUMBER_OF_PRODUCTION_INSTANCES", sales_opportunity_item_6956895."U_NUMBER_OF_NON_PRODUCTION_INSTANCES", sales_opportunity_item_6956895."U_ALLOW_CUSTOM_SKU", sales_opportunity_item_6956895."U_IS_INSTANCE_PROVISIONING_REQUIRED", sales_opportunity_item_6956895."DV_U_IS_INSTANCE_PROVISIONING_REQUIRED", sales_opportunity_item_6956895."U_INSTANCE_TYPE", sales_opportunity_item_6956895."DV_U_INSTANCE_TYPE", sales_opportunity_item_6956895."U_CUSTOMER_SUCCESS_PACKAGE_DISCOUNT", sales_opportunity_item_6956895."U_PROMO_CODE", sales_opportunity_item_6956895."DV_U_PROMO_CODE", sales_opportunity_item_6956895."U_DG_ERROR_MESSAGE", sales_opportunity_item_6956895."U_DG_ERROR_CODE", sales_opportunity_item_6956895."U_DISCOUNT_GUIDELINE", sales_opportunity_item_6956895."U_DISCRETION", sales_opportunity_item_6956895."U_DISCRETION_ERROR_MESSAGE", sales_opportunity_item_6956895."U_DISCRETION_ERROR_CODE", sales_opportunity_item_6956895."U_REASON_FOR_100_PERCENT_DISCOUNT", sales_opportunity_item_6956895."DV_U_REASON_FOR_100_PERCENT_DISCOUNT", sales_opportunity_item_6956895."U_APPLY_DG", sales_opportunity_item_6956895."U_CUSTOM_TRAINING_AMOUNT", sales_opportunity_item_6956895."U_OCTANE_ACCOUNT_TOTAL_ACV", sales_opportunity_item_6956895."U_PD_DEAL_REG", sales_opportunity_item_6956895."U_PD_PARTNER_CACV", sales_opportunity_item_6956895."U_PD_RESELLER", sales_opportunity_item_6956895."U_TOTAL_DISCOUNT", sales_opportunity_item_6956895."IS_QUOTED_IN_CALLIDUS", sales_opportunity_item_6956895."U_USD_VARIABLE_LIST_PRICE_ACV_CALC", sales_opportunity_item_6956895."U_VARIABLE_PRICE_LIST_ACV_CALC", sales_opportunity_item_6956895."U_OVERRIDE_OCTANE_FLAG", sales_opportunity_item_6956895."U_OCTANE_OVERRIDE_REASON", sales_opportunity_item_6956895."DV_U_FED_MULTI_YEAR", sales_opportunity_item_6956895."U_FED_MULTI_YEAR", sales_opportunity_item_6956895."U_CPQ_NNACV", sales_opportunity_item_6956895."U_EMS_ENTITLEMENT_ID", sales_opportunity_item_6956895."U_ACCOUNT_TOTAL_IMPACT_ACV", sales_opportunity_item_6956895."U_IMPACT_HAS_FLOOR_CEILING_PRICE", sales_opportunity_item_6956895."DV_U_IMPACT_HAS_FLOOR_CEILING_PRICE", sales_opportunity_item_6956895."U_IMPACT_FLOOR_CEILING_ACV", sales_opportunity_item_6956895."U_IMPACT_UPSELL_REFERENCE", sales_opportunity_item_6956895."DV_U_IMPACT_UPSELL_REFERENCE", sales_opportunity_item_6956895."U_CONTRACT_REFERENCE", sales_opportunity_item_6956895."DV_U_CONTRACT_REFERENCE", sales_opportunity_item_6956895."U_CEILING_ACV", sales_opportunity_item_6956895."U_FLOOR_ACV", sales_opportunity_item_6956895."PSP_DELTA_UPDATE_DT", sales_opportunity_item_6956895."DV_LINE_ORIGIN")"""
    # SqlParse: Cannot extract source tables from complex MERGE statements
    assert_table_lineage_equal(
        sql,
        {"<default>.sales_opportunity_item_6956895"},  # source_tables
        {"<default>.sales_opportunity_item"},  # target_tables
        dialect="snowflake",
        test_sqlparse=False,
    )


def test_update_in_q5167():
    """update - Query 5167"""
    sql = """ update "NOC"."DQ"."TBL_DQ_CHECK_HISTORY"
set JOB_LOG=CONCAT(JOB_LOG,'placeholder_1')
 , TARGET_THRESHOLD_STATUS='placeholder_2'
 , ETL_UPDATE_DATE=current_timestamp() where JOB_RUN_ID in ('placeholder_3') and TARGET_DATABASE in ('placeholder_4')  and TARGET_SCHEMA in ('placeholder_5') and TARGET_TABLE in ('placeholder_6')"""
    # SqlParse: Cannot extract source tables from subqueries/complex queries
    assert_table_lineage_equal(
        sql,
        set(),  # source_tables
        {"noc.dq.tbl_dq_check_history"},  # target_tables
        dialect="snowflake",
        test_sqlparse=False,
    )


def test_update_rds_dynamics365_msdyn_accountkpiitems_q5169():
    """update - Query 5169"""
    sql = """ insert into RDS.DYNAMICS365.TABLES_DELETED_RECORDS_ID ( SCHEMA ,  STORED_PROCEDURE ,  SOURCE_TABLE_NAME ,  OBJECT_ID ,  TIME_STAMP )
    select 'placeholder_1' , 'placeholder_2' , 'placeholder_3' , "MSDYN_ACCOUNTKPIITEMID" ,  CURRENT_TIMESTAMP
    FROM RDS.DYNAMICS365.MSDYN_ACCOUNTKPIITEMS
    where "MSDYN_ACCOUNTKPIITEMID" IN (select distinct OBJECTID FROM "RDS"."DYNAMICS365"."AUDITS" WHERE "ACTION"='placeholder_4' and "OPERATION" = 'placeholder_5' AND LOWER( "OBJECTTYPECODE" ) = 'placeholder_6' AND CAST( "CREATEDON" AS DATE ) >=DATEADD(DAY, 'placeholder_7', CURRENT_DATE ))"""
    # SqlParse: Includes target table as source in INSERT INTO...SELECT
    # Graph: Parsers create different graph structures (table lineage is correct)
    assert_table_lineage_equal(
        sql,
        {
            "rds.dynamics365.audits",
            "rds.dynamics365.msdyn_accountkpiitems",
        },  # source_tables
        {"rds.dynamics365.tables_deleted_records_id"},  # target_tables
        dialect="snowflake",
        test_sqlparse=False,
        skip_graph_check=True,
    )


def test_update_sys_audit_delete_q5236():
    """update - Query 5236"""
    sql = """ Merge into sys_audit_delete using sys_audit_delete_3484154 on sys_audit_delete."SYS_ID" = sys_audit_delete_3484154."SYS_ID"  when matched then update set  sys_audit_delete."DISPLAY_VALUE" =  sys_audit_delete_3484154."DISPLAY_VALUE", sys_audit_delete."SYS_MOD_COUNT" =  sys_audit_delete_3484154."SYS_MOD_COUNT", sys_audit_delete."SYS_UPDATED_ON" =  sys_audit_delete_3484154."SYS_UPDATED_ON", sys_audit_delete."SYS_ID" =  sys_audit_delete_3484154."SYS_ID", sys_audit_delete."SYS_UPDATED_BY" =  sys_audit_delete_3484154."SYS_UPDATED_BY", sys_audit_delete."PAYLOAD" =  sys_audit_delete_3484154."PAYLOAD", sys_audit_delete."SYS_CREATED_ON" =  sys_audit_delete_3484154."SYS_CREATED_ON", sys_audit_delete."DOCUMENTKEY" =  sys_audit_delete_3484154."DOCUMENTKEY", sys_audit_delete."DELETE_RECOVERY" =  sys_audit_delete_3484154."DELETE_RECOVERY", sys_audit_delete."DV_DELETE_RECOVERY" =  sys_audit_delete_3484154."DV_DELETE_RECOVERY", sys_audit_delete."TABLENAME" =  sys_audit_delete_3484154."TABLENAME", sys_audit_delete."SYS_CREATED_BY" =  sys_audit_delete_3484154."SYS_CREATED_BY", sys_audit_delete."TRANSACTION" =  sys_audit_delete_3484154."TRANSACTION", sys_audit_delete."DV_TRANSACTION" =  sys_audit_delete_3484154."DV_TRANSACTION", sys_audit_delete."PSP_PER_INSERT_DT" =  sys_audit_delete."PSP_PER_INSERT_DT", sys_audit_delete."PSP_PER_DELETE_DT" =  sys_audit_delete_3484154."PSP_PER_DELETE_DT", sys_audit_delete."PSP_PER_UPDATE_DT" =  '2025-01-01 00:00:00' when not matched then insert ( sys_audit_delete."DISPLAY_VALUE", sys_audit_delete."SYS_MOD_COUNT", sys_audit_delete."SYS_UPDATED_ON", sys_audit_delete."SYS_ID", sys_audit_delete."SYS_UPDATED_BY", sys_audit_delete."PAYLOAD", sys_audit_delete."SYS_CREATED_ON", sys_audit_delete."DOCUMENTKEY", sys_audit_delete."DELETE_RECOVERY", sys_audit_delete."DV_DELETE_RECOVERY", sys_audit_delete."TABLENAME", sys_audit_delete."SYS_CREATED_BY", sys_audit_delete."TRANSACTION", sys_audit_delete."DV_TRANSACTION", sys_audit_delete."PSP_PER_INSERT_DT", sys_audit_delete."PSP_PER_DELETE_DT", sys_audit_delete."PSP_PER_UPDATE_DT") values ( sys_audit_delete_3484154."DISPLAY_VALUE", sys_audit_delete_3484154."SYS_MOD_COUNT", sys_audit_delete_3484154."SYS_UPDATED_ON", sys_audit_delete_3484154."SYS_ID", sys_audit_delete_3484154."SYS_UPDATED_BY", sys_audit_delete_3484154."PAYLOAD", sys_audit_delete_3484154."SYS_CREATED_ON", sys_audit_delete_3484154."DOCUMENTKEY", sys_audit_delete_3484154."DELETE_RECOVERY", sys_audit_delete_3484154."DV_DELETE_RECOVERY", sys_audit_delete_3484154."TABLENAME", sys_audit_delete_3484154."SYS_CREATED_BY", sys_audit_delete_3484154."TRANSACTION", sys_audit_delete_3484154."DV_TRANSACTION", 'placeholder_2', sys_audit_delete_3484154."PSP_PER_DELETE_DT", 'placeholder_3')"""
    # SqlParse: Cannot extract source tables from complex MERGE statements
    assert_table_lineage_equal(
        sql,
        {"<default>.sys_audit_delete_3484154"},  # source_tables
        {"<default>.sys_audit_delete"},  # target_tables
        dialect="snowflake",
        test_sqlparse=False,
    )
