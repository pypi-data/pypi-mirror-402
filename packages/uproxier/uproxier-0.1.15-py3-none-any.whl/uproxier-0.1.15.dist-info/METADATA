Metadata-Version: 2.4
Name: uproxier
Version: 0.1.15
Summary: HTTP/HTTPS proxy with rules engine and web UI
Author-email: huangjincheng <hjc853@gmail.com>
License-Expression: MIT
Keywords: proxy,mitmproxy,sse,rules,mock,http,https
Classifier: Development Status :: 4 - Beta
Classifier: Intended Audience :: Developers
Classifier: Operating System :: OS Independent
Classifier: Programming Language :: Python :: 3
Classifier: Programming Language :: Python :: 3.8
Classifier: Programming Language :: Python :: 3.9
Classifier: Programming Language :: Python :: 3.10
Classifier: Programming Language :: Python :: 3.11
Classifier: Programming Language :: Python :: 3.12
Classifier: Topic :: Internet :: WWW/HTTP :: HTTP Servers
Classifier: Topic :: Software Development :: Testing
Classifier: Topic :: System :: Networking
Requires-Python: >=3.8
Description-Content-Type: text/markdown
Requires-Dist: mitmproxy==10.2.4
Requires-Dist: flask==3.0.0
Requires-Dist: flask-cors==4.0.0
Requires-Dist: python-dotenv==1.0.0
Requires-Dist: click==8.1.7
Requires-Dist: rich==13.7.0
Requires-Dist: pyyaml==6.0.1
Requires-Dist: requests>=2.31.0

# UProxier Â· ä»£ç†æœåŠ¡å™¨

åŸºäº mitmproxy çš„å®Œæ•´ä»£ç†è½¯ä»¶è§£å†³æ–¹æ¡ˆï¼Œæ”¯æŒ HTTP/HTTPS ä»£ç†ã€è¯·æ±‚æ‹¦æˆªã€è§„åˆ™é…ç½®å’Œ Web ç•Œé¢ã€‚

## åŠŸèƒ½ç‰¹æ€§

- ğŸ”„ **HTTP/HTTPS ä»£ç†**: å®Œæ•´ä»£ç†ï¼Œæ”¯æŒ HTTPS è§£å¯†å¼€å…³ï¼ˆé…ç½®æˆ– CLI è¦†ç›–ï¼‰
- ğŸ›¡ï¸ **è¯ä¹¦ç®¡ç†**: è‡ªåŠ¨ç”Ÿæˆ/æ ¡éªŒ/å®‰è£… mitmproxy CA è¯ä¹¦
- ğŸ“‹ **è§„åˆ™å¼•æ“**: å¤šåŠ¨ä½œå åŠ ã€ä¼˜å…ˆçº§ã€å‘½ä¸­çŸ­è·¯ï¼ˆstop_after_matchï¼‰
    - mock_responseï¼ˆæ”¯æŒæœ¬åœ°æ–‡ä»¶ fileï¼‰/ modify_headers / modify_content / redirect
    - modify_response_headers / modify_response_content / modify_status
    - delay_responseï¼ˆçœŸå®å»¶è¿Ÿå‘é€ï¼‰/ conditional_responseï¼ˆæ¡ä»¶åˆ†æ”¯ï¼‰
    - é…ç½®ç»§æ‰¿ï¼ˆextendsï¼‰æ”¯æŒï¼Œç›¸å¯¹è·¯å¾„è‡ªåŠ¨è§£æ
- ğŸ’¾ **æŒä¹…åŒ–**: å¯å°†æŠ“åˆ°çš„è¯·æ±‚ä»¥ JSONL æŒä¹…åŒ–ï¼ˆ--saveï¼Œè¦†ç›–æ¨¡å¼ï¼‰
- ğŸŒ **Web ç•Œé¢**: å®æ—¶æµé‡ã€ç‚¹å‡»è¡ŒæŸ¥çœ‹è¯¦æƒ…ã€æœç´¢ã€æ¸…ç©ºï¼Œå®Œå…¨ç¦»çº¿åŒ–
- ğŸ¯ **CLI å·¥å…·**: start/init/cert/version/examples/validate & é™é»˜æ¨¡å¼ï¼ˆ--silentï¼‰
- ğŸ“Š **æŠ“åŒ…æ§åˆ¶**: æµåª’ä½“/å¤§æ–‡ä»¶å¼€å…³ã€é˜ˆå€¼ä¸äºŒè¿›åˆ¶ä¿å­˜æ§åˆ¶ï¼ˆé€šè¿‡ config.yaml é…ç½®ï¼‰
- ğŸ”§ **é…ç½®ç®¡ç†**: ç»Ÿä¸€é…ç½®ç›®å½•ï¼ˆ~/.uproxier/ï¼‰ï¼ŒYAML é…ç½® + CLI è¦†ç›–
- âœ… **é…ç½®éªŒè¯**: å®Œæ•´çš„é…ç½®éªŒè¯ç³»ç»Ÿï¼Œæ£€æŸ¥è¯­æ³•ã€ç±»å‹ã€æ–‡ä»¶å­˜åœ¨æ€§ç­‰

## å®‰è£…

```bash
pip install uproxier
```

### ä¾èµ–è¦æ±‚

- Python 3.8+
- OpenSSL (ç”¨äºè¯ä¹¦ç”Ÿæˆ)

## å¿«é€Ÿå¼€å§‹

### 1. å¯åŠ¨ä»£ç†

```bash
uproxier start
```

é¦–æ¬¡å¯åŠ¨ä¼šè‡ªåŠ¨åœ¨ç”¨æˆ·ç›®å½•ç”Ÿæˆ `~/.uproxier/certificates/` CA è¯ä¹¦ï¼›å¯åŠ¨é¢æ¿å°†æ˜¾ç¤ºè¯ä¹¦è·¯å¾„ä¸æœ‰æ•ˆæœŸã€‚

### 2. å®‰è£…è¯ä¹¦

**Web ç•Œé¢ä¸‹è½½**ï¼šæ‰“å¼€ Web ç•Œé¢å³ä¸Šè§’"æ‰«ç ä¸‹è½½è¯ä¹¦"ï¼Œç§»åŠ¨è®¾å¤‡ç”¨æµè§ˆå™¨è®¿é—®ä¸‹è½½é“¾æ¥å®‰è£…ï¼ˆä¸‹è½½çš„æ˜¯ DER æ ¼å¼ï¼Œæ–‡ä»¶åä¸º `uproxier-ca.cer`ï¼‰ã€‚

**å‘½ä»¤è¡Œå®‰è£…**ï¼š

```bash
uproxier cert
# é€‰æ‹©å®‰è£…åˆ°ç³»ç»Ÿï¼Œæˆ–æŒ‰æç¤ºæ‰‹åŠ¨å®‰è£…
```

### 3. é…ç½®ä»£ç†

åœ¨éœ€è¦æŠ“åŒ…çš„è®¾å¤‡/æµè§ˆå™¨é‡Œè®¾ç½® HTTP(S) ä»£ç†ä¸ºæœ¬æœº IP ä¸å¯åŠ¨ç«¯å£ã€‚

## ä½¿ç”¨è¯´æ˜

### å‘½ä»¤è¡Œå·¥å…·

#### å¸®åŠ©ä¿¡æ¯

```bash
uproxier --help
uproxier start --help      # æŸ¥çœ‹å¯åŠ¨å‘½ä»¤çš„æ‰€æœ‰å‚æ•°
uproxier examples --help   # æŸ¥çœ‹ç¤ºä¾‹ç®¡ç†å‘½ä»¤çš„æ‰€æœ‰å‚æ•°
uproxier cert --help       # æŸ¥çœ‹è¯ä¹¦ç®¡ç†å‘½ä»¤çš„æ‰€æœ‰å‚æ•°
uproxier init --help       # æŸ¥çœ‹åˆå§‹åŒ–å‘½ä»¤çš„æ‰€æœ‰å‚æ•°
uproxier info --help       # æŸ¥çœ‹ç‰ˆæœ¬ä¿¡æ¯å‘½ä»¤çš„æ‰€æœ‰å‚æ•°
uproxier validate --help   # æŸ¥çœ‹é…ç½®éªŒè¯å‘½ä»¤çš„æ‰€æœ‰å‚æ•°
```

#### å…¨å±€é€‰é¡¹

```bash
uproxier --verbose          # è¯¦ç»†è¾“å‡º
uproxier --config <path>    # æŒ‡å®šé…ç½®æ–‡ä»¶è·¯å¾„
uproxier --version          # æ˜¾ç¤ºç‰ˆæœ¬ä¿¡æ¯
```

#### ä¸»è¦å‘½ä»¤

**å¯åŠ¨ä»£ç†æœåŠ¡å™¨**

```bash
uproxier start \
  --port 8001 \                   # ä»£ç†æœåŠ¡å™¨ç«¯å£
  --web-port 8002 \               # Web ç•Œé¢ç«¯å£
  --config <path> \               # é…ç½®æ–‡ä»¶è·¯å¾„ï¼ˆå¯é€‰ï¼Œé»˜è®¤ä½¿ç”¨ ~/.uproxier/config.yamlï¼‰
  --save ./logs/traffic.jsonl \   # ä¿å­˜è¯·æ±‚æ•°æ®åˆ°æ–‡ä»¶ï¼ˆJSONLæ ¼å¼ï¼‰
  --enable-https \                # å¯ç”¨ HTTPS è§£å¯†ï¼ˆè¦†ç›–é…ç½®ï¼‰
  --disable-https \               # ç¦ç”¨ HTTPS è§£å¯†ï¼ˆè¦†ç›–é…ç½®ï¼‰
  --silent                        # é™é»˜æ¨¡å¼ï¼Œä¸è¾“å‡ºä»»ä½•ä¿¡æ¯
  --daemon                        # åå°æ¨¡å¼å¯åŠ¨
```

**è¯ä¹¦ç®¡ç†**

```bash
uproxier cert                     # ç®¡ç†è¯ä¹¦ï¼ˆç”Ÿæˆã€å®‰è£…ã€æ¸…ç†ï¼‰
```

**æœåŠ¡å™¨æ§åˆ¶**

```bash
uproxier status             # æŸ¥çœ‹æœåŠ¡å™¨çŠ¶æ€
uproxier stop               # åœæ­¢åå°è¿è¡Œçš„æœåŠ¡å™¨
```

**åˆå§‹åŒ–é…ç½®**

```bash
uproxier init --config <path>                 # æŒ‡å®šé…ç½®æ–‡ä»¶è·¯å¾„
```

**ç‰ˆæœ¬ä¿¡æ¯**

```bash
uproxier info               # æ˜¾ç¤ºç‰ˆæœ¬ä¿¡æ¯
```

**é…ç½®éªŒè¯**

```bash
uproxier validate <config_file>                    # éªŒè¯é…ç½®æ–‡ä»¶
uproxier validate <config_file> --validate-only    # åªè¿›è¡ŒéªŒè¯ï¼Œä¸ç”Ÿæˆå®Œæ•´æŠ¥å‘Š
uproxier validate <config_file> --format json      # è¾“å‡º JSON æ ¼å¼æŠ¥å‘Š
uproxier validate <config_file> --output report.txt # ä¿å­˜æŠ¥å‘Šåˆ°æ–‡ä»¶
```

**è§„åˆ™ç¤ºä¾‹ç®¡ç†**

```bash
uproxier examples --list                    # åˆ—å‡ºæ‰€æœ‰å¯ç”¨ç¤ºä¾‹
uproxier examples --readme                  # æ˜¾ç¤ºç¤ºä¾‹è¯´æ˜æ–‡æ¡£
uproxier examples --show <æ–‡ä»¶å>           # æ˜¾ç¤ºæŒ‡å®šç¤ºä¾‹å†…å®¹
uproxier examples --copy <æ–‡ä»¶å>           # å¤åˆ¶ç¤ºä¾‹åˆ°å½“å‰ç›®å½•
```

## API ä½¿ç”¨

UProxier æä¾›äº†å®Œæ•´çš„ Python APIï¼Œæ”¯æŒé˜»å¡å’Œéé˜»å¡ä¸¤ç§å¯åŠ¨æ–¹å¼ã€‚

### å¿«é€Ÿç¤ºä¾‹

**é˜»å¡å¯åŠ¨**ï¼š
```python
from uproxier.proxy_server import ProxyServer

proxy = ProxyServer("config.yaml")
proxy.start(8001, 8002)  # é˜»å¡å¯åŠ¨ï¼Œç›‘å¬ 0.0.0.0:8001
```

**å¼‚æ­¥å¯åŠ¨**ï¼š
```python
from uproxier.proxy_server import ProxyServer

proxy = ProxyServer("config.yaml", silent=True)
proxy.start_async(8001, 8002)  # éé˜»å¡å¯åŠ¨ï¼Œç›‘å¬ 0.0.0.0:8001
# ç»§ç»­æ‰§è¡Œå…¶ä»–ä»£ç ...
proxy.stop()
```

### è¯¦ç»†æ–‡æ¡£

å®Œæ•´çš„ API ä½¿ç”¨æŒ‡å—è¯·å‚è€ƒï¼š[API_USAGE.md](https://github.com/Huang-Jacky/UProxier/blob/main/API_USAGE.md)

åŒ…å«ï¼š
- é˜»å¡å¯åŠ¨ vs å¼‚æ­¥å¯åŠ¨çš„ä½¿ç”¨åœºæ™¯
- å®Œæ•´çš„å‚æ•°è¯´æ˜å’Œç¤ºä¾‹
- è¿›ç¨‹ç®¡ç†å’ŒçŠ¶æ€æ£€æŸ¥
- é”™è¯¯å¤„ç†å’Œæœ€ä½³å®è·µ
- æµ‹è¯•å’Œè‡ªåŠ¨åŒ–åœºæ™¯ç¤ºä¾‹

## è§„åˆ™é…ç½®

é¡¹ç›®æ”¯æŒåœ¨ `config.yaml` ä¸­å®šä¹‰è§„åˆ™ï¼ŒåŒ…å«è¯·æ±‚/å“åº”ä¿®æ”¹ã€Mockã€å»¶è¿Ÿç­‰ã€‚

### åŸºæœ¬è§„åˆ™ç»“æ„

```yaml
- name: è§„åˆ™åç§°
  enabled: true
  priority: 100
  stop_after_match: false
  match:
    host: "^api\\.example\\.com$"
    path: "^/v1/data$"
    method: "GET"
  request_pipeline: []  # è¯·æ±‚é˜¶æ®µåŠ¨ä½œ
  response_pipeline:    # å“åº”é˜¶æ®µåŠ¨ä½œ
    - action: mock_response
      params:
        status_code: 200
        content: '{"status": "success"}'
```

### å¸¸ç”¨åŠ¨ä½œ

**è¯·æ±‚é˜¶æ®µ (request_pipeline)**

- `set_header`: è®¾ç½®è¯·æ±‚å¤´
- `remove_header`: åˆ é™¤è¯·æ±‚å¤´
- `rewrite_url`: URL é‡å†™
- `redirect`: é‡å®šå‘è¯·æ±‚

**å“åº”é˜¶æ®µ (response_pipeline)**

- `mock_response`: å®Œå…¨æ›¿æ¢å“åº”
- `set_status`: è®¾ç½®çŠ¶æ€ç 
- `set_header`: è®¾ç½®å“åº”å¤´
- `replace_body`: å“åº”ä½“æ›¿æ¢
- `delay`: å»¶è¿Ÿå“åº”

### æŸ¥çœ‹ç¤ºä¾‹

```bash
uproxier examples --list          # åˆ—å‡ºæ‰€æœ‰ç¤ºä¾‹
uproxier examples --readme        # æŸ¥çœ‹ç¤ºä¾‹è¯´æ˜
uproxier examples --copy 01_set_header.yaml  # å¤åˆ¶ç¤ºä¾‹
```

## Web ç•Œé¢

è®¿é—® `http://<æœ¬æœºIP>:8002` æŸ¥çœ‹ Web ç•Œé¢ï¼ŒåŠŸèƒ½åŒ…æ‹¬ï¼š

- ğŸ“Š å®æ—¶æµé‡ç»Ÿè®¡
- ğŸ“‹ è¯·æ±‚/å“åº”è¯¦æƒ…
- ğŸ” æµé‡æœç´¢
- ğŸ’¾ æ•°æ®å¯¼å‡ºï¼ˆ/api/export?format=json|jsonl|csv&limit=1000ï¼‰

## è¯ä¹¦ç®¡ç†

### è‡ªåŠ¨å®‰è£…

```bash
uproxier cert
# é€‰æ‹© "å®‰è£…è¯ä¹¦åˆ°ç³»ç»Ÿ"
```

### æ‰‹åŠ¨å®‰è£…

âš ï¸ **é‡è¦æé†’**ï¼šåªå®‰è£…è¯ä¹¦æ–‡ä»¶ï¼Œä¸è¦å®‰è£…åŒ…å«ç§é’¥çš„æ–‡ä»¶ï¼

**è¯ä¹¦æ–‡ä»¶ä½ç½®**ï¼š`~/.uproxier/certificates/`

- `mitmproxy-ca-cert.pem` - PEM æ ¼å¼è¯ä¹¦ï¼ˆæ¨èï¼‰
- `mitmproxy-ca-cert.der` - DER æ ¼å¼è¯ä¹¦

**å®‰è£…å‘½ä»¤**ï¼š

```bash
# macOS
security add-trusted-cert -d -r trustRoot -k ~/Library/Keychains/login.keychain ~/.uproxier/certificates/mitmproxy-ca-cert.pem

# Windows
certutil -addstore -f ROOT ~/.uproxier/certificates/mitmproxy-ca-cert.der

# Linux
sudo cp ~/.uproxier/certificates/mitmproxy-ca-cert.pem /usr/local/share/ca-certificates/mitmproxy-ca.crt
sudo update-ca-certificates
```

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **å®‰è£…å uproxier å‘½ä»¤ä¸å¯ç”¨**
   ```bash
   # å¦‚æœä½¿ç”¨ pyenvï¼Œæ£€æŸ¥ç‰ˆæœ¬è®¾ç½®
   pyenv global 3.10.6  # æ›¿æ¢ä¸ºä½ çš„ Python ç‰ˆæœ¬
   
   # ç¡®ä¿ Python bin ç›®å½•åœ¨ PATH ä¸­
   export PATH="$(python3 -c "import sys; print(sys.executable.replace('python3', ''))"):$PATH"
   ```

2. **è¯ä¹¦é”™è¯¯**
    - ç¡®ä¿è¯ä¹¦å·²æ­£ç¡®å®‰è£…åˆ°ç³»ç»Ÿ
    - é‡æ–°ç”Ÿæˆè¯ä¹¦ï¼š`uproxier cert`

3. **ç«¯å£è¢«å ç”¨**
    - ä½¿ç”¨ä¸åŒçš„ç«¯å£ï¼š`uproxier start --port 8003`

4. **è§„åˆ™ä¸ç”Ÿæ•ˆ**
    - æ£€æŸ¥è§„åˆ™é…ç½®æ˜¯å¦æ­£ç¡®
    - ç¡®è®¤è§„åˆ™å·²å¯ç”¨
    - æŸ¥çœ‹æ—¥å¿—è¾“å‡º

5. **HTTPS è¿æ¥å¤±è´¥**
    - ç¡®ä¿è¯ä¹¦å·²å®‰è£…
    - æ£€æŸ¥æµè§ˆå™¨ä»£ç†è®¾ç½®

## è®¸å¯è¯

MIT License

## å‚è€ƒ

- [mitmproxy](https://mitmproxy.org/)
- [GitHub ä»“åº“](https://github.com/Huang-Jacky/UProxier)
