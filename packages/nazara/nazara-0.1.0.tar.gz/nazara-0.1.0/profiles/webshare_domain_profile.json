{
  "$schema": "https://nazara.dev/schemas/domain-profile.v1.json",
  "name": "Webshare Operations",
  "description": "Operational context for Webshare proxy service platform. Provides semantic context for AI enrichment of incidents, customer cases, and technical issues.",
  "is_active": true,
  "categories": [
    {
      "key": "allocation",
      "label": "Proxy Allocation",
      "description": "Proxy assignment, IP allocation, PAG management, blacklist operations"
    },
    {
      "key": "authentication",
      "label": "Authentication",
      "description": "Auth failures, 402 errors, API tokens, signature validation, impersonation"
    },
    {
      "key": "billing",
      "label": "Billing & Payments",
      "description": "Subscriptions, invoices, payment methods, refunds, Stripe/PayPal integration"
    },
    {
      "key": "bandwidth",
      "label": "Bandwidth & Usage",
      "description": "Data transfer limits, usage tracking, overage, quota enforcement"
    },
    {
      "key": "performance",
      "label": "Performance",
      "description": "Concurrency limits, latency, load balancing, throttling, request throughput"
    },
    {
      "key": "infrastructure",
      "label": "Infrastructure",
      "description": "Database, Redis, networking, PgBouncer, Kubernetes, Traefik, etcd"
    },
    {
      "key": "verification",
      "label": "Verification & Abuse",
      "description": "Account verification, suspension, abuse reports, compliance"
    },
    {
      "key": "api",
      "label": "API & Integration",
      "description": "REST endpoints, MCP tools, external integrations, webhooks"
    },
    {
      "key": "ui",
      "label": "UI & Dashboard",
      "description": "Frontend issues, control panel, user experience, Next.js/React"
    },
    {
      "key": "configuration",
      "label": "Configuration",
      "description": "Proxy settings, user preferences, system configuration, feature flags"
    }
  ],
  "severities": [
    {
      "key": "critical",
      "label": "Critical",
      "rank": 100,
      "description": "Service outage, data loss, security breach, all customers affected"
    },
    {
      "key": "high",
      "label": "High",
      "rank": 75,
      "description": "Major feature broken, revenue impact, significant customer group affected"
    },
    {
      "key": "medium",
      "label": "Medium",
      "rank": 50,
      "description": "Partial functionality loss, workaround exists, limited customer impact"
    },
    {
      "key": "low",
      "label": "Low",
      "rank": 25,
      "description": "Minor issue, cosmetic, single user, no operational impact"
    }
  ],
  "systems": [
    {
      "key": "proxycontrolpanel",
      "label": "Proxy Control Panel",
      "entry_type": "service",
      "description": "Main Django API + billing, customer-facing REST endpoints, subscription management"
    },
    {
      "key": "proxycontrolpaneldashboard",
      "label": "Dashboard Frontend",
      "entry_type": "service",
      "description": "Next.js customer dashboard, React UI, user self-service portal"
    },
    {
      "key": "proxyallocation",
      "label": "Proxy Allocation",
      "entry_type": "service",
      "description": "Session management, IP allocation, PAG operations, blacklist handling"
    },
    {
      "key": "proxyauth",
      "label": "Proxy Auth",
      "entry_type": "service",
      "description": "Authentication middleware, bandwidth enforcement, 402 responses"
    },
    {
      "key": "proxycore",
      "label": "Proxy Core",
      "entry_type": "service",
      "description": "Proxy lifecycle management, configuration, proxy metadata"
    },
    {
      "key": "proxystats",
      "label": "Proxy Stats",
      "entry_type": "service",
      "description": "Usage statistics, analytics, bandwidth reporting, error tracking"
    },
    {
      "key": "goproxy",
      "label": "Go Proxy",
      "entry_type": "service",
      "description": "Core proxy engine in Go, request routing, concurrency throttling middleware"
    },
    {
      "key": "identitymanagement",
      "label": "Identity Management",
      "entry_type": "service",
      "description": "User tokens, API keys, service accounts, OAuth integration"
    },
    {
      "key": "insights",
      "label": "Insights",
      "entry_type": "service",
      "description": "Analytics platform, GeoIP lookup, usage pattern analysis"
    },
    {
      "key": "proxyserverinventory",
      "label": "Server Inventory",
      "entry_type": "service",
      "description": "Proxy server/IP inventory, availability tracking, capacity management"
    },
    {
      "key": "proxyloaddistributor",
      "label": "Load Distributor",
      "entry_type": "service",
      "description": "Load balancing, traffic distribution, server selection algorithms"
    },
    {
      "key": "blockedhosts",
      "label": "Blocked Hosts",
      "entry_type": "service",
      "description": "URL/host filtering, blacklist management, content restrictions"
    },
    {
      "key": "usertracking",
      "label": "User Tracking",
      "entry_type": "service",
      "description": "Event tracking, user behavior analytics, conversion tracking"
    },
    {
      "key": "mcp",
      "label": "MCP Server",
      "entry_type": "service",
      "description": "Model Context Protocol server, AI tool integration, customer support automation"
    },
    {
      "key": "postgresql",
      "label": "PostgreSQL",
      "entry_type": "infra",
      "description": "Primary database, PostgreSQL 15.x with PgBouncer connection pooling"
    },
    {
      "key": "pgbouncer",
      "label": "PgBouncer",
      "entry_type": "infra",
      "description": "PostgreSQL connection pooler, transaction mode, connection management"
    },
    {
      "key": "redis",
      "label": "Redis Cluster",
      "entry_type": "infra",
      "description": "Cache layer, session storage, pub/sub messaging, Celery broker"
    },
    {
      "key": "traefik",
      "label": "Traefik",
      "entry_type": "infra",
      "description": "Edge router, SSL termination, Let's Encrypt certificates, routing rules"
    },
    {
      "key": "etcd",
      "label": "etcd",
      "entry_type": "infra",
      "description": "Distributed configuration storage, cluster coordination"
    },
    {
      "key": "celery",
      "label": "Celery",
      "entry_type": "infra",
      "description": "Async task queue, background job processing, scheduled tasks"
    },
    {
      "key": "intercom",
      "label": "Intercom",
      "entry_type": "external",
      "description": "Customer support platform, Fin AI chatbot, ticket management"
    },
    {
      "key": "stripe",
      "label": "Stripe",
      "entry_type": "external",
      "description": "Primary payment processor, subscription billing, invoicing"
    },
    {
      "key": "paypal",
      "label": "PayPal",
      "entry_type": "external",
      "description": "Alternative payment processor, international payments"
    },
    {
      "key": "sentry",
      "label": "Sentry",
      "entry_type": "external",
      "description": "Error tracking, exception monitoring, release tracking"
    },
    {
      "key": "datadog",
      "label": "Datadog",
      "entry_type": "external",
      "description": "APM, metrics collection, log aggregation, dashboards"
    }
  ],
  "glossary": [
    {
      "term": "PAG",
      "definition": "Proxy Allocation Group - container for user's allocated proxies, shared across multiple subscription plans for the same user",
      "aliases": ["proxy allocation group", "allocation group"]
    },
    {
      "term": "allocation",
      "definition": "Process of assigning proxy IPs from server inventory to a customer's subscription entitlement",
      "aliases": ["proxy assignment", "IP assignment", "assign"]
    },
    {
      "term": "bandwidth",
      "definition": "Data transfer limit per subscription measured in bytes, enforced at PAG level causing shared exhaustion across plans",
      "aliases": ["data transfer", "transfer limit", "BW"]
    },
    {
      "term": "402",
      "definition": "HTTP Payment Required status code returned when bandwidth limit is exceeded or subscription is invalid",
      "aliases": ["payment required", "HTTP 402"]
    },
    {
      "term": "proxy_type",
      "definition": "Primary proxy category defining the network type: residential, datacenter, mobile, or ISP",
      "aliases": ["type", "network type"]
    },
    {
      "term": "proxy_subtype",
      "definition": "Secondary classification within a proxy type: static (dedicated IP), rotating (auto-change), or shared (multi-user)",
      "aliases": ["subtype", "rotation type"]
    },
    {
      "term": "blacklist",
      "definition": "User-configured list of IP addresses to exclude from allocation, stored per user and applied during proxy assignment",
      "aliases": ["blocklist", "exclusion list", "IP blacklist"]
    },
    {
      "term": "subscription",
      "definition": "Active paid plan granting proxy entitlements including proxy count, bandwidth quota, and concurrency limits",
      "aliases": ["plan", "proxy plan", "subscription plan"]
    },
    {
      "term": "concurrency",
      "definition": "Maximum simultaneous proxy connections allowed, enforced by Go middleware with dual throttlers (user + PAG level)",
      "aliases": ["thread count", "max threads", "concurrent connections"]
    },
    {
      "term": "UPSignatureAuth",
      "definition": "HMAC-SHA256 authentication mechanism for service-to-service API calls using access key and secret key pairs",
      "aliases": ["signature auth", "HMAC auth", "UP auth"]
    },
    {
      "term": "customer_id",
      "definition": "User identifier passed in X-WEBSHARE-CUSTOMER-ID header for service account impersonation of customer requests",
      "aliases": ["user_id", "masquerade ID", "impersonation ID"]
    },
    {
      "term": "PgBouncer",
      "definition": "PostgreSQL connection pooler running in transaction mode, requiring CONN_MAX_AGE=0 in Django settings",
      "aliases": ["connection pooler", "pgb"]
    },
    {
      "term": "throttler",
      "definition": "Go middleware component enforcing concurrency limits with dual-check (user-level and PAG-level must both pass)",
      "aliases": ["rate limiter", "concurrency limiter"]
    },
    {
      "term": "verification_limits",
      "definition": "Account restrictions applied during verification process, limiting thread count and bandwidth until verification completes",
      "aliases": ["limits", "account restrictions", "verification restrictions"]
    },
    {
      "term": "allocation_count",
      "definition": "Counter on PAG tracking number of allocated proxies, can drift from actual count due to race conditions requiring reconciliation",
      "aliases": ["proxy count", "allocated count"]
    }
  ],
  "operational_policies": [
    {
      "key": "billing-priority",
      "statement": "Billing issues impact revenue directly and are always treated as high priority. Customer payment failures, subscription errors, and invoice discrepancies require immediate attention within 1 hour during business hours."
    },
    {
      "key": "allocation-impact",
      "statement": "Proxy allocation failures affect customer operations immediately since customers rely on proxies for their business processes. Issues with PAG, blacklist, or IP assignment should be escalated within 30 minutes."
    },
    {
      "key": "security-first",
      "statement": "Authentication and authorization issues are treated as security incidents. Invalid tokens, signature failures, and impersonation errors require immediate investigation and potential incident declaration."
    },
    {
      "key": "infrastructure-criticality",
      "statement": "Database and Redis issues require immediate escalation as they affect all services. PgBouncer pool exhaustion, connection leaks, and Redis memory pressure are platform-wide emergencies."
    },
    {
      "key": "customer-experience",
      "statement": "Dashboard and UI issues affect customer perception and self-service capability. Frontend errors, slow loads, and UX problems should be addressed within the same business day."
    },
    {
      "key": "402-bandwidth-shared",
      "statement": "Known architectural issue: Multi-plan users share a single PAG, causing 402 errors when ANY plan exhausts bandwidth. When investigating 402 errors, always check ALL plans under the user's PAG, not just the one being used."
    },
    {
      "key": "allocation-count-drift",
      "statement": "PAG allocation_count field can drift from actual proxy count due to race conditions in concurrent operations. Always verify reported count vs reality using COUNT(*) query during allocation troubleshooting."
    }
  ],
  "enrichment_flows": [
    {
      "target_type": "Incident",
      "name": "Default",
      "priority": 0,
      "enabled": true,
      "category_filter": [],
      "severity_filter": [],
      "service_filter": [],
      "steps": [
        {"enrichment_type": "summary.v1", "order": 0, "input_source": "raw"},
        {"enrichment_type": "embedding.v1", "order": 1, "input_source": "dependent"}
      ]
    },
    {
      "target_type": "CustomerCase",
      "name": "Default",
      "priority": 0,
      "enabled": true,
      "category_filter": [],
      "severity_filter": [],
      "service_filter": [],
      "steps": [
        {"enrichment_type": "summary.v1", "order": 0, "input_source": "raw"},
        {"enrichment_type": "embedding.v1", "order": 1, "input_source": "dependent"}
      ]
    },
    {
      "target_type": "TechnicalIssue",
      "name": "Infrastructure",
      "priority": 10,
      "enabled": true,
      "category_filter": ["infrastructure", "performance"],
      "severity_filter": [],
      "service_filter": [],
      "steps": [
        {"enrichment_type": "summary.v1", "order": 0, "input_source": "raw"},
        {"enrichment_type": "embedding.v1", "order": 1, "input_source": "dependent"}
      ]
    },
    {
      "target_type": "TechnicalIssue",
      "name": "Default",
      "priority": 0,
      "enabled": true,
      "category_filter": [],
      "severity_filter": [],
      "service_filter": [],
      "steps": [
        {"enrichment_type": "embedding.v1", "order": 0, "input_source": "raw"}
      ]
    }
  ]
}
