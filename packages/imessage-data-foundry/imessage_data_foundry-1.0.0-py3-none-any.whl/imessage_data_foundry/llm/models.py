from pydantic import BaseModel, Field

from imessage_data_foundry.personas.models import (
    CommunicationFrequency,
    EmojiUsage,
    ResponseTime,
    VocabularyLevel,
)


class PersonaConstraints(BaseModel):
    """Constraints for persona generation."""

    relationship: str | None = Field(default=None, description="e.g., friend, family, coworker")
    communication_frequency: CommunicationFrequency | None = None
    typical_response_time: ResponseTime | None = None
    emoji_usage: EmojiUsage | None = None
    vocabulary_level: VocabularyLevel | None = None
    age_range: tuple[int, int] | None = Field(default=None, description="Min and max age")
    topics: list[str] | None = Field(default=None, description="Topics they discuss")
    personality_traits: list[str] | None = Field(default=None, description="Key traits")


class GeneratedMessage(BaseModel):
    """A message generated by the LLM before timestamp assignment."""

    text: str
    sender_id: str = Field(description="Persona ID of the sender")
    is_from_me: bool = Field(description="True if sender is the 'self' persona")


class GeneratedPersona(BaseModel):
    """Raw persona data generated by LLM before full model creation."""

    name: str = Field(description="Full name of the persona")
    personality: str = Field(description="Personality description (2-3 sentences)")
    writing_style: str = Field(
        description="How they write texts (formal, casual, uses slang, etc.)"
    )
    relationship: str = Field(description="Relationship to the user")
    communication_frequency: CommunicationFrequency = Field(default=CommunicationFrequency.MEDIUM)
    typical_response_time: ResponseTime = Field(default=ResponseTime.MINUTES)
    emoji_usage: EmojiUsage = Field(default=EmojiUsage.LIGHT)
    vocabulary_level: VocabularyLevel = Field(default=VocabularyLevel.MODERATE)
    topics_of_interest: list[str] = Field(
        default_factory=list, description="3-5 topics they often discuss"
    )
